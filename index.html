<!DOCTYPE html>
<html data-init="no-js">
<head>
<meta charset="UTF-8" />
<title>a Prince&#39;s tale</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!--

SugarCube (v2.36.1): A free (gratis and libre) story format.

Copyright © 2013–2021 Thomas Michael Edwards <thomasmedwards@gmail.com>.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

-->
<script id="script-libraries" type="text/javascript">
if(document.head&&document.addEventListener&&document.querySelector&&Object.create&&Object.freeze&&JSON){document.documentElement.setAttribute("data-init", "loading");
/*! @source http://purl.eligrey.com/github/classList.js/blob/1.2.20171210/classList.js */
"document"in self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||!function(t){"use strict";if("Element"in t){var e="classList",n="prototype",i=t.Element[n],s=Object,r=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},c=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},a=function(t,e){if(""===e)throw new c("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(e))throw new c("INVALID_CHARACTER_ERR","The token must not contain space characters.");return o.call(t,e)},l=function(t){for(var e=r.call(t.getAttribute("class")||""),n=e?e.split(/\s+/):[],i=0,s=n.length;s>i;i++)this.push(n[i]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},u=l[n]=[],h=function(){return new l(this)};if(c[n]=Error[n],u.item=function(t){return this[t]||null},u.contains=function(t){return~a(this,t+"")},u.add=function(){var t,e=arguments,n=0,i=e.length,s=!1;do t=e[n]+"",~a(this,t)||(this.push(t),s=!0);while(++n<i);s&&this._updateClassName()},u.remove=function(){var t,e,n=arguments,i=0,s=n.length,r=!1;do for(t=n[i]+"",e=a(this,t);~e;)this.splice(e,1),r=!0,e=a(this,t);while(++i<s);r&&this._updateClassName()},u.toggle=function(t,e){var n=this.contains(t),i=n?e!==!0&&"remove":e!==!1&&"add";return i&&this[i](t),e===!0||e===!1?e:!n},u.replace=function(t,e){var n=a(t+"");~n&&(this.splice(n,1,e),this._updateClassName())},u.toString=function(){return this.join(" ")},s.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{s.defineProperty(i,e,f)}catch(p){void 0!==p.number&&-2146823252!==p.number||(f.enumerable=!1,s.defineProperty(i,e,f))}}else s[n].__defineGetter__&&i.__defineGetter__(e,h)}}(self),function(){"use strict";var t=document.createElement("_");if(t.classList.add("c1","c2"),!t.classList.contains("c2")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var n,i=arguments.length;for(n=0;i>n;n++)t=arguments[n],e.call(this,t)}};e("add"),e("remove")}if(t.classList.toggle("c3",!1),t.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:n.call(this,t)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(t,e){var n=this.toString().split(" "),i=n.indexOf(t+"");~i&&(n=n.slice(i),this.remove.apply(this,n),this.add(e),this.add.apply(this,n.slice(1)))}),t=null}());
/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2020 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.5.14/LICENSE
 */
(function(t,r){"use strict";if(typeof define==="function"&&define.amd){define(r)}else if(typeof exports==="object"){module.exports=r()}else{t.returnExports=r()}})(this,function(){var t=Array;var r=t.prototype;var e=Object;var n=e.prototype;var i=Function;var a=i.prototype;var o=String;var f=o.prototype;var u=Number;var l=u.prototype;var s=r.slice;var c=r.splice;var v=r.push;var h=r.unshift;var p=r.concat;var y=r.join;var d=a.call;var g=a.apply;var w=Math.max;var b=Math.min;var T=n.toString;var m=typeof Symbol==="function"&&typeof Symbol.toStringTag==="symbol";var D;var S=Function.prototype.toString,x=/^\s*class /,O=function isES6ClassFn(t){try{var r=S.call(t);var e=r.replace(/\/\/.*\n/g,"");var n=e.replace(/\/\*[.\s\S]*\*\//g,"");var i=n.replace(/\n/gm," ").replace(/ {2}/g," ");return x.test(i)}catch(a){return false}},E=function tryFunctionObject(t){try{if(O(t)){return false}S.call(t);return true}catch(r){return false}},j="[object Function]",I="[object GeneratorFunction]",D=function isCallable(t){if(!t){return false}if(typeof t!=="function"&&typeof t!=="object"){return false}if(m){return E(t)}if(O(t)){return false}var r=T.call(t);return r===j||r===I};var M;var U=RegExp.prototype.exec,$=function tryRegexExec(t){try{U.call(t);return true}catch(r){return false}},F="[object RegExp]";M=function isRegex(t){if(typeof t!=="object"){return false}return m?$(t):T.call(t)===F};var N;var C=String.prototype.valueOf,k=function tryStringObject(t){try{C.call(t);return true}catch(r){return false}},A="[object String]";N=function isString(t){if(typeof t==="string"){return true}if(typeof t!=="object"){return false}return m?k(t):T.call(t)===A};var R=e.defineProperty&&function(){try{var t={};e.defineProperty(t,"x",{enumerable:false,value:t});for(var r in t){return false}return t.x===t}catch(n){return false}}();var P=function(t){var r;if(R){r=function(t,r,n,i){if(!i&&r in t){return}e.defineProperty(t,r,{configurable:true,enumerable:false,writable:true,value:n})}}else{r=function(t,r,e,n){if(!n&&r in t){return}t[r]=e}}return function defineProperties(e,n,i){for(var a in n){if(t.call(n,a)){r(e,a,n[a],i)}}}}(n.hasOwnProperty);var J=function isPrimitive(t){var r=typeof t;return t===null||r!=="object"&&r!=="function"};var Y=u.isNaN||function isActualNaN(t){return t!==t};var z={ToInteger:function ToInteger(t){var r=+t;if(Y(r)){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*Math.floor(Math.abs(r))}return r},ToPrimitive:function ToPrimitive(t){var r,e,n;if(J(t)){return t}e=t.valueOf;if(D(e)){r=e.call(t);if(J(r)){return r}}n=t.toString;if(D(n)){r=n.call(t);if(J(r)){return r}}throw new TypeError},ToObject:function(t){if(t==null){throw new TypeError("can't convert "+t+" to object")}return e(t)},ToUint32:function ToUint32(t){return t>>>0}};var Z=function Empty(){};P(a,{bind:function bind(t){var r=this;if(!D(r)){throw new TypeError("Function.prototype.bind called on incompatible "+r)}var n=s.call(arguments,1);var a;var o=function(){if(this instanceof a){var i=g.call(r,this,p.call(n,s.call(arguments)));if(e(i)===i){return i}return this}else{return g.call(r,t,p.call(n,s.call(arguments)))}};var f=w(0,r.length-n.length);var u=[];for(var l=0;l<f;l++){v.call(u,"$"+l)}a=i("binder","return function ("+y.call(u,",")+"){ return binder.apply(this, arguments); }")(o);if(r.prototype){Z.prototype=r.prototype;a.prototype=new Z;Z.prototype=null}return a}});var G=d.bind(n.hasOwnProperty);var H=d.bind(n.toString);var W=d.bind(s);var B=g.bind(s);if(typeof document==="object"&&document&&document.documentElement){try{W(document.documentElement.childNodes)}catch(X){var L=W;var q=B;W=function arraySliceIE(t){var r=[];var e=t.length;while(e-- >0){r[e]=t[e]}return q(r,L(arguments,1))};B=function arraySliceApplyIE(t,r){return q(W(t),r)}}}var K=d.bind(f.slice);var Q=d.bind(f.split);var V=d.bind(f.indexOf);var _=d.bind(v);var tt=d.bind(n.propertyIsEnumerable);var rt=d.bind(r.sort);var et=t.isArray||function isArray(t){return H(t)==="[object Array]"};var nt=[].unshift(0)!==1;P(r,{unshift:function(){h.apply(this,arguments);return this.length}},nt);P(t,{isArray:et});var it=e("a");var at=it[0]!=="a"||!(0 in it);var ot=function properlyBoxed(t){var r=true;var e=true;var n=false;if(t){try{t.call("foo",function(t,e,n){if(typeof n!=="object"){r=false}});t.call([1],function(){"use strict";e=typeof this==="string"},"x")}catch(i){n=true}}return!!t&&!n&&r&&e};P(r,{forEach:function forEach(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=-1;var i=z.ToUint32(e.length);var a;if(arguments.length>1){a=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.forEach callback must be a function")}while(++n<i){if(n in e){if(typeof a==="undefined"){t(e[n],n,r)}else{t.call(a,e[n],n,r)}}}}},!ot(r.forEach));P(r,{map:function map(r){var e=z.ToObject(this);var n=at&&N(this)?Q(this,""):e;var i=z.ToUint32(n.length);var a=t(i);var o;if(arguments.length>1){o=arguments[1]}if(!D(r)){throw new TypeError("Array.prototype.map callback must be a function")}for(var f=0;f<i;f++){if(f in n){if(typeof o==="undefined"){a[f]=r(n[f],f,e)}else{a[f]=r.call(o,n[f],f,e)}}}return a}},!ot(r.map));P(r,{filter:function filter(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i=[];var a;var o;if(arguments.length>1){o=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.filter callback must be a function")}for(var f=0;f<n;f++){if(f in e){a=e[f];if(typeof o==="undefined"?t(a,f,r):t.call(o,a,f,r)){_(i,a)}}}return i}},!ot(r.filter));P(r,{every:function every(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.every callback must be a function")}for(var a=0;a<n;a++){if(a in e&&!(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return false}}return true}},!ot(r.every));P(r,{some:function some(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.some callback must be a function")}for(var a=0;a<n;a++){if(a in e&&(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return true}}return false}},!ot(r.some));var ft=false;if(r.reduce){ft=typeof r.reduce.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduce:function reduce(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduce callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var a;if(arguments.length>=2){a=arguments[1]}else{do{if(i in e){a=e[i++];break}if(++i>=n){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<n;i++){if(i in e){a=t(a,e[i],i,r)}}return a}},!ft);var ut=false;if(r.reduceRight){ut=typeof r.reduceRight.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduceRight:function reduceRight(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduceRight callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var i;var a=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(a in e){i=e[a--];break}if(--a<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(a<0){return i}do{if(a in e){i=t(i,e[a],a,r)}}while(a--);return i}},!ut);var lt=r.indexOf&&[0,1].indexOf(1,2)!==-1;P(r,{indexOf:function indexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=0;if(arguments.length>1){n=z.ToInteger(arguments[1])}n=n>=0?n:w(0,e+n);for(;n<e;n++){if(n in r&&r[n]===t){return n}}return-1}},lt);var st=r.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;P(r,{lastIndexOf:function lastIndexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=e-1;if(arguments.length>1){n=b(n,z.ToInteger(arguments[1]))}n=n>=0?n:e-Math.abs(n);for(;n>=0;n--){if(n in r&&t===r[n]){return n}}return-1}},st);var ct=function(){var t=[1,2];var r=t.splice();return t.length===2&&et(r)&&r.length===0}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}else{return c.apply(this,arguments)}}},!ct);var vt=function(){var t={};r.splice.call(t,0,0,1);return t.length===1}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}var e=arguments;this.length=w(z.ToInteger(this.length),0);if(arguments.length>0&&typeof r!=="number"){e=W(arguments);if(e.length<2){_(e,this.length-t)}else{e[1]=z.ToInteger(r)}}return c.apply(this,e)}},!vt);var ht=function(){var r=new t(1e5);r[8]="x";r.splice(1,1);return r.indexOf("x")===7}();var pt=function(){var t=256;var r=[];r[t]="a";r.splice(t+1,0,"b");return r[t]==="a"}();P(r,{splice:function splice(t,r){var e=z.ToObject(this);var n=[];var i=z.ToUint32(e.length);var a=z.ToInteger(t);var f=a<0?w(i+a,0):b(a,i);var u=arguments.length===0?0:arguments.length===1?i-f:b(w(z.ToInteger(r),0),i-f);var l=0;var s;while(l<u){s=o(f+l);if(G(e,s)){n[l]=e[s]}l+=1}var c=W(arguments,2);var v=c.length;var h;if(v<u){l=f;var p=i-u;while(l<p){s=o(l+u);h=o(l+v);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l+=1}l=i;var y=i-u+v;while(l>y){delete e[l-1];l-=1}}else if(v>u){l=i-u;while(l>f){s=o(l+u-1);h=o(l+v-1);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l-=1}}l=f;for(var d=0;d<c.length;++d){e[l]=c[d];l+=1}e.length=i-u+v;return n}},!ht||!pt);var yt=r.join;var dt;try{dt=Array.prototype.join.call("123",",")!=="1,2,3"}catch(X){dt=true}if(dt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(N(this)?Q(this,""):this,r)}},dt)}var gt=[1,2].join(undefined)!=="1,2";if(gt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(this,r)}},gt)}var wt=function push(t){var r=z.ToObject(this);var e=z.ToUint32(r.length);var n=0;while(n<arguments.length){r[e+n]=arguments[n];n+=1}r.length=e+n;return e+n};var bt=function(){var t={};var r=Array.prototype.push.call(t,undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:function push(t){if(et(this)){return v.apply(this,arguments)}return wt.apply(this,arguments)}},bt);var Tt=function(){var t=[];var r=t.push(undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:wt},Tt);P(r,{slice:function(t,r){var e=N(this)?Q(this,""):this;return B(e,arguments)}},at);var mt=function(){try{[1,2].sort(null)}catch(t){try{[1,2].sort({})}catch(r){return false}}return true}();var Dt=function(){try{[1,2].sort(/a/);return false}catch(t){}return true}();var St=function(){try{[1,2].sort(undefined);return true}catch(t){}return false}();P(r,{sort:function sort(t){if(typeof t==="undefined"){return rt(this)}if(!D(t)){throw new TypeError("Array.prototype.sort callback must be a function")}return rt(this,t)}},mt||!St||!Dt);var xt=!tt({toString:null},"toString");var Ot=tt(function(){},"prototype");var Et=!G("x","0");var jt=function(t){var r=t.constructor;return r&&r.prototype===t};var It={$applicationCache:true,$console:true,$external:true,$frame:true,$frameElement:true,$frames:true,$innerHeight:true,$innerWidth:true,$onmozfullscreenchange:true,$onmozfullscreenerror:true,$outerHeight:true,$outerWidth:true,$pageXOffset:true,$pageYOffset:true,$parent:true,$scrollLeft:true,$scrollTop:true,$scrollX:true,$scrollY:true,$self:true,$webkitIndexedDB:true,$webkitStorageInfo:true,$window:true,$width:true,$height:true,$top:true,$localStorage:true};var Mt=function(){if(typeof window==="undefined"){return false}for(var t in window){try{if(!It["$"+t]&&G(window,t)&&window[t]!==null&&typeof window[t]==="object"){jt(window[t])}}catch(r){return true}}return false}();var Ut=function(t){if(typeof window==="undefined"||!Mt){return jt(t)}try{return jt(t)}catch(r){return false}};var $t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];var Ft=$t.length;var Nt=function isArguments(t){return H(t)==="[object Arguments]"};var Ct=function isArguments(t){return t!==null&&typeof t==="object"&&typeof t.length==="number"&&t.length>=0&&!et(t)&&D(t.callee)};var kt=Nt(arguments)?Nt:Ct;P(e,{keys:function keys(t){var r=D(t);var e=kt(t);var n=t!==null&&typeof t==="object";var i=n&&N(t);if(!n&&!r&&!e){throw new TypeError("Object.keys called on a non-object")}var a=[];var f=Ot&&r;if(i&&Et||e){for(var u=0;u<t.length;++u){_(a,o(u))}}if(!e){for(var l in t){if(!(f&&l==="prototype")&&G(t,l)){_(a,o(l))}}}if(xt){var s=Ut(t);for(var c=0;c<Ft;c++){var v=$t[c];if(!(s&&v==="constructor")&&G(t,v)){_(a,v)}}}return a}});var At=e.keys&&function(){return e.keys(arguments).length===2}(1,2);var Rt=e.keys&&function(){var t=e.keys(arguments);return arguments.length!==1||t.length!==1||t[0]!==1}(1);var Pt=e.keys;P(e,{keys:function keys(t){if(kt(t)){return Pt(W(t))}else{return Pt(t)}}},!At||Rt);var Jt=new Date(-0xc782b5b342b24).getUTCMonth()!==0;var Yt=new Date(-0x55d318d56a724);var zt=new Date(14496624e5);var Zt=Yt.toUTCString()!=="Mon, 01 Jan -45875 11:59:59 GMT";var Gt;var Ht;var Wt=Yt.getTimezoneOffset();if(Wt<-720){Gt=Yt.toDateString()!=="Tue Jan 02 -45875";Ht=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}else{Gt=Yt.toDateString()!=="Mon Jan 01 -45875";Ht=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}var Bt=d.bind(Date.prototype.getFullYear);var Xt=d.bind(Date.prototype.getMonth);var Lt=d.bind(Date.prototype.getDate);var qt=d.bind(Date.prototype.getUTCFullYear);var Kt=d.bind(Date.prototype.getUTCMonth);var Qt=d.bind(Date.prototype.getUTCDate);var Vt=d.bind(Date.prototype.getUTCDay);var _t=d.bind(Date.prototype.getUTCHours);var tr=d.bind(Date.prototype.getUTCMinutes);var rr=d.bind(Date.prototype.getUTCSeconds);var er=d.bind(Date.prototype.getUTCMilliseconds);var nr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var ir=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var ar=function daysInMonth(t,r){return Lt(new Date(r,t,0))};P(Date.prototype,{getFullYear:function getFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);if(t<0&&Xt(this)>11){return t+1}return t},getMonth:function getMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);if(t<0&&r>11){return 0}return r},getDate:function getDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);var e=Lt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e},getUTCFullYear:function getUTCFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);if(t<0&&Kt(this)>11){return t+1}return t},getUTCMonth:function getUTCMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);if(t<0&&r>11){return 0}return r},getUTCDate:function getUTCDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);var e=Qt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e}},Jt);P(Date.prototype,{toUTCString:function toUTCString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Vt(this);var r=Qt(this);var e=Kt(this);var n=qt(this);var i=_t(this);var a=tr(this);var o=rr(this);return nr[t]+", "+(r<10?"0"+r:r)+" "+ir[e]+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"}},Jt||Zt);P(Date.prototype,{toDateString:function toDateString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n}},Jt||Gt);if(Jt||Ht){Date.prototype.toString=function toString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();var i=this.getHours();var a=this.getMinutes();var o=this.getSeconds();var f=this.getTimezoneOffset();var u=Math.floor(Math.abs(f)/60);var l=Math.floor(Math.abs(f)%60);return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"+(f>0?"-":"+")+(u<10?"0"+u:u)+(l<10?"0"+l:l)};if(R){e.defineProperty(Date.prototype,"toString",{configurable:true,enumerable:false,writable:true})}}var or=-621987552e5;var fr="-000001";var ur=Date.prototype.toISOString&&new Date(or).toISOString().indexOf(fr)===-1;var lr=Date.prototype.toISOString&&new Date(-1).toISOString()!=="1969-12-31T23:59:59.999Z";var sr=d.bind(Date.prototype.getTime);P(Date.prototype,{toISOString:function toISOString(){if(!isFinite(this)||!isFinite(sr(this))){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}var t=qt(this);var r=Kt(this);t+=Math.floor(r/12);r=(r%12+12)%12;var e=[r+1,Qt(this),_t(this),tr(this),rr(this)];t=(t<0?"-":t>9999?"+":"")+K("00000"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var n=0;n<e.length;++n){e[n]=K("00"+e[n],-2)}return t+"-"+W(e,0,2).join("-")+"T"+W(e,2).join(":")+"."+K("000"+er(this),-3)+"Z"}},ur||lr);var cr=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(or).toJSON().indexOf(fr)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(t){return false}}();if(!cr){Date.prototype.toJSON=function toJSON(t){var r=e(this);var n=z.ToPrimitive(r);if(typeof n==="number"&&!isFinite(n)){return null}var i=r.toISOString;if(!D(i)){throw new TypeError("toISOString property is not callable")}return i.call(r)}}var vr=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var hr=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));var pr=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(pr||hr||!vr){var yr=Math.pow(2,31)-1;var dr=Y(new Date(1970,0,1,0,0,0,yr+1).getTime());Date=function(t){var r=function Date(e,n,i,a,f,u,l){var s=arguments.length;var c;if(this instanceof t){var v=u;var h=l;if(dr&&s>=7&&l>yr){var p=Math.floor(l/yr)*yr;var y=Math.floor(p/1e3);v+=y;h-=y*1e3}c=s===1&&o(e)===e?new t(r.parse(e)):s>=7?new t(e,n,i,a,f,v,h):s>=6?new t(e,n,i,a,f,v):s>=5?new t(e,n,i,a,f):s>=4?new t(e,n,i,a):s>=3?new t(e,n,i):s>=2?new t(e,n):s>=1?new t(e instanceof t?+e:e):new t}else{c=t.apply(this,arguments)}if(!J(c)){P(c,{constructor:r},true)}return c};var e=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];var i=function dayFromMonth(t,r){var e=r>1?1:0;return n[r]+Math.floor((t-1969+e)/4)-Math.floor((t-1901+e)/100)+Math.floor((t-1601+e)/400)+365*(t-1970)};var a=function toUTC(r){var e=0;var n=r;if(dr&&n>yr){var i=Math.floor(n/yr)*yr;var a=Math.floor(i/1e3);e+=a;n-=a*1e3}return u(new t(1970,0,1,0,0,e,n))};for(var f in t){if(G(t,f)){r[f]=t[f]}}P(r,{now:t.now,UTC:t.UTC},true);r.prototype=t.prototype;P(r.prototype,{constructor:r},true);var l=function parse(r){var n=e.exec(r);if(n){var o=u(n[1]),f=u(n[2]||1)-1,l=u(n[3]||1)-1,s=u(n[4]||0),c=u(n[5]||0),v=u(n[6]||0),h=Math.floor(u(n[7]||0)*1e3),p=Boolean(n[4]&&!n[8]),y=n[9]==="-"?1:-1,d=u(n[10]||0),g=u(n[11]||0),w;var b=c>0||v>0||h>0;if(s<(b?24:25)&&c<60&&v<60&&h<1e3&&f>-1&&f<12&&d<24&&g<60&&l>-1&&l<i(o,f+1)-i(o,f)){w=((i(o,f)+l)*24+s+d*y)*60;w=((w+c+g*y)*60+v)*1e3+h;if(p){w=a(w)}if(-864e13<=w&&w<=864e13){return w}}return NaN}return t.parse.apply(this,arguments)};P(r,{parse:l});return r}(Date)}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var gr=l.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||(1000000000000000128).toFixed(0)!=="1000000000000000128");var wr={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function multiply(t,r){var e=-1;var n=r;while(++e<wr.size){n+=t*wr.data[e];wr.data[e]=n%wr.base;n=Math.floor(n/wr.base)}},divide:function divide(t){var r=wr.size;var e=0;while(--r>=0){e+=wr.data[r];wr.data[r]=Math.floor(e/t);e=e%t*wr.base}},numToString:function numToString(){var t=wr.size;var r="";while(--t>=0){if(r!==""||t===0||wr.data[t]!==0){var e=o(wr.data[t]);if(r===""){r=e}else{r+=K("0000000",0,7-e.length)+e}}}return r},pow:function pow(t,r,e){return r===0?e:r%2===1?pow(t,r-1,e*t):pow(t*t,r/2,e)},log:function log(t){var r=0;var e=t;while(e>=4096){r+=12;e/=4096}while(e>=2){r+=1;e/=2}return r}};var br=function toFixed(t){var r,e,n,i,a,f,l,s;r=u(t);r=Y(r)?0:Math.floor(r);if(r<0||r>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}e=u(this);if(Y(e)){return"NaN"}if(e<=-1e21||e>=1e21){return o(e)}n="";if(e<0){n="-";e=-e}i="0";if(e>1e-21){a=wr.log(e*wr.pow(2,69,1))-69;f=a<0?e*wr.pow(2,-a,1):e/wr.pow(2,a,1);f*=4503599627370496;a=52-a;if(a>0){wr.multiply(0,f);l=r;while(l>=7){wr.multiply(1e7,0);l-=7}wr.multiply(wr.pow(10,l,1),0);l=a-1;while(l>=23){wr.divide(1<<23);l-=23}wr.divide(1<<l);wr.multiply(1,1);wr.divide(2);i=wr.numToString()}else{wr.multiply(0,f);wr.multiply(1<<-a,0);i=wr.numToString()+K("0.00000000000000000000",2,2+r)}}if(r>0){s=i.length;if(s<=r){i=n+K("0.0000000000000000000",0,r-s+2)+i}else{i=n+K(i,0,s-r)+"."+K(i,s-r)}}else{i=n+i}return i};P(l,{toFixed:br},gr);var Tr=function(){try{return 1..toPrecision(undefined)==="1"}catch(t){return true}}();var mr=l.toPrecision;P(l,{toPrecision:function toPrecision(t){return typeof t==="undefined"?mr.call(this):mr.call(this,t)}},Tr);if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var t=typeof/()??/.exec("")[1]==="undefined";var r=Math.pow(2,32)-1;f.split=function(e,n){var i=String(this);if(typeof e==="undefined"&&n===0){return[]}if(!M(e)){return Q(this,e,n)}var a=[];var o=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,u,l,s,c;var h=new RegExp(e.source,o+"g");if(!t){u=new RegExp("^"+h.source+"$(?!\\s)",o)}var p=typeof n==="undefined"?r:z.ToUint32(n);l=h.exec(i);while(l){s=l.index+l[0].length;if(s>f){_(a,K(i,f,l.index));if(!t&&l.length>1){l[0].replace(u,function(){for(var t=1;t<arguments.length-2;t++){if(typeof arguments[t]==="undefined"){l[t]=void 0}}})}if(l.length>1&&l.index<i.length){v.apply(a,W(l,1))}c=l[0].length;f=s;if(a.length>=p){break}}if(h.lastIndex===l.index){h.lastIndex++}l=h.exec(i)}if(f===i.length){if(c||!h.test("")){_(a,"")}}else{_(a,K(i,f))}return a.length>p?W(a,0,p):a}})()}else if("0".split(void 0,0).length){f.split=function split(t,r){if(typeof t==="undefined"&&r===0){return[]}return Q(this,t,r)}}var Dr=f.replace;var Sr=function(){var t=[];"x".replace(/x(.)?/g,function(r,e){_(t,e)});return t.length===1&&typeof t[0]==="undefined"}();if(!Sr){f.replace=function replace(t,r){var e=D(r);var n=M(t)&&/\)[*?]/.test(t.source);if(!e||!n){return Dr.call(this,t,r)}else{var i=function(e){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var a=t.exec(e)||[];t.lastIndex=i;_(a,arguments[n-2],arguments[n-1]);return r.apply(this,a)};return Dr.call(this,t,i)}}}var xr=f.substr;var Or="".substr&&"0b".substr(-1)!=="b";P(f,{substr:function substr(t,r){var e=t;if(t<0){e=w(this.length+t,0)}return xr.call(this,e,r)}},Or);var Er="\t\n\x0B\f\r \xa0\u1680\u2000\u2001\u2002\u2003"+"\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028"+"\u2029\ufeff";var jr="\u200b";var Ir="["+Er+"]";var Mr=new RegExp("^"+Ir+Ir+"*");var Ur=new RegExp(Ir+Ir+"*$");var $r=f.trim&&(Er.trim()||!jr.trim());P(f,{trim:function trim(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}return o(this).replace(Mr,"").replace(Ur,"")}},$r);var Fr=d.bind(String.prototype.trim);var Nr=f.lastIndexOf&&"abc\u3042\u3044".lastIndexOf("\u3042\u3044",2)!==-1;P(f,{lastIndexOf:function lastIndexOf(t){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var r=o(this);var e=o(t);var n=arguments.length>1?u(arguments[1]):NaN;var i=Y(n)?Infinity:z.ToInteger(n);var a=b(w(i,0),r.length);var f=e.length;var l=a+f;while(l>0){l=w(0,l-f);var s=V(K(r,l,a+f),e);if(s!==-1){return l+s}}return-1}},Nr);var Cr=f.lastIndexOf;P(f,{lastIndexOf:function lastIndexOf(t){return Cr.apply(this,arguments)}},f.lastIndexOf.length!==1);if(parseInt(Er+"08")!==8||parseInt(Er+"0x16")!==22){parseInt=function(t){var r=/^[-+]?0[xX]/;return function parseInt(e,n){if(typeof e==="symbol"){""+e}var i=Fr(String(e));var a=u(n)||(r.test(i)?16:10);return t(i,a)}}(parseInt)}if(1/parseFloat("-0")!==-Infinity){parseFloat=function(t){return function parseFloat(r){var e=Fr(String(r));var n=t(e);return n===0&&K(e,0,1)==="-"?-0:n}}(parseFloat)}if(String(new RangeError("test"))!=="RangeError: test"){var kr=function toString(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var t=this.name;if(typeof t==="undefined"){t="Error"}else if(typeof t!=="string"){t=o(t)}var r=this.message;if(typeof r==="undefined"){r=""}else if(typeof r!=="string"){r=o(r)}if(!t){return r}if(!r){return t}return t+": "+r};Error.prototype.toString=kr}if(R){var Ar=function(t,r){if(tt(t,r)){var e=Object.getOwnPropertyDescriptor(t,r);if(e.configurable){e.enumerable=false;Object.defineProperty(t,r,e)}}};Ar(Error.prototype,"message");if(Error.prototype.message!==""){Error.prototype.message=""}Ar(Error.prototype,"name")}if(String(/a/gim)!=="/a/gim"){var Rr=function toString(){var t="/"+this.source+"/";if(this.global){t+="g"}if(this.ignoreCase){t+="i"}if(this.multiline){t+="m"}return t};RegExp.prototype.toString=Rr}});
/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.4/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){return Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.shift);var A=Math.max;var R=Math.min;var _=Math.floor;var k=Math.abs;var L=Math.exp;var F=Math.log;var D=Math.sqrt;var z=Function.call.bind(Object.prototype.hasOwnProperty);var q;var W=function(){};var G=S.Map;var H=G&&G.prototype["delete"];var V=G&&G.prototype.get;var B=G&&G.prototype.has;var U=G&&G.prototype.set;var $=S.Symbol||{};var J=$.species||"@@species";var X=Number.isNaN||function isNaN(e){return e!==e};var K=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Z=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(X(t)){return t}return t<0?-1:1};var Y=function log1p(e){var t=Number(e);if(t<-1||X(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(F(1+t)/(1+t-1))};var Q=function isArguments(e){return g(e)==="[object Arguments]"};var ee=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var te=Q(arguments)?Q:ee;var re={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var ne=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var oe=typeof $==="function"&&typeof $["for"]==="function"&&re.symbol($());var ie=re.symbol($.iterator)?$.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){ie="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ae=S.Reflect;var ue=String;var fe=typeof document==="undefined"||!document?null:document.all;var se=fe==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==fe};var ce={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!ce.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(se(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===fe},ToObject:function(e,t){return Object(ce.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return ce.IsCallable(e)},ToInt32:function(e){return ce.ToNumber(e)>>0},ToUint32:function(e){return ce.ToNumber(e)>>>0},ToNumber:function(e){if(g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=ce.ToNumber(e);if(X(t)){return 0}if(t===0||!K(t)){return t}return(t>0?1:-1)*_(k(t))},ToLength:function(e){var t=ce.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return X(e)&&X(t)},SameValueZero:function(e,t){return e===t||X(e)&&X(t)},IsIterable:function(e){return ce.TypeIsObject(e)&&(typeof e[ie]!=="undefined"||te(e))},GetIterator:function(e){if(te(e)){return new q(e,"value")}var t=ce.GetMethod(e,ie);if(!ce.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=ce.Call(t,e);if(!ce.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=ce.ToObject(e)[t];if(se(r)){return void 0}if(!ce.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=ce.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=ce.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!ce.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ce.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=ce.IteratorNext(e);var r=ce.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ae.construct){return ae.construct(e,t,o)}var i=o.prototype;if(!ce.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=ce.Call(e,a,t);return ce.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!ce.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[J];if(se(n)){return t}if(!ce.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=ce.ToString(e);var i="<"+t;if(r!==""){var a=ce.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!ce.TypeIsObject(e)){return false}var t=e[$.match];if(typeof t!=="undefined"){return!!t}return re.regex(e)},ToString:function ToString(e){return ue(e)}};if(s&&oe){var le=function defineWellKnownSymbol(e){if(re.symbol($[e])){return $[e]}var t=$["for"]("Symbol."+e);Object.defineProperty($,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!re.symbol($.search)){var pe=le("search");var ve=String.prototype.search;h(RegExp.prototype,pe,function search(e){return ce.Call(ve,e,[this])});var ye=function search(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,pe);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(ve,t,[ce.ToString(e)])};ne(String.prototype,"search",ye)}if(!re.symbol($.replace)){var he=le("replace");var be=String.prototype.replace;h(RegExp.prototype,he,function replace(e,t){return ce.Call(be,e,[this,t])});var ge=function replace(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,he);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(be,r,[ce.ToString(e),t])};ne(String.prototype,"replace",ge)}if(!re.symbol($.split)){var de=le("split");var me=String.prototype.split;h(RegExp.prototype,de,function split(e,t){return ce.Call(me,e,[this,t])});var Oe=function split(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,de);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(me,r,[ce.ToString(e),t])};ne(String.prototype,"split",Oe)}var we=re.symbol($.match);var je=we&&function(){var e={};e[$.match]=function(){return 42};return"a".match(e)!==42}();if(!we||je){var Se=le("match");var Te=String.prototype.match;h(RegExp.prototype,Se,function match(e){return ce.Call(Te,e,[this])});var Ie=function match(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,Se);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(Te,t,[ce.ToString(e)])};ne(String.prototype,"match",Ie)}}var Ee=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in W||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in W||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Pe=function(){return this};var Ce=function(e){if(s&&!z(e,J)){m.getter(e,J,Pe)}};var Me=function(e,t){var r=t||function iterator(){return this};h(e,ie,r);if(!e[ie]&&re.symbol(ie)){e[ie]=r}};var xe=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var Ne=function createDataPropertyOrThrow(e,t,r){xe(e,t,r);if(!ce.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var Ae=function(e,t,r,n){if(!ce.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!ce.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(z(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Re=String.fromCodePoint;ne(String,"fromCodePoint",function fromCodePoint(e){return ce.Call(Re,this,arguments)})}var _e={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!ce.SameValue(r,ce.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return t.join("")},raw:function raw(e){var t=ce.ToObject(e,"bad callSite");var r=ce.ToObject(t.raw,"bad raw value");var n=r.length;var o=ce.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=ce.ToString(a);s=ce.ToString(r[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=ce.ToString(f);M(i,c);a+=1}return i.join("")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){ne(String,"raw",_e.raw)}b(String,_e);var ke=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Le=Infinity;var Fe={repeat:function repeat(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);if(r<0||r>=Le){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return ke(t,r)},startsWith:function startsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=ce.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=A(ce.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=ce.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:ce.ToInteger(o);var a=R(A(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(ce.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=ce.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){ne(String.prototype,"includes",Fe.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var De=i(function(){return"/a/".startsWith(/a/)});var ze=a(function(){return"abc".startsWith("a",Infinity)===false});if(!De||!ze){ne(String.prototype,"startsWith",Fe.startsWith);ne(String.prototype,"endsWith",Fe.endsWith)}}if(oe){var qe=a(function(){var e=/a/;e[$.match]=false;return"/a/".startsWith(e)});if(!qe){ne(String.prototype,"startsWith",Fe.startsWith)}var We=a(function(){var e=/a/;e[$.match]=false;return"/a/".endsWith(e)});if(!We){ne(String.prototype,"endsWith",Fe.endsWith)}var Ge=a(function(){var e=/a/;e[$.match]=false;return"/a/".includes(e)});if(!Ge){ne(String.prototype,"includes",Fe.includes)}}b(String.prototype,Fe);var He=["\t\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var Ve=new RegExp("(^["+He+"]+)|(["+He+"]+$)","g");var Be=function trim(){return ce.ToString(ce.RequireObjectCoercible(this)).replace(Ve,"")};var Ue=["\x85","\u200b","\ufffe"].join("");var $e=new RegExp("["+Ue+"]","g");var Je=/^[-+]0x[0-9a-f]+$/i;var Xe=Ue.trim().length!==Ue.length;h(String.prototype,"trim",Be,Xe);var Ke=function(e){return{value:e,done:arguments.length===0}};var Ze=function(e){ce.RequireObjectCoercible(e);this._s=ce.ToString(e);this._i=0};Ze.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Ke()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Ke(e.substr(t,o))};Me(Ze.prototype);Me(String.prototype,function(){return new Ze(this)});var Ye={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!ce.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(te(e)||ce.GetMethod(e,ie))!=="undefined";var u,f,s;if(a){f=ce.IsConstructor(r)?Object(new r):[];var c=ce.GetIterator(e);var l,p;s=0;while(true){l=ce.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){ce.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=ce.ToObject(e);u=ce.ToLength(y.length);f=ce.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i==="undefined"?n(h,s):t(n,i,h,s)}Ne(f,s,h)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!ce.IsCallable(t)?new Array(e):ce.Construct(t,[e]);for(var o=0;o<e;++o){Ne(n,o,arguments[o])}n.length=e;return n}};b(Array,Ye);Ce(Array);q=function(e,t){this.i=0;this.array=e;this.kind=t};b(q.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof q)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=ce.ToLength(t.length);for(;e<r;e++){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Ke(o)}}this.array=void 0;return Ke()}});Me(q.prototype);var Qe=Array.of===Ye.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!Qe){ne(Array,"of",Ye.of)}var et={copyWithin:function copyWithin(e,t){var r=ce.ToObject(this);var n=ce.ToLength(r.length);var o=ce.ToInteger(e);var i=ce.ToInteger(t);var a=o<0?A(n+o,0):R(o,n);var u=i<0?A(n+i,0):R(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:ce.ToInteger(f);var c=s<0?A(n+s,0):R(s,n);var l=R(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=ce.ToObject(this);var o=ce.ToLength(n.length);t=ce.ToInteger(typeof t==="undefined"?0:t);r=ce.ToInteger(typeof r==="undefined"?o:r);var i=t<0?A(o+t,0):R(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new q(this,"key")},values:function values(){return new q(this,"value")},entries:function entries(){return new q(this,"entry")}};if(Array.prototype.keys&&!ce.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!ce.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ie]){b(Array.prototype,{values:Array.prototype[ie]});if(re.symbol($.unscopables)){Array.prototype[$.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var tt=Array.prototype.values;ne(Array.prototype,"values",function values(){return ce.Call(tt,this,arguments)});h(Array.prototype,ie,Array.prototype.values,true)}b(Array.prototype,et);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}Me(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){Me(Object.getPrototypeOf([].values()))}var rt=function(){return a(function(){return Array.from({length:-1}).length===0})}();var nt=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!rt||!nt){ne(Array,"from",Ye.from)}var ot=function(){return a(function(){return Array.from([0],void 0)})}();if(!ot){var it=Array.from;ne(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return ce.Call(it,this,arguments)}else{return t(it,this,e)}})}var at=-(Math.pow(2,32)-1);var ut=function(e,r){var n={length:at};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!ut(Array.prototype.forEach)){var ft=Array.prototype.forEach;ne(Array.prototype,"forEach",function forEach(e){return ce.Call(ft,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.map)){var st=Array.prototype.map;ne(Array.prototype,"map",function map(e){return ce.Call(st,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.filter)){var ct=Array.prototype.filter;ne(Array.prototype,"filter",function filter(e){return ce.Call(ct,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.some)){var lt=Array.prototype.some;ne(Array.prototype,"some",function some(e){return ce.Call(lt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.every)){var pt=Array.prototype.every;ne(Array.prototype,"every",function every(e){return ce.Call(pt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduce)){var vt=Array.prototype.reduce;ne(Array.prototype,"reduce",function reduce(e){return ce.Call(vt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduceRight,true)){var yt=Array.prototype.reduceRight;ne(Array.prototype,"reduceRight",function reduceRight(e){return ce.Call(yt,this.length>=0?this:[],arguments)},true)}var ht=Number("0o10")!==8;var bt=Number("0b10")!==2;var gt=y(Ue,function(e){return Number(e+0+e)===0});if(ht||bt||gt){var dt=Number;var mt=/^0b[01]+$/i;var Ot=/^0o[0-7]+$/i;var wt=mt.test.bind(mt);var jt=Ot.test.bind(Ot);var St=function(e){var t;if(typeof e.valueOf==="function"){t=e.valueOf();if(re.primitive(t)){return t}}if(typeof e.toString==="function"){t=e.toString();if(re.primitive(t)){return t}}throw new TypeError("No default value")};var Tt=$e.test.bind($e);var It=Je.test.bind(Je);var Et=function(){var e=function Number(t){var r;if(arguments.length>0){r=re.primitive(t)?t:St(t,"number")}else{r=0}if(typeof r==="string"){r=ce.Call(Be,r);if(wt(r)){r=parseInt(C(r,2),2)}else if(jt(r)){r=parseInt(C(r,2),8)}else if(Tt(r)||It(r)){r=NaN}}var n=this;var o=a(function(){dt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new dt(r)}return dt(r)};return e}();Ee(dt,Et,{});b(Et,{NaN:dt.NaN,MAX_VALUE:dt.MAX_VALUE,MIN_VALUE:dt.MIN_VALUE,NEGATIVE_INFINITY:dt.NEGATIVE_INFINITY,POSITIVE_INFINITY:dt.POSITIVE_INFINITY});Number=Et;m.redefine(S,"Number",Et)}var Pt=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Pt,MIN_SAFE_INTEGER:-Pt,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:K,isInteger:function isInteger(e){return K(e)&&ce.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&k(e)<=Number.MAX_SAFE_INTEGER},isNaN:X});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){ne(Array.prototype,"find",et.find)}if([,1].findIndex(function(){return true})!==0){ne(Array.prototype,"findIndex",et.findIndex)}var Ct=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Mt=function ensureEnumerable(e,t){if(s&&Ct(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var xt=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var Nt=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var At=function(e,t){var r=n(Object(t));var o;if(ce.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),Ct(t))}return p(P(r,o||[]),Nt(t),e)};var Rt={assign:function(e,t){var r=ce.ToObject(e,"Cannot convert undefined or null to object");return p(ce.Call(xt,1,arguments),At,r)},is:function is(e,t){return ce.SameValue(e,t)}};var _t=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(_t){ne(Object,"assign",Rt.assign)}b(Object,Rt);if(s){var kt={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!ce.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||ce.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(a){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,"__proto__")};b(Object,kt)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Lt=!i(function(){return Object.keys("foo")});if(!Lt){var Ft=Object.keys;ne(Object,"keys",function keys(e){return Ft(ce.ToObject(e))});n=Object.keys}var Dt=i(function(){return Object.keys(/a/g)});if(Dt){var zt=Object.keys;ne(Object,"keys",function keys(e){if(re.regex(e)){var t=[];for(var r in e){if(z(e,r)){M(t,r)}}return t}return zt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var qt=!i(function(){return Object.getOwnPropertyNames("foo")});if(!qt){var Wt=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Gt=Object.getOwnPropertyNames;ne(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=ce.ToObject(e);if(g(t)==="[object Window]"){try{return Gt(t)}catch(r){return P([],Wt)}}return Gt(t)})}}if(Object.getOwnPropertyDescriptor){var Ht=!i(function(){return Object.getOwnPropertyDescriptor("foo","bar")});if(!Ht){var Vt=Object.getOwnPropertyDescriptor;ne(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Vt(ce.ToObject(e),t)})}}if(Object.seal){var Bt=!i(function(){return Object.seal("foo")});if(!Bt){var Ut=Object.seal;ne(Object,"seal",function seal(e){if(!ce.TypeIsObject(e)){return e}return Ut(e)})}}if(Object.isSealed){var $t=!i(function(){return Object.isSealed("foo")});if(!$t){var Jt=Object.isSealed;ne(Object,"isSealed",function isSealed(e){if(!ce.TypeIsObject(e)){return true}return Jt(e)})}}if(Object.freeze){var Xt=!i(function(){return Object.freeze("foo")});if(!Xt){var Kt=Object.freeze;ne(Object,"freeze",function freeze(e){if(!ce.TypeIsObject(e)){return e}return Kt(e)})}}if(Object.isFrozen){var Zt=!i(function(){return Object.isFrozen("foo")});if(!Zt){var Yt=Object.isFrozen;ne(Object,"isFrozen",function isFrozen(e){if(!ce.TypeIsObject(e)){return true}return Yt(e)})}}if(Object.preventExtensions){var Qt=!i(function(){return Object.preventExtensions("foo")});if(!Qt){var er=Object.preventExtensions;ne(Object,"preventExtensions",function preventExtensions(e){if(!ce.TypeIsObject(e)){return e}return er(e)})}}if(Object.isExtensible){var tr=!i(function(){return Object.isExtensible("foo")});if(!tr){var rr=Object.isExtensible;ne(Object,"isExtensible",function isExtensible(e){if(!ce.TypeIsObject(e)){return false}return rr(e)})}}if(Object.getPrototypeOf){var nr=!i(function(){return Object.getPrototypeOf("foo")});if(!nr){var or=Object.getPrototypeOf;ne(Object,"getPrototypeOf",function getPrototypeOf(e){return or(ce.ToObject(e))})}}var ir=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&ce.IsCallable(e.get)}();if(s&&!ir){var ar=function flags(){if(!ce.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",ar)}var ur=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var fr=oe&&s&&function(){var e=/./;e[$.match]=false;return RegExp(e)===e}();var sr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var cr=sr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!sr||!cr){var lr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=ce.RequireObjectCoercible(this);if(re.regex(e)){return t(lr,e)}var r=ue(e.source);var n=ue(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,lr)}if(s&&(!ur||fr)){var pr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var vr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var yr=function(){return this.source};var hr=ce.IsCallable(vr.get)?vr.get:yr;var br=RegExp;var gr=function(){return function RegExp(e,t){var r=ce.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(re.regex(e)){o=ce.Call(hr,e);i=typeof t==="undefined"?ce.Call(pr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new br(e,t)}}();Ee(br,gr,{$input:true});RegExp=gr;m.redefine(S,"RegExp",gr)}if(s){var dr={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(dr),function(e){if(e in RegExp&&!(dr[e]in RegExp)){m.getter(RegExp,dr[e],function get(){return RegExp[e]})}})}Ce(RegExp);var mr=1/Number.EPSILON;var Or=function roundTiesToEven(e){return e+mr-mr};var wr=Math.pow(2,-23);var jr=Math.pow(2,127)*(2-wr);var Sr=Math.pow(2,-126);var Tr=Math.E;var Ir=Math.LOG2E;var Er=Math.LOG10E;var Pr=Number.prototype.clz;delete Number.prototype.clz;var Cr={acosh:function acosh(e){var t=Number(e);if(X(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}var r=1/(t*t);if(t<2){return Y(t-1+D(1-r)*t)}var n=t/2;return Y(n+D(1-r)*n-1)+1/Ir},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}var r=k(t);var n=r*r;var o=Z(t);if(r<1){return o*Y(r+n/(D(n+1)+1))}return o*(Y(r/2+D(1+1/n)*r/2-1)+1/Ir)},atanh:function atanh(e){var t=Number(e);if(t===0){return t}if(t===-1){return-Infinity}if(t===1){return Infinity}if(X(t)||t<-1||t>1){return NaN}var r=k(t);return Z(t)*Y(2*r/(1-r))/2},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=L(F(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=ce.ToUint32(t);if(r===0){return 32}return Pr?ce.Call(Pr,r):31-_(F(r+.5)*Ir)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(X(t)){return NaN}if(!T(t)){return Infinity}var r=L(k(t)-1);return(r+1/(r*Tr*Tr))*(Tr/2)},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(k(t)>.5){return L(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=k(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*D(r)},log2:function log2(e){return F(e)*Ir},log10:function log10(e){return F(e)*Er},log1p:Y,sign:Z,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}var r=k(t);if(r<1){var n=Math.expm1(r);return Z(t)*n*(1+1/(n+1))/2}var o=L(r-1);return Z(t)*(o-1/(o*Tr*Tr))*(Tr/2)},tanh:function tanh(e){var t=Number(e);if(X(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(L(t)+L(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-_(-t):_(t)},imul:function imul(e,t){var r=ce.ToUint32(e);var n=ce.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||X(t)){return t}var r=Z(t);var n=k(t);if(n<Sr){return r*Or(n/Sr/wr)*Sr*wr}var o=(1+wr/Number.EPSILON)*n;var i=o-(o-n);if(i>jr||X(i)){return r*Infinity}return r*i}};var Mr=function withinULPDistance(e,t,r){return k(1-e/t)/Number.EPSILON<(r||8)};b(Math,Cr);h(Math,"sinh",Cr.sinh,Math.sinh(710)===Infinity);h(Math,"cosh",Cr.cosh,Math.cosh(710)===Infinity);h(Math,"log1p",Cr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",Cr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));h(Math,"asinh",Cr.asinh,Math.asinh(1e300)===Infinity);h(Math,"atanh",Cr.atanh,Math.atanh(1e-300)===0);h(Math,"tanh",Cr.tanh,Math.tanh(-2e-17)!==-2e-17);
h(Math,"acosh",Cr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"acosh",Cr.acosh,!Mr(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON)));h(Math,"cbrt",Cr.cbrt,!Mr(Math.cbrt(1e-300),1e-100));h(Math,"sinh",Cr.sinh,Math.sinh(-2e-17)!==-2e-17);var xr=Math.expm1(10);h(Math,"expm1",Cr.expm1,xr>22025.465794806718||xr<22025.465794806718);var Nr=Math.round;var Ar=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var Rr=mr+1;var _r=2*mr-1;var kr=[Rr,_r].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=_(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!Ar||!kr);m.preserveToString(Math.round,Nr);var Lr=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=Cr.imul;m.preserveToString(Math.imul,Lr)}if(Math.imul.length!==2){ne(Math,"imul",function imul(e,t){return ce.Call(Lr,Math,arguments)})}var Fr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}ce.IsPromise=function(e){if(!ce.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!ce.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(ce.IsCallable(t.resolve)&&ce.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&ce.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=N(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=ce.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(ce.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!ce.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return m(e,o)}if(!ce.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!ce.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=Ae(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=ce.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=ce.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(ce.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{"catch":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!ce.IsPromise(n)){throw new TypeError("not a promise")}var o=ce.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=ce.IsCallable(e)?e:a;var d=ce.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof Fr==="function"){b(S,{Promise:Fr});var Dr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var zr=!i(function(){return S.Promise.reject(42).then(null,5).then(null,W)});var qr=i(function(){return S.Promise.call(3,W)});var Wr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,W).then(null,W)}catch(n){return true}return t===r}(S.Promise);var Gr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Hr=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Hr.prototype=Promise.prototype;Hr.all=Promise.all;var Vr=a(function(){return!!Hr.all([1,2])});if(!Dr||!zr||!qr||Wr||!Gr||Vr){Promise=Fr;ne(S,"Promise",Fr)}if(Promise.all.length!==1){var Br=Promise.all;ne(Promise,"all",function all(e){return ce.Call(Br,this,arguments)})}if(Promise.race.length!==1){var Ur=Promise.race;ne(Promise,"race",function race(e){return ce.Call(Ur,this,arguments)})}if(Promise.resolve.length!==1){var $r=Promise.resolve;ne(Promise,"resolve",function resolve(e){return ce.Call($r,this,arguments)})}if(Promise.reject.length!==1){var Jr=Promise.reject;ne(Promise,"reject",function reject(e){return ce.Call(Jr,this,arguments)})}Mt(Promise,"all");Mt(Promise,"race");Mt(Promise,"resolve");Mt(Promise,"reject");Ce(Promise)}var Xr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Kr=Xr(["z","a","bb"]);var Zr=Xr(["z",1,"a","3",2]);if(s){var Yr=function fastkey(e,t){if(!t&&!Kr){return null}if(se(e)){return"^"+ce.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Zr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var Qr=function emptyObject(){return Object.create?Object.create(null):{}};var en=function addIterableToMap(e,n,o){if(r(o)||re.string(o)){l(o,function(e){if(!ce.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!se(o)){a=n.set;if(!ce.IsCallable(a)){throw new TypeError("bad map")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!ce.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(s){ce.IteratorClose(i,true);throw s}}}}};var tn=function addIterableToSet(e,n,o){if(r(o)||re.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!se(o)){a=n.add;if(!ce.IsCallable(a)){throw new TypeError("bad set")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){ce.IteratorClose(i,true);throw s}}}}};var rn={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!ce.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+ce.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");this.head=e._head;this.i=this.head;this.kind=t};i.prototype={isMapIterator:true,next:function next(){if(!this.isMapIterator){throw new TypeError("Not a MapIterator")}var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Ke()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Ke(n)}}this.i=void 0;return Ke()}};Me(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=Ae(this,Map,a,{_es6map:true,_head:null,_map:G?new G:null,_size:0,_storage:Qr()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){en(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=Yr(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}else{return}}if(this._map){t=V.call(this._map,e);if(t){return t.value}else{return}}var n=this._head;var i=n;while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=Yr(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return B.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(ce.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=Yr(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}else{a=this._storage[u]=new r(e,t);i=n.prev}}else if(this._map){if(B.call(this._map,e)){V.call(this._map,e).value=t}else{a=new r(e,t);U.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(ce.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},"delete":function(t){o(this,"delete");var r=this._head;var n=r;var i=Yr(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!B.call(this._map,t)){return false}n=V.call(this._map,t).prev;H.call(this._map,t)}while((n=n.next)!==r){if(ce.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=G?new G:null;this._size=0;this._storage=Qr();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});Me(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!ce.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+ce.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=Ae(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:Qr()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){tn(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}else{var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new rn.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=Yr(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=Yr(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},"delete":function(e){r(this,"delete");var t;if(this._storage&&(t=Yr(e))!==null){var n=z(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=Qr()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return new f(this["[[SetData]]"].values())},entries:function entries(){r(this,"entries");u(this);return new f(this["[[SetData]]"].entries())},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);Me(i.prototype,i.prototype.values);var f=function SetIterator(e){this.it=e};f.prototype={isSetIterator:true,next:function next(){if(!this.isSetIterator){throw new TypeError("Not a SetIterator")}return this.it.next()}};Me(f.prototype);return i}()};var nn=S.Set&&!Set.prototype["delete"]&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys);if(nn){S.Set=rn.Set}if(S.Map||S.Set){var on=a(function(){return new Map([[1,2]]).get(1)===2});if(!on){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(G.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var an=new Map;var un=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var fn=an.set(1,2)===an;if(!un||!fn){ne(Map.prototype,"set",function set(e,r){t(U,this,e===0?0:e,r);return this})}if(!un){b(Map.prototype,{get:function get(e){return t(V,this,e===0?0:e)},has:function has(e){return t(B,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,V);m.preserveToString(Map.prototype.has,B)}var sn=new Set;var cn=Set.prototype["delete"]&&Set.prototype.add&&Set.prototype.has&&function(e){e["delete"](0);e.add(-0);return!e.has(0)}(sn);var ln=sn.add(1)===sn;if(!cn||!ln){var pn=Set.prototype.add;Set.prototype.add=function add(e){t(pn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,pn)}if(!cn){var vn=Set.prototype.has;Set.prototype.has=function has(e){return t(vn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,vn);var yn=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(yn,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],yn)}var hn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var bn=Object.setPrototypeOf&&!hn;var gn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||bn||!gn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=G.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var dn=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var mn=Object.setPrototypeOf&&!dn;var On=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||mn||!On){var wn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new wn;if(arguments.length>0){tn(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=wn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,wn)}var jn=new S.Map;var Sn=!a(function(){return jn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||jn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof jn.keys().next!=="function"||Sn||!hn){b(S,{Map:rn.Map,Set:rn.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}Me(Object.getPrototypeOf((new S.Map).keys()));Me(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var Tn=S.Set.prototype.has;ne(S.Set.prototype,"has",function has(e){return t(Tn,this,e)})}}b(S,rn);Ce(S.Map);Ce(S.Set)}var In=function throwUnlessTargetIsObject(e){if(!ce.TypeIsObject(e)){throw new TypeError("target must be an object")}};var En={apply:function apply(){return ce.Call(ce.Call,null,arguments)},construct:function construct(e,t){if(!ce.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!ce.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return ce.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){In(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){In(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(En,{ownKeys:function ownKeys(e){In(e);var t=Object.getOwnPropertyNames(e);if(ce.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Pn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(En,{isExtensible:function isExtensible(e){In(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){In(e);return Pn(function(){return Object.preventExtensions(e)})}})}if(s){var Cn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return Cn(o,t,r)}if("value"in n){return n.value}if(n.get){return ce.Call(n.get,r)}return void 0};var Mn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return Mn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!ce.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ae.defineProperty(o,r,{value:n})}else{return ae.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(i.set){t(i.set,o,n);return true}return false};Object.assign(En,{defineProperty:function defineProperty(e,t,r){In(e);return Pn(function(){return Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){In(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){In(e);var r=arguments.length>2?arguments[2]:e;return Cn(e,t,r)},set:function set(e,t,r){In(e);var n=arguments.length>3?arguments[3]:e;return Mn(e,t,r,n)}})}if(Object.getPrototypeOf){var xn=Object.getPrototypeOf;En.getPrototypeOf=function getPrototypeOf(e){In(e);return xn(e)}}if(Object.setPrototypeOf&&En.getPrototypeOf){var Nn=function(e,t){var r=t;while(r){if(e===r){return true}r=En.getPrototypeOf(r)}return false};Object.assign(En,{setPrototypeOf:function setPrototypeOf(e,t){In(e);if(t!==null&&!ce.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ae.getPrototypeOf(e)){return true}if(ae.isExtensible&&!ae.isExtensible(e)){return false}if(Nn(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var An=function(e,t){if(!ce.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){ne(S.Reflect,e,t)}}};Object.keys(En).forEach(function(e){An(e,En[e])});var Rn=S.Reflect.getPrototypeOf;if(c&&Rn&&Rn.name!=="getPrototypeOf"){ne(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(Rn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){ne(S.Reflect,"setPrototypeOf",En.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){ne(S.Reflect,"defineProperty",En.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){ne(S.Reflect,"construct",En.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var _n=Date.prototype.toString;var kn=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return ce.Call(_n,this)};ne(Date.prototype,"toString",kn)}var Ln={anchor:function anchor(e){return ce.CreateHTML(this,"a","name",e)},big:function big(){return ce.CreateHTML(this,"big","","")},blink:function blink(){return ce.CreateHTML(this,"blink","","")},bold:function bold(){return ce.CreateHTML(this,"b","","")},fixed:function fixed(){return ce.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return ce.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return ce.CreateHTML(this,"font","size",e)},italics:function italics(){return ce.CreateHTML(this,"i","","")},link:function link(e){return ce.CreateHTML(this,"a","href",e)},small:function small(){return ce.CreateHTML(this,"small","","")},strike:function strike(){return ce.CreateHTML(this,"strike","","")},sub:function sub(){return ce.CreateHTML(this,"sub","","")},sup:function sub(){return ce.CreateHTML(this,"sup","","")}};l(Object.keys(Ln),function(e){var r=String.prototype[e];var n=false;if(ce.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){ne(String.prototype,e,Ln[e])}});var Fn=function(){if(!oe){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e($())!=="undefined"){return true}if(e([$()])!=="[null]"){return true}var t={a:$()};t[$()]=true;if(e(t)!=="{}"){return true}return false}();var Dn=a(function(){if(!oe){return true}return JSON.stringify(Object($()))==="{}"&&JSON.stringify([Object($())])==="[{}]"});if(Fn||!Dn){var zn=JSON.stringify;ne(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=ce.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(re.symbol(n)){return Nt({})(n)}else{return n}}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return zn.apply(this,o)})}return S});
/*! jQuery v3.6.0 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.6.0",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:f,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||S.isPlainObject(n)?n:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=S)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return g(t.replace($,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(B," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,"$1"));return s[S]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[S]?i.push(a):o.push(a);(a=A(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split("").sort(j).join("")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);S.find=d,S.expr=d.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=d.uniqueSort,S.text=d.getText,S.isXMLDoc=d.isXML,S.contains=d.contains,S.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,D=S(E);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){var n;while(-1<(n=S.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),S.ready()}S.fn.ready=function(e){return F.then(e)["catch"](function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var $=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(S(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||S.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):$(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=S.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,"")},u=s(),l=n&&n[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=E.createDocumentFragment().appendChild(E.createElement("div")),(fe=E.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),y.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",y.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ee(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,we)}S.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=S.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=S.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Se(this,e,Ce),!1},trigger:function(){return Se(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return Ee(this,e,t,n,r)},one:function(e,t,n,r){return Ee(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){S.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=S.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return $(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Re=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Me=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ie=new RegExp(ne.join("|"),"i");function We(e,t,n){var r,i,o,a,s=e.style;return(n=n||Re(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&Pe.test(a)&&Ie.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Fe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement("div"),l=E.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=E.createElement("table"),t=E.createElement("tr"),n=E.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var Be=["Webkit","Moz","ms"],$e=E.createElement("div").style,_e={};function ze(e){var t=S.cssProps[e]||_e[e];return t||(e in $e?e:_e[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Be.length;while(n--)if((e=Be[n]+t)in $e)return e}(e)||e)}var Ue=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ve={position:"absolute",visibility:"hidden",display:"block"},Ge={letterSpacing:"0",fontWeight:"400"};function Ye(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Qe(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=S.css(e,"border"+ne[a]+"Width",!0,i))):(u+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=S.css(e,"border"+ne[a]+"Width",!0,i):s+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Je(e,t,n){var r=Re(e),i=(!y.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),o=i,a=We(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Qe(e,t,n||(i?"border":"content"),o,r,a)+"px"}function Ke(e,t,n,r,i){return new Ke.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=We(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Xe.test(t),l=e.style;if(u||(t=ze(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Xe.test(t)||(t=ze(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=We(e,t,r)),"normal"===i&&t in Ge&&(i=Ge[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ue.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,u,n):Me(e,Ve,function(){return Je(e,u,n)})},set:function(e,t,n){var r,i=Re(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===S.css(e,"boxSizing",!1,i),s=n?Qe(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Qe(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),Ye(0,t,s)}}}),S.cssHooks.marginLeft=Fe(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(We(e,"marginLeft"))||e.getBoundingClientRect().left-Me(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+o].set=Ye)}),S.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Re(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=Ke).prototype={constructor:Ke,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?"":"px")},cur:function(){var e=Ke.propHooks[this.prop];return e&&e.get?e.get(this):Ke.propHooks._default.get(this)},run:function(e){var t,n=Ke.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ke.propHooks._default.set(this),this}}).init.prototype=Ke.prototype,(Ke.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ze(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ke.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=Ke.prototype.init,S.fx.step={};var Ze,et,tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){et&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(ot):C.setTimeout(ot,S.fx.interval),S.fx.tick())}function at(){return C.setTimeout(function(){Ze=void 0}),Ze=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(o,e,t){var n,a,r=0,i=lt.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=Ze||at(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:Ze||at(),duration:t.duration,tweens:[],createTween:function(e,t){var n=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=lt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ut,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)S.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),o=S.speed(e,n,r),a=function(){var e=lt(this,S.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&it.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(st(r,!0),e,t,n)}}),S.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(Ze=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),Ze=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){et||(et=!0,ot())},S.fx.stop=function(){et=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},tt=E.createElement("input"),nt=E.createElement("select").appendChild(E.createElement("option")),tt.type="checkbox",y.checkOn=""!==tt.value,y.optSelected=nt.selected,(tt=E.createElement("input")).value="t",tt.type="radio",y.radioValue="t"===tt.value;var ct,ft=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return $(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=ft[t]||S.find.attr;ft[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ft[o],ft[o]=r,r=null!=a(e,t,n)?o:null,ft[o]=i),r}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return $(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,gt(this)))});if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,gt(this)))});if(!arguments.length)return this.attr("class","");if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,gt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=S(this),r=vt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=gt(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Y.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+ht(gt(n))+" ").indexOf(t))return!0;return!1}});var yt=/\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,S(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(yt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:ht(S.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=S(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=S.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,mt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,xt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,xt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){S.event.simulate(r,e.target,S.event.fix(e))};S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var bt=C.location,wt={guid:Date.now()},Tt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(n,e,r,i){var t;if(Array.isArray(e))S.each(e,function(e,t){r||Ct.test(n)?i(n,t):At(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)At(n+"["+t+"]",e[t],r,i)}S.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=E.createElement("a");function It(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Wt(t,i,o,a){var s={},u=t===Pt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Ft(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&S.extend(!0,e,r),e}Mt.href=bt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,S.ajaxSettings),t):Ft(S.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=S.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=qt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||bt.href)+"").replace(Ht,bt.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Mt.protocol+"//"+Mt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Wt(Ot,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Lt.test(v.type),f=v.url.replace(jt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Nt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Tt.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Dt,"$1"),o=(Tt.test(f)?"&":"?")+"_="+wt.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader("If-Modified-Since",S.lastModified[f]),S.etag[f]&&T.setRequestHeader("If-None-Match",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Rt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Wt(Pt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<S.inArray("script",v.dataTypes)&&S.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(S.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(S.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--S.active||S.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=S.ajaxSettings.xhr();y.cors=!!$t&&"withCredentials"in $t,y.ajax=$t=!!$t,S.ajaxTransport(function(i){var o,a;if(y.cors||$t&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Bt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var _t,zt=[],Ut=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||S.expando+"_"+wt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Ut.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ut,"$1"+r):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,zt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((_t=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var r,i,o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=ht(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=S.css(e,"position"),c=S(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),u=S.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,S.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===S.css(e,"position"))e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return $(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=Fe(y.pixelPosition,function(e,t){if(t)return t=We(e,n),Pe.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return $(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Xt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Xt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var Vt=C.jQuery,Gt=C.$;return S.noConflict=function(e){return C.$===S&&(C.$=Gt),e&&C.jQuery===S&&(C.jQuery=Vt),S},"undefined"==typeof e&&(C.jQuery=C.$=S),S});
/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
/*!
 * imagesLoaded PACKAGED v4.1.4
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */
!function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},n=i[e]=i[e]||[];return n.indexOf(t)==-1&&n.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{},n=i[e]=i[e]||{};return n[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=i.indexOf(t);return n!=-1&&i.splice(n,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){i=i.slice(0),t=t||[];for(var n=this._onceEvents&&this._onceEvents[e],o=0;o<i.length;o++){var r=i[o],s=n&&n[r];s&&(this.off(e,r),delete n[r]),r.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.imagesLoaded=t(e,e.EvEmitter)}("undefined"!=typeof window?window:this,function(e,t){function i(e,t){for(var i in t)e[i]=t[i];return e}function n(e){if(Array.isArray(e))return e;var t="object"==typeof e&&"number"==typeof e.length;return t?d.call(e):[e]}function o(e,t,r){if(!(this instanceof o))return new o(e,t,r);var s=e;return"string"==typeof e&&(s=document.querySelectorAll(e)),s?(this.elements=n(s),this.options=i({},this.options),"function"==typeof t?r=t:i(this.options,t),r&&this.on("always",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(this.check.bind(this))):void a.error("Bad element for imagesLoaded "+(s||e))}function r(e){this.img=e}function s(e,t){this.url=e,this.element=t,this.img=new Image}var h=e.jQuery,a=e.console,d=Array.prototype.slice;o.prototype=Object.create(t.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),this.options.background===!0&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&u[t]){for(var i=e.querySelectorAll("img"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if("string"==typeof this.options.background){var r=e.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var u={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(t.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,e),n=i.exec(t.backgroundImage)}},o.prototype.addImage=function(e){var t=new r(e);this.images.push(t)},o.prototype.addBackground=function(e,t){var i=new s(e,t);this.images.push(i)},o.prototype.check=function(){function e(e,i,n){setTimeout(function(){t.progress(e,i,n)})}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once("progress",e),t.check()}):void this.complete()},o.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,e,t)},o.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},r.prototype=Object.create(t.prototype),r.prototype.check=function(){var e=this.getIsImageComplete();return e?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},r.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var e=this.getIsImageComplete();e&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},o.makeJQueryPlugin=function(t){t=t||e.jQuery,t&&(h=t,h.fn.imagesLoaded=function(e,t){var i=new o(this,e,t);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});
/*! lz-string-1.3.3-min.js | (c) 2013 Pieroxy | Licensed under a WTFPL license */
var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return"";var t="";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return"";var t="",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return"";var t="",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return"";var t="",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compress:function(e){if(e==null)return"";var t,n,r={},i={},s="",o="",u="",a=2,f=3,l=2,c="",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==""){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return"";if(e=="")return null;var t=[],n,r=4,i=4,s=3,o="",u="",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return""}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return""}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/dist/FileSaver.js */
(function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){"use strict";function b(a,b){return"undefined"==typeof b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error("could not download file")},d.send()}function d(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","string"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target="_blank")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:"msSaveOrOpenBlob"in navigator?function(f,g,h){if(g=g||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement("a");i.href=f,i.target="_blank",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open("","_blank"),g&&(g.document.title=g.document.body.innerText="downloading..."),"string"==typeof b)return c(b,d,e);var h="application/octet-stream"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&"undefined"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,"undefined"!=typeof module&&(module.exports=g)});
/*! seedrandom.js v2.3.3 | (c) 2013 David Bau, all rights reserved. | Licensed under a BSD-style license */
!function(a,b,c,d,e,f,g,h,i){function j(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=r&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=r&f+1],c=c*d+h[r&(h[f]=h[g=r&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function k(a,b){var c,d=[],e=typeof a;if(b&&"object"==e)for(c in a)try{d.push(k(a[c],b-1))}catch(f){}return d.length?d:"string"==e?a:a+"\0"}function l(a,b){for(var c,d=a+"",e=0;e<d.length;)b[r&e]=r&(c^=19*b[r&e])+d.charCodeAt(e++);return n(b)}function m(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),n(c)}catch(e){return[+new Date,a,(c=a.navigator)&&c.plugins,a.screen,n(b)]}}function n(a){return String.fromCharCode.apply(0,a)}var o=c.pow(d,e),p=c.pow(2,f),q=2*p,r=d-1,s=c["seed"+i]=function(a,f,g){var h=[],r=l(k(f?[a,n(b)]:null==a?m():a,3),h),s=new j(h);return l(n(s.S),b),(g||function(a,b,d){return d?(c[i]=a,b):a})(function(){for(var a=s.g(e),b=o,c=0;p>a;)a=(a+c)*d,b*=d,c=s.g(1);for(;a>=q;)a/=2,b/=2,c>>>=1;return(a+c)/b},r,this==c)};l(c[i](),b),g&&g.exports?g.exports=s:h&&h.amd&&h(function(){return s})}(this,[],Math,256,6,52,"object"==typeof module&&module,"function"==typeof define&&define,"random");
/*! console_hack.js | (c) 2015 Thomas Michael Edwards | Licensed under SugarCube's Simple BSD license */
!function(){for(var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],length=methods.length,noop=function(){},console=window.console=window.console||{};length--;){var method=methods[length];console[method]||(console[method]=noop)}}();
}else{document.documentElement.setAttribute("data-init", "lacking");}
</script>
<style id="style-normalize" type="text/css">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}</style>
<style id="style-init-screen" type="text/css">@-webkit-keyframes init-loading-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes init-loading-spin{0%{-o-transform:rotate(0);transform:rotate(0)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes init-loading-spin{0%{-webkit-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}#init-screen{display:none;z-index:500000;position:fixed;top:0;left:0;height:100%;width:100%;font:28px/1 Helmet,Freesans,sans-serif;font-weight:700;color:#eee;background-color:#111;text-align:center}#init-screen>div{display:none;position:relative;margin:0 auto;max-width:1136px;top:25%}html[data-init=lacking] #init-screen,html[data-init=loading] #init-screen,html[data-init=no-js] #init-screen{display:block}html[data-init=lacking] #init-lacking,html[data-init=no-js] #init-no-js{display:block;padding:0 1em}html[data-init=no-js] #init-no-js{color:red}html[data-init=loading] #init-loading{display:block;border:24px solid transparent;border-radius:50%;border-top-color:#7f7f7f;border-bottom-color:#7f7f7f;width:100px;height:100px;-webkit-animation:init-loading-spin 2s linear infinite;-o-animation:init-loading-spin 2s linear infinite;animation:init-loading-spin 2s linear infinite}html[data-init=loading] #init-loading>div{text-indent:9999em;overflow:hidden;white-space:nowrap}html[data-init=loading] #passages,html[data-init=loading] #ui-bar{display:none}</style>
<style id="style-font" type="text/css">@font-face{font-family:tme-fa-icons;src:url('data:application/octet-stream;base64,d09GRgABAAAAADLAAA8AAAAAWHgAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABWAAAADsAAABUIIslek9TLzIAAAGUAAAAQwAAAFY+IEkIY21hcAAAAdgAAAG8AAAF3rob9jFjdnQgAAADlAAAABMAAAAgBtX/BGZwZ20AAAOoAAAFkAAAC3CKkZBZZ2FzcAAACTgAAAAIAAAACAAAABBnbHlmAAAJQAAAI6gAADv+gJOpzGhlYWQAACzoAAAAMwAAADYY1IZaaGhlYQAALRwAAAAgAAAAJAfCBClobXR4AAAtPAAAAJEAAAFMBfb/0WxvY2EAAC3QAAAAqAAAAKhjiHI5bWF4cAAALngAAAAgAAAAIAFjDA9uYW1lAAAumAAAAY0AAAL94+zEpHBvc3QAADAoAAACHAAAA11cG/YjcHJlcAAAMkQAAAB6AAAAhuVBK7x4nGNgZGBg4GIwYLBjYHJx8wlh4MtJLMljkGJgYYAAkDwymzEnMz2RgQPGA8qxgGkOIGaDiAIAJjsFSAB4nGNgZNZgnMDAysDAVMW0h4GBoQdCMz5gMGRkAooysDIzYAUBaa4pDA4vGF4EMgf9z2KIYg5imAYUZgTJAQDSIQumAHic7dTVbltRAETR7dpNCikzQ8rMzMxt/M39mHnsU1/TfZz5jFpaV7pXJunMDLAZmOqaZjD5y4Tx+uPTyeL5lG2L5zN+L94zG8+ztr7ulXH1fra4bvK9M79xiWW2sNXPbWeFHexkF7vZw172sZ8DHOQQhznCUY5xnBOc5BSnOcNZVjnHeS5wkUtc5gpX/f3r3OAmt7jNHe5yj/s84CGPeMwTnvKM57zgJa94zRve8o73fOAjn/jMF77yje/84Ce/WGPun1zi/2tlXKbp3Xyc44bFyZanSWokJDXOOjXSk/LUSXn+pEwCKTNBaqQqZU5IjX+XMjukTBEp80TKZJEyY6RMGylzR8oEkjKLpEwlKfNJyqSSMrOkTC8pc0zKRJMy26RMOSnzTsrkk7IDpGwDKXtByoaQsiukbA0p+0PKJpGyU6RsFyl7RmosQcrukbKFpOwjKZtJyo6Ssq2k7C0pG0zKLpOy1aTsNymbTsrOk7L9pNwBUi4CKbeBlCtByr0g5XKQckNIuSak3BVSLgwpt4aUq0PK/SHlEpFyk0i5TqTcKVIuFim3i5QrRso9I+WykXLjXOYNzP8BuAPUwHicY2BAAxIQyBz0PwuEARJsA90AeJytVml300YUHXlJnIQsJQstamHExGmwRiZswYAJQbJjIF2crZWgixQ76b7xid/gX/Nk2nPoN35a7xsvJJC053Cak6N3583VzNtlElqS2AvrkZSbL8XU1iaN7DwJ6YZNy1F8KDt7IWWKyd8FURCtltq3HYdERCJQta6wRBD7HlmaZHzoUUbLtqRXTcotPekuW+NBvVXffho6yrE7oaRmM3RoPbIlVRhVokimPVLSpmWo+itJK7y/wsxXzVDCiE4iabwZxtBI3htntMpoNbbjKIpsstwoUiSa4UEUeZTVEufkigkMygfNkPLKpxHlw/yIrNijnFawS7bT/L4vead3OT+xX29RtuRAH8iO7ODsdCVfhFtbYdy0k+0oVBF213dCbNnsVP9mj/KaRgO3KzK90IxgqXyFECs/ocz+IVktnE/5kkejWrKRE0HrZU7sSz6B1uOIKXHNGFnQ3dEJEdT9kjMM9pg+Hvzx3imWCxMCeBzLekclnAgTKWFzNEnaMHJgJWWLKqn1rpg45XVaxFvCfu3a0ZfOaONQd2I8Ww8dWzlRyfFoUqeZTJ3aSc2jKQ2ilHQmeMyvAyg/oklebWM1iZVH0zhmxoREIgIt3EtTQSw7saQpBM2jGb25G6a5di1apMkD9dyj9/TmVri501PaDvSzRn9Wp2I62AvT6WnkL/Fp2uUiRen66Rl+TOJB1gIykS02w5SDB2/9DtLL15YchdcG2O7t8yuofdZE8KQB+xvQHk/VKQlMhZhViFZAYq1rWZbJ1awWqcjUd0OaVr6s0wSKchwXx76Mcf1fMzOWmBK+34nTsyMuPXPtSwjTHHybdT2a16nFcgFxZnlOp1mW7+s0x/IDneZZntfpCEtbp6MsP9RpgeVHOh1jeUELmnTfwZCLMOQCDpAwhKUDQ1hegiEsFQxhuQhDWBZhCMslGMLyYxjCchmGsLysZdXUU0nj2plYBmxCYGKOHrnMReVqKrlUQrtoVGpDnhJulVQUz6p/ZaBePPKGObAWSJfIml8xzpWPRuX41hUtbxo7V8Cx6m8fjvY58VLWi4U/Bf/V1lQlvWLNw5Or8BuGnmwnqjapeHRNl89VPbr+X1RUWAv0G0iFWCjKsmxwZyKEjzqdhmqglUPMbMw8tOt1y5qfw/03MUIWUP34NxQaC9yDTllJWe3grNXX27LcO4NyOBMsSTE38/pW+CIjs9J+kVnKno98HnAFjEpl2GoDrRW82ScxD5neJM8EcVtRNkja2M4EiQ0c84B5850EJmHqqg3kTuGGDfgFYW7BeSdconqjLIfuRezzKKT8W6fiRPaoaIzAs9kbYa/vQspvcQwkNPmlfgxUFaGpGDUV0DRSbqgGX8bZum1Cxg70Iyp2w7Ks4sPHFveVkm0ZhHykiNWjo5/WXqJOqtx+ZhSX752+BcEgNTF/e990cZDKu1rJMkdtA1O3GpVT15pD41WH6uZR9b3j7BM5a5puuiceel/TqtvBxVwssPZtDtJSJhfU9WGFDaLLxaVQ6mU0Se+4BxgWGNDvUIqN/6v62HyeK1WF0XEk307Ut9HnYAz8D9h/R/UD0Pdj6HINLs/3mhOfbvThbJmuohfrp+g3MGutuVm6BtzQdAPiIUetjrjKDXynBnF6pLkc6SHgY90V4gHAJoDF4BPdtYzmUwCj+Yw5PsDnzGHQZA6DLeYw2GbOGsAOcxjsMofBHnMYfMGcdYAvmcMgZA6DiDkMnjAnAHjKHAZfMYfB18xh8A1z7gN8yxwGMXMYJMxhsK/p1jDMLV7QXaC2QVWgA1NPWNzD4lBTZcj+jheG/b1BzP7BIKb+qOn2kPoTLwz1Z4OY+otBTP1V050h9TdeGOrvBjH1D4OY+ky/GMtlBr+MfJcKB5RdbD7n74n3D9vFQLkAAQAB//8AD3icrXsLcFzlleZ//v+++nb37dfte/VotVrdrW5JltuKpO6WJVluPyXbsmOEbGRjO4KVjWPZlsM4QIU4IYGlgCE2yxqKIQkJg2GreKQCTCZb1CZkiswjzOwOmSTATNVWTZLdDUwSMrVDsomD23vOf69assFAqgbk+773P4//nPOdc/5mwNjFl8WjosbaWblmxiOmIlTGYXzb11M7Z2ohAMbZCcZ5iG9prZl4whfwGju05xtttitUdwXYEUgkbQtWga5lC+XBaqJI285qpb8dVEc8Gnm5L5QM/f58yAlB399a7dD0mWAmdAqaMvBmKPKX9TdDwSjod9yhx03FAPcvI6Gk2lV33XoXUtKgL8C6Wa0WSzXbVjhg6JoqIPShCK0FOvOuE48K1V4B1VUQAVevugmP7Fz2CmTzW5/8+ZGP/+Kp7h/8oI4MuOZ7M5B9IvujH2Wf+PnCAjzn8ZK6AieMKRcvXnxWWSWCzGARlPcqtqs21WZzEBFgYIVDAYWzVJIrXBlH+hXGlWNM00GAJmYZ8sKBzTJFVZVppijqDFMVdTIWLa0o5JrdaHusPZGIG1IjFhQGK2mAZEe56kJnR1bTY7ZT7eivFGODBTdma3pHtlCNDVbwmgMHx/aO4R8ffeet5/ZCG6TfuV03IaSJU3oIzKsGO9+5PV+BwU5xqnOQx1aO8fW71yvD9fPn55/fA22PmsaFvfSgwZ8wzPiFvZ2DUMnzJ2hHVDMmHucPsSRrq7UQo4DMAV/AW7CANw/Zru3NIx20bBEpXwukArlxxOPReibaG63/SyQyiftzcBy3k1HuOHgjEgFHnkYfh4VodDJC4138Ff8hv5PlWbrWmm2O6grNEgGNCWGnbFtRm1Z04gzQPPWvkqMWF4eWU8DB267Df+gNe84bBvfRpfNI5Ny5yAmHDh5/PPLuByMlekDS9DsRR73nWHetwBShSO5PqCBQONO4E2wGlSvYZG6gMzeQ09SWFZC0tWION3oOVVXGTbGM+hrAzQj0O25yoN8R8YzzRsaZdzLwhpsGPEm783hAJ9+kq286eDX5pn/VydDjvk7i8EuchU21JJ3DNOqFzeABmywPcNXxhu/wB+3whrqwVw7Cn1j8vPfdDH6O7PR3fDV/Cb85wua/waSit309grZJHHOhHEQ9CA7zTGVCUb0ZvXzc1lrRe5Af+4An0aSL9op0IU9y6vRFtAYGKy7KJGFbQrdg2dXqGAwWilld0zUy9xLqd6A/zeFuy7gzYFmBOwOhZ6NNhZakm8YTI7S1pyM1mM032V26qevXGlzZ8+TKvROlB/BBkO9ACDalB7OZuBnuC5tRcAItpalENNOfhajVH1A2a1HjbHZ4N4r54oWLz4qPoe4jrMo2sonapm5QRQBQ3XycKVxwRRxjQuVCnWc6mrzOZ5FvBiraOmia5FubYRpok8n0ioRTKOQMNbWiszxYWAFZrQ1sB+dDJTFYghzyiBN3oB857ndIAha4Se/+YGUtjAkXXUO2xPE2eoe3TWPeMOXmzNi+j9w1HghvVbSAmu4c6nFac6MgbzXFU2baDr1241+98TfHtU/9t7df+MzU4msmfPYj06Wbw8Gqohda0/FkSyiyvtPGG/FsMKq1pLqmPvndkye/+y+08eYIHEJZpFmJra2Nop/VWuKcCwPvgRhnGlOFps6iIdAEmFVAKh53jblZyBU6nAFdbfX03tGwioZ9oGnEyDSWTQCyFzhoR+s/jdjgWLmc3L2K21zEmXCsM5aDm4g9Ny5v0PZVb+dY9Rcd/sl5eTiPj0nTaeiU+BhhW2qbuzJcUy2Nc2gCrjBkxWCqZiArGgOuwSzjAlDb5L91XfpvfYbpij6ZRIUWYoVcLqC2+UqNLddsMrekY3GZztVl2uQjpl4xjedIM+Uybc/r5viShuHgcgXuwQtpuoMHz8utCe/s8S+Y/7xMaYu2DX1yDrez3lp3cyyKdop+HLcLi878Uh9SKOSlj73cOIUFRVKVKHhaSS9JP452RCcYoJ3w85bz8Ckp9VN4xeZj9atpH4FnPCV4OtiDNIVYCrWwsbauK81VxUlaQnA+riFBisoUsiU0LbQpASCmmRAwg1MNJoH19uQ6WpriUV1jIQjphA5QjosiTfiy1tF+kPJKMTFYpAu6lkx40odnTv7VjYtC/QtTJyGH9HmMnKamGrcaqmaagRsMUwR9WeLmwsQREvIRevSvYa8uVFXo9Sc0w5A8/Rp5+jcxhXLuYAOIx/pbY+ggFp0FV8lNoLNAEQvyDkwBZR9T1ZC6xR0qFgsybix3DJcR7iIGwCsCHHQM0nYKVSBXQZPnqG7KDZiqrn8K524gpN9ghAx42k4GsvF3nohnA0kbnglkC9mrl7h4Db2TommKcVE1QOPRd97K5WJxsKO5nIjHbHtx/og3kK8iWys1he/EkKlqCbFOB6iKQp5Q5Yp6DB0AsjmPvHEFSGsoFraPaVpI2zLc2lmudErjJ/eeQwbKPoRBZulcwhwXYc6i1SdiEpiCF+KrFOIrAzKaHdhQ79tw4MAGuJv4rt8sQQu80jloGnnDfNVJBa+vn1WjSg1d8NHrg44FbTgdJ5+T77yy/gDI5wY7633yTbI7+CdyMDyEL2paDd0BvZjyfIYXH2/H+aqjDfXUisgnk3rFYMePoyZBegWanQpM5hKdlUSU1JnoQH2iG1d90IYADi0JPV2/oxMEeB7apm+aBngFw/ObMjzHzv7dgzyOh48fHZnmO9c8Wv+2RAGwHiP20UNnzx46mvYxyaMixDpZX22lQqQgRDqG4kYcMo92cpypAOo0Ti+iSYXJRGc5l8wvQhPfqpE0SYa7nDwkeQyh26OOlbecqVumoCwJ8+mDm+9/5T4eOyOt+4wk8WjavYTIG+7nD5Li2cWv8zGkMYoz51q2u3Y1JQSwfcumSn9JUxW0CZIWQ5isqKCo8zoGFPybx/lyHD2w4AaCBw7Ap1HIxAaHyZlr1tXG1owMt7h5Ox5QmxF4Iv6vDhaQoTFAYADuYIlnLa7b7RwtiOBDtVK1dbyCMXXxn5azOIIKfLFKaQP9K3HKIMYEQosvhkIWH23TQ9wIpCq9M4WxycnJsQIUYrEJ/bPGuOZohfHVzdmMaAmHm418c7DU3xdoyYPebFktPJtpHu7fefjw4R0VHiNTa06ZUTPe09a1sdTUVNrYtbo3nth11VW7tBa1d/U1a1t71rdG2u1IJNkWDYdbUs0pnnFT+OloWzISsdsjqVpvy9prqrNjed41POfPx2+J7TIXaWP5Wgf5bvToBEvpppQYOXPOJoda4gTQE6TsNK8sAvUSSHBFygfnfM9wL+8aK/Bddv0tZ8SufyKZ7ml7s20iCWdsPpPu4YVaXuur/2M6WX8riReTE21vtPUAnn4iyTxdf0vJ+/QM0pwsUL4D5BmUBQEeXpaU4W6RtExzN1In7eT9qHPpIoUdqAzSrdyHIPo1JNRps1uioCWJyIm2U/JG8oO4aZMXozF8b4RupRd5JJv7Nn8ZeUyxjlrakhJHcwO2gHMUDgGLR0MmS0GrIoMRWos0K81LUnPZYgmkw6sM8HtCoQTaT9y0Wu3f/MZuCYfijhMPhUVQNdL2hY8kMroS/8UvEqqeSfC/xzPV07k3vsqyrL+2ykYnhJjEz45OLIdbu4ncrbrWhImzltU7oqqaXAEdMWiHxPsSdvuF70K6/xf6FejjL13YBvFVP+UXrkwnyelZjBcltoLypQIoEmsoiDUw4C2QFS/I/J6yx5ybWOOqaMad0kJlKo+ElAdLqvRTMqOsgucuM64j3hgHU1H1mIkQ084Oje3eXT1lZwL1nwaD0BZMNfFTcHpv+sf7v6LEo4oZMlRbFNqH9tb60nEN0UkQ0mYawZNpR878eFuD1lWsl/Jb9J5iMbPlDKnkh3raBmS66U1M9Jm5rKUmMel1dKLOcxrVSgf5dJqU4o0g0pJyTlV37x4bytpCATOG8VUT4+m9cPoURiakE34ZMes/wbB0Roun+2p7h9oLSlwzQqZq2eIr+xe2/Rhp5QF8hHn5Hh/FfM9ibs32UrNG+l22ZbrnJ8N+fERAcD6YCp6nuPc2Aq/vWXiMfzKaye/BDfzTLPwe33MT8ns4P/y0uiLBdyZw3qRvNvGZegjF6H+escXvreOnkD7zm7IkADTbJEkU4sdw1jmwzpTj42smHLB82ijenjfx9YsXkccR+B5+I1azGtQk+4maTpnLlsBL75E7O1IPea+mzfPmUwQt00FJoG+nPxN/zruZzZprTljyx2GpXiHdYWBZtcINeB+2xVP16/GT9euDwf00TbqgK5gK7QvCmfp/wPn15WDa3BcM1l/Hy8F9wZQ31nf4Q2IjjrXyG+BnzXnMmqXiTuB5CLa01gINjvb8mesSTwHuSAEtzm8anp+uvwbdprkfhUs0wCNIxH6TP1l/vf6aPDThK0TXI5I+tjj+SX/8wIcaPxWX4y+CqsCiEIiAIzhsKrgfh+6qv+4L4RETPl6/zqMKukki9AA96OseZb3Zk7UKVKxZKt65tpR1J9p1sTGgP5Z4ah+KEzl73R/xEfr+I8H5fchlN/Jr0n0c3fSGkrz+vbhd5m2ZWltThDeKUaKh3WTZXWauS+WomBdMkjGvOCRuT9YfcIZxk0x24/5cT3q8redxe8TpTsLn03b9LIaFo/I0eQ7uxtjQm6rffI4elnTcJfbwX/qRFyG+Vw+SaJdyFIpugk0WXCcnaZFo1323viNAWHZPvk1+ugfjTf2sbcPR5LDT442bhwPj6Z5z9qi9wr8B85Ji51yXb3tISxlpSUtaZEYnFX8ZbHI6C8vk4ll2h5/YdRQbM0CUbSmXHsd5rH5zWz7fBnc/5iA1NLANwyQZ2+5JjiYfQ4mle+BxJA1prT9g+770dv4zTz9RnTPp+JlY4DJKoroOucmyT4fnsGIeFC3H9EtmB+qnGyP6413tPvs4BhIwipskDKakeIg+KKTgbl92JBkkHn1J3c8t+9ia2vBKhMFkGBJtEjrGDIzKE1SeAgTJiDAVRYpKmSGwMlksJor5gUWgjKlXYS0gurS4neaYflXJnaWBUjDKNAVhkWoF1WhHz7uJ2PapE8NHJkulySPD62/qVmLapMq10a997JqvnphQarc8dO3UQ2smYr38pfOWszK6fTs+eBKfHy4j8t2uWNrWnbDx5CNfe+TkxrHVE/EEW4ynxM9H2FhtpAeE2tnGFUH1J4xXChxD5hACLNXbLgOA3WU353rI37Y44SipbwdxwED/mEC0rOmuIzmlGkw7SBzNxZ6NN3519+zXRhV1Uosp3TdtGD68s4eXJo8uzHVtjyXc85gC9MYmRh+euuaRk+vhAG43Tm3RLGW7Clp52Oesq3N7dKVjnW9KxCdWjyFvi/nUs+Ja5CnPxtn+2t4NnVwLrELw76JqDMz1MacMGJoR0I5RVsA1lR/DLEdonLJLQWnOMcSamKlrszLnWWZ3mzcVOjsrnYWynTfVNmQ6aQFxrWtL9SQtgjqsojbxf5lp+qquSF1rVGyk02qZZEEKRkPdlv9ff3LVQ6MTFMas8xSft3fNVbd+vqg1KaF5w7RwBsirUye24UVXDS3oIcj/nz+56mF6qQlUAQ++gGoNytcxFG7P98DWMXMoHIL/6l/Z7p1riv8ko2oiyiru129WsSrmUjO1XdtWc0Pr7miOoWOV9YUQ07WQPmsCisWYDge5puAUAI3NIk6EQACmaQ+BGRaAwOSemV1TH90+vnlDrZBNFOi/nEUlLL96lYx5VZLqB5zDQLFQzGm6KuUX89L6YqxRuaPsCwXYTlJE1EVJt9ycWTo8bereoW7Wv38ewfOzmgI/N42Kn53LatjTxUCv85zbEyg+Y5hTcDddq99M2ysc8/51lABfjZ++8KvSxvUlnpCj7U+mIG3vR8yhXSbXEbaB3cDmatdds4lrhi9Z8hskNo2hkI+RQHWN6fMIUwKGFZiNhDmCNq6BoR1gejCoTzNdD86woB6cPDh33YFr91w99dHJLePr1tp525NylKZkzJtthLplN+ADzhOxjpiN1trRPwb/vhKfqIcMg8Mr3DDqd38o4cM36y9KWa+Tsn7v4/ocj134Vcg2TZsf/ABFKH4tYwrtObZYYxoF3QiQC+PjATwUho5+W8MkQlOOqUDxnlMNjZpsfB8zjJCxZe2afKeTjXeuboqT2XcOlsACB6XROFhWch7AeNy/VsZfx4fO5Aj8EjTVRPjLdtrmTS1NX7Azce6kmjZnnHf+1iuBiG0duzsmQTiZPzfjEoTGAqZ7xqt/nmmai8gXOWb0/sG9z8vyyPNOZjKDf9DlRgmQR93keVlHOU/9RTkfH8W8ieTQzWpsc21DGRM0Xw4soAUWDEDPtMB0oS9I5qeXC0PhMySPyTWjuYFctn9JEgWLp6FSXdz71TeSgzuQBmnXVHPXGqWhIhXkF+H2lQXxVqiSO5OthN9CQQSazmBOhdycwSgoZRJvQ28Yz8SVltDiwd3PUxMLN9De1dWehinH5783RvA9xhpyoHgnWAfGvE3sqtqOFT25rGIoMB4GBa0NAaepg2KYyiwVijQqFKGtopEeUFFYgQCboj0jZ8cCk7U1Q2W3MBBLjMRi0SCKxO0od6gD6Muon6Q35JGLDZS9DEpfLNZTA4aqrmrD0rwHCAO8Cs/Ur4a3J0Lql9WU4RfBJiYySfg+cviqaczLvipt59LuhbjXflPdSuRLUUd/9VV422jRv6SF/NbehYrcQ1p2AZ6jd80L5+kSRwE3WV+OVGTs9GvnU6yLDbJsrZ2aE+iijskqPtuHgTAktgz0r+xtaUaslZRRH6FKlRJrBwO9bK+lef8YXipg7j8GSJjM+GRPmSApRv6n//T4VrH3qqbRaNxoqoxSNMfwD6MV18yPulftrX+xZ7gXeka7vMCPgf2aQ8+N4bPuaKz7lg2LIGjjTT3x4T4jvubPYKL+cFtPTxscwm0DA+yVNaMjbFNt/cE9k+sUpoxgas8Gu1qjhG7GqUu+oAFel8B2gTDcgt+54If2XXv1VVsmVvRkM4m4TnnrYCGLtt5foc4F2rWO/NrIbxENvBHUy0WJBYqEg8hbyklAxoATvupfHMCZ3wAHaASEAFz/Y7pUPh+ZumWK7z65G1KGftgMJro0NbIzrOvbm1sCuhL9tBGKtrof1aLaZkdRjS4zYhzSDTDVw4bldnrPGtubWgKGiH0adR1JuR9VI/qErSgB72HMk0emp2+anr6F7kfTydZ+zdKSO0EdDRuTqaip3xAIjapaLa1aWqg/kmqNQEiXzza3ZFbqId3euezR4Iiqbkj5j7ZEIeTX7X4n9vLvLmKL2mAXILVUp0WPoyLCVJVGQ+/yNlGhjP8PNLq4y9vNy9rPrn+eW36OaPmdX0nTF7EIpu9XPlvW1XMgOiHbSHIL1ji1nsbpBdbAyXtlTRwjSHuCqyJvkjfAVEiMe317oeLEURlNKa/CI7tfVLxLp5qb4tFwUFVYJ3R6/STHqy1Xi1R9RLvvd6lSPIba14rZoo6zwa3w/7L18OGzRwC+N7B52+HD2zYPfA8OP3iIH9kyjkd4Fdwj9x85skUPzfXhQd9cSN96mB+97yjgoYUXvZ7kxYu/UW7mL7Eo+rwKK9byTKWsSWWz6N8VBaZxB5ShgDJZHerscm0J6L1at2fNGPH4CqQNZ+gAGTeaPZVNBB52IJ7nt/uI3N/B0707Do+8vmEH37rpdTLX8eEDd47Xr564Y3aIj+67azM8Q4dwYHjpHbJoOu1/8OkH++lk4s59Y2Lo+tsevG1ukA/N3uHb9f9TbkFebNRET61I/GEuOEtdCkxKcdfISpPptmSn01kdVNF4Y4NjHF1rWnh0cxWZKImsJdKcKPPIkZR5RIoYkcJ7dh665dDOHqV/4jgc2ILXkYz77zgwypGsH1zKst/L+ir6nJVsPdtR2zaC4aQTZC9CR4p0jigDQ6gmexJcUeeXdbS0xY7WslzDdpPF8uryAPX0L+tqoVNFD5QrFi7rbKGXwYnkJGCpwra4XMZe1th6JZcOCL0VgV445HepqL+l5jVdKMHP1VeH89a/WtYaK2/9Z/g4noyFYduzjf6WpSS0FIKDRovrC4aaQ9ZArQ9b1r/K58P0Yhi/4Msl4WPhFbUuzCTBb1OitsjmCVsAn+Qs3eokTJ1FeEQlI1nGXNlfnbS8tcc/sYz4wU8vsbd+lr/UII5u7mncOYBJ+WKc+5jsETe/L03AXCfmN4IlTVnCOYiVSxyWr5h45up7d/Lpu568c7ey4zRcu6yjzk9P3Xvu3im5qb9yaf98ab2AwZIsy0Zrq6nXxkG22zi121ScGiC71IoiZwcZqlAmzUCmvaU5GgkkzaQfoNCjlKimWnxvGhtR5b4r0roYFX59BZLFsvVB5NMRIVAGQ65bJoBsRuaFbLJM/0n3nZCLlZaWYKj+efWy88WezKv+yiG5dKnN23mX2uUJbi5bY+Rc4XgxBrHXGnlYb637gwLPEuXVBmD1ViiIyzgRfl5f9NddvfoB9NDxw0clWD9KV0FbdhMMjzfc+H7uJXEG8fo6Ns4O1q5fU+KCCq16PhXG3JuJcczFw6GwEaLSBXkQwNwF4DgLs1AgHDqA2FToAXEgCDpj+jTudDaDgUmnGsaG9bWx1UOVctJGzBlDf2HJWgZyh1HHkeV53RK5WC6Gc8fr45AzKSByxwlWHShTsxydSgfVLhALUZsXOiS8w0TlVOdJ006bC4ZayA43j7cN9WCqeCgYDTvGJzKnKG0Jn7ou6KSC18Frs8FUk2Jch1frv65/kWLdMMbf2fWfDKac4HFdaYpb8HY9ZDXZhnEylEgHP7t2L6YMcO46M22b111HA113zoFBDJQUpy/WLx6B36K+MxQdmlHBKerm0BIJKqUu68GgoLY0VSpexdChJiDC1WpC9qwK1cQYpS7U0BW0JAzeMrX6P+hRI2Dy4z/hqqmb4gS3jG8GLT77P1Ue5E4wfOFTFoioAS8NYVYZhv9umJapaPV6hct6wHdkHiowcqVYnvUivt5Qa+3vK/X2dBXy2Uy6pclBE4pR4XkwxWHTtq93vH+tv0l2U6pFvbNRePWrv51uBFbBWmgHbw/upXv+0LnRc1AxL/RjLrVgmvx/yP0Fq1KJxarV2A+PHct2HDvWwbvxJIYX60/THfzHrcdGH7shQm/iC2l6E/fXRumtaPU/ybeyx+p34UkVL0LJv9PAUHOomzL1w8q9uZaYoV3SIOoujHBKKii60eKMxhJHXUMgTQW0InVqqErq22AbYN6BHOMkFCMtlpWLDDc/0NM23tYLZ1uGMX5ZrWfPtkQj+chQ61lZiH+gZSiai0Sbz4JhDbeswXd2PSVr8E/twqtr8KXdu690Q2KpI6jHMMuhBjdRdbG9iQslEae6YVhDV7gBdOiHgK4iKtSERkv4yOpAP8ZMpimmNqtSRuUFG50FDD2AeaYRNrasGS0P2LTwuGDncpRJNtZ5Fpev85SVhMY6T3ewBJrtjAFIs8XZi95eSXOXLJkW75wKaXmE7afkst1TsjBDJxP3v3I//kG6Z9R+ce7WnfcfrvHRo6fPnT46CpteTMJZ7yXKMb2XTlHieMpspgUYLz+k3UsJV/LFTWNH7vvT08eHlfWHHtx+69yLSbZMRhHWhDn2SG0oYCC3qE/B0qAKuZqPg+b5XkErlwWmYkKlMkNY2eLmUAqF3OJinmKjrPIhuK1/W/IJ6z8kh5K1D2aK+/UTWqOzkz1fC4xVOgKKKqgjZqKV9nhTGGOgUGnZjiK4Mq8jJFKOMwJ0UxSLdlO/Ymvrtq8H3/UG+nBNcG0e7Vh79xt/yOf37KklDMPYaeyc3LZ1y8hwT671KoP8BApooL9agOqYUm2FATeRptTcdeQGxexmC3pWyw2u5ZSr4l9xsLCKW+DaaeqxVskXZql+XdTggY9NDrcHk331MoTzqZSj3fGlCe3GxJQT6IsGjeBkQOGQO53v+VKSb9E1EVMQ5vKs2/R7axiimWAmiVCh4/MZ1eYrecvvMWx9oa71KppmNkVhBs6G6m+veHkw8amOFi0QFY4pTI7RrikRxSd1jgBaCeytDEHmYSsUN/HTEEyqQVQ6ppY4937ER/nPmMXaWK6W8TvQy1cj+s28wcIlS70LHqQsSoS5rB18abP70ubwv0VMqrRhJALnb2SJXZ76vg7pAPc9++oF2+s8XzLyZUMt/3ajhy35encPGy4n+lIy4Xvvou1JERMJFmTa8zqHldSwlaBa9k6VC63heDzM/3cYttfndDMiKlbIwCN7eV2F8FS61toUNZhCzHltUoKChwg/yah6WVnr8jIXJer+ultoizj14CWn/GfvvEU5uIjTdtnx8nw86K1TlzWF5QsXBhYXGlw+3rLk/5IB/G8+gzZuYUagPa8ByoUaWfiRIuA35I4CrJOMVariLtOCaKD+Ryq3gvWTwSDci1AAfVtQi7zzsmWE4F5Vq/+RPKDe8714vX5SVSVGuXjxa2K/iCyN42qyOkbLkXwt6FIjmt5sRsHC11VB2yANZQl1HL+GWjFC9Em4Vx7Q2oKTeB2+oKkeL3xEkBU015zWlri4VEBrpICIlwZ7Eso2mgSVKs8GLeJN5YsLnmn7Lh7/45KS6ncSg5I/Por8NcaWi7UW27Te2JeyTGPqPg3VS9j2CzJyeznjn1qaGXCrpsq8ro655n7+1zi3WwkBRkGuRl5e3eMyi6L0TvDJcnYwTnM14fWG5Xyh5nXVLya56BmNJRUi25oYoiGRJBGXdaO+Rb1Y9R861mlZYzodsf21K8/wZ1mC8I75Hr9viTsF+fsW5BzxTSO1IFQNz6DJvnC/lPv9L6Ab4KcvfJU6gC94y9NfMP31s7i5XY5RIn6LJqKRxjAKDuOVppiQA65ycUhaEvVeQya8dVuF6uCYKClVFADVGd5FyGt9RTWAAgg50ahiNFm2YkcCarHv3QTW/6Jna0TY0VA0FEpnMkbciKJ0RGSrrMN/XzzKfy7p3saOsq21cUl7FVQ2Dboqxg8D38S4hnxooL2bGRU1qurqAtP1Q1M7xzd3Sd4MKlx9aN7cxtWq/1OQAi25ohrK0s0ilVHwbgmKVNGWD1T/IMmcmd2u68h5MhPsLpW6Mf7ZEUPfceC+0zfhdXy9uTm5cQffujnZrMQFzmZdv+n0HyDOnl33Z4RjOcFoIL338N50IIpBxBEd9+2+7fV+vGGHQ5Y18NCTDw1EwkITYRu/JwZe9fPMI+IfxFUsyjbSqvKhAcwt168pdedsTBbTzZxTnRzRxQyV/if8uggP8y2VcpqWw7iyTmgJOy3GuEu5oK35P5xC0L6GZFag308hopD9/6r3KyoE7rKG5Tqi3D9z8s6TM/3+7mEeeCxiPDanxdWDjxmRxwKIeebmVFVePajGtTl5VaWLcGDdLdMVpbTvxD0n9pWUyvQtew1RfioQFOU/1vU/Lotg4KmyMEz9nnuM2OINTVu8ETPuuUeXPuNZUcFYEmd9rFRbYSxfVUjLiN9dFerqyvd2yKWFBEEB548Fup3m1PWnBQHUERnjyKYur0O1v1pBfvl30u2Hnj4EwydOw/CBOyd23vd4+YefpuUbvHb84elmO9HXD1P3Tq1f48YM5VZ17msH5/d1fPtmWQndeOwTd1EnZNeXbtwsoBRbcbJ29T3T0GbGDO+3J95aen6KxViWDVCHL8i5wsPAxPLfE1FDb55RmQnmCYgrEoijOyX+6KeDoE66Tt5ONjkSgheKBA9LqL6qpqchU0E7QaSYtJ3+irSVimrrmpLJU3ej0gsK6vTRXbdlEXtnb9u17Z9B+Un9m9Hg5rmoE93YF4zCPwZ31H9b/6f6b3cEgzvAgAIYO4IwfMe64Q03nOX3fXzD8Lo7brzrLtiCz85tCkajwb6N0b9LJD738MOfSxTs2x7mj3yGsEgjzzBYB9Xw2hGCYAZOzYWG2uR6nFlvxlJeEZfO732ziNsX84be4ffMGz7/gRmQb1dyTX8Q/dtArU8Hb8Wybmgod53NBlQOilxbg9mPCIstK3sTAzE7O5BMJuTKkvJgwfulBskXM0CBMymXLQrpkSoDMVmJ6aA2QjGG4SJkRk38g5sd61dtYGoQ4St+jHY+U23r4aVWOEjtseoMnDgvfwCEm2+hp6r/X91AK4zYkU3HMVEaxnR3qBfqPzn+/wHPnsOreJxjYGRgYABi1vIsoXh+m68M3MwvgCIMt5YoxkDp2P9f/2exVDAHAbkcDEwgUQAz1Qu/AHicY2BkYGAO+p/FwMBS9v/r/68sFQxAERQQDACh8QbyeJxdT0sVwzAMy49AkAxAkbT3UQiAITGAISmAYQiA9th4ttUs7Q568UeSlVidiwSkB3PUPg+ESd6ZD/+8v7HyrtzwghY89ZB6BcyrYqc6RZhw48YhaA1Wc/v1PQtdeXJ/HppUmFM597nvBVK7D+Z+E8/uQZLBgDyaz3Llvxx02S3c/Hv813JrznryZP4F+6lSfQAAAAAAAAAAUAC2ATABaAGyAfoCJAKwAzYDmgQSBFwExgUyBbQF/AZOBvwHRAe2B/YISgigCPIJGglCCWQJignACgAKQAp2CroLAAtGC4oL8gxcDPINng5iDuYPag/6EF4RIBGGEeQSShKYEyQTbhOyFAoUYhS+FVoVphYoFooXHBeGGFoYnhjGGOwZChlOGXgZrBneGhwaWhqgGtIbLhvyHHQc2B1QHZ4d/wABAAAAUwBtAAYAAAAAAAIAIAAwAHMAAAB2C3AAAAAAeJx1kN9q2zAUh39q0441YxcbjN3tXJWWEcc1lEGvWkLbXZeSu8JUV/6T2VKQlY48w95ifYa9zt6jd/vFESUUYiP5O5/O8ZEE4AP+QWH9nHKsWeEdozXv4A0uIu/Sf488IN9G3sMQPyLv0/+MfICv+BV5iI/4wz+owVtGM/yNrPBZfYm8g/fqW+Rd+svIA/Jd5D18UovI+/S/Ix9gqp4iD3GoniduvvR1WQU5mhxLlmap3C/FUdVWN6IXoXK+k3MpnA2maVySuza0ZlToUZ07292YctFov6k2eWp8VzsrJ0m6qa+NNV4H87Dq1j2WWQiFFN61chX7yNy7mclDUoUwPxuPN/tjAoc5lvCoUaJCgOCI9pjfDGk/BPfMEGaus2pYaDQ0GgtWVP1Kx/ico2BkaQ0zGnKCnHNL09KNuK451721rLqhLfmfht5vzdrmp7Sr3nUfC07YL92afU1r+wrd7/Dh5WwdHrmLjDawanUK3+9acPXqPML7Wq3NaHL6pL+1QHuGMd8t5/8PvPGO3QAAAHicbZLnlpswEIV9DRiwvZtseu89Ib333vvmBWRZYMVC0pHEEufpg8BO/kTncOfTaLgMOtPr97o17P1/baKPACEiDBAjQYohRhhjDevYhu3YwA7sxC7sxh7sxT7sxwEcxCEcxhEcxTEcxwmcxCmcxhmcxTmcxwVcxCVkuIwruIpruI4buIlbuI07uIt7uI8HeIhHeIwneIpneI4XeIlXeI03eIt3eI8P+IhP+Iwv+Ipv+I5N/OiF1hEz9JKxUrtFrDl1lWF9NR9QIikToRaVjUouKxvOmNBjLxnlhgo2DbnM1djLKrNGnGPScSUzItzGv93yPP2bSQSX84z9cqFQdJ56yZRmMhW8mLlJJSaBI0XYPDaZKDUviZmvr6DrNjJMi0WcK1MTM02mqpbZlJtEsNx5SI238jSodJtoS7qv+BpPw67IY9xU+dg5TXjROTWwdGrIOzWhT+uA0jolxqjaZrSOnCF2Nmq16651EYpMm1fakAul9SJQeR5QVYQlk1VkZ8SwoVNFIVjWnKQrlBGdMToftdoZjrs77DajqXKrS02YEFxbbtdWkG0x44JJVUS5aBqKSlJwmhDrmOF2Hv9Wqsy4TNqoKhfmSrrQKuNSL5nvPG6p0s0AkEWkSWVZMy1Kx3ljk03qLuZ14lTmB8gNGmByGrGfjLrhlhJV2f7SaIneNF1ypQNbybBUSgZswQaWEUNngeay1/sD4l/60HicY/DewXAiKGIjI2Nf5AbGnRwMHAzJBRsZWJ02MTAyaIEYm7mYGDkgLD4GMIvNaRfTAaA0J5DN7rSLwQHCZmZw2ajC2BEYscGhI2Ijc4rLRjUQbxdHAwMji0NHckgESEkkEGzmYWLk0drB+L91A0vvRiYGFwAMdiP0AAA=') format('woff')}</style>
<style id="style-core" type="text/css">html{font:16px/1 Helmet,Freesans,sans-serif}#store-area,tw-storydata{display:none!important;z-index:0}.no-transition{-webkit-transition:none!important;-o-transition:none!important;transition:none!important}:-webkit-full-screen{height:100%;width:100%}:-ms-fullscreen{height:100%;width:100%}:fullscreen{height:100%;width:100%}body::-ms-backdrop{background:0 0}:focus{outline:thin dotted}:disabled{cursor:not-allowed!important}body{color:#eee;background-color:#111;overflow:auto}a{cursor:pointer;color:#68d;text-decoration:none;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s}a:hover{color:#8af;text-decoration:underline}a.link-broken{color:#c22}a.link-broken:hover{color:#e44}a[disabled],span.link-disabled{color:#aaa;cursor:not-allowed!important;text-decoration:none}area{cursor:pointer}button{cursor:pointer;color:#eee;background-color:#35a;border:1px solid #57c;line-height:normal;padding:.4em;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}button:hover{background-color:#57c;border-color:#79e}button:disabled{background-color:#444;border:1px solid #666}input,select,textarea{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}select{padding:.34em .4em}input[type=text]{min-width:18em}textarea{min-width:30em;resize:vertical}input[type=checkbox],input[type=file],input[type=radio],select{cursor:pointer}input[type=range]{-webkit-appearance:none;min-height:1.2em}input[type=range]:focus{outline:0}input[type=range]::-webkit-slider-runnable-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;margin-top:-5px;width:33px}input[type=range]:focus::-webkit-slider-runnable-track{background:#222}input[type=range]::-moz-range-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-moz-range-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;width:33px}input[type=range]::-ms-track{background:0 0;border-color:transparent;color:transparent;cursor:pointer;height:10px;width:calc(100% - 1px)}input[type=range]::-ms-fill-lower{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-fill-upper{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:16px;width:33px}input:not(:disabled):focus,input:not(:disabled):hover,select:not(:disabled):focus,select:not(:disabled):hover,textarea:not(:disabled):focus,textarea:not(:disabled):hover{background-color:#333;border-color:#eee}hr{display:block;height:1px;border:none;border-top:1px solid #eee;margin:1em 0;padding:0}audio,canvas,progress,video{max-width:100%;vertical-align:middle}.error-view{background-color:#511;border-left:.5em solid #c22;display:inline-block;margin:.1em;max-width:100%;padding:0 .25em;position:relative}.error-view>.error-toggle{background-color:transparent;border:none;line-height:inherit;left:0;padding:0;position:absolute;top:0;width:1.75em}.error-view>.error{display:inline-block;margin-left:.25em}.error-view>.error-toggle+.error{margin-left:1.5em}.error-view>.error-source[hidden]{display:none}.error-view>.error-source:not([hidden]){background-color:rgba(0,0,0,.2);display:block;margin:0 0 .25em;overflow-x:auto;padding:.25em}.highlight,.marked{color:#ff0;font-weight:700;font-style:italic}.nobr{white-space:nowrap}.error-view>.error-toggle:before,.error-view>.error:before,[data-icon-after]:after,[data-icon-before]:before,[data-icon]:before,a.link-external:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-icon]:before{content:attr(data-icon)}[data-icon-before]:before{content:attr(data-icon-before) "\00a0\00a0"}[data-icon-after]:after{content:"\00a0\00a0" attr(data-icon-after)}.error-view>.error-toggle:before{content:"\e81a"}.error-view>.error-toggle.enabled:before{content:"\e818"}.error-view>.error:before{content:"\e80d\00a0\00a0"}a.link-external:after{content:"\00a0\e80e"}</style>
<style id="style-core-display" type="text/css">#story{z-index:10;margin:2.5em}@media screen and (max-width:1136px){#story{margin-right:1.5em}}#passages{max-width:54em;margin:0 auto}</style>
<style id="style-core-passage" type="text/css">.passage{line-height:1.75;text-align:left;-webkit-transition:opacity .4s ease-in;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.passage-in{opacity:0}.passage ol,.passage ul{margin-left:.5em;padding-left:1.5em}.passage table{margin:1em 0;border-collapse:collapse;font-size:100%}.passage caption,.passage td,.passage th,.passage tr{padding:3px}@media (prefers-reduced-motion:reduce){.passage{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}}</style>
<style id="style-core-macro" type="text/css">@-webkit-keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@-o-keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}.macro-append-insert,.macro-linkappend-insert,.macro-linkprepend-insert,.macro-linkreplace-insert,.macro-prepend-insert,.macro-repeat-insert,.macro-replace-insert,.macro-timed-insert{-webkit-transition:opacity .4s ease-in;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.macro-append-in,.macro-linkappend-in,.macro-linkprepend-in,.macro-linkreplace-in,.macro-prepend-in,.macro-repeat-in,.macro-replace-in,.macro-timed-in{opacity:0}.macro-type-cursor:after{-webkit-animation:cursor-blink 1s infinite;-o-animation:cursor-blink 1s infinite;animation:cursor-blink 1s infinite;content:"\2590";opacity:1}</style>
<style id="style-ui-dialog" type="text/css">html[data-dialog] body{overflow:hidden}#ui-overlay.open{visibility:visible;-webkit-transition:opacity .2s ease-in;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-overlay:not(.open){-webkit-transition:visibility .2s step-end,opacity .2s ease-in;-o-transition:visibility .2s step-end,opacity .2s ease-in;transition:visibility .2s step-end,opacity .2s ease-in}#ui-overlay{visibility:hidden;opacity:0;z-index:100000;position:fixed;top:-50%;left:-50%;height:200%;width:200%}#ui-dialog.open{display:block;-webkit-transition:opacity .2s ease-in;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-dialog{display:none;opacity:0;z-index:100100;position:fixed;top:50px;margin:0;padding:0}#ui-dialog>*{-webkit-box-sizing:border-box;box-sizing:border-box}#ui-dialog-titlebar{position:relative}#ui-dialog-close{display:block;position:absolute;right:0;top:0;white-space:nowrap}#ui-dialog-body{overflow:auto;min-width:280px;height:92%;height:calc(100% - 2.1em)}@media (prefers-reduced-motion:reduce){#ui-overlay.open{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}#ui-overlay:not(.open){-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}#ui-dialog.open{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}}#ui-overlay{background-color:#000}#ui-overlay.open{opacity:.8}#ui-dialog{max-width:66em}#ui-dialog.open{opacity:1}#ui-dialog-titlebar{background-color:#444;min-height:24px}#ui-dialog-title{margin:0;padding:.2em 3.5em .2em .5em;font-size:1.5em;text-align:center;text-transform:uppercase}#ui-dialog-close{cursor:pointer;font-size:120%;margin:0;padding:0;width:3.6em;height:92%;background-color:transparent;border:1px solid transparent;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s}#ui-dialog-close:hover{background-color:#b44;border-color:#d66}#ui-dialog-body{background-color:#111;border:1px solid #444;text-align:left;line-height:1.5;padding:1em}#ui-dialog-body>:first-child{margin-top:0}#ui-dialog-body hr{background-color:#444}#ui-dialog-body ul.buttons{margin:0;padding:0;list-style:none}#ui-dialog-body ul.buttons li{display:inline-block;margin:0;padding:.4em .4em 0 0}#ui-dialog-body ul.buttons>li+li>button{margin-left:1em}#ui-dialog-close{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-close{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}</style>
<style id="style-ui" type="text/css">#ui-dialog-body.settings [id|=setting-body]>div:first-child{display:table;width:100%}#ui-dialog-body.settings [id|=setting-label]{display:table-cell;padding:.4em 2em .4em 0}#ui-dialog-body.settings [id|=setting-label]+div{display:table-cell;min-width:8em;text-align:right;vertical-align:middle;white-space:nowrap}#ui-dialog-body.list{padding:0}#ui-dialog-body.list ul{margin:0;padding:0;list-style:none;border:1px solid transparent}#ui-dialog-body.list li{margin:0}#ui-dialog-body.list li:not(:first-child){border-top:1px solid #444}#ui-dialog-body.list li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-decoration:none}#ui-dialog-body.list li a:hover{background-color:#333;border-color:#eee}#ui-dialog-body.saves{padding:0 0 1px}#ui-dialog-body.saves>:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves table{border-spacing:0;width:100%}#ui-dialog-body.saves tr:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves td{padding:.33em .33em}#ui-dialog-body.saves td:first-child{min-width:1.5em;text-align:center}#ui-dialog-body.saves td:nth-child(3){line-height:1.2}#ui-dialog-body.saves td:last-child{text-align:right}#ui-dialog-body.saves .empty{color:#999;speak:none;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves .datestamp{font-size:75%;margin-left:1em}#ui-dialog-body.saves ul.buttons li{padding:.4em}#ui-dialog-body.saves ul.buttons>li+li>button{margin-left:.2em}#ui-dialog-body.saves ul.buttons li:last-child{float:right}#ui-dialog-body.settings div[id|=header-body]{margin:1em 0}#ui-dialog-body.settings div[id|=header-body]:first-child{margin-top:0}#ui-dialog-body.settings div[id|=header-body]:not(:first-child){border-top:1px solid #444;padding-top:1em}#ui-dialog-body.settings div[id|=header-body]>*{margin:0}#ui-dialog-body.settings h2[id|=header-heading]{font-size:1.375em}#ui-dialog-body.settings p[id|=header-desc],#ui-dialog-body.settings p[id|=setting-desc]{font-size:87.5%;margin:0 0 0 .5em}#ui-dialog-body.settings div[id|=setting-body]+div[id|=setting-body]{margin:1em 0}#ui-dialog-body.settings [id|=setting-control]{white-space:nowrap}#ui-dialog-body.settings button[id|=setting-control]{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}#ui-dialog-body.settings button[id|=setting-control]:hover{background-color:#333;border-color:#eee}#ui-dialog-body.settings button[id|=setting-control].enabled{background-color:#282;border-color:#4a4}#ui-dialog-body.settings button[id|=setting-control].enabled:hover{background-color:#4a4;border-color:#6c6}#ui-dialog-body.settings input[type=range][id|=setting-control]{max-width:35vw}#ui-dialog-body.list a,#ui-dialog-body.settings span[id|=setting-input]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves button[id=saves-clear]:before,#ui-dialog-body.saves button[id=saves-export]:before,#ui-dialog-body.saves button[id=saves-import]:before,#ui-dialog-body.settings button[id|=setting-control].enabled:after,#ui-dialog-body.settings button[id|=setting-control]:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-dialog-body.saves button[id=saves-export]:before{content:"\e829\00a0"}#ui-dialog-body.saves button[id=saves-import]:before{content:"\e82a\00a0"}#ui-dialog-body.saves button[id=saves-clear]:before{content:"\e827\00a0"}#ui-dialog-body.settings button[id|=setting-control]:after{content:"\00a0\00a0\e830"}#ui-dialog-body.settings button[id|=setting-control].enabled:after{content:"\00a0\00a0\e831"}</style>
<style id="style-ui-bar" type="text/css">#story{margin-left:20em;-webkit-transition:margin-left .2s ease-in;-o-transition:margin-left .2s ease-in;transition:margin-left .2s ease-in}#ui-bar.stowed~#story{margin-left:4.5em}@media screen and (max-width:1136px){#story{margin-left:19em}#ui-bar.stowed~#story{margin-left:3.5em}}@media screen and (max-width:768px){#story{margin-left:3.5em}}#ui-bar{position:fixed;z-index:50;top:0;left:0;width:17.5em;height:100%;margin:0;padding:0;-webkit-transition:left .2s ease-in;-o-transition:left .2s ease-in;transition:left .2s ease-in}#ui-bar.stowed{left:-15.5em}#ui-bar-tray{position:absolute;top:.2em;left:0;right:0}#ui-bar-body{height:90%;height:calc(100% - 2.5em);margin:2.5em 0;padding:0 1.5em}#ui-bar.stowed #ui-bar-body,#ui-bar.stowed #ui-bar-history{visibility:hidden;-webkit-transition:visibility .2s step-end;-o-transition:visibility .2s step-end;transition:visibility .2s step-end}@media (prefers-reduced-motion:reduce){#story{-webkit-transition:margin-left 0s;-o-transition:margin-left 0s;transition:margin-left 0s}#ui-bar{-webkit-transition:left 0s;-o-transition:left 0s;transition:left 0s}}#ui-bar{background-color:#222;border-right:1px solid #444;text-align:center}#ui-bar a{text-decoration:none}#ui-bar hr{border-color:#444}#ui-bar-history [id|=history],#ui-bar-toggle{font-size:1.2em;line-height:inherit;color:#eee;background-color:transparent;border:1px solid #444}#ui-bar-toggle{display:block;position:absolute;top:0;right:0;border-right:none;padding:.3em .45em .25em}#ui-bar.stowed #ui-bar-toggle{padding:.3em .35em .25em .55em}#ui-bar-toggle:hover{background-color:#444;border-color:#eee}#ui-bar-history{margin:0 auto}#ui-bar-history [id|=history]{padding:.2em .45em .35em}#ui-bar-history #history-jumpto{padding:.2em .665em .35em}#ui-bar-history [id|=history]:not(:first-child){margin-left:1.2em}#ui-bar-history [id|=history]:hover{background-color:#444;border-color:#eee}#ui-bar-history [id|=history]:disabled{color:#444;background-color:transparent;border-color:#444}#ui-bar-body{line-height:1.5;overflow:auto}#ui-bar-body>:not(:first-child){margin-top:2em}#story-title{margin:0;font-size:162.5%}#story-author{margin-top:2em;font-weight:700}#menu ul{margin:1em 0 0;padding:0;list-style:none;border:1px solid #444}#menu ul:empty{display:none}#menu li{margin:0}#menu li:not(:first-child){border-top:1px solid #444}#menu li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-transform:uppercase}#menu li a:hover{background-color:#444;border-color:#eee}#menu a,#ui-bar-history [id|=history],#ui-bar-toggle{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#menu-core li[id|=menu-item] a:before,#ui-bar-history [id|=history],#ui-bar-toggle:before{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-bar-toggle:before{content:"\e81d"}#ui-bar.stowed #ui-bar-toggle:before{content:"\e81e"}#menu-item-saves a:before{content:"\e82b\00a0"}#menu-item-settings a:before{content:"\e82d\00a0"}#menu-item-restart a:before{content:"\e82c\00a0"}#menu-item-share a:before{content:"\e82f\00a0"}</style>
<style id="style-ui-debug" type="text/css">#debug-bar{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:0;margin:0;max-height:75%;padding:.5em;position:fixed;right:0;z-index:99900}#debug-bar>div:not([id])+div{margin-top:.5em}#debug-bar>div>label{margin-right:.5em}#debug-bar>div>input[type=text]{min-width:0;width:8em}#debug-bar>div>select{width:15em}#debug-bar-toggle{color:#eee;background-color:#222;border:1px solid #444;height:101%;height:calc(100% + 1px);left:-2em;left:calc(-2em - 1px);position:absolute;top:-1px;width:2em}#debug-bar-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-hint{bottom:.175em;font-size:4.5em;opacity:.33;pointer-events:none;position:fixed;right:.6em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap}#debug-bar-watch{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:102%;bottom:calc(100% + 1px);font-size:.9em;left:-1px;max-height:650%;max-height:65vh;position:absolute;overflow-x:hidden;overflow-y:scroll;right:0;z-index:99800}#debug-bar-watch[hidden]{display:none}#debug-bar-watch div{color:#999;font-style:italic;margin:1em auto;text-align:center}#debug-bar-watch table{width:100%}#debug-bar-watch tr:nth-child(2n){background-color:rgba(127,127,127,.15)}#debug-bar-watch td{padding:.2em 0}#debug-bar-watch td:first-child+td{padding:.2em .3em .2em .1em}#debug-bar-watch .watch-delete{background-color:transparent;border:none;color:#c00}#debug-bar-watch-all,#debug-bar-watch-none{margin-left:.5em}#debug-bar-views-toggle,#debug-bar-watch-toggle{color:#eee;background-color:transparent;border:1px solid #444;margin-right:1em;padding:.4em}#debug-bar-views-toggle:hover,#debug-bar-watch-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle,html[data-debug-view] #debug-bar-views-toggle{background-color:#282;border-color:#4a4}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:hover,html[data-debug-view] #debug-bar-views-toggle:hover{background-color:#4a4;border-color:#6c6}#debug-bar-hint:after,#debug-bar-toggle:before,#debug-bar-views-toggle:after,#debug-bar-watch .watch-delete:before,#debug-bar-watch-add:before,#debug-bar-watch-all:before,#debug-bar-watch-none:before,#debug-bar-watch-toggle:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#debug-bar-toggle:before{content:"\e838"}#debug-bar-hint:after{content:"\e838\202f\e822"}#debug-bar-watch .watch-delete:before{content:"\e804"}#debug-bar-watch-add:before{content:"\e805"}#debug-bar-watch-all:before{content:"\e83a"}#debug-bar-watch-none:before{content:"\e827"}#debug-bar-views-toggle:after,#debug-bar-watch-toggle:after{content:"\00a0\00a0\e830"}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:after,html[data-debug-view] #debug-bar-views-toggle:after{content:"\00a0\00a0\e831"}html[data-debug-view] .debug{padding:.25em;background-color:#234}html[data-debug-view] .debug[title]{cursor:help}html[data-debug-view] .debug.block{display:inline-block;vertical-align:middle}html[data-debug-view] .debug.invalid{text-decoration:line-through}html[data-debug-view] .debug.hidden,html[data-debug-view] .debug.hidden .debug{background-color:#555}html:not([data-debug-view]) .debug.hidden{display:none}html[data-debug-view] .debug[data-name][data-type].nonvoid:after,html[data-debug-view] .debug[data-name][data-type]:before{background-color:rgba(0,0,0,.25);font-family:monospace,monospace;white-space:pre}html[data-debug-view] .debug[data-name][data-type]:before{content:attr(data-name)}html[data-debug-view] .debug[data-name][data-type|=macro]:before{content:"<<" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=macro].nonvoid:after{content:"<</" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=html]:before{content:"<" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type|=html].nonvoid:after{content:"</" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type]:not(:empty):before{margin-right:.25em}html[data-debug-view] .debug[data-name][data-type].nonvoid:not(:empty):after{margin-left:.25em}html[data-debug-view] .debug[data-name][data-type|=special],html[data-debug-view] .debug[data-name][data-type|=special]:before{display:block}</style>
</head>
<body>
	<div id="init-screen">
		<div id="init-no-js"><noscript>JavaScript must be enabled to play.</noscript></div>
		<div id="init-lacking"><p>Browser lacks capabilities required to play.</p><p>Upgrade or switch to another browser.</p></div>
		<div id="init-loading"><div>Loading&hellip;</div></div>
	</div>
	<!-- UUID://E04806A0-81FA-41D2-9584-6C28B2D06BE4// --><tw-storydata name="a Prince&#39;s tale" startnode="720" creator="Tweego" creator-version="2.1.1" ifid="E04806A0-81FA-41D2-9584-6C28B2D06BE4" zoom="1" format="SugarCube" format-version="2.36.1" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">/* twine-user-stylesheet #1: "fonts.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
@font-face {
  font-family: medieval times;
  font-style: normal;
  font-weight: 400;
  src: local("Medieval Times"), url(https://fonts.cdnfonts.com/s/84344/MedievalTimes-AL7l6.woff) format("woff");
}
@font-face {
  font-family: "MedievalSharp";
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/medievalsharp/v26/EvOJzAlL3oU5AQl2mP5KdgptMqZwMinUPDhdog.woff2) format("woff2");
  unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
/* latin */
@font-face {
  font-family: "MedievalSharp";
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/medievalsharp/v26/EvOJzAlL3oU5AQl2mP5KdgptMqhwMinUPDg.woff2) format("woff2");
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: "JMH Beda";
  src: url("fonts/JMH_Beda.ttf") format("truetype"), url("fonts/JMH_Beda.otf") format("opentype");
}
@font-face {
  font-family: "Berry Rotunda";
  src: url("fonts/Berry_Rotunda.ttf") format("truetype");
}
.special {
  font-family: "Berry Rotunda";
}
.special.gold {
  text-shadow: 1px 1px 0 rgb(109, 93, 0), -1px 1px 0 rgb(109, 93, 0), -1px -1px 0 rgb(109, 93, 0), 1px -1px 0 rgb(109, 93, 0);
  color: rgb(255, 217, 0);
}
.special.brown {
  text-shadow: 1px 1px 0 rgb(182, 142, 64), -1px 1px 0 rgb(182, 142, 64), -1px -1px 0 rgb(182, 142, 64), 1px -1px 0 rgb(182, 142, 64);
  color: rgb(81, 54, 0);
}

.notice {
  display: block;
  text-align: center;
  margin: 20px 0;
  padding: 10px;
}
.notice.danger {
  color: rgb(173, 32, 32);
  border: rgb(173, 32, 32) 2px ridge;
  background: rgba(255, 0, 0, 0.231372549);
}
.notice.good {
  color: rgb(32, 173, 46);
  border: rgb(32, 173, 46) 2px ridge;
  background: rgba(21, 255, 0, 0.231372549);
}/*# sourceMappingURL=fonts.css.map */
/* twine-user-stylesheet #2: "icons.css" */
@charset "UTF-8";
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
.icon-suffix:after {
  font-family: tme-fa-icons;
  font-style: normal;
  font-weight: 400;
  font-variant: normal;
  text-transform: none;
  line-height: 1;
  speak: none;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
.icon-suffix.arrow-left:after {
  content: " \e819";
}
.icon-suffix.arrow-down:after {
  content: " \e818";
}
.icon-suffix.refresh:after {
  content: " \e825";
}

.icon-prefix:before {
  font-family: tme-fa-icons;
  font-style: normal;
  font-weight: 400;
  font-variant: normal;
  text-transform: none;
  line-height: 1;
  speak: none;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
.icon-prefix.bug:before {
  content: "\e838 ";
}
.icon-prefix.magic:before {
  content: "\e83a ";
}
.icon-prefix.star:before {
  content: "\e801 ";
}
.icon-prefix.info:before {
  content: "\e80a ";
}
.icon-prefix.save:before {
  content: "\e82b ";
}
.icon-prefix.image:before {
  content: "\e802 ";
}
.icon-prefix.letter:before {
  content: "\e83e ";
}

.icon-single:after {
  font-family: tme-fa-icons;
  font-style: normal;
  font-weight: 400;
  font-variant: normal;
  text-transform: none;
  line-height: 1;
  speak: none;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
.icon-single.volume-mute:after {
  content: "\e84a  ";
}
.icon-single.volume-down:after {
  content: "\e84b ";
}
.icon-single.volume-up:after {
  content: "\e84c";
}/*# sourceMappingURL=icons.css.map */
/* twine-user-stylesheet #3: "input.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
input, select, textarea {
  color: black;
}

input {
  background-color: grey;
}

input:not(:disabled):focus,
input:not(:disabled):hover,
select:not(:disabled):focus,
select:not(:disabled):hover,
textarea:not(:disabled):focus,
textarea:not(:disabled):hover {
  background-color: #b0b0b0;
}

button {
  color: black;
  border: 2px ridge var(--theme-color);
  background-color: var(--theme-color);
}
button:hover {
  border-color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  background-color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
}
button:active {
  border-style: groove;
}
button:disabled {
  border: 2px ridge color-mix(in srgb, var(--theme-color), #000000 50%);
  background-color: color-mix(in srgb, var(--theme-color), #000000 50%);
}
button:disabled:active {
  border-style: ridge;
}

.saves-button button, .credits-button button {
  display: block;
  margin: auto;
}

#name-picker {
  display: inline-block;
  margin-right: 5px;
}

input[type=checkbox] {
  transform: translateY(4px);
  -webkit-appearance: none;
     -moz-appearance: none;
          appearance: none;
  background-color: lightgrey;
  border-radius: 72px;
  border-style: none;
  flex-shrink: 0;
  height: 20px;
  margin: 0;
  position: relative;
  width: 30px;
}

input[type=checkbox]::before {
  bottom: -6px;
  content: "";
  left: -6px;
  position: absolute;
  right: -6px;
  top: -6px;
}

input[type=checkbox],
input[type=checkbox]::after {
  transition: all 100ms ease-out;
}

input[type=checkbox]::after {
  background-color: #fff;
  border-radius: 50%;
  content: "";
  height: 14px;
  left: 3px;
  position: absolute;
  top: 3px;
  width: 14px;
}

input[type=checkbox] {
  cursor: pointer;
}

input[type=checkbox]:hover {
  background-color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  transition-duration: 0s;
}

input[type=checkbox]:checked {
  background-color: var(--theme-color);
}

input[type=checkbox]:checked::after {
  background-color: #fff;
  left: 13px;
}

input[type=checkbox]:checked:hover {
  background-color: color-mix(in srgb, var(--theme-color), #000000 50%);
}

input[type=radio] {
  display: none;
  appearance: none;
  -moz-appearance: none;
  -webkit-appearance: none;
}

input[type=radio] + span {
  line-height: 22px;
  height: 22px;
  display: block;
  position: relative;
}

input[type=radio] + span:before, input[type=radio] + span:after {
  content: "";
  width: 22px;
  height: 22px;
  display: block;
  border-radius: 50%;
  left: 0;
  top: 0;
  position: absolute;
}

input[type=radio] + span:before {
  background: lightgrey;
  transition: background 0.2s ease, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 2);
}

input[type=radio] + span:after {
  background: #fff;
  transform: scale(0.78);
  transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.4);
}

input[type=radio]:checked + span:before {
  transform: scale(1.04);
  background: var(--theme-color);
}

input[type=radio]:checked + span:after {
  transform: scale(0.4);
  transition: transform 0.3s ease;
}

label:hover input[type=radio]:not(:checked) + span:before {
  background: var(--theme-color);
}/*# sourceMappingURL=input.css.map */
/* twine-user-stylesheet #4: "artifacts.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
#artifacts {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(15em, 15em));
  gap: 0.5em;
  justify-content: center;
  justify-items: center;
}
#artifacts .artifact {
  text-shadow: 1px 1px 0 var(--theme-color), -1px 1px 0 var(--theme-color), -1px -1px 0 var(--theme-color), 1px -1px 0 var(--theme-color);
  background: var(--theme-color);
  padding: 0;
  border-radius: 0;
  margin: 20px;
  padding: 10px;
  justify-content: center;
  text-align: center;
  width: 10em;
  line-height: 1.2;
}
#artifacts .artifact img.artifact-img {
  max-width: 8em;
  float: inherit;
  outline: 2px ridge var(--theme-color);
}
#artifacts .artifact span.artifact-name {
  justify-content: center;
}/*# sourceMappingURL=artifacts.css.map */
/* twine-user-stylesheet #5: "body.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
.body {
  position: relative;
  display: block;
  width: 360px;
  margin: 30px auto;
}
.body .body-elements {
  position: absolute;
  left: 2px;
  right: 2px;
  top: 2px;
  bottom: 2px;
  overflow: hidden;
}
.body .body-first {
  position: relative;
  height: 640px;
  left: 50%;
  transform: translateX(-50%);
  margin: auto;
  display: block;
}
.body .body-part {
  position: absolute;
  border: none;
  left: 50%;
  height: 640px;
  top: 0;
  transform: translateX(-50%);
}
.body .body-part.fadein {
  opacity: 1;
  animation: fadein 2s ease-in-out 1 both;
  animation-delay: 1s;
}
.body .body-part.fadeout {
  opacity: 0;
  animation: fadeout 2s ease-in-out 1 both;
  animation-delay: 1s;
}
.body .body-background {
  position: absolute;
  top: 2px;
  left: 2px;
  right: 2px;
  bottom: 2px;
  overflow: hidden;
}
.body .body-background img {
  position: absolute;
  height: 100%;
  left: 50%;
  transform: translateX(-50%);
  -moz-filter: blur(2px);
  -o-filter: blur(2px);
  -ms-filter: blur(2px);
  filter: blur(2px);
}
.body.outline {
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.body.outline:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.body.small {
  margin: auto;
}
.body.small .body-first, .body.small .body-part {
  transform: translateX(-50%) scale(2);
}
.body.small.chest .body-first, .body.small.chest .body-part {
  top: 0;
}
.body.small.hair .body-first, .body.small.hair .body-part {
  top: 150%;
}
.body.small.penis .body-first, .body.small.penis .body-part {
  top: -165%;
  transform: translateX(-48%) scale(2.1);
}
.body.chest, .body.hair, .body.penis {
  width: 256px;
  height: 256px;
}
.body.chest.small, .body.hair.small, .body.penis.small {
  width: 128px;
  height: 128px;
}
.body.chest.small .body-first, .body.chest.small .body-part, .body.hair.small .body-first, .body.hair.small .body-part, .body.penis.small .body-first, .body.penis.small .body-part {
  zoom: 50%;
}
.body.chest .body-first, .body.chest .body-part {
  height: 960px;
  top: -66%;
}
.body.hair .body-first, .body.hair .body-part {
  height: 960px;
  top: 0;
}
.body.penis .body-first, .body.penis .body-part {
  height: 960px;
  top: -150%;
}
.body.mirror {
  height: 640px;
  overflow: visible;
  margin-top: 80px;
  margin-bottom: 120px;
}
.body.mirror .body-elements {
  top: 0;
  bottom: 0;
  right: 0;
  left: 0;
}
.body.mirror .frame {
  top: -15%;
  left: 50%;
  position: absolute;
  width: 150%;
  transform: translateX(-50%);
}

@keyframes fadein {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
@keyframes fadeout {
  0% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}/*# sourceMappingURL=body.css.map */
/* twine-user-stylesheet #6: "book.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
.note {
  font-family: "Berry Rotunda";
  padding: 2em;
  transform-style: preserve-3d;
  transform: perspective(15em) rotateX(0deg) rotateY(0deg) rotateZ(-2deg);
  transition: transform 1s;
  position: relative;
  margin: auto;
  margin-top: 3em;
  margin-bottom: 6em;
  min-width: 10em;
  max-width: 30em;
  background-image: url(images/backgrounds/paper-background.jpg);
  background-repeat: repeat;
  background-size: 15em;
}
.note:hover {
  transform: perspective(15em) rotateX(-1deg) rotateY(1deg) rotateZ(0deg);
}
.note:hover .shadow {
  box-shadow: -2em 2em 2em 0px rgba(1, 1, 1, 0.4);
}
.note .shadow {
  background: transparent;
  transition: box-shadow 1s;
  box-shadow: -1em 1em 1em 0px rgba(1, 1, 1, 0.4);
  z-index: -1;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
}

.book {
  transform-style: preserve-3d;
  transform: perspective(150em) rotateX(14deg) rotateY(12deg) rotateZ(-3deg);
  transition: transform 1s;
  position: relative;
  margin: auto;
  margin-top: 3em;
  margin-bottom: 6em;
  min-width: 10em;
  max-width: 30em;
  height: 40em;
}
.book .side {
  width: 8em;
  max-height: 40em;
  height: 100%;
  position: absolute;
  left: -8em;
  top: 0;
  transform-origin: 100% 100%;
  transform: rotateY(-90deg) rotateX(0deg);
}
.book .bottom {
  width: 30em;
  height: 8em;
  position: absolute;
  bottom: 0;
  left: 0;
  transform-origin: 100% 100%;
  transform: rotateX(90deg);
}
.book.open {
  transform: perspective(150em) rotateX(10deg) rotateY(5deg) rotateZ(-3deg);
}
.book .paper,
.book .shadow {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
}
.book .shadow {
  background: transparent;
  transform: translateZ(-8em);
  box-shadow: -1em 1em 1em 0px rgba(1, 1, 1, 0.4);
  z-index: 1;
}
.book.interactable .paper:not(.first) .front:after {
  right: 0.5em;
  border-left: 0.75em solid #b0a687;
}
.book.interactable .paper:not(.first) .back:after {
  left: 0.5em;
  border-left: 0.75em solid #867e67;
}
.book.interactable .paper:not(.first) .page.finishable:after, .book.interactable .paper:not(.first) .page:not(.last):after {
  position: absolute;
  content: "";
  width: 0;
  height: 0;
  top: 50%;
  transform: translateY(-50%);
  border-top: 1em solid transparent;
  border-bottom: 1em solid transparent;
}
.book .paper {
  transition: transform 1s, box-shadow 0.5s 0.2s;
  transform-origin: 0 50%;
  transform-style: preserve-3d;
}
.book .paper.open {
  transform: rotateX(0deg) rotateY(-180deg) rotateZ(0deg);
}
.book .paper .page.front {
  transition: transform 1s, background-color 1s;
  transform-origin: 0 50%;
  backface-visibility: hidden;
  z-index: 2;
}
.book .paper .back {
  transition: transform 1s, background-color 1s;
  transform-origin: 0 50%;
}
.book .page {
  width: 100%;
  height: 100%;
  position: absolute;
  transform: translateZ(0px);
  overflow-y: auto;
}
.book .page::-webkit-scrollbar {
  width: 5px;
  height: 5px;
  background-color: transparent;
}
.book .page::-webkit-scrollbar-thumb {
  border-radius: 10px;
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
  background-color: grey;
}
.book .page::-webkit-scrollbar-track {
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
  border-radius: 10px;
  background-color: transparent;
}
.book .first.open {
  box-shadow: 1em 1em 1em 0.3em rgba(1, 1, 1, 0.4);
}
.book .first .front {
  transform: translateZ(0.4px);
}
.book .intro {
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  margin: auto;
}

.book .open.second .back {
  transform: translateZ(-1px);
}

.book .open.third .back {
  transform: translateZ(-2px);
}

.book .paper.second .front {
  transform: translateZ(0.3px);
}

.book .paper.third .front {
  transform: translateZ(0.2px);
}

.book .paper.fourth .front {
  transform: translateZ(0.1px);
}

.book .second-page #vara-container {
  width: 100%;
  height: 100%;
  padding: 1em;
}

.book-result {
  transition: opacity 0.4s ease-in;
  opacity: 0;
}

.book .side {
  background-color: #b36060;
}
.book .bottom {
  background-color: #a0967a;
}
.book .paper:not(.first) .page {
  background-color: #ddd0ab;
}
.book .paper:not(.first).open .page {
  background-color: #9f957a;
}
.book .paper:not(.first) .back {
  background-color: #565142;
}
.book .paper:not(.first).open .back {
  background-color: #a0967a;
}
.book .paper:not(.first) .contents .page-content {
  font-family: "Berry Rotunda";
  padding: 2em;
  font-size: 1em;
}
.book .first .page {
  background-color: #ef9a9a;
}
.book .first .page.front:after {
  position: absolute;
  content: "";
  width: 50%;
  height: 100%;
  left: 0;
  top: 0;
  background-color: rgba(160, 115, 115, 0.1);
}
.book .first .back {
  background-color: #ef9a9a;
}
.book .intro {
  border: 2em solid #eee;
}
.book .intro h1 {
  text-shadow: 1px 1px 0 #776618, -1px 1px 0 #776618, -1px -1px 0 #776618, 1px -1px 0 #776618;
  padding: 0.5em 0.25em;
  font-size: 2.6em;
  font-family: "JMH Beda";
  color: #fff;
  word-break: auto-phrase;
  text-align: center;
  margin-bottom: 0;
}
.book .intro h2 {
  text-shadow: 1px 1px 0 #776618, -1px 1px 0 #776618, -1px -1px 0 #776618, 1px -1px 0 #776618;
  padding: 0.5em 0.5em;
  font-size: 1.8em;
  font-family: "MedievalSharp";
  color: #fff;
  word-break: auto-phrase;
  text-align: center;
  margin-top: 0;
}

.book.dancing-knight .side {
  background-color: #ad9423;
}
.book.dancing-knight .first .page {
  background-color: #ddbc29;
}
.book.dancing-knight .first .page.front:after {
  position: absolute;
  content: "";
  width: 50%;
  height: 100%;
  left: 0;
  top: 0;
  background-color: rgba(160, 115, 115, 0.1);
}
.book.dancing-knight .first .back {
  background-color: #ad9423;
}
.book.dancing-knight .intro {
  border: 1em solid white;
}
.book.dancing-knight .intro h1 {
  text-shadow: 1px 1px 0 #776618, -1px 1px 0 #776618, -1px -1px 0 #776618, 1px -1px 0 #776618;
  padding: 0.5em 0.25em;
  font-size: 2.6em;
  font-family: "JMH Beda";
  color: #fff;
  word-break: auto-phrase;
  text-align: center;
}
.book.dancing-knight .intro h2 {
  text-shadow: 1px 1px 0 #776618, -1px 1px 0 #776618, -1px -1px 0 #776618, 1px -1px 0 #776618;
  padding: 0.5em 0.5em;
  font-size: 2em;
  font-family: "MedievalSharp";
  color: #fff;
  word-break: auto-phrase;
  text-align: center;
}

.book.duel .side {
  background-color: #151d4d;
}
.book.duel .first .page {
  background-color: #1f2d79;
}
.book.duel .first .page.front:after {
  position: absolute;
  content: "";
  width: 50%;
  height: 100%;
  left: 0;
  top: 0;
  background: none;
}
.book.duel .first .back {
  background-color: #151d4d;
}
.book.duel .intro {
  border: 1em ridge #5590fd;
}
.book.duel .intro h1 {
  text-shadow: 1px 1px 0 #000000, -1px 1px 0 #000000, -1px -1px 0 #000000, 1px -1px 0 #000000;
  padding: 0.5em 0.25em;
  font-size: 3.5em;
  font-family: "MedievalSharp";
  color: #5590fd;
  word-break: auto-phrase;
  text-align: center;
}
.book.duel .intro h2 {
  text-shadow: 1px 1px 0 #000000, -1px 1px 0 #000000, -1px -1px 0 #000000, 1px -1px 0 #000000;
  padding: 0.5em 0.5em;
  font-size: 2em;
  font-family: "MedievalSharp";
  color: #5590fd;
  word-break: auto-phrase;
  text-align: center;
}

.book.servant .side {
  background-color: #4d1515;
}
.book.servant .first .page {
  background-color: #852e2e;
}
.book.servant .first .page.front:after {
  position: absolute;
  content: "";
  width: 50%;
  height: 100%;
  left: 0;
  top: 0;
  background: none;
}
.book.servant .first .back {
  background-color: #691e1e;
}
.book.servant .intro {
  border: 1em ridge #fd55d3;
}
.book.servant .intro h1 {
  text-shadow: 1px 1px 0 #000000, -1px 1px 0 #000000, -1px -1px 0 #000000, 1px -1px 0 #000000;
  padding: 0.5em 0.25em;
  font-size: 3.5em;
  font-family: "JMH Beda";
  color: #fd55d3;
  word-break: auto-phrase;
  text-align: center;
}
.book.servant .intro h2 {
  text-shadow: 1px 1px 0 #000000, -1px 1px 0 #000000, -1px -1px 0 #000000, 1px -1px 0 #000000;
  padding: 0.5em 0.5em;
  font-size: 2em;
  font-family: "MedievalSharp";
  color: #fd55d3;
  word-break: auto-phrase;
  text-align: center;
}

.book.dinner-etiquette .side {
  background-color: #441855;
}
.book.dinner-etiquette .first .page {
  background-color: #7b2e85;
}
.book.dinner-etiquette .first .page.front:after {
  position: absolute;
  content: "";
  width: 50%;
  height: 100%;
  left: 0;
  top: 0;
  background: none;
}
.book.dinner-etiquette .first .back {
  background-color: #441855;
}
.book.dinner-etiquette .intro {
  border: 1em double #9d94bf;
}
.book.dinner-etiquette .intro h1 {
  text-shadow: 1px 1px 0 #000000, -1px 1px 0 #000000, -1px -1px 0 #000000, 1px -1px 0 #000000;
  margin-top: 1em;
  padding: 0.5em 0.25em;
  font-size: 2.5em;
  font-family: "JMH Beda";
  color: #9d94bf;
  word-break: auto-phrase;
  text-align: center;
}
.book.dinner-etiquette .intro h2 {
  text-shadow: 1px 1px 0 #000000, -1px 1px 0 #000000, -1px -1px 0 #000000, 1px -1px 0 #000000;
  padding: 0.5em 0.5em;
  font-size: 2em;
  font-family: "MedievalSharp";
  color: #9d94bf;
  word-break: auto-phrase;
  text-align: center;
}

.book.histories .side {
  width: 16em;
  left: -16em;
  background-color: #0d4e00;
}
.book.histories .bottom {
  height: 16em;
}
.book.histories .shadow {
  transform: translateZ(-16em);
}
.book.histories .first .page {
  background-color: #166806;
}
.book.histories .first .page.front:after {
  position: absolute;
  content: "";
  width: 50%;
  height: 100%;
  left: 0;
  top: 0;
  background: none;
}
.book.histories .first .back {
  background-color: #0d4e00;
}
.book.histories .intro {
  border: 0.5em dashed #ddbc00;
}
.book.histories .intro h1 {
  text-shadow: 1px 1px 0 #000000, -1px 1px 0 #000000, -1px -1px 0 #000000, 1px -1px 0 #000000;
  padding: 0.5em 0.25em;
  font-size: 3.2em;
  margin-top: 1.5em;
  font-family: "MedievalSharp";
  color: #ddbc00;
  word-break: auto-phrase;
  text-align: center;
}
.book.histories .intro h2 {
  text-shadow: 1px 1px 0 #000000, -1px 1px 0 #000000, -1px -1px 0 #000000, 1px -1px 0 #000000;
  padding: 0.5em 0.5em;
  font-size: 2em;
  margin-top: 2em;
  font-family: "JMH Beda";
  color: #ddbc00;
  word-break: auto-phrase;
  text-align: center;
}

.book.tome-of-memories .side {
  width: 16em;
  left: -16em;
  background-color: #001c0d;
}
.book.tome-of-memories .bottom {
  height: 16em;
}
.book.tome-of-memories .shadow {
  transform: translateZ(-16em);
}
.book.tome-of-memories .page-content img.portrait {
  padding: 2px;
  width: 6em;
  float: left;
  margin-right: 1.5em;
}
.book.tome-of-memories .page-content .decision, .book.tome-of-memories .page-content .memory-text {
  position: absolute;
  bottom: 2em;
  left: 50%;
  transform: translateX(-50%);
}
.book.tome-of-memories .page-content .decision.decision:hover, .book.tome-of-memories .page-content .memory-text.decision:hover {
  transform: translate(-50%, -2px);
}
.book.tome-of-memories .page-content .memory-text {
  text-shadow: 1px 1px 0 rgba(0, 255, 136, 0.8), -1px 1px 0 rgba(0, 255, 136, 0.8), -1px -1px 0 rgba(0, 255, 136, 0.8), 1px -1px 0 rgba(0, 255, 136, 0.8);
  width: 80%;
  text-align: center;
}
.book.tome-of-memories .page-content h2 {
  margin-top: 0;
}
.book.tome-of-memories .first .page {
  background-color: #003a1b;
}
.book.tome-of-memories .first .page.front:after {
  position: absolute;
  content: "";
  width: 50%;
  height: 100%;
  left: 0;
  top: 0;
  background: none;
}
.book.tome-of-memories .first .back {
  background-color: #003a1b;
}
.book.tome-of-memories .intro {
  border: 1em double #ddbc00;
}
.book.tome-of-memories .intro h1 {
  text-shadow: 1px 1px 0 #000000, -1px 1px 0 #000000, -1px -1px 0 #000000, 1px -1px 0 #000000;
  padding: 0.5em 0.25em;
  font-size: 3.2em;
  margin-top: 2.5em;
  font-family: "Berry Rotunda";
  color: #ddbc00;
  word-break: auto-phrase;
  text-align: center;
  line-height: normal;
}
.book.tome-of-memories .intro h2 {
  text-shadow: 1px 1px 0 #000000, -1px 1px 0 #000000, -1px -1px 0 #000000, 1px -1px 0 #000000;
  padding: 0.5em 0.5em;
  font-size: 2em;
  margin-top: 2em;
  font-family: "JMH Beda";
  color: #ddbc00;
  word-break: auto-phrase;
  text-align: center;
}/*# sourceMappingURL=book.css.map */
/* twine-user-stylesheet #7: "characters.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
img.player {
  border-color: var(--player-color);
}

.player {
  color: var(--player-color);
  border-color: var(--player-color);
  text-decoration-color: rgba(var(--player-color), 0.5);
}
.player .name:not(.player) {
  text-shadow: none;
}
.player img {
  border-color: var(--player-color);
}
.player.name {
  color: var(--player-color);
}
.player h4 {
  color: var(--player-color);
}
.player.say-box, .player#ui-dialog-body {
  border: 5px;
  border-color: var(--player-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--player-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--player-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--player-color), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.player.say-box:after, .player#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.player.say-box #character-popup-image, .player#ui-dialog-body #character-popup-image {
  border: 2px ridge var(--player-color);
}
.player.say-box h4, .player#ui-dialog-body h4 {
  border-bottom: 2px ridge var(--player-color);
}

.king {
  color: rgb(255, 215, 0);
  border-color: rgb(255, 215, 0);
  text-decoration-color: rgba(255, 215, 0, 0.5);
}
.king.say-box, .king#ui-dialog-body {
  border: 5px;
  border-color: rgb(255, 215, 0);
  border-style: dashed;
  background: color-mix(in srgb, rgb(255, 215, 0), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(255, 215, 0), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(255, 215, 0), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.king.say-box:after, .king#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.king.say-box #character-popup-image, .king#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(255, 215, 0);
}
.king.say-box h4, .king#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(255, 215, 0);
}
.king.book-portrait {
  border: 5px;
  border-color: rgb(255, 215, 0);
  border-style: dashed;
  background: color-mix(in srgb, rgb(255, 215, 0), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(255, 215, 0), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(255, 215, 0), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.king.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.king.name {
  text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5), -1px 1px 0 rgba(0, 0, 0, 0.5), -1px -1px 0 rgba(0, 0, 0, 0.5), 1px -1px 0 rgba(0, 0, 0, 0.5);
  text-decoration-style: dotted;
}

.orson {
  color: rgb(225, 225, 225);
  border-color: rgb(225, 225, 225);
  text-decoration-color: rgba(225, 225, 225, 0.5);
}
.orson.say-box, .orson#ui-dialog-body {
  border: 5px;
  border-color: rgb(225, 225, 225);
  border-style: dashed;
  background: color-mix(in srgb, rgb(225, 225, 225), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(225, 225, 225), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(225, 225, 225), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.orson.say-box:after, .orson#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.orson.say-box #character-popup-image, .orson#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(225, 225, 225);
}
.orson.say-box h4, .orson#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(225, 225, 225);
}
.orson.book-portrait {
  border: 5px;
  border-color: rgb(225, 225, 225);
  border-style: dashed;
  background: color-mix(in srgb, rgb(225, 225, 225), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(225, 225, 225), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(225, 225, 225), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.orson.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.orson.name {
  text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5), -1px 1px 0 rgba(0, 0, 0, 0.5), -1px -1px 0 rgba(0, 0, 0, 0.5), 1px -1px 0 rgba(0, 0, 0, 0.5);
  text-decoration-style: dotted;
}

.morgana {
  color: purple;
  border-color: purple;
  text-decoration-color: rgba(128, 0, 128, 0.5);
}
.morgana.say-box, .morgana#ui-dialog-body {
  border: 5px;
  border-color: purple;
  border-style: dashed;
  background: color-mix(in srgb, purple, #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, purple, #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, purple, #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.morgana.say-box:after, .morgana#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.morgana.say-box #character-popup-image, .morgana#ui-dialog-body #character-popup-image {
  border: 2px ridge purple;
}
.morgana.say-box h4, .morgana#ui-dialog-body h4 {
  border-bottom: 2px ridge purple;
}
.morgana.book-portrait {
  border: 5px;
  border-color: purple;
  border-style: dashed;
  background: color-mix(in srgb, purple, #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, purple, #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, purple, #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.morgana.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.morgana.name {
  text-shadow: none;
}

.rosa {
  color: rgb(251, 231, 161);
  border-color: rgb(251, 231, 161);
  text-decoration-color: rgba(251, 231, 161, 0.5);
}
.rosa.say-box, .rosa#ui-dialog-body {
  border: 5px;
  border-color: rgb(251, 231, 161);
  border-style: dashed;
  background: color-mix(in srgb, rgb(251, 231, 161), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(251, 231, 161), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(251, 231, 161), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.rosa.say-box:after, .rosa#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.rosa.say-box #character-popup-image, .rosa#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(251, 231, 161);
}
.rosa.say-box h4, .rosa#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(251, 231, 161);
}
.rosa.book-portrait {
  border: 5px;
  border-color: rgb(251, 231, 161);
  border-style: dashed;
  background: color-mix(in srgb, rgb(251, 231, 161), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(251, 231, 161), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(251, 231, 161), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.rosa.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.rosa.name {
  text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5), -1px 1px 0 rgba(0, 0, 0, 0.5), -1px -1px 0 rgba(0, 0, 0, 0.5), 1px -1px 0 rgba(0, 0, 0, 0.5);
  text-decoration-style: dotted;
}

.andreas {
  color: rgb(34, 28, 109);
  border-color: rgb(34, 28, 109);
  text-decoration-color: rgba(34, 28, 109, 0.5);
}
.andreas.say-box, .andreas#ui-dialog-body {
  border: 5px;
  border-color: rgb(34, 28, 109);
  border-style: dashed;
  background: color-mix(in srgb, rgb(34, 28, 109), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(34, 28, 109), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(34, 28, 109), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.andreas.say-box:after, .andreas#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.andreas.say-box #character-popup-image, .andreas#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(34, 28, 109);
}
.andreas.say-box h4, .andreas#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(34, 28, 109);
}
.andreas.book-portrait {
  border: 5px;
  border-color: rgb(34, 28, 109);
  border-style: dashed;
  background: color-mix(in srgb, rgb(34, 28, 109), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(34, 28, 109), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(34, 28, 109), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.andreas.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.andreas.name {
  text-shadow: none;
}

.sybille {
  color: rgb(255, 255, 255);
  border-color: rgb(255, 255, 255);
  text-decoration-color: rgba(255, 255, 255, 0.5);
}
.sybille.say-box, .sybille#ui-dialog-body {
  border: 5px;
  border-color: rgb(255, 255, 255);
  border-style: dashed;
  background: color-mix(in srgb, rgb(255, 255, 255), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(255, 255, 255), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(255, 255, 255), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.sybille.say-box:after, .sybille#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.sybille.say-box #character-popup-image, .sybille#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(255, 255, 255);
}
.sybille.say-box h4, .sybille#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(255, 255, 255);
}
.sybille.book-portrait {
  border: 5px;
  border-color: rgb(255, 255, 255);
  border-style: dashed;
  background: color-mix(in srgb, rgb(255, 255, 255), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(255, 255, 255), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(255, 255, 255), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.sybille.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.sybille.name {
  text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5), -1px 1px 0 rgba(0, 0, 0, 0.5), -1px -1px 0 rgba(0, 0, 0, 0.5), 1px -1px 0 rgba(0, 0, 0, 0.5);
  text-decoration-style: dotted;
}

.leopold {
  color: darkgreen;
  border-color: darkgreen;
  text-decoration-color: rgba(0, 100, 0, 0.5);
}
.leopold.say-box, .leopold#ui-dialog-body {
  border: 5px;
  border-color: darkgreen;
  border-style: dashed;
  background: color-mix(in srgb, darkgreen, #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, darkgreen, #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, darkgreen, #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.leopold.say-box:after, .leopold#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.leopold.say-box #character-popup-image, .leopold#ui-dialog-body #character-popup-image {
  border: 2px ridge darkgreen;
}
.leopold.say-box h4, .leopold#ui-dialog-body h4 {
  border-bottom: 2px ridge darkgreen;
}
.leopold.book-portrait {
  border: 5px;
  border-color: darkgreen;
  border-style: dashed;
  background: color-mix(in srgb, darkgreen, #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, darkgreen, #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, darkgreen, #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.leopold.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.leopold.name {
  text-shadow: none;
}

.wymerus {
  color: rgb(33, 33, 33);
  border-color: rgb(33, 33, 33);
  text-decoration-color: rgba(33, 33, 33, 0.5);
}
.wymerus.say-box, .wymerus#ui-dialog-body {
  border: 5px;
  border-color: rgb(33, 33, 33);
  border-style: dashed;
  background: color-mix(in srgb, rgb(33, 33, 33), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(33, 33, 33), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(33, 33, 33), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.wymerus.say-box:after, .wymerus#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.wymerus.say-box #character-popup-image, .wymerus#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(33, 33, 33);
}
.wymerus.say-box h4, .wymerus#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(33, 33, 33);
}
.wymerus.book-portrait {
  border: 5px;
  border-color: rgb(33, 33, 33);
  border-style: dashed;
  background: color-mix(in srgb, rgb(33, 33, 33), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(33, 33, 33), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(33, 33, 33), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.wymerus.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.wymerus.name {
  text-shadow: none;
}

.caspar {
  color: rgb(202, 7, 7);
  border-color: rgb(202, 7, 7);
  text-decoration-color: rgba(202, 7, 7, 0.5);
}
.caspar.say-box, .caspar#ui-dialog-body {
  border: 5px;
  border-color: rgb(202, 7, 7);
  border-style: dashed;
  background: color-mix(in srgb, rgb(202, 7, 7), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(202, 7, 7), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(202, 7, 7), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.caspar.say-box:after, .caspar#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.caspar.say-box #character-popup-image, .caspar#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(202, 7, 7);
}
.caspar.say-box h4, .caspar#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(202, 7, 7);
}
.caspar.book-portrait {
  border: 5px;
  border-color: rgb(202, 7, 7);
  border-style: dashed;
  background: color-mix(in srgb, rgb(202, 7, 7), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(202, 7, 7), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(202, 7, 7), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.caspar.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.caspar.name {
  text-shadow: none;
}

.devota {
  color: rgb(247, 215, 34);
  border-color: rgb(247, 215, 34);
  text-decoration-color: rgba(247, 215, 34, 0.5);
}
.devota.say-box, .devota#ui-dialog-body {
  border: 5px;
  border-color: rgb(247, 215, 34);
  border-style: dashed;
  background: color-mix(in srgb, rgb(247, 215, 34), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(247, 215, 34), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(247, 215, 34), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.devota.say-box:after, .devota#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.devota.say-box #character-popup-image, .devota#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(247, 215, 34);
}
.devota.say-box h4, .devota#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(247, 215, 34);
}
.devota.book-portrait {
  border: 5px;
  border-color: rgb(247, 215, 34);
  border-style: dashed;
  background: color-mix(in srgb, rgb(247, 215, 34), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(247, 215, 34), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(247, 215, 34), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.devota.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.devota.name {
  text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5), -1px 1px 0 rgba(0, 0, 0, 0.5), -1px -1px 0 rgba(0, 0, 0, 0.5), 1px -1px 0 rgba(0, 0, 0, 0.5);
  text-decoration-style: dotted;
}

.generic {
  color: rgb(75, 75, 75);
  border-color: rgb(75, 75, 75);
  text-decoration-color: rgba(75, 75, 75, 0.5);
}
.generic.say-box, .generic#ui-dialog-body {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.generic.say-box:after, .generic#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.generic.say-box #character-popup-image, .generic#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(75, 75, 75);
}
.generic.say-box h4, .generic#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(75, 75, 75);
}
.generic.book-portrait {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.generic.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.generic.name {
  text-shadow: none;
}

.godric {
  color: rgb(75, 75, 75);
  border-color: rgb(75, 75, 75);
  text-decoration-color: rgba(75, 75, 75, 0.5);
}
.godric.say-box, .godric#ui-dialog-body {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.godric.say-box:after, .godric#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.godric.say-box #character-popup-image, .godric#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(75, 75, 75);
}
.godric.say-box h4, .godric#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(75, 75, 75);
}
.godric.book-portrait {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.godric.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.godric.name {
  text-shadow: none;
}

.guard {
  color: rgb(75, 75, 75);
  border-color: rgb(75, 75, 75);
  text-decoration-color: rgba(75, 75, 75, 0.5);
}
.guard.say-box, .guard#ui-dialog-body {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.guard.say-box:after, .guard#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.guard.say-box #character-popup-image, .guard#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(75, 75, 75);
}
.guard.say-box h4, .guard#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(75, 75, 75);
}
.guard.book-portrait {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.guard.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.guard.name {
  text-shadow: none;
}

.kathryn {
  color: rgb(141, 4, 4);
  border-color: rgb(141, 4, 4);
  text-decoration-color: rgba(141, 4, 4, 0.5);
}
.kathryn.say-box, .kathryn#ui-dialog-body {
  border: 5px;
  border-color: rgb(141, 4, 4);
  border-style: dashed;
  background: color-mix(in srgb, rgb(141, 4, 4), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(141, 4, 4), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(141, 4, 4), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.kathryn.say-box:after, .kathryn#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.kathryn.say-box #character-popup-image, .kathryn#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(141, 4, 4);
}
.kathryn.say-box h4, .kathryn#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(141, 4, 4);
}
.kathryn.book-portrait {
  border: 5px;
  border-color: rgb(141, 4, 4);
  border-style: dashed;
  background: color-mix(in srgb, rgb(141, 4, 4), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(141, 4, 4), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(141, 4, 4), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.kathryn.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.kathryn.name {
  text-shadow: none;
}

.velma {
  color: rgb(139, 89, 7);
  border-color: rgb(139, 89, 7);
  text-decoration-color: rgba(139, 89, 7, 0.5);
}
.velma.say-box, .velma#ui-dialog-body {
  border: 5px;
  border-color: rgb(139, 89, 7);
  border-style: dashed;
  background: color-mix(in srgb, rgb(139, 89, 7), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(139, 89, 7), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(139, 89, 7), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.velma.say-box:after, .velma#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.velma.say-box #character-popup-image, .velma#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(139, 89, 7);
}
.velma.say-box h4, .velma#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(139, 89, 7);
}
.velma.book-portrait {
  border: 5px;
  border-color: rgb(139, 89, 7);
  border-style: dashed;
  background: color-mix(in srgb, rgb(139, 89, 7), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(139, 89, 7), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(139, 89, 7), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.velma.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.velma.name {
  text-shadow: none;
}

.hyssop {
  color: rgb(9, 58, 1);
  border-color: rgb(9, 58, 1);
  text-decoration-color: rgba(9, 58, 1, 0.5);
}
.hyssop.say-box, .hyssop#ui-dialog-body {
  border: 5px;
  border-color: rgb(9, 58, 1);
  border-style: dashed;
  background: color-mix(in srgb, rgb(9, 58, 1), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(9, 58, 1), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(9, 58, 1), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.hyssop.say-box:after, .hyssop#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.hyssop.say-box #character-popup-image, .hyssop#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(9, 58, 1);
}
.hyssop.say-box h4, .hyssop#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(9, 58, 1);
}
.hyssop.book-portrait {
  border: 5px;
  border-color: rgb(9, 58, 1);
  border-style: dashed;
  background: color-mix(in srgb, rgb(9, 58, 1), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(9, 58, 1), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(9, 58, 1), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.hyssop.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.hyssop.name {
  text-shadow: none;
}

.beau {
  color: black;
  border-color: black;
  text-decoration-color: rgba(0, 0, 0, 0.5);
}
.beau.say-box, .beau#ui-dialog-body {
  border: 5px;
  border-color: black;
  border-style: dashed;
  background: color-mix(in srgb, black, #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, black, #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, black, #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.beau.say-box:after, .beau#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.beau.say-box #character-popup-image, .beau#ui-dialog-body #character-popup-image {
  border: 2px ridge black;
}
.beau.say-box h4, .beau#ui-dialog-body h4 {
  border-bottom: 2px ridge black;
}
.beau.book-portrait {
  border: 5px;
  border-color: black;
  border-style: dashed;
  background: color-mix(in srgb, black, #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, black, #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, black, #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.beau.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.beau.name {
  text-shadow: none;
}

.bandit {
  color: rgb(75, 75, 75);
  border-color: rgb(75, 75, 75);
  text-decoration-color: rgba(75, 75, 75, 0.5);
}
.bandit.say-box, .bandit#ui-dialog-body {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.bandit.say-box:after, .bandit#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.bandit.say-box #character-popup-image, .bandit#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(75, 75, 75);
}
.bandit.say-box h4, .bandit#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(75, 75, 75);
}
.bandit.book-portrait {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.bandit.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.bandit.name {
  text-shadow: none;
}

.reading {
  color: rgb(75, 75, 75);
  border-color: rgb(75, 75, 75);
  text-decoration-color: rgba(75, 75, 75, 0.5);
}
.reading.say-box, .reading#ui-dialog-body {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.reading.say-box:after, .reading#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.reading.say-box #character-popup-image, .reading#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(75, 75, 75);
}
.reading.say-box h4, .reading#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(75, 75, 75);
}
.reading.book-portrait {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.reading.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.reading.name {
  text-shadow: none;
}

.eve {
  color: rgb(189, 0, 154);
  border-color: rgb(189, 0, 154);
  text-decoration-color: rgba(189, 0, 154, 0.5);
}
.eve.say-box, .eve#ui-dialog-body {
  border: 5px;
  border-color: rgb(189, 0, 154);
  border-style: dashed;
  background: color-mix(in srgb, rgb(189, 0, 154), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(189, 0, 154), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(189, 0, 154), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.eve.say-box:after, .eve#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.eve.say-box #character-popup-image, .eve#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(189, 0, 154);
}
.eve.say-box h4, .eve#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(189, 0, 154);
}
.eve.book-portrait {
  border: 5px;
  border-color: rgb(189, 0, 154);
  border-style: dashed;
  background: color-mix(in srgb, rgb(189, 0, 154), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(189, 0, 154), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(189, 0, 154), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.eve.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.eve.name {
  text-shadow: none;
}

.jack {
  color: rgb(75, 75, 75);
  border-color: rgb(75, 75, 75);
  text-decoration-color: rgba(75, 75, 75, 0.5);
}
.jack.say-box, .jack#ui-dialog-body {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.jack.say-box:after, .jack#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.jack.say-box #character-popup-image, .jack#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(75, 75, 75);
}
.jack.say-box h4, .jack#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(75, 75, 75);
}
.jack.book-portrait {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.jack.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.jack.name {
  text-shadow: none;
}

.quinn {
  color: rgb(8, 90, 109);
  border-color: rgb(8, 90, 109);
  text-decoration-color: rgba(8, 90, 109, 0.5);
}
.quinn.say-box, .quinn#ui-dialog-body {
  border: 5px;
  border-color: rgb(8, 90, 109);
  border-style: dashed;
  background: color-mix(in srgb, rgb(8, 90, 109), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(8, 90, 109), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(8, 90, 109), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.quinn.say-box:after, .quinn#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.quinn.say-box #character-popup-image, .quinn#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(8, 90, 109);
}
.quinn.say-box h4, .quinn#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(8, 90, 109);
}
.quinn.book-portrait {
  border: 5px;
  border-color: rgb(8, 90, 109);
  border-style: dashed;
  background: color-mix(in srgb, rgb(8, 90, 109), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(8, 90, 109), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(8, 90, 109), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.quinn.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.quinn.name {
  text-shadow: none;
}

.merry {
  color: rgb(110, 253, 110);
  border-color: rgb(110, 253, 110);
  text-decoration-color: rgba(110, 253, 110, 0.5);
}
.merry.say-box, .merry#ui-dialog-body {
  border: 5px;
  border-color: rgb(110, 253, 110);
  border-style: dashed;
  background: color-mix(in srgb, rgb(110, 253, 110), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(110, 253, 110), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(110, 253, 110), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.merry.say-box:after, .merry#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.merry.say-box #character-popup-image, .merry#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(110, 253, 110);
}
.merry.say-box h4, .merry#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(110, 253, 110);
}
.merry.book-portrait {
  border: 5px;
  border-color: rgb(110, 253, 110);
  border-style: dashed;
  background: color-mix(in srgb, rgb(110, 253, 110), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(110, 253, 110), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(110, 253, 110), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.merry.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.merry.name {
  text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5), -1px 1px 0 rgba(0, 0, 0, 0.5), -1px -1px 0 rgba(0, 0, 0, 0.5), 1px -1px 0 rgba(0, 0, 0, 0.5);
  text-decoration-style: dotted;
}

.pepper {
  color: rgb(211, 220, 220);
  border-color: rgb(211, 220, 220);
  text-decoration-color: rgba(211, 220, 220, 0.5);
}
.pepper.say-box, .pepper#ui-dialog-body {
  border: 5px;
  border-color: rgb(211, 220, 220);
  border-style: dashed;
  background: color-mix(in srgb, rgb(211, 220, 220), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(211, 220, 220), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(211, 220, 220), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.pepper.say-box:after, .pepper#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.pepper.say-box #character-popup-image, .pepper#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(211, 220, 220);
}
.pepper.say-box h4, .pepper#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(211, 220, 220);
}
.pepper.book-portrait {
  border: 5px;
  border-color: rgb(211, 220, 220);
  border-style: dashed;
  background: color-mix(in srgb, rgb(211, 220, 220), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(211, 220, 220), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(211, 220, 220), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.pepper.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.pepper.name {
  text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5), -1px 1px 0 rgba(0, 0, 0, 0.5), -1px -1px 0 rgba(0, 0, 0, 0.5), 1px -1px 0 rgba(0, 0, 0, 0.5);
  text-decoration-style: dotted;
}

.leave {
  color: rgb(75, 75, 75);
  border-color: rgb(75, 75, 75);
  text-decoration-color: rgba(75, 75, 75, 0.5);
}
.leave.say-box, .leave#ui-dialog-body {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.leave.say-box:after, .leave#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.leave.say-box #character-popup-image, .leave#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(75, 75, 75);
}
.leave.say-box h4, .leave#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(75, 75, 75);
}
.leave.book-portrait {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.leave.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.leave.name {
  text-shadow: none;
}

.bread {
  color: rgb(75, 75, 75);
  border-color: rgb(75, 75, 75);
  text-decoration-color: rgba(75, 75, 75, 0.5);
}
.bread.say-box, .bread#ui-dialog-body {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.bread.say-box:after, .bread#ui-dialog-body:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.bread.say-box #character-popup-image, .bread#ui-dialog-body #character-popup-image {
  border: 2px ridge rgb(75, 75, 75);
}
.bread.say-box h4, .bread#ui-dialog-body h4 {
  border-bottom: 2px ridge rgb(75, 75, 75);
}
.bread.book-portrait {
  border: 5px;
  border-color: rgb(75, 75, 75);
  border-style: dashed;
  background: color-mix(in srgb, rgb(75, 75, 75), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), 0 0 0 10px #ddd0ab, inset 0 0 0 2px color-mix(in srgb, rgb(75, 75, 75), #000000 50%), inset 0 0 0 15px #ddd0ab, inset 0 0 100vw 100vw #ddd0ab;
}
.bread.book-portrait:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.bread.name {
  text-shadow: none;
}/*# sourceMappingURL=characters.css.map */
/* twine-user-stylesheet #8: "coloris.min.css" */
.clr-picker{display:none;flex-wrap:wrap;position:absolute;width:200px;z-index:1000;border-radius:10px;background-color:#fff;justify-content:flex-end;direction:ltr;box-shadow:0 0 5px rgba(0,0,0,.05),0 5px 20px rgba(0,0,0,.1);-moz-user-select:none;-webkit-user-select:none;user-select:none}.clr-picker.clr-open,.clr-picker[data-inline=true]{display:flex}.clr-picker[data-inline=true]{position:relative}.clr-gradient{position:relative;width:100%;height:100px;margin-bottom:15px;border-radius:3px 3px 0 0;background-image:linear-gradient(rgba(0,0,0,0),#000),linear-gradient(90deg,#fff,currentColor);cursor:pointer}.clr-marker{position:absolute;width:12px;height:12px;margin:-6px 0 0 -6px;border:1px solid #fff;border-radius:50%;background-color:currentColor;cursor:pointer}.clr-picker input[type=range]::-webkit-slider-runnable-track{width:100%;height:16px}.clr-picker input[type=range]::-webkit-slider-thumb{width:16px;height:16px;-webkit-appearance:none}.clr-picker input[type=range]::-moz-range-track{width:100%;height:16px;border:0}.clr-picker input[type=range]::-moz-range-thumb{width:16px;height:16px;border:0}.clr-hue{background-image:linear-gradient(to right,red 0,#ff0 16.66%,#0f0 33.33%,#0ff 50%,#00f 66.66%,#f0f 83.33%,red 100%)}.clr-alpha,.clr-hue{position:relative;width:calc(100% - 40px);height:8px;margin:5px 20px;border-radius:4px}.clr-alpha span{display:block;height:100%;width:100%;border-radius:inherit;background-image:linear-gradient(90deg,rgba(0,0,0,0),currentColor)}.clr-alpha input[type=range],.clr-hue input[type=range]{position:absolute;width:calc(100% + 32px);height:16px;left:-16px;top:-4px;margin:0;background-color:transparent;opacity:0;cursor:pointer;appearance:none;-webkit-appearance:none}.clr-alpha div,.clr-hue div{position:absolute;width:16px;height:16px;left:0;top:50%;margin-left:-8px;transform:translateY(-50%);border:2px solid #fff;border-radius:50%;background-color:currentColor;box-shadow:0 0 1px #888;pointer-events:none}.clr-alpha div:before{content:'';position:absolute;height:100%;width:100%;left:0;top:0;border-radius:50%;background-color:currentColor}.clr-format{display:none;order:1;width:calc(100% - 40px);margin:0 20px 20px}.clr-segmented{display:flex;position:relative;width:100%;margin:0;padding:0;border:1px solid #ddd;border-radius:15px;box-sizing:border-box;color:#999;font-size:12px}.clr-segmented input,.clr-segmented legend{position:absolute;width:100%;height:100%;margin:0;padding:0;border:0;left:0;top:0;opacity:0;pointer-events:none}.clr-segmented label{flex-grow:1;margin:0;padding:4px 0;font-size:inherit;font-weight:400;line-height:initial;text-align:center;cursor:pointer}.clr-segmented label:first-of-type{border-radius:10px 0 0 10px}.clr-segmented label:last-of-type{border-radius:0 10px 10px 0}.clr-segmented input:checked+label{color:#fff;background-color:#666}.clr-swatches{order:2;width:calc(100% - 32px);margin:0 16px}.clr-swatches div{display:flex;flex-wrap:wrap;padding-bottom:12px;justify-content:center}.clr-swatches button{position:relative;width:20px;height:20px;margin:0 4px 6px 4px;padding:0;border:0;border-radius:50%;color:inherit;text-indent:-1000px;white-space:nowrap;overflow:hidden;cursor:pointer}.clr-swatches button:after{content:'';display:block;position:absolute;width:100%;height:100%;left:0;top:0;border-radius:inherit;background-color:currentColor;box-shadow:inset 0 0 0 1px rgba(0,0,0,.1)}input.clr-color{order:1;width:calc(100% - 80px);height:32px;margin:15px 20px 20px auto;padding:0 10px;border:1px solid #ddd;border-radius:16px;color:#444;background-color:#fff;font-family:sans-serif;font-size:14px;text-align:center;box-shadow:none}input.clr-color:focus{outline:0;border:1px solid #1e90ff}.clr-clear,.clr-close{display:none;order:2;height:24px;margin:0 20px 20px;padding:0 20px;border:0;border-radius:12px;color:#fff;background-color:#666;font-family:inherit;font-size:12px;font-weight:400;cursor:pointer}.clr-close{display:block;margin:0 20px 20px auto}.clr-preview{position:relative;width:32px;height:32px;margin:15px 0 20px 20px;border-radius:50%;overflow:hidden}.clr-preview:after,.clr-preview:before{content:'';position:absolute;height:100%;width:100%;left:0;top:0;border:1px solid #fff;border-radius:50%}.clr-preview:after{border:0;background-color:currentColor;box-shadow:inset 0 0 0 1px rgba(0,0,0,.1)}.clr-preview button{position:absolute;width:100%;height:100%;z-index:1;margin:0;padding:0;border:0;border-radius:50%;outline-offset:-2px;background-color:transparent;text-indent:-9999px;cursor:pointer;overflow:hidden}.clr-alpha div,.clr-color,.clr-hue div,.clr-marker{box-sizing:border-box}.clr-field{display:inline-block;position:relative;color:transparent}.clr-field input{margin:0;direction:ltr}.clr-field.clr-rtl input{text-align:right}.clr-field button{position:absolute;width:30px;height:100%;right:0;top:50%;transform:translateY(-50%);margin:0;padding:0;border:0;color:inherit;text-indent:-1000px;white-space:nowrap;overflow:hidden;pointer-events:none}.clr-field.clr-rtl button{right:auto;left:0}.clr-field button:after{content:'';display:block;position:absolute;width:100%;height:100%;left:0;top:0;border-radius:inherit;background-color:currentColor;box-shadow:inset 0 0 1px rgba(0,0,0,.5)}.clr-alpha,.clr-alpha div,.clr-field button,.clr-preview:before,.clr-swatches button{background-image:repeating-linear-gradient(45deg,#aaa 25%,transparent 25%,transparent 75%,#aaa 75%,#aaa),repeating-linear-gradient(45deg,#aaa 25%,#fff 25%,#fff 75%,#aaa 75%,#aaa);background-position:0 0,4px 4px;background-size:8px 8px}.clr-marker:focus{outline:0}.clr-keyboard-nav .clr-alpha input:focus+div,.clr-keyboard-nav .clr-hue input:focus+div,.clr-keyboard-nav .clr-marker:focus,.clr-keyboard-nav .clr-segmented input:focus+label{outline:0;box-shadow:0 0 0 2px #1e90ff,0 0 2px 2px #fff}.clr-picker[data-alpha=false] .clr-alpha{display:none}.clr-picker[data-minimal=true]{padding-top:16px}.clr-picker[data-minimal=true] .clr-alpha,.clr-picker[data-minimal=true] .clr-color,.clr-picker[data-minimal=true] .clr-gradient,.clr-picker[data-minimal=true] .clr-hue,.clr-picker[data-minimal=true] .clr-preview{display:none}.clr-dark{background-color:#444}.clr-dark .clr-segmented{border-color:#777}.clr-dark .clr-swatches button:after{box-shadow:inset 0 0 0 1px rgba(255,255,255,.3)}.clr-dark input.clr-color{color:#fff;border-color:#777;background-color:#555}.clr-dark input.clr-color:focus{border-color:#1e90ff}.clr-dark .clr-preview:after{box-shadow:inset 0 0 0 1px rgba(255,255,255,.5)}.clr-dark .clr-alpha,.clr-dark .clr-alpha div,.clr-dark .clr-preview:before,.clr-dark .clr-swatches button{background-image:repeating-linear-gradient(45deg,#666 25%,transparent 25%,transparent 75%,#888 75%,#888),repeating-linear-gradient(45deg,#888 25%,#444 25%,#444 75%,#888 75%,#888)}.clr-picker.clr-polaroid{border-radius:6px;box-shadow:0 0 5px rgba(0,0,0,.1),0 5px 30px rgba(0,0,0,.2)}.clr-picker.clr-polaroid:before{content:'';display:block;position:absolute;width:16px;height:10px;left:20px;top:-10px;border:solid transparent;border-width:0 8px 10px 8px;border-bottom-color:currentColor;box-sizing:border-box;color:#fff;filter:drop-shadow(0 -4px 3px rgba(0,0,0,.1));pointer-events:none}.clr-picker.clr-polaroid.clr-dark:before{color:#444}.clr-picker.clr-polaroid.clr-left:before{left:auto;right:20px}.clr-picker.clr-polaroid.clr-top:before{top:auto;bottom:-10px;transform:rotateZ(180deg)}.clr-polaroid .clr-gradient{width:calc(100% - 20px);height:120px;margin:10px;border-radius:3px}.clr-polaroid .clr-alpha,.clr-polaroid .clr-hue{width:calc(100% - 30px);height:10px;margin:6px 15px;border-radius:5px}.clr-polaroid .clr-alpha div,.clr-polaroid .clr-hue div{box-shadow:0 0 5px rgba(0,0,0,.2)}.clr-polaroid .clr-format{width:calc(100% - 20px);margin:0 10px 15px}.clr-polaroid .clr-swatches{width:calc(100% - 12px);margin:0 6px}.clr-polaroid .clr-swatches div{padding-bottom:10px}.clr-polaroid .clr-swatches button{width:22px;height:22px}.clr-polaroid input.clr-color{width:calc(100% - 60px);margin:10px 10px 15px auto}.clr-polaroid .clr-clear{margin:0 10px 15px 10px}.clr-polaroid .clr-close{margin:0 10px 15px auto}.clr-polaroid .clr-preview{margin:10px 0 15px 10px}.clr-picker.clr-large{width:275px}.clr-large .clr-gradient{height:150px}.clr-large .clr-swatches button{width:22px;height:22px}.clr-picker.clr-pill{width:380px;padding-left:180px;box-sizing:border-box}.clr-pill .clr-gradient{position:absolute;width:180px;height:100%;left:0;top:0;margin-bottom:0;border-radius:3px 0 0 3px}.clr-pill .clr-hue{margin-top:20px}
/* twine-user-stylesheet #9: "decisions.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
.decision {
  display: flex;
  position: relative;
}
.decision:has(.icon)::before {
  float: left;
  content: " ";
  width: 29px;
  height: 29px;
}
.decision .icon {
  position: absolute;
  left: 2px;
  top: calc(50% - 17px);
}
.decision .name {
  font-weight: normal;
}

.decision-result {
  transition: opacity 0.4s ease-in;
  opacity: 0;
}/*# sourceMappingURL=decisions.css.map */
/* twine-user-stylesheet #10: "equipment.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
#store, #wardrobe {
  text-align: center;
}
#store .category-title, #wardrobe .category-title {
  border: 2px ridge var(--theme-color);
  display: block;
  margin: auto;
  margin-top: 40px;
  text-align: center;
  cursor: pointer;
  font-family: "Berry Rotunda";
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
}
#store .category, #wardrobe .category {
  display: grid;
  border: 2px ridge var(--theme-color);
  border-top: none;
  grid-template-columns: repeat(auto-fit, 190px);
  gap: 0em 2.5em;
  justify-content: center;
  justify-items: center;
}
#store .category.hidden, #wardrobe .category.hidden {
  display: none;
}
#store a.equipment-item, #wardrobe a.equipment-item {
  background: var(--theme-color);
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
  padding: 0;
  border-radius: 0;
  margin: 20px;
  padding: 10px;
  justify-content: center;
  text-align: center;
  width: 10em;
  line-height: 1.2;
  font-weight: normal;
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
}
#store a.equipment-item:after, #wardrobe a.equipment-item:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
#store a.equipment-item[disabled], #wardrobe a.equipment-item[disabled] {
  border: 5px;
  border-color: color-mix(in srgb, var(--theme-color), #000000 50%);
  border-style: dashed;
  background: color-mix(in srgb, color-mix(in srgb, var(--theme-color), #000000 50%), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, color-mix(in srgb, var(--theme-color), #000000 50%), #000000 50%), 0 0 0 10px color-mix(in srgb, var(--fill-color), #000000 50%), inset 0 0 0 2px color-mix(in srgb, color-mix(in srgb, var(--theme-color), #000000 50%), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px color-mix(in srgb, var(--fill-color), #000000 50%), inset 0 0 100vw 100vw color-mix(in srgb, var(--fill-color), #000000 50%);
}
#store a.equipment-item[disabled]:after, #wardrobe a.equipment-item[disabled]:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
#store a.equipment-item[disabled] img.equipment-item-img, #wardrobe a.equipment-item[disabled] img.equipment-item-img {
  filter: brightness(50%);
}
#store a.equipment-item.selected, #wardrobe a.equipment-item.selected {
  border: 5px;
  border-color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  border-style: dashed;
  background: color-mix(in srgb, color-mix(in srgb, var(--theme-color), #ffffff 50%), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, color-mix(in srgb, var(--theme-color), #ffffff 50%), #000000 50%), 0 0 0 10px color-mix(in srgb, var(--fill-color), #ffffff 50%), inset 0 0 0 2px color-mix(in srgb, color-mix(in srgb, var(--theme-color), #ffffff 50%), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px color-mix(in srgb, var(--fill-color), #ffffff 50%), inset 0 0 100vw 100vw color-mix(in srgb, var(--fill-color), #ffffff 50%);
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%);
  color: color-mix(in srgb, var(--theme-color), #000000 50%);
}
#store a.equipment-item.selected:after, #wardrobe a.equipment-item.selected:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
#store a.equipment-item.selected img.equipment-item-img, #wardrobe a.equipment-item.selected img.equipment-item-img {
  border: 2px ridge color-mix(in srgb, var(--theme-color), #ffffff 50%);
}
#store a.equipment-item:hover:not([disabled]), #wardrobe a.equipment-item:hover:not([disabled]) {
  text-decoration: none;
}
#store a.equipment-item:hover:not([disabled]) span.equipment-item-name, #wardrobe a.equipment-item:hover:not([disabled]) span.equipment-item-name {
  text-decoration: underline;
}
#store a.equipment-item img.equipment-item-img, #wardrobe a.equipment-item img.equipment-item-img {
  max-width: 8em;
  float: inherit;
  border: 2px ridge var(--theme-color);
  margin: 5px auto;
}
#store a.equipment-item span.equipment-item-name, #wardrobe a.equipment-item span.equipment-item-name {
  justify-content: center;
  font-family: "MedievalSharp";
  font-size: 20px;
}
#store a.equipment-item .equipment-item-cost, #wardrobe a.equipment-item .equipment-item-cost {
  display: block;
}
#store a.equipment-item .equipment-item-cost .equipment-item-cost-amount, #wardrobe a.equipment-item .equipment-item-cost .equipment-item-cost-amount {
  line-height: 1em;
  font-family: "Berry Rotunda";
  transform: translateY(-8px);
  display: inline-block;
}
#store a.equipment-item .equipment-item-stat, #wardrobe a.equipment-item .equipment-item-stat {
  display: block;
  transform: translateY(-10px);
}
#store a.equipment-item .equipment-item-stat .icon, #wardrobe a.equipment-item .equipment-item-stat .icon {
  transform: translateY(10px);
}
#store .outfits-title, #wardrobe .outfits-title {
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
  display: block;
  margin: auto;
  margin-top: 40px;
  text-align: center;
  font-family: "Berry Rotunda";
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
}
#store .outfits, #wardrobe .outfits {
  display: grid;
  grid-template-columns: repeat(auto-fit, 294px);
  gap: 2.5em 1.6em;
  justify-content: center;
  justify-items: center;
  margin-top: 14px;
  margin-bottom: 28px;
}
#store .outfits .outfit, #wardrobe .outfits .outfit {
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
  width: 254px;
  padding: 4px 8px;
}
#store .outfits .outfit:after, #wardrobe .outfits .outfit:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
#store .outfits .outfit .outfit-name, #wardrobe .outfits .outfit .outfit-name {
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
  width: 100%;
  font-family: "MedievalSharp";
  font-size: 24px;
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  margin: 0;
}
#store .outfits .outfit .outfit-items, #wardrobe .outfits .outfit .outfit-items {
  height: 254px;
  width: 100%;
  display: grid;
  grid-template-columns: 144px 104px;
  grid-template-rows: 104px 104px 38px;
  row-gap: 4px;
  -moz-column-gap: 4px;
       column-gap: 4px;
}
#store .outfits .outfit .outfit-items .outfit-item, #wardrobe .outfits .outfit .outfit-items .outfit-item {
  border: 2px ridge var(--theme-color);
  width: 102px;
  height: 102px;
  margin: auto;
}
#store .outfits .outfit .outfit-items .outfit-item.first, #wardrobe .outfits .outfit .outfit-items .outfit-item.first {
  width: 140px;
  height: 210px;
  grid-column: 1;
  grid-row: 1/3;
}
#store .outfits .outfit .outfit-items .outfit-item.second, #wardrobe .outfits .outfit .outfit-items .outfit-item.second {
  grid-column: 2;
  grid-row: 1;
}
#store .outfits .outfit .outfit-items .outfit-item.third, #wardrobe .outfits .outfit .outfit-items .outfit-item.third {
  grid-column: 2;
  grid-row: 2;
}
#store .outfits .outfit .outfit-items .outfit-buttons, #wardrobe .outfits .outfit .outfit-items .outfit-buttons {
  grid-column: 1/3;
  grid-row: 3;
}
#store .outfits .outfit .outfit-items .outfit-buttons .wear-button, #wardrobe .outfits .outfit .outfit-items .outfit-buttons .wear-button {
  margin-right: 4px;
}

#toys {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(12em, 12em));
  gap: 0.5em;
  justify-content: center;
  justify-items: center;
}
#toys .toy {
  text-shadow: 1px 1px 0 var(--theme-color), -1px 1px 0 var(--theme-color), -1px -1px 0 var(--theme-color), 1px -1px 0 var(--theme-color);
  padding: 0;
  border-radius: 0;
  margin: 20px;
  padding: 10px;
  justify-content: center;
  text-align: center;
  width: 10em;
  line-height: 1.2;
}
#toys .toy img.toy-img {
  max-width: 8em;
  float: inherit;
  outline: 2px ridge var(--theme-color);
}
#toys .toy span.toy-name {
  justify-content: center;
}/*# sourceMappingURL=equipment.css.map */
/* twine-user-stylesheet #11: "flash.min.css" */
.flash-container{z-index: 1000;max-width: 25%;position: fixed}.top-left-flash-layout{top: 75px;left: 15px}.top-right-flash-layout{top: 75px;right: 15px}.middle-right-flash-layout{top: 50%;right: 15px;transform: translateY(-50%)}.bottom-right-flash-layout{bottom: 75px;right: 15px}.middle-bottom-flash-layout{bottom: 75px;left: 50%;transform: translate(-50%, -50%)}.bottom-left-flash-layout{bottom: 75px;left: 15px}.middle-left-flash-layout{top: 50%;left: 15px;transform: translateY(-50%)}.middle-top-flash-layout{top: 75px;left: 50%;transform: translate(-50%, -50%)}.flash-container .flash-message{position: relative;opacity: 0;transform: translateX(-20px);transition: all .5s;background-color: #fff;color: #2C3433;border-radius: 0;border-top-right-radius: 4px;border-bottom-right-radius: 4px;margin-bottom: 10px;padding: 5px 35px 5px 20px;box-shadow: 2px 2px 33px 8px rgba(0, 0, 0, 0.1);line-height: 1.4;cursor: pointer}.flash-container .flash-not-interactive{cursor: default}.flash-container .flash-message .flash-progress{position: absolute;right: 0;top: auto;bottom: 0;left: 0;width: 0;height: 3px;opacity: 1;background-color: rgba(0, 0, 0, 0.15);transition: opacity .1s}.flash-container .flash-message .flash-progress.flash-is-hidden{opacity: 0}.flash-container .flash-message .flash-progress.flash-progress-top{top: 0;bottom: auto}.flash-container .flash-message:before{position: absolute;content: '';width: 7px;height: 100%;top: 0;bottom: 0;left: -7px;background-color: transparent;border-top-left-radius: 4px;border-bottom-left-radius: 4px}.flash-container .flash-message:after{position: absolute;content: '';font-family: 'tme-fa-icons';top: 5px;right: 8px;text-align: center;vertical-align: middle;color: #9e9e9e}.flash-container .flash-message.flash-is-visible{opacity: 1;transform: translateX(0)}.flash-container .flash-message.flash-success .flash-progress{background-color: rgba(76, 175, 80, 0.15)}.flash-container .flash-message.flash-success:before{background-color: #4CAF50}.flash-container .flash-message.flash-success:after{color: rgba(76, 175, 80, 0.5);content: '\e803'}.flash-container .flash-message.flash-warning .flash-progress{background-color: rgba(255, 133, 27, 0.15)}.flash-container .flash-message.flash-warning:before{background-color: #FF851B}.flash-container .flash-message.flash-warning:after{color: rgba(255, 133, 27, 0.5);content: '\e80d'}.flash-container .flash-message.flash-error .flash-progress{background-color: rgba(255, 65, 54, 0.15)}.flash-container .flash-message.flash-error:before{background-color: #FF4136}.flash-container .flash-message.flash-error:after{color: rgba(255, 65, 54, 0.5);content: '\e80c'}.flash-container .flash-message.flash-info .flash-progress{background-color: rgba(0, 116, 217, 0.15)}.flash-container .flash-message.flash-info:before{background-color: #0074D9}.flash-container .flash-message.flash-info:after{color: rgba(0, 116, 217, 0.5);content: '\e80a'}.flash-container .flash-message.flash-bug .flash-progress{background-color: rgba(138, 43, 226, 0.15)}.flash-container .flash-message.flash-bug:before{background-color: #8A2BE2}.flash-container .flash-message.flash-bug:after{color: rgba(138, 43, 226, 0.5);content: '\e838'}.flash-container .flash-message.flash-disabled .flash-progress{background-color: rgba(170, 170, 170, 0.15)}.flash-container .flash-message.flash-disabled:before{background-color: #aaa}.flash-container .flash-message.flash-disabled:after{color: rgba(170, 170, 170, 0.5);content: '\e80f';font-family: "tme-fa-icons"}.flash-container .flash-message.flash-default{padding-right: 20px}@media all and (max-width: 1280px){.flash-container{max-width: 33.33%}}@media all and (max-width: 768px){.flash-container{max-width: 50%}}@media all and (max-width: 480px){.flash-container{right: 10px;left: 10px;max-width: 100%}}.flash-container .flash-message.dark-theme{background-color: #2C3433;color: #fff}.flash-container .flash-message.dark-theme .flash-progress{background-color: rgba(255, 255, 255, 0.5)}
/* twine-user-stylesheet #12: "minigame.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
#passages .minigame canvas {
  max-width: 100%;
}
#passages .minigame img {
  user-drag: none;
  -webkit-user-drag: none;
  pointer-events: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
#passages .minigame .say-box {
  user-drag: none;
  -webkit-user-drag: none;
  pointer-events: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  user-select: none;
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1;
}
#passages .minigame .decision {
  position: fixed;
  bottom: 26px;
  width: 200px;
  left: 50%;
  transform: translateX(-50%);
}
#passages .minigame .passage-background {
  visibility: hidden;
}
#passages .minigame #coins-parent {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
#passages .minigame #coins-parent .decision {
  display: none;
}
#passages .minigame #coins-parent img {
  display: none;
}
#passages .minigame #coins-parent #coins-background {
  position: absolute;
  z-index: -1;
  width: calc(100% - 50px);
  left: -5px;
  top: -5px;
  height: calc(100% - 50px);
  background-image: url("images/textures/bg_parchment-light.webp");
  background-color: #F4E1C4;
  background-clip: padding-box;
  border-style: solid;
  border-width: 30px;
  -o-border-image: url("images/textures/bg_border.webp") 30 30 30 30 repeat round;
     border-image: url("images/textures/bg_border.webp") 30 30 30 30 repeat round;
}
#passages .minigame #coins-parent .coin {
  user-drag: none;
  -webkit-user-drag: none;
  pointer-events: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  user-select: none;
  position: absolute;
  display: inline-block;
  transform: translateX(-50%) translateY(-50%);
  z-index: 1;
  border-radius: 50%;
  transform-box: content-box;
}
#passages .minigame #coins-parent .small-coins .coin {
  top: 0;
  left: 0;
  width: 6%;
  background-color: #f38f81;
}
#passages .minigame #coins-parent .small-coins .coin:nth-child(1) {
  transform: translate(-62%) translateY(-74%) rotateZ(299deg);
}
#passages .minigame #coins-parent .small-coins .coin:nth-child(2) {
  transform: translate(-35%) translateY(-46%) rotateZ(225deg);
}
#passages .minigame #coins-parent .small-coins .coin:nth-child(3) {
  transform: translate(-45%) translateY(-86%) rotateZ(121deg);
}
#passages .minigame #coins-parent .small-coins .coin:nth-child(4) {
  transform: translate(-55%) translateY(-39%) rotateZ(217deg);
}
#passages .minigame #coins-parent .small-coins .coin:nth-child(5) {
  transform: translate(-84%) translateY(-55%) rotateZ(244deg);
}
#passages .minigame #coins-parent .small-coins .coin:nth-child(6) {
  transform: translate(-83%) translateY(-19%) rotateZ(33deg);
}
#passages .minigame #coins-parent .small-coins .coin:nth-child(7) {
  transform: translate(-43%) translateY(-14%) rotateZ(145deg);
}
#passages .minigame #coins-parent .small-coins .coin:nth-child(8) {
  transform: translate(-23%) translateY(-65%) rotateZ(27deg);
}
#passages .minigame #coins-parent .small-coins .coin:nth-child(9) {
  transform: translate(-19%) translateY(-75%) rotateZ(70deg);
}
#passages .minigame #coins-parent .small-coins .coin:nth-child(10) {
  transform: translate(-11%) translateY(-20%) rotateZ(289deg);
}
#passages .minigame #coins-parent .medium-coins .coin {
  top: 100%;
  left: 0;
  width: 7.2%;
  background-color: #7ca587;
}
#passages .minigame #coins-parent .medium-coins .coin:nth-child(1) {
  transform: translate(-28%) translateY(-21%) rotateZ(221deg);
}
#passages .minigame #coins-parent .medium-coins .coin:nth-child(2) {
  transform: translate(-57%) translateY(-75%) rotateZ(192deg);
}
#passages .minigame #coins-parent .medium-coins .coin:nth-child(3) {
  transform: translate(-97%) translateY(-60%) rotateZ(308deg);
}
#passages .minigame #coins-parent .medium-coins .coin:nth-child(4) {
  transform: translate(-84%) translateY(-37%) rotateZ(350deg);
}
#passages .minigame #coins-parent .medium-coins .coin:nth-child(5) {
  transform: translate(-22%) translateY(-81%) rotateZ(339deg);
}
#passages .minigame #coins-parent .medium-coins .coin:nth-child(6) {
  transform: translate(-4%) translateY(-55%) rotateZ(180deg);
}
#passages .minigame #coins-parent .medium-coins .coin:nth-child(7) {
  transform: translate(-17%) translateY(-64%) rotateZ(314deg);
}
#passages .minigame #coins-parent .medium-coins .coin:nth-child(8) {
  transform: translate(-88%) translateY(-61%) rotateZ(200deg);
}
#passages .minigame #coins-parent .medium-coins .coin:nth-child(9) {
  transform: translate(-46%) translateY(-27%) rotateZ(104deg);
}
#passages .minigame #coins-parent .medium-coins .coin:nth-child(10) {
  transform: translate(-69%) translateY(-48%) rotateZ(284deg);
}
#passages .minigame #coins-parent .large-coins .coin {
  top: 0;
  left: 100%;
  width: 8.4%;
  background-color: #8d809b;
}
#passages .minigame #coins-parent .large-coins .coin:nth-child(1) {
  transform: translate(-51%) translateY(-70%) rotateZ(300deg);
}
#passages .minigame #coins-parent .large-coins .coin:nth-child(2) {
  transform: translate(-29%) translateY(-20%) rotateZ(16deg);
}
#passages .minigame #coins-parent .large-coins .coin:nth-child(3) {
  transform: translate(-84%) translateY(-69%) rotateZ(176deg);
}
#passages .minigame #coins-parent .large-coins .coin:nth-child(4) {
  transform: translate(-63%) translateY(-33%) rotateZ(18deg);
}
#passages .minigame #coins-parent .large-coins .coin:nth-child(5) {
  transform: translate(-70%) translateY(-24%) rotateZ(14deg);
}
#passages .minigame #coins-parent .large-coins .coin:nth-child(6) {
  transform: translate(-56%) translateY(-24%) rotateZ(66deg);
}
#passages .minigame #coins-parent .large-coins .coin:nth-child(7) {
  transform: translate(-59%) translateY(-77%) rotateZ(130deg);
}
#passages .minigame #coins-parent .large-coins .coin:nth-child(8) {
  transform: translate(-52%) translateY(-86%) rotateZ(57deg);
}
#passages .minigame #coins-parent .large-coins .coin:nth-child(9) {
  transform: translate(-80%) translateY(-84%) rotateZ(217deg);
}
#passages .minigame #coins-parent .large-coins .coin:nth-child(10) {
  transform: translate(-67%) translateY(-48%) rotateZ(73deg);
}
#passages .minigame #coins-parent .huge-coins .coin {
  top: 100%;
  left: 100%;
  width: 9.6%;
  background-color: #efd920;
}
#passages .minigame #coins-parent .huge-coins .coin:nth-child(1) {
  transform: translate(-63%) translateY(-71%) rotateZ(357deg);
}
#passages .minigame #coins-parent .huge-coins .coin:nth-child(2) {
  transform: translate(-68%) translateY(-31%) rotateZ(152deg);
}
#passages .minigame #coins-parent .huge-coins .coin:nth-child(3) {
  transform: translate(-30%) translateY(-40%) rotateZ(157deg);
}
#passages .minigame #coins-parent .huge-coins .coin:nth-child(4) {
  transform: translate(-20%) translateY(-39%) rotateZ(124deg);
}
#passages .minigame #coins-parent .huge-coins .coin:nth-child(5) {
  transform: translate(-25%) translateY(-54%) rotateZ(46deg);
}
#passages .minigame #coins-parent .huge-coins .coin:nth-child(6) {
  transform: translate(-76%) translateY(-67%) rotateZ(261deg);
}
#passages .minigame #coins-parent .huge-coins .coin:nth-child(7) {
  transform: translate(-27%) translateY(-43%) rotateZ(134deg);
}
#passages .minigame #coins-parent .huge-coins .coin:nth-child(8) {
  transform: translate(-46%) translateY(-55%) rotateZ(292deg);
}
#passages .minigame #coins-parent .huge-coins .coin:nth-child(9) {
  transform: translate(-20%) translateY(-72%) rotateZ(206deg);
}
#passages .minigame #coins-parent .huge-coins .coin:nth-child(10) {
  transform: translate(-21%) translateY(-65%) rotateZ(306deg);
}
#passages .minigame #coins-parent .bowl {
  user-drag: none;
  -webkit-user-drag: none;
  pointer-events: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  user-select: none;
  position: absolute;
  display: inline-block;
  width: 20%;
  transform: translateX(-50%) translateY(-50%);
}
#passages .minigame #coins-parent .bowl#bowl-1 {
  top: 0;
  left: 0;
}
#passages .minigame #coins-parent .bowl#bowl-2 {
  top: 0;
  left: 100%;
}
#passages .minigame #coins-parent .bowl#bowl-3 {
  top: 100%;
  left: 0;
}
#passages .minigame #coins-parent .bowl#bowl-4 {
  top: 100%;
  left: 100%;
}
#passages .minigame #painting-parent {
  position: fixed;
  bottom: -30%;
  height: 120%;
  left: 50%;
  transform: translateX(-50%);
}
#passages .minigame #painting-parent canvas {
  cursor: url("images/cursors/painting.cur"), auto;
  position: absolute;
  width: 100%;
  left: 0;
  top: 5%;
}
#passages .minigame #painting-parent .easel {
  user-drag: none;
  -webkit-user-drag: none;
  pointer-events: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  user-select: none;
  position: relative;
  height: 100%;
}
#passages .minigame #writing-parent {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 30em;
  max-height: 40em;
  height: 85%;
}
#passages .minigame #writing-parent .decision {
  display: none;
}
#passages .minigame #writing-parent * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
#passages .minigame #writing-parent #vara-container {
  width: 110%;
}
#passages .minigame #writing-parent #container {
  width: 60%;
  margin: 20px auto;
}
#passages .minigame #writing-parent .v-center {
  display: inline-block;
  vertical-align: middle;
  height: 100%;
  width: 0;
}
#passages .minigame #writing-parent #container {
  display: inline-block;
  vertical-align: middle;
}/*# sourceMappingURL=minigame.css.map */
/* twine-user-stylesheet #13: "popups.css" */
/* popover.css, by chapel; for use with popover.js; v1.0.0 */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
#ui-dialog-body.popover {
  background: transparent;
  border: 0;
  padding: 0;
}

.popover #ui-dialog-titlebar {
  background: transparent;
}

.popover #ui-dialog-title {
  display: none;
}

.popover #ui-dialog-close {
  position: fixed;
  display: block;
  top: 0;
  right: 0;
  height: 3em;
}

.popover #ui-dialog-close:hover {
  background-color: transparent;
  border-color: transparent;
  color: #c22;
}

#ui-overlay.popover.opaque {
  opacity: 1;
}

#ui-overlay.popover.transparent {
  opacity: 0;
}

#ui-overlay.popover.invert {
  background-color: #f8f8f8;
}

#ui-dialog-body.popover.invert {
  color: #111;
}

/*
    notify.min.css, by chapel; for use with notify.js
    version 1.0.0
 */
#notify {
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
  position: fixed;
  display: block;
  z-index: 20;
  top: 2em;
  padding: 0.5em;
  color: #000;
  transition: right 0.3s ease-in-out;
  right: 0px;
}
#notify:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
#notify span {
  display: inline-block;
}
#notify .icon + span {
  transform: translateY(-8px);
}
#notify .icon {
  height: 16px;
  width: 16px;
  margin-right: 4px;
}
#notify.stowed {
  right: -264px;
}
#notify.stowed.open {
  right: 62px;
}
#notify.open {
  right: 326px;
}

#popup {
  position: absolute;
  z-index: 100101; /* aaaalways on top*/
  padding: 10px;
  margin-left: 10px;
  margin-top: 5px;
  max-width: 300px;
  font-size: 0.95em;
  pointer-events: none;
}
#popup:not(.character-popup) {
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
#popup:not(.character-popup):after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}

#popup .character-popup-image, #ui-dialog .character-popup-image {
  width: 100px;
  float: inline-end;
  margin: 5px;
}
#popup .character-popup-name, #ui-dialog .character-popup-name {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}
#popup .stat-popup-image, #ui-dialog .stat-popup-image {
  float: left;
  margin: -5px 5px -5px -5px;
}
#popup .popup-description, #ui-dialog .popup-description {
  color: black;
  vertical-align: middle;
}
#popup .map-popup-name, #ui-dialog .map-popup-name {
  margin: 0;
  border-bottom: 2px ridge var(--theme-color);
  font-family: "MedievalSharp";
  font-size: 24px;
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
}
#popup .map-popup-description, #ui-dialog .map-popup-description {
  margin: 0;
  list-style-position: inside;
  list-style-type: circle;
  padding: 0;
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
}/*# sourceMappingURL=popups.css.map */
/* twine-user-stylesheet #14: "rightsidebar.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
/* Styling and Colours of the Right UI Bar. */
#right-ui-bar {
  background-color: #222;
  border-right: 1px solid #444;
  text-align: center;
}

#right-ui-bar-toggle {
  font-size: 1.2em;
  line-height: inherit;
  color: #eee;
  background-color: transparent;
  border: 1px solid #444;
}

#right-ui-bar-toggle:before {
  font-family: tme-fa-icons;
  font-style: normal;
  font-weight: 400;
  font-variant: normal;
  text-transform: none;
  line-height: 1;
  speak: none;
}

/* Layout and Positioning of the Right UI Bar. */
#right-ui-bar {
  position: fixed;
  z-index: 50;
  top: 0;
  right: 0;
  width: 17.5em;
  height: 100%;
  margin: 0;
  padding: 0;
  transition: right 0.2s ease-in;
}

#right-ui-bar-tray {
  position: absolute;
  top: 0.2em;
  left: 0;
  right: 0;
}

#right-ui-bar-toggle {
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  border-left: none;
  padding: 0.3em 0.45em 0.25em;
  -webkit-user-select: none;
}

#right-ui-bar-toggle:before {
  content: "\e81e";
}

#right-ui-bar-body {
  height: 90%;
  height: calc(100% - 2.5em);
  margin: 2.5em 0;
  padding: 0 10px;
}

#right-ui-bar-body {
  line-height: 1.5;
  overflow: auto;
}

#story {
  margin-right: 20em;
}

/* Stowing of the Right UI Bar. */
#right-ui-bar.stowed {
  right: -15.5em;
}

#right-ui-bar.stowed #right-ui-bar-toggle {
  padding: 0.3em 0.55em 0.25em 0.35em;
}

#right-ui-bar.stowed #right-ui-bar-toggle:before {
  content: "\e81d";
}

#right-ui-bar.stowed #right-ui-bar-body {
  visibility: hidden;
  transition: visibility 0.2s step-end;
}

#right-ui-bar.stowed ~ #story {
  margin-right: 4.5em;
}/*# sourceMappingURL=rightsidebar.css.map */
/* twine-user-stylesheet #15: "stats.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
.notification {
  display: inline-block;
  border: 1px solid;
}
.notification.positive {
  color: green;
  border-color: green;
}
.notification.negative {
  color: red;
  border-color: red;
}

.icon {
  width: 22px;
  height: 22px;
  padding: 3px;
  margin: 1px;
  overflow: visible;
  display: inline-block;
  border-radius: 50%;
  border: 2px solid;
}
.icon.femininity {
  border-color: #b000b5;
}
.icon.masculinity {
  border-color: #000080;
}
.icon.depravity {
  border-color: black;
}
.icon.virtue {
  border-color: white;
}
.icon.submissiveness {
  border-color: #ffe200;
}
.icon.dominance {
  border-color: #c80000;
}
.icon.swordsmanship {
  border-color: rgb(33, 33, 33);
}
.icon.statesmanship {
  border-color: rgb(34, 28, 109);
}
.icon.stewardship {
  border-color: darkgreen;
}
.icon.comport {
  border-color: rgb(255, 255, 255);
}
.icon.fashion {
  border-color: rgb(9, 58, 1);
}
.icon.etiquette {
  border-color: rgb(141, 4, 4);
}
.icon.romance {
  border-color: pink;
}
.icon.castle {
  border-color: rgb(204, 167, 14);
}
.icon.forest {
  border-color: rgb(52, 104, 23);
}
.icon.town {
  border-color: rgb(131, 93, 29);
}
.icon.magic_circle {
  border-color: rgb(250, 241, 77);
}

span.icon {
  vertical-align: top;
  line-height: 1.8em;
  font-family: "Berry Rotunda";
}

.macro-showmeter {
  top: 0;
}
.macro-showmeter .chapel-meter {
  display: inline-block;
  margin-left: 6px;
  margin-right: 6px;
  height: 16px;
  bottom: 7px;
  border: 2px ridge var(--theme-color);
  width: calc(100% - 100px);
}
.macro-showmeter .chapel-meter .meter-bottom {
  box-shadow: inset -3px 0px color-mix(in srgb, var(--theme-color), #ffffff 50%), inset -5px 0px var(--theme-color), 3px 0px color-mix(in srgb, var(--theme-color), #ffffff 50%), 5px 0px var(--theme-color);
}

.meters {
  border: 2px ridge var(--theme-color);
  line-height: 0;
}
.meters .meter:not(:first-child) {
  border-top: 2px ridge var(--theme-color);
}

.currency-box {
  text-align: center;
}
.currency-box .currency {
  position: relative;
  display: inline-block;
  line-height: 0;
  border-radius: 8vw;
  margin: auto;
}
.currency-box .currency .currency-amount {
  line-height: 0;
  margin-top: 19px;
  margin-left: 2px;
  float: right;
  font-family: "Berry Rotunda";
}
.currency-box.border {
  display: block;
  margin: 15px;
}
.currency-box.border .icon {
  margin: 5px;
}
.currency-box.border .currency-amount {
  margin-top: 25px;
  margin-left: 2px;
  margin-right: 5px;
}
.currency-box.border .currency.mushrooms {
  border: 5px;
  border-color: brown;
  border-style: dashed;
  background: color-mix(in srgb, brown, #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, brown, #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, brown, #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.currency-box.border .currency.mushrooms:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.currency-box.border .currency.gold {
  border: 5px;
  border-color: gold;
  border-style: dashed;
  background: color-mix(in srgb, gold, #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, gold, #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, gold, #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.currency-box.border .currency.gold:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.currency-box.border .currency.essence {
  border: 5px;
  border-color: white;
  border-style: dashed;
  background: color-mix(in srgb, white, #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, white, #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, white, #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.currency-box.border .currency.essence:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.currency-box:not(.border) {
  display: inline-block;
  vertical-align: middle;
  line-height: 0;
}

.icon.mushrooms {
  border-color: brown;
}
.icon.gold {
  border-color: gold;
}
.icon.essence {
  border-color: white;
}

.kingdom-stats {
  position: relative;
  width: 100%;
}
.kingdom-stats h2.location-title {
  text-align: center;
  line-height: 1em;
  position: initial !important;
}
.kingdom-stats .stat-track {
  position: relative;
  height: 45px;
  margin: 2.5px 20px;
}
.kingdom-stats .stat-track.stability {
  height: 55px;
  margin: 15px 20px;
}
.kingdom-stats .stat-track.stability .line {
  height: 5px;
  background-color: var(--theme-color);
  border: 2px solid color-mix(in srgb, var(--theme-color), #000000 50%);
}
.kingdom-stats .stat-track.stability .circles .circle {
  height: 15px;
  width: 15px;
  border-width: 2px;
}
.kingdom-stats .stat-track.stability .circles .circle::after {
  height: 7px;
  width: 7px;
}
.kingdom-stats .stat-track.stability .circles .circle:first-child, .kingdom-stats .stat-track.stability .circles .circle:last-child {
  height: 30px;
  width: 30px;
}
.kingdom-stats .stat-track.stability .circles .circle:first-child img, .kingdom-stats .stat-track.stability .circles .circle:last-child img {
  position: absolute;
  width: 24px;
  height: 24px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  filter: invert(10%) sepia(88%) saturate(3135%) hue-rotate(348deg) brightness(86%) contrast(127%);
}
.kingdom-stats .stat-track.stability .circles .circle:first-child::after, .kingdom-stats .stat-track.stability .circles .circle:last-child::after {
  display: none;
}
.kingdom-stats .stat-track.stability .icon {
  z-index: 10;
  transform: scale(1.2);
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), -2px 3px 5px 2px rgba(1, 1, 1, 0.4), inset 0 0 100vw 100vw color-mix(in srgb, var(--theme-color), #ffffff 50%);
}
.kingdom-stats .stat-track.stability .icon.hover {
  transform: translateY(-10px) scale(1.5);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), -2px 7px 10px 3px rgba(1, 1, 1, 0.4), inset 0 0 100vw 100vw color-mix(in srgb, var(--theme-color), #ffffff 50%);
}
.kingdom-stats .stat-track.stability .icon.fall {
  transform: translateX(50px) translateY(850px) scale(1.5) rotate3d(-0.3, 1, 0, 390deg);
}
.kingdom-stats .stat-track .line {
  position: absolute;
  width: 100%;
  height: 3px;
  top: 50%;
  transform: translateY(-50%);
  background-color: color-mix(in srgb, var(--theme-color), #000000 50%);
}
.kingdom-stats .stat-track .circles {
  position: relative;
  width: 100%;
  height: 100%;
}
.kingdom-stats .stat-track .circles .circle {
  position: absolute;
  height: 15px;
  width: 15px;
  border-radius: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  background-color: var(--theme-color);
  border: 2px solid color-mix(in srgb, var(--theme-color), #000000 50%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(1) {
  left: 0%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(1)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 98%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(2) {
  left: 7.1428571429%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(2)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 72%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(3) {
  left: 14.2857142857%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(3)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 50%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(4) {
  left: 21.4285714286%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(4)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 32%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(5) {
  left: 28.5714285714%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(5)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 18%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(6) {
  left: 35.7142857143%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(6)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 8%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(7) {
  left: 42.8571428571%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(7)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 2%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(8) {
  left: 50%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(8)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 0%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(9) {
  left: 57.1428571429%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(9)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 2%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(10) {
  left: 64.2857142857%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(10)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 8%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(11) {
  left: 71.4285714286%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(11)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 18%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(12) {
  left: 78.5714285714%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(12)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 32%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(13) {
  left: 85.7142857143%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(13)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 50%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(14) {
  left: 92.8571428571%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(14)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 72%);
}
.kingdom-stats .stat-track .circles .circle:nth-child(15) {
  left: 100%;
}
.kingdom-stats .stat-track .circles .circle:nth-child(15)::after {
  background-color: color-mix(in srgb, rgb(8, 131, 8), #710303 98%);
}
.kingdom-stats .stat-track .circles .circle:first-child, .kingdom-stats .stat-track .circles .circle:last-child {
  height: 15px;
  width: 15px;
}
.kingdom-stats .stat-track .circles .circle:first-child::after, .kingdom-stats .stat-track .circles .circle:last-child::after {
  height: 7px;
  width: 7px;
}
.kingdom-stats .stat-track .circles .circle::after {
  content: "";
  height: 7px;
  width: 7px;
  border-radius: 50%;
  background-color: red;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.kingdom-stats .stat-track .icon {
  position: absolute;
  top: calc(50% - 21px);
  left: calc(50% - 21px);
  background-color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  border-color: var(--theme-color);
  transition: left 1s cubic-bezier(0.68, -0.55, 0.27, 1.55), transform 1s cubic-bezier(0.68, -0.55, 0.27, 1.55), box-shadow 1s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  width: 24px;
  height: 24px;
  padding: 6px;
  margin: 0;
  border-width: 3px;
  box-shadow: -2px 2px 0 0px color-mix(in srgb, var(--theme-color), #000000 50%), -2px 3px 5px 2px rgba(1, 1, 1, 0.4);
}
.kingdom-stats .stat-track .icon[data-position="1"] {
  left: calc(0% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="2"] {
  left: calc(7.1428571429% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="3"] {
  left: calc(14.2857142857% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="4"] {
  left: calc(21.4285714286% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="5"] {
  left: calc(28.5714285714% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="6"] {
  left: calc(35.7142857143% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="7"] {
  left: calc(42.8571428571% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="8"] {
  left: calc(50% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="9"] {
  left: calc(57.1428571429% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="10"] {
  left: calc(64.2857142857% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="11"] {
  left: calc(71.4285714286% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="12"] {
  left: calc(78.5714285714% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="13"] {
  left: calc(85.7142857143% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="14"] {
  left: calc(92.8571428571% - 21px);
}
.kingdom-stats .stat-track .icon[data-position="15"] {
  left: calc(100% - 21px);
}
.kingdom-stats .stat-track .icon.hover {
  transform: translateY(-10px) scale(1.2);
  box-shadow: -2px 2px 0 0px color-mix(in srgb, var(--theme-color), #000000 50%), -2px 7px 10px 3px rgba(1, 1, 1, 0.4);
}/*# sourceMappingURL=stats.css.map */
/* twine-user-stylesheet #16: "store.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
#store .store-item-cost {
  display: block;
}
#store .icon {
  float: none;
  display: inline-block;
}/*# sourceMappingURL=store.css.map */
/* twine-user-stylesheet #17: "time-tracker.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
#story-caption #datetime-cycle-border {
  position: relative;
  border: 2px solid color-mix(in srgb, var(--theme-color), #000000 50%);
  margin-top: 5px;
  margin-bottom: 5px;
}
#story-caption #time-cycle-border {
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 0px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
  position: relative;
}
#story-caption #week-cycle-border {
  margin-top: -5px;
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 0px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 0px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
  position: relative;
}
#story-caption #time-cycle {
  text-align: center;
  position: relative;
  background: transparent;
  overflow: hidden;
  margin: 2px;
}
#story-caption #time-cycle span {
  position: relative;
  font-family: "MedievalSharp";
  text-shadow: 1px 1px 0 white, -1px 1px 0 white, -1px -1px 0 white, 1px -1px 0 white;
  color: black;
  opacity: 1;
}
#story-caption #time-cycle #sun {
  background-size: 200% 200% !important;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: radial-gradient(circle, yellow 38px, lightyellow 39px, transparent 120px);
}
#story-caption #time-cycle #moon {
  background-size: 200% 200% !important;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: radial-gradient(circle, white 38px, lightyellow 39px, transparent 50px);
}
#story-caption #time-cycle #stars {
  width: 1px;
  height: 1px;
  background: transparent;
  box-shadow: 207px 43px #FFF , 6px 30px #FFF , 123px 31px #FFF , 144px 30px #FFF , 99px 20px #FFF , 26px 8px #FFF , 229px 28px #FFF , 115px 38px #FFF , 46px 13px #FFF , 89px 9px #FFF , 180px 35px #FFF , 49px 7px #FFF , 51px 37px #FFF , 39px 10px #FFF , 167px 2px #FFF , 197px 34px #FFF , 29px 14px #FFF , 184px 4px #FFF , 106px 14px #FFF , 141px 19px #FFF , 73px 14px #FFF , 74px 37px #FFF , 43px 23px #FFF , 99px 15px #FFF , 223px 16px #FFF , 63px 19px #FFF , 108px 30px #FFF , 242px 33px #FFF , 33px 1px #FFF , 56px 32px #FFF , 28px 17px #FFF , 39px 33px #FFF , 95px 34px #FFF , 192px 1px #FFF , 144px 36px #FFF , 121px 8px #FFF , 106px 17px #FFF , 215px 31px #FFF , 61px 9px #FFF , 175px 12px #FFF , 172px 28px #FFF , 84px 39px #FFF , 64px 19px #FFF , 194px 42px #FFF , 221px 15px #FFF , 24px 24px #FFF , 190px 15px #FFF , 201px 7px #FFF , 79px 18px #FFF , 184px 38px #FFF , 157px 2px #FFF , 44px 28px #FFF , 11px 12px #FFF , 132px 18px #FFF , 225px 22px #FFF , 245px 33px #FFF , 1px 14px #FFF , 129px 7px #FFF , 94px 4px #FFF , 101px 13px #FFF , 221px 32px #FFF , 74px 9px #FFF , 206px 21px #FFF , 42px 8px #FFF , 225px 7px #FFF , 138px 39px #FFF , 179px 37px #FFF , 217px 27px #FFF , 38px 4px #FFF , 72px 27px #FFF , 49px 18px #FFF , 25px 8px #FFF , 217px 21px #FFF , 217px 16px #FFF , 66px 32px #FFF , 177px 21px #FFF , 224px 28px #FFF , 220px 23px #FFF , 122px 38px #FFF , 27px 1px #FFF , 70px 16px #FFF , 80px 19px #FFF , 230px 41px #FFF , 120px 35px #FFF , 27px 37px #FFF , 45px 20px #FFF , 71px 15px #FFF , 96px 7px #FFF , 45px 2px #FFF , 214px 8px #FFF , 196px 11px #FFF , 244px 33px #FFF , 98px 2px #FFF , 89px 23px #FFF , 41px 41px #FFF , 219px 15px #FFF , 32px 29px #FFF , 3px 35px #FFF , 100px 5px #FFF , 225px 2px #FFF;
}
#story-caption #time-cycle #stars:after {
  content: " ";
  position: relative;
  top: 0px;
  width: 1px;
  height: 1px;
  background: transparent;
  box-shadow: 207px 43px #FFF , 6px 30px #FFF , 123px 31px #FFF , 144px 30px #FFF , 99px 20px #FFF , 26px 8px #FFF , 229px 28px #FFF , 115px 38px #FFF , 46px 13px #FFF , 89px 9px #FFF , 180px 35px #FFF , 49px 7px #FFF , 51px 37px #FFF , 39px 10px #FFF , 167px 2px #FFF , 197px 34px #FFF , 29px 14px #FFF , 184px 4px #FFF , 106px 14px #FFF , 141px 19px #FFF , 73px 14px #FFF , 74px 37px #FFF , 43px 23px #FFF , 99px 15px #FFF , 223px 16px #FFF , 63px 19px #FFF , 108px 30px #FFF , 242px 33px #FFF , 33px 1px #FFF , 56px 32px #FFF , 28px 17px #FFF , 39px 33px #FFF , 95px 34px #FFF , 192px 1px #FFF , 144px 36px #FFF , 121px 8px #FFF , 106px 17px #FFF , 215px 31px #FFF , 61px 9px #FFF , 175px 12px #FFF , 172px 28px #FFF , 84px 39px #FFF , 64px 19px #FFF , 194px 42px #FFF , 221px 15px #FFF , 24px 24px #FFF , 190px 15px #FFF , 201px 7px #FFF , 79px 18px #FFF , 184px 38px #FFF , 157px 2px #FFF , 44px 28px #FFF , 11px 12px #FFF , 132px 18px #FFF , 225px 22px #FFF , 245px 33px #FFF , 1px 14px #FFF , 129px 7px #FFF , 94px 4px #FFF , 101px 13px #FFF , 221px 32px #FFF , 74px 9px #FFF , 206px 21px #FFF , 42px 8px #FFF , 225px 7px #FFF , 138px 39px #FFF , 179px 37px #FFF , 217px 27px #FFF , 38px 4px #FFF , 72px 27px #FFF , 49px 18px #FFF , 25px 8px #FFF , 217px 21px #FFF , 217px 16px #FFF , 66px 32px #FFF , 177px 21px #FFF , 224px 28px #FFF , 220px 23px #FFF , 122px 38px #FFF , 27px 1px #FFF , 70px 16px #FFF , 80px 19px #FFF , 230px 41px #FFF , 120px 35px #FFF , 27px 37px #FFF , 45px 20px #FFF , 71px 15px #FFF , 96px 7px #FFF , 45px 2px #FFF , 214px 8px #FFF , 196px 11px #FFF , 244px 33px #FFF , 98px 2px #FFF , 89px 23px #FFF , 41px 41px #FFF , 219px 15px #FFF , 32px 29px #FFF , 3px 35px #FFF , 100px 5px #FFF , 225px 2px #FFF;
}
#story-caption #time-cycle.morning {
  background-color: rgb(8, 55, 124);
}
#story-caption #time-cycle.morning #sun {
  background-position: 100% 0%;
}
#story-caption #time-cycle.morning #moon {
  opacity: 0;
}
#story-caption #time-cycle.morning #stars {
  opacity: 0;
}
#story-caption #time-cycle.noon {
  background-color: rgb(0, 89, 255);
}
#story-caption #time-cycle.noon #sun {
  background-position: 50% 50%;
}
#story-caption #time-cycle.noon #moon {
  opacity: 0;
}
#story-caption #time-cycle.noon #stars {
  opacity: 0;
}
#story-caption #time-cycle.evening {
  background-color: rgb(172, 0, 0);
}
#story-caption #time-cycle.evening #sun {
  background-position: 0% 0%;
}
#story-caption #time-cycle.evening #moon {
  opacity: 0;
}
#story-caption #time-cycle.evening #stars {
  opacity: 0;
}
#story-caption #time-cycle.night {
  background-color: black;
}
#story-caption #time-cycle.night #sun {
  opacity: 0;
}
#story-caption #time-cycle.night #moon {
  background-position: 50% 100%;
}
#story-caption #time-cycle.night #stars {
  opacity: 1;
}
#story-caption #time-cycle.animate:not(.skip-day).morning {
  animation: night-to-morning 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate:not(.skip-day).morning #sun {
  animation: night-to-morning-sun 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate:not(.skip-day).morning #moon {
  animation: night-to-morning-moon 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate:not(.skip-day).morning #stars {
  animation: night-to-morning-stars 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate:not(.skip-day).noon {
  animation: morning-to-noon 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate:not(.skip-day).noon #sun {
  animation: morning-to-noon-sun 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate:not(.skip-day).evening {
  animation: noon-to-evening 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate:not(.skip-day).evening #sun {
  animation: noon-to-evening-sun 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate:not(.skip-day).night {
  animation: evening-to-night 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate:not(.skip-day).night #sun {
  animation: evening-to-night-sun 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate:not(.skip-day).night #moon {
  animation: evening-to-night-moon 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate:not(.skip-day).night #stars {
  animation: evening-to-night-stars 2s ease-in-out 1 both;
}
#story-caption #time-cycle.animate.skip-day {
  animation: skip-day 3s linear 1 both;
}
#story-caption #time-cycle.animate.skip-day span {
  animation: skip-day-span 3s linear 1 both;
}
#story-caption #time-cycle.animate.skip-day #sun {
  animation: skip-day-sun 3s linear 1 both;
}
#story-caption #time-cycle.animate.skip-day #moon {
  animation: skip-day-moon 3s linear 1 both;
}
#story-caption #time-cycle.animate.skip-day #stars {
  animation: skip-day-stars 3s linear 1 both;
}
#story-caption #week-cycle {
  text-align: center;
  position: relative;
  overflow: hidden;
  height: 38px;
  background-color: #454545;
  border-top: none;
  margin: 2px;
}
#story-caption #week-cycle .week-day {
  text-shadow: 1px 1px 0 black, -1px 1px 0 black, -1px -1px 0 black, 1px -1px 0 black;
  transition: 1.3s ease-in-out;
  color: white;
  position: relative;
  display: inline-block;
  width: 14.2857142857%;
  margin: auto;
  font-family: "MedievalSharp";
  transform: translateY(2px);
  letter-spacing: 0;
}
#story-caption #week-cycle #circle {
  transition: 1.3s ease-in-out;
  position: absolute;
  width: calc(14.2857142857% - 6px);
  height: 200%;
  background-color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  border: 3px solid var(--theme-color);
  border-radius: 15px;
}
#story-caption #week-cycle.sunday #circle {
  left: 0%;
}
#story-caption #week-cycle.sunday .sunday {
  text-shadow: 1px 1px 0 white, -1px 1px 0 white, -1px -1px 0 white, 1px -1px 0 white;
  color: black;
}
#story-caption #week-cycle.monday #circle {
  left: 14.2857142857%;
}
#story-caption #week-cycle.monday .monday {
  text-shadow: 1px 1px 0 white, -1px 1px 0 white, -1px -1px 0 white, 1px -1px 0 white;
  color: black;
}
#story-caption #week-cycle.tuesday #circle {
  left: 28.5714285714%;
}
#story-caption #week-cycle.tuesday .tuesday {
  text-shadow: 1px 1px 0 white, -1px 1px 0 white, -1px -1px 0 white, 1px -1px 0 white;
  color: black;
}
#story-caption #week-cycle.wednesday #circle {
  left: 42.8571428571%;
}
#story-caption #week-cycle.wednesday .wednesday {
  text-shadow: 1px 1px 0 white, -1px 1px 0 white, -1px -1px 0 white, 1px -1px 0 white;
  color: black;
}
#story-caption #week-cycle.thursday #circle {
  left: 57.1428571429%;
}
#story-caption #week-cycle.thursday .thursday {
  text-shadow: 1px 1px 0 white, -1px 1px 0 white, -1px -1px 0 white, 1px -1px 0 white;
  color: black;
}
#story-caption #week-cycle.friday #circle {
  left: 71.4285714286%;
}
#story-caption #week-cycle.friday .friday {
  text-shadow: 1px 1px 0 white, -1px 1px 0 white, -1px -1px 0 white, 1px -1px 0 white;
  color: black;
}
#story-caption #week-cycle.saturday #circle {
  left: 85.7142857143%;
}
#story-caption #week-cycle.saturday .saturday {
  text-shadow: 1px 1px 0 white, -1px 1px 0 white, -1px -1px 0 white, 1px -1px 0 white;
  color: black;
}

@keyframes night-to-morning {
  0% {
    background-color: black;
  }
  100% {
    background-color: rgb(8, 55, 124);
  }
}
@keyframes night-to-morning-sun {
  0% {
    background-position: 120% 0%;
    opacity: 0;
  }
  100% {
    background-position: 100% 0%;
    opacity: 1;
  }
}
@keyframes night-to-morning-moon {
  0% {
    background-position: 50% 100%;
    opacity: 1;
  }
  50% {
    opacity: 1;
  }
  100% {
    background-position: -20% 0%;
    opacity: 0;
  }
}
@keyframes night-to-morning-stars {
  0% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}
@keyframes morning-to-noon {
  0% {
    background-color: rgb(8, 55, 124);
  }
  100% {
    background-color: rgb(0, 89, 255);
  }
}
@keyframes morning-to-noon-sun {
  0% {
    background-position: 100% 0%;
  }
  100% {
    background-position: 50% 50%;
  }
}
@keyframes noon-to-evening {
  0% {
    background-color: rgb(0, 89, 255);
  }
  100% {
    background-color: rgb(172, 0, 0);
  }
}
@keyframes noon-to-evening-sun {
  0% {
    background-position: 50% 50%;
  }
  100% {
    background-position: 0% 0%;
  }
}
@keyframes evening-to-night {
  0% {
    background-color: rgb(172, 0, 0);
  }
  100% {
    background-color: black;
  }
}
@keyframes evening-to-night-sun {
  0% {
    background-position: 0% 0%;
    opacity: 1;
  }
  100% {
    background-position: -20% 0%;
    opacity: 0;
  }
}
@keyframes evening-to-night-moon {
  0% {
    background-position: 100% 0%;
    opacity: 0;
  }
  100% {
    background-position: 50% 100%;
    opacity: 1;
  }
}
@keyframes evening-to-night-stars {
  0% {
    opacity: 0;
  }
  50% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
@keyframes skip-day {
  0% {
    background-color: rgb(8, 55, 124);
  }
  25% {
    background-color: rgb(0, 89, 255);
  }
  50% {
    background-color: rgb(172, 0, 0);
  }
  75% {
    background-color: black;
  }
  100% {
    background-color: rgb(8, 55, 124);
  }
}
@keyframes skip-day-span {
  0% {
    opacity: 1;
  }
  10% {
    opacity: 0;
  }
  90% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
@keyframes skip-day-sun {
  0% {
    background-position: 100% 0%;
  }
  25% {
    background-position: 50% 50%;
  }
  50% {
    background-position: 0% 0%;
    opacity: 1;
  }
  75% {
    background-position: -20% 0%;
    opacity: 0;
  }
  76% {
    background-position: 120% 0%;
    opacity: 0;
  }
  100% {
    background-position: 100% 0%;
    opacity: 1;
  }
}
@keyframes skip-day-moon {
  0% {
    background-position: 100% 0%;
    opacity: 0;
  }
  50% {
    background-position: 100% 0%;
    opacity: 0;
  }
  75% {
    background-position: 50% 50%;
    opacity: 1;
  }
  88% {
    opacity: 1;
  }
  100% {
    background-position: -20% 0%;
    opacity: 0;
  }
}
@keyframes skip-day-stars {
  0% {
    opacity: 0;
  }
  63% {
    opacity: 0;
  }
  75% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}/*# sourceMappingURL=time-tracker.css.map */
/* twine-user-stylesheet #18: "main.css" */
@keyframes magic {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
:root {
  --magic-color: transparent;
  --magic-visibility: none;
  --magic-time: 2s;
  --fill-color: #9d9a90;
  --font-color: black;
}
:root[theme=castle] {
  --theme-color: rgb(204, 167, 14);
  --background-image: linear-gradient(rgba(0, 0, 0, 0.1),rgba(0, 0, 0, 0.1)), url("images/backgrounds/cobblestones.jpg");
  --background-color: rgb(44, 49, 48);
}
:root[theme=town] {
  --theme-color: rgb(131, 93, 29);
  --background-image: linear-gradient(rgba(0, 0, 0, 0.5),rgba(0, 0, 0, 0.5)), url("images/backgrounds/paper-background.jpg");
  --background-color: rgb(101, 88, 58);
}
:root[theme=forest] {
  --theme-color: rgb(52, 104, 23);
  --background-image: linear-gradient(rgba(0, 0, 0, 0.5),rgba(0, 0, 0, 0.5)), url("images/backgrounds/forest.png");
  --background-color: rgb(32, 54, 1);
}

element:hover, element:active {
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}

html,
body {
  top: 0;
  min-height: 100%;
  position: absolute;
  min-width: 100%;
}

body {
  background-image: var(--background-image);
  background-repeat: repeat;
  background-color: var(--background-color);
  color: black;
  font-size: 16px;
  font-family: Georgia, Helmet, Freesans, sans-serif;
}
body::-webkit-scrollbar {
  width: 5px;
  height: 5px;
  background-color: transparent;
}
body::-webkit-scrollbar-thumb {
  border-radius: 10px;
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
  background-color: var(--theme-color);
}
body::-webkit-scrollbar-track {
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
  border-radius: 10px;
  background-color: transparent;
}

.cheats-menu ul {
  list-style: none;
}
.cheats-menu ul .icon {
  transform: translateY(0.65em);
}

.changelog-menu h2 {
  margin: 0;
}
.changelog-menu ul {
  margin: 0;
}
.changelog-menu ul li:not(:first-child) {
  margin-top: 10px;
}
.changelog-menu ul ul li:not(:first-child) {
  margin-top: 5px;
}

area.closed {
  cursor: default;
  pointer-events: none;
}

#right-ui-bar-body {
  position: relative;
}
#right-ui-bar-body #portrait-container {
  width: 80%;
  margin: 30px 0 20px 0;
}
#right-ui-bar-body #portrait-container .portrait {
  width: 93%;
  transform: translateX(13.5%);
}
#right-ui-bar-body #portrait-container .portrait-frame {
  position: absolute;
  left: 50%;
  transform: translate(-50%, -13.5%);
  width: 85%;
}
#right-ui-bar-body #portrait-container .portrait-name {
  position: absolute;
  left: 50%;
  transform: translate(-50%, -100%);
  background-color: #f2d652;
  border: 2px ridge #e3b92d;
  font-size: medium;
  padding: 0 5px;
  font-family: "MedievalSharp";
}
#right-ui-bar-body #portrait-container .portrait-name.peasant {
  background-color: #6f3214;
  border: 2px ridge #3d1901;
}
#right-ui-bar-body #body-container {
  height: 400px;
  width: 100%;
  position: relative;
  background: white;
}
#right-ui-bar-body #body-container .body-part {
  position: absolute;
  left: 0;
  right: 0;
  margin: auto;
  height: 100%;
}
#right-ui-bar-body #body-container .body-part.hide {
  visibility: hidden;
}
#right-ui-bar-body #equipment {
  height: 214px;
  width: 100%;
  margin-bottom: 46px;
  display: grid;
  grid-template-columns: 144px 104px;
  grid-template-rows: 104px 104px;
  row-gap: 4px;
  -moz-column-gap: 4px;
       column-gap: 4px;
}
#right-ui-bar-body #equipment .equipment-item {
  border: 2px ridge var(--theme-color);
  width: 102px;
  height: 102px;
}
#right-ui-bar-body #equipment .equipment-item.first {
  width: 140px;
  height: 210px;
  grid-column: 1;
  grid-row: 1/3;
}
#right-ui-bar-body #equipment .equipment-item.second {
  grid-column: 2;
  grid-row: 1;
}
#right-ui-bar-body #equipment .equipment-item.third {
  grid-column: 2;
  grid-row: 2;
}
#right-ui-bar-body #equipment .layer-buttons {
  grid-column: 1/3;
}

.ridge-border {
  border: 2px ridge var(--theme-color);
}

#ui-bar, #right-ui-bar {
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
  margin: 10px;
  bottom: 0;
  padding: 10px 3px;
  height: inherit;
}
#ui-bar:after, #right-ui-bar:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
#ui-bar:before, #right-ui-bar:before {
  z-index: -1;
}
#ui-bar #ui-bar-tray, #ui-bar #right-ui-bar-tray, #right-ui-bar #ui-bar-tray, #right-ui-bar #right-ui-bar-tray {
  left: 0.2em;
  right: 0.2em;
}
#ui-bar #ui-bar-tray button, #ui-bar #right-ui-bar-tray button, #right-ui-bar #ui-bar-tray button, #right-ui-bar #right-ui-bar-tray button {
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  border: 2px ridge var(--theme-color);
  background-color: transparent;
}
#ui-bar #ui-bar-tray button:hover, #ui-bar #right-ui-bar-tray button:hover, #right-ui-bar #ui-bar-tray button:hover, #right-ui-bar #right-ui-bar-tray button:hover {
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%);
  color: color-mix(in srgb, var(--theme-color), #000000 50%);
  border: 2px ridge color-mix(in srgb, var(--theme-color), #ffffff 50%);
}
#ui-bar #ui-bar-tray button:active, #ui-bar #right-ui-bar-tray button:active, #right-ui-bar #ui-bar-tray button:active, #right-ui-bar #right-ui-bar-tray button:active {
  border-style: groove;
}
#ui-bar #ui-bar-tray button:disabled, #ui-bar #right-ui-bar-tray button:disabled, #right-ui-bar #ui-bar-tray button:disabled, #right-ui-bar #right-ui-bar-tray button:disabled {
  text-shadow: 0px 0px 0 var(--theme-color), 0px 0px 0 var(--theme-color), 0px 0px 0 var(--theme-color), 0px 0px 0 var(--theme-color);
  border: 2px ridge color-mix(in srgb, var(--theme-color), #000000 50%);
  color: color-mix(in srgb, var(--theme-color), #000000 50%);
}
#ui-bar #ui-bar-tray button:disabled:active, #ui-bar #right-ui-bar-tray button:disabled:active, #right-ui-bar #ui-bar-tray button:disabled:active, #right-ui-bar #right-ui-bar-tray button:disabled:active {
  border-style: ridge;
}
#ui-bar #ui-bar-tray #ui-bar-toggle, #ui-bar #right-ui-bar-tray #ui-bar-toggle, #right-ui-bar #ui-bar-tray #ui-bar-toggle, #right-ui-bar #right-ui-bar-tray #ui-bar-toggle {
  border-right: 2px ridge var(--theme-color);
}
#ui-bar #ui-bar-tray #right-ui-bar-toggle, #ui-bar #right-ui-bar-tray #right-ui-bar-toggle, #right-ui-bar #ui-bar-tray #right-ui-bar-toggle, #right-ui-bar #right-ui-bar-tray #right-ui-bar-toggle {
  border-left: 2px ridge var(--theme-color);
}
#ui-bar h3, #right-ui-bar h3 {
  border: 2px ridge var(--theme-color);
  border-bottom: none;
  margin-top: 10px;
  font-family: "MedievalSharp";
  font-size: 24px;
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
  margin-bottom: 0;
}
#ui-bar #quests-list, #right-ui-bar #quests-list {
  border: 2px ridge var(--theme-color);
}
#ui-bar #quests-list .goal, #right-ui-bar #quests-list .goal {
  display: block;
}
#ui-bar #quests-list .goal:not(:first-child), #right-ui-bar #quests-list .goal:not(:first-child) {
  margin-top: 0.5em;
}
#ui-bar #ui-bar-body, #ui-bar #right-ui-bar-body, #right-ui-bar #ui-bar-body, #right-ui-bar #right-ui-bar-body {
  padding: 0 10px;
}
#ui-bar #ui-bar-body::-webkit-scrollbar, #ui-bar #right-ui-bar-body::-webkit-scrollbar, #right-ui-bar #ui-bar-body::-webkit-scrollbar, #right-ui-bar #right-ui-bar-body::-webkit-scrollbar {
  width: 5px;
  height: 5px;
  background-color: transparent;
}
#ui-bar #ui-bar-body::-webkit-scrollbar-thumb, #ui-bar #right-ui-bar-body::-webkit-scrollbar-thumb, #right-ui-bar #ui-bar-body::-webkit-scrollbar-thumb, #right-ui-bar #right-ui-bar-body::-webkit-scrollbar-thumb {
  border-radius: 10px;
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
  background-color: var(--theme-color);
}
#ui-bar #ui-bar-body::-webkit-scrollbar-track, #ui-bar #right-ui-bar-body::-webkit-scrollbar-track, #right-ui-bar #ui-bar-body::-webkit-scrollbar-track, #right-ui-bar #right-ui-bar-body::-webkit-scrollbar-track {
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
  border-radius: 10px;
  background-color: transparent;
}
#ui-bar:has(.menu-bottom), #right-ui-bar:has(.menu-bottom) {
  padding-bottom: 72px;
}
#ui-bar .menu-bottom, #right-ui-bar .menu-bottom {
  position: absolute;
  bottom: 5px;
  margin: auto;
  height: 60px;
  width: 256px;
}
#ui-bar .menu-bottom a, #right-ui-bar .menu-bottom a {
  border: 2px ridge var(--theme-color);
  width: 100%;
  height: 56px;
  margin: auto;
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
}
#ui-bar .menu-bottom a .patreon-subtext, #right-ui-bar .menu-bottom a .patreon-subtext {
  display: block;
}
#ui-bar .menu-bottom a:hover, #right-ui-bar .menu-bottom a:hover {
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
  text-decoration: underline;
  transform: translateX(-3px);
}
#ui-bar .menu-bottom a:hover:after, #right-ui-bar .menu-bottom a:hover:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}

#ui-bar.stowed {
  left: -16.5em;
}

#right-ui-bar.stowed {
  right: -16.5em;
}

h1#story-title {
  text-shadow: 1px 1px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), -1px 1px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), -1px -1px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), 1px -1px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), 2px 2px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%), -2px 2px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%), -2px -2px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%), 2px -2px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%);
  color: var(--title-color);
  font-family: "Berry Rotunda";
  font-size: 25px;
  background-image: url(images/backgrounds/title-background.jpg);
  background-repeat: repeat;
  background-size: 150px;
  background-blend-mode: lighten;
  background-color: rgba(255, 255, 255, 0.3);
  outline: 2px ridge rgb(204, 167, 39);
  padding-top: 5px;
  margin-top: 3px;
}

.empty-block {
  display: inline-block;
  position: relative;
  height: 50px;
}

h1.story-title-animation {
  transition: color 3s ease-in-out;
  text-shadow: 2px 2px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), -2px 2px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), -2px -2px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), 2px -2px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), 4px 4px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%), -4px 4px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%), -4px -4px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%), 4px -4px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%);
  color: #000080;
  font-family: "Berry Rotunda";
  font-size: 50px;
  background-image: url(images/backgrounds/title-background.jpg);
  background-repeat: repeat;
  background-size: 300px;
  background-blend-mode: lighten;
  background-color: rgba(255, 255, 255, 0.3);
  outline: 2px ridge rgb(204, 167, 39);
  padding-top: 10px;
  margin: auto;
  width: 510px;
  text-align: center;
}
h1.story-title-animation span {
  transition: font-size 2s ease-in-out, color 3s ease-in-out, transform 2s ease-in-out, text-shadow 2s ease-in-out;
  display: inline-block;
  font-size: 14px;
  transform: translateY(-36px);
  text-shadow: 2px 2px 0 #000080, -2px 2px 0 #000080, -2px -2px 0 #000080, 2px -2px 0 #000080, 4px 4px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), -4px 4px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), -4px -4px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), 4px -4px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%);
}
h1.story-title-animation.animate {
  color: #b000b5;
}
h1.story-title-animation.animate span {
  font-size: 50px;
  transform: translateY(0px);
  text-shadow: 2px 2px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), -2px 2px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), -2px -2px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), 2px -2px 0 color-mix(in srgb, rgb(204, 167, 14), #ffffff 50%), 4px 4px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%), -4px 4px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%), -4px -4px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%), 4px -4px 0 color-mix(in srgb, rgb(204, 167, 14), #000000 50%);
}

#story-subtitle {
  font-style: italic;
  font-size: 12px;
  margin-top: 5px;
}

.name {
  display: inline;
  position: relative;
  text-decoration-line: underline;
  text-decoration-style: dashed;
  text-decoration-thickness: 1px;
}

img.blurred {
  filter: blur(3px);
  -webkit-filter: blur(3px);
}

@media screen and (max-width: 1440px) {
  #story {
    margin-left: 22.5em;
    margin-right: 22.5em;
  }
}
#story {
  position: relative;
  background-color: transparent !important;
  transition: margin 0.2s ease-in;
}

#passages {
  position: relative;
}

.token {
  border-radius: 50%;
  border: 3px solid;
}

#passage-setup h3 {
  margin: 0;
  margin-top: 10px;
  line-height: 2em;
}
#passage-setup h5 {
  margin: 0;
  margin-bottom: 10px;
  line-height: 1em;
  font-style: italic;
}
#passage-setup label {
  cursor: pointer;
}
#passage-setup #theme-examples {
  display: flex;
  justify-content: center;
}
#passage-setup #theme-examples label {
  border: 3px;
  border-style: ridge;
  border-color: var(--theme-color);
  background: var(--fill-color);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 10%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 10%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color);
  padding: 0;
  margin: 20px;
  padding: 10px;
  justify-content: center;
  text-align: center;
}
#passage-setup #theme-examples label .portrait {
  max-width: 8vw;
}

.inline-img {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
}

a.inline-link {
  display: inline-block;
}
a.inline-link img {
  display: inline-block;
  margin: auto;
  height: 1.5em;
  transform: translateY(23%);
}

.passage {
  position: relative;
  color: black;
}
.passage:not(.location) {
  padding-bottom: 1px;
}
.passage .sound-button button {
  margin: auto;
  display: block;
}
.passage .background-big {
  position: fixed;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  min-height: 100%;
  min-width: 100%;
  user-drag: none;
  -webkit-user-drag: none;
  pointer-events: none;
  -moz-user-select: none;
  -webkit-user-select: none;
  user-select: none;
  z-index: -2;
}
.passage img:not(.passage-block *):not(.body *):not(.icon):not(.portrait):not(.minigame *), .passage img.centered {
  border: 2px ridge var(--theme-color);
  display: block;
  margin: 5px auto;
}
.passage video {
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
  display: block;
  margin: 5px auto;
  max-height: 60vh;
  margin-bottom: 15px;
  padding: 2px;
  max-width: calc(100% - 20px);
}
.passage video:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.passage a:not(.inline-link) {
  border: 5px;
  border-color: var(--player-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--player-color), #ffffff 50%);
  color: black;
  display: block;
  border-radius: 2em;
  padding: 5px;
  width: 50%;
  text-align: center;
  margin: 35px auto;
}
.passage a:not(.inline-link):not([disabled]) {
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--player-color), black 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--player-color), black 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
.passage a:not(.inline-link)[disabled] {
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--player-color), black 50%), 0 0 0 10px grey, inset 0 0 0 2px color-mix(in srgb, var(--player-color), black 50%), 0 5px 10px 1px rgba(0, 0, 0, 0.5), inset 0 0 0 15px rgb(106, 106, 106), inset 0 0 100vw 100vw rgb(106, 106, 106);
}
.passage a:not(.inline-link):not([disabled]):focus {
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--player-color), black 50%), 0 0 0 10px color-mix(in srgb, var(--fill-color), white 15%), inset 0 0 0 2px color-mix(in srgb, var(--player-color), black 50%), 0 5px 15px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px color-mix(in srgb, var(--fill-color), white 15%), inset 0 0 100vw 100vw color-mix(in srgb, var(--fill-color), white 15%);
  text-decoration: underline;
}
.passage a:not(.inline-link):not([disabled]):hover {
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--player-color), black 50%), 0 0 0 10px color-mix(in srgb, var(--fill-color), white 15%), inset 0 0 0 2px color-mix(in srgb, var(--player-color), black 50%), 0 5px 15px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px color-mix(in srgb, var(--fill-color), white 15%), inset 0 0 100vw 100vw color-mix(in srgb, var(--fill-color), white 15%);
  transform: translateY(-2px);
}
.passage a:not(.inline-link):not([disabled]):active {
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--player-color), black 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--player-color), black 50%), 0 1px 5px 10px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
  transform: translateY(2px);
}
.passage a:not(.inline-link) .name:not(.player) {
  text-shadow: none;
  text-decoration-style: dashed;
}
.passage .passage-background {
  position: absolute;
  top: 0;
  bottom: 0;
  right: -10px;
  left: -10px;
  background-image: url("images/textures/bg_parchment-light.webp");
  background-color: #F4E1C4;
  background-clip: padding-box;
  border-style: solid;
  border-width: 30px;
  -o-border-image: url("images/textures/bg_border.webp") 30 30 30 30 repeat round;
     border-image: url("images/textures/bg_border.webp") 30 30 30 30 repeat round;
  margin: -10px;
  z-index: -1;
}
.passage .passage-block {
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
  position: relative;
  margin: 30px -15px;
  padding: 10px;
}
.passage .passage-block:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
.passage .say-box {
  position: relative;
  margin: 30px -15px;
  padding: 10px;
  border-radius: 8vw;
  overflow: hidden;
}
.passage .say-box .name:not(.player) {
  text-shadow: none;
  text-decoration-style: dashed;
}
.passage .say-box img {
  max-width: 8em;
  float: left;
  margin-right: 1em;
}
.passage .say-box h4 {
  font-weight: bold;
  margin: 0.2em 0;
}
.passage .say-box p {
  margin: 0 2em 1em 2em;
}
.passage h2.location-title {
  font-family: "MedievalSharp";
  font-size: 50px;
  position: absolute;
  pointer-events: none;
  top: 10px;
  left: 30px;
  margin: 0;
  z-index: 2;
  text-shadow: 3px 0px 7px var(--theme-color), -3px 0px 7px var(--theme-color), 0px 4px 7px var(--theme-color);
  color: #dfdfdf;
}
.passage h3 {
  margin-top: 10px;
  font-family: "MedievalSharp";
  font-size: 24px;
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
  margin-bottom: 0;
  padding-top: 0.5em;
}
.passage.center {
  text-align: center;
}
.passage #navigation {
  position: relative;
}
.passage #navigation .navigation-map {
  max-width: 100%;
}
.passage #navigation img[usemap] {
  width: 54em;
  height: 27em;
  max-width: 54em;
  max-height: 27em;
}
.passage #navigation .token {
  position: absolute;
  pointer-events: none;
}
.passage #location-image {
  max-width: 100%;
  z-index: 1;
  position: relative;
  display: block;
}
.passage #location-image.clickable {
  cursor: pointer;
}
.passage #location-description.hidden {
  display: none;
}

#menu li a {
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  font-family: "MedievalSharp";
  background-color: transparent;
}
#menu li a:hover {
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #ffffff 50%);
  color: color-mix(in srgb, var(--theme-color), #000000 50%);
  background-color: transparent;
  border-color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
}
#menu li a:active {
  border-color: color-mix(in srgb, var(--theme-color), #000000 50%);
}
#menu ul {
  border: 2px ridge var(--theme-color);
}
#menu ul li:not(:first-child) {
  border-top: 2px ridge var(--theme-color);
}
#menu #menu-story {
  border-bottom: none;
}
#menu #menu-core {
  margin-top: 0;
}

#ui-dialog {
  max-width: 40em;
}
#ui-dialog #ui-dialog-titlebar {
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
#ui-dialog #ui-dialog-titlebar:after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
#ui-dialog #ui-dialog-titlebar h1 {
  padding: 0.2em 0.5em 0.2em 0.5em;
  font-family: "MedievalSharp";
  font-size: 2em;
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
}
#ui-dialog #ui-dialog-body {
  margin-top: 12px;
}
#ui-dialog #ui-dialog-body::-webkit-scrollbar {
  width: 5px;
  height: 5px;
  background-color: transparent;
}
#ui-dialog #ui-dialog-body::-webkit-scrollbar-thumb {
  border-radius: 10px;
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
  background-color: var(--theme-color);
}
#ui-dialog #ui-dialog-body::-webkit-scrollbar-track {
  -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
  border-radius: 10px;
  background-color: transparent;
}
#ui-dialog #ui-dialog-body:not(.character-popup) {
  border: 5px;
  border-color: var(--theme-color);
  border-style: dashed;
  background: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 0 0 10px var(--fill-color), inset 0 0 0 2px color-mix(in srgb, var(--theme-color), #000000 50%), 0 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 0 15px var(--fill-color), inset 0 0 100vw 100vw var(--fill-color);
}
#ui-dialog #ui-dialog-body:not(.character-popup):after {
  pointer-events: none;
  content: "";
  position: absolute;
  top: -15px;
  left: -15px;
  bottom: -15px;
  right: -15px;
  display: var(--magic-visibility);
  background-image: radial-gradient(circle, transparent 10%, var(--magic-color) 99.99%);
  animation: var(--magic-time) magic alternate ease-in-out infinite;
}
#ui-dialog #ui-dialog-body h2 {
  font-family: "MedievalSharp";
  font-size: 1.5em;
  color: color-mix(in srgb, var(--theme-color), #ffffff 50%);
  text-shadow: 1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px 1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), -1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%), 1px -1px 0 color-mix(in srgb, var(--theme-color), #000000 50%);
}

.credits-menu .credits-image {
  width: 100%;
  border: 2px ridge var(--theme-color);
}

.paper-background {
  background-image: url("images/textures/bg_parchment-light.webp");
  background-color: #F4E1C4;
  background-clip: padding-box;
  border-style: solid;
  border-width: 30px;
  -o-border-image: url("images/textures/bg_border.webp") 30 30 30 30 repeat round;
     border-image: url("images/textures/bg_border.webp") 30 30 30 30 repeat round;
  margin: -10px;
}
.paper-background.paper-background-inline {
  display: inline;
  border-width: 10px;
}

#passage-chapter {
  margin-top: 36vh;
}
#passage-chapter svg {
  overflow: visible;
}
#passage-chapter #chapter-container {
  padding-top: 20px;
  padding-bottom: 66px;
  min-height: 111.875px;
}
#passage-chapter #chapter-container path[stroke=black] {
  stroke: var(--title-color);
}
#passage-chapter .passage-background {
  top: 32px;
  bottom: 64px;
  right: 150px;
  left: 150px;
}
#passage-chapter a {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: -15px;
  width: 160px;
}

@keyframes toggle-description {
  0% {
    top: -0.75em;
    opacity: 1;
    display: block;
  }
  100% {
    top: -100px;
    opacity: 0;
    display: none;
  }
}
.dish {
  cursor: pointer;
}/*# sourceMappingURL=main.css.map */</style><script role="script" id="twine-user-script" type="text/twine-javascript">/* twine-user-script #1: "lib.js" */
function isCapitalised( word ){
  return word[0] !== word[0].toLowerCase();
}

function upperFirst(val) {
  return String(val).charAt(0).toUpperCase() + String(val).slice(1);
}

function componentToHex(c) {
    var hex = c.toString(16);
    return hex.length == 1 ? "0" + hex : hex;
  }
  
function rgbToHexSeparate(r, g, b) {
    return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
}

function rgbToHex(rgb) {
    let [r, g, b] = rgb.replace('rgb(', '')
      .replace(')', '')
      .split(',')
      .map(str => Number(str));
    return rgbToHexSeparate(r, g, b);
}

function clamp(number, min, max) {
	return Math.min(Math.max(number, min), max);
};

function map_range(value, low1, high1, low2, high2) {
    return low2 + (high2 - low2) * (value - low1) / (high1 - low1);
}

function lerp (start, end, amt){
	  return (1-amt)*start+amt*end;
}

function isScrolledIntoView(elem)
{
    let docViewTop = $(window).scrollTop();
    let docViewBottom = docViewTop + $(window).height();

    let elemTop = $(elem).offset().top;
    let elemBottom = elemTop + $(elem).height();
    let margin = (elemBottom - elemTop) * 0.25;

    return ((elemBottom <= docViewBottom + margin) && (elemTop >= docViewTop - margin));
}

// blend two hex colors together by an amount
function blendColors(colorA, colorB, amount) {
	const [rA, gA, bA] = colorA.match(/\w\w/g).map((c) => parseInt(c, 16));
	const [rB, gB, bB] = colorB.match(/\w\w/g).map((c) => parseInt(c, 16));
	const r = Math.round(rA + (rB - rA) * amount).toString(16).padStart(2, '0');
	const g = Math.round(gA + (gB - gA) * amount).toString(16).padStart(2, '0');
	const b = Math.round(bA + (bB - bA) * amount).toString(16).padStart(2, '0');
	return '#' + r + g + b;
}

function getRandomWord(list) {
  let random = Math.random();
  let amount = 0;
  for (var item of list) {
      amount += item.chance;
      if (random < amount)
          return settings.bread ? item.word.replace('highness', 'breadness') : item.word;
  }
}
/* twine-user-script #2: "artifacts.js" */
setup.artifacts = {
    sword: { name: "Zephyr, the Wind's Edge" },
    chalk: { name: "Circle Chalk" },
    mirror: { name: "Magic Mirror" },
    orb: { name: "Orb of Scrying"},
    book: { name: "Tome of Memories" },
    scroll: { locked: true, name: "Scroll of Affirmations" },
    beans: { locked: true, name: "Suspicious Bag of Beans" },
    /* statue: { unlocked: false, locked: true }, */
    bird: { locked: true, name: "Helix the Mechanical Bird" },
    key: { locked: true, name: "Stillstone Key" }
    // bowtie: { locked: true, name: "Dapper Bow Tie" }
};

// function chalk() {
//     if (variables().artifacts.chalk.drawing)
//     variables().artifacts.chalk.drawing = true;
//     variables().artifacts.chalk.location = null;
// }

function artifacts($output, reliquary) {
    let $artifacts = $('<div id="artifacts"></div>');

    for (const [key, value] of Object.entries(setup.artifacts)) {
        if (!variables().artifacts[key])
            variables().artifacts[key] = { unlocked: false };
        let variable = variables().artifacts[key];
        if ((reliquary && variable.unlocked) || (!reliquary && !variable.unlocked))
            continue;
        let $artifact = $('<a class="artifact"><img class="artifact-img" src="images/artifacts/' + key + '.jpg"><span class="artifact-name">' + value.name + '</span></a>');
        if (value.locked) {
            $artifact.attr('disabled', 'disabled');
            
            popup($artifact, "Not implemented yet.");
        } else {
            $artifact.on('click', function() {
                Engine.play(reliquary ? ("Artifact Info " + key) : "Artifact " + key);
            });
        }
        $artifact.appendTo($artifacts);
    }
    if (!($output instanceof $)) {
        $output = $($output);
    }
    $artifacts.appendTo($output);
}

for (const [key, value] of Object.entries(setup.artifacts)) {
    Template.add(key, function() {
        return '<span class="special ' + key + '">' + value.name + '</span>';
    });
}

function hasArtifact (name) {
    if (variables().artifacts[name].unlocked)
        return true;
    return false;
}

function hasAvailableArtifact() {
    for (const [key, value] of Object.entries(setup.artifacts)) {
        if (value.locked) {
            continue;
        }
        if (!variables().artifacts[key].unlocked)
            return true;
    }
    return false;
}

function startMemory() {
    variables().artifacts['book'].chastity = isInChastity();
    if (isInChastity()) {
        unequip('crotch', true);
    }
    variables().artifacts['book'].memory = true;
    variables().artifacts['book'].time = getTime();
    variables().artifacts['book'].day = getDay();
    variables().artifacts['book'].location = getLocation().title;
}

function endMemory() {
    setTime(variables().artifacts['book'].time);
    delete variables().artifacts['book'].time;
    setDay(variables().artifacts['book'].day);
    delete variables().artifacts['book'].day;
    setLocation(variables().artifacts['book'].location);
    delete variables().artifacts['book'].location;
    delete variables().artifacts['book'].memory;
    if (variables().artifacts['book'].chastity) {
        equipChastity();
    }
    delete variables().artifacts['book'].chastity;
}

function isMemory() {
    return !!variables().artifacts['book'].memory;
}

setup.hasArtifact = hasArtifact;
window.hasArtifact = window.hasArtifact || hasArtifact;
setup.hasAvailableArtifact = hasAvailableArtifact;
window.hasAvailableArtifact = window.hasAvailableArtifact || hasAvailableArtifact;
setup.isMemory = isMemory;
window.isMemory = window.isMemory || isMemory;

Config.navigation.override = function (dest) {
    if (dest === "Magic Circle") {
        flashEffect("rgba(250, 241, 77, 0.5)", 400);
        if (!tags(variables().artifacts.chalk.location).includes('castle')) {
            $.wiki("<<outfit disguise>>");
        }

        return variables().artifacts.chalk.location;
    }
};

$(document).one(':passagestart', function () {

    Macro.add('hasartifact', {
        handler : function () {
            hasArtifact(this.args[0]);
        }
    });

    Macro.add('artifacts', {
        handler : function () {
            artifacts(this.output, this.args[0]);
        }
    })

    Macro.add('startmemory', {
        handler : function () {
            startMemory();
        }
    })

    Macro.add('endmemory', {
        handler : function () {
            endMemory();
        }
    })
});


/* twine-user-script #3: "body.js" */
/*
chest:
    0 - flat
    1 - small
    2 - medium
    3 - big
penis:
    0 - vulva
    1 - small
    2 - medium
    3 - big
ass:
    0 - flat
    1 - small
    2 - medium
    3 - big
hair:
    0 - none
    1 - short
    2 - medium
    3 - long
haircolor:
    0 - brown
face: 
    0 - masculine
    1 - egg
    2 - androgynous
    3 - feminine
shoulders: 
    0 - masculine
    1 - androgynous
    2 - feminine
hips: 
    0 - masculine
    1 - androgynous
    2 - feminine
muscles: 
    0 - none
    1 - fit
    2 - toned
aroused: 
    0 - false
    1 - true
*/
var bodyValues = {
    chest: ['flat', 'small', 'medium', 'big'],
    penis: ['vulva', 'small', 'medium', 'big'],
    ass: ['flat', 'small', 'medium', 'big'],
    hair: ['none', 'short', 'medium', 'long'],
    haircolor: ['brown'],
    face: ['masculine', 'egg', 'androgynous', 'feminine'],
    shoulders: ['masculine', 'androgynous', 'feminine'],
    hips: ['masculine', 'androgynous', 'feminine'],
    muscles: ['none', 'fit', 'toned'],
    aroused: [false, true]
}


function hasBoobs() {
    return chestValue() > 0;
}

function isAroused() {
    return aroused() > 0;
}

function hasSmallPenis() {
    return penisValue() === 1;
}

function hasPenis() {
    return penisValue() > 0;
}

function hasVulva() {
    return penisValue() < 1;
}

function erect() {
    return isAroused() ? 'erect' : 'flaccid';
}

function changeBody(type, value) {
    if (isMemory() && type !== 'aroused')
        return;

    if (value === 'increase') {
        if (variables().body[type] + 1 < bodyValues[type].length) {
            variables().body[type]++;
        }
        return;
    }
    if (value === 'decrease') {
        if (variables().body[type] > 0) {
            variables().body[type]--;
        }
        return;
    }

    if (isNaN(value)) {
        variables().body[type] = bodyValues[type].indexOf(value);
    } else {
        variables().body[type] = +value;
    }
}

function faceImg(gender) {
    let $img = $(document.createElement('img')).addClass('body-part');
    if (gender === undefined)
        gender = face();

    $img.attr('src', 'images/body/face' + gender + '.png');

    return $img;
}

function hairImg(length, color) {
    let $img = $(document.createElement('img')).addClass('body-part');
    if (length === undefined)
        length = hair();
    if (color === undefined)
        color = hairColor();

    $img.attr('src', 'images/body/hair_' + length + '_' + color + '.png');

    return $img;
}

function chestImg(size) {
    let $img = $(document.createElement('img')).addClass('body-part');
    if (size === undefined)
        size = chest();
    $img.attr('src', 'images/body/chest_' + size + '.png');
    return $img;
}

function penisImg(showChastity, size, aroused) {
    let $img = $(document.createElement('img')).addClass('body-part');
    if (size === undefined)
        size = penis();
    if (aroused === undefined)
        aroused = erect();
    else
        aroused = aroused ? 'erect' : 'flaccid';

    if (settings.bread)
        aroused = 'bread';

    if (showChastity && isInChastity()) {
        let chastity = variables().chastity;
        $img.attr('src', 'images/equipment/chastity_' + chastity.color + '_' + chastity.size + '.png');
    }
    else if (size === 'vulva')
        $img.attr('src', 'images/body/vulva.png');
    else
        $img.attr('src', 'images/body/penis_' + aroused + '_' + size + '.png');

    return $img;
}

function oldBodyValue(type, value) {
    if (value === 'increase')
        return bodyValues[type][variables().body[type] - 1];
    if (value === 'decrease')
        return bodyValues[type][variables().body[type] + 1];

    if (isNaN(value)) {
        return value;
    } else {
        return bodyValues[type][value];
    }
}

function showBody($output, type, fadeoutParts, fadeoutValues) {
    let $box = $(document.createElement('div')).addClass('body');

    if (type)
        $box.addClass(type);

    if (type.contains('location'))
        $(document.createElement('div')).append($(document.createElement('img')).attr('src', getLocationImage())).addClass('body-background').appendTo($box);

    let showChastity = !type.contains('ignore-chastity');

    let $bodyElements = $(document.createElement('div')).addClass('body-elements').appendTo($box);

    $bodyElements.wiki("<<img 'body/body.png' 'body-first'>>");
    let hairImage = hairImg();
    let chestImage = chestImg();
    let penisImage = penisImg(showChastity);

    if (fadeoutParts.length > 0) {
        let fadeouts = {};
        let hairChanged = false;
        let chestChanged = false;
        let penisChanged = false;
        for (let i = 0; i < fadeoutParts.length; i++) {
            let part = fadeoutParts[i];
            let value = oldBodyValue(part, fadeoutValues[i]);
            
            if (value === bodyValues[part][variables().body[part]])
                continue;

            fadeouts[part] = value;
            switch (part) {
                case 'hair':
                case 'haircolor':
                    hairChanged = true;
                    break;
                case 'chest':
                    chestChanged = true;
                    break;
                case 'penis':
                case 'aroused':
                    penisChanged = true;
                    break;
            }
        }
        if (hairChanged) {
            hairImg(fadeouts['hair'], fadeouts['haircolor']).addClass('fadeout').appendTo($bodyElements);
            hairImage.addClass('fadein');
        }
        if (chestChanged) {
            chestImg(fadeouts['chest']).addClass('fadeout').appendTo($bodyElements);
            chestImage.addClass('fadein');
        }
        if (penisChanged) {
            penisImg(showChastity, fadeouts['penis'], fadeouts['aroused']).addClass('fadeout').appendTo($bodyElements);
            penisImage.addClass('fadein');
        }
    }
    hairImage.appendTo($bodyElements);
    chestImage.appendTo($bodyElements);
    penisImage.appendTo(type.includes('penis') ? $box : $bodyElements);

    if (type.contains('mirror')) {
        $box.wiki("<<img 'body/frame.png' 'frame'>>");
    }

    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $box.appendTo($output);
    }

    return $box;
}

function bodySpan($output, type) {
    if (type !== 'penis' && type !== 'chest' && type !== 'hair') {
        console.error('bodySpan() -> invalid type ' + type);
        return;
    }
    var $span = $(document.createElement('span')).addClass('name').addClass(type);

    switch (type) {
        case 'penis':
            $span.wiki(penisTemplate());
            break;
        case 'chest':
            $span.wiki(chestTemplate());
            break;
        case 'hair':
            $span.wiki('hair');
            break;
    }
    
    popup($span, '<<showbody ' + type + ' location small>><</showbody>>');

    
    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $span.appendTo($output);
    }

    return $span;
}


function chest() {
    return bodyValues.chest[chestValue()];
}

function chestValue() {
    return variables().body.chest;
}

function penis() {
    return bodyValues.penis[penisValue()];
}

function penisValue() {
    return variables().body.penis;
}

function ass() {
    return bodyValues.ass[assValue()];
}

function assValue() {
    return variables().body.ass;
}

function hair() {
    return bodyValues.hair[hairValue()];
}

function hairValue() {
    return variables().body.hair;
}

function hairColor() {
    return bodyValues.haircolor[hairColorValue()];
}

function hairColorValue() {
    return variables().body.haircolor;
}

function face() {
    return bodyValues.face[faceValue()];
}

function faceValue() {
    return variables().body.face;
}

function shoulders() {
    return bodyValues.shoulders[shouldersValue()];
}

function shouldersValue() {
    return variables().body.shoulders;
}

function hips() {
    return bodyValues.hips[hipsValue()];
}

function hipsValue() {
    return variables().body.hips;
}

function muscles() {
    return bodyValues.muscles[musclesValue()];
}

function musclesValue() {
    return variables().body.muscles;
}

function aroused() {
    return bodyValues.aroused[arousedValue()];
}

function arousedValue() {
    return variables().body.aroused;
}

setup.hasBoobs = hasBoobs;
window.hasBoobs = window.hasBoobs || hasBoobs;
setup.isAroused = isAroused;
window.isAroused = window.isAroused || isAroused;
setup.hasSmallPenis = hasSmallPenis;
window.hasSmallPenis = window.hasSmallPenis || hasSmallPenis;
setup.hasPenis = hasPenis;
window.hasPenis = window.hasPenis || hasPenis;
setup.hasVulva = hasVulva;
window.hasVulva = window.hasVulva || hasVulva;
setup.erect = erect;
window.erect = window.erect || erect;


setup.chest = chest;
window.chest = window.chest || chest;
setup.chestValue = chestValue;
window.chestValue = window.chestValue || chestValue;
setup.penis = penis;
window.penis = window.penis || penis;
setup.penisValue = penisValue;
window.penisValue = window.penisValue || penisValue;
setup.ass = ass;
window.ass = window.ass || ass;
setup.assValue = assValue;
window.assValue = window.assValue || assValue;
setup.hair = hair;
window.hair = window.hair || hair;
setup.hairValue = hairValue;
window.hairValue = window.hairValue || hairValue;
setup.hairColor = hairColor;
window.hairColor = window.hairColor || hairColor;
setup.hairColorValue = hairColorValue;
window.hairColorValue = window.hairColorValue || hairColorValue;
setup.face = face;
window.face = window.face || face;
setup.faceValue = faceValue;
window.faceValue = window.faceValue || faceValue;
setup.shoulders = shoulders;
window.shoulders = window.shoulders || shoulders;
setup.shouldersValue = shouldersValue;
window.shouldersValue = window.shouldersValue || shouldersValue;
setup.hips = hips;
window.hips = window.hips || hips;
setup.hipsValue = hipsValue;
window.hipsValue = window.hipsValue || hipsValue;
setup.muscles = muscles;
window.muscles = window.muscles || muscles;
setup.musclesValue = musclesValue;
window.musclesValue = window.musclesValue || musclesValue;
setup.aroused = aroused;
window.aroused = window.aroused || aroused;
setup.arousedValue = arousedValue;
window.arousedValue = window.arousedValue || arousedValue;


$(document).one(':passagestart', function () {
    Macro.add('spicy', {
        handler : function () {
            changeBody('aroused', true);
        }
    });
    Macro.add('changebody', {
        handler : function () {
            changeBody(this.args[0], this.args[1]);
        }
    });
    Macro.add('showbody', {
        tags : [ 'transformation' ],
        handler : function () {
            let fadeoutParts = [];
            let fadeoutValues = [];

			for (let i = 0; i < this.payload.length; i++) {
				if (this.payload[i].name === 'transformation') {
                    fadeoutParts.push(this.payload[i].args[0]);
                    fadeoutValues.push(this.payload[i].args[1]);
				}
			}

            showBody(this.output, this.args.raw.trim(), fadeoutParts, fadeoutValues);
        }
    });
    Macro.add('bodyspan', {
        handler : function () {
            bodySpan(this.output, this.args[0]);
        }
    });
});

$(document).on(':passagestart', function () {
    if (tags().includes('spicy')) {
        if (!isAroused()) {
            // TODO first time aroused animation
        }
        changeBody('aroused', true);
    } else {
        changeBody('aroused', false);
    }
});
/* twine-user-script #4: "book.js" */
function book ($output, payload, bookClass, bookID, title, subtitle, interactable, open, finishable) {
    let $book = $('<div class="book"><div class="first paper"><div class="page front contents"><div class="intro"><h1>' + title + '</h1><h2>' + subtitle + '</h2></div></div><div class="page back"></div></div></div>');
    interactable = interactable === undefined || interactable;
    finishable = finishable === undefined || finishable;
    if (bookClass)
        $book.addClass(bookClass);

    if (interactable)
        $book.addClass('interactable');

    if (!subtitle)
        $book.find('h2').remove();


    let finishedContents;
    if (payload[payload.length - 1].name === "finished") {
        finishedContents = payload[payload.length - 1].contents;
    }
    let pages = [];
    for (let i = 1; i < payload.length; i++) {
        if (payload[i].name !== 'page')
            continue;
        if (!!payload[i].args.raw.trim() && !Scripting.evalJavaScript(payload[i].args.full)) {
            continue;
        }
        pages.push(payload[i]);
    }
    let p = pages.length + 1;

    $book.find('.paper.first').css('z-index', p + 4).find('.front').css('transform', 'translateZ(' + p * 0.1 + 'px)');
    if (open)
        $book.find('.paper.first').addClass('open');

    for (let i = 1; i < p; i++) {
        let $page = $('<div class="paper"><div class="page front contents"><div class="page-content"></div></div><div class="page back"></div></div>');
        $page.css('z-index', p - i + 4).find('.front').css('transform', 'translateZ(' + (p - i) * 0.1 + 'px)');
        $page.find('.back').css('transform', 'translateZ(-' + i + 'px)');
        $page.find('.contents .page-content').wiki(pages[i-1].contents);
        if (i + 1 === p) {
            $page.find('.contents').addClass('last');
        }
        else if (open)
            $page.addClass('open');
        $page.appendTo($book);
    }

    $book.append('<div class="side"></div><div class="bottom"></div><div class="shadow"></div>');

    if (!($output instanceof $)) {
        $output = $($output);
    }
    $book.appendTo($output);
    if (interactable) {
        $book.find(".front:not(.last)").on('click', function() {
            $book.addClass("open");
    
            let paper = $(this).parent(".paper");
    
            paper.addClass("open");
            paper.next().find("video").each(function() {
                $(this)[0].muted = !settings.sound;
                $(this)[0].volume = settings.videoVolume;
                $(this)[0].play();
            });
            paper.find("video").each(function() {
                $(this)[0].pause();
            });
        });
    
        $book.find(".back").on('click', function() {
            if ($(this).parent(".paper").index() == 0)
                $book.removeClass("open");
    
            let paper = $(this).parent(".paper");
    
            paper.removeClass("open");
            paper.next().find("video").each(function() {
                $(this)[0].pause();
            });
            paper.find("video").each(function() {
                $(this)[0].muted = !settings.sound;
                $(this)[0].volume = settings.videoVolume;
                $(this)[0].play();
            });
        });

        if (finishable) {
            $book.find(".last").addClass('finishable').on('click', function() {
                closeBook($book);
                if (finishedContents) {
                    var newDiv = $(document.createElement('div')).addClass('book-result').insertAfter($book);
                    newDiv.wiki(finishedContents).css('opacity', 0);
                    setTimeout(function() {
                        newDiv.css('opacity', 1);
                    }, 10);
                    finishedContents = null;
                }
                
                
                variables().books.pushUnique(bookID);
            });
        }
    }

    return $book;
}

function closeBook($book) {
    if ($book === undefined)
        $book = $($.find('.book'));

    $book.removeClass("open");
    $book.find("video").each(function() {
        $(this)[0].pause();
    });
    $($book.find(".paper").get().reverse()).each(function (index) {
        let paper = $(this);
        setTimeout(function() {
            paper.removeClass('open');
        }, index * 80);
    });

}

function note ($output, content, classes) { 
    let $note = $('<div class="note"><div class="shadow"></div></div>').wiki(content);
    if (classes) {
        $note.addClass(classes);
    }

    if (!($output instanceof $)) {
        $output = $($output);
    }
    $note.appendTo($output);
    return $note;
}


function hasRead (name) {
    return variables().books.includes(name);
}

setup.hasRead = hasRead;
window.hasRead = window.hasRead || hasRead;


$(document).one(':passagestart', function () {
    Macro.add('book', {
        tags : ['page', 'finished'],
        handler : function () {
            book(this.output, this.payload, this.args[0], this.args[1], this.args[2], this.args[3], this.args[4], this.args[5], this.args[6]);
        }
    });
    Macro.add('closebook', {
        handler : function () {
            closeBook();
        }
    });
    Macro.add('note', {
        tags : null,
        handler : function () {
            note(this.output, this.payload[0].contents, this.args.raw);
        }
    });
});
/* twine-user-script #5: "characters.js" */
var weekDays = [ 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday' ];

// var characters = {}; Could save merged characters in cache here

function hasCharacter(characterId) {
    return Object.hasOwn(variables().characters, characterId.toLowerCase());
}

function getCharacter(characterId) {
    characterId = characterId.toLowerCase();
    let setupCharacter = setup.characters[characterId];
    let varCharacter = variables().characters[characterId];
    return $.extend(true, {}, setupCharacter, varCharacter);
}

function addCharacter (characterId, blurred) {
    // if (State.length && !hasCharacter(characterId)) {
    //     throw new Error('addCharacter() -> must be called before story starts');
    // }
    if (!characterId) {
        console.error('addCharacter() -> invalid arguments');
        return;
    }
    if (hasCharacter(characterId)) {
        console.error('addCharacter() -> character "' + characterId + '" already exists');
        return;
    }
    let characterObject = {};
    if (blurred)
        characterObject.blurred = true;
    characterObject.acknowledgements = [];
    variables().characters[characterId] = characterObject;

    if (!Object.hasOwn(variables().relations, characterId)) {
        variables().relations[characterId] = 0;
    }

    let character = getCharacter(characterId);

    if (!Template.has(characterId)) {
        Template.add([characterId, characterId.toUpperFirst()], function() {
            return "<<name '" + characterId + "'>>";
        });
    }

    if (character.title) {
        let title = character.title.replace(' ', '').trim();
        if (!Template.has(title + characterId.toUpperFirst())) {
            Template.add(title + characterId.toUpperFirst(), function() {
                return "<<fullname '" + characterId + "'>>";
            });
        }
        if (!Template.has(title)) {
            Template.add(title, function() {
                return "<<title '" + characterId + "'>>";
            });
        }
    }
}

function removeCharacter(characterId) {
    if (!characterId) {
        console.error('removeCharacter() -> invalid arguments');
        return;
    }
    if (!hasCharacter(characterId)) {
        console.error('removeCharacter() -> character "' + characterId + '" doesn\'t exists');
        return;
    }
    
    delete variables().characters[characterId];

    if (Object.hasOwn(variables().relations, characterId)) {
        delete variables().relations[characterId];
    }

    if (Template.has(characterId)) {
        Template.delete(characterId);
        Template.delete(characterId.toUpperFirst());
    }
}

function getCharacters(location) {
    let characters = [];
    for (let id in setup.characters) {
        if (!hasCharacter(id))
            continue;
        characters.push(getCharacter(id));
    }
    if (!location) {
        return characters;
    }
    let day = getDay();
    let time = getTime();
    let result = [];
    for (let i = 0; i < characters.length; i++) {
        let character = characters[i];

        if (character.schedule) {
            if (character.schedule[day][time] === location && !hasCharacterCounter(character.id, location, time)) {
                result.push(character);
            }
        }
    }
    return result;
}

function getCharactersInArea(area) {
    let characters = getCharacters();
    let day = getDay();
    let time = getTime();
    let result = [];
    for (let i = 0; i < characters.length; i++) {
        let character = characters[i];
        if (character.schedule && character.schedule[day][time] && character.schedule[day][time] !== "None") {
            let location = getLocation(character.schedule[day][time]);
            if (location.area === area && !hasCharacterCounter(character.id, location.title, time)) {
                result.push(character);
            }
        }
    }
    return result;
}

function getCharactersForMap(location) {
    if (!hasLocation(location))
        return [];
    location = getLocation(location);
    let area = location.area;
    let currentArea = getArea();

    let result;
    if (area !== currentArea && location.title.toLowerCase().replace(' ', '-') === area) {
        result = getCharactersInArea(area);
    } else {
        result = getCharacters(location.title);
    }
    if (location.title === getAreaExit(currentArea)) {
        changeName('leave', 'Leave ' + currentArea);
        result.push(getCharacter('leave'));
    }
    return result;
}

function getCharacterLocation(characterId) {
    if (!characterId) {
        console.error('getCharacterLocation() -> invalid arguments');
        return;
    }
    let character = getCharacter(characterId);
    if (character.schedule) {
        return character.schedule[getDay()][getTime()];
    }
}


function changeBlurred(characterId, blurred) {
    if (isMemory() || !characterId || !blurred || !hasCharacter(characterId)) {
        return;
    }

    if (blurred === setup.characters[characterId.toLowerCase()].blurred) {
        delete variables().characters[characterId.toLowerCase()].blurred;
    } else {
        variables().characters[characterId.toLowerCase()].blurred = blurred;
    }
}

function changeName(characterId, name) {
    if (isMemory() || !characterId || !name || !hasCharacter(characterId)) {
        return;
    }

    if (name === setup.characters[characterId.toLowerCase()].name) {
        delete variables().characters[characterId.toLowerCase()].name;
    } else {
        variables().characters[characterId.toLowerCase()].name = name;
    }
}

function changeSchedule(characterId, time, location, days) {
    if (isMemory() || !characterId || !time || !location || !hasCharacter(characterId)) {
        return;
    }
    let character = variables().characters[characterId.toLowerCase()];
    let schedule = character.schedule;
    if (!schedule) {
        schedule = {};
    }
    if (days === undefined)
        days = weekDays;
    days.forEach(function(day) {
        if (schedule[day] === undefined) {
            schedule[day] = {};
        }
        schedule[day][time] = location;
    });
    character.schedule = schedule;
}

function resetSchedule(characterId) {
    if (isMemory() || !characterId || !hasCharacter(characterId)) {
        return;
    }
    delete variables().characters[characterId.toLowerCase()].schedule;
}

function say ($output, characterId, text) {
    var $span = $(document.createElement('span'))
        .addClass('say').wiki('"' + text + '"');

    if (hasCharacter(characterId))
        $span.addClass(Util.slugify(characterId));
    else
        $span.addClass('generic');

    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $span.appendTo($output);
    }

    return $span;
}

function sayBox ($output, characterName, text, imgSrc) {
    let $box = $(document.createElement('div')).addClass(Util.slugify('say-box'));
    let characterId = characterName.toLowerCase();
    let exists = hasCharacter(characterId);
    if (exists)
        $box.addClass(Util.slugify(characterId));
    else
        $box.addClass('generic');

    let character;
    if (exists) 
        character = getCharacter(characterId);
    // portrait
    let _img = getPortrait(characterId);        
    let $img = $(document.createElement('img'))
        .attr('src', imgSrc || _img || '');
    if (exists && character.blurred) {
        $img.addClass('blurred');
    }
    $img.addClass('portrait token');
    if (exists) {
        $img.addClass('themed');
        $img.attr('character', characterId);
        $img.attr('title', character.name);
    }

    if ($img.attr('src') && $img.attr('src').trim()) {
        $box.append($img);
    }

    // name and content boxes
    let _name;
    if (characterId === 'player' && isDisguised()) {
        _name = variables().player.newname;
    } else if (exists) {
        if (character.permanentTitle) {
            _name = character.title + ' ' + character.name;
        } else {
            _name = character.name;
        }
    } else {
        _name = characterName;
    }

    $box.append($(document.createElement('h4')).wiki(_name.trim())).append($(document.createElement('p')).wiki(text));

    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $box.appendTo($output);
    }

    return $box;
}

function writeName ($output, characterId, prefix, includeName, includeTitle) {
    let exists = hasCharacter(characterId.toLowerCase());
    let $span = $(document.createElement('span')).addClass('name');
    let character;
    if (exists) {
        characterId = characterId.toLowerCase();
        character = getCharacter(characterId);
        characterPopup($span, characterId);
    }
    
    let _name = '';
    if (prefix !== undefined) {
        _name += prefix + ' ';
    } else if (exists && (includeTitle || character.permanentTitle)) {
        _name += character.title + ' ';
    }

    if (exists) {
        $span.addClass(Util.slugify(characterId));
        if (includeName)
            _name += character.name;
    } else {
        $span.addClass('generic');
        _name += characterId;
    }

    $span.wiki(_name.trim());

    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $span.appendTo($output);
    }

    return $span;
}

function acknowledgement ($output, characterId, payload) {
    if (!characterId || !hasCharacter(characterId)) {
        return;
    }

    let character = variables().characters[characterId.toLowerCase()];
    if (character.acknowledgements.length === 0) {
        return;
    }
    let $box = $(document.createElement('div')).addClass('acknowledge-changes');
    let added = false;
    for (let i = 1; i < payload.length; i++) {
        if (payload[i].name !== 'mention')
            continue;
        if (character.acknowledgements.contains(payload[i].args[0])) {
            character.acknowledgements.splice(character.acknowledgements.indexOf(payload[i].args[0]), 1);
            $box.wiki(payload[i].contents);
            added = true;
            break;
        }
    }
    if (!added)
        return;
    
    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $box.appendTo($output);
    }

    return $box;
}


setup.getCharacterLocation = getCharacterLocation;
window.getCharacterLocation = window.getCharacterLocation || getCharacterLocation;
setup.getCharacters = getCharacters;
window.getCharacters = window.getCharacters || getCharacters;
setup.addCharacter = addCharacter;
window.addCharacter = window.addCharacter || addCharacter;
setup.getCharacter = getCharacter;
window.getCharacter = window.getCharacter || getCharacter;
setup.removeCharacter = removeCharacter;
window.removeCharacter = window.removeCharacter || removeCharacter;


Macro.add('character', {
    handler : function () {
        addCharacter(this.args[0], this.args[1]);
    }
});

$(document).one(':passagestart', function () {
    var names = Array.from(Object.keys(variables().characters));

    Macro.add(names, {
        tags : null,
        handler : function () {
            if (this.args[0] === 'short')
                say(this.output, this.name, this.payload[0].contents);
            else
                sayBox(this.output, this.name, this.payload[0].contents);
        }
    });

    Macro.add('name', {
        handler : function () {
            writeName(this.output, this.args[0], this.args[1], true, false);
        }
    });

    Macro.add('title', {
        handler : function () {
            writeName(this.output, this.args[0], this.args[1], false, true);
        }
    });

    Macro.add('fullname', {
        handler : function () {
            writeName(this.output, this.args[0], this.args[1], true, true);
        }
    });

    Macro.add('say', {
        tags : null,
        handler : function () {
            if (this.args[2] === 'short')
                say(this.output, this.args[0], this.payload[0].contents, this.args[1]);
            else
                sayBox(this.output, this.args[0], this.payload[0].contents, this.args[1], this.args[2]);
        }
    });

    Macro.add('changename', {
        handler : function () {
            changeName(this.args[0], this.args[1]);
        }
    });

    Macro.add('changeblurred', {
        handler : function () {
            changeName(this.args[0], this.args[1]);
        }
    });

    Macro.add('changeschedule', {
        handler : function () {
            let days;
            if (this.args.length > 3) {
                days = [];
                for (let i = 3; i < this.args.length; i++) {
                    days.push(this.args[i]);
                }
            }
            changeSchedule(this.args[0], this.args[1], this.args[2], days);
        }
    });

    Macro.add('resetschedule', {
        handler : function () {
            resetSchedule(this.args[0]);
        }
    });

    Macro.add('acknowledgement', {
        tags : ['mention'],
        handler : function() {
            acknowledgement(this.output, this.args[0], this.payload);
        }
    });

    Macro.add('acknowledgechanges', {
        handler : function() {
            if (isMemory())
                return;
            if (this.args.length > 1) {
                for (let i = 1; i < this.args.length; i++) {
                    variables().characters[this.args[i]].acknowledgements.push(this.args[0]);
                }
            } else {
                for (let character in variables().characters) {
                    variables().characters[character].acknowledgements.push(this.args[0]);
                }
            }
            // updateImages();
        }
    });

    
});
/* twine-user-script #6: "charactersetup.js" */
setup.characters = {
    "player": {
        id: "player",
        primary: false,
        name: "Alex",
        title: "Prince",
        permanentTitle: false,
        description: "This is you! You are prince and heir of this kingdom. People have quite the expectations of you."
    },
    "king": {
        id: "king",
        primary: false,
        name: "King",
        title: "",
        permanentTitle: false,
        description: "Your father, the King. He's currently away on some crusade kind of thing, honestly, you're pretty sure he was just bored and wanted some adventure."
    },
    "orson": {
        id: "orson",
        primary: true,
        "schedule": {
            "monday": {
                "morning": "Bathroom",
                "noon": "Bedroom",
                "evening": "Bedroom",
                "night": "None"
            },
            "tuesday": {
                "morning": "Bathroom",
                "noon": "Bedroom",
                "evening": "Bedroom",
                "night": "None"
            },
            "wednesday": {
                "morning": "Bathroom",
                "noon": "Bedroom",
                "evening": "Bedroom",
                "night": "None"
            },
            "thursday": {
                "morning": "Bathroom",
                "noon": "Bedroom",
                "evening": "Bedroom",
                "night": "None"
            },
            "friday": {
                "morning": "Bathroom",
                "noon": "Bedroom",
                "evening": "Bedroom",
                "night": "None"
            },
            "saturday": {
                "morning": "Bathroom",
                "noon": "Bedroom",
                "evening": "Bedroom",
                "night": "None"
            },
            "sunday": {
                "morning": "Bathroom",
                "noon": "Bedroom",
                "evening": "Bedroom",
                "night": "None"
            }
        },
        name: "Orson",
        title: "Attendant",
        permanentTitle: false,
        description: "Your loyal attendant, he's there to tidy up your messy bedroom and you can always count on him to prepare a bath in the morning, should you need it."
    },
    "rosa": {
        id: "rosa",
        primary: true,
        "schedule": {
            "monday": {
                "morning": "Kitchen",
                "noon": "Kitchen",
                "evening": "Kitchen",
                "night": "None"
            },
            "tuesday": {
                "morning": "Kitchen",
                "noon": "Kitchen",
                "evening": "Kitchen",
                "night": "None"
            },
            "wednesday": {
                "morning": "Kitchen",
                "noon": "Kitchen",
                "evening": "Kitchen",
                "night": "None"
            },
            "thursday": {
                "morning": "Kitchen",
                "noon": "Kitchen",
                "evening": "Kitchen",
                "night": "None"
            },
            "friday": {
                "morning": "Kitchen",
                "noon": "Kitchen",
                "evening": "Kitchen",
                "night": "None"
            },
            "saturday": {
                "morning": "Kitchen",
                "noon": "Kitchen",
                "evening": "Kitchen",
                "night": "None"
            },
            "sunday": {
                "morning": "Kitchen",
                "noon": "Kitchen",
                "evening": "Kitchen",
                "night": "None"
            }
        },
        name: "Rosa",
        title: "Kitchen Maid",
        permanentTitle: false,
        description: "The cutely energetic kitchen servant, she is in charge of the castle kitchens and cooks amazing meals there. She's quite renowned for her bread baking skills."
    },
    "andreas": {
        id: "andreas",
        primary: true,
        "schedule": {
            "monday": {
                "morning": "Grand hall",
                "noon": "Grand hall",
                "evening": "Grand hall",
                "night": "None"
            },
            "tuesday": {
                "morning": "Grand hall",
                "noon": "Grand hall",
                "evening": "Grand hall",
                "night": "None"
            },
            "wednesday": {
                "morning": "Grand hall",
                "noon": "Grand hall",
                "evening": "Grand hall",
                "night": "None"
            },
            "thursday": {
                "morning": "Grand hall",
                "noon": "Grand hall",
                "evening": "Grand hall",
                "night": "None"
            },
            "friday": {
                "morning": "Grand hall",
                "noon": "Grand hall",
                "evening": "Grand hall",
                "night": "None"
            },
            "saturday": {
                "morning": "Grand hall",
                "noon": "Grand hall",
                "evening": "Grand hall",
                "night": "None"
            },
            "sunday": {
                "": "Grand hall",
                "noon": "Grand hall",
                "evening": "Grand hall",
                "night": "None"
            }
        },
        name: "Andreas",
        title: "Chancellor",
        permanentTitle: false,
        description: "The Chancellor of the council. He is a stern but polite man. He's always there to help guide you but you're never sure if you live up to his expectations."
    },
    "sybille": {
        id: "sybille",
        primary: true,
        "schedule": {
            "monday": {
                "morning": "Dungeons",
                "noon": "Dungeons",
                "evening": "Dungeons",
                "night": "Dungeons"
            },
            "tuesday": {
                "morning": "Dungeons",
                "noon": "Dungeons",
                "evening": "Dungeons",
                "night": "Dungeons"
            },
            "wednesday": {
                "morning": "Dungeons",
                "noon": "Dungeons",
                "evening": "Dungeons",
                "night": "Dungeons"
            },
            "thursday": {
                "morning": "Dungeons",
                "noon": "Dungeons",
                "evening": "Dungeons",
                "night": "Dungeons"
            },
            "friday": {
                "morning": "Dungeons",
                "noon": "Dungeons",
                "evening": "Dungeons",
                "night": "None"
            },
            "saturday": {
                "morning": "Dungeons",
                "noon": "Dungeons",
                "evening": "Dungeons",
                "night": "Dungeons"
            },
            "sunday": {
                "morning": "Dungeons",
                "noon": "Dungeons",
                "evening": "Dungeons",
                "night": "Dungeons"
            }
        },
        name: "Sybille",
        title: "Spymaster",
        permanentTitle: false,
        description: "They call her Lady Whispers, she is the current Royal Spymaster. People says she gets her information in quite unconventional ways."
    },
    "leopold": {
        id: "leopold",
        primary: true,
        "schedule": {
            "monday": {
                "morning": "Treasury",
                "noon": "Treasury",
                "evening": "Treasury",
                "night": "None"
            },
            "tuesday": {
                "morning": "Treasury",
                "noon": "Treasury",
                "evening": "Treasury",
                "night": "None"
            },
            "wednesday": {
                "morning": "Treasury",
                "noon": "Treasury",
                "evening": "Treasury",
                "night": "None"
            },
            "thursday": {
                "morning": "Treasury",
                "noon": "Treasury",
                "evening": "Treasury",
                "night": "None"
            },
            "friday": {
                "morning": "Treasury",
                "noon": "Treasury",
                "evening": "Treasury",
                "night": "None"
            },
            "saturday": {
                "morning": "Treasury",
                "noon": "Treasury",
                "evening": "Treasury",
                "night": "None"
            },
            "sunday": {
                "morning": "Treasury",
                "noon": "Treasury",
                "evening": "Treasury",
                "night": "None"
            }
        },
        name: "Leopold",
        title: "Trademaster",
        permanentTitle: false,
        description: "The Master of Trade. Responsible for all things financial. Quite a boring job, you think. But it seems like he very much likes to teach you about it."
    },
    "wymerus": {
        id: "wymerus",
        primary: true,
        "schedule": {
            "monday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "Courtyard"
            },
            "tuesday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "None"
            },
            "wednesday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "Courtyard"
            },
            "thursday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "Courtyard"
            },
            "friday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "Courtyard"
            },
            "saturday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "None"
            },
            "sunday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "None"
            }
        },
        name: "Wymerus",
        title: "Lord Marshal",
        permanentTitle: false,
        description: "Lord Marshal of the Royal armies. A tall and imposing man, sparring with him intimidates you so you much prefer practicing with his squire, ?Caspar."
    },
    "devota": {
        id: "devota",
        primary: true,
        "schedule": {
            "monday": {
                "morning": "Church",
                "noon": "Church",
                "evening": "Church",
                "night": "None"
            },
            "tuesday": {
                "morning": "Church",
                "noon": "Church",
                "evening": "Church",
                "night": "None"
            },
            "wednesday": {
                "morning": "Church",
                "noon": "Church",
                "evening": "Church",
                "night": "None"
            },
            "thursday": {
                "morning": "Church",
                "noon": "Church",
                "evening": "Church",
                "night": "None"
            },
            "friday": {
                "morning": "Church",
                "noon": "Church",
                "evening": "Church",
                "night": "None"
            },
            "saturday": {
                "morning": "Church",
                "noon": "Church",
                "evening": "Church",
                "night": "None"
            },
            "sunday": {
                "morning": "Church",
                "noon": "Church",
                "evening": "Church",
                "night": "None"
            }
        },
        name: "Devota",
        title: "Mother",
        permanentTitle: false,
        description: "Court Chaplain and preacher at the town's church. You go to her every Sunday for your confessional where she usually gives you wise and sometimes unexpected advice."
    },
    "morgana": {
        id: "morgana",
        primary: true,
        "schedule": {
            "monday": {
                "morning": "Garden",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "tuesday": {
                "morning": "Garden",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "wednesday": {
                "morning": "Garden",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "thursday": {
                "morning": "Garden",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "friday": {
                "morning": "Garden",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "saturday": {
                "morning": "Garden",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "sunday": {
                "morning": "Garden",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            }
        },
        name: "Morgana",
        title: "Royal Sorceress",
        permanentTitle: false,
        description: "The new Royal Sorceress. She has quite a mysterious air to her. Something tells you she's very interested in guiding you and watching your progress."
    },
    "godric": {
        id: "godric",
        primary: false,
        name: "Godric",
        title: "Royal Sorcerer",
        permanentTitle: false,
        description: "Old wizard, used to be the Royal Sorcerer before ?morgana."
    },
    "caspar": {
        id: "caspar",
        primary: true,
        "schedule": {
            "monday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "Courtyard"
            },
            "tuesday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "Courtyard"
            },
            "wednesday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "Courtyard"
            },
            "thursday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "Courtyard"
            },
            "friday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "Courtyard"
            },
            "saturday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "Courtyard"
            },
            "sunday": {
                "morning": "Courtyard",
                "noon": "Courtyard",
                "evening": "Courtyard",
                "night": "Courtyard"
            }
        },
        name: "Caspar",
        title: "Squire",
        permanentTitle: false,
        description: "Squire to <<fullname wymerus>> and brother of ?Kathryn. He's always cheerful and down for a sparring match with you."
    },
    "kathryn": {
        id: "kathryn",
        primary: true,
        name: "Kathryn",
        title: "Lady",
        permanentTitle: false,
        description: "Member of the royal court and big sister of ?Caspar. She usually takes any opportunity to bully you for any reason she can think of. Besides that, she likes hosting dinner parties, inviting all kinds of esteemed guests.",
        "schedule": {
            "monday": {
                "morning": "Dining hall",
                "noon": "Dining hall",
                "evening": "Dining hall",
                "night": "None"
            },
            "tuesday": {
                "morning": "Dining hall",
                "noon": "Dining hall",
                "evening": "Dining hall",
                "night": "None"
            },
            "wednesday": {
                "morning": "Dining hall",
                "noon": "Dining hall",
                "evening": "Dining hall",
                "night": "None"
            },
            "thursday": {
                "morning": "Dining hall",
                "noon": "Dining hall",
                "evening": "Dining hall",
                "night": "None"
            },
            "friday": {
                "morning": "Dining hall",
                "noon": "Dining hall",
                "evening": "Dining hall",
                "night": "None"
            },
            "saturday": {
                "morning": "Dining hall",
                "noon": "Dining hall",
                "evening": "Dining hall",
                "night": "None"
            },
            "sunday": {
                "morning": "Dining hall",
                "noon": "Dining hall",
                "evening": "Dining hall",
                "night": "None"
            }
        }
    },
    "velma": {
        id: "velma",
        primary: true,
        name: "Velma",
        title: "Madame",
        permanentTitle: false,
        description: "Owner of the local tavern, ?tavern. People refer to her as Madame Velma.",
        "schedule": {
            "monday": {
                "morning": "Velma's Office",
                "noon": "Velma's Office",
                "evening": "Velma's Office",
                "night": "Velma's Office"
            },
            "tuesday": {
                "morning": "Velma's Office",
                "noon": "Velma's Office",
                "evening": "Velma's Office",
                "night": "Velma's Office"
            },
            "wednesday": {
                "morning": "Velma's Office",
                "noon": "Velma's Office",
                "evening": "Velma's Office",
                "night": "Velma's Office"
            },
            "thursday": {
                "morning": "Velma's Office",
                "noon": "Velma's Office",
                "evening": "Velma's Office",
                "night": "Velma's Office"
            },
            "friday": {
                "morning": "Velma's Office",
                "noon": "Velma's Office",
                "evening": "Velma's Office",
                "night": "Velma's Office"
            },
            "saturday": {
                "morning": "Velma's Office",
                "noon": "Velma's Office",
                "evening": "Velma's Office",
                "night": "Velma's Office"
            },
            "sunday": {
                "morning": "Velma's Office",
                "noon": "Velma's Office",
                "evening": "Velma's Office",
                "night": "Velma's Office"
            }
        }
    },
    "beau": {
        id: "beau",
        primary: true,
        name: "Beau",
        title: "Blacksmith",
        permanentTitle: false,
        description: "Local blacksmith. Definitely the strongest woman you know, she's known to sell quite specific items at her smithy in town...",
        "schedule": {
            "monday": {
                "morning": "Smithy",
                "noon": "Smithy",
                "evening": "Smithy",
                "night": "Smithy"
            },
            "tuesday": {
                "morning": "Smithy",
                "noon": "Smithy",
                "evening": "Smithy",
                "night": "Smithy"
            },
            "wednesday": {
                "morning": "Smithy",
                "noon": "Smithy",
                "evening": "Smithy",
                "night": "Smithy"
            },
            "thursday": {
                "morning": "Smithy",
                "noon": "Smithy",
                "evening": "Smithy",
                "night": "Smithy"
            },
            "friday": {
                "morning": "Smithy",
                "noon": "Smithy",
                "evening": "Smithy",
                "night": "Smithy"
            },
            "saturday": {
                "morning": "Smithy",
                "noon": "Smithy",
                "evening": "Smithy",
                "night": "Smithy"
            },
            "sunday": {
                "morning": "Smithy",
                "noon": "Smithy",
                "evening": "Smithy",
                "night": "Smithy"
            }
        }
    },
    "guard": {
        id: "guard",
        primary: false,
        name: "Guard",
        title: "",
        permanentTitle: false,
        description: "Loyal Guard"
    },
    "quinn": {
        id: "quinn",
        primary: true,
        name: "Quinn",
        title: "Captain",
        permanentTitle: false,
        description: "Captain of the royal guard. She's usually around the barracks to train together with the soldiers.",
        "schedule": {
            "monday": {
                "morning": "Barracks",
                "noon": "Barracks",
                "evening": "Barracks",
                "night": "Barracks"
            },
            "tuesday": {
                "morning": "Barracks",
                "noon": "Barracks",
                "evening": "Barracks",
                "night": "Barracks"
            },
            "wednesday": {
                "morning": "Barracks",
                "noon": "Barracks",
                "evening": "Barracks",
                "night": "Barracks"
            },
            "thursday": {
                "morning": "Barracks",
                "noon": "Barracks",
                "evening": "Barracks",
                "night": "Barracks"
            },
            "friday": {
                "morning": "Barracks",
                "noon": "Barracks",
                "evening": "Barracks",
                "night": "Barracks"
            },
            "saturday": {
                "morning": "Barracks",
                "noon": "Barracks",
                "evening": "Barracks",
                "night": "Barracks"
            },
            "sunday": {
                "morning": "Barracks",
                "noon": "Barracks",
                "evening": "Barracks",
                "night": "Barracks"
            }
        }
    },
    "bandit": {
        id: "bandit",
        primary: false,
        name: "Bandit",
        title: "",
        permanentTitle: false,
        description: "Forest Bandit",
        "schedule": {
            "monday": {
                "morning": "Bandit camp",
                "noon": "Bandit camp",
                "evening": "Bandit camp",
                "night": "Bandit camp"
            },
            "tuesday": {
                "morning": "Bandit camp",
                "noon": "Bandit camp",
                "evening": "Bandit camp",
                "night": "Bandit camp"
            },
            "wednesday": {
                "morning": "Bandit camp",
                "noon": "Bandit camp",
                "evening": "Bandit camp",
                "night": "Bandit camp"
            },
            "thursday": {
                "morning": "Bandit camp",
                "noon": "Bandit camp",
                "evening": "Bandit camp",
                "night": "Bandit camp"
            },
            "friday": {
                "morning": "Bandit camp",
                "noon": "Bandit camp",
                "evening": "Bandit camp",
                "night": "Bandit camp"
            },
            "saturday": {
                "morning": "Bandit camp",
                "noon": "Bandit camp",
                "evening": "Bandit camp",
                "night": "Bandit camp"
            },
            "sunday": {
                "morning": "Bandit camp",
                "noon": "Bandit camp",
                "evening": "Bandit camp",
                "night": "Bandit camp"
            }
        }
    },
    "reading": {
        id: "reading",
        primary: false,
        name: "Reading",
        title: "",
        permanentTitle: false,
        description: "Reading",
        "schedule": {
            "monday": {
                "morning": "Library",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "tuesday": {
                "morning": "Library",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "wednesday": {
                "morning": "Library",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "thursday": {
                "morning": "Library",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "friday": {
                "morning": "Library",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "saturday": {
                "morning": "Library",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            },
            "sunday": {
                "morning": "Library",
                "noon": "Library",
                "evening": "Library",
                "night": "None"
            }
        }
    },
    "hyssop": {
        id: "hyssop",
        primary: true,
        name: "Hyssop",
        title: "Druid",
        permanentTitle: false,
        description: "Druid who lives in a cozy shack in the middle of the forest. They enjoy tailoring and always enjoy creating some royal outfits.",
        "schedule": {
            "monday": {
                "morning": "Druid Hut",
                "noon": "Druid Hut",
                "evening": "Druid Hut",
                "night": "None"
                //"night": "Druid Hut"
            },
            "tuesday": {
                "morning": "Druid Hut",
                "noon": "Druid Hut",
                "evening": "Druid Hut",
                "night": "None"
                //"night": "Druid Hut"
            },
            "wednesday": {
                "morning": "Druid Hut",
                "noon": "Druid Hut",
                "evening": "Druid Hut",
                "night": "None"
                //"night": "Druid Hut"
            },
            "thursday": {
                "morning": "Druid Hut",
                "noon": "Druid Hut",
                "evening": "Druid Hut",
                "night": "None"
                //"night": "Druid Hut"
            },
            "friday": {
                "morning": "Druid Hut",
                "noon": "Druid Hut",
                "evening": "Druid Hut",
                "night": "None"
                //"night": "Druid Hut"
            },
            "saturday": {
                "morning": "Druid Hut",
                "noon": "Druid Hut",
                "evening": "Druid Hut",
                "night": "None"
                //"night": "Druid Hut"
            },
            "sunday": {
                "morning": "Druid Hut",
                "noon": "Druid Hut",
                "evening": "Druid Hut",
                "night": "None"
                //"night": "Druid Hut"
            }
        }
    },
    "eve": {
        id: "eve",
        primary: true,
        name: "Eve",
        title: "Barmaid",
        permanentTitle: false,
        description: "Barmaid who works at the local tavern. She's very excitable and fun to be around.",
        "schedule": {
            "monday": {
                "morning": "Eve's Room",
                "noon": "Eve's Room",
                "evening": "Tavern",
                "night": "Corridor"
            },
            "tuesday": {
                "morning": "Eve's Room",
                "noon": "Eve's Room",
                "evening": "Tavern",
                "night": "Corridor"
            },
            "wednesday": {
                "morning": "Eve's Room",
                "noon": "Eve's Room",
                "evening": "Tavern",
                "night": "Corridor"
            },
            "thursday": {
                "morning": "Eve's Room",
                "noon": "Eve's Room",
                "evening": "Tavern",
                "night": "Corridor"
            },
            "friday": {
                "morning": "Eve's Room",
                "noon": "Eve's Room",
                "evening": "Tavern",
                "night": "Corridor"
            },
            "saturday": {
                "morning": "Eve's Room",
                "noon": "Eve's Room",
                "evening": "Tavern",
                "night": "Corridor"
            },
            "sunday": {
                "morning": "Eve's Room",
                "noon": "Eve's Room",
                "evening": "Tavern",
                "night": "Corridor"
            }
        }
    },
    "jack": {
        id: "jack",
        primary: false,
        name: "Jack",
        title: "Lumberjack",
        permanentTitle: false,
        description: "Lumberjack who works out in the woods and sometimes visits ?Sybille in the dungeons.",
        "schedule": {
            "monday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "tuesday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "wednesday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "thursday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "friday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "saturday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "sunday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            }
        }
    },
    "merry": {
        id: "merry",
        primary: false,
        name: "Merry",
        title: "Bard",
        permanentTitle: false,
        description: "Meriwether the famous bard travels from town to town to give his enchanting shows.",
        "schedule": {
            "monday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "tuesday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "wednesday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "thursday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "friday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "saturday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            },
            "sunday": {
                "morning": "None",
                "noon": "None",
                "evening": "None",
                "night": "None"
            }
        }
    },
    "pepper": {
        id: "pepper",
        primary: true,
        name: "Pepper",
        title: "Chef",
        permanentTitle: true,
        description: "The local chef of the tavern. He's a culinary genius that also sometimes cooks for ?Kathryn's dinner parties.",
        "schedule": {
            "monday": {
                "morning": "Cookroom",
                "noon": "Cookroom",
                "evening": "Cookroom",
                "night": "Cookroom"
            },
            "tuesday": {
                "morning": "Cookroom",
                "noon": "Cookroom",
                "evening": "Cookroom",
                "night": "Cookroom"
            },
            "wednesday": {
                "morning": "Cookroom",
                "noon": "Cookroom",
                "evening": "Cookroom",
                "night": "Cookroom"
            },
            "thursday": {
                "morning": "Cookroom",
                "noon": "Cookroom",
                "evening": "Cookroom",
                "night": "Cookroom"
            },
            "friday": {
                "morning": "Cookroom",
                "noon": "Cookroom",
                "evening": "Cookroom",
                "night": "Cookroom"
            },
            "saturday": {
                "morning": "Cookroom",
                "noon": "Cookroom",
                "evening": "Cookroom",
                "night": "Cookroom"
            },
            "sunday": {
                "morning": "Cookroom",
                "noon": "Cookroom",
                "evening": "Cookroom",
                "night": "Cookroom"
            }
        }
    },
    "leave": {
        id: "leave",
        primary: false,
        name: "Leave",
        title: "",
        permanentTitle: false,
        description: ""
    },
    "bread": {
        id: "bread",
        primary: false,
        name: "Bread",
        title: "Sexy",
        permanentTitle: false,
        description: "The sexiest loaf of bread alive.",
        "schedule": {
            "monday": {
                "morning": "Larder",
                "noon": "Larder",
                "evening": "Larder",
                "night": "Larder"
            },
            "tuesday": {
                "morning": "Larder",
                "noon": "Larder",
                "evening": "Larder",
                "night": "Larder"
            },
            "wednesday": {
                "morning": "Larder",
                "noon": "Larder",
                "evening": "Larder",
                "night": "Larder"
            },
            "thursday": {
                "morning": "Larder",
                "noon": "Larder",
                "evening": "Larder",
                "night": "Larder"
            },
            "friday": {
                "morning": "Larder",
                "noon": "Larder",
                "evening": "Larder",
                "night": "Larder"
            },
            "saturday": {
                "morning": "Larder",
                "noon": "Larder",
                "evening": "Larder",
                "night": "Larder"
            },
            "sunday": {
                "morning": "Larder",
                "noon": "Larder",
                "evening": "Larder",
                "night": "Larder"
            }
        }
    }
};
/* twine-user-script #7: "council.js" */

// var dilemmas = new Map();

// function addDilemma (name, tags) {
//     if (!name || !Story.has(name)) {
//         console.error('addDilemma() -> invalid arguments');
//         return;
//     }
//     if (dilemmas.has(name)) {
//         console.error('addDilemma() -> overwriting dilemma "' + name + '"');
//     }
//     let obj = { title: name, tags: tags.splice(tags.indexOf('dilemma'), 1) };
//     dilemmas.set(name, obj);
// }


function hasCompletedDilemma(dilemma) {
	return variables().dilemmas.some(d => d.title === dilemma);
}

function dilemmaChoice(dilemma) {
    return variables().find(d => d.title === dilemma).choice;
}

function resolveDilemma(dilemma, choice) {
    variables().dilemmas.push({ title: dilemma, choice: choice })
}

function randomDilemma() {
    let dilemmas = [];
    Story.lookup("tags", "dilemma").forEach(passage => {
        if (hasCompletedDilemma(passage.title)) {
            return;
        }
        let chain = parseInt(passage.title.substr(-1));
        if (Number.isInteger(chain) && chain !== 1) {
            if (!hasCompletedDilemma(passage.title.replace(chain, chain-1))) {
                return;
            }
        }
        dilemmas.push(passage.title);
    });

    return dilemmas[Math.floor(Math.random() * dilemmas.length)];
}

function dilemmaResult() {
    if (variables().dilemmas.length < 1)
        return false;
    let dilemma = variables().dilemmas[variables().dilemmas.length - 1];
    return dilemma.title + ' Result ' + dilemma.choice;
}

function kingdomStat(stat) {
    return variables().kingdom[stat] + 8; //Math.round(variables().kingdom[stat] / (100 / 7)) + 8;
}

function kingdomCalamity() {
    console.log('Oh noes!');
    let $icon = $('.icon.stability');

    setTimeout(() => { $icon.addClass('fall') }, 3000);

}

function kingdomStatAnimation(stat) {
    let $icon = $('.icon.' + stat);
    let delay = 500;
    if (stat === 'stability')
        delay += 500;
    setTimeout(() => { $icon.addClass('hover') }, delay);
    delay += 700;
    setTimeout(() => { $icon.attr('data-position', kingdomStat(stat)) }, delay);
    delay += 1000;
    setTimeout(() => { $icon.removeClass('hover') }, delay);
}

function changeKingdomStat(stat, amount) {
    amount = parseInt(amount);

    if (variables().kingdom[stat] + amount > 7) {
        amount = 7 - variables().kingdom[stat];
    }
    else if (variables().kingdom[stat] + amount < -7) {
        amount = -7 - variables().kingdom[stat];
    }

    variables().kingdom[stat] += amount;

    if (stat === 'stability') {
        if (variables().kingdom[stat] >= 7 || variables().kingdom[stat] <= -7)
            kingdomCalamity();
    } else {
        changeKingdomStat('stability', amount);
    }

    kingdomStatAnimation(stat);
}



setup.randomDilemma = randomDilemma;
window.randomDilemma = window.randomDilemma || randomDilemma;
setup.dilemmaResult = dilemmaResult;
window.dilemmaResult = window.dilemmaResult || dilemmaResult;
setup.dilemmaChoice = dilemmaChoice;
window.dilemmaChoice = window.dilemmaChoice || dilemmaChoice;
setup.kingdomStat = kingdomStat;
window.kingdomStat = window.kingdomStat || kingdomStat;
setup.changeKingdomStat = changeKingdomStat;
window.changeKingdomStat = window.changeKingdomStat || changeKingdomStat;


$(document).one(':passagestart', function () {
    Macro.add('resolvedilemma', {
        handler : function () {
            resolveDilemma(passage(), this.args[0]);
        }
    });
});

/* twine-user-script #8: "counters.js" */
function addCounter (name, days) {
    if (!name) {
        console.error('addCounter() -> invalid arguments');
        return;
    }
    if (isMemory())
        return;
    if (days === undefined) {
        days = 1;
    }
    if (variables().counters[name]) {
        days += variables().counters[name];
    }
    variables().counters[name] = days;
}

function hasCounter (name) {
    return (variables().counters[name] !== undefined && variables().counters[name] > 0);
}

function hasCharacterCounter(name, place, time) {
    name = name.toLowerCase();
    place = place.toLowerCase().replace(' ', '-');
    time = time.toLowerCase();
    return hasCounter(name) || hasCounter(name + '-' + place) || hasCounter(name + '-' + time) || hasCounter(name + '-' + place + '-' + time);
}

function lowerCounters () {
    if (isMemory())
        return;
    let keys = Object.keys(variables().counters);
    for (let i = 0; i < keys.length; i++)
        if (variables().counters[keys[i]] > 0)
            variables().counters[keys[i]] -= 0.5;

    keys = Object.keys(variables().events);
    for (let i = 0; i < keys.length; i++) {
        let events = variables().events[keys[i]];
        for (let j = 0; j < events.length; j++) {
            if (events[j].delay > 0)
                variables().events[keys[i]][j].delay -= 0.5;
        }
    }
}

function logCounters () {
    var keys = Object.keys(variables().counters);
    console.log('Counters');
    for (var i = 0; i < keys.length; i++)
        console.log(keys[i] + ': ' + variables().counters[keys[i]]);
}

setup.hasCounter = hasCounter;
window.hasCounter = window.hasCounter || hasCounter;
setup.hasCharacterCounter = hasCharacterCounter;
window.hasCharacterCounter = window.hasCharacterCounter || hasCharacterCounter;

$(document).one(':passagestart', function () {
    Macro.add('addcounter', {
        handler : function () {
            addCounter(this.args[0], this.args[1]);
        }
    });
    Macro.add('hascounter', {
        handler : function () {
            hasCounter(this.args[0]);
        }
    });
    Macro.add('lowercounters', {
        handler : function () {
            lowerCounters();
        }
    });
});
/* twine-user-script #9: "daytime.js" */
var animateTime = 0;

$(document).on(':passageend', function (ev) {
	if (Date.now() - animateTime < 200) {
		var menuTime = $('#story-caption #time-cycle');
		menuTime.addClass('animate');
		animateTime = Date.now();
	}
});

var times = [ 'morning', 'noon', 'evening', 'night' ];
var days = [ 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

function getTime(value) {
	if (value === undefined)
		value = variables().time;

	return times[value];
}

function getDay(value) {
	if (value === undefined)
		value = variables().day;

	return days[value];
}

function increaseTime(amount) {
	if (amount === 0)
		return;
	let time = variables().time;
	for (let i = 0; i < amount; i++) {
		time++;
		time %= times.length;
		if (time === 3 || time === 0) {
			lowerCounters();
		}
	}
	variables().time = time;
	var menuTime = $('#story-caption #time-cycle');
	menuTime.removeClass();
	menuTime.addClass(getTime());
	menuTime.addClass('animate');
	menuTime.find('span').text(getTime().toUpperFirst());
	animateTime = Date.now();
}

function increaseDay(amount) {
	if (amount === 0)
		return;

	variables().day += amount;
	variables().day %= days.length;
	
	var menuDay = $('#story-caption #week-cycle');
	if (menuDay.length) {
		menuDay.removeClass();
		menuDay.addClass(getDay());
	}
}

function skipDay(animateNextFrame) {
	increaseTime(4);
	
	lowerCounters();lowerCounters();
	
	var menuTime = $('#story-caption #time-cycle');
	if (menuTime.length) {
		menuTime.removeClass();
		menuTime.addClass(getTime());
		menuTime.addClass('skip-day');
		menuTime.addClass('animate');
		menuTime.find('span').text(getTime().toUpperFirst());
	}

	if (animateNextFrame) {
		animateTime = true;
	}

	setTimeout(() => { increaseDay(1) }, 2000);
}

function setTime(value, increaseDay) {
	let oldTime = variables().time;
	let newTime = times.indexOf(value.toLowerCase());

	if (oldTime === newTime)
		return;

	let increase;
	if (newTime < oldTime) {
		increase = times.length - oldTime + newTime;
		if (increaseDay)
			increaseDay(1);
	} else {
		increase = newTime - oldTime;
	}
	increaseTime(increase);
}

function setDay(value) {
	let oldDay = variables().day;
	let newDay = days.indexOf(value.toLowerCase());

	if (oldDay === newDay)
		return;

	variables().day = newDay;
	
	var menuDay = $('#story-caption #week-cycle');
	if (menuDay.length) {
		menuDay.removeClass();
		menuDay.addClass(getDay());
	}
}

setup.getTime = getTime;
window.getTime = window.getTime || getTime;
setup.getDay = getDay;
window.getDay = window.getDay || getDay;
setup.setTime = setTime;
window.setTime = window.setTime || setTime;
setup.setDay = setDay;
window.setDay = window.setDay || setDay;


$(document).one(':passagestart', function () {
	// generate macros
	Macro.add('increasetime', {
		handler : function () {
			increaseTime(this.args[0]);
		}
	});
	Macro.add('increaseday', {
		handler : function () {
			increaseDay(this.args[0]);
		}
	});
	Macro.add('settime', {
		handler : function () {
			setTime(this.args[0], this.args[1]);
		}
	});
	Macro.add('setday', {
		handler : function () {
			setDay(this.args[0]);
		}
	});
	Macro.add('skipday', {
		handler : function () {
			skipDay(this.args[0]);
		}
	});
	Macro.add('day', {
		handler : function () {
			let $output = this.output;
			let $span = $(document.createElement('span')).addClass('current-day').wiki(upperFirst(getDay()));
			if (!($output instanceof $)) {
				$output = $($output);
			}
			$span.appendTo($output);
		}
	});
	Macro.add('time', {
		handler : function () {
			let $output = this.output;
			let $span = $(document.createElement('span')).addClass('current-time').wiki(upperFirst(getTime()));
			if (!($output instanceof $)) {
				$output = $($output);
			}
			$span.appendTo($output);
		}
	});
});

/* twine-user-script #10: "debug.js" */

function debuginfo ($output) {
    if (!($output instanceof $)) {
        $output = $($output);
    }

    $output.append('<h2>Variables</h2> <pre class="debug-info">' + JSON.stringify(variables(), null, 2) + '</pre>');
    $output.append('<h2>Setup</h2> <pre class="debug-info">' + JSON.stringify(setup, null, 2) + '</pre>');
    $output.append('<h2>Settings</h2> <pre class="debug-info">' + JSON.stringify(settings, null, 2) + '</pre>');
}

$(document).one(':passagestart', function () {
    Macro.add('debuginfo', {
        handler : function () {
            debuginfo(this.output);
        }
    });
});
/* twine-user-script #11: "decisions.js" */

// function addDecisionGetStat

// function addDecisionNeedStat

// function addDecisionStats()

function addDecision($output, choice, result, disabled, disabledContent, passage, group, statReceived, statReceivedAmount, statNeeded, statNeededAmount, icon) {
    var button = $(document.createElement('a')).addClass('decision link-internal');
    var text = $(document.createElement('span')).addClass('decision-text').wiki(choice).prependTo(button);

    if (!icon && statReceived && settings.staticons) {
        icon = statReceived;
    }
    if (icon) {
        $(getIcon(icon)).addClass('decision-img').prependTo(button);
    }
    if (!group) {
        group = 0;
    }
    button.attr("decision-group", group);
    
    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        button.appendTo($output);
    }

    if (disabled) {
        disable(button, disabledContent);
        return;
    }

    if (statNeeded) {
        if (!hasStatAmount(statNeeded, statNeededAmount)) {
            statPopup(button, statNeeded, statNeededAmount);
            button.attr('disabled', '');
            return;
        }
    }

    button.on('click', function(event) {
        event.stopPropagation();
        if (statReceived && !isMemory()) {
            changeStat(null, statReceived, statReceivedAmount, false);
        }
        if (passage) {
            $.wiki(result);
            Engine.play(passage);
            return;
        }
        var p = $('#passages .passage');
        var newDiv = $(document.createElement('div')).addClass('decision-result').insertBefore(button);
        p.find('.decision').each(function() {
            var found = $(this);
            if (Number(found.attr('decision-group')) >= group) {
                found.remove();
            }
        });
        newDiv.wiki(result).css('opacity', 0);
        setTimeout(function() {
            newDiv.css('opacity', 1);
        }, 10);
        // moveFound.forEach((e) => e.appendTo(newDiv));
    });

    return button;
}

$(document).one(':passagestart', function () {
    //$output, choice, result, passage, group, statReceived, statReceivedAmount, statNeeded, statNeededAmount
    Macro.add('decision', {
        tags : [ 'disableif', 'decisionicon', 'decisiongroup', 'addstat', 'needstat' ],
        handler : function () {
            let disable = false;
            let disableContent;
            let icon;
            let group;
            let statReceived;
            let statReceivedAmount;
            let statRequired;
            let statRequiredAmount;
            let deprecated = true;
			for (let i = 1; i < this.payload.length; i++) {
				if (this.payload[i].name === 'disableif') {
                    try {
                        disable = this.payload[i].args.raw.trim() ? !!Scripting.evalJavaScript(this.payload[i].args.full) : undefined;
                    } catch (err) {
                        console.error("decision macro -> bad evaluation: " + err.message);
                    }
                    disable = (disable === undefined) ? true : !!disable;
                    if (disable) {
                        disableContent = this.payload[i].contents;
                    }
				} else if (this.payload[i].name === 'decisionicon') {
                    icon = this.payload[i].args.raw.trim();
                } else if (this.payload[i].name === 'decisiongroup') {
                    deprecated = false;
                    group = this.payload[i].args.raw.trim();
                } else if (this.payload[i].name === 'addstat') {
                    deprecated = false;
                    statReceived = this.payload[i].args[0];
                    statReceivedAmount = this.payload[i].args[1];
                } else if (this.payload[i].name === 'needstat') {
                    deprecated = false;
                    statRequired = this.payload[i].args[0];
                    statRequiredAmount = this.payload[i].args[1];
                }
			}

            if (deprecated) {
                if (isStat(this.args[1])) {
                    addDecision(this.output, this.args[0], this.payload[0].contents, disable, disableContent, this.args[6], this.args[5], this.args[1], this.args[2], this.args[3], this.args[4], icon);
                } else if (!isNaN(this.args[1])) {
                    addDecision(this.output, this.args[0], this.payload[0].contents, disable, disableContent, this.args[6], this.args[1], this.args[2], this.args[3], this.args[4], this.args[5], icon);
                } else {
                    addDecision(this.output, this.args[0], this.payload[0].contents, disable, disableContent, this.args[1], this.args[6], this.args[2], this.args[3], this.args[4], this.args[5], icon);
                }
            } else {
                addDecision(this.output, this.args[0], this.payload[0].contents, disable, disableContent, this.args[1], group, statReceived, statReceivedAmount, statRequired, statRequiredAmount, icon);
            }
           
        }
    });
});
/* twine-user-script #12: "disable.js" */
(function () {
    // disable.js, by chapel, for sugarcube 2
    // v1.0.0

    'use strict';

    var cls = 'disabled';
    var interactive = ['a', 'button', 'fieldset', 'input', 'menuitem', 'optgroup', 'option', 'select', 'textarea'];

    function getEl (self) {
        // get the first interactive element
        var $el = $(self).find(interactive.join(',')).first();
        if (!$el[0]) {
            $el = $(self).children().eq(0);
            if (!$el[0]) {
                return $(self);
            }
        }
        return $el;
    }

    function changeCls ($el) {
        if ($el.ariaIsDisabled()) {
            $el.addClass(cls);
        } else {
            $el.removeClass(cls);
        }
    }

    function disable ($el, popupContent) {
        if (!($el instanceof $)) {
            $el = $($el);
        }
        $el.ariaDisabled(true);
        changeCls($el);
        if (popupContent && popupContent.trim()) {
            popup($el, popupContent);
        }
        return $el;
    }

    setup.disable = disable;
    window.disable = window.disable || disable;
    // no need for JS API as there us a built-in jQuery extension

    Macro.add('disable', {
        tags : ['reason'],
        handler : function () {
            let bool;
            let $wrapper = $(document.createElement('div')).wiki(this.payload[0].contents);
            if ($wrapper.children().length > 1) {
                console.error('disable macro -> used on more than one element');
            }
            let $el = getEl($wrapper);

            try {
                bool = this.args.raw.trim() ? !!Scripting.evalJavaScript(this.args.full) : undefined;
            } catch (err) {
                return this.error("bad evaluation: " + err.message);
            }
            bool = (bool === undefined) ? true : !!bool;

            let popup = false;
            if (bool && this.payload[this.payload.length - 1].name === "reason") {
                popup = this.payload[this.payload.length - 1].contents;
            }
            
            if (bool) {
                disable($el, popup);
            }

            // output
            $(this.output).append($el);
        }
    });

}());
/* twine-user-script #13: "equipment.js" */
var slots = ['head', 'clothes', 'shoes', 'underwear', 'crotch', 'ass', 'potion'];

function categoryName(category) {
    switch (category) {
        case 'head':
            return 'Headwear';
        case 'clothes':
            return 'Clothes';
        case 'shoes':
            return 'Shoes';
        case 'underwear':
            return 'Underwear';
        case 'crotch':
        case 'ass':
        case 'toy':
            return 'Toys';
        case 'potion':
            return 'Potions';
        case 'gift':
            return 'Gifts';
    }
}

function underSlot(slot) {
    switch (slot) {
        case 'head':
            return 'crotch';
        case 'clothes':
            return 'underwear';
        case 'shoes':
            return 'ass';
    }
    return 'none';
}

function isOverwear(slot) {
    switch(slot) {
        case 'head':
        case 'clothes':
        case 'shoes':
            return true;
    }
    return false;
}

function outfit(outfitName) {
    if (!outfitName) {
        console.error('outfit() -> outfitName not provided.');
        return;
    }
    if (isMemory())
        return;
    outfitName = outfitName.toLowerCase().trim();

    if (!hasOutfit(outfitName)) {
        console.error('outfit() -> ' + outfitName + ' doesn\'t exist.');
        return;
    }

    let disguisedBefore = isDisguised();

    let outfit = variables().outfits[outfitName];
    for (const [key, value] of Object.entries(outfit)) {
        if (value === 'none') {
            unequip(key);
        } else {
            equip(value, key !== 'clothes');
        }
    }
    
    let disguisedAfter = isDisguised();

    if (disguisedBefore !== disguisedAfter) {
        setup.notify(disguisedAfter ? 'You are now disguised.' : 'You are no longer disguised.', 3000);
    }
}

function changeOutfit(outfitName, head, clothes, shoes, underwear, crotch, ass) {
    if (!outfitName) {
        console.error('changeOutfit() -> outfitName not provided.');
        return;
    }
    if (isMemory())
        return;
    outfitName = outfitName.toLowerCase().trim();

    if (!hasOutfit(outfitName)) {
        variables().outfits[outfitName] = {};
    }

    let outfitObj = variables().outfits[outfitName];
    if (head) outfitObj['head'] = head;
    if (clothes) outfitObj['clothes'] = clothes;
    if (shoes) outfitObj['shoes'] = shoes;
    if (underwear) outfitObj['underwear'] = underwear;
    if (crotch) outfitObj['crotch'] = crotch;
    if (ass) outfitObj['ass'] = ass;
}

function changeOutfitSlot(outfitName, slot, item) {
    if (!outfitName) {
        console.error('changeOutfitSlot() -> outfitName not provided.');
        return;
    }
    if (isMemory())
        return;
    outfitName = outfitName.toLowerCase().trim();
    if (!hasOutfit(outfitName)) {
        variables().outfits[outfitName] = {};
    }

    variables().outfits[outfitName][slot] = item;
}

function removeOutfitSlot(outfitName, slot) {
    if (!outfitName) {
        console.error('changeOutfitSlot() -> outfitName not provided.');
        return;
    }
    if (isMemory())
        return;
    outfitName = outfitName.toLowerCase().trim();
    if (!hasOutfit(outfitName)) {
        return;
    }

    delete variables().outfits[outfitName][slot];
}

function hasOutfit(outfitName) {
    if (!outfitName) {
        return false;
    }
    outfitName = outfitName.toLowerCase().trim();
    return variables().outfits[outfitName] !== undefined;
}

function getOutfitSlot(outfitName, slot) {
    if (!outfitName) {
        console.error('outfit() -> outfitName not provided.');
        return;
    }
    outfitName = outfitName.toLowerCase().trim();

    if (!hasOutfit(outfitName)) {
        console.error('getOutfitSlot() -> ' + outfitName + ' doesn\'t exist.');
        return;
    }
    return variables().outfits[outfitName][slot];
}

function wardrobe($output) {
    let $wardrobe = $('<div id="wardrobe"></div>');
    
    let $outfitsTitle = $('<h1 class="outfits-title">Outfits</h1>');

    let $outfits = $('<div class="outfits"></div>');
    
    for (const key of Object.keys(variables().outfits)) {
        let $outfit = $('<div class="outfit"></div>');

        let $outfitName = $('<h3 class="outfit-name">' + key.toUpperFirst() + '</h3>');
        let $outfitItems = $('<div class="outfit-items"><img class="outfit-item first" src="' + getOutfitImg(key, 'clothes') + '"><img class="outfit-item second" src="' + getOutfitImg(key, 'head') + '"><img class="outfit-item third" src="' + getOutfitImg(key, 'shoes') + '"></div>');

        let $buttons = $('<div class="outfit-buttons"></div>');

        if (key !== 'sleep') {
            let $wearButton = $('<button class="wear-button">Wear</button>');
            $wearButton.on('click', function() {
                outfit(key);
            });
            $wearButton.appendTo($buttons);
        }

        let $changeButton = $('<button>Change</button>');
        $changeButton.on('click', function() {
            $outfitsTitle.text(key.toUpperFirst() + ' Outfit');
            $outfits.remove();
            wardrobeChangeOutfit($wardrobe, key);
            $('#wardrobe-return-button').remove();
        });
        $changeButton.appendTo($buttons);

        $buttons.appendTo($outfitItems);

        $outfitName.appendTo($outfit);
        $outfitItems.appendTo($outfit);

        $outfit.appendTo($outfits);
    }
    $outfitsTitle.appendTo($wardrobe);

    $outfits.appendTo($wardrobe);
    
    if (!($output instanceof $)) {
        $output = $($output);
    }
    $wardrobe.appendTo($output);
}

function wardrobeChangeOutfit($wardrobe, outfitName) {
    let headwear = [];
    let clothes = [];
    let shoes = [];
    let underwear = [];
    let toys = [];

    for (const [key, value] of Object.entries(setup.equipment)) {
        if (!equipmentUnlocked(key) || !value.equip)
            continue;
        if (isOverwear(value.slot)) {
            if (outfitName === 'disguise') {
                if (value.tags.includes('royal'))
                    continue;
                if (hasTag('crossdresser')) {
                    if (value.tags.includes('masculine'))
                        continue;
                } else {
                    if (value.tags.includes('feminine'))
                        continue;
                }
            } else if (outfitName === 'sleep') {
                if (!value.tags.includes('hair'))
                    continue;
            } else {
                if (value.tags.includes('disguise'))
                    continue;
                if (value.tags.includes('feminine'))
                    continue;
            }
        }
        
        switch (value.slot) {
            case 'head':
                headwear.pushUnique(key);
                continue;
            case 'clothes':
                clothes.pushUnique(key);
                continue;
            case 'shoes':
                shoes.pushUnique(key);
                continue;
            case 'underwear':
                underwear.pushUnique(key);
                continue;
            case 'crotch':
            case 'ass':
                toys.pushUnique(key);
                continue;
        }
    }

    addWardrobeCategory($wardrobe, 'head', headwear, outfitName);
    addWardrobeCategory($wardrobe, 'clothes', clothes, outfitName);
    addWardrobeCategory($wardrobe, 'shoes', shoes, outfitName);
    addWardrobeCategory($wardrobe, 'underwear', underwear, outfitName);
    addWardrobeCategory($wardrobe, 'crotch', toys, outfitName);

    let $button = $('<div></div>').wiki("<<decision 'Save' 'Wardrobe Clothes'>><</decision>>");
    if (outfitName !== 'sleep') {
        $button.wiki("<<decision 'Save and Wear' 'Wardrobe Clothes'>><<outfit " + outfitName + ">><</decision>>");
    }
    $button.appendTo($wardrobe);
}

function addWardrobeCategory($wardrobe, slot, items, outfitName) {
    if (!items || items.length === 0) {
        return;
    }

    let $categoryTitle = $('<h2 class="category-title icon-suffix arrow-down">' + categoryName(slot) + '</h2>');

    let $category = $('<div class="category"></div>');

    
    $categoryTitle.on('click', function() {
        $category.toggleClass('hidden');
        $categoryTitle.toggleClass('arrow-left');
        $categoryTitle.toggleClass('arrow-down');
    });
    $categoryTitle.appendTo($wardrobe);

    items.pushUnique('none');

    for (const key of items) {
        let name = key === 'none' ? 'None' : setup.equipment[key].name;
        let $item = $('<a class="equipment-item"><img class="equipment-item-img" src="images/equipment/' + key + '.jpg"><span class="equipment-item-name">' + name + '</span></a>');

        if (key !== 'none') {
            for (let tag of setup.equipment[key].tags) {
                $item.addClass(tag);
            }
        }

        if (key === getOutfitSlot(outfitName, slot)) {
            $item.addClass('selected');
        }
        $item.on('click', function() {
            $category.find('.selected').removeClass('selected');
            if (key === getOutfitSlot(outfitName, slot)) {
                removeOutfitSlot(outfitName, slot);
            } else {
                $item.addClass('selected');
                changeOutfitSlot(outfitName, slot, key);
            }
        });
        $item.appendTo($category);
    }
    $category.appendTo($wardrobe);
}

function store($output, seller) {
    let $store = $('<div id="store"></div>');
    let gifts = [];
    let headwear = [];
    let clothes = [];
    let shoes = [];
    let underwear = [];
    let toys = [];
    let potions = [];

    let currency = sellerToCurrency(seller);
    money(currency, $store, true);


    for (const [key, value] of Object.entries(setup.equipment)) {
        if (value.origin !== seller)
            continue;
        if (!hasTag('crossdresser') && value.tags.contains('feminine'))
            continue;
        if (hasTag('crossdresser') && value.tags.contains('masculine'))
            continue;

        switch (value.slot) {
            case 'head':
                headwear.pushUnique(key);
                continue;
            case 'clothes':
                clothes.pushUnique(key);
                continue;
            case 'shoes':
                shoes.pushUnique(key);
                continue;
            case 'underwear':
                underwear.pushUnique(key);
                continue;
            case 'crotch':
            case 'ass':
            case 'toy':
                toys.pushUnique(key);
                continue;
            case 'potion':
                potions.pushUnique(key);
                continue;
            case 'gift':
                gifts.pushUnique(key);
                continue;
        }
    }

    addStoreCategory($store, 'gift', gifts, currency);
    addStoreCategory($store, 'head', headwear, currency);
    addStoreCategory($store, 'clothes', clothes, currency);
    addStoreCategory($store, 'shoes', shoes, currency);
    addStoreCategory($store, 'underwear', underwear, currency);
    addStoreCategory($store, 'crotch', toys, currency);
    addStoreCategory($store, 'potion', potions, currency);
    if (!($output instanceof $)) {
        $output = $($output);
    }
    $store.appendTo($output);
}

function addStoreCategory($store, slot, items, currency) {
    if (!items || items.length === 0) {
        return;
    }

    let $categoryTitle = $('<h2 class="category-title icon-suffix arrow-down">' + categoryName(slot) + '</h2>');

    let $category = $('<div class="category"></div>');

    
    $categoryTitle.on('click', function() {
        $category.toggleClass('hidden');
        $categoryTitle.toggleClass('arrow-left');
        $categoryTitle.toggleClass('arrow-down');
    });
    $categoryTitle.appendTo($store);


    for (const key of items) {
        let value = setup.equipment[key];

        if (value.removeIf && !!Scripting.evalJavaScript(value.removeIf))
            continue;

        let locked = false;
        let lockedReason = "";
        if (equipmentUnlocked(key)) {
            locked = true;
            lockedReason = "Already purchased.";
        } else if (value.disabled) {
            locked = true;
            lockedReason = "Not implemented yet.";
        } else if (value.prerequisite && !!!Scripting.evalJavaScript(value.prerequisite)) {
            locked = true;
            lockedReason = "You have no reason to get this now.";
        } else if (value.requiredQuest && !hasCompletedQuest(value.requiredQuest)) {
            locked = true;
            lockedReason = "You have no reason to buy this now.";
        } else if (value.statRequired && !hasStatAmount(value.statRequired, value.statRequiredAmount)) {
            locked = true;
            lockedReason = "stat";
        } else if (value.cost > money(currency)) { 
            locked = true;
            lockedReason = "Not enough " + currency + ".";
        }

        let itemString = '<a class="equipment-item"><img class="equipment-item-img" src="images/equipment/' + key + '.jpg"><span class="equipment-item-name">' + value.name + '</span>';
        if (value.cost > 0)
            itemString += '<span class="equipment-item-cost">' + getIcon(currency) + ' <span class="equipment-item-cost-amount">' + value.cost + '</span></span>'; 
        itemString += '</a>';
        
            
        let $item = $(itemString);

        for (let tag of value.tags) {
            $item.addClass(tag);
        }

        if (value.stats) {
            for (const [stat, amount] of Object.entries(value.stats)) {
               let $statText = $('<span class="equipment-item-stat">' + (amount > 0 ? 'Increases ' : 'Decreases ') + getIcon(stat) + '</span>');
               $statText.appendTo($item);
            }
        }

        if (locked) {
            $item.attr('disabled', 'disabled');
            if (lockedReason === "stat") {
                statPopup($item, value.statRequired, value.statRequiredAmount);
            } else {
                popup($item, lockedReason);
            }
        } else {
            if (value.slot === 'potion' || value.slot === 'gift') {
                popup($item, value.description);
            }
            $item.on('click', function() {
                if (value.cost) {
                    changeMoney(currency, -value.cost);
                }
                if (value.slot !== 'potion') {
                    unlockEquipment(key);
                }
                if (value.equip) {
                    equip(key);
                }
                if (value.passage && (!value.equip || !hasVisited(value.passage))) {
                    Engine.play(value.passage);
                } else {
                    Engine.play(passage());
                }
            });
        }
        $item.appendTo($category);
    }
    $category.appendTo($store);
}

function equip(item, silent) {
    if (isMemory())
        return;
    let itemObj = setup.equipment[item];
    if (isWearing(itemObj.slot)) {
        unequip(itemObj.slot, true);
    }
    for (const [stat, amount] of Object.entries(itemObj.stats)) {
        changeStat(null, stat, amount, false, true);
    }
    variables().inventory[itemObj.slot] = item;

    swapDisguise(item);
    if (!silent) {
        // Refreshes equipment part of sidebar
        setLayer(slotToLayer(itemObj.slot));
        setPageElement('equipment', 'Equipment');
        setPageElement('portrait-container', 'Portrait');
        setPageElement('wardrobe-return-button', 'Wardrobe Return Button');
    }
}

function equipChastity() {
    if (isMemory())
        return;
    if (!variables().chastity) {
        variables().chastity = { color: 'pink', size: 'big' };
    }
    equip('chastity_' + variables().chastity.color + '_' + variables().chastity.size);
}

function unequipChastity() {
    if (!isMemory() && isInChastity())
        unequip('crotch');
}

function chastityColor() {
    return variables().chastity.color;
}

function chastitySize() {
    return variables().chastity.size;
}

function setChastity(color, size) {
    if (isMemory())
        return;
    variables().chastity = { 'color': color, 'size': size };
}

function unequip(slot, silent) {
    if (!isWearing(slot) || isMemory())
        return;
    for (const [stat, amount] of Object.entries(getEquipmentObject(slot).stats)) {
        changeStat(null, stat, -amount, false, true);
    }
    variables().inventory[slot] = "";
    if (!silent) {
        setLayer(slotToLayer(slot));
        setPageElement('equipment', 'Equipment');
        setPageElement('wardrobe-return-button', 'Wardrobe Return Button');
    }
}

function swapDisguise(item) {
    if (isMemory())
        return;
    let itemObj = setup.equipment[item];
    if (itemObj.tags.contains('disguise'))
        for (let slot of slots)
            if (isWearing(slot))
                if (getEquipmentObject(slot).tags.contains('royal'))
                    unequip(slot, true);

    if (itemObj.tags.contains('royal'))
        for (let slot of slots)
            if (isWearing(slot))
                if (getEquipmentObject(slot).tags.contains('disguise'))
                    unequip(slot, true);
}

function getEquipmentObject(slot) {
    return setup.equipment[variables().inventory[slot]];
}

function isWearing(slot) {
    if (slot === 'potion')
        return false;
    return variables().inventory[slot].length > 0;
}

function hasClothesTag(tag) {
    return hasEquipmentTag(tag, 'clothes');
}

// function hasSlotTag(slot, tag) {
//     return variables().inventory[slot] && setup.equipment[variables().inventory[slot]].tags.contains(tag);
// }

function hasEquipmentTag(tag, slot) {
    let inventory = variables().inventory;
    if (slot)
        return !!inventory[slot] && setup.equipment[inventory[slot]].tags.contains(tag);
    for (let s of slots) {
        if (inventory[s])
            if (setup.equipment[inventory[s]].tags.contains(tag))
                return true;
    }
    return false;
}

// Some shorthand functions
function isInChastity() {
    return hasEquipmentTag('chastity', 'crotch');
}

function isDisguised() {
    return hasClothesTag('disguise');
}


function getOutfitImg(outfitName, slot) {
    if (!outfitName) {
        console.error('outfit() -> outfitName not provided.');
        return;
    }
    outfitName = outfitName.toLowerCase().trim();
    if (!hasOutfit(outfitName)) {
        console.error('outfit() -> ' + outfitName + ' doesn\'t exist.');
        return;
    }
    let img = variables().outfits[outfitName][slot];

    if (!img || img === 'none') {
        if (isOverwear(slot)) {
            img = variables().outfits[outfitName][underSlot(slot)];

            if (!img || img === 'none') {
                img = 'none.webp';
            } else {
                img += ".jpg";
            }
        } else {
            img = 'none.webp';
        }
    } else {
        img += ".jpg";
    }
    return "images/equipment/" + img;
}

function getEquipment(slotId) {
    let img = variables().inventory[getSlot(slotId)];
    if (!img) {
        img = 'none.webp';
    } else {
        img += ".jpg";
    }
    return "images/equipment/" + img;
}

function equipmentUnlocked(item) {
    return variables().inventory.unlockedequipment.contains(item);
}

function unlockEquipment(item) {
    if (isMemory())
        return;
    variables().inventory.unlockedequipment.pushUnique(item);
}

function lockEquipment(item) {
    if (isMemory())
        return;
    var i = variables().unlockedequipment.indexOf(item);
    if (i < 0) {
        console.error('lockEquipment() -> item "' + item + '" doesn\'t exist');
        return;
    }
    variables().unlockedequipment.splice(i, 1);
}

function slotToLayer(slot) {
    if (slot === "underwear" || slot === "crotch" || slot === "ass")
        return 'under';
    return 'over';
}

function getSlot(slotId) {
    if (isLayer('under')) {
        switch (slotId) {
            case 0: return 'underwear';
            case 1: return 'crotch';
            case 2: return 'ass';
        }
    } else {
        switch (slotId) {
            case 0: return 'clothes';
            case 1: return 'head';
            case 2: return 'shoes';
        }
    }
}

function isLayer(layer) {
    return layer === variables()['equipmentlayer'];
}

function setLayer(layer) {
    variables()['equipmentlayer'] = layer;
}

function toys($output) {
    let $toys = $('<div id="toys"></div>');
    let anyToy = false;
    
    for (const [key, value] of Object.entries(setup.equipment)) {
        if (!equipmentUnlocked(key) || value.slot !== 'toy')
            continue;
        
        let $toy = $('<a class="toy"><img class="toy-img" src="images/equipment/' + key + '.jpg"><span class="toy-name">' + value.name + '</span></a>');
        $toy.on('click', function() {
            Engine.play("Toy Use " + key);
        });
        $toy.appendTo($toys);
        anyToy = true;
    }
    if (!($output instanceof $)) {
        $output = $($output);
    }
    if (anyToy) {
        $toys.appendTo($output);
    } else {
        $('<div id="no-toys"></div>').wiki('Unfortunately, you are met with an empty cabinet. Maybe you should visit ?Beau first and buy something fun.').appendTo($output);
    }
}


setup.getEquipment = getEquipment;
window.getEquipment = window.getEquipment || getEquipment;
setup.outfit = outfit;
window.outfit = window.outfit || outfit;
setup.changeOutfit = changeOutfit;
window.changeOutfit = window.changeOutfit || changeOutfit;
setup.changeOutfitSlot = changeOutfitSlot;
window.changeOutfitSlot = window.changeOutfitSlot || changeOutfitSlot;
setup.hasOutfit = hasOutfit;
window.hasOutfit = window.hasOutfit || hasOutfit;
setup.isLayer = isLayer;
window.isLayer = window.isLayer || isLayer;
setup.setLayer = setLayer;
window.setLayer = window.setLayer || setLayer;
setup.equip = equip;
window.equip = window.equip || equip;
setup.equipChastity = equipChastity;
window.equipChastity = window.equipChastity || equipChastity;
setup.unequipChastity = unequipChastity;
window.unequipChastity = window.unequipChastity || unequipChastity;
setup.setChastity = setChastity;
window.setChastity = window.setChastity || setChastity;
setup.chastityColor = chastityColor;
window.chastityColor = window.chastityColor || chastityColor;
setup.chastitySize = chastitySize;
window.chastitySize = window.chastitySize || chastitySize;
setup.unequip = unequip;
window.unequip = window.unequip || unequip;
setup.hasClothesTag = hasClothesTag;
window.hasClothesTag = window.hasClothesTag || hasClothesTag;
setup.hasEquipmentTag = hasEquipmentTag;
window.hasEquipmentTag = window.hasEquipmentTag || hasEquipmentTag;
// setup.hasSlotTag = hasSlotTag;
// window.hasSlotTag = window.hasSlotTag || hasSlotTag;
setup.isWearing = isWearing;
window.isWearing = window.isWearing || isWearing;
setup.equipmentUnlocked = equipmentUnlocked;
window.equipmentUnlocked = window.equipmentUnlocked || equipmentUnlocked;
setup.unlockEquipment = unlockEquipment;
window.unlockEquipment = window.unlockEquipment || unlockEquipment;

setup.isDisguised = isDisguised;
window.isDisguised = window.isDisguised || isDisguised;
setup.isInChastity = isInChastity;
window.isInChastity = window.isInChastity || isInChastity;




$(document).one(':passagestart', function () {

    Macro.add('equip', {
        handler : function () {
            equip(this.args[0]);
        }
    });

    Macro.add('equipchastity', {
        handler : function () {
            equipChastity();
        }
    });

    Macro.add('unequipchastity', {
        handler : function () {
            unequipChastity();
        }
    });

    Macro.add('setchastity', {
        handler : function () {
            setChastity(this.args[0], this.args[1]);
        }
    });

    Macro.add('unequip', {
        handler : function () {
            unequip(this.args[0]);
        }
    });

    Macro.add('wardrobe', {
        handler : function () {
            wardrobe(this.output);
        }
    });

    Macro.add('unlockequipment', {
        handler : function () {
            unlockEquipment(this.args[0]);
        }
    });

    Macro.add('store', {
        handler : function () {
            store(this.output, this.args[0]);
        }
    });

    Macro.add('outfit', {
        handler : function () {
            outfit(this.args[0]);
        }
    });

    Macro.add('toys', {
        handler : function () {
            toys(this.output);
        }
    });

    Macro.add('changeoutfit', {
        handler : function () {
            changeOutfit(this.args[0], this.args[1], this.args[2], this.args[3], this.args[4], this.args[5], this.args[6]);
        }
    });

    Macro.add('changeoutfitslot', {
        handler : function () {
            changeOutfitSlot(this.args[0], this.args[1], this.args[2]);
        }
    });
});
/* twine-user-script #14: "equipmentsetup.js" */

setup.equipment = {
    "boots": {
        name: 'Leather boots',
        slot: 'shoes',
        tags: [],
        equip: true,
        description: 'A nice pair of boots that have never disappointed you.',
        stats: {}
    },
    "shoes": {
        name: 'Leather shoes',
        slot: 'shoes',
        tags: [],
        equip: true,
        description: 'A nice pair of shoes that have never disappointed you.',
        stats: {}
    },
    "crown": {
        name: 'Royal crown',
        slot: 'head',
        tags: [ 'royal' ],
        equip: true,
        description: 'Your royal crown bearing with it all the weight of regality.',
        stats: {}
    },
    "prince_outfit_1": {
        name: 'Regal outfit',
        slot: 'clothes',
        tags: [ 'masculine', 'royal' ],
        equip: true,
        description: 'Probably your favorite princely outfit. It\'s comfy and classy.',
        stats: {}
    },
    "prince_outfit_2": {
        name: 'Formal outfit',
        slot: 'clothes',
        tags: [ 'masculine', 'royal' ],
        equip: true,
        description: 'Your formal princely garb meant for special occasions and ceremonies.',
        stats: {}
    },
    "prince_outfit_3": {
        name: 'Adventurer outfit',
        slot: 'clothes',
        origin: 'hyssop',
        cost: 32,
        tags: [ 'masculine', 'disguise' ],
        equip: true,
        description: 'Awesome looking adventurer clothing.',
        stats: {}
    },
    "prince_outfit_4": {
        name: 'Sunday robes',
        slot: 'clothes',
        tags: [ 'masculine', 'royal' ],
        equip: true,
        description: 'Your fancy looking Sunday robes for when you go to church.',
        stats: {}
    },
    "underwear_1": {
        name: 'Cotton underwear',
        slot: 'underwear',
        tags: [],
        equip: true,
        description: 'Your trusty pair of underwear shorts.',
        stats: {}
    },
    "panties": {
        name: 'Cotton panties',
        slot: 'underwear',
        tags: [ 'feminine' ],
        equip: true,
        description: 'Panties that Morgana gave you.',
        stats: {
            'femininity': 5
        }
    },
    "flats": {
        name: 'Flats',
        slot: 'shoes',
        tags: [ 'feminine' ],
        equip: true,
        description: 'Flats that Morgana gave you.',
        stats: {}
    },
    "wig_1": {
        name: 'Brown wig',
        slot: 'head',
        tags: [ 'feminine', 'disguise', 'hair' ],
        equip: true,
        description: 'A brown wig made by Hyssop.',
        stats: {
            'femininity': 25
        }
    },
    "hat_1": {
        name: 'Brown hat',
        slot: 'head',
        tags: [ ],
        equip: true,
        description: 'A brown hat.',
        stats: {}
    },
    "manservant": {
        name: 'Manservant outfit',
        slot: 'clothes',
        tags: [ 'disguise', 'masculine' ],
        equip: true,
        description: 'The manservant disguise that Morgana gave you.',
        stats: {}
    },
    "chastity_pink_big": {
        name: 'Pink chastity cage, big',
        slot: 'crotch',
        tags: [ 'feminine', 'chastity' ],
        cost: 50,
        equip: false,
        prerequisite: 'chastityColor() !== "pink"',
        removeIf: '!isInChastity() || hasCompletedQuest(\'kathryn-chastity-excursion\')',
        origin: 'beau',
        description: 'A pink chastity cage.',
        passage: 'Beau Purchase Chastity Pink Big',
        stats: {}
    },
    "chastity_black_big": {
        name: 'Black chastity cage, big',
        slot: 'crotch',
        tags: [ 'chastity' ],
        cost: 50,
        equip: false,
        prerequisite: 'chastityColor() !== "black"',
        removeIf: '!isInChastity() || hasCompletedQuest(\'kathryn-chastity-excursion\')',
        origin: 'beau',
        description: 'A black chastity cage.',
        passage: 'Beau Purchase Chastity Black Big',
        stats: {}
    },
    "chastity_metal_big": {
        name: 'Metal chastity cage, big',
        slot: 'crotch',
        tags: [ 'chastity' ],
        cost: 50,
        equip: false,
        prerequisite: 'chastityColor() !== "metal"',
        removeIf: '!isInChastity() || hasCompletedQuest(\'kathryn-chastity-excursion\')',
        origin: 'beau',
        description: 'A metal chastity cage.',
        passage: 'Beau Purchase Chastity Metal Big',
        stats: {}
    },
    "chastity_pink_medium": {
        name: 'Pink chastity cage',
        slot: 'crotch',
        tags: [ 'feminine', 'chastity' ],
        cost: 40,
        equip: false,
        prerequisite: 'chastityColor() !== "pink"',
        removeIf: '!isInChastity() || !hasCompletedQuest(\'kathryn-chastity-excursion\')',
        origin: 'beau',
        description: 'A pink chastity cage.',
        passage: 'Beau Purchase Chastity Pink Medium',
        stats: {}
    },
    "chastity_black_medium": {
        name: 'Black chastity cage',
        slot: 'crotch',
        tags: [ 'chastity' ],
        cost: 40,
        equip: false,
        prerequisite: 'chastityColor() !== "black"',
        removeIf: '!isInChastity() || !hasCompletedQuest(\'kathryn-chastity-excursion\')',
        origin: 'beau',
        description: 'A black chastity cage.',
        passage: 'Beau Purchase Chastity Black Medium',
        stats: {}
    },
    "chastity_metal_medium": {
        name: 'Metal chastity cage',
        slot: 'crotch',
        tags: [ 'chastity' ],
        cost: 40,
        equip: false,
        prerequisite: 'chastityColor() !== "metal"',
        removeIf: '!isInChastity() || !hasCompletedQuest(\'kathryn-chastity-excursion\')',
        origin: 'beau',
        description: 'A metal chastity cage.',
        passage: 'Beau Purchase Chastity Metal Medium',
        stats: {}
    },
    "kitchen_maid": {
        name: 'Maid outfit',
        slot: 'clothes',
        tags: [ 'disguise', 'feminine' ],
        equip: true,
        description: 'The kitchen maid outfit that Morgana gave you.',
        stats: {
            'femininity': 80
        }
    },
    "lingerie_cotton": {
        name: 'Blue underwear',
        slot: 'underwear',
        origin: 'hyssop',
        cost: 5,
        tags: [ 'feminine' ],
        equip: true,
        description: 'A blue set of underwear.',
        stats: {
            'femininity': 10
        }
    },
    "lingerie_flowery": {
        name: 'Flowery lingerie',
        slot: 'underwear',
        origin: 'hyssop',
        cost: 8,
        tags: [ 'feminine' ],
        equip: true,
        description: 'A nice set of flowery embroidered underwear.',
        stats: {
            'femininity': 10
        }
    },
    "lingerie_red": {
        name: 'Red lingerie',
        slot: 'underwear',
        origin: 'hyssop',
        cost: 8,
        tags: [ 'feminine' ],
        equip: true,
        description: 'A luscious set of red underwear.',
        stats: {
            'femininity': 10
        }
    },
    "dress_pink": {
        name: 'Pink dress',
        slot: 'clothes',
        description: 'A pink dress, very girly.',
        origin: 'hyssop',
        cost: 24,
        tags: [ 'disguise', 'feminine' ],
        equip: true,
        passage: "Trying Dress Hyssop",
        stats: {
            'femininity': 100
        }
    },
    "dress_white": {
        name: 'White dress',
        slot: 'clothes',
        description: 'A white dress.',
        origin: 'hyssop',
        cost: 24,
        tags: [ 'disguise', 'feminine' ],
        equip: true,
        passage: "Trying Dress Hyssop",
        stats: {
            'femininity': 100
        }
    },
    "dress_red": {
        name: 'Red dress',
        slot: 'clothes',
        description: 'A white dress.',
        origin: 'hyssop',
        cost: 24,
        tags: [ 'disguise', 'feminine' ],
        equip: true,
        passage: "Trying Dress Hyssop",
        stats: {
            'femininity': 100
        }
    },
    "druid_dress": {
        name: 'Druid dress',
        slot: 'clothes',
        description: 'A druid dress made by Hyssop.',
        origin: 'hyssop',
        cost: 32,
        tags: [ 'disguise', 'feminine' ],
        equip: true,
        passage: "Trying Dress Hyssop",
        stats: {
            'femininity': 100
        }
    },
    "potion_increase_titty": {
        name: 'Tittynflate',
        slot: 'potion',
        description: 'A sweet smelling potions that apparently increases the volume of your breasts.',
        origin: 'morgana',
        prerequisite: 'chestValue() < 1',
        cost: 3,
        tags: [ 'feminine' ],
        equip: false,
        passage: "Potion Increase Titty"
    },
    "potion_decrease_titty": {
        name: 'Bosomsbane',
        slot: 'potion',
        description: 'A strange smelling potion, supposed to decrease the size of your boobs.',
        origin: 'morgana',
        prerequisite: 'chestValue() > 0',
        cost: 3,
        tags: [ 'feminine' ],
        equip: false,
        passage: "Potion Decrease Titty"
    },
    "potion_increase_penis": {
        name: 'Mighty Oak',
        slot: 'potion',
        description: 'This explosive-looking potion will increase the size of your manhood.',
        origin: 'morgana',
        prerequisite: 'penisValue() < 3',
        cost: 3,
        tags: [],
        equip: false,
        passage: "Potion Increase Penis"
    },
    "potion_decrease_penis": {
        name: 'Bulge Begone',
        slot: 'potion',
        description: 'This shot glass-sized potion is supposed to decrease the size of your manhood quite drastically.',
        origin: 'morgana',
        prerequisite: 'penisValue() > 1',
        cost: 3,
        tags: [],
        equip: false,
        passage: "Potion Decrease Penis"
    },
    "potion_increase_ass": {
        name: 'Plumpy Peach',
        slot: 'potion',
        description: 'This bombastic-looking potion will increase the size of your ass.',
        origin: 'morgana',
        prerequisite: 'assValue() < 1',
        cost: 3,
        tags: [],
        equip: false,
        passage: "Potion Increase Ass"
    },
    "potion_decrease_ass": {
        name: 'Flatter Yourself',
        slot: 'potion',
        description: 'This punny potion is supposed to decrease the size of your ass.',
        origin: 'morgana',
        prerequisite: 'assValue() > 0',
        cost: 3,
        tags: [],
        equip: false,
        passage: "Potion Decrease Ass"
    },
    "ointment": {
        name: 'Switch Ointment',
        slot: 'potion',
        description: "Switch your magical ointment from <<if hasTag('ointment-fem')>>feminizing to masculinizing<<else>>masculinizing to feminizing<</if>>.",
        origin: 'morgana',
        cost: 0,
        tags: [],
        equip: false,
        passage: "Ointment Switch"
    },
    "gift_quill": {
        name: 'Eloquent Quill',
        slot: 'gift',
        description: 'A writing quill of intricate design. Perhaps ?Orson would be interesting in this?',
        origin: 'beau',
        requiredQuest: 'orson-date-1',
        cost: 40,
        tags: [],
        equip: false,
        passage: "Beau Purchase Gift Quill"
    },
    "gift_pendant": {
        name: 'Flower Pendant',
        slot: 'gift',
        description: 'A beautiful golden flower pendant. Maybe ?Rosa would like this?',
        origin: 'beau',
        requiredQuest: 'rosa-date-2',
        cost: 40,
        tags: [],
        equip: false,
        passage: "Beau Purchase Gift Pendant"
    },
    "gift_vibrator": {
        name: 'Wand of Vibrations',
        slot: 'gift',
        description: 'Not actually from the gift section but you\'re sure ?Eve would very much be interested in this!',
        origin: 'beau',
        cost: 40,
        tags: [],
        equip: false,
        passage: "Beau Purchase Gift Vibrator"
    },
    "dildo_copper": {
        name: 'Copper Dildo',
        slot: 'toy',
        description: 'A copper dildo. It\'s the smallest size that ?Beau offers. The magical enchantment makes it feel much more realistic even though it\'s made of copper. Bonus feature is that the metal is inherently disinfectant!',
        origin: 'beau',
        cost: 25,
        tags: [],
        equip: false,
        disabled: false,
        passage: "Beau Purchase Copper Dildo"
    },
    "dildo_iron": {
        name: 'Iron Dildo',
        slot: 'toy',
        description: 'An iron dildo. Quite a modest size. The magical enchantment makes it feel much more realistic even though it\'s made of iron.',
        origin: 'beau',
        cost: 50,
        tags: [],
        equip: false,
        disabled: true,
        passage: "Beau Purchase Iron Dildo"
    },
    "dildo_gold": {
        name: 'Gold Dildo',
        slot: 'toy',
        description: 'The beautiful golden dildo. Larger than the iron one, it\'s very imposing. The magical enchantment makes it feel much more realistic even though it\'s made of gold.',
        origin: 'beau',
        cost: 100,
        tags: [],
        equip: false,
        disabled: true,
        passage: "Beau Purchase Gold Dildo"
    },
    "dildo_crystal": {
        name: 'Crystal Dildo',
        slot: 'toy',
        description: 'The magnificent crystal dildo. This thing is actually massive. The magical enchantment makes it feel much more realistic even though it\'s made of crystal.',
        origin: 'beau',
        cost: 200,
        tags: [],
        equip: false,
        disabled: true,
        passage: "Beau Purchase Crystal Dildo"
    },
    "potion_femininity": {
        name: 'Femininity Potion',
        slot: 'potion',
        description: 'The potion that ?Morgana originally wanted to give you in your bedroom.',
        origin: 'morgana',
        removeIf: 'faceValue() > 0',
        cost: 5,
        tags: [],
        equip: false,
        passage: "Potion Femininity"
    }
}
/* twine-user-script #15: "events.js" */
function runEvents($output, type) {
    if (!$output)
        return;
    if (!type) {
        console.error('runEvents() -> invalid arguments');
        return;
    }
    let events = variables().events[type];
    let passage;
    for (let i = 0; i < events.length; i++) {
        if (events[i].delay > 0)
            continue;
        if (events[i].prerequisite !== undefined) {
            try {
                let active = !!Scripting.evalJavaScript(events[i].prerequisite);
                if (!active)
                    continue;
            } catch (err) {
                console.error("event macro -> bad evaluation: " + err.message);
            }
        }
        passage = events[i].passage;

        if (!events[i].repeating)
            removeEvent(type, events[i].passage);
        break;
    }
    if (passage === undefined) {
        passage = type.toUpperFirst() + ' Event Default';
    }
    if (!Story.has(passage)) {
        return;
    }
    if (!($output instanceof $)) {
        $output = $($output);
    }
    let $span = $(document.createElement('span')).addClass('event');
    $span.wiki(Story.get(passage).processText());
    $span.appendTo($output);

}

function eventPriority(priority) {
    if (isNaN(priority)) {
        switch(priority) {
            case 'first':
                return 1;
            case 'high':
                return 2;
            case 'medium':
                return 3;
            case 'low':
                return 4;
            case 'last':
                return 5;
        }
    }
    return priority;
}


function addEvent(type, passage, delay, priority, prerequisite, repeating) {
    if (isMemory())
        return;
    if (!type || !passage) {
        console.error('addEvent() -> invalid arguments');
        return;
    }
    if (delay === undefined) {
        delay = 0;
    }
    if (priority === undefined)
        priority = eventPriority('medium');
    else
        priority = eventPriority(priority);
    
    let events = variables().events[type];
    let index = events.length;
    for (let i = 0; i < events.length; i++) {
        if (events[i].passage === passage)
            return;
        if (events[i].priority > priority) {
            index = i;
            break;
        }
    }
    events.splice(index, 0, { passage: passage, delay: Number(delay), priority: priority, prerequisite: prerequisite, repeating: repeating });
}

function removeEvent(type, name) {
    if (isMemory())
        return;
    if (!type || !name) {
        console.error('removeEvent() -> invalid arguments');
        return;
    }
    let events = variables().events[type];
    for (let i = 0; i < events.length; i++) {
        if (events[i].passage === name) {
            events.splice(i, 1);
            return;
        }
    }
    console.error('removeEvent() -> event "' + name + '" doesn\'t exist in ' + type);
    return;
}

function hasEvent (type, name) {
    let events = variables().events[type];
    for (let i = 0; i < events.length; i++) {
        if (events[i].passage === name) {
            return true;
        }
    }
    return false;
}

setup.hasEvent = hasEvent;
window.hasEvent = window.hasEvent || hasEvent;

$(document).one(':passagestart', function () {
    Macro.add('removeevent', {
        handler : function () {
            removeEvent(this.args[0], this.args[1]);
        }
    });
    Macro.add('runevents', {
        handler : function () {
            runEvents(this.output, this.args[0]);
        }
    });
    Macro.add('addevent', {
        tags : [ 'delay', 'priority', 'prerequisite', 'repeating' ],
        handler : function () {
            let delay;
            let priority;
            let prerequisite;
            let repeating = false;
			for (let i = 0; i < this.payload.length; i++) {
                if (this.payload[i].name === 'delay') {
                    delay = this.payload[i].args.raw.trim();
                }
                else if (this.payload[i].name === 'priority') {
                    priority = this.payload[i].args.raw.trim();
                }
                else if (this.payload[i].name === 'prerequisite') {
                    prerequisite = this.payload[i].args.full;
                }
                else if (this.payload[i].name === 'repeating') {
                    repeating = true;
                }
            }
            if (delay === undefined) {
                delay = this.args[2];
            }
            if (priority === undefined) {
                priority = this.args[3];
            }
            addEvent(this.args[0], this.args[1], delay, priority, prerequisite, repeating);
        }
    });
});
/* twine-user-script #16: "image.js" */

function getPortrait(characterId) {
    if (!hasCharacter(characterId))
        return "images/portraits/default.jpg";

    if (characterId === 'player') {
        if (face() === 'egg')
            return 'images/portraits/player_egg_' + getTheme() + '.jpg';
        
        if (face() === 'androgynous')
            return 'images/portraits/player_androgynous_' + getTheme() + '.jpg';

        // if (face() === 'feminine')
        //     return 'images/portraits/player_feminine_' + getTheme() + '.jpg';
    }

    if (characterId.startsWith('leave')) {
        return 'images/portraits/leave.jpg';
    }
    if (characterId.startsWith('bread')) {
        return 'images/portraits/bread.jpg';
    }

    return 'images/portraits/' + characterId + '_' + getTheme() + '.jpg';
}

function getIcon(icon) {
    return '<img class="icon '+ icon + '" src="images/icons/' + icon + '.png">';
}

function icon($output, icon, hover) {

    let $icon = $(getIcon(icon));
    if (hover || hover === undefined)
        popup($icon, icon.toUpperFirst());

    if (isKingdomStat(icon)) {
        $icon.attr('data-position', kingdomStat(icon));
    }

    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $icon.appendTo($output)
    }

    return $icon;
}

function addImage ($output, path, classes, width) {
    let $img = $(document.createElement('img'));

    if (!path.startsWith('images/')) {
        path = 'images/' + path;
    }

    if (path.contains('{theme}')) {
        $img.attr('src-orig', path);
        path = path.replace('{theme}', getTheme());
        $img.addClass('themed');
    }
    
    $img.attr('src', path);

    if (classes)
        $img.addClass(classes);
    
    if (width)
        $img.css('width', width);
    
    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $img.appendTo($output);
    }

    return $img;
}

function addVideo ($output, path, classes, width) {
    let $video = $(document.createElement('video'));

    if (!path.startsWith('videos/')) {
        path = 'videos/' + path;
    }

    if (path.contains('{')) {
        let paths = path.split('{');
        if (paths[1].contains('}')) {
            let paths2 = paths[1].split('}');
            let max = paths2[0].match(/\d+/)[0];
            let random = Math.floor(Math.random() * max + 1);
            path = paths[0] + random + paths2[1];
        }
    }
    
    $video.attr('src', path);

    if (classes)
        $video.addClass(classes);
    
    if (width)
        $video.css('width', width);

    $video.attr('playsinline', true).attr('webkit-playsinline', true).attr('loop', true).attr('muted', true);
    
    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $video.appendTo($output);
    }

    return $video;
}

setup.getPortrait = getPortrait;
window.getPortrait = window.getPortrait || getPortrait;
setup.getIcon = getIcon;
window.getIcon = window.getIcon || getIcon;


$(document).one(':passagestart', function () {
    Macro.add('img', {
        handler : function () {
            addImage(this.output, this.args[0], this.args[1], this.args[2]);
        }
    });

    Macro.add('video', {
        handler : function () {
            addVideo(this.output, this.args[0], this.args[1], this.args[2]);
        }
    });

    Macro.add('icon', {
        handler : function () {
            icon(this.output, this.args[0], this.args[1]);
        }
    });
});

/* twine-user-script #17: "location.js" */
var locations = new Map();

function addLocation (name, area) {
    if (!name || !Story.has(name)) {
        console.error('addLocation() -> invalid arguments');
        return;
    }
    if (locations.has(name)) {
        console.error('addLocation() -> overwriting location "' + name + '"');
    }
    let obj = {title: name, area: area, description: Story.get(name).processText()};
    if (Story.has(name + ' Decisions')) {
        obj['decisions'] = Story.get(name + ' Decisions').processText();
    }
    locations.set(name, obj);
}

function getLocationImage(title) {
    if (title === undefined)
        title = getLocation().title;
    return 'images/locations/' + title.replaceAll(' ', '_').replaceAll("'", '-') + '.png';
}

function unlockLocation(name) {
    if (isMemory())
        return;
    if (!name) {
        console.error('unlockLocation() -> invalid arguments');
        return;
    }
    var i = variables().lockedlocations.indexOf(name);
    if (i < 0) {
        console.error('unlockLocation() -> location "' + name + '" doesn\'t exist');
        return;
    }
    variables().lockedlocations.splice(i, 1);
}

function lockLocation(name) {
    if (isMemory())
        return;
    if (!name) {
        console.error('lockLocation() -> invalid arguments');
        return;
    }

    variables().lockedlocations.pushUnique(name);
}

function getArea(ignoreSubAreas) {
    let area = getLocation().area;
    if (ignoreSubAreas) {
        if (area === 'tavern') {
            area = 'town';
        }
    }
    return area;
}

function getAreaExit(area) {
    if (area === 'castle' && hasCompletedQuest('morgana-forest'))
        return 'Gatehouse';
    if (area === 'forest')
        return 'Meadow';
    if (area === 'town')
        return 'Road';
    if (area === 'tavern')
        return 'Town square';
    return '';
}

function hasLocation(name) {
    return locations.has(name);
}


function getLocation(name) {
    if (!name) {
        if (!variables().location) {
            console.error('getLocation() -> no location given');
            return;
        }
        name = variables().location;
    }
    if (!locations.has(name)) {
        console.error('getLocation() -> location "' + name + '" does not exist');
        return;
    }
    return locations.get(name);
}

function setLocation(name, replaceHeader) {
    if (!locations.has(name)) {
        console.error('setLocation() -> location "' + name + '" does not exist');
        return;
    }
    
    variables().location = name;

    if (replaceHeader)
        generateHeader($('#passages .passage'));
}

setup.getLocation = getLocation;
window.getLocation = window.getLocation || getLocation;
setup.getArea = getArea;
window.getArea = window.getArea || getArea;

$(document).one(':passagestart', function () {
    var passages = Story.lookup("tags", "location");
    passages.forEach(passage => {
        addLocation(passage.title, passage.tags[1] ? passage.tags[1] : "")
    });

    Macro.add('setlocation', {
        handler : function () {
            setLocation(this.args[0], this.args[1]);
        }
    });

    Macro.add('unlocklocation', {
        handler : function () {
            unlockLocation(this.args[0]);
        }
    });

    Macro.add('locklocation', {
        handler : function () {
            lockLocation(this.args[0]);
        }
    });
});

/* twine-user-script #18: "meters.js" */
(function () {
    'use strict';
    // meters.js, by Chapel; for SugarCube 2
    // v1.0.1

    var options = {
        tryGlobal : true, // attempt to send `Meter` to the global scope?
        allowClobbering : false, // allow a new meter to replace a previously defined meter with the same name instead of throwing
        IAmAGrownUp : false // make sure you have enough rope to hang yourself
    };


    var defaultSettings = {
        full : '#2ECC40', // color when the bar is full
        empty : '#FF4136', // color when the bar is empty
        back : '#DDDDDD', // color of the backing
        height : '12px', // height of the bar
        width : '180px', // width of the bar
        animate : 400, // ms
        easing : 'swing', // animation easing
        text : '#111111', // label text color
        label : '', // label text
        align : 'center', // label alignment
        double: false
    };

    var _validAlignments = ['center', 'left', 'right'];
    var _validEasing = ['swing', 'linear'];

    function _handleString (str, def) {
        if (str && typeof str === 'string') {
            str = str.toLowerCase().trim();
            if (str) {
                return str;
            }
        }
        return def || '';
    }

    function _colorEasing (t) {
        // from: https://gist.github.com/gre/1650294
        return (t < 0.5) ? 2 * t * t : -1 + (4 - 2 * t) *t;
    }

    function Meter (opts, value) {
        if (!(this instanceof Meter)) {
            return new Meter(opts, value);
        }

        var defs = clone(defaultSettings);

        this.settings = Object.assign(defs, opts);

        // default malformed settings

        this.settings.align = _handleString(this.settings.align);
        this.settings.easing = _handleString(this.settings.easing);

        if (!_validAlignments.includes(this.settings.align)) {
            this.settings.align = 'center';
        }

        if (!_validEasing.includes(this.settings.easing)) {
            this.settings.easing = 'swing';
        }

        // set the value, or default to 1

        value = Number(value);
        if (Number.isNaN(value)) {
            value = 1;
        }
        value = Math.clamp(value, 0, 1);
        this.value = value;

        // the backing of the meter, and the container
        var $wrapper = $(document.createElement('div'))
            .addClass('chapel-meter')
            .attr({
                'data-val' : value,
                'data-label' : this.settings.label
            })
            .css({
                'position' : 'relative',
                'background' : this.settings.double ? 'linear-gradient(to right, ' + this.settings.empty + ', ' + this.settings.full + ')' : this.settings.back,
                // 'height' : this.settings.height,
                // 'width' : this.settings.width,
                'overflow' : 'hidden'
            });

        // the meter's label
        var $label = $(document.createElement('div'))
            .addClass('meter-label')
            .css({
                'top' : 0,
                'right' : 0,
                'font-size' : this.settings.height,
                'font-weight' : 'bold',
                'line-height' : '100%',
                // 'width' : '100%',
                'height' : '100%',
                'vertical-align' : 'middle',
                'text-align' : this.settings.align,
                'color' : this.settings.text,
                'z-index' : 1,
                'position' : 'relative',
                'bottom' : '100%'
            })
            .wiki(this.settings.label)
            .appendTo($wrapper);

        // this is just here to give the bar a smooth transitioning coloration
        var $barTop = $(document.createElement('div'))
            .addClass('meter-top')
            .css({
                'background-color' : 'transparent',//this.settings.full,
                'opacity' : _colorEasing(this.value),
                'width' : '100%',
                'height' : '100%',
                'z-index' : 0
            });

        // this actually holds the value and the 'real' bar color
        var $barBottom = $(document.createElement('div'))
            .addClass('meter-bottom')
            .css({
                'position' : 'absolute',
                'top' : 0,
                'left' : 0,
                'background-color' : this.settings.double ? 'transparent' : this.settings.empty,
                'opacity' : 1,
                'width' : (this.value * 100) + '%',
                'height' : '100%',
                'z-index' : 0
            })
            .append($barTop)
            .appendTo($wrapper);

        this.$element = $wrapper;
        this.$bars = { // undocumented
            top : $barTop,
            bottom : $barBottom
        };
        this.$label = $label; // undocumented
        this.$double = this.settings.double;
        this.$colors = {
            full : this.settings.full,
            empty : this.settings.empty
        }

        // mostly a reminder
        $label.css('font-size', (parseInt($wrapper.css('height'), 10) < parseInt($('.passage').css('font-size'), 10)) ? 
            $wrapper.css('height') : $('.passage').css('font-size'));
        $label.css('line-height', $wrapper.css('height'));
    }

    Object.assign(Meter, {
        _list : new Map(), // undocumented; meter data dump
        is : function (thing) { // see if passed "thing" is a meter instance
            return thing instanceof Meter;
        },
        has : function (name) { // does the named meter exist?
            return Meter._list.has(name) && Meter.is(Meter._list.get(name));
        },
        get : function (name) { // return the meter instance
            if (Meter.has(name)) {
                return Meter._list.get(name);
            }
            return null;
        },
        del : function (name) { // delete the meter with the indicated name
            if (Meter.has(name)) {
                Meter._list.delete(name);
            }
        },
        add : function (name, opts, value) { // add a new meter; the constructor should not be used
            if (Meter.has(name) && !options.allowClobbering) {
                console.error('Meter "' + name + '" already exists.');
                return;
            }
            Object.assign(opts, { id : name });
            var meter = new Meter(opts, value);
            Meter._list.set(name, meter);
            return meter;
        },
        _emit : function (inst, name) { // undocumented; emit an event on the given meter
            if (!Meter.is(inst)) {
                return;
            }
            inst.$element.trigger({
                type : ':' + name,
                meter : inst
            });
        }
    });

    Object.assign(Meter.prototype, {
        constructor : Meter,
        _label : function (wait) { // undocumented; reprocess the meter label and set the sizes
            // THE LABEL IS AN ACTUAL NIGHTMARE
            var self = this;
            function process () {
                self.$label.empty().wiki(self.settings.label);
                self.$label.css('font-size', (parseInt(self.$element.css('height'), 10) < parseInt(self.$element.parent().css('font-size'), 10)) ? 
                    self.$element.css('height') : self.$element.parent().css('font-size'));
                self.$label.css('line-height', self.$element.css('height'));
            }
            if (wait) {
                setTimeout(process, Engine.minDomActionDelay);
            } else {
                process();
            }
            return this;
        },
        _width : function () { // undocumented; change the meter width
            var self = this;
            let width = (this.value * 100);
            if (width < 2)
                width = 2;
            this.$bars.bottom.animate({
                'width' : width + '%'
            }, this.settings.animate, this.settings.easing, function () {
                Meter._emit(self, 'meter-animation-complete');
            });
            return this;
        },
        _color : function () { // undocumented; blend the full and empty meter colors
            if (this.$double) {
                // var color = blendColors(this.$colors.empty, this.$colors.full, this.val());
                this.$bars.bottom.css('background', 'linear-gradient(to right, + ' + this.$colors.empty +', + ' + this.$colors.full + ')');
                // this.$bars.top.css('background-color', color);
                // this.$element.css('background-color', color);
            } else {
                this.$bars.top.animate({
                    'opacity' : _colorEasing(this.value)
                }, this.settings.animate, this.settings.easing);
            }
            return this;
        },
        animate : function () { // animate bar changes
            Meter._emit(this, 'meter-animation-start');
            return this._color()._width()._label();
        },
        val : function (n) { // set and get bar value
            if (n !== undefined) {
                n = Number(n);
                if (Number.isNaN(n)) {
                    n = 1;
                }
                n = Math.clamp(n, 0, 1);

                this.value = n;
                this.$label.attr('title', Math.round(n * 100) + '%');
                this.animate();
            }
            return this.value;
        },
        options : function (opts) {
            // set or get bar settings
            if (opts && typeof opts === 'object') {
                Object.assign(this.settings, opts);
            }
            return this.settings;
        },
        unwrap : function () {
            // return unwrapped container element
            return this.$element[0];
        },
        place : function ($target, options) { // put the bar in a known element, with a wrapper
            var $wrapper = $(document.createElement('span'));
            if (!($target instanceof jQuery)) {
                $target = $($target);
            }
            if (!$target[0]) {
                console.warn('meter#place() -> no valid target');
            }
            if (options && typeof options === 'object') {
                // options can contain classes or attributes for the wrapper
                if (options.classes && (Array.isArray(options.classes) || typeof options.classes === 'string')) {
                    $wrapper.addClass(options.classes);
                }
                if (options.attr && typeof options.attr === 'object') {
                    $wrapper.attr(options.attr);
                }
            }
            $target.append($wrapper.append(this.$element));
            // make sure to process the label
            this._label(true);
            return this;
        },
        // event methods for meters
        on : function (eventType, cb) {
            if (typeof cb !== 'function') {
                return this;
            }
            if (!eventType || typeof eventType !== 'string' || !eventType.trim()) {
                return this;
            }
            eventType = eventType.split(' ').map( function (type) {
                type = type.split('.')[0];
                return type + '.userland';
            }).join(' ');
            this.$element.on(eventType, cb);
            return this;
        },
        one : function (eventType, cb) {
            if (typeof cb !== 'function') {
                return this;
            }
            if (!eventType || typeof eventType !== 'string' || !eventType.trim()) {
                return this;
            }
            eventType = eventType.split(' ').map( function (type) {
                type = type.split('.')[0];
                return type + '.userland';
            }).join(' ');
            this.$element.one(eventType, cb);
            return this;
        },
        off : function (eventType) {
            if (eventType && typeof eventType === 'string' && eventType.trim()) {
                eventType = eventType.split(' ').map( function (type) {
                    type = type.split('.')[0];
                    return type + '.userland';
                }).join(' ');
            } else {
                eventType = '.userland'; // remove all user events
            }
            this.$element.off(eventType);
            return this;
        },
        // ariaClick-style setup
        click : function (options, cb) {
            // let SugarCube handle the errors
            this.$element.ariaClick(options, cb);
            return this;
        },
        // for completeness and in case a meter winds up in the state
        clone : function () {
            return new Meter(this.settings, this.value);
        },
        toJSON : function () {
            return JSON.reviveWrapper('new setup.Meter(' + JSON.stringify(this.settings) + ', ' + this.value + ')');
        }
    });

    // setup-spaced API
    setup.Meter = Meter;

    if (options.tryGlobal) { // global API, if undefined
        window.Meter = window.Meter || Meter;
    }

    // <<newmeter '$variable' [optional: starting value (between 0 and 1)]>>...<</newmeter>>
    // optional child tags: <<metercolors full [empty] [backing]>>, <<metersizing height [width]>>, <<meteranimation timeOrBool [easing]>>, <<meterlabel labelText [textColor] [alignment]>>
    Macro.add('newmeter', {
        tags : ['colors', 'sizing', 'animation', 'label'],
        handler : function () {

            if (State.length > 0 && !options.IAmAGrownUp) {
                // you are not a grown up
                return this.error('The `<<newmeter>>` macro must be called in your `StoryInit` special passage. Seriously. No excuses. --Love, Chapel');
            }

            if (this.args.length < 1) {
                return this.error('The `<<newmeter>>` macro requires at least one argument: a meter name.');
            }

            var meterName = this.args[0], 
                colorsTag = null, 
                sizeTag = null, 
                animTag = null,
                labelTag = null;

            if (typeof meterName !== 'string') {
                return this.error('Invalid meter name.');
            }

            meterName = meterName.trim();

            if (Meter.has(meterName) && !options.allowClobbering) {
                return this.error('Cannot clobber the existing meter "' + meterName + '".');
            }

            if (this.payload.length) {
                // get each child tag for processing
                colorsTag = this.payload.find( function (pl) {
                    return pl.name === 'colors';
                });
                sizeTag = this.payload.find( function (pl) {
                    return pl.name === 'sizing';
                });
                animTag = this.payload.find( function (pl) {
                    return pl.name === 'animation';
                });
                labelTag = this.payload.find( function (pl) {
                    return pl.name === 'label';
                });
            }

            var opts = {};

            if (colorsTag) {
                // process the colors tag
                if (!colorsTag.args.length) {
                    return this.error('No arguments passed to the `<<colors>>` tag.');
                }

                switch (colorsTag.args.length) {
                    case 1:
                        opts.empty = colorsTag.args[0];
                        opts.full = 'transparent'; // make the meter one solid color
                        break;
                    case 2:
                        opts.full = colorsTag.args[0];
                        opts.empty = colorsTag.args[1];
                        break;
                    case 3:
                        opts.full = colorsTag.args[0];
                        opts.empty = colorsTag.args[1];
                        opts.back = colorsTag.args[2];
                    default:
                        opts.full = colorsTag.args[0];
                        opts.empty = colorsTag.args[1];
                        opts.back = colorsTag.args[2];
                        opts.double = true;

                }
            }

            if (sizeTag) {
                // process the sizin tag
                if (!sizeTag.args.length) {
                    return this.error('No arguments passed to the `<<sizing>>` tag.');
                }

                opts.width = sizeTag.args[0];

                if (sizeTag.args[1]) {
                    opts.height = sizeTag.args[1];
                }

            }

            if (animTag) {
                // process the animations tag
                if (!animTag.args.length) {
                    return this.error('No arguments passed to the `<<animation>>` tag.');
                }

                if (typeof animTag.args[0] === 'boolean' && !animTag.args[0]) {
                    opts.animate = 0; // functionally no animation--we still want the event, though, so we'll just 0 it out
                } else if (typeof animTag.args[0] === 'string') {
                    opts.animate = Util.fromCssTime(animTag.args[0]);
                } else {
                    return this.error('The argument to the `<<animation>>` tag should be `true`, `false`, or a valid CSS time value.');
                }

                if (animTag.args[1] && ['swing', 'linear'].includes(animTag.args[1])) {
                    opts.easing = animTag.args[1];
                }
            }

            if (labelTag) {
                // process the label tag
                var text = labelTag.args[0];
                if (text && typeof text === 'string') {
                    opts.label = text.trim();
                } else {
                   return this.error('The labelText argument for the `<<label>>` tag is required.');
                }

                if (labelTag.args[1] && typeof labelTag.args[1] === 'string') {
                    opts.text = labelTag.args[1];
                }
                if (labelTag.args[2] && typeof labelTag.args[2] === 'string') {
                    opts.align = labelTag.args[2];
                }
            }

            Meter.add(meterName, opts, this.args[1]);

        }
    });

    // <<showmeter '$variable' [value]>>
    Macro.add('showmeter', {
        handler : function () {

            if (this.args.length < 1) {
                return this.error('This macro requires at least one argument: the meter\'s name.');
            }

            // get the meter
            var meterName = this.args[0];

            if (typeof meterName !== 'string') {
                return this.error('Invalid meter name.');
            }

            meterName = meterName.trim();

            var meter = Meter.get(meterName);

            if (!meter || !Meter.is(meter)) {
                return this.error('The meter "' + meterName + '" does not exist.');
            }

            // set the meter, if necessary
            if (typeof this.args[1] === 'number') {
                meter.val(this.args[1]);
            }

            // render the meter
            meter.place(this.output, {
                classes : 'macro-' + this.name,
                attr : { id : 'meter-' + Util.slugify(meterName) }
            });

        }
    });

    // <<updatebar '$variable' value>>
    Macro.add('updatemeter', {
        handler : function () {

            if (this.args.length < 2) {
                return this.error('This macro requires two arguments: the meter\'s name and a value.');
            }

            // get the meter
            var meterName = this.args[0];

            if (typeof meterName !== 'string') {
                return this.error('Invalid meter name.');
            }

            meterName = meterName.trim();

            var meter = Meter.get(meterName);

            if (!meter || !Meter.is(meter)) {
                return this.error('The meter "' + meterName + '" does not exist.');
            }

            // set it
            meter.val(this.args[1]); // if it's on the page, should update and animate auto-magically.

        }
    });

}());
/* twine-user-script #19: "money.js" */
function sellerToCurrency(seller) {
    switch (seller) {
        case 'hyssop':
            return 'mushrooms';
        case 'beau':
            return 'gold';
        case 'morgana':
            return 'essence';
    }
    return 'gold';
}

function validCurrency(currency) {
    return currency === 'mushrooms' || currency === 'gold' || currency === 'essence';
}

function money(currency, $output, border, amount) {
    if (!validCurrency(currency)) {
        console.error('Invalid currency: ' + currency);
        return;
    }
    if ($output !== undefined) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        if (amount === undefined) {
            amount = variables().inventory[currency];
        }
        let $money = $('<div class="currency-box"><div class="currency ' + currency + '">' + getIcon(currency) + '<span class="currency-amount">' + amount + '</span></div></div>');
        if (border)
            $money.addClass('border');
        $money.appendTo($output);
    }
    return variables().inventory[currency];
}

function changeMoney(currency, change) {
    if (isMemory())
        return;
    if (!validCurrency(currency)) {
        console.error('Invalid currency: ' + currency);
        return;
    }
    variables().inventory[currency] += parseInt(change);
    return variables().inventory[currency];
}

setup.money = money;
window.money = window.money || money;
setup.changeMoney = changeMoney;
window.changeMoney = window.changeMoney || changeMoney;

$(document).one(':passagestart', function () {
    Macro.add('money', {
        handler : function () {
            money(this.args[0], this.output, this.args[1], this.args[2]);
        }
    });

    Macro.add('changemoney', {
        handler : function () {
            changeMoney(this.args[0], this.args[1]);
        }
    });
});
/* twine-user-script #20: "names.js" */
var nobleTitles = [
    'Lord',
    'Count',
    'Baron',
    'Noble',
    'Sir',
    'Duke',
    'Earl',
    'Viscount',
    'Archduke',
    'Vizier',
    'Castellan',
    'Honorable'
]

var nobleNames = [
    'Boothmane',
    'Wolfrock',
    'Humes',
    'Rakese',
    'Bentleye',
    'Beverleye',
    'Greye',
    'Longe',
    'Bakere',
    'Ackermane',
    'Wilkersone',
    'Buckley',
    'Chadwicke',
    'Elwine',
    'Ashleye',
    'Edwardse',
    'Hawkinse',
    'Raye',
    'Tathame',
    'Caldwelle',
    'Fairburne',
    'Bradforde',
    'Haywoode',
    'Wilkinsone',
    'Wintone',
    'Elmere',
    'Fieldse',
    'Bannermane',
    'Hayes',
    'Hedleye',
    'Hayden',
    'Baxtere',
    'Bloodworthe',
    'Winthrope',
    'Combse',
    'Woodhame',
    'Rakese',
    'Homewoode',
    'Hollinse',
    'Hawke',
    'Turnbulle',
    'Aston',
    'Weste',
    'Barnete',
    'Daltone',
    'Sudworthe',
    'Boothmane',
    'Barnette',
    'Paytone'
];

var dishModifiers = [
    'Special', 'Spiced', 'Warm', 'Savory', 'Spicy', 'Home-cooked', 'Gourmet', 'Delicious', 'Grand', 'Herby', 'Comforting', 'Fragrant', 'Garnished', 'Refreshing', 'Zesty', 'Flavorful', 'Fresh', 'Smokey', 'Tangy', 'Hardy', 'Creamy', 'Decadent', 'Rich'
]

var dishIngredients = [
    'Pepper', 'Garlic', 'Feta', 'Tofu', 'Cheese', 'Stilton', 'Chilli', 'Pumpkin', 'Spinach', 'Cucumber', 'Kumquat', 'Grapefruit', 'Oregano', 'Seasalt', 'Artichoke', 'Cabbage', 'Pineapple', 'Mushroom', 'Leek', 'Daikon', 'Squash', 'Spinach', 'Jujube', 'Fennel', 'Thyme', 'Potato', 'Paneer', 'Rice', 'Stilton', 'Plantain', 'Nectarine', 'Apple', 'Cardamom', 'Orange', 'Cinnamon', 'Roquefort', 'Sage', 'Aubergine', 'Ginger', 'Peppercorn', 'Barley', 'Olive', 'Jackfruit', 'Sweet Potato', 'Chestnut', 'Strawberry', 'Caraway', 'Lemon', 'Tahini', 'Mustard', 'Thyme', 'Pear', 'Basil', 'Costmary', 'Saffron', 'Egg', 'Shallot', 'Melon', 'Beans', 'Truffle', 'Milk', 'Horseradish', 'Radish', 'Coconut Milk', 'Cheddar', 'Paprika', 'Pecan', 'Butter', 'Lettuce', 'Sweetcorn', 'Durian', 'Cauliflower', 'Mulberry', 'Lavender', 'Honey', 'Brie', 'Pesto', 'Ricotta', 'Black Pepper', 'Sprout', 'Coriander', 'Carrot', 'Broccoli', 'Onion', 'Courgette', 'Zucchini', 'Leek', 'Green Onion', 'Tomato', 'Turnip', 'Garlic', 'Beet', 'Kale', 'Endive', 'Asparagus', 'Corn', 'Peas', 'Bok Choy'
]

var dishTypes = [
    'Salad', 'Pasta', 'Soup', 'Curry', 'Burgers', 'Panini', 'Stir Fry', 'Kebab', 'Spaghetti', 'Tart', 'Pie', 'Bread', 'Crumble', 'Dumplings', 'Pizza', 'Loaf', 'Risotto', 'Casserole'
]

// dish = 1 x dishModifier + 2 x dishIngredient + 1 x dishType
// example: Slow-Cooked Garlic & Leek Curry

function generateDish() {
    let ingredient1 =  either(dishIngredients);
    let ingredient2;
    do {
        ingredient2 = either(dishIngredients);
    } while (ingredient1 === ingredient2);
    return either(dishModifiers) + ' ' + ingredient1 + ' & ' + ingredient2 + ' ' + either(dishTypes);
}


function getDish($output) {
    let dish = generateDish();
    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        var $span = $(document.createElement('span')).addClass('dish name generic');

        $span.wiki(dish);
        
        $span.on('click', function() {
            dish = generateDish();
            $span.empty().wiki(dish);
        });

        $span.appendTo($output);
    }
    return dish;
}

function generateNoble() {
    variables().noble = either(nobleTitles) + ' ' + either(nobleNames);
}

function writeUnknownName($output, name) {
    if (!($output instanceof $)) {
        $output = $($output);
    }
    var $span = $(document.createElement('span')).addClass('name generic').css('cursor', 'help');

    $span.wiki(name);
    $span.appendTo($output);
}


function getNoble($output, generate) {
    if (!variables().noble) {
        generateNoble();
    }
    let name = generate ? either(nobleTitles) + ' ' + either(nobleNames) : variables().noble;
    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        var $span = $(document.createElement('span')).addClass('name generic').css('cursor', 'help');

        $span.wiki(name);
        $span.appendTo($output);
    }
    return name;
}

setup.getNoble = getNoble;
window.getNoble = window.getNoble || getNoble;
setup.getDish = getDish;
window.getDish = window.getDish || getDish;


$(document).one(':passagestart', function () {

    Macro.add('unknownname', {
        handler : function () {
            writeUnknownName(this.output, this.args[0]);
        }
    });
    Macro.add('noble', {
        handler : function () {
            getNoble(this.output, this.args[0]);
        }
    });
    
    Macro.add('generatenoble', {
        handler : function () {
            generateNoble();
        }
    });
    Macro.add('dish', {
        handler : function () {
            getDish(this.output);
        }
    });
});

/* twine-user-script #21: "notify.js" */
(function () {
    // notify.js, by chapel; for sugarcube 2
    // version 1.1.1
    // requires notify.css / notify.min.css

    var DEFAULT_TIME = 2000; // default notification time (in MS)

    var isCssTime = /\d+m?s$/;

    var timeoutID;

    $(document.body).append("<div id='notify'></div>");
    $(document).on(':notify', function (ev) {
        if (ev.message && typeof ev.message === 'string') {
            // trim message
            ev.message.trim();
            // classes
            if (ev.class) {
                if (typeof ev.class === 'string') {
                    ev.class = 'open macro-notify ' + ev.class;
                } else if (Array.isArray(ev.class)) {
                    ev.class = 'open macro-notify ' + ev.class.join(' ');
                } else {
                    ev.class = 'open macro-notify';
                }
            } else {
                ev.class = 'open macro-notify';
            }
            
            // delay
            if (ev.delay) {
                if (typeof ev.delay !== 'number') {
                    ev.delay = Number(ev.delay);
                }
                if (Number.isNaN(ev.delay)) {
                    ev.delay = DEFAULT_TIME;
                }
            } else {
                ev.delay = DEFAULT_TIME;
            }

            var text = '<span>' + ev.message + '</span>';

            
            if (ev.prefix !== undefined) {
                text = ev.prefix + text;
            }
            $('#notify')
                .empty()
                .wiki(text)
                .addClass(ev.class);

            clearTimeout(timeoutID);
                    
            timeoutID = setTimeout(function () {
                var n = $('#notify');
                var stowed = n.hasClass('stowed');
                n.removeClass();
                if (stowed)
                    n.addClass('stowed');
            }, ev.delay);
        }
    });

    function notify (message, time, classes, prefix) {
        if (typeof message !== 'string') {
            return;
        }

        if (typeof time !== 'number') {
            time = false;
        }

        $(document).trigger({
            type    : ':notify',
            message : message,
            delay   : time,
            class   : classes || '',
            prefix  : prefix
        });
    }

    // <<notify delay 'classes'>> message <</notify>>
    Macro.add('notify', {
           tags : null,
        handler : function () {
            
            // set up
            var msg     = this.payload[0].contents, 
                time    = false, 
                classes = false, i;
            
            // arguments
            if (this.args.length > 0) {
                var cssTime = isCssTime.test(this.args[0]);
                if (typeof this.args[0] === 'number' || cssTime) {
                    time    = cssTime ? Util.fromCssTime(this.args[0]) : this.args[0];
                    classes = (this.args.length > 1) ? this.args.slice(1).flatten() : false;
                } else {
                    classes = this.args.flatten().join(' ');
                }
            }
            
            // fire event
            notify(msg, time, classes);
            
        }
    });

    setup.notify = notify;
}());
/* twine-user-script #22: "popup.js" */
function popupBox(content) {
    let $span = $('<span class="popup-description"></span>').wiki(content);
    return $span;
}

function statPopupBox(stat, amount) {
    let $img = $(getIcon(stat)).addClass('stat-popup-image');
    let text = 'Requires ' + stat;
    if (isLeveledStat(stat)) {
        text += ' level ' + amount + '.';
    } else {
        text += ' ' + amount + '.';
    }
    let $span = $('<span class="popup-description"></span>').wiki(text);
    return $img.add($span);
}

function characterPopupBox(characterId) {
    let portrait = getPortrait(characterId);
    let character = getCharacter(characterId);
    let $img = $('<img class="character-popup-image" src="' + portrait + '">');
    if (character.blurred)
        $img.addClass('blurred');
    let $name = $('<h4 class="character-popup-name" class="' + characterId + '"></h4>').wiki(character.name);
    let $span = $('<span class="character-popup-description" class="' +characterId + '"></span>').wiki(character.description);
    return $img.add($name).add($span);
}

function mapPopupBox(area) {
    let characters = getCharactersForMap(area);
    let $name = $('<h4 class="map-popup-name"></h4>').wiki(area);
    let $content = $name;
    if (area === 'Magic Circle' && variables().artifacts.chalk.location) {
        $content = $content.add($('<span></span>').wiki('To ' + variables().artifacts.chalk.location));
    }
    if (characters.length > 0) {
        let $ul = $('<ul class="map-popup-description"></ul>');
        for (let i = 0; i < characters.length; i++) {
            let character = characters[i];
            // if (!character.primary)
            //     continue;
            let $li = $('<li></li>').wiki('<span class="' + character.id + '">' + character.name + '</span>');
            $li.appendTo($ul);
        }
        $content = $content.add($ul);
    }
    return $content;
}

function setupPopup($element, contentFunc, touch, classes, autoWidth, click) {
    let options = { class: classes };
    if (autoWidth)
        options.width = 'auto';
    if (click)
        options.click = true;
    $element.on('mouseenter', function () {
        nhpup.popup(contentFunc(), $element, options);
    })

    if (touch) {
        $element.on('touchend', function(e) {
            let a = $(this).closest('a');
            if (a.length && !a.attr('disabled'))
                return;
            if (e.cancelable) {
                e.preventDefault();
                e.stopPropagation();
                dialogPopup(contentFunc(), classes);
            }
        });
    }
}




function popup($element, content) {
    setupPopup($element, function() { return popupBox(content) }, true, '', true);
}
  
function statPopup($element, stat, amount) {
    let classes = 'stat-popup';

    setupPopup($element, function() { return statPopupBox(stat, amount)}, true, classes, true);
}

function characterPopup($element, characterId) {
    let classes = characterId + ' say-box character-popup';

    setupPopup($element, function() { return characterPopupBox(characterId)}, true, classes);
}

function mapPopup($element, area) {
    let classes = 'map-popup';

    setupPopup($element, function() { return mapPopupBox(area)}, false, classes, true, true);
}

function hidePopup() {
    nhpup.hide();
    Dialog.close();
}

function dialogPopup(content, classes) {
    Dialog.setup('', classes ? classes : '');
    Dialog.append(content);
    Dialog.open();
    $('#ui-dialog-titlebar').css('display', 'none');
    $('#ui-dialog-body').on('touchend', function(e) {
        // e.preventDefault();
        Dialog.close();
        $(this).off('touchend');
    });
}




setup.popup = popup;
window.popup = window.popup || popup;
setup.statPopup = statPopup;
window.statPopup = window.statPopup || statPopup;
setup.characterPopup = characterPopup;
window.characterPopup = window.characterPopup || characterPopup;
setup.mapPopup = mapPopup;
window.mapPopup = window.mapPopup || mapPopup;
setup.hidePopup = hidePopup;
window.hidePopup = window.hidePopup || hidePopup;


$(document).one(':passagestart', function () {
    Macro.add('popup', {
        tags : null,
        handler : function () {
            let $wrapper = $(document.createElement('div')).wiki(this.payload[0].contents);
            popup($wrapper, this.args[0]);
            $(this.output).append($wrapper);
        }
    });
});
/* twine-user-script #23: "quest.js" */
setup.quests = {
    'introduction': 'Meet the council.',
    'meet-morgana': 'Meet ?Morgana in the library at noon or in the evening.',
    'morgana-ointment-garden': 'Meet ?Morgana in the castle garden in the morning.',
    'morgana-ointment': [
        'Apply the magical ointment before taking a bath in the morning. (0/3)',
        'Apply the magical ointment before taking a bath in the morning. (1/3)',
        'Apply the magical ointment before taking a bath in the morning. (2/3)',
        'Go to ?Morgana to talk about the ointment.'
    ],
    'morgana-bedroom': 'Wait for ?Morgana to visit you in your bedroom at night.',
    'morgana-potion': 'Wait for ?Morgana to finish making the potion, she will visit you at night when it is done.',
    'morgana-kitchen': 'Meet with ?Morgana about her plan to go to the forest',
    'morgana-forest': 'Wait for ?Morgana to come to you in the morning and go to the forest with her.',
    'morgana-confront': 'Confront ?Morgana about the effects of the potion.',
    'level-expectation': "Get your <<if hasTag('princess')>>Princess<<else>>Princely<</if>> stats to level <<= $player.levelexpectation>> before the next council meeting on Wednesday.",
    'sybille-note': 'Go to ?Sybille in the castle dungeons.',
    'sybille-tavern': 'Find ?Sybille in the castle dungeons during the morning.',
    'retrieve-artifact': 'Go to ?Leopold to retrieve your reward: a magical artifact from the Royal Reliquary!',
    'morgana-workshop-visit': 'Wait three days and then visit ?Morgana in the workshop during the evening.',
    'wymerus-book': 'Ask ?Wymerus about the strange fighting technique described in the book.',
    'wymerus-sword': 'Bring ?sword to ?Wymerus.',
    'history-book': 'Go to the library to read more from the large history book.',
    'rosa-bouquet': 'Pick a bouquet of flowers for ?Rosa from the garden.',
    'rosa-date': 'Go to ?Rosa at noon to start your date.',
    'rosa-flowers': 'Pick three varieties of flowers for ?Rosa.',
    'rosa-date-2': 'Go to ?Rosa in the evening to start your date.',
    'tavern': [
        'Work at ?tavern during the evening. (0/7)',
        'Work at ?tavern during the evening. (1/7)',
        'Work at ?tavern during the evening. (2/7)',
        'Work at ?tavern during the evening. (3/7)',
        'Work at ?tavern during the evening. (4/7)',
        'Work at ?tavern during the evening. (5/7)',
        'Work at ?tavern during the evening. (6/7)',
        'Work at ?tavern during the evening.'
    ],
    'tavern-intro': 'Head to the tavern in the evening to start your first day of work.',
    'velma-progress': 'Talk to ?Velma about your progress at the tavern.',
    'find-poet': 'Talk to ?Rosa about the anonymous poems.',
    'find-poet-2': 'Talk to ?Sybille about the anonymous poems.',
    'kathryn-chastity-week': [
        'Stay in chastity a week long for ?Kathryn. (0/7)',
        'Stay in chastity a week long for ?Kathryn. (1/7)',
        'Stay in chastity a week long for ?Kathryn. (2/7)',
        'Stay in chastity a week long for ?Kathryn. (3/7)',
        'Stay in chastity a week long for ?Kathryn. (4/7)',
        'Stay in chastity a week long for ?Kathryn. (5/7)',
        'Stay in chastity a week long for ?Kathryn. (6/7)',
        'Go to ?Kathryn and ask to be unlocked after completing your week of chastity.'
    ],
    'find-poet-3': 'Confront ?Orson about his poems in the library during the evening.',
    'orson-date-1': 'Find ?Orson in the library during the evening to go on the date.',
    'kathryn-dinner-invitation': 'You have been invited to the dinner party ?Kathryn is hosting this evening.',
    'morgana-potion-store': 'Find ?Morgana in her tower to see her new potion.',
    'brothel-intro': 'Visit the tavern at night and tell ?Eve you want to work in the brothel.',
    'boarding-room': 'Find ?Velma in the tavern for your reward.',
    'orson-gift-quill': 'Bring your gift to ?Orson in the library during the evening.',
    'orson-date-2': 'Find ?Orson in the evening to start your tavern date.',
    'blacksmith-intro': 'Check out the Smithy in town to see what ?Beau is selling.',
    'kathryn-chastity-excursion': 'Find ?Kathryn at noon to start your excursion into town.',
    'rosa-date-3-chef': 'Ask ?ChefPepper to make dinner for your date with ?Rosa.',
    'rosa-date-3': 'Visit ?Rosa in the evening to start your date.',
    'velma-note': 'Go to ?Velma in the evening and start the plan to spy on ?Andreas.',
    'eve-give-vibrator': 'Visit ?Eve and give her the present you bought.',
    'eve-date-1': 'Go to ?Eve in the morning to start your date.',
    'interrogate-assassin': 'Go to ?Sybille in the morning and see what her next plan is.',
    'interrogate-morgana': 'Find ?Morgana.',
    'morgana-discuss-princess': 'Talk to ?Morgana about becoming a Princess.',
    'princess-lessons-intro': [
        'Wait a few days before ?Morgana visits you in the morning.',
        'Go to ?Sybille for your first lesson on comport.',
        'Visit ?Hyssop in the forest for your first lesson on fashion.',
        'Go to ?Kathryn for your first lesson on etiquette.',
        'Return to ?Morgana.'
    ],
    'princess-lessons': 'Get your Presence stats to level 1 and return to ?Morgana.',
    'become-princess': 'Announce the plan to become a Princess during the next council meeting on Wednesday.'
};

function startQuest (name) {
    if (isMemory())
        return;
    if (!name) {
        console.error('addQuest() -> invalid arguments');
        return;
    }
    variables().quests[name] = 0;
}

function hasQuest (name) {
    return (variables().quests[name] !== undefined && !hasCompletedQuest(name));
}

function hasCompletedQuest (name) {
    let value = variables().quests[name];

    if (!value)
        return false;
    if (setup.quests[name] === undefined || !Array.isArray(setup.quests[name]))
        return true;

    return value >= setup.quests[name].length;
}

function questStep (name) {
    if (isQuestUnstarted(name)) {
        return 0;
    }
    return variables().quests[name] + 1;
}

function isQuestUnstarted (name) {
    return variables().quests[name] === undefined;
}

function removeQuest (name) {
    if (isMemory())
        return;
    delete variables().quests[name];
}

function completeQuest (name, all) {
    if (isMemory())
        return;
    if (!name) {
        console.error('completeQuest() -> invalid arguments');
        return;
    }
    if (isQuestUnstarted(name))
        variables().quests[name] = 0;
    if (!hasCompletedQuest(name)) {
        if (all && setup.quests[name] !== undefined && Array.isArray(setup.quests[name])) {
            variables().quests[name] = setup.quests[name].length;
        } else {
            variables().quests[name]++;
        }

    }
}

function printGoals ($output) {
    if (!$output)
        return;
    if (!($output instanceof $)) {
        $output = $($output);
    }
    let keys = Object.keys(variables().quests);
    let quests = 0;
    for (var i = keys.length - 1; i >= 0; i--) {
        if (setup.quests[keys[i]] === undefined || hasCompletedQuest(keys[i])) {
            continue;
        }
        quests++;
        var $span = $(document.createElement('span')).addClass('goal');
        if (Array.isArray(setup.quests[keys[i]])) {
            $span.wiki(setup.quests[keys[i]][variables().quests[keys[i]]]).prepend('᛭ ').append('<br>');
        } else {
            $span.wiki(setup.quests[keys[i]]).prepend('᛭ ').append('<br>'); //options ᐈ ᛭ ᛜ ᳁ ⁕ ‣ • ⁜ ⏵
        }
        $span.appendTo($output);
    }
    if (quests === 0) {
        var $span = $(document.createElement('span')).addClass('goal');
        $span.wiki('None');
        $span.appendTo($output);
    }
}

setup.startQuest = startQuest;
window.startQuest = window.startQuest || startQuest;
setup.hasQuest = hasQuest;
window.hasQuest = window.hasQuest || hasQuest;
setup.hasCompletedQuest = hasCompletedQuest;
window.hasCompletedQuest = window.hasCompletedQuest || hasCompletedQuest;
setup.questStep = questStep;
window.questStep = window.questStep || questStep;
setup.isQuestUnstarted = isQuestUnstarted;
window.isQuestUnstarted = window.isQuestUnstarted || isQuestUnstarted;
setup.removeQuest = removeQuest;
window.removeQuest = window.removeQuest || removeQuest;

$(document).one(':passagestart', function () {

    Macro.add('startquest', {
        handler : function () {
            startQuest(this.args[0]);
        }
    });
    Macro.add(['completequest', 'advancequest'], {
        handler : function () {
            completeQuest(this.args[0], this.args[1]);
        }
    });
    Macro.add('removequest', {
        handler : function () {
            removeQuest(this.args[0]);
        }
    });
    Macro.add('printgoals', {
        handler : function () {
            printGoals(this.output);
        }
    });
});
/* twine-user-script #24: "rightsidebar.js" */
/* Create the Right UI Bar. */
var $rightUiBar = $('<div id="right-ui-bar"></div>').insertAfter("#ui-bar");

var rightTray = $rightUiBar.append('<div id="right-ui-bar-tray"><button id="right-ui-bar-toggle" tabindex="0" title="Toggle the Right UI bar" aria-label="Toggle the Right UI bar" type="button"></button></div>');

var rightBody = $rightUiBar.append('<div id="right-ui-bar-body"></div>');

var notify = $('#notify');

/* Attach the toggle button click. */
$rightUiBar.find('#right-ui-bar-toggle').ariaClick({label : "Toggle the Right UI bar"}, () => { $rightUiBar.toggleClass('stowed'), notify.toggleClass('stowed') });

/* Automatically show the contents of the StoryRightSidebar passage in the right-ui-bar-body element. */
postrender["Display Right Sidebar Contents"] = function (content, taskName) {
	setPageElement('right-ui-bar-body', 'StoryRightSidebar');
};
/* twine-user-script #25: "sins.js" */

/*
Sins (always possible to add more):
- magic
- peeping
- masturbation
- wearing-panties
- blowjob
- cum-eating
- fingered
*/


function addSin(name) {
    if (isMemory())
        return;
    if (!name) {
        console.error('addSin() -> invalid arguments');
        return;
    }
    variables().sins.pushUnique(name);
}

function removeSin(name) {
    if (isMemory())
        return;
    if (!name) {
        console.error('removeSin() -> invalid arguments');
        return;
    }
    var i = variables().sins.indexOf(name);
    if (i < 0) {
        console.error('removeSin() -> sin "' + name + '" doesn\'t exist');
        return;
    }
    variables().sins.splice(i, 1);
}

function hasSin (name) {
    return variables().sins.includes(name);
}

function hasSins () {
    return variables().sins.length > 0;
}

function listSins ($output) {
    if (!$output)
        return;
    if (!($output instanceof $)) {
        $output = $($output);
    }

    for (let i = 0; i < variables().sins.length; i++) {
        let sin = variables().sins[i];
        let $link = $(document.createElement('span'));
        let passage = 'Sin ' + sin;
        if (!Story.has(passage)) 
            continue;

        $link.wiki('<<decision "' + sin.toUpperFirst() + '" "Sin ' + sin + '">><<removesin "' + sin + '">><</decision>>');

        $link.appendTo($output);
    }
}

setup.hasSin = hasSin;
window.hasSin = window.hasSin || hasSin;
setup.hasSins = hasSins;
window.hasSins = window.hasSins || hasSins;


$(document).one(':passagestart', function () {

    Macro.add('listsins', {
        handler : function () {
            listSins(this.output);
        }
    });
    Macro.add('addsin', {
        handler : function () {
            addSin(this.args[0]);
        }
    });
    Macro.add('hassin', {
        handler : function () {
            hasSin(this.args[0]);
        }
    });
    Macro.add('removesin', {
        handler : function () {
            removeSin(this.args[0]);
        }
    });

});
/* twine-user-script #26: "sound.js" */
var lastArea = '';
var musicOnPassage = true;
var focus = true;

// function changeAreaMusic(newArea, oldArea) {
//     if (settings.sound && settings.musicVolume > 0 && newArea !== "") {
//         let newTrack = SimpleAudio.tracks.get(newArea + "_music");
//         if (oldArea !== "") {
//             let oldTrack = SimpleAudio.tracks.get(oldArea + "_music");
//             oldTrack.fadeOut(1);
//             setTimeout(function() {
//                 oldTrack.stop();
//                 playTrack(newTrack, true);
//             }, 1000);
//         } else {
//             playTrack(newTrack, true);
//         }
//     }
// }

function updateMusic(locationUpdate) {
    let area = getArea(true);
    if (area === '' && lastArea === '') {
        return;
    }
    let track = SimpleAudio.tracks.get((area !== '' ? area : lastArea) + "_music");
    let shouldPlay = focus && musicOnPassage && area !== '' && settings.sound && settings.musicVolume > 0;
    if (!track.isPlaying() && shouldPlay) {
        if (lastArea !== '' && lastArea !== area) {
            let oldTrack = SimpleAudio.tracks.get(lastArea + "_music");
            oldTrack.fade(0.5, 0, settings.musicVolume);
            setTimeout(function() {
                oldTrack.pause();
                playTrack(track, true);
            }, 500);
        } else {
            playTrack(track, true);
        }
    } else if (track.isPlaying() && !shouldPlay) {
        track.fade(0.5, 0, settings.musicVolume);
        setTimeout(function() {
            track.pause();
        }, 500);
    } else if (!locationUpdate) {
        track.volume(settings.musicVolume);
    }
    lastArea = area;
}

function playTrack(track, fade) {
    track.play();
    if (fade) {
        track.fade(0.5, settings.musicVolume, 0);
    } else {
        track.volume(settings.musicVolume);
    }
    track.loop(true);
}

function toggleSound() {
    settings.sound = !settings.sound;
    Setting.save();
    updateVideos();
    updateMusic();
    $('.sound-button button span').toggleClass('volume-mute').toggleClass('volume-up');
}

$(document).one(':passagestart', function () {
    Macro.add('togglesound', {
        handler : toggleSound
    });
    Macro.add('disablemusic', {
        handler : function() {
            musicOnPassage = false;
        }
    });
});

$(document).on(':passagestart', function (ev) {
    musicOnPassage = true;
});
$(document).on(':passageend', function (ev) {
    updateMusic(true);
});

$(window).on('focus', function (ev) {
    focus = true;
    updateMusic();
});
$(window).on('blur', function (ev) {
    focus = false;
    updateMusic();
});
/* twine-user-script #27: "stats.js" */
const levelExp = 3;

function statVar(stat) {
    stat = stat.toLowerCase();
    switch (stat) {
        case 'decency':
        case 'virtue':
        case 'depravity':
            return 'decency';
        case 'control':
        case 'dominance':
        case 'submissiveness':
            return 'control';
        case 'gender':
        case 'masculinity':
        case 'femininity':
            return 'gender';
        case 'statesmanship':
        case 'swordsmanship':
        case 'stewardship':
        case 'comport':
        case 'fashion':
        case 'etiquette':
            return stat;
    }
    console.error('statVar() -> stat "' + stat + '" does not exist');
}

function isStat(stat) {
    switch (stat) {
        case 'decency':
        case 'virtue':
        case 'depravity':
        case 'decency':
        case 'control':
        case 'dominance':
        case 'submissiveness':
        case 'control':
        case 'gender':
        case 'masculinity':
        case 'femininity':
        case 'gender':
        case 'statesmanship':
        case 'swordsmanship':
        case 'stewardship':
        case 'comport':
        case 'fashion':
        case 'etiquette':
            return true;
    }
    return false;
}

function isKingdomStat(stat) {
    switch (stat) {
        case 'stability':
        case 'authority':
        case 'treasury':
        case 'whispers':
        case 'welfare':
            return true;
    }
    return false;
}

function isLeveledStat(stat) {
    switch (stat) {
        case 'statesmanship':
        case 'swordsmanship':
        case 'stewardship':
        case 'comport':
        case 'fashion':
        case 'etiquette':
            return true;
    }
    return false;
}

function isPositive(stat) {
    switch(stat) {
        case 'depravity':
        case 'submissiveness':
        case 'femininity':
            return false;
    }
    return true;
}

function isDualStat(stat) {
    switch (stat) {
        case 'decency':
        case 'virtue':
        case 'depravity':
        case 'control':
        case 'dominance':
        case 'submissiveness':
        case 'gender':
        case 'masculinity':
        case 'femininity':
            return true;
    }
    return false;
}

function statName(stat, positive) {
    switch (stat) {
        case 'decency':
            return positive ? 'virtue' : 'depravity';
        case 'control':
            return positive ? 'dominance' : 'submissiveness';
        case 'gender':
            return positive ? 'masculinity' : 'femininity';
    }
    return stat;
}

function changeStat($output, stat, amount, addText, silent) {
    if (isMemory())
        return;
    if (amount === 0)
        return;
    if (isKingdomStat(stat)) {
        changeKingdomStat(stat, amount);
        return;
    }
    if (isNaN(amount)) {
        if (amount === 'small') {
            amount = 1;
        } else if (amount === 'medium') {
            amount = 3;
        } else if (amount === 'large') {
            amount = 5;
        } else if (amount === 'huge') {
            amount = 10;
        } else {
            amount = variables()[amount];
        }
    }

    // if (!silent) {
    //     if (current >= 100 && amount > 0) {
    //         return;
    //     }
    //     if (((dualStat && current <= -100) || (!dualStat && current <= 0)) && amount < 0) {
    //         return;
    //     }
    // }

    let result = getStat(stat, true) + amount;
    
    if (!isPositive(stat))
        result *= -1;

    // if (dualStat)
    //     result = clamp(result, -100, 100);
    // else
    //     result = clamp(result, 0, 100);

    setStat(stat, result);

    if (silent)
        return;

    let name = statName(stat, amount > 0);
    let text = name.toUpperFirst();

    let dualStat = isDualStat(stat);
    
    if (dualStat)
        text += ' increased';
    else
        text += (amount > 0 ? ' increased' : ' decreased');
    if (isLeveledStat(stat)) {
        if (Math.abs(amount) > 1) {
            text += ' significantly!';
        }
    } else {
        if (Math.abs(amount) >= 10) {
            text += ' significantly!';
        } else if (Math.abs(amount) < 3) {
            text += ' slightly';
        }
    }
    // if (dualStat)
    //     text = name.toUpperFirst() + ' increased by ' + Math.abs(amount);
    // else
    //     text = name.toUpperFirst() + (amount > 0 ? ' increased' : ' decreased') + ' by ' + Math.abs(amount);

    if (!dualStat) {
        $('.icon.level.' + stat).each(function () {
            $(this).text(getStatLevel(stat));
        });
    }
    if (!addText) {
        setup.notify(text, 3000, name, getIcon(name));
        return;
    }
    
    let $span = $(document.createElement('span')).addClass('notification');
    $span.addClass(name);
    $span.wiki(text);

    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $span.appendTo($output);
    }
}

function resetStat($output, stat, addText) {
    if (isMemory())
        return;
    setStat(stat, 0);
    
    let $span = $(document.createElement('span')).addClass('notification');

    let name = statName(stat, true);
    $span.addClass(name);

    $span.wiki(name.toUpperFirst() + ' reset.');


    if (addText !== false && $output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $span.appendTo($output);
    }
}

function changeRelation($output, character, amount) {
    if (isMemory())
        return;
    if (!Object.hasOwn(variables().relations, character)) {
        console.error('changeRelation() -> character "' + character + '" does not exist');
        return;
    }
    let result = variables().relations[character] + amount;
    result = clamp(result, -100, 100);
    variables().relations[character] = result;

    let $span = $(document.createElement('span')).addClass('notification');
    if (amount > 0) 
        $span.addClass('positive');
    else
        $span.addClass('negative');

    
    $span.wiki('Relation with ' + character.toUpperFirst() + ' ' + (amount > 0 ? 'increased' : 'decreased') + ' by ' + Math.abs(amount) + '.');

    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $span.appendTo($output);
    }
}

function setStat(stat, value) {
    if (isMemory())
        return;
    stat = statVar(stat);
    variables().player[stat] = value;
    if (Meter.has(stat))
        Meter.get(stat).val(getStatFraction(stat));
    if (stat === "gender")
        updatePlayerGender();
}

function getStat(stat, noClamp) {
    let result = variables().player[statVar(stat)];
    if (!isPositive(stat))
        result *= -1;

    if (!noClamp) {
        if (isDualStat(stat))
            result = clamp(result, -100, 100);
        else
            result = clamp(result, 0, 100);
    }
    return result;
}

function hasStatAmount(stat, amount) {
    if (isLeveledStat(stat)) {
        return getStatLevel(stat) >= amount;
    }
    return getStat(stat) >= amount;
}

function getStatFraction(stat) {
    if (isDualStat(stat)) {
        return (100 + getStat(stat)) / 200;
    }
    if (isLeveledStat(stat)) {
        return getStat(stat) % levelExp / levelExp;
    }
    return getStat(stat) / 100;
}

function getStatLevel(stat) {
    if (!isLeveledStat(stat)) {
        console.error("getStatLevel() -> " + stat + " is not a leveled stat.");
        return;
    }
    return Math.floor(getStat(stat) / levelExp);
}

function getRelation(character) {
    if (!Object.hasOwn(variables().relations, character)) {
        console.error('changeRelation() -> character "' + character + '" does not exist');
        return;
    }

    return variables().relations[character];
}


setup.isStat = isStat;
window.isStat = window.isStat || isStat;
setup.isLeveledStat = isLeveledStat;
window.isLeveledStat = window.isLeveledStat || isLeveledStat;
setup.isKingdomStat = isKingdomStat;
window.isKingdomStat = window.isKingdomStat || isKingdomStat;
setup.getStat = getStat;
window.getStat = window.getStat || getStat;
setup.getStatFraction = getStatFraction;
window.getStatFraction = window.getStatFraction || getStatFraction;
setup.getStatLevel = getStatLevel;
window.getStatLevel = window.getStatLevel || getStatLevel;
setup.getRelation = getRelation;
window.getRelation = window.getRelation || getRelation;
setup.getIcon = getIcon;
window.getIcon = window.getIcon || getIcon;
setup.getStatLevel = getStatLevel;
window.getStatLevel = window.getStatLevel || getStatLevel;
setup.hasStatAmount = hasStatAmount;
window.hasStatAmount = window.hasStatAmount || hasStatAmount;



$(document).one(':passagestart', function () {
    Macro.add('resetstat', {
        handler : function () {
            resetStat(this.output, this.args[0], this.args[1]);
        }
    });
    Macro.add('changestat', {
        handler : function () {
            changeStat(this.output, this.args[0], this.args[1], this.args[2]);
        }
    });

    Macro.add('changerelation', {
        handler : function () {
            changeRelation(this.output, this.args[0], this.args[1]);
        }
    });
    
    Macro.add('getstat', {
        handler : function () {
            getStat(this.args[0]);
        }
    });
    
    Macro.add('getrelation', {
        handler : function () {
            getRelation(this.args[0]);
        }
    });
});
/* twine-user-script #28: "tags.js" */
function addTag(name) {
    if (isMemory())
        return;
    if (!name) {
        console.error('addTag() -> invalid arguments');
        return;
    }
    variables().tags.pushUnique(name);
}

function removeTag(name) {
    if (isMemory())
        return;
    if (!name) {
        console.error('removeTag() -> invalid arguments');
        return;
    }
    var i = variables().tags.indexOf(name);
    if (i < 0) {
        console.error('removeTag() -> tag "' + name + '" doesn\'t exist');
        return;
    }
    variables().tags.splice(i, 1);
}

function hasTag (name) {
    return variables().tags.includes(name);
}

setup.hasTag = hasTag;
window.hasTag = window.hasTag || hasTag;

$(document).one(':passagestart', function () {
    Macro.add('addtag', {
        handler : function () {
            addTag(this.args[0]);
        }
    });
    Macro.add('hastag', {
        handler : function () {
            hasTag(this.args[0]);
        }
    });
    Macro.add('removetag', {
        handler : function () {
            removeTag(this.args[0]);
        }
    });
});
/* twine-user-script #29: "ui.js" */
var leftClosed = false;
var rightClosed = false;

function togglesidebars() {
    $('#ui-bar').toggleClass('stowed');
    $('#right-ui-bar').toggleClass('stowed');
    $('#notify').toggleClass('stowed');
}

function stowsidebars(cache) {
    if (cache) {
        leftClosed = $('#ui-bar').hasClass('stowed');
        rightClosed = $('#right-ui-bar').hasClass('stowed');
    }
    $('#ui-bar').addClass('stowed');
    $('#right-ui-bar').addClass('stowed');
    $('#notify').addClass('stowed');
}

function showsidebars(cache) {
    if (cache) {
        if (!leftClosed) {
            $('#ui-bar').removeClass('stowed');
        }
        if (!rightClosed) {
            $('#right-ui-bar').removeClass('stowed');
            $('#notify').removeClass('stowed');
        }
        return;
    }
    $('#ui-bar').removeClass('stowed');
    $('#right-ui-bar').removeClass('stowed');
    $('#notify').removeClass('stowed');
}


$(document).one(':passagestart', function () {
    Macro.add('togglesidebars', {
        handler : function () {
            togglesidebars();
        }
    });
    Macro.add('stowsidebars', {
        handler : function () {
            stowsidebars(this.args[0]);
        }
    });
    Macro.add('showsidebars', {
        handler : function () {
            showsidebars(this.args[0]);
        }
    });
});
/* twine-user-script #30: "visuals.js" */
var ref;
var colorFrom;
var timePassed = 0;
var lastTime;
var colorTo;
var duration = 2;
var reverse = false;
var charmed = false;

// extract numeric r, g, b values from `rgb(nn, nn, nn)` string
function getRgb(color) {
    let [r, g, b] = color.replace('rgb(', '')
      .replace(')', '')
      .split(',')
      .map(str => Number(str));;
    return {
        r,
        g,
        b
    }
}

function getRgbNoA(color) {
    let colors = color.replace('rgba(', '')
      .replace(')', '')
      .split(',');
    colors.pop();
    let [r, g, b] = colors.map(str => Number(str));
    return {
        r,
        g,
        b
    }
}

function flashEffect(color, time) {
    $(":root").css("--magic-color", color ? color : "rgba(67, 14, 110, 0.5)");
    $(":root").css("--magic-visibility", "inherit");
    $(":root").css("--magic-time", time ? (time / 1000) + 's' : "0.6s");
    setTimeout(function() {
        $(":root").css("--magic-visibility", "none");
    }, time ? time * 2 : 1200);
}

function charmEffect (on, color) {
    if (on === undefined || on === 'on') {
        variables().effects.pushUnique('charmed');
        charmed = true;
        $(":root").css("--magic-color", color ? color : "rgba(67, 14, 110, 0.5)");
        $(":root").css("--magic-visibility", "inherit");
        $(":root").css("--magic-time", "2s");
        setTimeout(function() {
            colorFrom = getRgb($(":root").css("--theme-color"));
            colorTo = getRgbNoA(color ? color : "rgba(67, 14, 110, 0.5)");
            ref = requestAnimationFrame(charmFrame);
        }, 10);
    } else {
        console.log('charm off');
        let index = variables().effects.indexOf('charmed');
        if (index > -1) {
            variables().effects.splice(index, 1);
        }
        charmed = false;
        $(":root").css("--magic-visibility", "none");
        $(":root").css("--theme-color", '');
        cancelAnimationFrame(ref);
    }
}

  
function colorInterpolate(rgbA, rgbB, intval) {
    const colorVal = (prop) =>
        Math.round(rgbA[prop] * (1 - intval) + rgbB[prop] * intval);
    return {
        r: colorVal('r'),
        g: colorVal('g'),
        b: colorVal('b'),
    }
}

function charmFrame(now) {
    if (lastTime) {
        if ( (now - lastTime) < 100) {
            ref = requestAnimationFrame(charmFrame);
            return;
        }
        timePassed += (now - lastTime);
    }
    lastTime = now;
    while (timePassed > 2000) {
        timePassed -= 2000;
        reverse = !reverse;
    }
    let fraction = timePassed/2000;
    if (reverse) {
        fraction = 1 - fraction;
    }
    let x = colorInterpolate(colorFrom, colorTo, fraction);
    $(":root").css("--theme-color", 'rgb(' + x.r + ', ' + x.g + ', ' + x.b + ')');
    ref = requestAnimationFrame(charmFrame);
}

setup.charmEffect = charmEffect;
window.charmEffect = window.charmEffect || charmEffect;
setup.flashEffect = flashEffect;
window.flashEffect = window.flashEffect || flashEffect;

$(document).one(':passagestart', function () {

    Macro.add('effect', {
        handler : function () {
            switch(this.args[0]) {
                case 'charm':
                    charmEffect(this.args[1], this.args[2]);
                    return;
                case 'flash':
                    flashEffect(this.args[1], this.args[2]);
                    return;
            }
        }
    });
});

$(document).on(':passagestart', function () {
    if (charmed !== variables().effects.includes('charmed')) {
        if (variables().effects.includes('charmed')) {
            charmEffect('on')
        } else {
            charmEffect('off')
        }
    }
});
/* twine-user-script #31: "main.js" */
// Config.passages.nobr = true;
Config.history.maxStates = 30;

setup.cheats = false;
setup.patreonLink = true;
setup.newVersion = "0.3.4";

$(document.head).append('<link rel="icon" href="favicon.png">');

// Enable hover for mobile
// $('body').on('touchstart', function() {});


function updatePlayerGender() {
	var playerBlue = "#000080";
	var playerPink = "#b000b5";
	var gender = getStatFraction('gender');
	var color = blendColors(playerPink, playerBlue, gender);
	var outline = (gender < 0.3) ? 0.3 : 0;
	// var outline = clamp(0.5 - gender, 0, 0.5);

	// $(":root")[0].style.setProperty("--title-s-size", lerp(25, 8, gender) + 'px');
	// $(":root")[0].style.setProperty("--title-s-y", lerp(0, -19, gender) + 'px');
	$(":root")[0].style.setProperty("--title-color", hasTag('princess') ? playerPink : playerBlue );
	$(":root")[0].style.setProperty("--player-color", color);
	// $(":root")[0].style.setProperty("--player-outline", 'rgba(0, 0, 0, ' + outline + ')');
}

function updateThemeColors() {
	let area = getArea(true);
	
	$('html').attr("theme", area ? area : "castle");
}

function displayChapter() {
	let delay = variables().chapter === 4 ? 4000 : 500;
	new Vara("#chapter-container","https://raw.githubusercontent.com/akzhy/Vara/master/fonts/Parisienne/Parisienne.json",[{
		text: variables().chaptertitle,
		strokeWidth: 1.8,
		textAlign: "center",
		duration: 1500,
		letterSpacing: -8,
		autoAnimation:true,
		delay: delay,
		fontSize:64
	}]);
}

function updateTitle() {
	if (hasTag('princess')) {
		$("title").text("A Princess Tale");
	} else {
		$("title").text("A Prince's Tale");
	}
}

Config.passages.onProcess = function (p) {
	if (!p.tags.includes('br')) {
		return p.text.replace(/\n/g, " ");
	}
	return p.text;
};

$(document).on(':passagestart', function (ev) {
	if (ev.passage.tags.includes("location")) {
		setLocation(ev.passage.title);
	}

	hidePopup();
});

function generateHeader(passage) {
	let locationDiv = $('<div id="passage-header" class="passage-block"></div>');
	let title = passage.attr('data-passage');
	let locationDescription = $('<p id="location-description"></p>')

	if (!tags().includes("no-location")) {
		let location = getLocation();
		locationDescription.wiki(location.description).prependTo(locationDiv);
		if (tags().includes("location")) {
			if (variables().artifacts.chalk.unlocked) {
				if (variables().artifacts.chalk.drawing) {
					if (location.title !== "Bedroom") {
						passage.wiki("<<decision 'Draw a second circle in this location'>><<include 'Draw Magic Circle'>><<decisionicon magic_circle>><</decision>>");
					}
				} else if (variables().artifacts.chalk.location) {
					if (variables().artifacts.chalk.location === location.title) {
						passage.wiki("<<decision 'Use the teleportation circle to your bedroom'>><<include 'Use Magic Circle'>><<decisionicon magic_circle>><</decision>>");
					}
				}
			}
			if (Object.hasOwn(location, 'decisions')) {
				let decisions = $('<div id="location-options"></div>').wiki(location.decisions);
				decisions.appendTo(passage);
			}
			if (getAreaExit(location.area) === location.title && Story.has('Leave ' + location.area)) {
				let exit = $('<div id="exit-options"></div>').wiki(Story.get('Leave ' + location.area).processText());
				exit.appendTo(passage);
			}
		} else if (location) {
			title = location.title;
		}
	
		if (visited(title) > 1) {
			locationDescription.addClass('hidden');
		}

		if (title) {
			var img = $('<img id="location-image" src="' + getLocationImage(title) + '" alt="' + title + '">');
			if (location.description && location.description.length > 0) {
				img.addClass('clickable');
				img.bind('click', function () {
					locationDescription.toggleClass('hidden');
				});
			}
			img.prependTo(locationDiv);
		}

		if (!tags().includes("no-title")) {
			let h2 = $('<h2 class="location-title"><span>' + title + '</span></h2>');
			h2.prependTo(locationDiv);
		}

		if (passage.find('#passage-header').length) {
			passage.find('#passage-header').replaceWith(locationDiv);
		} else {
			locationDiv.prependTo(passage);
		}
	}
}

$(document).on(':passagedisplay', function (ev) {
	if (settings.debug) {
		console.log("> DEBUG ZONE");
		console.log(">> VARIABLES");
		console.log(variables());
		console.log(">> SETUP");
		console.log(setup);
		console.log(">> SETTINGS");
		console.log(settings);
	}

	var passage = $('#passages .passage');

	if (tags().includes("location")) {
		passage.empty();
	}

	var background = $('<div class="passage-background"></div>');
	background.prependTo(passage);
	
	generateHeader(passage);
	
	var chars = getCharacters(passage.attr('data-passage'));
	for (var c = 0; c < chars.length; c++) {
		var name = chars[c].id.toUpperFirst();
		$('<div id="character"></div>').wiki(Story.get(name).processText()).appendTo(passage);
	}
	
	
	updatePlayerGender();
	updateThemeColors();
});

$(document).on(":passageend", function (ev) {
	updateTitle();

	if ($("#chapter-container").length) {
		setTimeout(displayChapter, 200);
	}
	
});

$(document).keypress(function(e) {
	if (e.which >= 49 && e.which < 59) {
		$("#passages").find("a.link-internal").each(function(index, a) {
			if (e.which == index + 49) {
				a.click();
			}
		});
	}
});

setup.generateHeader = generateHeader;
window.generateHeader = window.generateHeader || generateHeader;

// $(document).on(':uiupdate', function (ev) {
	
// });

setTimeout(updateTitle, 250);

$(window).scroll(function() {
    $('video:not(.no-autoplay)').each(function() {
        if (isScrolledIntoView($(this))) {
			$(this)[0].muted = !settings.sound;
			$(this)[0].volume = settings.videoVolume;
            $(this)[0].play();
        } else {
            $(this)[0].pause();
        }
    });
});
/* twine-user-script #32: "maps.js" */
(function () {
    function initMap(img, $map) {
        if (! $map.length) return;

        let $img = $(img);

        const $areas = $map.find('area');
        const coords = [];
        const centers = [];
        var tokenWidth = 144;

        $areas.each( function (ev) {
            coords.push($(this).attr('coords'));
            centers.push($(this).attr('center'));
        });

        function recalcCoords() {
            const wRatio = $img.width() / img.naturalWidth;
            const hRatio = $img.height() / img.naturalHeight;

            tokenWidth = wRatio * Number(144);

            $areas.each( function (index, area) {
                let c = coords[index].split(',');
                for (let i = 0; i < c.length; ++i) {
                    if (i % 2) {
                        c[i] = Math.trunc(hRatio * Number(c[i]));
                    } else {
                        c[i] = Math.trunc(wRatio * Number(c[i]));
                    }
                }
                if (centers[index]) {
                    let center = centers[index].split(',');
                    center[0] = Math.trunc(hRatio * Number(center[0]));
                    center[1] = Math.trunc(wRatio * Number(center[1]));

                    $(area).attr('center', center.join(','));
                }

                $(area).attr('coords', c.join(','));
            });
        }

        function printAreaCenter(name, coords) {
            let c = coords.split(',');
            let xMax, xMin, yMax, yMin;
            for (let i = 0; i < c.length; ++i) {
                let xy = Number(c[i]);
                if (i % 2) {
                    if (yMax === undefined || xy > yMax)
                        yMax = xy;
                    if (yMin === undefined || xy < yMin)
                        yMin = xy;
                } else {
                    if (xMax === undefined || xy > xMax)
                        xMax = xy;
                    if (xMin === undefined || xy < xMin)
                        xMin = xy;
                }
            }
            console.log(name + ': ' + ((xMin + xMax)/2) + ',' + ((yMin + yMax)/2))
        }

        function addHighlights() {
            // Apply maphilight to all images that have a usemap attribute, e.g.
            // all the maps that are in this twine. This sets the default styling
            // for all the maps. These are all the possible styling options.
            // Note: for picking colors, check out http://hslpicker.com/. You can
            // copy the HEX value as long as you leave off the "#".
            
            let color = rgbToHex($(":root").css("--theme-color")).replace('#', '');
            let lightColor = blendColors(color, '#ffffff', 0.5).replace('#', '');

            $("img[usemap]").maphilight({
                fill: true,             	// Fill the area?
                fillColor: color,    	// HEX format without the starting "#"
                fillOpacity: 0.5,       	// Opacity of the filled area
                stroke: true,           	// Outline the area?
                strokeColor: lightColor,
                strokeOpacity: 1,
                strokeWidth: 3,			// Outline width
                fade: true,             	// Animate when hovered with a fade?
                alwaysOn: false,        	// Always show the areas?
                neverOn: false,
                groupBy: false,
                wrapClass: true,
                shadow: false,
                shadowX: 0,
                shadowY: 0,
                shadowRadius: 6,
                shadowColor: '000000',
                shadowOpacity: 0.8,
                shadowPosition: 'outside',
                shadowFrom: false
            });

            let playerColor = $(":root").css("--player-color").replace('#', '');
            let lightPlayerColor = blendColors(playerColor, '#ffffff', 0.5).replace('#', '');
    
            let closed = variables().lockedlocations;
            let location = getLocation().title;

            $areas.each( function (ev) {
                let name = $(this).attr('data-passage');
                if (closed.includes(name)) {
                    $(this).addClass('closed');
                    $(this).data("maphilight", {
                        neverOn: true
                    });
                    $(this).off('click');
                } else if (name === location) {
                    $(this).addClass('closed');
                    $(this).off('click');
                    $(this).data("maphilight", {
                        fillColor: lightPlayerColor,
                        fillOpacity: 0.2,
                        // strokeWidth: 5,
                        strokeColor: playerColor,
                        alwaysOn: true
                    }).trigger('alwaysOn.maphilight');
                } else {
                    mapPopup($(this), name);
                }
            });
        }

        function addToken(character, x, y) {
            var $portrait = $('<img src="' + getPortrait(character) + '" style="width:' + tokenWidth + 'px;left:' + x + 'px;top:' + y + 'px;">');
            $portrait.addClass('themed portrait token ' + character);
            $portrait.attr('character', character);
            $portrait.insertAfter($img);
        }

        function addCharacters() {
            for (let i = 0; i < $areas.length; i++) {
                let area = $($areas[i]);
                let name = area.attr('data-passage');
                if (!area.attr('center'))
                    continue;
                let vertical = area.attr('vertical');
                let center = area.attr('center').split(',');

                let characters = getCharactersForMap(name);

                let characterIDs = [];
                for (let j = 0; j < characters.length; j++) {
                    if (getLocation().title === name && !characters[j]['primary']) {
                        continue;
                    }
                    characterIDs.push(characters[j].id);
                }
                if (getLocation().title === name) {
                    characterIDs.push('player');
                }

                let n = characterIDs.length;
                for (let j = 0; j < n; j++) {
                    let x = center[0] - tokenWidth/2 - 2;
                    let y = center[1] - tokenWidth/2 - 2;
                    // portrait    
                    if (n > 1) {
                        let w = tokenWidth + 10;
                        if (vertical) {
                            y -= w * (n-1) / 2;
                            y += w * j;
                        } else {
                            x -= w * (n-1) / 2;
                            x += w * j;
                        }
                    }
                    addToken(characterIDs[j], x, y);
                }
            }
        }

        function resizeMap() {
            recalcCoords();
            addHighlights();
            addCharacters();
        }

        resizeMap();
    }

    $(document).on(':passageend', function (ev) {
        if (!tags().includes("location"))
            return;
        var passage = $(ev.content);

        var map = $('<div id="navigation"></div>');

        if (tags().includes("castle")) {
            map.wiki(Story.get("Castle navigation").processText());
        }
        else if (tags().includes("forest")) {
            map.wiki(Story.get("Forest navigation").processText());
        }
        else if (tags().includes("town")) {
            map.wiki(Story.get("Town navigation").processText());
        }
        else if (tags().includes("tavern")) {
            map.wiki(Story.get("Tavern navigation").processText());
        }
        map.wrap('<div class="passage-block"></div>').parent().appendTo(passage);

        $("img[usemap]").one("load", function() {
            initMap(this, passage.find(`map[name=${$(this).attr('usemap').replace('#', '')}]`));;
        }).each(function() {
            if(this.complete) {
                $(this).trigger('load');
            }
        });
    });
}());
/* twine-user-script #33: "minigame-coins.js" */

function coinsMinigame(canvas, ctx) {
    let loc;
    // let lastLoc;
    let nCoins = Math.round(3 + 2 * Math.random());
    let coins = [nCoins];
    let width = canvas.width;
    let height = canvas.height;
    let lastTime;
    let deltaTime = 0;
    let clickedCoin = -1;
    let bowlRadius = 77;

    const coinTypes = [
        { 
            type: 0,
            radius: 25,
            mass: 250,
            color: "rgba(239, 57, 57, 0.5)",
            image: $("#coin-1")
        },
        { 
            type: 1,
            radius: 30,
            mass: 300,
            color: "rgba(0, 100, 67, 0.5)",
            image: $("#coin-2")
        },
        { 
            type: 2,
            radius: 35,
            mass: 350,
            color: "rgba(34, 28, 109, 0.5)",
            image: $("#coin-3")
        },
        { 
            type: 3,
            radius: 40,
            mass: 400,
            color: "rgba(255, 215, 0, 0.5)",
            image: $("#coin-4")
        }
    ]

    function addCoin(typeI) {
        let type = coinTypes[typeI];
        type.image.clone().insertAfter(type.image);
    }

    const coin = {
        enabled: false,
        bowl: false,
        type: -1,
        x: 0,
        y: 0,
        vx: 0,
        vy: 0,
        angle: 0,
        drag: 2.5,
        radius: 10,
        mass: 99999999,
        move() {
            if (!this.enabled) {
                return;
            }
            this.x += this.vx * deltaTime;
            this.y += this.vy * deltaTime;
            this.angle = rLerp(this.angle, Math.atan2(this.vy, this.vx), 0.3);
            this.vx *= (1 - this.drag * deltaTime);
            this.vy *= (1 - this.drag * deltaTime);
            this.checkBoundary();
        },
        checkBoundary() {
            if (this.x < this.radius) {
                this.x = this.radius;
                this.vx *= -1;
            }
            if (this.x > width - this.radius) {
                this.x = width - this.radius;
                this.vx *= -1;
            }
            if (this.y < this.radius) {
                this.y = this.radius;
                this.vy *= -1;
            }
            if (this.y > height - this.radius) {
                this.y = height - this.radius;
                this.vy *= -1;
            }
        },
        draw(rotate) {
            if (!this.enabled) {
                return;
            }
            let type = coinTypes[this.type];
            
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, true);
            ctx.closePath();
            ctx.fillStyle = type.color;
            ctx.fill();
            // ctx.strokeStyle = "black";
            // ctx.stroke();

            if (rotate) {
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);
                ctx.drawImage(type.image[0], -this.radius, -this.radius, this.radius * 2, this.radius * 2);
                ctx.rotate(-this.angle);
                ctx.translate(-this.x, -this.y);
            } else {
                ctx.drawImage(type.image[0], this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);
            }
        },
        dist2(other) {
            return (this.x - other.x) * (this.x - other.x) + (this.y - other.y) * (this.y - other.y);
        },
        hasOverlap(other) {
            if (!this.enabled || !other.enabled) {
                return false;
            }
            let radius2 = (this.radius + other.radius) * (this.radius + other.radius);
            return this.dist2(other) < radius2;
        },
        checkInCircle(pos) {
            if (!this.enabled || this.bowl) {
                return false;
            }
            let radius2 = this.radius * this.radius;
            return this.dist2(pos) < radius2;
        },
        checkCollision(other) {
            if (!this.enabled || !other.enabled) {
                return;
            }
            let dist2 = this.dist2(other);
            let radius = this.radius + other.radius;
            if (dist2 < radius * radius) {     
                let dist = Math.sqrt(dist2);

                let nx = (other.x - this.x) / dist;
                let ny = (other.y - this.y) / dist;

                let kx = (this.vx - other.vx);
                let ky = (this.vy - other.vy);
                let p = 2 * (nx * kx + ny * ky) / (this.mass + other.mass);
                this.vx = this.vx - p * other.mass * nx;
                this.vy = this.vy - p * other.mass * ny;
                if (!other.bowl) {
                    other.vx = other.vx + p * this.mass * nx;
                    other.vy = other.vy + p * this.mass * ny;
                }

                let correctionX = (nx * (radius - dist)) / 2;
                let correctionY = (ny * (radius - dist)) / 2;

                this.x -= correctionX; 
                this.y -= correctionY; 
                if (!other.bowl) {
                    other.x += correctionX; 
                    other.y += correctionY; 
                } else if (this.type === other.type) {
                    this.enabled = false;
                    addCoin(this.type);
                    if (mouse.enabled) {
                        return;
                    }
                    for (let i = 0; i < nCoins; i++) {
                        if (coins[i].enabled) {
                            return;
                        }
                    }
                    $(".decision").css('display', 'inherit');
                    cancelAnimationFrame(ref);
                }
            }
        }

    };
    let mouse = Object.create(coin);
    let bowls = [ 
        Object.create(coin), 
        Object.create(coin), 
        Object.create(coin), 
        Object.create(coin)
    ];

    function updatePositions() {
        for (let i = 0; i < nCoins; i++) {
            coins[i].move();
            coins[i].draw(true);
        }
        if (loc) {
            // if (lastLoc) {
                mouse.vx = (loc.x - mouse.x) * 20;
                mouse.vy = (loc.y - mouse.y) * 20;
                mouse.x += mouse.vx * deltaTime;
                mouse.y += mouse.vy * deltaTime;
            // }
            mouse.checkBoundary();
            // lastLoc = loc;
        }
    }

    function checkCollisions() {
        for (let i = 0; i < nCoins; i++) {
            for (let j =  i + 1; j < nCoins; j++) {
                coins[i].checkCollision(coins[j]);
            }
            if (loc) {
                mouse.checkCollision(coins[i]);
            }

            for (let j = 0; j < bowls.length; j++) {
                coins[i].checkCollision(bowls[j]);
            }
        }
        for (let j = 0; j < bowls.length; j++) {
            mouse.checkCollision(bowls[j]);
        }
    }

    function start() {
        for (let i = 0; i < nCoins; i++) {
            coins[i] = Object.create(coin);
            coins[i].enabled = true;
            let type = Math.floor(Math.random() * coinTypes.length);
            coins[i].type = type;
            coins[i].radius = coinTypes[type].radius;
            coins[i].mass = coinTypes[type].mass;
            coins[i].vx = -1 + 2 * Math.random();
            coins[i].vy = -1 + 2 * Math.random();
            coins[i].angle = Math.atan2(coins[i].vy, coins[i].vx) + Math.PI; //Why this Pi???
            
            var collide = false;
            do {
                coins[i].x = (width / 2) - 300 + (600 * Math.random());
                coins[i].y = (height / 2) - 150 + (300 * Math.random());
                for (let j = 0; j < i; j++) {
                    collide = coins[i].hasOverlap(coins[j]);
                    if (collide)
                        break;
                }
            } while (collide);
        }

        for (let i = 0; i < bowls.length; i++) {
            bowls[i].enabled = true;
            bowls[i].x = Math.floor(i / 2) * width;
            bowls[i].y = (i % 2) * height;
            bowls[i].vx = ((width / 2) - bowls[i].x) * 0.25;
            bowls[i].vy = ((height / 2) - bowls[i].y) * 0.25;
            bowls[i].radius = bowlRadius;
            bowls[i].bowl = true;
            bowls[i].type = i;
        }
        ref = window.requestAnimationFrame(draw);
    }

    function draw(now) {
        ref = window.requestAnimationFrame(draw);
        if (lastTime) {
            deltaTime = (now - lastTime) / 1000;
        }
        lastTime = now;
        clear(canvas, ctx);
        updatePositions();
        checkCollisions();
        mouse.draw(false);
        
        // Debug bowl circle
        // ctx.beginPath();
        // ctx.arc(0, 0, bowlRadius, 0, Math.PI * 2, true);
        // ctx.closePath();
        // ctx.strokeStyle = "black";
        // ctx.stroke();
    }

    function grabCoin(pos) {
        for (let i = 0; i < nCoins; i++) {
            if (coins[i].checkInCircle(pos)) {
                coins[i].enabled = false;
                mouse.type = coins[i].type
                mouse.radius = coins[i].radius;
                mouse.enabled = true;
                mouse.x = coins[i].x;
                mouse.y = coins[i].y;
                clickedCoin = i;
                break;
            }
        }
    }

    function leaveCoin() {
        coins[clickedCoin].x = mouse.x;
        coins[clickedCoin].y = mouse.y;
        coins[clickedCoin].vx = mouse.vx;
        coins[clickedCoin].vy = mouse.vy;
        coins[clickedCoin].enabled = true;
        mouse.enabled = false;
    }

    function click(pos) {
        if (mouse.enabled) {
            leaveCoin() 
        } else {
            grabCoin(pos);
        }
    }

    let mousedownTime;

    canvas.addEventListener("mousedown", (e) => {
        mousedownTime = Date.now();
        loc = getMousePos(canvas, e);
        click(getMousePos(canvas, e));
    });

    canvas.addEventListener("mouseup", (e) => {
        if (Date.now() - mousedownTime > 150) {
            if (mouse.enabled) {
                leaveCoin() 
            }
        }
    });

    canvas.addEventListener("mousemove", (e) => {
        loc = getMousePos(canvas, e);
    });

    canvas.addEventListener("mouseleave", (e) => {
        if (mouse.enabled) {
            leaveCoin();
        }
    });

    canvas.addEventListener("touchstart", (e) => {
        loc = getTouchPos(canvas, e);
        click(getTouchPos(canvas, e));
        e.preventDefault();
    });

    canvas.addEventListener("touchmove", (e) => {
        loc = getTouchPos(canvas, e);
        e.preventDefault();

    });

    canvas.addEventListener("touchend", (e) => {
        if (mouse.enabled) {
            leaveCoin() 
        }
        e.preventDefault();
    });

    canvas.addEventListener("dragstart", (e) => {
        e.preventDefault();
    });

    start();
}
/* twine-user-script #34: "minigame-painting.js" */
function paintingMinigame(canvas, ctx) {
    let running = false;
    let loc;
    let lastLoc;
    let radius;
    let color;

    function start() {
        running = true;
        radius = Math.random() * 25 + 15;

        if (variables().minigames.painting.palette === 'pastel') {
            color = 'hsl(' + 360 * Math.random() + ',' +
             (25 + 70 * Math.random()) + '%,' + 
             (65 + 20 * Math.random()) + '%)';
        } else {
            color = 'hsl(' + 360 * Math.random() + ',' +
             (25 + 70 * Math.random()) + '%,' + 
             (15 + 40 * Math.random()) + '%)';
        }
        variables().minigames.painting.colors++;
    }

    function paint() {
        ctx.lineWidth = radius * 2;
        ctx.beginPath();
        ctx.moveTo(lastLoc.x, lastLoc.y);
        ctx.lineTo(loc.x, loc.y);
        ctx.strokeStyle = color;
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(loc.x, loc.y, radius, 0, Math.PI * 2, true);
        ctx.closePath();
        ctx.fillStyle = color;
        ctx.fill()
    }

    function stop() {
        running = false;
    }

    canvas.addEventListener("mousedown", (e) => {
        loc = getMousePos(canvas, e);
        lastLoc = loc;
        start();
        paint();
    });

    canvas.addEventListener("mousemove", (e) => {
        if (running) {
            lastLoc = loc;
            loc = getMousePos(canvas, e);
            paint();
        }
    });

    canvas.addEventListener("mouseup", (e) => {
        stop();
    });

    canvas.addEventListener("touchstart", (e) => {
        loc = getTouchPos(canvas, e);
        lastLoc = loc;
        start();
        paint();
        e.preventDefault();
    });

    canvas.addEventListener("touchmove", (e) => {
        if (running) {
            lastLoc = loc;
            loc = getTouchPos(canvas, e);
            paint();
        }
        e.preventDefault();
    });

    canvas.addEventListener("touchend", (e) => {
        stop();
        e.preventDefault();
    });

    canvas.addEventListener("dragstart", (e) => {
        e.preventDefault();
    });

    variables().minigames.painting.colors = 0;
}
/* twine-user-script #35: "minigame-writing.js" */

function writingMinigame() {

    // new Vara("#chapter-container","https://raw.githubusercontent.com/akzhy/Vara/master/fonts/Parisienne/Parisienne.json",[{
	// 		text: variables().chapter,
	// 		strokeWidth: 1.8,
	// 		textAlign: "center",
	// 		duration: 2000,
	// 		letterSpacing: -8
	// 	}],{
	// 		fontSize:64
	// 	});

    // new Vara("#container","font.json",[
    //     {
    //         text:"Hello World", // String, text to be shown
    //         fontSize:24, // Number, size of the text
    //         strokeWidth:.5, // Width / Thickness of the stroke
    //         color:"black", // Color of the text
    //         id:"", // String or integer, for if animations are called manually or when using the get() method. Default is the index of the object.
    //         duration:2000, // Number, Duration of the animation in milliseconds
    //         textAlign:"left", // String, text align, accepted values are left,center,right
    //         x:0, // Number, x coordinate of the text
    //         y:0, // Number, y coordinate of the text
    //         fromCurrentPosition:{ // Whether the x or y coordinate should be from its calculated position, ie the position if x or y coordinates were not applied
    //             x:true, // Boolean
    //             y:true, // Boolean
    //         },
    //         autoAnimation:true, // Boolean, Whether to animate the text automatically
    //         queued:true, // Boolean, Whether the animation should be in a queue,
    //         delay:0,    // Number, Delay before the animation starts in milliseconds
    //         letterSpacing:0 // Number, space between each character
    //     }],{
    //         // The options given below will be applicable to every text created,
    //         // however they will not override the options set above.
    //         // They will work as secondary options.
    //         fontSize:24, // Number, size of the text
    //         strokeWidth:.5, // Width / Thickness of the stroke
    //         color:"black", // Color of the text
    //         duration:2000, // Number, Duration of the animation in milliseconds
    //         textAlign:"left", // String, text align, accepted values are left,center,right
    //         autoAnimation:true, // Boolean, Whether to animate the text automatically
    //         queued:true, // Boolean, Whether the animation should be in a queue
    //         letterSpacing:0
    //     })


    function generateText(xPos) {
        var ipsum = new LoremIpsum();
        let nSentences = Math.random() * 10 + 10;

        let array = [];
        for (let i = 0; i < nSentences; i++) {
            let text = ipsum.sentence(6);
            array.push({
                text: text,
                duration: text.length * 10,
                x: xPos
            });
        }
        return array;
    }


    var winWidth = $(window).width();
    console.log(winWidth);
    var ratio = winWidth / 1920;
    console.log(ratio);
    var fontSize = {
    small: 12,
    medium: 16
    };
    var played = [0, 0, 0];
    var bodyFontSize = Math.max(16 * ratio, 10);
    var posX = Math.max(50 * ratio, 30);
    // $("body").css("font-size", bodyFontSize + "px");
    fontSize.small = Math.max(fontSize.small * ratio, 7);
    fontSize.medium = Math.max(fontSize.medium * ratio, 10);
    console.log(fontSize.small);
    console.log(fontSize.medium);
    var vara = new Vara(
        "#vara-container",
        "https://raw.githubusercontent.com/akzhy/Vara/master/fonts/Parisienne/Parisienne.json",
        generateText(posX),
        {
            strokeWidth: 2,
            fontSize: fontSize.medium,
            autoAnimation: false
        }
    );
    var currentWord = 0;

    function prepWord() {
        let o = vara.get(currentWord);

        var group = o.container;
        console.log("HELLO");
        console.log(vara);
        var rect = vara.createNode("rect", {
            x: 0,
            y: 0,
            width: o.container.getBoundingClientRect().width,
            height: o.container.getBoundingClientRect().height,
            fill: "black",
            outline: "pink"
        });
        group.appendChild(rect);
        // $(rect).css("cursor", "pointer");
        $(rect).on('click', function() {
            vara.draw(currentWord);
            $(rect).remove();
        });
        $(rect).hover(function() {
            vara.draw(currentWord);
            $(rect).remove();
        });

    }
    vara.ready(function() {
        $(".first .front").on('click', function() {
            $(".book").addClass("open");
            $(this).parent(".paper").addClass("open");
            prepWord();

            vara.animationEnd(function(i, o) {
                currentWord++;
                if (currentWord >= vara.texts.length) {
                    $(".decision").css('display', 'inherit');
                } else {
                    prepWord();
                }
            });

            // if (!played[ix]) {
            //     vara[ix].playAll();
            //     vara[ix].animationEnd(function(i, o) {
            //         played[ix] = 1;
            //         console.log('done');
            //         if (i == "link") {
            //             var group = o.container;
            //             var rect = vara[2].createNode("rect", {
            //                 x: 0,
            //                 y: 0,
            //                 width: o.container.getBoundingClientRect().width,
            //                 height: o.container.getBoundingClientRect().height,
            //                 fill: "transparent"
            //             });
            //             group.appendChild(rect);
            //             $(rect).css("cursor", "pointer");
            //             $(rect).on('click', function() {
            //                 console.log(true);
            //                 document.querySelector("#link").on('click', );
            //             });
            //         }
            //     });
            // }
    });
    $(".back").on('click', function() {
        if (
        $(this)
            .parent(".paper")
            .index() == 0
        )
        $(".book").removeClass("open");
        $(this)
        .parent(".paper")
        .removeClass("open");
    });
    });

}
/* twine-user-script #36: "minigame.js" */
var ref;

function getMousePos(canvas, evt) {
    var rect = canvas.getBoundingClientRect(), // abs. size of element
    scaleX = canvas.width / rect.width,    // relationship bitmap vs. element for x
    scaleY = canvas.height / rect.height;  // relationship bitmap vs. element for y

    return {
        x: (evt.clientX - rect.left) * scaleX,   // scale mouse coordinates after they have
        y: (evt.clientY - rect.top) * scaleY     // been adjusted to be relative to element
    };
}

function getTouchPos(canvas, evt) {
    var rect = canvas.getBoundingClientRect(), // abs. size of element
    scaleX = canvas.width / rect.width,    // relationship bitmap vs. element for x
    scaleY = canvas.height / rect.height;  // relationship bitmap vs. element for y

    return {
        x: (evt.touches[0].clientX - rect.left) * scaleX,   // scale mouse coordinates after they have
        y: (evt.touches[0].clientY - rect.top) * scaleY     // been adjusted to be relative to element
    };
}

function clear(canvas, ctx) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function rLerp (A, B, w){
    let CS = (1-w)*Math.cos(A) + w*Math.cos(B);
    let SN = (1-w)*Math.sin(A) + w*Math.sin(B);
    return Math.atan2(SN,CS);
}

function finishminigame(minigame) {
    if (minigame === 'painting') {
        const canvas = $('canvas')[0];
        const ctx = canvas.getContext("2d");
        const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imgData.data;
        
        let emptyPixels = 0;
        let totalPixels = canvas.width * canvas.height;

        for(let i = 0; i < data.length; i += 4) {
            if (data[i + 3] === 0) {
                emptyPixels++;
                continue;
            }
        }

        variables().minigames.painting.filled = (1 - emptyPixels / totalPixels) * 100;
    }
    if (ref)
        cancelAnimationFrame(ref);
}

$(document).one(':passagestart', function () {
    Macro.add('finishminigame', {
        handler : function () {
            finishminigame(this.args[0]);
        }
    });
});
//passagedisplay
$(document).on(':passagedisplay', function (ev) {
    if (!tags().includes("minigame")) {
        return;
    }
    if (passage() === "Minigame Writing") {

        setTimeout(writingMinigame, 200);
        return;
    }

    const canvas = $('canvas')[0];
    const ctx = canvas.getContext("2d");

    if (passage() === "Minigame Painting") {
        paintingMinigame(canvas, ctx);
    }
    else if (passage() === "Minigame Coins") {
        coinsMinigame(canvas, ctx);
    }
});
/* twine-user-script #37: "bundle.js" */
// articles.min.js, for SugarCube 2, by Chapel
// v1.0.0, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;!function(){"use strict";var e=new Map,r=["eunuch","eucalyptus","eugenics","eulogy","euphemism","euphony","euphoria","eureka","european","euphemistic","euphonic","euphoric","euphemistically","euphonically","euphorically","heir","heiress","herb","homage","honesty","honor","honour","hour","honest","honorous","honestly","hourly","one","ouija","once","ubiquitous","ugandan","ukrainian","unanimous","unicameral","unified","unique","unisex","universal","urinal","urological","useful","useless","usurious","usurped","utilitarian","utopic","ubiquitously","unanimously","unicamerally","uniquely","universally","urologically","usefully","uselessly","usuriously"],i=["a","an"],t=/[aeiou8]/i,n=/[A-Z]+$/,u=/[UFHLMNRSX]/,a=/[.,\/#!$%\^&\*;:{}=\-_`~()]/g;function o(e){return"a"===e?"an":"a"}function s(r,t,n){var u;return State.length>0?(u="cannot add article override -> needs to be run in StoryInit special passage or earlier",console.error(u),u):t&&"string"==typeof t?(r&&"string"==typeof r&&(r=r.toLowerCase().trim()),i.includes(r)?(t=t.trim(),void(n?e.set(t,{article:r,caseSensitive:!!n}):e.set(t.toLowerCase(),{article:r,caseSensitive:!!n}))):(u='cannot add article override -> invalid article, must be "a" or "an"',console.error(u),u)):(u="cannot add article override -> invalid word",console.error(u),u)}function l(e){var i;return i=t.test(e.first())?"an":"a",function(e,i){return!!r.includes(e.toLowerCase())&&o(i)}(e,i)||function(e,r){return!(!n.test(e)||!u.test(e.first()))&&o(r)}(e,i)||i}function c(r){if(r&&"string"==typeof r){var i=r.trim().split(" ")[0].trim();return function(r){var i=(r=r.trim()).toLowerCase();if(e.has(i)||e.has(r)){var t=e.get(i)||e.get(r);return t.caseSensitive&&!e.has(r)?null:t.article}return null}(i=i.replace(a,""))||l(i)}}function h(e,r){if(!e||"string"!=typeof e)return e;var i=c(e);return(r?i.toUpperFirst():i)+" "+e}setup.articles={find:c,output:h,override:s},Macro.add("setarticle",{handler:function(){var e=s(this.args[0],this.args[1],this.args[2]);e&&"string"==typeof e&&this.error(e)}}),Macro.add(["a","an","A","An"],{handler:function(){var e=this.name.first()===this.name.first().toUpperCase();this.output.append(h(String(this.args[0]),e))}})}();
// end articles.min.js
// dialog-api-macro-set.min.js, for SugarCube 2, by Chapel
// v1.3.0, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;Macro.add("dialog",{tags:["onopen","onclose"],handler:function(){var t="",s=null,n=null,o=this.args.length>0?this.args[0]:"",e=this.args.length>1?this.args.slice(1).flatten():[];this.payload.forEach((function(o,e){0===e?t=o.contents:"onopen"===o.name?s=s?s+o.contents:o.contents:n=n?n+o.contents:o.contents})),e.push("macro-"+this.name),Dialog.setup(o,e.join(" ")),Dialog.wiki(t),s&&"string"==typeof s&&s.trim()&&$(document).one(":dialogopened",(function(){$.wiki(s)})),n&&"string"==typeof n&&n.trim()&&$(document).one(":dialogclosed",(function(){$.wiki(n)})),Dialog.open()}}),Macro.add("dialogclose",{skipArgs:!0,handler:function(){Dialog.close()}});
// end dialog-api-macro-set.min.js
// ui-macro.min.js, for SugarCube 2, by Chapel
// v1.0.0, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;!function(){var s={update:UIBar.setStoryElements,stow:UIBar.stow,unstow:UIBar.unstow,toggle:function(){$("#ui-bar").hasClass("stowed")?UIBar.unstow():UIBar.stow()},hide:function(){$("#ui-bar").css("display","none")},show:function(){$("#ui-bar").css("display","block")},kill:function(){$("#ui-bar").css("display","none"),$("#story").css("margin-left","2.5em")},restore:function(){$("#ui-bar").css("display","block"),$("#story").css("margin-left","20em")},jump:UI.jumpto,saves:UI.saves,restart:UI.restart,settings:UI.settings,share:UI.share,aliases:{refresh:"update",reload:"update",destroy:"kill",revive:"restore",jumpto:"jump",save:"saves",load:"saves",setting:"settings",sharing:"share"}},r=Object.keys(s);function t(t){return t&&"string"==typeof t?function(s){return r.includes(s)}(t=t.toLowerCase().trim())||(t=function(r){return s.aliases[r]||null}(t))?(s[t](),!1):'Command "'+t+'" is not a valid command.':"Command is not a string."}Macro.add("ui",{handler:function(){Array.isArray(this.args)&&this.args.length||this.error("No commands passed to macro.");var s,r=function(s){if(!Array.isArray(s))return"Command list error.";var r=[];return s.forEach((function(s){r.push(t(s))})),r}(this.args.flatten());s=(r=r.filter((function(s){return"string"==typeof s}))).join(" "),r.length&&s&&this.error(s)}})}();
// end ui-macro.min.js
// first-macro.min.js, for SugarCube 2, by Chapel
// v1.1.1, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;Macro.add("first",{skipArgs:!0,tags:["then","finally"],handler:function(){var a,t=$(document.createElement("span")),n=this.payload[this.payload.length-1],s=visited()-1;a=s<this.payload.length?this.payload[s].contents:"finally"===n.name?n.contents:"",t.wiki(a).addClass("macro-"+this.name).appendTo(this.output)}});
// end first-macro.min.js
// popover.min.js, for SugarCube 2, by Chapel
// v1.0.0, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;!function(){"use strict";function o(o,i){i=function(){return[].slice.call(arguments).flatten().filter((function(o){return o&&"string"==typeof o&&o.trim()}))||[]}(i),$("#ui-overlay, #ui-dialog").addClass("popover"),$("#ui-overlay, #ui-dialog, #ui-dialog-body").addClass(i),i.includesAny("noclick","no-click")&&$("#ui-overlay").removeClass("ui-close"),Dialog.setup("","popover"),Dialog.wiki(o),Dialog.open(),$(document).one(":dialogclosed",(function(){$("#ui-overlay").addClass("ui-close"),$("#ui-overlay, #ui-dialog").removeClass("popover"),$("#ui-overlay, #ui-dialog, #ui-dialog-body").removeClass(i)}))}Macro.add("popover",{tags:null,handler:function(){o(this.payload[0].contents,this.args)}}),Macro.add("dismisspopover",{skipArgs:!0,handler:function(){$("ui-overlay").hasClass("popover")&&Dialog.close()}}),setup.popover=o}();
// end popover.min.js
// swap-macro-set.min.js, for SugarCube 2, by Chapel
// v1.1.0, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;!function(){"use strict";var t=!0,a=!0,e="violet",s="red",r="swappable";setup.swap=setup.swap||{};var n=null;function i(a){var e=function(){return a};setup.swap.current=e,t&&(window.swapCurrent=e)}function o(a,o){var p=$(document.createElement("span"));return $(document.createElement("a")).wiki(a).css("color",e).attr({"data-swap-flag":"false","data-orig-content":a,"data-wiki-code":o||""}).addClass(r).appendTo(p).ariaClick((function(a){a.preventDefault();var r=$(this);if("true"===r.attr("data-swap-flag"))r.attr("data-swap-flag","false").css("color",e),n=null;else if(n){var o=n.text(),p=r.text(),l=n.attr("data-wiki-code"),c=r.attr("data-wiki-code");n.attr("data-swap-flag","false").css("color",e).empty().wiki(p),r.attr("data-swap-flag","false").css("color",e).empty().wiki(o),l&&"string"==typeof l&&l.trim()&&(i(p),$.wiki(l)),c&&"string"==typeof c&&c.trim()&&(i(o),$.wiki(c)),setup.swap.current&&"function"==typeof setup.swap.current&&delete setup.swap.current,t&&window.swapCurrent&&"function"==typeof window.swapCurrent&&delete window.swapCurrent,n=null}else n=r,r.attr("data-swap-flag","true").css("color",s)})),p}function p(){n=null,$("a."+r).each((function(){var t=$(this);t.empty().wiki(t.attr("data-orig-content")).attr("data-swap-flag","false").css("color",e)}))}Macro.add("swap",{tags:["onswap"],skipArgs:!0,handler:function(){var t=this.payload[0].contents,a=this.payload[1]?this.payload[1].contents:"",e=this.output,s=this.name;o(t,a).addClass("macro-"+s).appendTo(e)}}),Macro.add("resetswap",{handler:function(){var t=this.args&&this.args[0]&&"string"==typeof this.args[0]?this.args[0]:"Reset";$(document.createElement(a?"button":"a")).wiki(t).ariaClick({label:"Reset all swappable elements."},(function(t){t.preventDefault(),p()})).appendTo(this.output)}}),setup.swap.create=o,setup.swap.reset=p}();
// end swap-macro-set.min.js
// css-macro.min.js, for SugarCube 2, by Chapel
// v1.0.0, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;!function(){"use strict";function t(t){if(t.length%2!=0)return"Style rules should be a list of key/value pairs; you've passed an odd number.";var r={};return t.forEach((function(e,n){n%2==0&&(r[e]=t[n+1])})),r}function r(t,r){try{return"string"==typeof r?r:(t instanceof jQuery||(t=$(t)),t.css(r))}catch(t){return t.message}}Macro.add("css",{handler:function(){var e=function(){try{var e,n=[].slice.call(arguments).flatten(),s=n.shift();return"string"==typeof n[0]?e=t(n):"object"==typeof n[0]&&(e=clone(n[0])),r(s,e)}catch(t){return t.message}}(this.args);if("string"==typeof e)return this.error(e)}})}();
// end css-macro.min.js
// events.min.js, for SugarCube 2, by Chapel
// v2.0.0, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;setup.eventMacroNamespace="macro-event",Macro.add("trigger",{handler:function(){var t;return this.args.length>2||0===this.args.length?this.error("incorrect number of arguments"):"string"!=typeof this.args[0]?this.error("first argument should be a string and a valid event type"):(t=this.args[0],void(1===this.args.length||this.args[1]&&"string"==typeof this.args[1]&&"document"===this.args[1].toLowerCase().trim()?$(document):$(this.args[1])).trigger(t))}}),Macro.add(["event","on","one"],{tags:["which"],handler:function(){var t,r,e=this.payload,s="on",n="",a="";return this.args.length>3||0===this.args.length?this.error("incorrect number of arguments"):"string"!=typeof this.args[0]?this.error("first argument should be a string and a valid event type"):(2===this.args.length&&"string"==typeof this.args[1]&&"once"!==this.args[1]&&(n=this.args[1]),(this.args.includes("once")||"one"===this.name)&&(s="one"),t=this.args[0],void $(document)[s](t+"."+setup.eventMacroNamespace,n,this.createShadowWrapper((function(t){if(a=e[0].contents,e.length>1)for(r=1;r<e.length;r++)e[r].args.includes(t.which)&&(a+=e[r].contents);new Wikifier(null,a)}))))}}),Macro.add("off",{handler:function(){var t;return this.args.length>2||0===this.args.length?this.error("incorrect number of arguments"):"string"!=typeof this.args[0]?this.error("first argument should be a string and a valid event type or namespace"):(t=this.args[0],void(1===this.args.length||this.args[1]&&"string"==typeof this.args[1]&&"document"===this.args[1].toLowerCase().trim()?$(document):$(this.args[1])).off(t))}});
// end events.min.js
// preload.min.js, for SugarCube 2, by Chapel
// v1.0.0, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;!function(){"use strict";function t(t,r){var e=0,o=t.length;if(0===o)throw new Error("No URLs to preload!");t.forEach((function(t){!function(t,r){var e=new Image;e.onload=r,e.onerror=r,e.src=t}(t,(function(){++e===o&&r()}))}))}function r(){return State.length<=0}function e(){var e=[].slice.call(arguments).flatten(),o=!!r()&&LoadScreen.lock();return t(e,(function(){o&&LoadScreen.unlock(o)})),o}setup.preload=e,setup.preload.force=!1,Macro.add("preload",{handler:function(){if(!r()&&!setup.preload.force)return this.error("Attempting to preload images outside of `StoryInit` or similar can cause performance issues. Set `setup.preload.force` to `true` if you want to do it anyway.");e(this.args.flatten().filter((function(t){return"string"==typeof t})))}})}();
// end preload.min.js
// mouseover.min.js, for SugarCube 2, by Chapel
// v1.0.1, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;Macro.add("mouseover",{tags:["onhover","onmouseover","onmousein","onmouseenter","onmouseout"],skipArgs:!0,handler:function(){if(this.payload.length<2)return this.error("No event tag used.");var e={mouseover:[],mousein:[],mouseout:[]},o=$(document.createElement("span")).addClass("macro-"+this.name).wiki(this.payload[0].contents).appendTo(this.output);this.payload.forEach((function(o){switch(o.name){case"onhover":case"onmouseover":e.mouseover.push(o.contents);break;case"onmousein":case"onmouseenter":e.mousein.push(o.contents);break;case"onmouseout":e.mouseout.push(o.contents);break;default:return}})),e.mouseover.length&&o.on("mouseover",this.createShadowWrapper((function(o){$.wiki(e.mouseover.join(" "))}))),e.mousein.length&&o.on("mouseenter",this.createShadowWrapper((function(o){$.wiki(e.mousein.join(" "))}))),e.mouseout.length&&o.on("mouseout",this.createShadowWrapper((function(o){$.wiki(e.mouseout.join(" "))})))}});
// end mouseover.min.js
// fading-macro-set.min.js, for SugarCube 2, by Chapel
// v1.1.0, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;Macro.add("fadein",{tags:null,handler:function(){var t,a,s=$(document.createElement("span")),e=this.payload[0].contents;if(0===this.args.length)return this.error("no arguments given");t=Util.fromCssTime(this.args[0]),a=this.args.length>1?Util.fromCssTime(this.args[1]):0,s.wiki(e).addClass("macro-"+this.name).appendTo(this.output).hide().delay(a).fadeIn(t)}}),Macro.add("fadeout",{tags:null,handler:function(){var t,a,s=$(document.createElement("span")),e=this.payload[0].contents;if(0===this.args.length)return this.error("no arguments given");t=Util.fromCssTime(this.args[0]),a=this.args.length>1?Util.fromCssTime(this.args[1]):0,s.wiki(e).addClass("macro-"+this.name).appendTo(this.output).delay(a).fadeOut(t)}});
// end fading-macro-set.min.js
// message-macro.min.js, for SugarCube 2, by Chapel
// v1.0.1, 2022-07-21, 3bdbdfbe5ae47a46e4f4e52766d78701939ae9a6
;setup.messageMacro={},setup.messageMacro.default="Help",Macro.add("message",{tags:null,handler:function(){var e=this.payload[0].contents,a=$(document.createElement("span")),s=$(document.createElement(this.args.includes("btn")?"button":"a")),t=$(document.createElement("span"));s.wiki(this.args.length>0&&"btn"!==this.args[0]?this.args[0]:setup.messageMacro.default).ariaClick(this.createShadowWrapper((function(){a.hasClass("open")?t.css("display","none").empty():t.css("display","block").wiki(e),a.toggleClass("open")}))),a.attr("id","macro-"+this.name+"-"+this.args.join("").replace(/[^A-Za-z0-9]/g,"")).addClass("message-text").append(s).append(t).appendTo(this.output)}});
// end message-macro.min.js

/* twine-user-script #38: "jquery.maphilight-modified.js" */
(function(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define(['jquery'], factory);
	} else {
		factory(root.jQuery);
	}
})(window, function($) {
	var has_VML, has_canvas, create_canvas_for, add_shape_to, clear_canvas, shape_from_area,
		canvas_style, hex_to_decimal, css3color, is_image_loaded, options_from_area;

	has_canvas = !!document.createElement('canvas').getContext;

	// VML: more complex
	has_VML = (function() {
		var a = document.createElement('div');
		a.innerHTML = '<v:shape id="vml_flag1" adj="1" />';
		var b = a.firstChild;
		b.style.behavior = "url(#default#VML)";
		return b ? typeof b.adj == "object": true;
	})();

	if(!(has_canvas || has_VML)) {
		$.fn.maphilight = function() { return this; };
		return;
	}

	if(has_canvas) {
		hex_to_decimal = function(hex) {
			return Math.max(0, Math.min(parseInt(hex, 16), 255));
		};
		css3color = function(color, opacity) {
			return 'rgba('+hex_to_decimal(color.substr(0,2))+','+hex_to_decimal(color.substr(2,2))+','+hex_to_decimal(color.substr(4,2))+','+opacity+')';
		};
		create_canvas_for = function(img) {
			var c = $('<canvas style="width:'+$(img).width()+'px;height:'+$(img).height()+'px;"></canvas>').get(0);
			c.getContext("2d").clearRect(0, 0, $(img).width(), $(img).height());
			return c;
		};
		var draw_shape = function(context, shape, coords, x_shift, y_shift) {
			x_shift = x_shift || 0;
			y_shift = y_shift || 0;
            var i;

			context.beginPath();
			if(shape == 'rect') {
				// x, y, width, height
				context.rect(coords[0] + x_shift, coords[1] + y_shift, coords[2] - coords[0], coords[3] - coords[1]);
			} else if(shape == 'poly') {
				context.moveTo(coords[0] + x_shift, coords[1] + y_shift);
				for(i=2; i < coords.length; i+=2) {
					context.lineTo(coords[i] + x_shift, coords[i+1] + y_shift);
				}
			} else if(shape == 'circ') {
				// x, y, radius, startAngle, endAngle, anticlockwise
				context.arc(coords[0] + x_shift, coords[1] + y_shift, coords[2], 0, Math.PI * 2, false);
			}
			context.closePath();
		};
		add_shape_to = function(canvas, shape, coords, options, name) {
			var i, context = canvas.getContext('2d');

			// Because I don't want to worry about setting things back to a base state

			// Shadow has to happen first, since it's on the bottom, and it does some clip /
			// fill operations which would interfere with what comes next.
			if(options.shadow) {
				context.save();
				if(options.shadowPosition == "inside") {
					// Cause the following stroke to only apply to the inside of the path
					draw_shape(context, shape, coords);
					context.clip();
				}

				// Redraw the shape shifted off the canvas massively so we can cast a shadow
				// onto the canvas without having to worry about the stroke or fill (which
				// cannot have 0 opacity or width, since they're what cast the shadow).
				var x_shift = canvas.width * 100;
				var y_shift = canvas.height * 100;
				draw_shape(context, shape, coords, x_shift, y_shift);

				context.shadowOffsetX = options.shadowX - x_shift;
				context.shadowOffsetY = options.shadowY - y_shift;
				context.shadowBlur = options.shadowRadius;
				context.shadowColor = css3color(options.shadowColor, options.shadowOpacity);

				// Now, work out where to cast the shadow from! It looks better if it's cast
				// from a fill when it's an outside shadow or a stroke when it's an interior
				// shadow. Allow the user to override this if they need to.
				var shadowFrom = options.shadowFrom;
				if (!shadowFrom) {
					if (options.shadowPosition == 'outside') {
						shadowFrom = 'fill';
					} else {
						shadowFrom = 'stroke';
					}
				}
				if (shadowFrom == 'stroke') {
					context.strokeStyle = "rgba(0,0,0,1)";
					context.stroke();
				} else if (shadowFrom == 'fill') {
					context.fillStyle = "rgba(0,0,0,1)";
					context.fill();
				}
				context.restore();

				// and now we clean up
				if(options.shadowPosition == "outside") {
					context.save();
					// Clear out the center
					draw_shape(context, shape, coords);
					context.globalCompositeOperation = "destination-out";
					context.fillStyle = "rgba(0,0,0,1);";
					context.fill();
					context.restore();
				}
			}

			context.save();

			draw_shape(context, shape, coords);

			// fill has to come after shadow, otherwise the shadow will be drawn over the fill,
			// which mostly looks weird when the shadow has a high opacity
			if(options.fill) {
				context.fillStyle = css3color(options.fillColor, options.fillOpacity);
				context.fill();
			}
			// Likewise, stroke has to come at the very end, or it'll wind up under bits of the
			// shadow or the shadow-background if it's present.
			if(options.stroke) {
				context.strokeStyle = css3color(options.strokeColor, options.strokeOpacity);
				context.lineWidth = options.strokeWidth;
				context.stroke();
			}

			context.restore();

			if(options.fade) {
				$(canvas).css('opacity', 0).animate({opacity: 1}, 100);
			}
		};
		clear_canvas = function(canvas) {
			canvas.getContext('2d').clearRect(0, 0, canvas.width,canvas.height);
		};
	} else {   // ie executes this code
		create_canvas_for = function(img) {
			return $('<var style="zoom:1;overflow:hidden;display:block;width:'+img.width+'px;height:'+img.height+'px;"></var>').get(0);
		};
		add_shape_to = function(canvas, shape, coords, options, name) {
			var fill, stroke, opacity, e;
			for (var i in coords) { coords[i] = parseInt(coords[i], 10); }
			fill = '<v:fill color="#'+options.fillColor+'" opacity="'+(options.fill ? options.fillOpacity : 0)+'" />';
			stroke = (options.stroke ? 'strokeweight="'+options.strokeWidth+'" stroked="t" strokecolor="#'+options.strokeColor+'"' : 'stroked="f"');
			opacity = '<v:stroke opacity="'+options.strokeOpacity+'"/>';
			if(shape == 'rect') {
				e = $('<v:rect name="'+name+'" filled="t" '+stroke+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+coords[0]+'px;top:'+coords[1]+'px;width:'+(coords[2] - coords[0])+'px;height:'+(coords[3] - coords[1])+'px;"></v:rect>');
			} else if(shape == 'poly') {
				e = $('<v:shape name="'+name+'" filled="t" '+stroke+' coordorigin="0,0" coordsize="'+canvas.width+','+canvas.height+'" path="m '+coords[0]+','+coords[1]+' l '+coords.join(',')+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+canvas.width+'px;height:'+canvas.height+'px;"></v:shape>');
			} else if(shape == 'circ') {
				e = $('<v:oval name="'+name+'" filled="t" '+stroke+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(coords[0] - coords[2])+'px;top:'+(coords[1] - coords[2])+'px;width:'+(coords[2]*2)+'px;height:'+(coords[2]*2)+'px;"></v:oval>');
			}
			e.get(0).innerHTML = fill+opacity;
			$(canvas).append(e);
		};
		clear_canvas = function(canvas) {
			// jquery1.8 + ie7
			var $html = $("<div>" + canvas.innerHTML + "</div>");
			$html.children('[name=highlighted]').remove();
			$(canvas).html($html.html());
		};
	}

	shape_from_area = function(area) {
		var i, coords,
			shape = (area.getAttribute('shape') || 'rect').toLowerCase().substr(0,4);
		if (shape === 'defa') {
			// 'default' doesn't really apply to what we're doing; it's the background state
			return;
		}
		coords = (area.getAttribute('coords') || '').split(',');
		for (i=0; i < coords.length; i++) { coords[i] = parseFloat(coords[i]); }
		return [shape, coords];
	};

	options_from_area = function(area, options) {
		var $area = $(area);
		return $.extend({}, options, $.metadata ? $area.metadata() : false, $area.data('maphilight'));
	};

	is_image_loaded = function(img) {
		if(!img.complete) { return false; } // IE
		if(typeof img.naturalWidth != "undefined" && img.naturalWidth === 0) { return false; } // Others
		return true;
	};

	canvas_style = {
		position: 'absolute',
		left: 0,
		top: 0,
		padding: 0,
		border: 0
	};

	var ie_hax_done = false;
	$.fn.maphilight = function(opts) {
		opts = $.extend({}, $.fn.maphilight.defaults, opts);

		if(!has_canvas && !ie_hax_done) {
			$(window).ready(function() {
				document.namespaces.add("v", "urn:schemas-microsoft-com:vml");
				var style = document.createStyleSheet();
				var shapes = ['shape','rect', 'oval', 'circ', 'fill', 'stroke', 'imagedata', 'group','textbox'];
				$.each(shapes,
					function() {
						style.addRule('v\\:' + this, "behavior: url(#default#VML); antialias:true");
					}
				);
			});
			ie_hax_done = true;
		}

		return this.each(function() {
			var img, wrap, options, map, canvas, canvas_always, highlighted_shape, usemap, imgSrc;
			img = $(this);

			if(!is_image_loaded(this)) {
				// If the image isn't fully loaded, this won't work right.  Try again later.
				return window.setTimeout(function() {
					img.maphilight(opts);
				}, 200);
			}

			options = $.extend({}, opts, $.metadata ? img.metadata() : false, img.data('maphilight'));

			// jQuery bug with Opera, results in full-url#usemap being returned from jQuery's attr.
			// So use raw getAttribute instead.
			usemap = img.get(0).getAttribute('usemap');

			if (!usemap) {
				return;
			}

			map = $('map[name="'+usemap.substr(1)+'"]');

			if(!(img.is('img,input[type="image"]') && usemap && map.length > 0)) {
				return;
			}

			// Store the current width/height of the image here in case it's being sized by CSS that'll
			// be affected by it being wrapped by the div below. (e.g. width:50%)
			// For now, we'll trust that something else is handling scaling the <area>'s coords to account
			// for this non-static sizing...
			var currentWidth = img.width();
			var currentHeight = img.height();
			
			if(img.hasClass('maphilighted')) {
				// We're redrawing an old map, probably to pick up changes to the options.
				// Just clear out all the old stuff.
				var wrapper = img.parent();
				img.insertBefore(wrapper);
				wrapper.remove();
				$(map).unbind('.maphilight');
			}

			//Formating the image source. IE > 9 has issue with new line characters
			imgSrc = this.src.replace(/[\n\r]/g, '');
			wrap = $('<div></div>').css({
				display:'block',
				background:'url("'+this.src+'")',
				"background-size":'contain',
				"background-repeat":'no-repeat',
				position:'relative',
				padding:0,
				width:currentWidth,
				height:currentHeight
				});
			if(options.wrapClass) {
				if(options.wrapClass === true) {
					wrap.addClass($(this).attr('class'));
				} else {
					wrap.addClass(options.wrapClass);
				}
			}
			// Firefox has a bug that prevents tabbing into the image map if
			// we set opacity of the image to 0, but very nearly 0 works!
			img.before(wrap).css('opacity', 0.0000000001).css(canvas_style).remove();
			if(has_VML) { img.css('filter', 'Alpha(opacity=0)'); }
			wrap.append(img);

			canvas = create_canvas_for(this);
			$(canvas).css(canvas_style);
			canvas.height = currentHeight;
			canvas.width = currentWidth;

			$(map).bind('alwaysOn.maphilight', function() {
				// Check for areas with alwaysOn set. These are added to a *second* canvas,
				// which will get around flickering during fading.
				if(canvas_always) {
					clear_canvas(canvas_always);
				}
				if(!has_canvas) {
					$(canvas).empty();
				}
				$(map).find('area[coords]').each(function() {
					var shape, area_options;
					area_options = options_from_area(this, options);
					if(area_options.alwaysOn) {
						if(!canvas_always && has_canvas) {
							canvas_always = create_canvas_for(img[0]);
							$(canvas_always).css(canvas_style);
							canvas_always.width = currentWidth;
							canvas_always.height = currentHeight;
							img.before(canvas_always);
						}
						area_options.fade = area_options.alwaysOnFade; // alwaysOn shouldn't fade in initially
						shape = shape_from_area(this);
						if (!shape) {
							return;
						}
						if (has_canvas) {
							add_shape_to(canvas_always, shape[0], shape[1], area_options, "");
						} else {
							add_shape_to(canvas, shape[0], shape[1], area_options, "");
						}
					}
				});
			}).trigger('alwaysOn.maphilight')
			.bind('mouseover.maphilight focusin.maphilight', function(e) {
				var shape, area_options, area = e.target;
				area_options = options_from_area(area, options);
				if(!area_options.neverOn && !area_options.alwaysOn) {
					shape = shape_from_area(area);
					if (!shape) {
						return;
					}
					add_shape_to(canvas, shape[0], shape[1], area_options, "highlighted");
					if(area_options.groupBy) {
						if(typeof area_options.groupBy == 'string') {
							area_options.groupBy = [area_options.groupBy];
						}
						var el = $(this);
						$.each(area_options.groupBy, function(index, groupitem){
							var areas;
							// two ways groupBy might work; attribute and selector
							if(/^[a-zA-Z][\-a-zA-Z]+$/.test(groupitem)) {
								areas = map.find('area['+groupitem+'="'+el.attr(groupitem)+'"]');
							} else {
								areas = map.find(groupitem);
							}
							var first = this;
							areas.each(function() {
								if(this != first) {
									var subarea_options = options_from_area(this, options);
									if(!subarea_options.neverOn && !subarea_options.alwaysOn) {
										var shape = shape_from_area(this);
										add_shape_to(canvas, shape[0], shape[1], subarea_options, "highlighted");
									}
								}
							});
						});
					}
					// workaround for IE7, IE8 not rendering the final rectangle in a group
					if(!has_canvas) {
						$(canvas).append('<v:rect></v:rect>');
					}
				}
			}).bind('mouseout.maphilight focusout.maphilight', function(e) { clear_canvas(canvas); });

			img.before(canvas); // if we put this after, the mouseover events wouldn't fire.

			img.addClass('maphilighted');
		});
	};
	$.fn.maphilight.defaults = {
		fill: true,
		fillColor: '000000',
		fillOpacity: 0.2,
		stroke: true,
		strokeColor: 'ff0000',
		strokeOpacity: 1,
		strokeWidth: 1,
		fade: true,
		alwaysOn: false,
		neverOn: false,
		groupBy: false,
		wrapClass: true,
		// plenty of shadow:
		shadow: false,
		shadowX: 0,
		shadowY: 0,
		shadowRadius: 6,
		shadowColor: '000000',
		shadowOpacity: 0.8,
		shadowPosition: 'outside',
		shadowFrom: false
	};
});
/* twine-user-script #39: "lorem-ipsum.js" */
;(function() {

	"use strict";

	/**
	 * LoremIpsum constructor
	 *
	 * @type {Function}
	 */
	window.LoremIpsum = function() {
		// pass
	}

	/**
	 * LoremIpsum prototype
	 *
	 * @type {Object}
	 */
	window.LoremIpsum.prototype = {

		/**
		 * Possible words
		 *
		 * @type {Array}
		 */
		_words: [ "a", "ac", "accumsan", "ad", "adipiscing", "aenean", "aenean", "aliquam", "aliquam", "aliquet", "amet", "ante", "aptent", "arcu", "at", "auctor", "augue", "bibendum", "blandit", "class", "commodo", "condimentum", "congue", "consectetur", "consequat", "conubia", "convallis", "cras", "cubilia", "curabitur", "curabitur", "curae", "cursus", "dapibus", "diam", "dictum", "dictumst", "dolor", "donec", "donec", "dui", "duis", "egestas", "eget", "eleifend", "elementum", "elit", "enim", "erat", "eros", "est", "et", "etiam", "etiam", "eu", "euismod", "facilisis", "fames", "faucibus", "felis", "fermentum", "feugiat", "fringilla", "fusce", "gravida", "habitant", "habitasse", "hac", "hendrerit", "himenaeos", "iaculis", "id", "imperdiet", "in", "inceptos", "integer", "interdum", "ipsum", "justo", "lacinia", "lacus", "laoreet", "lectus", "leo", "libero", "ligula", "litora", "lobortis", "lorem", "luctus", "maecenas", "magna", "malesuada", "massa", "mattis", "mauris", "metus", "mi", "molestie", "mollis", "morbi", "nam", "nec", "neque", "netus", "nibh", "nisi", "nisl", "non", "nostra", "nulla", "nullam", "nunc", "odio", "orci", "ornare", "pellentesque", "per", "pharetra", "phasellus", "placerat", "platea", "porta", "porttitor", "posuere", "potenti", "praesent", "pretium", "primis", "proin", "pulvinar", "purus", "quam", "quis", "quisque", "quisque", "rhoncus", "risus", "rutrum", "sagittis", "sapien", "scelerisque", "sed", "sem", "semper", "senectus", "sit", "sociosqu", "sodales", "sollicitudin", "suscipit", "suspendisse", "taciti", "tellus", "tempor", "tempus", "tincidunt", "torquent", "tortor", "tristique", "turpis", "ullamcorper", "ultrices", "ultricies", "urna", "ut", "ut", "varius", "vehicula", "vel", "velit", "venenatis", "vestibulum", "vitae", "vivamus", "viverra", "volutpat", "vulputate" ],

		/**
		 * Get random number
		 *
		 * @param  {Number} x
		 * @param  {Number} y
		 * @return {Number}
		 */
		_random: function(x, y) {
			var rnd = (Math.random() * 2 - 1) + (Math.random() * 2 - 1) + (Math.random() * 2 - 1);
			return Math.round(Math.abs(rnd) * x + y);
		},

		/**
		 * Get random number between min and max
		 *
		 * @param  {Number} min (optional) lower result limit
		 * @param  {Number} max (optional) upper result limit
		 * @return {Number}     random number
		 */
		_count: function(min, max) {
			var result;
			if (min && max) result = Math.floor(Math.random() * (max - min + 1) + min);
			else if (min) result = min;
			else if (max) result = max;
			else result = this._random(8, 2);

			return result;
		},

		/**
		 * Get random words
		 *
		 * @param  {Number} min (optional) minimal words count
		 * @param  {Number} max (optional) maximal words count
		 * @return {Object}     array of random words
		 */
		words: function(min, max) {
			var result = [];
			var count = this._count(min, max);

			// get random words
			while (result.length < count) {
				var pos = Math.floor(Math.random() * this._words.length);
				var rnd = this._words[pos];

				// do not allow same word twice in a row
				if (result.length && result[result.length - 1] === rnd) {
					continue;
				}

				result.push(rnd);
			}

			return result;
		},

		/**
		 * Generate sentence
		 *
		 * @param  {Number} min (optional) minimal words count
		 * @param  {Number} max (optional) maximal words count
		 * @return {String}     sentence
		 */
		sentence: function(min, max) {
			var words = this.words(min, max);

			// add comma(s) to sentence
			var index = this._random(6, 2);
			while (index < words.length - 2) {
				words[index] += ",";
				index += this._random(6, 2);
			}

			// append puctation on end
			var punct = "...!?"
			words[words.length - 1] += punct.charAt(Math.floor(Math.random() * punct.length));

			// uppercase first letter
			words[0] = words[0].charAt(0).toUpperCase() + words[0].slice(1);

			return words.join(" ");
		},

		/**
		 * Generate paragraph
		 *
		 * @param  {Number} min (optional) minimal words count
		 * @param  {Number} max (optional) maximal words count
		 * @return {String}     paragraph
		 */
		paragraph: function(min, max) {
			if (!min && !max) {
				min = 20;
				max = 60;
			}

			var result = "";
			var count = this._count(min, max);

			// append sentences until limit is reached
			while (result.slice(0, -1).split(" ").length < count) {
				result += this.sentence() + " ";
			}
			result = result.slice(0, -1)

			// remove words
			if (result.split(" ").length > count) {
				var punct = result.slice(-1);
				result = result.split(" ").slice(0, count).join(" ");
				result = result.replace(/,$/, "");
				result += punct;
			}

			return result;
		}

	}

})();
/* twine-user-script #40: "nhpup_1.1.js" */
/*

--------------------------------------------------------------------------
Code for link-hover text boxes
By Nicolas Höning
Usage: <a onmouseover="nhpup.popup('popup text' [, {'class': 'myclass', 'width': 300}])">a link</a>
The configuration dict with CSS class and width is optional - default is class .pup and width of 200px.
You can style the popup box via CSS, targeting its ID #pup. 
You can escape " in the popup text with &quot;.
Tutorial and support at http://nicolashoening.de?twocents&nr=8
--------------------------------------------------------------------------

The MIT License (MIT)

Copyright (c) 2014 Nicolas Höning

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/

var nhpup = {

    pup: null,      // This is the popup box, represented by a div    
    identifier: "popup",  // Name of ID and class of the popup box
    minMargin: 15,  // Set how much minimal space there should be (in pixels)
                    // between the popup and everything else (borders, mouse)
    default_width: 250, // Will be set to width from css in document.ready
    move: false,   // Move it around with the mouse? we are only ready for that when the mouse event is set up.
                   // Besides, having this turned off initially is resource-friendly.

    /*
     Write message, show popup w/ custom width if necessary,
      make sure it disappears on mouseout
    */
    popup: function(p_msg, p_target, p_config)
    {
        // do track mouse moves and update position 
        this.move = true;
        // restore defaults
        this.pup.removeClass()
                .addClass(this.identifier)
                .width(this.default_width);
        
        let click = false;

        // custom configuration
        if (typeof p_config != 'undefined') {
            if ('class' in p_config) {
                this.pup.addClass(p_config['class']);
            }
            if ('width' in p_config) {
                this.pup.width(p_config['width']);
            }
            if ('click' in p_config) {
                click = !!p_config['click'];
            }
        }

        // Write content and display
        this.pup.html(p_msg).show();

        // Make sure popup goes away on mouse out and we stop the constant 
        //  positioning on mouse moves.
        // The event obj needs to be gotten from the virtual 
        //  caller, since we use onmouseover='nhpup.popup(p_msg)' 
        //var t = this.getTarget(arguments.callee.caller.arguments[0]);

        $jq(p_target).unbind('mouseleave').bind('mouseleave', function() { nhpup.hide(); });
        if (click) {
            $jq(p_target).bind('click', function() { nhpup.hide(); });
        }
    },

    hide: function() 
    {
        if (!this.initialized || this.pup === null)
            return;
        this.pup.hide();
        this.move = false;
    },

    // set the target element position
    setElementPos: function(x, y)
    {
        // Call nudge to avoid edge overflow. Important tweak: x+10, because if
        //  the popup is where the mouse is, the hoverOver/hoverOut events flicker
        var x_y = this.nudge(x + 10, y);
        // remember: the popup is still hidden
        this.pup.css('top', x_y[1] + 'px')
                .css('left', x_y[0] + 'px');
    },

    /* Avoid edge overflow */
    nudge: function(x,y)
    {
        var win = $jq(window);

        // When the mouse is too far on the right, put window to the left
        var xtreme = $jq(document).scrollLeft() + win.width() - this.pup.width() - this.minMargin;
        if(x > xtreme) {
            x -= this.pup.width() + 2 * this.minMargin;
        }
        x = this.max(x, 0);

        // When the mouse is too far down, move window up
        if((y + this.pup.height()) > (win.height() +  $jq(document).scrollTop())) {
            y -= this.pup.height() + this.minMargin;
        }

        return [ x, y ];
    },

    /* custom max */
    max: function(a,b)
    {
        if (a>b) return a;
        else return b;
    },

    /*
     Get the target (element) of an event.
     Inspired by quirksmode
    */
    getTarget: function(e)
    {
        var targ;
        if (!e) var e = window.event;
        if (e.target) targ = e.target;
        else if (e.srcElement) targ = e.srcElement;
        if (targ.nodeType == 3) // defeat Safari bug
            targ = targ.parentNode;
        return targ;
    },

    onTouchDevice: function() 
    {
        var deviceAgent = navigator.userAgent.toLowerCase();
        return deviceAgent.match(/(iphone|ipod|ipad|android|blackberry|iemobile|opera m(ob|in)i|vodafone)/) !== null;
    },
	
    initialized: false,
    initialize : function(){
        if (this.initialized) return;

        window.$jq = jQuery; // this is safe in WP installations with noConflict mode (which is default)

        /* Prepare popup and define the mouseover callback */
        jQuery(document).ready(function () {
            // create default popup on the page
            $jq('body').append('<div id="' + nhpup.identifier + '" class="' + nhpup.identifier + '" style="position:absolute; display:none; z-index:100101;"></div>');
            nhpup.pup = $jq('#' + nhpup.identifier);

            // set dynamic coords when the mouse moves
            $jq(document).mousemove(function (e) {
                if (!nhpup.onTouchDevice()) { // turn off constant repositioning for touch devices (no use for this anyway)
                    if (nhpup.move) {
                        nhpup.setElementPos(e.pageX, e.pageY);
                    }
                }
            });
        });

        this.initialized = true;
    }
};

if ('jQuery' in window) nhpup.initialize();


setup.nhpup = nhpup;
window.nhpup = window.nhpup || nhpup;
/* twine-user-script #41: "vara.js" */
const Vara = function (elem, fontSource, text, properties) {
  var _this = this;
  this.elementName = elem;
  this.textsInit = [];
  if (typeof text == "string")
    this.textsInit.push({
      text: text,
    });
  else if (typeof text == "object") this.textsInit = text;
  this.texts = this.textsInit;
  this.properties = properties || {};
  this.properties.textAlign = this.properties.textAlign || "left";
  this.letterSpacing = 0;
  this.element = document.querySelector(this.elementName);
  this.fontSource = fontSource;
  this.characters = {};
  this.drawnCharacters = {};
  this.totalPathLength = 0;
  this.fontSize = 24;
  this.frameRate = 1000 / 30;
  this.prevDuration = 0;
  this.completed = false;
  this.ready = function (f) {
    _this.readyF = f;
  };
  this.animationEnd = function (f) {
    _this.animationEndF = f;
  };

  this.svg = this.createNode("svg", {
    width: "100%",
  });
  this.element.appendChild(this.svg);
  this.font = document.createElement("object");
  this.getSVGData();
};

/**
 * Creates SVG nodes
 * @param {string} n Name of the node to be created
 * @param {object} v Object with properties of the element
 * returns {node}
 */
Vara.prototype.createNode = function (n, v) {
  n = document.createElementNS("http://www.w3.org/2000/svg", n);
  for (var p in v)
    n.setAttributeNS(
      null,
      p.replace(/[A-Z]/g, function (m, p, o, s) {
        return "-" + m.toLowerCase();
      }),
      v[p]
    );
  return n;
};

/**
 * Used to extract data from the JSON data
 */
Vara.prototype.getSVGData = function () {
  var _this = this;
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.open("GET", this.fontSource, true);
  xmlhttp.onreadystatechange = function () {
    if (xmlhttp.readyState == 4) {
      if (xmlhttp.status == 200) {
        _this.contents = JSON.parse(xmlhttp.responseText);
        _this.characters = JSON.parse(xmlhttp.responseText).c;
        _this.preCreate();
        _this.createText();
      }
    }
  };
  xmlhttp.send(null);
};

/**
 * Used to add or change required fields provided as arguments in the class name.
 */
Vara.prototype.preCreate = function () {
  (function () {
    if (typeof NodeList.prototype.forEach === "function") return false;
    NodeList.prototype.forEach = Array.prototype.forEach;
  })();

  // If the question mark symbol exists in the loaded JSON font, then it will be used otherwise the default question mark will be used. Any symbol that is not in the JSON is replaced by a question mark.

  this.questionMark =
    this.characters["63"] == undefined
      ? {
          paths: [
            {
              w: 8.643798828125,
              h: 14.231731414794922,
              my: 22.666500004827977,
              mx: 0,
              pw: 28.2464542388916,
              d: "m 0,0 c -2,-6.01,5,-8.64,8,-3.98,2,4.09,-7,8.57,-7,11.85",
            },
            {
              w: 1.103759765625,
              h: 1.549820899963379,
              my: 8.881500004827977,
              mx: 1,
              pw: 4.466640472412109,
              d: "m 0,0 a 0.7592,0.7357,0,0,1,0,0.735,0.7592,0.7357,0,0,1,-1,-0.735,0.7592,0.7357,0,0,1,1,-0.738,0.7592,0.7357,0,0,1,0,0.738 z",
            },
          ],
          w: 8.643798828125,
        }
      : this.characters["63"];

  // A path represnting 'space'
  this.space = {
    paths: [
      {
        d: "M0,0 l" + this.contents.p.space + " 0",
        mx: 0,
        my: 0,
        w: this.contents.p.space,
        h: 0,
      },
    ],
    w: this.contents.p.space,
  };
  // analyseWidth() will return an object containing breakPoints (positions where new line occurs)
  var widthAnalysis = this.analyseWidth();
  for (var k = 0; k < this.texts.length; k++) {
    var alteredText = [];
    var textObj =
      typeof this.texts[k] == "string"
        ? {
            text: this.texts[k],
          }
        : this.texts[k];
    var textArray = textObj.text;
    for (var x = 0; x < textArray.length; x++) {
      var count = 0;
      var prevPos = 0;
      var text = textArray[x];
      /*
            If there are new lines, the string is breaked at these positions and are appended to an array.
            The value of text property in 'texts' object is replaced by this new array.
            This is done because each array inside the text property is considered as a new line when creating the text.
            */
      if (widthAnalysis.breakPoints[k][x].length > 0) {
        var newText;
        var len = widthAnalysis.breakPoints[k][x].length;
        for (var j = 0; j <= len; j++) {
          var pos = widthAnalysis.breakPoints[k][x][j];
          if (widthAnalysis.breakPoints[k][x][len - 1] != text.length)
            widthAnalysis.breakPoints[k][x].push(text.length);
          var prev =
            widthAnalysis.breakPoints[k][x][j - 1] == undefined
              ? 0
              : widthAnalysis.breakPoints[k][x][j - 1];
          newText = text.slice(prev, pos).replace(/^\s+/g, "");
          alteredText.push(newText);
        }
      } else {
        alteredText.push(textArray[x]);
      }
    }
    this.texts[k].text = alteredText;
  }
};

/**
 * creates and add the elements (letters) into the svg element.
 */
Vara.prototype.createText = function () {
  var _this = this;
  var containerGroup = this.svg;
  var correction = 0;
  var lho = 0;
  var fontSize;
  // if lineHeight is provided for a specfic paragraph, then it will be used. If it is not specified then the global 'properties' object is searched for lineHeight, if it is provided then it will be used. Otherwise the default lineHeight provided in the JSON font object will be used.
  var lineHeight =
    this.properties.lineHeight == undefined
      ? this.contents.p.lh
      : this.properties.lineHeight;
  this.properties.autoAnimation =
    this.properties.autoAnimation == undefined
      ? true
      : this.properties.autoAnimation;
  var prevOuterHeight = 0;
  var prevDuration = 0;
  // incrementOuterHeight determines whether to add new paragraphs below the previous paragraph.
  var incrementOuterHeight = true;
  for (var j = 0; j < this.texts.length; j++) {
    var drawnPart = [];
    var lhi = 0;
    fontSize = this.texts[j].fontSize;
    var bsw = this.texts[j].strokeWidth;
    var color =
      this.texts[j].color == undefined
        ? this.properties.color == undefined
          ? "black"
          : this.properties.color
        : this.texts[j].color;
    var duration =
      this.texts[j].duration == undefined
        ? this.properties.duration == undefined
          ? 2000
          : this.properties.duration
        : this.texts[j].duration;
    this.texts[j].duration = duration;
    var id = this.texts[j].id == undefined ? j : this.texts[j].id;
    this.texts[j].delay =
      this.texts[j].delay == undefined ? 0 : this.texts[j].delay;
    this.prevDuration += this.texts[j].delay;
    /* If the y coordinate of the paragraph is given and the property `fromCurrentPosition` is set to false then the text is drawn at the 	 absolute position given.
           If the y coordinate of the paragraph is given and the property `fromCurrentPosition` is not set or set to true then the text is drawn relative to the previous element. That is if the y values is given as 50, then the element will be created 50px below the previous one.
        */
    if (this.texts[j].fromCurrentPosition == undefined)
      this.texts[j].fromCurrentPosition = {
        x: true,
        y: true,
      };
    if (this.texts[j].y == undefined) incrementOuterHeight = true;
    else if (
      this.texts[j].fromCurrentPosition.y == undefined ||
      this.texts[j].fromCurrentPosition.y
    )
      incrementOuterHeight = true;
    else incrementOuterHeight = false;
    var tc = color;
    var textAlign =
      this.texts[j].textAlign == undefined
        ? this.properties.textAlign
        : this.texts[j].textAlign;
    lineHeight =
      this.texts[j].lineHeight == undefined
        ? lineHeight
        : this.texts[j].lineHeight / fontSize;
    // outerLayer is used to contain the entire paragraph.
    var outerLayer = this.createNode("g", {
      class: "outer",
      transform: "translate(0,0)",
      "data-text": this.texts[j].text,
    });
    containerGroup.appendChild(outerLayer);
    lho = prevOuterHeight;
    var ph = 0;
    for (var x = 0; x < this.texts[j].text.length; x++) {
      var cWidth = 0;
      // used to contain the current line.
      var fg = this.createNode("g");
      outerLayer.appendChild(fg);
      var largestHeight = 0;
      var lFH = 0;
      for (var i = 0; i < this.texts[j].text[x].length; i++) {
        var text = this.texts[j].text[x][i];
        // Group which contains the letter
        var cGroup = this.createNode("g");
        fg.appendChild(cGroup);
        var correction = 0;
        var paths =
          this.characters[text.charCodeAt(0)] != undefined || text == " "
            ? text == " "
              ? this.space.paths
              : this.characters[text.charCodeAt(0)].paths
            : this.questionMark.paths;
        if (text == " ") color = "transparent";
        else color = tc;
        paths.forEach(function (e, ei) {
          var path = _this.createNode("path", {
            d: e.d,
            "stroke-width": bsw,
            stroke: color,
            fill: "none",
            "stroke-linecap": _this.contents.p.slc,
            "stroke-linejoin": _this.contents.p.slj,
          });
          cGroup.appendChild(path);
          path.setAttribute(
            "transform",
            "translate(" + e.mx + "," + -e.my + ")"
          );
          largestHeight =
            largestHeight > e.my - path.getBBox().y
              ? largestHeight
              : e.my - path.getBBox().y;
          if (ei == 0) lFH = largestHeight;
          path.style.opacity = 0;
          /*
                    Adding 2 and 1 to solve a bug on Chrome or (Firefox and Edge). (I don't know which browsers are showing the correct output)
                    https://stackoverflow.com/questions/53626733/dot-appears-before-line-with-round-linecap-ff-ie/53627545#53627545
                    */
          path.style.strokeDasharray =
            path.getTotalLength() + " " + (path.getTotalLength() + 2);
          path.style.strokeDashoffset = path.getTotalLength() + 1;
        });
        drawnPart.push(cGroup);
        var correction = cGroup.getBBox().x * fontSize;
        var letterSpacing = this.texts[j].letterSpacing;
        if (typeof letterSpacing === "object") {
          letterSpacing =
            letterSpacing[text] === undefined
              ? letterSpacing["global"] === undefined
                ? 0
                : letterSpacing["global"]
              : letterSpacing[text];
        }
        if (cGroup.getBBox().width < this.texts[j].minWidth)
          correction =
            correction - (this.texts[j].minWidth - cGroup.getBBox().width) / 2;

        cGroup.setAttribute(
          "transform",
          "translate(" +
            (cWidth - correction + letterSpacing) +
            ",0)  scale(" +
            fontSize +
            ")"
        );

        cWidth += cGroup.getBBox().width * fontSize + letterSpacing;

        if (cGroup.getBBox().width < this.texts[j].minWidth)
          cWidth += this.texts[j].minWidth - cGroup.getBBox().width;
      }
      var fgBox = fg.getBBox();
      fg.setAttribute(
        "transform",
        "translate(" + bsw * fontSize + "," + (-fgBox.y + bsw * fontSize) + ")"
      );
      var alignX = 0;
      if (textAlign == "center") {
        alignX = (this.svg.getBoundingClientRect().width - fgBox.width) / 2;
      } else if (textAlign == "right") {
        alignX = this.svg.getBoundingClientRect().width - fgBox.width;
      }
      this.setPosition(fg, {
        x: alignX,
        y: lhi + this.contents.p.tf * fontSize - largestHeight,
      });
      // Increment line position as each line is created.
      lhi += lineHeight * fontSize;
      ph +=
        this.contents.p.tf * fontSize + (this.contents.p.tf * fontSize - lFH);
    }
    if (
      this.texts[j].y == undefined ||
      this.texts[j].fromCurrentPosition.y == true
    ) {
      this.setPosition(outerLayer, {
        y: lho,
      });
    }
    if (
      this.texts[j].fromCurrentPosition != undefined &&
      this.texts[j].fromCurrentPosition.y
    ) {
      prevOuterHeight += this.texts[j].y == undefined ? 0 : this.texts[j].y;
    }
    this.setPosition(
      outerLayer,
      {
        x: this.texts[j].x,
        y: this.texts[j].y,
      },
      this.texts[j].fromCurrentPosition
    );
    if (incrementOuterHeight) prevOuterHeight += ph;
    if (this.drawnCharacters[id] != undefined) id = j;
    this.drawnCharacters[id] = {
      characters: drawnPart,
      queued: this.texts[j].queued,
      container: outerLayer,
      index: j,
    };
    if (
      (this.texts[j].autoAnimation == undefined ||
        this.texts[j].autoAnimation) &&
      this.properties.autoAnimation
    ) {
      _this.draw(id, duration);
      if (this.texts[j].queued == undefined || this.texts[j].queued) {
        _this.prevDuration += duration;
      }
    }
  }
  this.completed = true;
  this.svg.setAttribute(
    "height",
    this.svg.getBBox().height + this.svg.getBBox().y + 10
  );
  if (this.readyF) this.readyF();
};

Vara.prototype.playAll = function () {
  this.prevDuration = 0;
  for (var j = 0; j < this.texts.length; j++) {
    var duration = this.texts[j].duration;
    var id = this.texts[j].id == undefined ? j : this.texts[j].id;
    this.prevDuration += this.texts[j].delay;
    this.draw(id, duration);
    if (this.texts[j].queued == undefined || this.texts[j].queued) {
      this.prevDuration += duration;
    }
  }
};

/**
 * Animates the drawing of the text
 * @param {int} id index or id of the paragraph to be animated.
 * @param {int} duration Duration of the animation in milliseconds
 */
Vara.prototype.draw = function (id, dur) {
  /*
    This will iterate through each character, finds its path length and the total duration is divided with respect to its path length.
    */
  var _this = this;
  if (this.drawnCharacters[id] == undefined) {
    console.warn("ID:`" + id + "` not found. Animation skipped");
    console.trace();
    return;
  }
  var duration =
    dur === undefined
      ? this.texts[this.drawnCharacters[id].index].duration
      : dur;
  var pathLength = this.getSectionPathLength(id);
  var delay = 0;
  var queued =
    this.drawnCharacters[id].queued == undefined
      ? true
      : this.drawnCharacters[id].queued;
  var timeOut = queued ? this.prevDuration : 1;
  setTimeout(function () {
    _this.drawnCharacters[id].characters.forEach(function (i) {
      i.querySelectorAll("path").forEach(function (j) {
        var currentDuration =
          (parseFloat(j.style.strokeDashoffset) / pathLength) * duration;
        j.style.opacity = 1;
        _this.animate(j, currentDuration, delay, 0);
        delay += currentDuration;
      });
    });
    setTimeout(function () {
      if (_this.animationEndF) {
        _this.animationEndF(id, _this.drawnCharacters[id]);
      }
    }, delay);
  }, timeOut);
};

Vara.prototype.get = function (id) {
  var _this = this;
  if (this.drawnCharacters[id] == undefined) {
    console.warn("ID:`" + id + "` not found.");
    console.trace();
    return false;
  }
  return this.drawnCharacters[id];
};
/**
 * Handles animation of the stroke dashoffset
 * @param {Node} elem Element to be animated
 * @param {int} duration Duration of the animation
 * @param {int} delay Delay
 * @param {int} final Final position of the stroke Dashoffset
 */
Vara.prototype.animate = function (elem, duration, delay, final) {
  var _this = this;
  final = Number(final) || 0;
  setTimeout(function () {
    var start = new Date().getTime();
    var initial = parseFloat(elem.style.strokeDashoffset);
    var timer = setInterval(function () {
      var step = Math.min(1, (new Date().getTime() - start) / duration);
      var x = initial + step * (final - initial);
      elem.style.strokeDashoffset = initial + step * (final - initial);
      if (step == 1) clearInterval(timer);
    }, _this.frameRate);
  }, delay);
};
/**
 * Gets the path length of the entire paragraph
 * @param {int} id Index (id) of the paragraph
 */
Vara.prototype.getSectionPathLength = function (id) {
  var _this = this;
  this.totalPathLength = 0;
  this.drawnCharacters[id].characters.forEach(function (i) {
    i.querySelectorAll("path").forEach(function (j) {
      _this.totalPathLength += j.getTotalLength();
    });
  });
  return this.totalPathLength;
};

/**
 * analyseWidth scans through each element and determines the position of each characters.
 * @returns {object} Object containing width and an array of breakPoints.
 */
Vara.prototype.analyseWidth = function () {
  var width = 0;
  var canvasOriginalWidth = this.svg.getBoundingClientRect().width;
  // breakPoints will store the position where a new line appears.
  var breakPoints = [];
  /* baseLetter is a reference character.
       The character representing the given letter will be appended to the container element as a span element.
       Then its width is calculated and is considered as the refernce width.
       All other characters are scaled according to the reference width.
    */
  var baseLetter =
    this.characters["97"] == undefined
      ? Object.keys(this.characters)[
          Math.round(Math.random() * Object.keys(this.characters).length - 1)
        ]
      : "97";
  var baseFont = document.createElement("span");
  this.element.appendChild(baseFont);
  baseFont.style.opacity = 0;
  baseFont.style.position = "absolute";
  baseFont.innerHTML = String.fromCharCode(baseLetter);
  /*
    This element is added to calculate the width a dot takes with space on either sides.
    This width is then set as the min width because otherwise small characters like dot, comma etc will stick to the previous characters making it hard to see.
    Required width is added to either sides of the characters having width less than the min width
    */
  var dot = document.createElement("span");
  this.element.appendChild(dot);
  dot.style.opacity = 0;
  dot.style.position = "absolute";
  dot.innerHTML = " . ";
  for (var j = 0; j < this.texts.length; j++) {
    var textArray,
      textObj = this.texts[j];
    // If the text is given as a string, it is converted into an array
    if (typeof textObj.text == "string") textArray = [textObj.text];
    else textArray = textObj.text;
    this.texts[j].text = textArray;
    this.texts[j].letterSpacing =
      this.texts[j].letterSpacing == undefined
        ? this.properties.letterSpacing == undefined
          ? 0
          : this.properties.letterSpacing
        : this.texts[j].letterSpacing;
    this.texts[j].strokeWidth =
      this.texts[j].strokeWidth == undefined
        ? this.properties.strokeWidth == undefined
          ? this.contents.p.bsw
          : this.properties.strokeWidth
        : this.texts[j].strokeWidth;
    // Whether to break the word on overflow.
    var breakWord =
      this.texts[j].breakWord == undefined
        ? this.properties.breakWord == undefined
          ? false
          : this.properties.breakWord
        : this.texts[j].breakWord;
    var originalBreakWord = breakWord;
    var fontSize =
      textObj.fontSize == undefined
        ? this.properties.fontSize == undefined
          ? this.fontSize
          : this.properties.fontSize
        : textObj.fontSize;
    baseFont.style.fontSize = fontSize + "px";
    dot.style.fontSize = fontSize + "px";
    var scale =
      baseFont.getBoundingClientRect().width / this.characters[baseLetter].w;
    this.texts[j].minWidth = dot.getBoundingClientRect().width;

    // if a width is specified, overflow, textAlign and other properties will be calculated with respect to the given width. Otherwise the width of the SVG element will be used.
    var canvasWidth =
      this.texts[j].width == undefined
        ? canvasOriginalWidth
        : this.texts[j].width;
    var bp1 = [];
    var increment;
    var inx = this.texts[j].x == undefined ? 0 : this.texts[j].x;
    this.trueFontSize = fontSize;
    this.texts[j].fontSize = scale;

    var letterSpacing = this.texts[j].letterSpacing;
    /*
        Each character is iterated and is added to the variable lWidth. If the x coordinate of the paragraph is given lWidth will be initialized with the x coordinate.
        if the width exceeds the canvasWidth, then its array index value is appended to the breakPoints array.
        breakPoints represents the indices where a new line appears.
        */
    for (var x = 0; x < textArray.length; x++) {
      var lWidth = inx;
      var bp2 = [];
      var text = textArray[x];
      var lastSpace = 0;
      for (var i = 0; i < text.length; i++) {
        if (typeof letterSpacing === "object") {
          if (typeof letterSpacing === "object") {
            letterSpacing =
              letterSpacing[text] === undefined
                ? letterSpacing["global"] === undefined
                  ? 0
                  : letterSpacing["global"]
                : letterSpacing[text];
          }
        }
        if (this.characters[text[i].charCodeAt(0)] != undefined) {
          increment = this.characters[text[i].charCodeAt(0)].w * scale;
          if (increment < this.texts[j].minWidth)
            increment +=
              (scale *
                (this.texts[j].minWidth -
                  this.characters[text[i].charCodeAt(0)].w)) /
              2;
          increment += letterSpacing;
        } else {
          if (text[i] == " ") {
            increment = this.space.w * scale;
            lastSpace = lWidth;
          } else increment = this.questionMark.w * scale + letterSpacing;
        }
        increment += this.texts[j].strokeWidth * scale;
        if (lWidth + increment >= canvasWidth) {
          if (lastSpace == 0) breakWord = true;
          var pos = i;
          if (text[i] != " " && !breakWord) {
            pos = text.slice(0, pos + 1).search(/\S+$/);
          }
          bp2.push(pos);
          lWidth = inx + lWidth - lastSpace;
        } else {
          width += increment;
          lWidth += increment;
        }
      }
      bp1.push(bp2);
    }
    breakPoints.push(bp1);
  }
  baseFont.parentNode.removeChild(baseFont);
  dot.parentNode.removeChild(dot);
  return {
    width: width,
    breakPoints: breakPoints,
  };
};
/**
 * Sets the position of the node
 * @param {Node} e Element
 * @param {object} obj Object with the x and y coordinates
 * @param {object} relative Object with properties x and y determining whether the respective coordinate is relative to the previous element position
 */
Vara.prototype.setPosition = function (e, obj, relative) {
  var relative =
    relative == undefined
      ? {
          x: false,
          y: false,
        }
      : relative;
  relative.x = relative.x == undefined ? false : relative.x;
  relative.y = relative.y == undefined ? false : relative.y;
  var p = e.transform.baseVal.consolidate().matrix;

  var x = p.e,
    y = p.f;
  if (obj.x != undefined) {
    if (relative.x) x = x + obj.x;
    else x = obj.x;
  }
  if (obj.y != undefined) {
    if (relative.y) y = y + obj.y;
    else y = obj.y - e.getBBox().y;
  }

  var translate = this.svg.createSVGTransform();
  translate.setTranslate(x, y);

  e.transform.baseVal.replaceItem(translate, 0);

  /*
	This was the initial way i chose to set position, but it is not supported in safari.
	e.transform.baseVal.consolidate().setTranslate(x, y);

	*/
};

if (typeof module !== "undefined") {
  module.exports = Vara;
} else {
  window.Vara = Vara;
}
/* twine-user-script #42: "settings.js" */
// Setting up a list control for the settings property 'theme' w/ callbacks
// var settingThemeNames = ["(none)", "Bright Lights", "Charcoal", "Midnight", "Tinsel City"];
// var settingThemeHandler = function () {
// 	// cache the jQuery-wrapped <html> element
// 	var $html = $("html");

// 	// remove any existing theme class
// 	$html.removeClass("theme-bright-lights theme-charcoal theme-midnight theme-tinsel-city");

// 	// switch on the theme name to add the requested theme class
// 	switch (settings.theme) {
// 	case "Bright Lights":
// 		$html.addClass("theme-bright-lights");
// 		break;
// 	case "Charcoal":
// 		$html.addClass("theme-charcoal");
// 		break;
// 	case "Midnight":
// 		$html.addClass("theme-midnight");
// 		break;
// 	case "Tinsel City":
// 		$html.addClass("theme-tinsel-city");
// 		break;
// 	}
// };
function updateImages() {
    $('img.themed').each(function () {
        if ($(this).hasClass('portrait')) {
            $(this).attr('src', getPortrait($(this).attr('character')));
        } else {
            $(this).attr('src', $(this).attr('src-orig').replace("{theme}", getTheme()));
        }
    });
}

function updateDebug() {
    Engine.show();
}

function updateVideos() {
    $('video').each(function () {
        $(this)[0].muted = !settings.sound;
        $(this)[0].volume = settings.videoVolume;
    });
}

Setting.addHeader("Theme Settings");

Setting.addList("theme", {
	label    : "Choose a portrait theme.",
	list     : ["PixelArt", "Anime", "Fantasy", "Furry"],
	onChange : updateImages,
    default  : "Fantasy"
}); 

Setting.addHeader("Content Settings");


Setting.addToggle("vids", {
	label   : "Enable porn videos.",
    default : true
}); 

Setting.addToggle("staticons",  {
	label   : "Enable icons showing stat gains on decisions.",
    default : true
}); 

Setting.addToggle("skipminigames", {
	label   : "Skip minigames.",
    default : false
}); 

Setting.addToggle("debug", {
    label    : "Debug mode.",
	onChange : updateDebug,
    default  : false
});


Setting.addHeader("Kink Settings");

Setting.addToggle("cum", {
	label   : "Enable cum-play and cum fetish content.",
    default : true
}); 

Setting.addToggle("sph", {
	label   : "Enable small penis humiliation (sph) content.",
    default : false
}); 

Setting.addToggle("bread", {
	label   : "Enable sexy bread fetish content (April Fools' content).",
    default : false
}); 

// Setting.addToggle("watersports", {
// 	label   : "Enable pissing (watersports) content.",
//     default : false
// }); 


Setting.addHeader("Audio Settings");

Setting.addToggle("sound", {
	label   : "Enable all sounds.",
	onChange : function() {
        updateVideos();
        updateMusic();
    },
    default : true
}); 

// Setting.addRange("musicVolume", {
// 	label    : "Music volume.",
// 	min      : 0,
// 	max      : 1,
// 	step     : 0.1,
//     default : 0.5
// });

// Setting.addRange("ambientVolume", {
// 	label    : "Volume of ambient sounds.",
// 	min      : 0,
// 	max      : 1,
// 	step     : 0.1,
//     default : 0.5
// });

Setting.addRange("videoVolume", {
	label    : "Volume of video sounds.",
	min      : 0,
	max      : 1,
	step     : 0.01,
    default : 0.2,
	onChange : updateVideos
});

Setting.addRange("musicVolume", {
	label    : "Volume of background music.",
	min      : 0,
	max      : 1,
	step     : 0.01,
    default : 0.05,
	onChange : updateMusic
});

function getTheme() {
    switch (settings.theme) {
        case "Fantasy":
            return "fantasy";
        case "Anime":
            return "anime";
        case "PixelArt":
            return "pixel";
        case "Furry":
            return "furry";
    }
}


// setup.getTheme = getTheme;
// window.getTheme = window.getTheme || getTheme;


$(document).one(':passagestart', function () {
    Save.onLoad.add(function (save) {
        if (save.metadata) {
            settings = save.metadata;
            Setting.save();
        }
    });

    Save.onSave.add(function (save, details) {
        if (details.type === 'disk') {
            save.metadata = settings;
        }
    });
});
/* twine-user-script #43: "templates.js" */
// Player names

Template.add('name', function() {
    return "<<title player '" + (isDisguised() ? variables().player.newname : variables().player.name) + "'>>";
});
Template.add('newname', function() {
    return "<<title player '" + variables().player.newname + "'>>";
});

// Player's titles


var prince = [ 
    { word: 'my prince', chance: 0.4 }, 
    { word: 'your highness', chance: 0.2 },
    { word: 'your grace', chance: 0.2 },
    { word: 'your majesty', chance: 0.10 },
    { word: 'your royal highness', chance: 0.05 },
    { word: 'sire', chance: 0.03 },
    { word: 'my liege', chance: 0.02 },
];
var princess = [
    { word: 'princess', chance: 0.5 }, 
    { word: 'your highness', chance: 0.15 },
    { word: 'your grace', chance: 0.15 },
    { word: 'your majesty', chance: 0.15 },
    { word: 'your royal highness', chance: 0.05 }
];
var kathrynTitles = [
    { word: 'little prince', chance: 0.6 }, 
    { word: 'princey', chance: 0.3 },
    { word: 'little lord', chance: 0.1 }
];
var rosaTitles = [
    { word: "m'lord", chance: 0.7 }, 
    { word: 'your lordship', chance: 0.3 }
];
var devotaTitles = [
    { word: 'my child', chance: 0.3 }, 
    { word: 'my son', chance: 0.3 }, 
    { word: 'my prince', chance: 0.2 }, 
    { word: 'your highness', chance: 0.1 },
    { word: 'your grace', chance: 0.05 },
    { word: 'your majesty', chance: 0.05 }
];

Template.add('title', function() {
    return "<<title player '" + getRandomWord(prince) + "'>>";
});
Template.add('Title', function() {
    return "<<title player '" + getRandomWord(prince).toUpperFirst() + "'>>";
});

Template.add('titleK', function() {
    return "<<title player '" + getRandomWord(kathrynTitles) + "'>>";
});
Template.add('TitleK', function() {
    return "<<title player '" + getRandomWord(kathrynTitles).toUpperFirst() + "'>>";
});

Template.add('titleR', function() {
    return '<<title player "' + getRandomWord(rosaTitles) + '">>';
});
Template.add('TitleR', function() {
    return '<<title player "' + getRandomWord(rosaTitles).toUpperFirst() + '">>';
});

Template.add('titleD', function() {
    return "<<title player '" + getRandomWord(devotaTitles) + "'>>";
});
Template.add('TitleD', function() {
    return "<<title player '" + getRandomWord(devotaTitles).toUpperFirst() + "'>>";
});

// Pronouns (currently based on what the prince is wearing)

var pronouns = [ 
    [ 'he',         'she',          'they' ], 
    [ 'him',        'her',          'them' ], 
    [ 'his',        'her',          'their' ], 
    [ 'his',        'hers',         'theirs' ], 
    [ 'himself',    'herself',      'themself' ],
    [ 'man',        'woman',        'person' ],
    [ 'boy',        'girl',         'person' ]
];

function pronoun(type, capital, reason) {
    if (typeof type === 'string') {
        switch (type) {
            case 'subject': type = 0; break;
            case 'object': type = 1; break;
            case 'adjective': type = 2; break;
            case 'possessive': type = 3; break;
            case 'reflexive': type = 4; break;
            case 'gender': type = 5; break;
            case 'gender_2': type = 6; break;
        }
    }
    let gender = 0;
    if (reason === 'identity') {
        gender = hasTag('crossdresser') ? 1 : 0;
    } else { //if (reason === 'expression')
        gender = hasClothesTag('feminine') ? 1 : 0;
    }
    let pronoun = pronouns[type][gender];
    if (capital)
        pronoun = upperFirst(pronoun);
    return pronoun;
}

Template.add(['subject', 'they', 'he', 'she', 'Subject', 'They', 'He', 'She'], function() {
    return pronoun(0, isCapitalised(this.name), 'expression');
});

Template.add(['object', 'them', 'him', 'her', 'Object', 'Them', 'Him', 'Her'], function() {
    return pronoun(1, isCapitalised(this.name), 'expression');
});

Template.add(['adjective', 'their', 'his', 'Adjective', 'Their', 'His'], function() {
    return pronoun(2, isCapitalised(this.name), 'expression');
});

Template.add(['possessive', 'theirs', 'hers', 'Possessive', 'Theirs', 'Hers'], function() {
    return pronoun(3, isCapitalised(this.name), 'expression');
});

Template.add(['reflexive', 'themself', 'himself', 'herself', 'Reflexive', 'Themself', 'Himself', 'Herself'], function() {
    return pronoun(4, isCapitalised(this.name), 'expression');
});

Template.add(['gender', 'man', 'woman', 'person', 'Man', 'Woman', 'Person'], function() {
    return pronoun(5, isCapitalised(this.name), 'expression');
});

Template.add(['gender_2', 'boy', 'girl', 'Boy', 'Girl'], function() {
    return pronoun(6, isCapitalised(this.name), 'expression');
});

// Misc

Template.add('nl', function () {
	return '<br><br>';
});

Template.add('noble', function () {
	return '<<noble>>';
});

Template.add('dish', function () {
	return '<<dish>>';
});

Template.add('kingdom', function() {
    return '<span class="special gold">Avelon</span>';
});

Template.add('reliquary', function() {
    return '<span class="special gold">Royal Reliquary</span>';
});

Template.add('essence', function() {
    return settings.cum ? either('cum', '\'essence\'') : 'essence';
});

Template.add('tavern', function() {
    if (settings.sph) {
        return '<span class="special brown">the Twig and Berries</span>';
    }
    return '<span class="special brown">the Branch and Apples</span>';
});

Template.add(['barworker', 'barmaid', 'waiter'], function() {
    return hasTag('crossdresser') ? 'barmaid' : 'waiter';
});

Template.add(['Barworker', 'Barmaid', 'Waiter'], function() {
    return hasTag('crossdresser') ? 'Barmaid' : 'Waiter';
});

Template.add(['time', 'Time'], function() {
    return isCapitalised(this.name) ? upperFirst(getTime()) : getTime();
});

Template.add(['day', 'Day'], function() {
    return upperFirst(getDay());
});

function greeting(capital) {
    switch (getTime()) {
        case 'morning':
            return (capital ? 'G' : 'g') + 'ood morning';
        case 'noon':
            return (capital ? 'G' : 'g') + 'ood afternoon';
        case 'evening':
        case 'night':
            return (capital ? 'G' : 'g') + 'ood evening';
    }
}

Template.add(['greeting', 'Greeting'], function() {
    return greeting(isCapitalised(this.name));
});

// Player

var sissyPrefix = ['useless '];
var sphPrefix = ['tiny ', 'little ', 'cute ', 'small '];
var bigDickPrefix = [ 'massive ', 'huge ', 'large ', 'big ', 'thick '];
var arousedPrefix = [ 'hard ', 'rock hard ', 'erect '];

var sissyDicks = ['clitty', 'boyclit', 'cocklet'];
var sphDicks = ['dicklet', 'pecker'];
var dicks = ['dick', 'cock', 'penis'];

var asses = [ 
    { word: 'ass', chance: 0.4 }, 
    { word: 'butt', chance: 0.4 },
    { word: 'booty', chance: 0.1 },
    { word: 'rear', chance: 0.05 },
    { word: 'behind', chance: 0.05 }
];

function penisTemplate() {
    if (settings.bread) {
        if (penis() === 'big')
            return either(['big baguette', 'large loaf', 'huge brioche', 'thick ciabatta']);
        if (penis() === 'medium')
            return either(['bread stick', 'bread roll', 'hot dog bun', 'pumpernickel']);

        return either(['little bread roll', 'tiny biscuit', 'little breadlet', 'little muffin', 'tiny crumpet', 'small bun', 'tiny croissant']);
    }

    let prefix = [''];

    if (Math.random() > 0.3) {
        if (hasTag('sissy')) 
            prefix.push(...sissyPrefix);
        if (settings.sph) 
            prefix.push(...sphPrefix);
        if (!isInChastity()) {
            if (penis() === 'big') 
                prefix.push(...bigDickPrefix);
            if (erect() === 'erect') 
                prefix.push(...arousedPrefix);
        }
    }

    let suffix = [];
    suffix.push(...dicks);

    if (settings.sph)
        suffix.push(...sphDicks);
    if (hasTag('sissy'))
        suffix.push(...sissyDicks);

    return either(prefix) + either(suffix);
}

function chestTemplate() {
    return (chest() === 'small' ? either('small ', 'budding ', '') : '') + (hasBoobs() ? either('titties', 'boobs', 'tits', 'breasts') : 'flat chest');
}

function assTemplate() {
    return (assValue() > 0 ? either('round ', 'firm ', '') : '') + getRandomWord(asses);
}


setup.penisTemplate = penisTemplate;
window.penisTemplate = window.penisTemplate || penisTemplate;
setup.chestTemplate = chestTemplate;
window.chestTemplate = window.chestTemplate || chestTemplate;
setup.assTemplate = assTemplate;
window.assTemplate = window.assTemplate || assTemplate;

Template.add(['dick', 'cock', 'penis'], function() {
    return '<<bodyspan penis>>';
});

Template.add(['boobs', 'titties', 'tits', 'breasts', 'chest'], function() {
    return '<<bodyspan chest>>';
});

Template.add(['ass', 'butt', 'behind', 'rear', 'booty'], function() {
    return assTemplate();
});

Template.add(['asshole'], function() {
    return either('tight ', '') + either('asshole', 'bussy', 'boy pussy');
});




/* twine-user-script #44: "version.js" */
// Current save version
// The least significant 2 digits define the small update letter. 01 = a, 26 = z, anything larger should be avoided
// The next digits all define the numbers in the version numbers in between the points, each part has two digits, except for the most significant version number (left most), any larger number is put into that. (not like that'll ever be needed)
//1 = v0.0.0a
//100 = v0.0.1
//10000 = v0.1.0
//10000000 = v1.0.0
//26 = v0.0.0z
//9926 = v0.0.99z
//999926 = v0.99.99z
//99999926 = v99.99.99z
Config.saves.version = 30300;
Config.saves.autosave = false;

function getVersion($output) {
    let version = numberToVersion(Config.saves.version);

    if ($output) {
        if (!($output instanceof $)) {
            $output = $($output);
        }
        $(document.createElement('span')).wiki(version).appendTo($output);
    }

    return version;
}

function numberToVersion(v) {
    let version = '';
    if (v > 999999) {
        let hv = Math.floor(v / 1000000);
        version += hv + '.';
        v -= hv * 1000000;
    } else {
        version += '0.';
    }
    if (v > 9999) {
        let hv = Math.floor(v / 10000);
        version += hv + '.';
        v -= hv * 10000;
    } else {
        version += '0.';
    }
    if (v > 99) {
        let hv = Math.floor(v / 100);
        version += hv;
        v -= hv * 100;
    } else {
        version += '0';
    }
    if (v > 0) {
        version += (v + 9).toString(36);
    }

    return version;
}


Macro.add('version', {
    handler : function () {
        getVersion(this.output);
    }
});

Save.onLoad.add(function (save) {
    if (!Number.isInteger(save.version)) {
        throw new Error('Save version is unsupported for this version of the game. Game version: ' + getVersion() + '. Save version: ' + save.version);
    }
    if (save.version < 30000) {
        throw new Error('Save version is unsupported for this version of the game. Game version: ' + getVersion() + '. Save version: ' + numberToVersion(save.version) + '. Please restart the game to play.');
    }
    if (save.version > Config.saves.version) {
        throw new Error('Save version is of a newer version than the game itself. Game version: ' + getVersion() + '. Save version: ' + numberToVersion(save.version));
    }
    let originalVersion = save.version;

    // if (save.version === 20800) {
    //     let waterfalls = save.state.history.filter((moment) => moment.title === 'Waterfall Relax'); 
    //     if (waterfalls.length > 1) {
    //         for (let i = 0; i < save.state.history.length; ++i) {
    //             let v = save.state.history[i].variables;
    //             v.tags.pushUnique('lumberjack-waterfall');
    //         }
    //     }
        
    //     save.version = 20900;
    // }

    if (save.version < 30002) {
        save.version = 30002;
    }

    if (save.version < 30100) {
        if (settings.bread) {
            settings.bread = false;
            Setting.save();
        }
        save.version = 30100;
    }

    if (save.version < 30200) {

        for (let i = 0; i < save.state.history.length; ++i) {
            let v = save.state.history[i].variables;

            v.player['comport'] = 0;
            v.player['fashion'] = 0;
            v.player['etiquette'] = 0;

            v.day = v['%%cycles'].day.stack % 7;
            v.time = v['%%cycles'].time.stack % 4;
            v.week = 1;

            delete v['%%cycles'];
        }

        save.version = 30200;
    }

    if (save.version < 30300) {
        // for (let i = 0; i < save.state.history.length; ++i) {
        //     let v = save.state.history[i].variables;
        //     v.dilemmas = [];
        //     v.kingdom = {
        //         stability: 0,
        //         authority: 0,
        //         treasury: 0,
        //         whispers: 0,
        //         welfare: 0
        //     };
        // }

        save.version = 30300;
    }

    if (originalVersion !== save.version) {
        Engine.play('Changelog', true);
    }
});

$(document).on(':passageinit', function (ev) {
    //Add missing characters here
    if (settings.bread && !hasCharacter('bread')) {
        addCharacter('bread');
    } else if (!settings.bread && hasCharacter('bread')) {
        removeCharacter('bread');
    }
    if (variables().inventory.crotch === 'chastity_pink_1') {
        variables().inventory.crotch = 'chastity_pink_big';
    }
    if (!hasCharacter('devota')) {
        removeCharacter('dominic');
        addCharacter('devota');
    }
});

$(document).on(':passagestart', function (ev) {
    //Fix tags and quests here
    if (hasTag('rosa-bouquet')) {
        removeTag('rosa-bouquet');
        startQuest('rosa-bouquet');
    }
});


</script><tw-passagedata pid="1" name="StoryBanner" tags="" position="100,100" size="100,100"></tw-passagedata><tw-passagedata pid="2" name="StoryDisplayTitle" tags="" position="225,100" size="100,100">&lt;&lt;if hasTag(&#39;princess&#39;)&gt;&gt;
a Princess tale
&lt;&lt;else&gt;&gt;
a Prince&#39;s tale
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="3" name="StorySubtitle" tags="" position="350,100" size="100,100">Version &lt;&lt;version&gt;&gt;</tw-passagedata><tw-passagedata pid="4" name="StoryAuthor" tags="" position="475,100" size="100,100">/* tiny-pastry */</tw-passagedata><tw-passagedata pid="5" name="PassageReady" tags="" position="600,100" size="100,100"></tw-passagedata><tw-passagedata pid="6" name="PassageDone" tags="" position="725,100" size="100,100"></tw-passagedata><tw-passagedata pid="7" name="PassageHeader" tags="" position="850,100" size="100,100"></tw-passagedata><tw-passagedata pid="8" name="PassageFooter" tags="" position="975,100" size="100,100"></tw-passagedata><tw-passagedata pid="9" name="Artifacts Selection" tags="" position="1100,100" size="100,100">Before you stands several pillars with different artifacts laid out on top of them. It seems like ?Leopold has already made a selection for you to pick from.

&lt;&lt;artifacts true&gt;&gt;

&lt;&lt;decision &#39;Return&#39; &#39;Treasury&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="10" name="Artifact Info chalk" tags="" position="1225,100" size="100,100">&lt;&lt;img &#39;artifacts/chalk.jpg&#39; &#39;ridge-border&#39; &#39;12em&#39;&gt;&gt;
On one of the pedestals lies a small pile of yellow colored chalk sticks. You grab one of the sticks and inspect it, you definitely feel a magic glowing from the chalk.
&lt;&lt;leopold&gt;&gt;Oh the chalk has taken your interest? It&#39;s quite fascinating stuff.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;player&gt;&gt;What does it do?&lt;&lt;/player&gt;&gt;
?Leopold walks next to you and grabs another chalk stick from the pile.
&lt;&lt;leopold&gt;&gt;It&#39;s quite useful actually, when used to draw two circles of specific glyphs on the floor it allows a person to teleport between the two circles.&lt;&lt;/leopold&gt;&gt; 
&lt;&lt;player&gt;&gt;You&#39;re saying this chalk allows us to teleport ourselves? That sounds really useful!&lt;&lt;/player&gt;&gt;
&lt;&lt;leopold&gt;&gt;What&#39;s even better is that the chalk seems to automatically regenerate itself after usage so there&#39;s not really a fear of running out.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;player&gt;&gt;Why aren&#39;t we using this stuff for everything?&lt;&lt;/player&gt;&gt;
&lt;&lt;leopold&gt;&gt;Well for one, the circles can only be bound to one person at a time so it really doesn&#39;t work for mass transportation and besides, your father never quite trusted the stuff, ordering it to stay in the vault. ?Morgana assured me there&#39;s nothing to be scared off though, it should be completely safe.&lt;&lt;/leopold&gt;&gt;

&lt;&lt;leopold&gt;&gt;Do you wish to take this artifact as your reward?&lt;&lt;/leopold&gt;&gt;

&lt;&lt;decision &#39;Pick this artifact&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Yes, I would love to keep this one, it seems quite interesting.&lt;&lt;/player&gt;&gt;
    &lt;&lt;leopold&gt;&gt;Very good, ?title. Be sure to take good care of it.&lt;&lt;/leopold&gt;&gt;
    ?Leopold leads you out of the vault again, now that you have received your reward. You hear the large metal vault door close behind you with a heavy thud.
    &lt;&lt;decision &#39;Leave&#39; &#39;Treasury&#39;&gt;&gt;
        &lt;&lt;completequest &#39;retrieve-artifact&#39;&gt;&gt;
        &lt;&lt;addtag &#39;has-artifact&#39;&gt;&gt;
        &lt;&lt;run $artifacts.chalk.unlocked = true&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Look at the other artifacts&#39; &#39;Artifacts Selection&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="11" name="Artifact Info sword" tags="" position="100,225" size="100,100">&lt;&lt;img &#39;artifacts/sword.jpg&#39; &#39;ridge-border&#39; &#39;12em&#39;&gt;&gt;
The pedestal in the middle is holding some kind of sword. It looks quite slim and almost transparent in a way. Once you get closer it almost looks like the wind itself is merging with the blade of this sword.
&lt;&lt;leopold&gt;&gt;You&#39;re looking at ?sword. A legendary blade that came into your father&#39;s possession after raiding a wealthy keep almost a decade ago.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;if hasRead(&#39;duel&#39;) and hasCompletedQuest(&#39;wymerus-book&#39;)&gt;&gt;
    Wait, this is the sword that ?Wymerus was talking about! The one used by Lord Lysander in the book you found in the library! You can take the sword and bring it to ?Wymerus to learn how to use it.
    &lt;&lt;player&gt;&gt;This is the sword that belonged to Lord Lysander. I have read about it.&lt;&lt;/player&gt;&gt;
    &lt;&lt;leopold&gt;&gt;Ah good, then you know of it&#39;s importance. If this artifact interests you I reckon you could take it to ?Wymerus. He is more than willing to teach you how to use it.&lt;&lt;/leopold&gt;&gt;
    &lt;&lt;decision &#39;Pick this artifact&#39;&gt;&gt;
        &lt;&lt;player&gt;&gt;Yes, I would love to keep this one, it seems quite interesting.&lt;&lt;/player&gt;&gt;
        &lt;&lt;leopold&gt;&gt;Very good, ?title. Be sure to take good care of it.&lt;&lt;/leopold&gt;&gt;
        ?Leopold leads you out of the vault again, now that you have received your reward. You hear the large metal vault door close behind you with a heavy thud.
        &lt;&lt;decision &#39;Leave&#39; &#39;Treasury&#39;&gt;&gt;
        &lt;&lt;completequest &#39;retrieve-artifact&#39;&gt;&gt;
            &lt;&lt;addtag &#39;has-artifact&#39;&gt;&gt;
            &lt;&lt;startquest wymerus-sword&gt;&gt;
            &lt;&lt;run $artifacts.sword.unlocked = true&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Look at the other artifacts&#39; &#39;Artifacts Selection&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    You move your hand over to the hilt of the sword but before you can touch it ?Leopold stops you.
    &lt;&lt;leopold&gt;&gt;Careful, ?title. This is a dangerous weapon. You know how your father gets over his mythical swords. I&#39;m willing to give the sword to you but only if you understand it&#39;s importance.&lt;&lt;/leopold&gt;&gt;
    You look at him with a questioning look.
    &lt;&lt;leopold&gt;&gt;?Title, can you tell me who this sword once belonged to?&lt;&lt;/leopold&gt;&gt;
    If ?Leopold is hinting at someone specific you must admit you have no idea who he means.
    &lt;&lt;player&gt;&gt;I have no clue, ?Leopold.&lt;&lt;/player&gt;&gt;
    &lt;&lt;leopold&gt;&gt;I&#39;m afraid I cannot give the sword to you then, your father simply wouldn&#39;t approve of it then. If you wish to learn about the history of the sword, I&#39;m quite certain there&#39;s a book in the library that mentions it.&lt;&lt;/leopold&gt;&gt;
    You back off the sword and focus your attention on the other artifacts again.
    &lt;&lt;decision &#39;Look at the other artifacts&#39; &#39;Artifacts Selection&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="12" name="Artifact Info mirror" tags="" position="225,225" size="100,100">&lt;&lt;img &#39;artifacts/mirror.jpg&#39; &#39;ridge-border&#39; &#39;12em&#39;&gt;&gt;
You walk up to the full-length mirror standing next to the other artifacts. The intricate golden frame looks beautiful in a very chaotic way.
&lt;&lt;leopold&gt;&gt;That mirror has some magical capabilities. ?Morgana told me it is able to show you how your body has changed in a recent time frame.&lt;&lt;/leopold&gt;&gt;
You are slightly anxious about immediately staring into the mirror when ?Leopold says that so you instead just look at him as he explains what the mirror is.
&lt;&lt;leopold&gt;&gt;Supposedly the mirror has stood in the personal quarters of important aristocrats who wanted to ensure they were not gaining weight.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;leopold&gt;&gt;Not that you really need to worry about that, ?title. But perhaps it could be a good fit for your room regardless.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;decision &#39;Pick this artifact&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Yes, I would love to keep this one, it seems quite interesting.&lt;&lt;/player&gt;&gt;
    &lt;&lt;leopold&gt;&gt;Very good, ?title. I will have the mirror delivered to your room. Be sure to take good care of it.&lt;&lt;/leopold&gt;&gt;
    ?Leopold leads you out of the vault again, now that you have received your reward. You hear the large metal vault door close behind you with a heavy thud.
    &lt;&lt;decision &#39;Leave&#39; &#39;Treasury&#39;&gt;&gt;
        &lt;&lt;completequest &#39;retrieve-artifact&#39;&gt;&gt;
        &lt;&lt;addtag &#39;has-artifact&#39;&gt;&gt;
        &lt;&lt;run $artifacts.mirror.unlocked = true&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Look at the other artifacts&#39; &#39;Artifacts Selection&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="13" name="Artifact Info book" tags="" position="350,225" size="100,100">&lt;&lt;img &#39;artifacts/book.jpg&#39; &#39;ridge-border&#39; &#39;12em&#39;&gt;&gt;
There is a large book lying on one of the pedestals, it&#39;s wrapped in brown leather. The mysterious title &quot;Tome of Memories&quot; is drawn on the front. 

&lt;&lt;leopold&gt;&gt;Ah yes, that&#39;s a magical book which belonged to ?Godric. He left it in his study and we have since moved it to the vault here. &lt;em&gt;&#39;The Tome of Memories&#39;&lt;/em&gt;.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;player&gt;&gt;A tome of memories?...Isn&#39;t that just a diary?&lt;&lt;/player&gt;&gt;
&lt;&lt;leopold&gt;&gt;Hah! Good one, ?title. In a way you are correct, though it probably doesn&#39;t sound mysterious enough for a wizard to admit he keeps a diary...&lt;&lt;/leopold&gt;&gt;
&lt;&lt;leopold&gt;&gt;This book is outfitted with a bunch of nifty tricks like transcribing your memories to paper through automated magical means. The book even lets you step &lt;em&gt;inside&lt;/em&gt; your memories and relive them once again!&lt;&lt;/leopold&gt;&gt;
Reliving your memories once again? That sounds pretty sweet!
&lt;&lt;decision &#39;Pick this artifact&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Yes, I would love to keep this one, it seems quite interesting.&lt;&lt;/player&gt;&gt;
    &lt;&lt;leopold&gt;&gt;Very good, ?title. Be sure to take good care of it.&lt;&lt;/leopold&gt;&gt;
    ?Leopold leads you out of the vault again, now that you have received your reward. You hear the large metal vault door close behind you with a heavy thud.
    &lt;&lt;decision &#39;Leave&#39; &#39;Treasury&#39;&gt;&gt;
        &lt;&lt;completequest &#39;retrieve-artifact&#39;&gt;&gt;
        &lt;&lt;addtag &#39;has-artifact&#39;&gt;&gt;
        &lt;&lt;run $artifacts.book.unlocked = true&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Look at the other artifacts&#39; &#39;Artifacts Selection&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="14" name="Artifact Info orb" tags="" position="475,225" size="100,100">&lt;&lt;img &#39;artifacts/orb.jpg&#39; &#39;ridge-border&#39; &#39;12em&#39;&gt;&gt;
On top of the pedestal, a crystal orb is resting on a velvet pillow. Inside it you can see a swirling mass which almost seems to be expanding as you come closer. The swirling blue light inside of it intrigues you.

&lt;&lt;leopold&gt;&gt;Beautiful, isn&#39;t it? It&#39;s called the Orb of Scrying.&lt;&lt;/leopold&gt;&gt;

You look at him with a puzzled expression.

&lt;&lt;player&gt;&gt;Orb of Scrying... What does it do?&lt;&lt;/player&gt;&gt;
&lt;&lt;leopold&gt;&gt;If you hold your hand on the orb while closing your eyes and focusing your mind on a person, the orb will let you watch them through magical means.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;player&gt;&gt;What? That is extremely useful! There must be some kind of drawback to this, it seems too good to just work like that.&lt;&lt;/player&gt;&gt;
&lt;&lt;leopold&gt;&gt;Well, yes, there are a few. Firstly, you can only spy on people that you personally know... And secondly...&lt;&lt;/leopold&gt;&gt;
?Leopold seems to shuffle awkwardly and suddenly avoids eye contact. You look at him slightly confused getting curious about what he&#39;s going to say next. There&#39;s a short pause before he continues his explanation. 
&lt;&lt;leopold&gt;&gt;Uhm, well, the orb will only work if the person you are observing is currently in an &lt;i&gt;aroused&lt;/i&gt; state...&lt;&lt;/leopold&gt;&gt;
You blush as you instantly feel slightly awkward as well.
&lt;&lt;player&gt;&gt;Oh, I see... Well, I suppose it could still be useful...&lt;&lt;/player&gt;&gt;
&lt;&lt;leopold&gt;&gt;Perhaps, yes... It is a Royal artifact and therefor it is not my place to judge that, ?title.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;player&gt;&gt;Right. Well, thanks for the information, ?Leopold.&lt;&lt;/player&gt;&gt;
It seems like the orb is really only useful for one thing. Though it&#39;s morally probably not a great idea, the thought of spying on people in private moments using a magical artifact does seem enticing...

&lt;&lt;decision &#39;Pick this artifact&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Yes, I would love to keep this one, it seems quite interesting.&lt;&lt;/player&gt;&gt;
    &lt;&lt;leopold&gt;&gt;Very good, ?title. Be sure to take good care of it.&lt;&lt;/leopold&gt;&gt;
    ?Leopold leads you out of the vault again, now that you have received your reward. You hear the large metal vault door close behind you with a heavy thud.
    &lt;&lt;decision &#39;Leave&#39; &#39;Treasury&#39;&gt;&gt;
        &lt;&lt;completequest &#39;retrieve-artifact&#39;&gt;&gt;
        &lt;&lt;addtag &#39;has-artifact&#39;&gt;&gt;
        &lt;&lt;run $artifacts.orb.unlocked = true&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Look at the other artifacts&#39; &#39;Artifacts Selection&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="15" name="Artifact book" tags="" position="600,225" size="100,100">You grab the hefty book from the shelf and place it down on your desk. You feel the magical aura that emanates from the book. 


&lt;&lt;book &#39;tome-of-memories&#39; &#39;tome-of-memories&#39; &#39;Tome of Memories&#39; &#39;&#39; true false false&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;morgana-bedroom&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/morgana_{theme}.jpg&#39; &#39;portrait morgana book-portrait&#39;&gt;&gt;
        &lt;h2&gt;?Morgana&#39;s First Bedroom Visit&lt;/h2&gt;
        You remember the first night ?Morgana came to your bedroom quite vividly. It was the first time that she required your ?essence to make her potion.
        &lt;&lt;decision &#39;Enter memory&#39;&gt;&gt;
            &lt;div class=&quot;memory-text&quot;&gt;
            You feel your consciousness being transported into the book.
            &lt;/div&gt;
            &lt;&lt;startmemory&gt;&gt;
            &lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
            &lt;&lt;settime &#39;Night&#39;&gt;&gt;
            &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
            &lt;&lt;timed 2500ms&gt;&gt;
                &lt;&lt;stowsidebars&gt;&gt;
                &lt;&lt;goto &#39;Morgana Bedroom 1&#39;&gt;&gt;
                &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 500&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;morgana-potion&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/morgana_{theme}.jpg&#39; &#39;portrait morgana book-portrait&#39;&gt;&gt;
        &lt;h2&gt;?Morgana&#39;s Second Bedroom Visit&lt;/h2&gt;
        The second time ?Morgana visited you at night in your bedroom, she meant to give you a magical potion she made...
        &lt;&lt;decision &#39;Enter memory&#39;&gt;&gt;
            &lt;div class=&quot;memory-text&quot;&gt;
            You feel your consciousness being transported into the book.
            &lt;/div&gt;
            &lt;&lt;startmemory&gt;&gt;
            &lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
            &lt;&lt;settime &#39;Night&#39;&gt;&gt;
            &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
            &lt;&lt;timed 2500ms&gt;&gt;
                &lt;&lt;stowsidebars&gt;&gt;
                &lt;&lt;goto &#39;Morgana Potion 1&#39;&gt;&gt;
                &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 500&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;morgana-forest&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/morgana_{theme}.jpg&#39; &#39;portrait morgana book-portrait&#39;&gt;&gt;
        &lt;h2&gt;?Morgana&#39;s Forest Excursion&lt;/h2&gt;
        ?Morgana convinced you to go on an excursion into the woods. This was the first time you snuck out of the castle using your disguise.
        &lt;&lt;decision &#39;Enter memory&#39;&gt;&gt;
            &lt;div class=&quot;memory-text&quot;&gt;
            You feel your consciousness being transported into the book.
            &lt;/div&gt;
            &lt;&lt;startmemory&gt;&gt;
            &lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
            &lt;&lt;settime &#39;Morning&#39;&gt;&gt;
            &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
            &lt;&lt;timed 2500ms&gt;&gt;
                &lt;&lt;stowsidebars&gt;&gt;
                &lt;&lt;goto &#39;Morgana Forest 1&#39;&gt;&gt;
                &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 500&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;kathryn-chastity-excursion&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/kathryn_{theme}.jpg&#39; &#39;portrait kathryn book-portrait&#39;&gt;&gt;
        &lt;h2&gt;?Kathryn&#39;s Blacksmith Excursion&lt;/h2&gt;
        Together with ?Kathryn and ?Caspar, you set out to visit the smithy in town, ?Beau, in order to get a special little item for yourself. You very clearly remember how humiliating this whole event was... Is that why you&#39;re thinking of reliving it?
        &lt;&lt;decision &#39;Enter memory&#39;&gt;&gt;
            &lt;div class=&quot;memory-text&quot;&gt;
            You feel your consciousness being transported into the book.
            &lt;/div&gt;
            &lt;&lt;startmemory&gt;&gt;
            &lt;&lt;setlocation &#39;Dining hall&#39;&gt;&gt;
            &lt;&lt;settime &#39;Noon&#39;&gt;&gt;
            &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
            &lt;&lt;timed 2500ms&gt;&gt;
                &lt;&lt;stowsidebars&gt;&gt;
                &lt;&lt;goto &#39;Kathryn Smithy Excursion 1&#39;&gt;&gt;
                &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 500&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;rosa-date&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/rosa_{theme}.jpg&#39; &#39;portrait rosa book-portrait&#39;&gt;&gt;
        &lt;h2&gt;First date with ?Rosa&lt;/h2&gt;
        You asked ?Rosa out on a date after picking a bouquet of flowers from her from the garden. You decided to have a lovely picnic at the waterfall together.
        &lt;&lt;decision &#39;Enter memory&#39;&gt;&gt;
            &lt;div class=&quot;memory-text&quot;&gt;
            You feel your consciousness being transported into the book.
            &lt;/div&gt;
            &lt;&lt;startmemory&gt;&gt;
            &lt;&lt;setlocation &#39;Kitchen&#39;&gt;&gt;
            &lt;&lt;settime &#39;Noon&#39;&gt;&gt;
            &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
            &lt;&lt;timed 2500ms&gt;&gt;
                &lt;&lt;stowsidebars&gt;&gt;
                &lt;&lt;goto &#39;Rosa Start Date&#39;&gt;&gt;
                &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 500&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;rosa-date-2&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/rosa_{theme}.jpg&#39; &#39;portrait rosa book-portrait&#39;&gt;&gt;
        &lt;h2&gt;Second date with ?Rosa&lt;/h2&gt;
        After ?Rosa brought you breakfast again, you set out to bring her three different kinds of flowers. She loved it so much you decided to ask her out on a date again, this time to the tavern.
        &lt;&lt;decision &#39;Enter memory&#39;&gt;&gt;
            &lt;div class=&quot;memory-text&quot;&gt;
            You feel your consciousness being transported into the book.
            &lt;/div&gt;
            &lt;&lt;startmemory&gt;&gt;
            &lt;&lt;setlocation &#39;Kitchen&#39;&gt;&gt;
            &lt;&lt;settime &#39;Evening&#39;&gt;&gt;
            &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
            &lt;&lt;timed 2500ms&gt;&gt;
                &lt;&lt;stowsidebars&gt;&gt;
                &lt;&lt;goto &#39;Rosa Start Date 2&#39;&gt;&gt;
                &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 500&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;rosa-date-3&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/rosa_{theme}.jpg&#39; &#39;portrait rosa book-portrait&#39;&gt;&gt;
        &lt;h2&gt;Third date with ?Rosa&lt;/h2&gt;
        You decided to treat ?Rosa to a lovely evening with royal private dinner. After the necessary preparations you even asked ?ChefPepper to cook all the delicious food for this wonderful date.
        &lt;&lt;decision &#39;Enter memory&#39;&gt;&gt;
            &lt;div class=&quot;memory-text&quot;&gt;
            You feel your consciousness being transported into the book.
            &lt;/div&gt;
            &lt;&lt;startmemory&gt;&gt;
            &lt;&lt;setlocation &#39;Kitchen&#39;&gt;&gt;
            &lt;&lt;settime &#39;Evening&#39;&gt;&gt;
            &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
            &lt;&lt;timed 2500ms&gt;&gt;
                &lt;&lt;stowsidebars&gt;&gt;
                &lt;&lt;goto &#39;Rosa Start Date 3&#39;&gt;&gt;
                &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 500&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;orson-date-1&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/orson_{theme}.jpg&#39; &#39;portrait orson book-portrait&#39;&gt;&gt;
        &lt;h2&gt;First date with ?Orson&lt;/h2&gt;
        After finding out ?Orson was the mysterious writer who left you these intricate poems, he invited you on a date to the meadow. There you went to drink wine, read poetry, and perform blowjobs. The most sophisticated of dates.
        &lt;&lt;decision &#39;Enter memory&#39;&gt;&gt;
            &lt;div class=&quot;memory-text&quot;&gt;
            You feel your consciousness being transported into the book.
            &lt;/div&gt;
            &lt;&lt;startmemory&gt;&gt;
            &lt;&lt;setlocation &#39;Library&#39;&gt;&gt;
            &lt;&lt;settime &#39;Evening&#39;&gt;&gt;
            &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
            &lt;&lt;timed 2500ms&gt;&gt;
                &lt;&lt;stowsidebars&gt;&gt;
                &lt;&lt;goto &#39;Orson Date 1 Start&#39;&gt;&gt;
                &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 500&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;orson-date-2&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/orson_{theme}.jpg&#39; &#39;portrait orson book-portrait&#39;&gt;&gt;
        &lt;h2&gt;Second date with ?Orson&lt;/h2&gt;
        You bought a beautiful quill from ?Beau as a gift for ?Orson and he liked it so much that he immediately asked you out on another date. He invited you to come see a famous bard that he adores play at the local ?tavern.
        &lt;&lt;decision &#39;Enter memory&#39;&gt;&gt;
            &lt;div class=&quot;memory-text&quot;&gt;
            You feel your consciousness being transported into the book.
            &lt;/div&gt;
            &lt;&lt;startmemory&gt;&gt;
            &lt;&lt;setlocation &#39;Library&#39;&gt;&gt;
            &lt;&lt;settime &#39;Evening&#39;&gt;&gt;
            &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
            &lt;&lt;timed 2500ms&gt;&gt;
                &lt;&lt;stowsidebars&gt;&gt;
                &lt;&lt;goto &#39;Orson Date 2 Start&#39;&gt;&gt;
                &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 500&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;velma-progress&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/eve_{theme}.jpg&#39; &#39;portrait eve book-portrait&#39;&gt;&gt;
        &lt;h2&gt;Sex education with ?Eve&lt;/h2&gt;
        ?MadameVelma had sent you to receive additional training from ?Eve. She slightly misunderstood the ?Madame&#39;s request and promptly gave you a very explicit &#39;hands-on&#39; workshop.
        &lt;&lt;decision &#39;Enter memory&#39;&gt;&gt;
            &lt;div class=&quot;memory-text&quot;&gt;
            You feel your consciousness being transported into the book.
            &lt;/div&gt;
            &lt;&lt;startmemory&gt;&gt;
            &lt;&lt;setlocation &#39;Corridor&#39;&gt;&gt;
            &lt;&lt;settime &#39;Evening&#39;&gt;&gt;
            &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
            &lt;&lt;timed 2500ms&gt;&gt;
                &lt;&lt;stowsidebars&gt;&gt;
                &lt;&lt;goto &#39;Eve Sex Education Intro&#39;&gt;&gt;
                &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 500&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;eve-date-1&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/eve_{theme}.jpg&#39; &#39;portrait eve book-portrait&#39;&gt;&gt;
        &lt;h2&gt;First date with ?Eve&lt;/h2&gt;
        After giving ?Eve a new sex toy that you bought for her from ?Beau&#39;s smithy, she invited you to go skinny dipping by the waterfall.
        &lt;&lt;decision &#39;Enter memory&#39;&gt;&gt;
            &lt;div class=&quot;memory-text&quot;&gt;
            You feel your consciousness being transported into the book.
            &lt;/div&gt;
            &lt;&lt;startmemory&gt;&gt;
            &lt;&lt;setlocation &#39;Eve\&#39;s Room&#39;&gt;&gt;
            &lt;&lt;settime &#39;Morning&#39;&gt;&gt;
            &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
            &lt;&lt;timed 2500ms&gt;&gt;
                &lt;&lt;stowsidebars&gt;&gt;
                &lt;&lt;goto &#39;Eve Date 1 Start&#39;&gt;&gt;
                &lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 500&gt;&gt;
            &lt;&lt;/timed&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;


&lt;&lt;decision &#39;Put the book away&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="16" name="Memory End" tags="" position="725,225" size="100,100">&lt;&lt;endmemory&gt;&gt;
&lt;&lt;effect charm off&gt;&gt;
&lt;&lt;effect flash &quot;rgba(0, 255, 136, 0.8)&quot; 1000&gt;&gt;
&lt;&lt;showsidebars&gt;&gt;

&lt;&lt;book &#39;tome-of-memories&#39; &#39;tome-of-memories&#39; &#39;Tome of Memories&#39; &#39;&#39; false true false&gt;&gt;
    &lt;&lt;page hasCompletedQuest(&#39;morgana-bedroom&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/morgana_{theme}.jpg&#39; &#39;portrait morgana book-portrait&#39;&gt;&gt;
        &lt;h2&gt;?Morgana&#39;s First Bedroom Visit&lt;/h2&gt;
        You remember the first night ?Morgana came to your bedroom quite vividly. It was the first time that she required your ?essence to make her potion.
    &lt;&lt;page hasCompletedQuest(&#39;morgana-potion&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/morgana_{theme}.jpg&#39; &#39;portrait morgana book-portrait&#39;&gt;&gt;
        &lt;h2&gt;?Morgana&#39;s Second Bedroom Visit&lt;/h2&gt;
        The second time ?Morgana visited you at night in your bedroom, she meant to give you a magical potion she made...
    &lt;&lt;page hasCompletedQuest(&#39;morgana-forest&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/morgana_{theme}.jpg&#39; &#39;portrait morgana book-portrait&#39;&gt;&gt;
        &lt;h2&gt;?Morgana&#39;s Forest Excursion&lt;/h2&gt;
        ?Morgana convinced you to go on an excursion into the woods. This was the first time you snuck out of the castle using your disguise.
    &lt;&lt;page hasCompletedQuest(&#39;kathryn-chastity-excursion&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/kathryn_{theme}.jpg&#39; &#39;portrait kathryn book-portrait&#39;&gt;&gt;
        &lt;h2&gt;?Kathryn&#39;s Blacksmith Excursion&lt;/h2&gt;
        Together with ?Kathryn and ?Caspar, you set out to visit the smithy in town, ?Beau, in order to get a special little item for yourself. You very clearly remember how humiliating this whole event was... Is that why you&#39;re thinking of reliving it?
    &lt;&lt;page hasCompletedQuest(&#39;rosa-date&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/rosa_{theme}.jpg&#39; &#39;portrait rosa book-portrait&#39;&gt;&gt;
        &lt;h2&gt;First date with ?Rosa&lt;/h2&gt;
        You asked ?Rosa out on a date after picking a bouquet of flowers from her from the garden. You decided to have a lovely picnic at the waterfall together.
    &lt;&lt;page hasCompletedQuest(&#39;rosa-date-2&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/rosa_{theme}.jpg&#39; &#39;portrait rosa book-portrait&#39;&gt;&gt;
        &lt;h2&gt;Second date with ?Rosa&lt;/h2&gt;
        After ?Rosa brought you breakfast again, you set out to bring her three different kinds of flowers. She loved it so much you decided to ask her out on a date again, this time to the tavern.
    &lt;&lt;page hasCompletedQuest(&#39;rosa-date-3&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/rosa_{theme}.jpg&#39; &#39;portrait rosa book-portrait&#39;&gt;&gt;
        &lt;h2&gt;Third date with ?Rosa&lt;/h2&gt;
        You decided to treat ?Rosa to a lovely evening with royal private dinner. After the necessary preparations you even asked ?ChefPepper to cook all the delicious food for this wonderful date.
    &lt;&lt;page hasCompletedQuest(&#39;orson-date-1&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/orson_{theme}.jpg&#39; &#39;portrait orson book-portrait&#39;&gt;&gt;
        &lt;h2&gt;First date with ?Orson&lt;/h2&gt;
        After finding out ?Orson was the mysterious writer who left you these intricate poems, he invited you on a date to the meadow. There you went to drink wine, read poetry, and perform blowjobs. The most sophisticated of dates.
    &lt;&lt;page hasCompletedQuest(&#39;orson-date-2&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/orson_{theme}.jpg&#39; &#39;portrait orson book-portrait&#39;&gt;&gt;
        &lt;h2&gt;Second date with ?Orson&lt;/h2&gt;
        You bought a beautiful quill from ?Beau as a gift for ?Orson and he liked it so much that he immediately asked you out on another date. He invited you to come see a famous bard that he adores play at the local ?tavern.
    &lt;&lt;page hasCompletedQuest(&#39;velma-progress&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/eve_{theme}.jpg&#39; &#39;portrait eve book-portrait&#39;&gt;&gt;
        &lt;h2&gt;Sex education with ?Eve&lt;/h2&gt;
        ?MadameVelma had sent you to receive additional training from ?Eve. She slightly misunderstood the ?Madame&#39;s request and promptly gave you a very explicit &#39;hands-on&#39; workshop.
    &lt;&lt;page hasCompletedQuest(&#39;eve-date-1&#39;)&gt;&gt;
        &lt;&lt;img &#39;portraits/eve_{theme}.jpg&#39; &#39;portrait eve book-portrait&#39;&gt;&gt;
        &lt;h2&gt;First date with ?Eve&lt;/h2&gt;
        After giving ?Eve a new sex toy that you bought for her from ?Beau&#39;s smithy, she invited you to go skinny dipping by the waterfall.
&lt;&lt;/book&gt;&gt;

&lt;&lt;timed 400ms transition&gt;&gt;
    &lt;&lt;closebook&gt;&gt;

    You feel your consciousness get thrown back into your body. The book magically closes itself as you get transported out of the memory.

    &lt;&lt;decision &#39;Put the book away&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Find another memory&#39; &#39;Artifact book&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/timed&gt;&gt;</tw-passagedata><tw-passagedata pid="17" name="Tome of Memories" tags="" position="850,225" size="100,100">- Morgana First Bedroom Visit
    - Morgana Bedroom 1 
    - morgana-bedroom
    - Bedroom
    - Night
- Morgana Second Bedroom Visit
    - Morgana Potion 1
    - morgana-potion
    - Bedroom
    - Night
- Morgana Forest Excursion
    - Morgana Forest 2
    - morgana-forest
    - Bedroom
    - Morning

- Kathryn Excursion
    - Kathryn Smithy Excursion 1
    - kathryn-chastity-excursion
    - Dining hall
    - Noon

- Rosa Date 1 Waterfall
    - Rosa Start Date
    - rosa-date
    - Kitchen
    - Noon
- Rosa Date 2 Tavern
    - Rosa Start Date 2
    - rosa-date-2
    - Kitchen
    - Evening
- Rosa Date 3 Dinner
    - Rosa Start Date 3
    - rosa-date-3
    - Kitchen
    - Evening

- Orson Date 1 Meadow
    - Orson Date 1 Start
    - orson-date-1
    - Library
    - Evening
- Orson Date 2 Tavern
    - Orson Date 2 Start
    - orson-date-2
    - Library
    - Evening

- Eve Sex Education
	- Eve Sex Education Intro 
    - velma-progress
    - Corridor
    - Evening
- Eve Date
	- Eve Date 1 Start 
    - eve-date-1
    - Eve&#39;s Room
    - Morning

Mention all equipment is retained, suggest taking chastity off</tw-passagedata><tw-passagedata pid="18" name="Artifact chalk" tags="" position="975,225" size="100,100">&lt;&lt;img &#39;artifacts/chalk.jpg&#39; &#39;ridge-border&#39; &#39;12em&#39;&gt;&gt;
You grab the chalk and feel the magical power emitted from the powdery stick as you hold it. Like ?Leopold told you, the blue chalk can be used to draw a pair of teleportation circles on the floor, binding them together and allowing you to warp between the circles. This is the closest thing to magic you have ever done.?nl
You can simply take the chalk and start drawing on the floor, the first one you draw in your bedroom and the next one can be placed at any location you want.?nl
&lt;&lt;if $artifacts.chalk.drawing&gt;&gt;
    You are currently drawing a new teleportation circle, go to another location to draw the second circle there.
&lt;&lt;elseif $artifacts.chalk.location&gt;&gt;
    &lt;&lt;decision `&#39;Teleport to the &#39; + $artifacts.chalk.location`&gt;&gt;
        &lt;&lt;script&gt;&gt;
        Engine.play(&quot;Magic Circle&quot;);
        &lt;&lt;/script&gt;&gt;
    &lt;&lt;decisionicon magic_circle&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Draw a new teleportation circle&#39; &#39;Bedroom&#39;&gt;&gt;
        &lt;&lt;run $artifacts.chalk.location = null&gt;&gt;
        &lt;&lt;run $artifacts.chalk.drawing = true&gt;&gt;
        &lt;&lt;locklocation &#39;Magic Circle&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;

    &lt;&lt;decision &#39;Remove the teleportation circle&#39; &#39;Bedroom&#39;&gt;&gt;
        &lt;&lt;run $artifacts.chalk.location = null&gt;&gt;
        &lt;&lt;locklocation &#39;Magic Circle&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Draw a teleportation circle&#39; &#39;Bedroom&#39;&gt;&gt;
        &lt;&lt;run $artifacts.chalk.location = null&gt;&gt;
        &lt;&lt;run $artifacts.chalk.drawing = true&gt;&gt;
        &lt;&lt;locklocation &#39;Magic Circle&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &#39;Go back&#39; &#39;Bedroom&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="19" name="Draw Magic Circle" tags="" position="1100,225" size="100,100">&lt;&lt;script&gt;&gt;
    let location = getLocation().title;
    variables().artifacts.chalk.drawing = false;
    variables().artifacts.chalk.location = location;
    variables().lockedlocations.delete(&quot;Magic Circle&quot;);
    Engine.play(location);
&lt;&lt;/script&gt;&gt;
/* &lt;&lt;set $artifacts.chalk.drawing = false&gt;&gt;
&lt;&lt;set $artifacts.chalk.drawing = `getLocation().title`&gt;&gt; */</tw-passagedata><tw-passagedata pid="20" name="Use Magic Circle" tags="" position="1225,225" size="100,100">&lt;&lt;script&gt;&gt;
    if (isDisguised()) {
        $.wiki(&quot;&lt;&lt;outfit standard&gt;&gt;&quot;);
    }
    Engine.play(&quot;Bedroom&quot;);
    flashEffect(&quot;rgba(250, 241, 77, 0.5)&quot;, 400);
&lt;&lt;/script&gt;&gt;

/* :: Magic Circle
&lt;&lt;if not tags($artifacts.chalk.location).includes(&#39;castle&#39;)&gt;&gt;
    &lt;&lt;outfit disguise&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;goto $artifacts.chalk.location&gt;&gt;
&lt;&lt;effect flash &quot;rgba(250, 241, 77, 0.5)&quot; 400&gt;&gt; */</tw-passagedata><tw-passagedata pid="21" name="Artifact mirror" tags="" position="100,350" size="100,100">You stand in front of the long ornate mirror. Supposedly it can analyse the recent changes to your form and show them to you.?nl


&lt;&lt;decision &#39;Look in the mirror&#39;&gt;&gt;
    &lt;&lt;showbody mirror location&gt;&gt;
        &lt;&lt;transformation chest flat&gt;&gt;
        &lt;&lt;transformation penis `settings.sph ? &#39;small&#39; : &#39;medium&#39;`&gt;&gt;
    &lt;&lt;/showbody&gt;&gt;

    You feel the magic of the mirror wash over you. You see your own image reflected in many different ways, focusing on specific body parts in rapid succession. Even though you are wearing clothes right now, some reflections are of your naked body.?nl
    The mirror shows you, the young adult prince with brown hair and green eyes. The hopeful look in your eyes and finely sewn princely outfits.?nl 

    &lt;&lt;if hasCompletedQuest(&#39;morgana-ointment&#39;)&gt;&gt;
    The mirror shows you that your skin has become significantly smoother now that you&#39;ve used the ointment ?Morgana gave you.?nl
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
    The mirror focuses specifically on showing you changes that recently happened after you drank the potion. You hair has grown longer, your waist has grown slimmer and your ass has grown slightly. Your shoulders have slimmed and your muscle mass has moved slightly around in your body, turning a slightly more feminine form. Your lips have grown fuller and your eye lashes seem to have grown as well. Your chest has grown more profound.?nl
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;if getStat(&#39;masculinity&#39;) &gt; 95&gt;&gt; 
    The mirror shows your manly body. Your clear jawline and strong arms. It shows the lean bod you have acquired from your workout sessions. It feels good to see yourself getting the acknowledgement you deserve.?nl
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;if isInChastity() and settings.sph&gt;&gt;
    The mirror suddenly reflects your ?dick very clearly. Seeing it projected in front of you makes you realise much more clearly how small it is. While you are watching this you suddenly see the mirror project your pink chastity cage over it and it then shows you how your ?dick has grown even smaller now because of that.
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;if getStat(&#39;submissiveness&#39;) &gt; 25&gt;&gt; 
    The mirror then shows your shy disposition. How you prefer to be lead by others instead of leading yourself. In depicts you in several events that happened recently where you decided to simply do what someone else tells you to do instead of making decisions yourself.?nl
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;if getStat(&#39;dominance&#39;) &gt; 25&gt;&gt; 
    The mirror then shows your confident attitude. It shows you multiple moments in the recent past where you are ordering other people around. It feels like you are a born leader, ready to take the throne one day.?nl
    &lt;&lt;/if&gt;&gt;

    After having shown this, the mirror suddenly doesn&#39;t emit light and projections anymore. Looks like that&#39;s all there is to show you now.

    &lt;&lt;decision &#39;Go back&#39; &#39;Bedroom&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="22" name="Mirror" tags="" position="225,350" size="100,100">&lt;div class=&quot;mirror-background&quot;&gt;&lt;/div&gt;
&lt;&lt;img &#39;body/body.png&#39; &#39;body&#39;&gt;&gt;
&lt;&lt;img &#39;body/hair-short-brown.png&#39; &#39;hair&#39;&gt;&gt;



&lt;&lt;if _lastPenis !== _penis&gt;&gt;
    &lt;&lt;if _lastPenis is -1&gt;&gt;
        &lt;&lt;img &#39;body/vulva.png&#39; &#39;penis fadeout&#39;&gt;&gt;
    &lt;&lt;elseif _lastPenis is 0&gt;&gt;
        &lt;&lt;img &#39;body/penis-flaccid-small.png&#39; &#39;penis fadeout&#39;&gt;&gt;
    &lt;&lt;elseif _lastPenis is 1&gt;&gt;
        &lt;&lt;img &#39;body/penis-flaccid-normal.png&#39; &#39;penis fadeout&#39;&gt;&gt;
    &lt;&lt;elseif _lastPenis is 2&gt;&gt;
        &lt;&lt;img &#39;body/penis-flaccid-big.png&#39; &#39;penis fadeout&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;if _penis is -1&gt;&gt;
        &lt;&lt;img &#39;body/vulva.png&#39; &#39;penis fadein&#39;&gt;&gt;
    &lt;&lt;elseif _penis is 0&gt;&gt;
        &lt;&lt;img &#39;body/penis-flaccid-small.png&#39; &#39;penis fadein&#39;&gt;&gt;
    &lt;&lt;elseif _penis is 1&gt;&gt;
        &lt;&lt;img &#39;body/penis-flaccid-normal.png&#39; &#39;penis fadein&#39;&gt;&gt;
    &lt;&lt;elseif _penis is 2&gt;&gt;
        &lt;&lt;img &#39;body/penis-flaccid-big.png&#39; &#39;penis fadein&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;if _lastPenis is -1&gt;&gt;
        &lt;&lt;img &#39;body/vulva.png&#39; &#39;penis&#39;&gt;&gt;
    &lt;&lt;elseif _lastPenis is 0&gt;&gt;
        &lt;&lt;img &#39;body/penis-flaccid-small.png&#39; &#39;penis&#39;&gt;&gt;
    &lt;&lt;elseif _lastPenis is 1&gt;&gt;
        &lt;&lt;img &#39;body/penis-flaccid-normal.png&#39; &#39;penis&#39;&gt;&gt;
    &lt;&lt;elseif _lastPenis is 2&gt;&gt;
        &lt;&lt;img &#39;body/penis-flaccid-big.png&#39; &#39;penis&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;if _lastChest !== _chest&gt;&gt;
    &lt;&lt;if _lastChest is 0&gt;&gt;
        &lt;&lt;img &#39;body/chest-flat.png&#39; &#39;chest fadeout&#39;&gt;&gt;
    &lt;&lt;elseif _lastChest is 1&gt;&gt;
        &lt;&lt;img &#39;body/chest-small.png&#39; &#39;chest fadeout&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;if _chest is 0&gt;&gt;
        &lt;&lt;img &#39;body/chest-flat.png&#39; &#39;chest fadein&#39;&gt;&gt;
    &lt;&lt;elseif _chest is 1&gt;&gt;
        &lt;&lt;img &#39;body/chest-small.png&#39; &#39;chest fadein&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;if _lastChest is 0&gt;&gt;
        &lt;&lt;img &#39;body/chest-flat.png&#39; &#39;chest&#39;&gt;&gt;
    &lt;&lt;elseif _lastChest is 1&gt;&gt;
        &lt;&lt;img &#39;body/chest-small.png&#39; &#39;chest&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;



&lt;&lt;set _lastPenis = _penis&gt;&gt;
&lt;&lt;set _lastChest = _chest&gt;&gt;

&lt;&lt;img &#39;body/frame.png&#39; &#39;frame&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="23" name="Artifact orb" tags="" position="350,350" size="100,100">&lt;&lt;img &#39;artifacts/orb.jpg&#39; &#39;ridge-border&#39; &#39;12em&#39;&gt;&gt;
&lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;

In your bedroom, you have put the orb on velvet pillow lying on a wooden side table standing in the corner.?nl

&lt;&lt;if getTime() !== &#39;night&#39;&gt;&gt;
    Before you take the orb and use it to spy on people you realise you&#39;re probably not going to get much of a result during daytime. Seeing as the orb works only when observing feelings of arousal, you&#39;re probably not going to get much of that at this hour and it might be better to do this later at night.

    &lt;&lt;decision &#39;Go back&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    You take the orb into your hands and lie down on your bed. How did this thing work again? Simply think of someone and if they&#39;re currently aroused you will get to spy on them? Seems easy enough...

    &lt;&lt;if not hasCounter(&#39;caspar-night&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Spy on ?Caspar and ?Wymerus&#39; &#39;Artifact orb spy Caspar and Wymerus&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    /* &lt;&lt;if not hasCounter(&#39;orson-night&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Spy on ?Orson&#39; &#39;Artifact orb spy Orson&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt; */
    &lt;&lt;if not hasCounter(&#39;quinn-night&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Spy on ?Quinn&#39; &#39;Artifact orb spy Quinn&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;if not hasCounter(&#39;sybille-night&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Spy on ?Sybille&#39; &#39;Artifact orb spy Sybille&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
     &lt;&lt;if not hasCounter(&#39;kathryn-night&#39;) and getCharacterLocation(&#39;kathryn&#39;) === &#39;Garden&#39;&gt;&gt;
        &lt;&lt;decision &#39;Spy on ?Kathryn&#39; &#39;Artifact orb spy Kathryn&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
     &lt;&lt;if hasTag(&#39;leopold-mystery&#39;) and not hasCounter(&#39;leopold-night&#39;) and getCharacterLocation(&#39;leopold&#39;) === &#39;Treasury&#39;&gt;&gt;
        &lt;&lt;decision &#39;Spy on ?Leopold&#39; &#39;Artifact orb spy Leopold&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;decision &#39;Spy on ?Morgana&#39; &#39;Artifact orb spy Morgana&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    /* &lt;&lt;decision &#39;Spy on Andreas&#39; &#39;Artifact orb spy Andreas&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt; */
    &lt;&lt;decision &#39;Go back&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="24" name="Artifact orb spy Sybille" tags="spicy" position="475,350" size="100,100">&lt;&lt;setlocation &#39;Dungeons&#39;&gt;&gt;
&lt;&lt;addcounter &#39;sybille-night&#39; 2&gt;&gt;

Honing your mind towards the dungeons, the orb locates ?Sybille. The white of her hair shines in stark contrast to the darkness of the dungeon. She seems to be in her room, and in the process of changing. You notice her normal black dress lies neatly folded on a chair next to her, before your gaze pans to take in the bareness of her form. Though you&#39;ve always thought her complexion rather pallid, in the warm glow of her hearth you must admit she looks as radiant as an angel.?nl

Her back is turned to you, giving you a marvelous view of her ass. You focus your mind futher, trying to get a closer look. ?Sybille bends over to pull her leather suit onto her legs, and you see what has allowed the orb to atune to her so readily. Though she has yet to begin her nightly interrogations, you can clearly see her wetness practically dripping down her legs. Though you were well aware of her... &lt;i&gt;methods&lt;/i&gt;... she is always so professional with you and the council that it is easy to forget &lt;i&gt;this&lt;/i&gt; side of her.?nl

As she pulls the suit up over her hips, she turns towards a nearby table, highlighting the immaculate curvature of her breasts in the dim fire light. Given the nature of her work she is always two steps ahead, so the idea of having caught her unaware is electrifying...?nl

Continuing to slide the suit over her ample chest, you could swear you see a self-satisfied smirk as she surveys the contents of the table before her. Having finished donning her dominatrix outfit, now an angel of darkness, she grabs the key and riding crop from the table. The anticipation of what she has in store for her prisoners tonight leaves you with an unshakable feeling in the pit of your stomach - maybe excitement, maybe fear, maybe jealousy, definitely arousal.?nl

&lt;&lt;img &quot;sybille/sybille_dominatrix_{theme}.jpg&quot;&gt;&gt;

&lt;&lt;sybille&gt;&gt;Lets see if we can&#39;t break someone&#39;s will tonight...&lt;&lt;/sybille&gt;&gt;

Sybille walks deliberately out of her quarters and into the hallway towards the cells.

&lt;&lt;sybille&gt;&gt;Now, which one of you wretches wants my attention most tonight?&lt;&lt;/sybille&gt;&gt;

You feel the orb&#39;s connection to ?Sybille begin to waver as she moves further down the hall. You can feel the anticipation of the prisoners as she passes their cells, the orb&#39;s magic distorting with the sheer concentration of their arousal. The scene is not dissimilar to watching an apex preditor toy with its meal.

&lt;&lt;say &#39;Prisoner&#39;&gt;&gt;Please Mistress! &lt;em&gt;Pick me&lt;/em&gt;! I will tell you what I know! I will do anything for you! Just please, &lt;i&gt;touch me&lt;i&gt;, &lt;i&gt;&lt;strong&gt;break me&lt;/strong&gt;&lt;/i&gt;!&lt;&lt;/say&gt;&gt;

Your vision blurs sharply, the prisoner&#39;s desperation and arousal overwhelming the orb&#39;s magic. Your connection is strained to breaking, but you can still clearly hear ?Sybille&#39;s strong, confident voice echoing through the dungeon.

&lt;&lt;sybille&gt;&gt;Well, well, well. It seems I have an &lt;i&gt;eager&lt;/i&gt; volunteer, and one that has finally learned her place... Good little prisoner.&lt;&lt;/sybille&gt;&gt;

The orb can no longer maintain an image, and your body reacts by automatically heightening your other senses. With the image now faded, you now consciously notice how every muscle in your body was tightly clenched, ready to pounce - or flee? Though you can no longer make out any discernable image, you get the mental impression of ?Sybille with a wicked grin on her face as she enters the cell.?nl

Your world narrows to just the echoes of the prisoner&#39;s muffled cries of pleasure and pain as she begins her work, transmitted by the last dregs of the orb&#39;s magic. A final static bolt runs down your spine, lingering for a moment until your brain regains control over your nervous system. Did you narrowly escaped the notice of a predator, or did your prey just narrowly escape your grasp?

&lt;&lt;disable isInChastity()&gt;&gt;
    &lt;&lt;decision &#39;Masturbate, imagining yourself as a prisoner&#39; submissiveness medium&gt;&gt;
        Using the memory of ?Sybille tormenting her prisoners, you imagine the feeling of being restrained by someone else, your own orgasm not yours to control... Though you try to hold out, you quickly reach your climax.
        &lt;&lt;decision &quot;Put the orb away and go to bed&quot; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;reason&gt;&gt;
        You are locked in chastity. Your ?penis throbs in stifled arousal.
&lt;&lt;/disable&gt;&gt;
&lt;&lt;disable isInChastity()&gt;&gt;
    &lt;&lt;decision &#39;Masturbate, imagining yourself punishing a prisoner&#39; dominance medium&gt;&gt;
        Using the memory of ?Sybille tormeting her prisoners, you imagine the feeling of absolute control over someone else&#39;s pleasure, driving them to the brink but holding them back until you give the word. You quickly reach your climax.
        &lt;&lt;decision &quot;Put the orb away and go to bed&quot; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;reason&gt;&gt;
        You are locked in chastity. Your ?penis throbs in stifled arousal.
&lt;&lt;/disable&gt;&gt;
&lt;&lt;decision &quot;Put the orb away and go to bed&quot; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="25" name="Artifact orb spy Quinn" tags="spicy" position="600,350" size="100,100">&lt;&lt;setlocation &#39;Barracks&#39;&gt;&gt;
&lt;&lt;addcounter &#39;quinn-night&#39; 2&gt;&gt;

As you focus your thoughts towards ?Quinn, the image the orb produces is initially quite blurry. As the orb focuses in on her arousal, you can begin make out the captain&#39;s sparsely-furnished quarters. In the flickering torch light you recognize ?Quinn, laying back on her bed with a soldier kneeling between her legs.

/* &lt;&lt;img &quot;sergeant/quarters_soldier_licking_{theme}.jpg&quot;&gt;&gt; */

&lt;&lt;first&gt;&gt;
&lt;&lt;finally&gt;&gt;
The soldiers all look alike to you, but you could swear this is a different guy than last time...
&lt;&lt;/first&gt;&gt;

&lt;&lt;quinn&gt;&gt;Come on, work that tongue soldier! Do you want to be the disappointment of the entire garrison? I know you&#39;ve got more in you so &lt;i&gt;give it to me&lt;/i&gt;, that is an order!&lt;&lt;/quinn&gt;&gt;

You watch as the hapless soldier continues to lick her pussy. You hear a low, distant droning sound and focus on it more closely... Yep, he&#39;s humming the ABCs to himself as he licks through the alphabet.?nl

You can&#39;t help but feel a little bad for ?Quinn, if you didn&#39;t know better you&#39;d say the soldier was teasing her on purpose. For her part, the captain seems to be losing both patience and arousal. The orb&#39;s picture momentarily dissolves into a milky kaleidoscope of multi-color clouds, before refocusing on the exasperated, near desperate face of the captain.

&lt;&lt;quinn&gt;&gt;Seriously, is that the best you&#39;ve got? Put in some effort!&lt;&lt;/quinn&gt;&gt;

Frustrated, she grabs the hapless soldier&#39;s head and starts grinding against his mouth. You didn&#39;t know what you were expecting, but you were certainly caught off guard by how roughly she handled him, though honestly you are kind of into it.?nl

You notice sweat beads beginning to form and roll off of her toned abs. She grabs his hair, man-handling him as she tries to find stimulation for her clit. As she hunts her orgasm, you find yourself entranced by the carnal rhythm of her breasts in the low torchlight.?nl

Suddenly, the vibrance of that same torchlight seems to flare as the orb senses her approaching climax. The soldier was struggling to breath, but as he tries to retreat she wraps her legs around his head, holding his mouth against her sopping hole while she bites her lip and continues to grind into him.

&lt;&lt;quinn&gt;&gt;Fuck... So close...&lt;&lt;/quinn&gt;&gt;

?Quinn bucks her hips, riding out and trying to extend an ultimately disappointing finish. She eventually releases the soldier who gratefully gasps for air. As he recovers, he seems to look expectantly at the her.

&lt;&lt;quinn&gt;&gt;You must have lost your mind if you think that performance was worthy of a reward, soldier. I&#39;ve trained you better than that; you&#39;ll be on cleaning duty until that form improves. Dismissed!&lt;&lt;/quinn&gt;&gt;

You watch as the soldier quickly grabs his clothing and leaves the room, head hung in defeat. As your view begins to dim, fading with her afterglow, you take this opportunity to study the captain&#39;s splayed form...

&lt;&lt;include &#39;Artifact orb Masturbate&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="26" name="Artifact orb spy Morgana" tags="" position="725,350" size="100,100">&lt;&lt;setlocation &#39;Workshop&#39;&gt;&gt;
As you&#39;re holding the magical orb and focus your mind on ?Morgana, you find that the orb is struggling to produce a clear image. You can slightly make out the surroundings of her workshop. A very vague silhouette of the sorceress appears but you can&#39;t seem to see more than that. You wonder if the orb is working badly because she&#39;s not currently aroused but that theory is quickly proven wrong as you suddenly her ?Morgana moaning loudly.?nl
You try to survey the area but it feels like navigating a thick fog. You get the sense that there&#39;s nobody else here... Does that mean she&#39;s masturbating alone in her workshop?... The more you try to observe of her form performing a devious activity, the more blurry the image becomes. Soon, the orb seems unable to show any visual reflection at all while you continue to hear her moaning. It looks like ?Morgana has some kind of warding magic to counteract your attempts at spying on her...

&lt;&lt;decision &#39;Return&#39; &#39;Artifact orb&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="27" name="Artifact orb spy Andreas" tags="" position="850,350" size="100,100">&lt;&lt;setlocation &#39;Grand hall&#39;&gt;&gt;
You decide it might be fun to spy on ?Andreas for a bit. You actually have no idea what he gets up to at night. As you focus your mind on him, the orb shows you the image of the grand hall.?nl
The hearth is burning softly next to ?Andreas&#39;s desk as you see him setting there, reading through documents and writing a letter. He&#39;s still working this late at night? You take another good look around but spot nothing out of the ordinary, ?Andreas is simply spending his evening fulfilling his duties as chancellor. Although this peeping session is much less interesting than you hoped, it feels good to see ?Andreas&#39;s diligence here. You feel that you&#39;re lucky to have him as your mentor and chancellor.

&lt;&lt;decision &#39;Return&#39; &#39;Artifact orb&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="28" name="Artifact orb spy Leopold" tags="spicy" position="975,350" size="100,100">&lt;&lt;changeschedule leopold &#39;night&#39; &#39;None&#39;&gt;&gt;
&lt;&lt;addcounter &#39;leopold-night&#39; 2&gt;&gt;
&lt;&lt;setlocation &#39;Treasury&#39;&gt;&gt;
Instead of trying to spy on ?Leopold again the old fashioned way, why not spy on him the magical way and finally figure out who the mysterious blowjob person is? A genius plan!?nl

You focus your mind on ?Leopold and are instantly transported to the treasury. It seems like ?Leopold is quite aroused, seeing how quickly the orb was able to locate him. You look around through your glass ball and once again make out his form sitting behind the desk, except you are looking much closer this time.?nl

His lustful state is not really apparent when you are observing him, it seems like he&#39;s simply working behind his desk. As you focus your attention on him it becomes apparent that the things he&#39;s writing down on a piece of parchment are completely unintelligible. Is he pretending to be working? Curiously, you now notice he&#39;s actually softly moaning and you also see his strange posture sitting behind the desk. Heh, looks like he&#39;s enjoying another late night blowjob by his mysterious benefactor.?nl

Indeed, the soft wet sounds coming from under the desk now become more apparent to you. You currently can&#39;t make out anything of the person under the desk as ?Leopold is completely obscuring the view. You wonder whether doing these things while pretending to work is some kind of extra turn on for him...

&lt;&lt;leopold&gt;&gt;Ah, good... Keep going just like that while I finish this paperwork...&lt;&lt;/leopold&gt;&gt;

Is this some kind of role-playing to him? 

&lt;&lt;leopold&gt;&gt;A- almost have this balance sheet done... So close now...&lt;&lt;/leopold&gt;&gt;

Even though you&#39;re very far from understanding all of ?Leopold&#39;s stewardship lessons, you&#39;re pretty damn sure he&#39;s not working on anything remotely related to a balance sheet. The hidden service provider seems to take the message though as the slurping sound coming from below becomes louder and louder. They&#39;re clearly speeding up now. ?Leopold seems unable to contain his feeling, letting go of his pretending role for a moment as he lets out an intense groan, clearly enjoying a strong orgasm.

&lt;&lt;leopold&gt;&gt;Ahhh! Great jeweled riches, that was wonderful!&lt;&lt;/leopold&gt;&gt;

?Leopold lets out a loud blissful sigh before he scoots back and looks down below his desk. 

&lt;&lt;if settings.cum&gt;&gt;
    &lt;&lt;leopold&gt;&gt;Remember, I paid extra for you to &lt;i&gt;keep the change&lt;/i&gt;.&lt;&lt;/leopold&gt;&gt;
    For some reason he&#39;s speaking with a strange emphasis and a sly smile. The meaning of his words only dawn on you the moment you hear an audible gulp coming from the darkness beneath the table. ?Leopold gives an approving nod and continues to speak in a satisfied demeanor.
&lt;&lt;/if&gt;&gt;

&lt;&lt;leopold&gt;&gt;You are really talented, consider me a happy customer. I am definitely interested in hiring your services again in the future...&lt;&lt;/leopold&gt;&gt;

Hiring them? You had no idea that the person that ?Leopold invited here every time is someone who is paid to do so. This explains so much but creates a whole load of new questions. Your mind is going crazy, unintentionally thinking of new theories on who this mysterious person could be. Is it anyone you know? As you&#39;re processing the whole situation, ?Leopold suddenly sticks out a hand to help the unknown person out from under the desk. A slender arm reaches out to meet him. You feel your heart thumping as you&#39;re finally going to learn the answer to this big question...

&lt;&lt;decision &#39;Watch excitedly&#39; &#39;Artifact orb spy Leopold 2&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="29" name="Artifact orb spy Leopold 2" tags="" position="1100,350" size="100,100">&lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
You vaguely see a form crawl out from under the desk. You&#39;re so excitedly observing what happens next that you don&#39;t even realise the vision is getting gradually darker, the usual sign that the orb will soon stop working as there&#39;s no longer any aroused energy on the other side that it requires to function.?nl
The timing of this couldn&#39;t be worse as the moment that you try to focus on the person, the orb suddenly stops working. Flabbergasted, you immediately let out an annoyed shout.
&lt;&lt;player&gt;&gt;What? No! You can&#39;t be serious!&lt;&lt;/player&gt;&gt;
You&#39;re not sure if the orb is playing with you or something but you can&#39;t believe that after all this you still have no idea who the person is that&#39;s servicing ?Leopold so often... At least you have now learned that they are actually hired by ?Leopold to do this sort of thing. That&#39;s a small step forward, you guess... You begrudgingly decide to leave it for what it is and just head to bed with an annoyed feeling.

&lt;&lt;decision &#39;Sleep&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="30" name="Artifact orb spy Orson" tags="" position="1225,350" size="100,100">&lt;&lt;addcounter &#39;orson-night&#39; 2&gt;&gt;


&lt;&lt;include &#39;Artifact orb Masturbate&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="31" name="Artifact orb spy Kathryn" tags="spicy" position="100,475" size="100,100">&lt;&lt;changeschedule kathryn &#39;night&#39; &#39;None&#39;&gt;&gt;
&lt;&lt;addcounter &#39;kathryn-night&#39; 2&gt;&gt;
&lt;&lt;setlocation &#39;Garden&#39;&gt;&gt;
As you focus your attention on ?Kathryn, you get a glimpse of the gazebo out in the castle gardens. You see ?Kathryn and this nobleman make out quite passionately while sitting next to each other. The man starts to grope her through her red dress, fondling her breasts while sticking his tongue in her mouth.?nl

She starts to take off the top part of her dress, freeing her ample breasts to the open garden at night. You must say the look is quite stunning.
&lt;&lt;img &quot;kathryn/garden_peeking_{theme}.jpg&quot;&gt;&gt;

&lt;&lt;say `getNoble()`&gt;&gt;&lt;&lt;fullname kathryn&gt;&gt;... You are so beautiful...&lt;&lt;/say&gt;&gt;

You&#39;re actually quite jealous of what this nobleman is doing to her. While making out, they passionately embrace each other. Their bodies are completely intertwined on this bench outside in the garden. The nobleman slowly starts to grind his groin into her, sending a very clear message.

&lt;&lt;kathryn&gt;&gt;Ah... &lt;&lt;noble&gt;&gt;... Please continue...&lt;&lt;/kathryn&gt;&gt;

The nobleman seems to accept the invitation as he&#39;s fumbling with his belt and subsequently starts lowering his trousers, revealing his fully erect member.&lt;&lt;if settings.sph&gt;&gt; You think you finally spot the reason ?Kathryn chose this man in particular as he&#39;s presenting a very respectably sized cock, it&#39;s definitely much bigger than your ?dick.&lt;&lt;/if&gt;&gt;?nl
?Kathryn lustfully raises the skirt part of her dress, opening the way for him. You get a good view of ?Kathryn&#39;s exposed private parts, it looks like she wasn&#39;t even wearing any panties under her dress, probably counting on the night leading to this exact moment.?nl
Her pussy seems visibly wet as you see &lt;&lt;noble&gt;&gt; align his cock with her opening. They make intense eye contact as he slowly starts pushing into her. The moment that he enters her, ?Kathryn starts loudly moaning, not seeming to think about the fact they&#39;re outside on a gazebo bench and anyone could spot them.
&lt;&lt;kathryn&gt;&gt;Ah fuck... Yes... Take me, &lt;&lt;noble&gt;&gt;... Fuck me with your big dick...&lt;&lt;/kathryn&gt;&gt;
The man seems to really enjoy the feeling of being inside of her, he starts pumping in and out of her faster and faster. Their intense love-making is combined with passionate kisses before the nobleman starts to speed up even more. ?Kathryn suddenly holds him with a flared-up intensity.
&lt;&lt;kathryn&gt;&gt;Keep going just like that... I&#39;m getting close... Fuck!&lt;&lt;/kathryn&gt;&gt;
He seems to follow her commands exactly, fucking her with the exact same intensity and letting her relish the moment. This seems to quickly bring ?Kathryn over the edge as she arches her back and lets out an intense moan.
&lt;&lt;kathryn&gt;&gt;I&#39;m cumming! &lt;&lt;if settings.sph&gt;&gt;Your big cock is&lt;&lt;else&gt;&gt;You are&lt;&lt;/if&gt;&gt; making me cum, &lt;&lt;noble&gt;&gt;!&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;if settings.sph&gt;&gt;
    Hearing ?Kathryn focus so much on the size of his cock is making you feel strange about your own much more modestly sized penis... You know for a fact you couldn&#39;t bring her to orgasm with your ?dick, like the nobleman is doing right now. Could you even satisfy her at all??nl
&lt;&lt;/if&gt;&gt;
?Kathryn is very clearly enjoying an intense orgasm. This very quickly brings &lt;&lt;noble&gt;&gt; to the edge as well. He&#39;s loudly panting as he suddenly pulls out of her and starts quickly stroking his cock, aimed at her bare breasts. Even though she&#39;s recovering from the heavy climax, she suddenly reaches over and forcibly turns the nobleman sideways, nudging him to aim his cock to the ground instead of on her. It seems like she would prefer that he doesn&#39;t stain her dress like that.?nl
The man is grunting loudly, letting her take charge as she expertly uses her hand to help him reach his climax. He starts moaning as you see him reach his orgasm as well.?nl
&lt;&lt;if settings.cum&gt;&gt;
    Even though it wasn&#39;t her intention at all, by pure happenstance in redirecting the nobleman&#39;s discharge it looks like he&#39;s now aimed directly towards you from your orb&#39;s perspective. You see his cock erupt with several vivid spurts of white strands flying directly towards your point of view. It almost feels like ?Kathryn wanted you to catch his cum for her, you imagine her guiding him to shoot it all over your face instead of the gazebo floor. For some reason you instinctively close your eyes and even open your mouth slightly...?nl
    You quickly snap yourself out of it, this strange event is nothing more than a coincidence. There&#39;s no way ?Kathryn knows you would be watching them, but the thought of her doing something like this for real makes you feel quite... Well... You think it&#39;s probably best to avoid thinking about whether this arouses you...
&lt;&lt;/if&gt;&gt;

&lt;&lt;include &#39;Artifact orb Masturbate&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="32" name="Artifact orb spy Caspar and Wymerus" tags="spicy" position="225,475" size="100,100">&lt;&lt;addcounter &#39;wymerus-night&#39; 2&gt;&gt;
&lt;&lt;addcounter &#39;caspar-night&#39; 2&gt;&gt;
&lt;&lt;setlocation &#39;Courtyard&#39;&gt;&gt;
You hold your hand over the magical orb and focus your mind on ?Caspar and ?Wymerus. You already have an idea of what they&#39;re doing and your suspicions are confirmed the moment you see the castle courtyard through the orb.?nl

&lt;&lt;include `either(&#39;Caspar Peeping 1&#39;, &#39;Caspar Peeping 2&#39;, &#39;Caspar Peeping 3&#39;)`&gt;&gt;

&lt;&lt;include &#39;Artifact orb Masturbate&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="33" name="Artifact orb Masturbate" tags="spicy" position="350,475" size="100,100">&lt;&lt;disable isInChastity()&gt;&gt;
    &lt;&lt;decision &quot;Masturbate while watching the orb&quot;&gt;&gt;
        &lt;&lt;addsin &#39;masturbation&#39;&gt;&gt;
        While you&#39;re holding the orb in one hand you use the other to free your ?dick and start masturbating while scrying at this exciting display coming to you through this magical glass ball.?nl
        It&#39;s quite exhilarating, being able to stroke yourself from the comfort of your own bed without relying only on your own perverted fantasies. Instead, you have now managed to harness a magical artifact to provide this depraved stimulation for you. Well, that and the carnal sins that you are actively peeking on...?nl

        You hold your ?dick &lt;&lt;if settings.sph&gt;&gt;with your index and thumb fingers&lt;&lt;else&gt;&gt;in your hand&lt;&lt;/if&gt;&gt; and gently start stroking up and down.
        &lt;&lt;if settings.vids&gt;&gt;
            &lt;&lt;if settings.sph&gt;&gt;
                &lt;&lt;video &#39;player/masturbate_sph.webm&#39;&gt;&gt;
            &lt;&lt;else&gt;&gt;
                &lt;&lt;video &#39;player/masturbate.webm&#39;&gt;&gt;
            &lt;&lt;/if&gt;&gt;
        &lt;&lt;/if&gt;&gt;

        You very quickly manage to bring yourself to climax, feeling an intense release. 
        &lt;&lt;if settings.cum&gt;&gt;
            Cum starts flying out of your ?dick all over your stomach.
            &lt;&lt;decision &quot;Scoop it up and eat it&quot;&gt;&gt;
                You&#39;re not sure what&#39;s driving this perverse craving but looking at your sperm makes you wish it actually landed in your mouth. You greedily start gathering it in your hand and very quickly start lapping up your own cum, feeling the bitter and salty taste as you swallow it all down.
                &lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;
                &lt;&lt;if settings.vids&gt;&gt;
                    &lt;&lt;video &#39;player/swallow{2}.webm&#39;&gt;&gt;
                &lt;&lt;/if&gt;&gt;
                &lt;&lt;decisiongroup 1&gt;&gt;
                &lt;&lt;addstat depravity small&gt;&gt;
            &lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;decisiongroup 1&gt;&gt;
        &lt;&lt;addstat depravity small&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;reason&gt;&gt;
        You are locked in chastity.
&lt;&lt;/disable&gt;&gt;
&lt;&lt;decision &quot;Unchannel the orb and go to bed&quot; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="34" name="Artifact sword" tags="" position="475,475" size="100,100">&lt;&lt;img &#39;artifacts/sword.jpg&#39; &#39;ridge-border&#39; &#39;12em&#39;&gt;&gt;
You examine the mythical wind sword up close. It seems like there&#39;s some engraving on the sword but it&#39;s rather difficult to read with the wind flowing around the blade.?nl

You can decide to either carry the blade with you or leave it here in your bedroom.
&lt;&lt;if $artifacts.sword.equipped&gt;&gt;
    &lt;&lt;decision &#39;Leave the sword here&#39; &#39;Artifact sword&#39;&gt;&gt;
        &lt;&lt;set $artifacts.sword.equipped = false&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Take the sword with you&#39; &#39;Artifact sword&#39;&gt;&gt;
        &lt;&lt;set $artifacts.sword.equipped = true&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &#39;Go back&#39; &#39;Bedroom&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="35" name="Andreas" tags="" position="600,475" size="100,100">&lt;&lt;if $location is &#39;Grand hall&#39;&gt;&gt;
    &lt;&lt;decision &#39;You see ?Andreas here, looking through some papers&#39; &#39;Andreas Ask&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="36" name="Andreas Acknowledgement" tags="" position="725,475" size="100,100">&lt;&lt;acknowledgement Andreas&gt;&gt;
    &lt;&lt;mention failed&gt;&gt;
        &lt;&lt;andreas&gt;&gt;?Title, I didn&#39;t yet get a chance to clarify my position in the council meeting recently. It must feel like we are working against you with our harshness but you must understand that we simply want to tutor you to become the awe-inspiring ruler that you are meant to be.&lt;&lt;/andreas&gt;&gt;
        You suppose his encouragement makes you feel a bit better...
    &lt;&lt;mention assassination&gt;&gt;
        &lt;&lt;andreas&gt;&gt;Glad to see you do well, ?title. I have been assured by ?Wymerus that the castle is secured and there is no chance of anyone being able to do something like that again.&lt;&lt;/andreas&gt;&gt;
        &lt;&lt;player&gt;&gt;Thank you, ?Andreas. That is reassuring.&lt;&lt;/player&gt;&gt;
    &lt;&lt;mention status&gt;&gt;
        &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
            ?Andreas, the Chancellor of the council, is known for his keen observational skills. He&#39;s always been good at noticing little changes in people and events.
            As you enter the council chamber, he gives you a once-over. He can sense that something is different about you. You&#39;ve been feeling more feminine lately, and it shows in your appearance. He gives you a knowing look but it looks like he decides not to mention it to you.
        &lt;&lt;elseif face() is &#39;andro&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;fem&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;man&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;mention history-book&gt;&gt;
        You take out the large history book you brought from the library and put it down on his desk with a heavy thud and a proud smile.
        &lt;&lt;andreas&gt;&gt;What&#39;s this? &quot;The Extended History of Avelon&quot;, ?title, have you read this book?&lt;&lt;/andreas&gt;&gt;
        You nod at him, trying to contain your pride.
        &lt;&lt;player&gt;&gt;That&#39;s right, took a while. I wanted to show you the effort I went through. It&#39;s a huge book and it&#39;s very boring but I managed to finish it! I suppose it was pretty informative as well.&lt;&lt;/player&gt;&gt;
        &lt;&lt;andreas&gt;&gt;Ha! Very direct, ?title. I suppose I&#39;ll take that feedback in consideration for the next edition.&lt;&lt;/andreas&gt;&gt;
        You stare at him with a confused look. He notices your befuddlement and points to the small faded letters at the bottom of the book. Yup, that clearly lists ?Andreas as one of the writers of this massive tome. You feel rather silly for not noticing this earlier.
        &lt;&lt;player&gt;&gt;Oh! I- uh- I didn&#39;t know you wrote this, ?Andreas. I&#39;m so sorry!&lt;&lt;/player&gt;&gt;
        ?Andreas looks at you as he starts laughing. You&#39;ve rarely seen him so amused before.
        &lt;&lt;andreas&gt;&gt;Hahaha, it&#39;s all right, ?title! I suppose you just wanted to show me what great strides you went through to continue your training. I&#39;m impressed, really! The contents of that book are very important for you to know as future ruler. And you&#39;re right actually, the book is quite long and boring. Not my best work, history is a monotonous subject.&lt;&lt;/andreas&gt;&gt;
        You smile at him, you actually feel rewarded in your efforts now that ?Andreas acknowledges your strife.
&lt;&lt;/acknowledgement&gt;&gt;</tw-passagedata><tw-passagedata pid="37" name="Andreas Ask" tags="" position="850,475" size="100,100">&lt;&lt;fullname Andreas&gt;&gt; is sitting at his desk in the grand hall.
&lt;&lt;andreas&gt;&gt;It&#39;s good to see you, ?title.&lt;&lt;/andreas&gt;&gt;
As soon as he sees you enter he stands up and gives you a bow.?nl
&lt;&lt;include &#39;Andreas Acknowledgement&#39;&gt;&gt;
&lt;&lt;if getStatLevel(&#39;statesmanship&#39;) &lt; $player.levelexpectation + 1&gt;&gt;
    &lt;&lt;andreas&gt;&gt;Are you here to learn? I have time for you now, should you be interested.&lt;&lt;/andreas&gt;&gt;
    He smiles at you with his usual politeness as he awaits your answer.

    /* &lt;&lt;decision &#39;Write&#39; &#39;Minigame Writing&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt; */
    &lt;&lt;decision &quot;Accept&quot; &#39;Andreas Lessons&#39;&gt;&gt;&lt;&lt;decisionicon statesmanship&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &quot;Politely decline&quot;&gt;&gt;
        &lt;&lt;player&gt;&gt;I&#39;m sorry, &lt;&lt;fullname andreas&gt;&gt;. I was simply here to visit.&lt;&lt;/player&gt;&gt;
        &lt;&lt;andreas&gt;&gt;Of course, please let me know if you want to continue your lessons. The things I teach you are important to learn for when you one day sit on the throne.&lt;&lt;/andreas&gt;&gt;
        His constant reminding of importance is slightly annoying but unfortunately you know he&#39;s right in what he says.
        &lt;&lt;decision &quot;Leave&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    You move over to the chair, expecting to start another lesson from him.
    &lt;&lt;andreas&gt;&gt;Ah, I&#39;m very sorry, ?title, but I have no time to tutor you right now.&lt;&lt;/andreas&gt;&gt;
    &lt;&lt;player&gt;&gt;Oh, well that&#39;s alright, ?Andreas.&lt;&lt;/player&gt;&gt;
    &lt;&lt;andreas&gt;&gt;I admire your diligence but we&#39;ve been spending so much time discussing statecraft that I haven&#39;t had enough time to see to my responsibilities. How about we reconvene after the next council meeting? I think I will be all caught up by then.&lt;&lt;/andreas&gt;&gt;
    &lt;&lt;player&gt;&gt;That sounds good, ?Andreas. Good luck with the work.&lt;&lt;/player&gt;&gt;
    &lt;&lt;decision &quot;Leave&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="38" name="Andreas Lessons" tags="" position="975,475" size="100,100">&lt;&lt;include `either(&#39;Andreas Lessons 1&#39;, &#39;Andreas Lessons 2&#39;, &#39;Andreas Lessons 3&#39;)`&gt;&gt;
&lt;&lt;changestat statesmanship 1&gt;&gt;

&lt;&lt;decision &#39;Thank ?Andreas and take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;addcounter &#39;andreas&#39; 1&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="39" name="Andreas Lessons WIP" tags="" position="1100,475" size="100,100">&lt;&lt;include `either(&#39;Andreas Lessons 1&#39;, &#39;Andreas Lessons 2&#39;, &#39;Andreas Lessons 3&#39;)`&gt;&gt;
?nl

Now sitting at his desk, ?Andreas hands you a journal together with quill and ink.
&lt;&lt;andreas&gt;&gt;It would be a good idea to write a short report of today&#39;s lesson. Take this moment to summarize what you learned, I feel like this is the best way to remember your tutoring.&lt;&lt;/andreas&gt;&gt;

&lt;&lt;decision &#39;Start writing&#39; &#39;Minigame Writing&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="40" name="Andreas Writing Finish" tags="" position="1225,475" size="100,100">&lt;&lt;changestat statesmanship 1&gt;&gt;
You lay down the quill as you finish writing. It&#39;s quite annoying that ?Andreas makes you write down every lesson but you must say that it helps you learn better.
&lt;&lt;andreas&gt;&gt;Very good, ?title. This looks like a nice report. I will keep the journal for you so you can use it again next time.&lt;&lt;/andreas&gt;&gt;

&lt;&lt;decision &#39;Thank ?Andreas and take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;addcounter &#39;andreas&#39; 1&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="41" name="Andreas Lessons 1" tags="" position="100,600" size="100,100">Today&#39;s lesson is definitely one of the more boring ones. ?andreas takes you through all sorts of written agreements that are important to the kingdom, from international treaties to contracts between landowners.
He tries to explain the nuances described in the texts but by the end of the lesson you can&#39;t even keep all the documents apart anymore.</tw-passagedata><tw-passagedata pid="42" name="Andreas Lessons 2" tags="" position="225,600" size="100,100">Today, ?andreas talks about how to lead meetings and make sure intricate conversations stay on point. Even though normally you would be the one to lead the council meetings in your father&#39;s absence, ?andreas has been given that role because of his experience. He gives you tips on how to be a neutral leader in these discussions and giving everyone time and space to share their opinions.</tw-passagedata><tw-passagedata pid="43" name="Andreas Lessons 3" tags="" position="350,600" size="100,100">For this lesson, ?andreas decided it&#39;s a good time to learn about diplomacy as he takes you with him to a meeting. There you find several diplomats from a neighboring kingdom waiting to meet with &lt;&lt;fullname andreas&gt;&gt;. He told you to sit in and observe while he welcomes the diplomats and converses with them. The discussions last for quite a while but you feel like you learned a lot.</tw-passagedata><tw-passagedata pid="44" name="Beau" tags="" position="475,600" size="100,100">&lt;&lt;if getTime() !== &#39;night&#39;&gt;&gt;
    &lt;&lt;if hasQuest(&#39;blacksmith-intro&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Ask ?Beau about what she\&#39;s selling&#39; &#39;Blacksmith Intro&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;elseif hasCompletedQuest(&#39;blacksmith-intro&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Visit the blacksmith&#39; &#39;Blacksmith Visit&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;if !hasCounter(&#39;beau-apprentice&#39;)&gt;&gt;
            &lt;&lt;decision &#39;You see a sign hanging outside the smithy&#39; &#39;Blacksmith Apprentice 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="45" name="Blacksmith Intro" tags="" position="600,600" size="100,100">You walk into the smithy and take a good look around. There&#39;s a whole collection of finely crafted weapons displayed all over the walls. A dummy stands in the middle of her shop, proudly displaying a set of intricate plate armor.?nl

The blacksmith herself is currently working at the forge and when you walk in that direction you are immediately met with the intense heat. A loud clanging echoes through the shop - and only when ?Beau notices you enter - does she stop hammering. The horseshoe can wait, a customer is here.?nl

She excitedly welcomes you and walks over to the counter.
&lt;&lt;beau&gt;&gt;A new customer! Welcome, friend!&lt;&lt;/beau&gt;&gt;
You walk up to the counter and smile at her.
&lt;&lt;player&gt;&gt;Ah, yes, hi ?Beau.&lt;&lt;/player&gt;&gt;
For a minute there you forgot that you&#39;re wearing a disguise and she doesn&#39;t recognize your royal self. Probably should&#39;ve acted like you don&#39;t know her. Oops.
&lt;&lt;beau&gt;&gt;You know my name already? Word must travel fast of ?Beau&#39;s legendary forge! What is your name then, friend?&lt;&lt;/beau&gt;&gt;
&lt;&lt;player&gt;&gt;Oh, I&#39;m ?newname. Yes, it&#39;s a lovely smithy you have here.&lt;&lt;/player&gt;&gt;
She raises her arms and gestures heroically at all the fine armors and blades that are hanging all over the shop.
&lt;&lt;beau&gt;&gt;It is indeed magnificent, thank you for noticing, ?newname. Don&#39;t feel intimidated by the sheer quality and craftsmanship of my creations. I always charge a fair price.&lt;&lt;/beau&gt;&gt;
Her booming demeanor is strangely intense but still feels friendly.
&lt;&lt;beau&gt;&gt;Now, friend, tell me how I can help you. Are you looking for some nails? A horseshoe? Or perhaps a sword and armor? That would be something wouldn&#39;t it! Ha ha ha!&lt;&lt;/beau&gt;&gt;
Her bellowing laugh echoes loudly through the shop, almost as loud as the clanging of her hammer just a moment earlier.
&lt;&lt;decision &#39;Tell her you\&#39;re interested in her more intimate section.&#39; &#39;Blacksmith Intro 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="46" name="Blacksmith Intro 2" tags="" position="725,600" size="100,100">Seeing as you&#39;re here simply because of what ?Eve told you... You&#39;re kind of interested to see what she has to offer in that area.
&lt;&lt;player&gt;&gt;Well, uhm- I actually came to look at your... &lt;em&gt;private collection&lt;/em&gt;...&lt;&lt;/player&gt;&gt;
You say that with such a sly tone, you&#39;re convinced that must&#39;ve come across incredibly stupid. How do people normally subtly hint they want to look at sex toys?
&lt;&lt;beau&gt;&gt;Oh! You&#39;re a ?man of romance! I should have guessed!&lt;&lt;/beau&gt;&gt;
You awkwardly nod at her before she continues.
&lt;&lt;beau&gt;&gt;I hadn&#39;t even known word has spread about my new gifts collection! Here, allow me to show you.&lt;&lt;/beau&gt;&gt;
Gifts? Why would someone gift these things??nl
She takes out a glass display case and puts it on the counter. Surprisingly, inside you find no dildos but a collection of small items instead. You see all kinds of finely crafted objects. From a metal quill with a magnificent feather to a beautiful golden flower pendant.

&lt;div id=&quot;toys&quot;&gt;
    &lt;div class=&quot;toy&quot;&gt;
        &lt;img class=&quot;toy-img&quot; src=&quot;images/equipment/gift_quill.jpg&quot;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;toy&quot;&gt;
        &lt;img class=&quot;toy-img&quot; src=&quot;images/equipment/gift_pendant.jpg&quot;&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;&lt;beau&gt;&gt;Take a good look, this is the all new gifts section of my store. Every item is hand made, just look at the fine details! You&#39;ll win over anyone&#39;s heart with these romantic presents!&lt;&lt;/beau&gt;&gt;
You take a moment to appreciate her work as you consider how to bring up that you actually meant something different when you wanted to view her private collection.
&lt;&lt;player&gt;&gt;Uhm. That looks really nice, ?Beau. I&#39;ll definitely take it into consideration but I was actually looking for something slightly different...&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Try to tell her you\&#39;re interested in her more intimate section, again.&#39; &#39;Blacksmith Intro 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="47" name="Blacksmith Intro 3" tags="" position="850,600" size="100,100">&lt;&lt;player&gt;&gt;You see, I actually heard you&#39;re also selling &lt;em&gt;private&lt;/em&gt; items. More private than romantic gifts. Intimate even.&lt;&lt;/player&gt;&gt;
She looks at you with a broad smile that slowly turns into another bellowing laugh.
&lt;&lt;beau&gt;&gt;Ha ha ha! That&#39;s what you meant! Well why didn&#39;t you say so, friend. Follow me!&lt;&lt;/beau&gt;&gt;
You awkwardly laugh with her as she goes on for a good minute. Though she&#39;s finding this situation much too entertaining, her laugh is quite infectious.?nl
Meanwhile, she moves over to a corner of the shop and walks behind a display rack that seems to be hiding a secret backside of the shop. You follow her through the dark opening and find yourself in a cramped space, immediately feeling how much bigger this blacksmith is than you.
&lt;&lt;beau&gt;&gt;Here we are. The best toys in the kingdom.&lt;&lt;/beau&gt;&gt;
She opens the hatch of a small window, letting in some light into this little alcove. The light illuminates your surroundings and you are met with the shining view of about a hundred different sex-toys in all shapes and sizes. Your mouth instantly falls agape, taking in the lewd view.
&lt;&lt;player&gt;&gt;Wow.&lt;&lt;/player&gt;&gt;
&lt;&lt;beau&gt;&gt;It&#39;s a nice collection, right? I started this more as a hobby but now it has turned into a pretty lucrative business. Apparently people are really craving something to help fulfil their lustful desires! Ha ha ha!&lt;&lt;/beau&gt;&gt;
She starts another hollering laugh. Now much more intense because of the small space and close vicinity, but somehow you&#39;re not even bothered by it as you&#39;re still studying the different toys you see before you.?nl

In the dildo section, it seems like ?Beau is selling four different levels of tools, from copper to crystal. 


&lt;div id=&quot;toys&quot;&gt;
    &lt;div class=&quot;toy&quot;&gt;
        &lt;img class=&quot;toy-img&quot; src=&quot;images/equipment/dildo_copper.jpg&quot;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;toy&quot;&gt;
        &lt;img class=&quot;toy-img&quot; src=&quot;images/equipment/dildo_iron.jpg&quot;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;toy&quot;&gt;
        &lt;img class=&quot;toy-img&quot; src=&quot;images/equipment/dildo_gold.jpg&quot;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;toy&quot;&gt;
        &lt;img class=&quot;toy-img&quot; src=&quot;images/equipment/dildo_crystal.jpg&quot;&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;&lt;beau&gt;&gt;Ah, you&#39;re looking at the dildos? They&#39;re really something actually. I&#39;ve currently got four tiers, with the lowly copper dildo being a good beginner&#39;s choice and the pricey crystal dildo being only suitable for the really experienced.&lt;&lt;/beau&gt;&gt;
&lt;&lt;beau&gt;&gt;I feel like I&#39;ve only really perfected my magic smithing with these beauties. Even though they&#39;re made of solid metals and minerals, they are enchanted with powerful spells, making them feel &lt;em&gt;entirely realistic&lt;/em&gt; when used.&lt;&lt;/beau&gt;&gt;
You look at her with an unexpected amazement. You had no idea ?Beau was running this kind of operation and you definitely wouldn&#39;t have guessing she put this much effort into this...
&lt;&lt;beau&gt;&gt;I&#39;ll give you a moment to look around. I&#39;ll be at the counter if you need me.&lt;&lt;/beau&gt;&gt;
&lt;&lt;player&gt;&gt;Uh- yeah, thank you, ?Beau.&lt;&lt;/player&gt;&gt;
She leaves you alone in the small backroom as you take some more time looking over all the toys.?nl
&lt;&lt;if isInChastity()&gt;&gt;
    At this point you spot something you are much more familiar with. There&#39;s a whole wall of chastity cages in all colors and sizes. ?Kathryn mentioned sending your measurements to the blacksmith and having the one you&#39;re wearing now custom made... This is the first time you&#39;re getting a good look at all the different options.?nl
    There&#39;s a bunch of metal ones in sizes that are much larger than yours, but strangely enough there seems to be a few that look much smaller than what you&#39;re wearing. They almost look... flat? How could someone ever wear something like that? Thinking about it slightly intimidates you so you decide to just go back to ?Beau and leave this section for now.
&lt;&lt;else&gt;&gt;
    After standing there for at least twenty seconds, the awkwardness of it makes you decide to simply leave and you head back to ?Beau.
&lt;&lt;/if&gt;&gt;

&lt;&lt;beau&gt;&gt;So? Did you find something you like?&lt;&lt;/beau&gt;&gt;
Well, you&#39;ve worked at the tavern for a bit now, you could actually consider buying something... Looking at the price tags though, some things seems quite expensive. Maybe you could ask ?Leopold for some gold from the royal treasury?

&lt;&lt;decision &#39;Leave the smithy&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Uhm- I&#39;m not sure, I&#39;m going to have to uh- think it over a bit more. Thank you for showing me though.&lt;&lt;/player&gt;&gt;
    &lt;&lt;beau&gt;&gt;Of course, be welcome any time, friend! The store is open to you, secret sections and all!&lt;&lt;/beau&gt;&gt;
    &lt;&lt;decision &#39;Take your leave&#39; &#39;Town square&#39;&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        &lt;&lt;completequest &#39;blacksmith-intro&#39;&gt;&gt;
        &lt;&lt;addevent wake &#39;Wake Event Sybille Note About Velma&#39;&gt;&gt;&lt;&lt;delay 3&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Pick something to buy&#39; &#39;Beau Store&#39;&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        &lt;&lt;completequest &#39;blacksmith-intro&#39;&gt;&gt;
        &lt;&lt;addevent wake &#39;Wake Event Sybille Note About Velma&#39;&gt;&gt;&lt;&lt;delay 3&gt;&gt;&lt;&lt;/addevent&gt;&gt;
        &lt;&lt;decisionicon gold&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="48" name="Blacksmith Visit" tags="" position="975,600" size="100,100">&lt;&lt;money gold true&gt;&gt;
You walk into the smithy and find it empty except for ?Beau, who&#39;s smithing away at her anvil.
&lt;&lt;beau&gt;&gt;Ah! Welcome back, friend! What can I do for you?&lt;&lt;/beau&gt;&gt;

&lt;&lt;decision &#39;Browse the store&#39; &#39;Beau Store&#39;&gt;&gt;
    &lt;&lt;decisionicon gold&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Leave the store&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Uh- Sorry- I was just visiting, ?Beau.&lt;&lt;/player&gt;&gt;
    She looks at you and loudly starts with her iconic laugh again.
    &lt;&lt;beau&gt;&gt;Walking into a store and immediately leaving again! How odd! Ha ha ha!&lt;&lt;/beau&gt;&gt;
    You laugh awkwardly with her before you step out of the store again. She&#39;s probably right. Pretty weird to leave right after walking into a store but she just doesn&#39;t understand the struggles of being a royal prince undercover in a town full of people that almost recognize you. Stuff&#39;s rough.
    &lt;&lt;decision &#39;Take your leave&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="49" name="Blacksmith Apprentice 1" tags="" position="1100,600" size="100,100">As you&#39;re walking past the smithy you notice a sign in the window with big, bold lettering. 

&lt;&lt;note&gt;&gt;&gt;
    HELP WANTED!?nl
    Part-time blacksmith apprentice needed!
&lt;&lt;/note&gt;&gt; 

Inside, you can hear the muffled sound of grunting and the hammering of metal on metal. A cloud of heat wafts out the door, warming your face.?nl

You stare at the sign, pondering. You&#39;ve never considered doing the work of a blacksmith before, but there&#39;s something magical about transforming raw metal into useful goods. Perhaps you could learn something. 

&lt;&lt;decision &#39;Inquire about the position&#39; &#39;Blacksmith Apprentice 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Ignore the sign and keep walking&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="50" name="Blacksmith Apprentice 2" tags="" position="1225,600" size="100,100">The intense heat of the forge steals your breath away as you walk inside the building. You see ?Beau standing in front of the fire, hammering a massive piece of metal into shape. She looks up as you enter and beams widely.

&lt;&lt;beau&gt;&gt;Ah, ?newname! How can I help you?&lt;&lt;/beau&gt;&gt;

&lt;&lt;player&gt;&gt;?Greeting, ?Beau! I noticed your sign out front.&lt;&lt;/player&gt;&gt;

She chuckles loudly, the sound booming throughout the sweltering space.

&lt;&lt;beau&gt;&gt;Excellent! I could use help right now. Can you get on those bellows? The fire isn&#39;t hot enough!&lt;&lt;/beau&gt;&gt;

You glance doubtfully at the hearth, which is already blazing fiercely. Still, you should probably follow her instructions. 

&lt;&lt;player&gt;&gt;Ah- uhm- yes, of course!&lt;&lt;/player&gt;&gt;

You hurry to the massive bellows and begin to work them, finding the task requires much more strength than you expected.

&lt;&lt;player&gt;&gt;Am I doing it right?&lt;&lt;/player&gt;&gt;

&lt;&lt;beau&gt;&gt;Yes, that&#39;s perfect, keep going!&lt;&lt;/beau&gt;&gt;

The fire grows even hotter as ?Beau sticks the metal into the forge. In the brief pause as she waits for the metal to heat back up, she takes a step back and pulls off her leather apron, wiping the sweat from her brow. The shirt she&#39;s wearing sticks to her body in the heat, highlighting every detail. You stare at her form, the shape of her breasts and her massive, rippling muscles.?nl

Suddenly, pain sears across your skin and you yelp loudly as you stumble instinctively backward. In your distraction, it seems you leaned into the side of forge. 

&lt;&lt;beau&gt;&gt;Oh no, ?newname, that looks painful! I have something for burns, come here.&lt;&lt;/beau&gt;&gt;

?Beau leads you a few steps away from the forge. You wince as you walk on the injured leg, the pain intense as the heat works its way through your flesh.?nl

?Beau looks at your leg, biting her lip.

&lt;&lt;beau&gt;&gt;I think this will be easiest if you remove your trousers, friend.&lt;&lt;/beau&gt;&gt;

You stare at her, then at the door to the shop. She&#39;s probably right that removing your trousers is the best move, but it would feel awfully private. What if someone walked in? &lt;&lt;if hasEquipmentTag(&#39;chastity&#39;)&gt;&gt;Worse, she could notice your chastity cage&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;, or that you&#39;re not really a lady&lt;&lt;/if&gt;&gt;.&lt;&lt;/if&gt;&gt; &lt;&lt;if !hasEquipmentTag(&#39;chastity&#39;) and hasTag(&#39;crossdresser&#39;)&gt;&gt;Worse, she could notice that you aren&#39;t really a lady.&lt;&lt;/if&gt;&gt;?nl

&lt;&lt;decision &#39;Immediately remove your trousers&#39; &#39;Blacksmith Apprentice 3&#39; depravity small&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Refuse out of modesty&#39; &#39;Blacksmith Apprentice 4&#39; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="51" name="Blacksmith Apprentice 3" tags="" position="100,725" size="100,100">Perhaps it&#39;s due to the pain, but you find yourself automatically following her suggestion. You strip your trousers off and stand there awkwardly, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;trying to hide&lt;&lt;else&gt;&gt;aware that she now has a full view of&lt;&lt;/if&gt;&gt; your &lt;&lt;if settings.sph&gt;&gt;tiny&lt;&lt;/if&gt;&gt; lump. For a split-second you catch ?Beau looking curiously at your crotch, but she looks away quickly. You swear a slight flush rises on her already warm cheeks.

&lt;&lt;beau&gt;&gt;Here, let me help you sit down.&lt;&lt;/beau&gt;&gt;

&lt;&lt;include &#39;Blacksmith Apprentice 5&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="52" name="Blacksmith Apprentice 4" tags="" position="225,725" size="100,100">Involuntarily, you take a quick step back. The pain sears through your leg, and you look down to see red skin under a hole burned in the fabric of your trousers.

&lt;&lt;player&gt;&gt;Ouch! Could you just work through the hole in the fabric?&lt;&lt;/player&gt;&gt;

&lt;&lt;beau&gt;&gt;I&#39;ll do my best! Here, sit down.&lt;&lt;/beau&gt;&gt;

&lt;&lt;include &#39;Blacksmith Apprentice 5&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="53" name="Blacksmith Apprentice 5" tags="" position="350,725" size="100,100">?Beau helps you into a simple wooden chair and rests your foot on a another, the better to see the wound.

&lt;&lt;beau&gt;&gt;Ah, good. It&#39;s not so bad. A little cream will help, though!&lt;&lt;/beau&gt;&gt;

She retrieves a jar of ointment from a drawer. She kneels next to you and begins to apply it carefully to your burned skin. The pale cream stings at first, but after a few moments the effect dulls and the pain lessens.

&lt;&lt;player&gt;&gt;Oh, that feels much better. Thank you!&lt;&lt;/player&gt;&gt;

You find your eyes straying across ?Beau&#39;s body again, watching the muscles in her arms shift as she touches you with an uncharacteristic gentleness. She looks up suddenly, her face level with yours even though she is kneeling on the stone floor. Did she catch you looking?

&lt;&lt;beau&gt;&gt;You&#39;re welcome!&lt;&lt;/beau&gt;&gt; 

There is a moment of silence as you flounder, unsure what to say next. Perhaps you&#39;ve gone woozy from the heat of the forge, but ?Beau&#39;s physique on full display like this seems to have negatively impacted your ability to speak. 

?Beau looks at you curiously, then lets out a loud chuckle.

&lt;&lt;beau&gt;&gt;Is it just me, or is it getting really hot in here?&lt;&lt;/beau&gt;&gt;

She winks. Is she making a move on you? Your cheeks feel hot. Perhaps you should take this burn as a sign that blacksmithing isn&#39;t for you and leave before anything happens. Or perhaps you should embrace the tension in the air...

&lt;&lt;decision &#39;Lean in for a kiss&#39; &#39;Blacksmith Apprentice Escalate&#39; depravity small&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Make an excuse to leave&#39; &#39;Blacksmith Apprentice Leave&#39; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="54" name="Blacksmith Apprentice Leave" tags="" position="475,725" size="100,100">You stand up quickly&lt;&lt;if hasVisited(&#39;Blacksmith Apprentice 3&#39;)&gt;&gt;, pulling your trousers back up&lt;&lt;/if&gt;&gt;.

&lt;&lt;player&gt;&gt;I need to be going, but I appreciate your help. I suppose I&#39;m simply too clumsy to work near a forge!&lt;&lt;/player&gt;&gt;

You chuckle awkwardly. ?Beau stands up too, towering over you as she lets out a booming laugh. 

&lt;&lt;beau&gt;&gt;Well, friend, that could be the case. I think it must be a record to burn yourself within a minute of working on the bellows! Ha ha ha!&lt;&lt;/beau&gt;&gt;

You give her a quick &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;curtsy&lt;&lt;else&gt;&gt;bow&lt;&lt;/if&gt;&gt; and scurry out of the smithy.

&lt;&lt;decision &#39;Leave&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;addcounter &#39;beau-apprentice&#39; 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="55" name="Blacksmith Apprentice Escalate" tags="" position="600,725" size="100,100">You lock eyes with her, still feeling the touch of her fingers against your leg, and lean toward her slightly.

&lt;&lt;player&gt;&gt;Yes... It does feel awfully hot in here...&lt;&lt;/player&gt;&gt;

?Beau grins, apparently recognizing the desire in your face, and meets your lips with her own. The scent of leather and smoke hits your nose as you relax into the kiss. She pulls away for a moment, looking you in the eyes.

&lt;&lt;beau&gt;&gt;Is this okay?&lt;&lt;/beau&gt;&gt;

&lt;&lt;player&gt;&gt;Oh, y-yes, it was really nice...&lt;&lt;/player&gt;&gt;

?Beau finds your lips again, kissing you with a bold passion. As the kiss deepens, she wraps a large hand around the back of your neck, bringing you in closer.?nl

Perhaps your body is shocked from the sudden change from pain to pleasure, but you find desire quickly building inside of you. &lt;&lt;if hasEquipmentTag(&#39;chastity&#39;)&gt;&gt;You feel your ?dick strain against its cage as your body responds to the kiss.&lt;&lt;else&gt;&gt;Your ?dick is already growing hard under the thin fabric of your undergarments, which ?Beau seems to notice.&lt;&lt;/if&gt;&gt;

&lt;&lt;beau&gt;&gt;Maybe it&#39;s &lt;i&gt;too&lt;/i&gt; hot for all these clothes, ha ha ha!&lt;&lt;/beau&gt;&gt;

She winks at you, and you see her glance toward a shelf underneath a workbench. You see there what looks like a large dildo with straps attached to it. Does she want to...use that on you? Your ?dick certainly wants to say yes, but perhaps you should ignore it this time...

&lt;&lt;decision &#39;Escalate the sexual tension&#39; &#39;Blacksmith Apprentice Sex&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Leave before things get too steamy&#39; &#39;Blacksmith Apprentice Leave&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="56" name="Blacksmith Apprentice Sex" tags="spicy" position="725,725" size="100,100">&lt;&lt;player&gt;&gt;I think you might be right...&lt;&lt;/player&gt;&gt;

Before you can say anything else, ?Beau has stripped off her clothes in one swift movement. She stands above you confidently, completely naked, and you stare up at her as you take in every detail of her chiseled body. &lt;&lt;if hasEquipmentTag(&#39;chastity&#39;)&gt;&gt;Your ?dick is really straining against its confines now. &lt;&lt;else&gt;&gt;Your ?dick immediately responds to the glorious sight of her, standing hard and at attention.&lt;&lt;/if&gt;&gt;

&lt;&lt;beau&gt;&gt;Go on then, don&#39;t be shy! Ha ha ha!&lt;&lt;/beau&gt;&gt;

Hurriedly, you stand up and strip off your clothes.

&lt;&lt;if hasEquipmentTag(&#39;chastity&#39;)&gt;&gt;
    ?Beau notices your chastity cage and grins widely.

    &lt;&lt;beau&gt;&gt;That looks great on you! Since you&#39;re all locked up, would you like to give this a try? I just finished it earlier today...&lt;&lt;/beau&gt;&gt;
&lt;&lt;else&gt;&gt;    
    &lt;&lt;if settings.sph&gt;&gt;
        &lt;&lt;beau&gt;&gt;Wow, you certainly have a small little guy! How cute, ha ha ha!&lt;&lt;/beau&gt;&gt;
        &lt;&lt;player&gt;&gt;Oh- um, okay...&lt;&lt;/player&gt;&gt;
        You don&#39;t think she meant it in a mean way, but you still feel embarrassed about your ?dick. Luckily attraction quickly takes over your mind as you take in her strong, naked body.
        &lt;&lt;beau&gt;&gt;What do you think about trying this out? I just finished it earlier today...&lt;&lt;/beau&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;beau&gt;&gt;Damn, you&#39;re looking at hot as the forge, ha ha ha!&lt;&lt;/beau&gt;&gt;
        &lt;&lt;player&gt;&gt;S-so are you!&lt;&lt;/player&gt;&gt;
        You feel yourself growing even harder as you take in her strong, naked body.
        &lt;&lt;beau&gt;&gt;What do you think about trying this out? I just finished it earlier today...&lt;&lt;/beau&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

She pulls the dildo off the shelf and shows it to you proudly.
    
&lt;&lt;player&gt;&gt;Wow, that&#39;s big! Do you...wear it?&lt;&lt;/player&gt;&gt;

&lt;&lt;beau&gt;&gt;You bet I do, ha ha ha!&lt;&lt;/beau&gt;&gt;

You feel a jolt of anticipation run through you as you take in the thick phallus and imagine her penetrating you with it.

&lt;&lt;player&gt;&gt;I-I think, um, that would be nice...&lt;&lt;/player&gt;&gt;

&lt;&lt;beau&gt;&gt;Fuck yeah.&lt;&lt;/beau&gt;&gt;

&lt;&lt;decision &#39;Watch her put on the strap-on&#39; &#39;Blacksmith Apprentice Pegging&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="57" name="Blacksmith Apprentice Pegging" tags="spicy" position="850,725" size="100,100">She deftly begins to tie the strap-on to herself. Pulling a bottle of lubrication potion from a drawer, she applies a generous amount. &lt;&lt;if hasEquipmentTag(&#39;chastity&#39;)&gt;&gt;Feeling your ?dick desperately straining to be free&lt;&lt;else&gt;&gt;Your ?dick now poking rock-hard into the air,&lt;&lt;/if&gt;&gt; you brace yourself against a workbench and stare into the blazing fire of the forge.?nl

You feel the sweat running down your skin as ?Beau approaches you from behind, running her large hands down your back. She gently massages your entrances with one hand, applying the potion there.

&lt;&lt;beau&gt;&gt;I&#39;m going to slowly push into you, okay?&lt;&lt;/beau&gt;&gt;

You nod, biting your lip as you feel her poke the dildo against your hole. She maintains a gentle yet firm pressure until finally the dildo passes through the hole and slides inside of you. A moan escapes your lips at the same time a low one escapes hers. 

&lt;&lt;beau&gt;&gt;Fuck, that&#39;s good, but I think this angle could be better...&lt;&lt;/beau&gt;&gt;

Before you realize what&#39;s happening, she&#39;s picked you up in her strong arms. She easily holds you aloft and slowly begins to thrust your entire body onto the dildo. You moan as she moves you up and down on her fake cock, amazed by how easily she&#39;s able to maneuver your body. 

&lt;&lt;player&gt;&gt;Fuck, you&#39;re so strong!&lt;&lt;/player&gt;&gt;

?Beau moans loudly in response, the muscles of her arms rippling as she thrusts you repeatedly onto the strap-on. 

&lt;&lt;beau&gt;&gt;Fuck yeah, take my cock...&lt;&lt;/beau&gt;&gt;

The combination of heat and pleasure takes over your mind and you close your eyes, riding the waves of pleasure that move through you as you take her thick dildo deeper and deeper inside. 

&lt;&lt;beau&gt;&gt;Mmph, that&#39;s good...&lt;&lt;/beau&gt;&gt;

She seems to be enjoying fucking you so much, you wonder vaguely whether the dildo has some magical self-stimulating property.

&lt;&lt;player&gt;&gt;That feels so good...&lt;&lt;/player&gt;&gt;

She&#39;s now slamming the dildo into you hard, and you hear her moans begin to crescendo.

&lt;&lt;beau&gt;&gt;I&#39;m going to cum!&lt;&lt;/beau&gt;&gt;

&lt;&lt;if hasEquipmentTag(&#39;chastity&#39;)&gt;&gt;
    You wish you could touch yourself, but you&#39;ll have to enjoy her orgasm vicariously. You enjoy her final thrusts into you as she cums, crying out loudly in pleasure.?nl
&lt;&lt;else&gt;&gt;
    You wrap your &lt;&lt;if settings.sph&gt;&gt;fingers&lt;&lt;else&gt;&gt;hand&lt;&lt;/if&gt;&gt; around your ?dick and stimulate yourself. You&#39;re already so turned on it takes only a few seconds before you&#39;re orgasming with her, your cum splattering across the workbench in front of you as she cries out loudly in pleasure.?nl
&lt;&lt;/if&gt;&gt;

You&#39;re both now breathing heavily, covered in sweat from the heat and exertion. ?Beau slides the dildo out of you and gently sets you down.

&lt;&lt;beau&gt;&gt;That was great, ha ha ha!&lt;&lt;/beau&gt;&gt;

&lt;&lt;player&gt;&gt;That was...amazing.&lt;&lt;/player&gt;&gt;

You suddenly crash back to reality as you realize that the shop door has been unlocked this entire time. Hurriedly, you re-dress as ?Beau lazily pulls her own clothes back on. She&#39;s only just tugged her shirt over her defined stomach muscles when there&#39;s a tinkle of a bell and someone enters the shop.?nl

?Beau winks at you and you catch an expression of confusion on the customer&#39;s face.

&lt;&lt;beau&gt;&gt;I need to handle this customer, but thanks for being such a great...apprentice. I&#39;ll see you around, ha ha ha!&lt;&lt;/beau&gt;&gt;

&lt;&lt;player&gt;&gt;Yeah, see you!&lt;&lt;/player&gt;&gt;

Wiping sweat off your brow, your legs weak with pleasure, you avoid making eye contact with the customer as you dart around them and hurry to the door.

&lt;&lt;decision &#39;Leave the shop&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;addcounter &#39;beau-apprentice&#39; 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="58" name="Bread" tags="" position="975,725" size="100,100">&lt;&lt;decision &#39;Look for a snack&#39; &#39;Kitchen Find Snack&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="59" name="Kitchen Find Snack" tags="" position="1100,725" size="100,100">&lt;&lt;setlocation &#39;Kitchen&#39;&gt;&gt;

You step into the kitchen,

&lt;&lt;if getTime() == &#39;morning&#39;&gt;&gt;
    surprised to see that the room is currently empty. It looks as though the kitchen staff have cleaned up since breakfast but must be taking a break before lunch.
&lt;&lt;elseif getTime() == &#39;noon&#39;&gt;&gt;
    surprised to see that the room is currently empty. It looks as though the kitchen staff have cleaned up since lunch but must be taking a break before dinner.
&lt;&lt;elseif getTime() == &#39;evening&#39;&gt;&gt;
    which is currently quiet and empty. It looks as though the kitchen staff have cleaned up since dinner and have retired for the night. 
&lt;&lt;elseif getTime() == &#39;night&#39;&gt;&gt;
    unsurprised to see that the room is dark and empty. The staff must have cleaned up from dinner and retired for the night hours ago. The room is lit only by the occasional ray of moonlight coming through the window.
&lt;&lt;/if&gt;&gt;

Your stomach growls in hunger, your eyes straying to the larder in the corner of the room.

&lt;&lt;player&gt;&gt;Just a quick snack...&lt;&lt;/player&gt;&gt;

You cross the stone tiles of the kitchen and enter the small pantry room. A delicious smell of freshly baked bread hits your nose, and you look down to see a small mountain of shiny, soft-looking loaves, likely baked by ?Rosa in preparation for the next meal.?nl

As you gaze at the loaves, you start to notice details you&#39;ve always taken for granted before. Their curves, their supple exterior, the promise of a pillowy soft crumb inside... You shake yourself. Are you seriously finding this bread...attractive? You should probably just go on with your original plan and grab a snack. On the other hand, there is something inside you that is curious to try a new way of pleasuring yourself...&lt;br&gt;

&lt;&lt;decision &#39;Grab a snack and leave&#39; virtue small&gt;&gt;
    &lt;br&gt;You push aside the depraved thought and root through the stack until you find a small bun, perfectly sized for a snack. You snatch it up and take a bite, the soft, warm interior melting in your mouth.?nl

    You head back out of the larder, resolving to forget this strange idea and get on with your day.

    &lt;&lt;decision &#39;Leave the kitchen&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Explore what sensations the bread might offer&#39; &#39;Kitchen Bread Porn&#39; depravity medium&gt;&gt;
    &lt;&lt;disableif hasEquipmentTag(&#39;chastity&#39;)&gt;&gt;
        You are locked in chastity.
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="60" name="Kitchen Bread Porn" tags="spicy" position="1225,725" size="100,100">&lt;&lt;setlocation &#39;Larder&#39;&gt;&gt;
&lt;&lt;addcounter &#39;bread&#39; 1&gt;&gt;

Your eyes settle on a particularly perfect loaf, its surface smooth and its color a gently toasted orange-brown. You pick it up carefully with both hands and stroke its toasted surface. You breathe in deeply, enjoying its sweet scent.

&lt;&lt;player&gt;&gt;Come here often?&lt;&lt;/player&gt;&gt;

You laugh at your own joke. The bread remains silent as ever. Even so, some part of you is enjoying the ridiculousness of this situation. You feel your ?dick is already oddly hard in anticipation of what will come next.?nl

Gently, you push a finger through the crust. The soft crumb gives way almost eagerly, widening easily as you add a second finger. Soon you&#39;ve created a hole that seems begging to be filled.

&lt;&lt;player&gt;&gt;Well, might as well...&lt;&lt;/player&gt;&gt;

You lower the bread and hold it in front of yourself, your ?dick now raging hard in anticipation. Slowly, you push inside the loaf. The delicate, moist crumb takes your ?dick easily, enveloping it in a soft warmth that sends a wave of pleasure through your body.?nl

Surprised at the unexpected ecstasy, you begin to thrust the bread in a pounding rhythm. You quickly lose yourself in the pleasure of it, and catch yourself off-guard when a strangled moan escapes your lips.

&lt;&lt;player&gt;&gt;Oh, wow, fuck...&lt;&lt;/player&gt;&gt;

Your motions become nothing more than a blur and finally you thrust a final time, deeper than ever before. You cry out in ecstasy as you spill yourself inside the bread, your cum seeping in to become one with the crumb.?nl

&lt;&lt;if settings.cum&gt;&gt;
    Still breathing heavily, you stare at the cum-soaked loaf of bread you hold in your hands...&lt;br&gt;
        &lt;&lt;decision &#39;Eat the bread&#39; depravity small&gt;&gt;
            &lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;
            
            &lt;br&gt;You&#39;re not sure where this perverted craving is coming from, but the fact that you have ejaculated into this bread isn&#39;t turning you off from eating it. The opposite, in fact. Hungrily, you tear off chunks of the semen-filled loaf and stuff them into your mouth, enjoying the bitter taste of your own ejaculate as you swallow it down.?nl

            Soon you&#39;ve eaten the entire loaf of bread. You should probably leave the kitchen now, but at least you got that snack you came for.
            
            &lt;&lt;decision &#39;Return to the castle&#39; &#39;Kitchen&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
        &lt;&lt;decision &#39;Throw the bread away&#39;&gt;&gt;
            
            &lt;br&gt;You&#39;re not sure what came over you and you certainly don&#39;t plan to ever tell anyone of this. Furtively, you dump the semen-filled bread in the trash and make your way out of the kitchen, completely forgetting about the snack you intended to get.

            &lt;&lt;decision &#39;Return to the castle&#39; &#39;Kitchen&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    As you come down from your orgasm, your sense quickly begins to return to you and you stare in mild horror at the cum-soaked loaf of bread you hold in your hands. You&#39;re not sure what came over you and you certainly don&#39;t plan to ever tell anyone of this.?nl

    Furtively, you dump the semen-filled bread in the trash and make your way out of the kitchen, completely forgetting about the snack you intended to get.

    &lt;&lt;decision &#39;Return to the castle&#39; &#39;Kitchen&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="61" name="Caspar" tags="" position="100,850" size="100,100">&lt;&lt;if getTime() === &#39;night&#39;&gt;&gt;
    &lt;&lt;if getCharacterLocation(&#39;wymerus&#39;) is &#39;Courtyard&#39;&gt;&gt;
        &lt;&lt;decision &#39;You hear strange noises coming from the far corner of the courtyard...&#39; &#39;Caspar Night&#39;&gt;&gt;
            &lt;&lt;addcounter &#39;wymerus-night&#39; 1&gt;&gt;
            &lt;&lt;addcounter &#39;caspar-night&#39; 1&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;elseif hasTag(&#39;wymerus-peeped&#39;)&gt;&gt;
        &lt;&lt;decision &#39;You find ?Caspar alone, reading a book&#39;&gt;&gt;
            &lt;&lt;addcounter &#39;wymerus-night&#39; 1&gt;&gt;
            &lt;&lt;addcounter &#39;caspar-night&#39; 1&gt;&gt;
            &lt;&lt;if !hasVisited(&#39;Caspar Sex 1&#39;)&gt;&gt;
                &lt;&lt;goto &#39;Caspar Courtyard Reading&#39;&gt;&gt;
            &lt;&lt;elseif !hasVisited(&#39;Caspar Sex 2&#39;)&gt;&gt;
                &lt;&lt;goto &#39;Caspar Reading Free Use&#39;&gt;&gt;
            &lt;&lt;elseif !hasVisited(&#39;Caspar Sex 3&#39;)&gt;&gt;
                &lt;&lt;goto &#39;Caspar Free Use Repeating&#39;&gt;&gt;
            &lt;&lt;else&gt;&gt;
                &lt;&lt;goto `either(&#39;Caspar Courtyard Reading&#39;, &#39;Caspar Free Use Repeating&#39;)`&gt;&gt;
            &lt;&lt;/if&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="62" name="Caspar Acknowledgement" tags="" position="225,850" size="100,100">&lt;&lt;acknowledgement Caspar&gt;&gt;
    &lt;&lt;mention failed&gt;&gt;
        &lt;&lt;caspar&gt;&gt;Hey, ?title, I heard the council wasn&#39;t happy with your progress... I just wanted to say I&#39;m here for you to spar whenever you need it. If you ask me they&#39;re asking way too much of you but I&#39;ll be sure to do whatever I can to help you meet their expectations!&lt;&lt;/caspar&gt;&gt;
    &lt;&lt;mention assassination&gt;&gt;
        &lt;&lt;wymerus&gt;&gt;?Title, I want to take a moment to reassure you that the castle is now completely secure. There is no way another assassin can get close to you. At least not on my watch.&lt;&lt;/wymerus&gt;&gt;
        &lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;
            &lt;&lt;wymerus&gt;&gt;I also heard from ?Morgana how to fought off the attacker and actually managed to disarm him! I am proud to see you mastering your training already, let&#39;s hope you don&#39;t have to use it again soon.&lt;&lt;/wymerus&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;player&gt;&gt;Thank you, ?Wymerus. I suppose it does really show the importance of your training.&lt;&lt;/player&gt;&gt;
    &lt;&lt;mention status&gt;&gt;
        &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
            &lt;&lt;caspar&gt;&gt;Did you change your hairstyle or something?&lt;&lt;/caspar&gt;&gt;
            You blush slightly. &lt;&lt;player&gt;&gt;No, Caspar. Why would you think that?&lt;&lt;/player&gt;&gt;
            &lt;&lt;caspar&gt;&gt;You just look... different. Something about your face, or maybe your voice? It&#39;s hard to say. But you seem different today.&lt;&lt;/caspar&gt;&gt;
            He seems to quickly let go his line of questioning though, as he continues back to the training.
        &lt;&lt;elseif face() is &#39;andro&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;fem&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;man&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
&lt;&lt;/acknowledgement&gt;&gt;</tw-passagedata><tw-passagedata pid="63" name="Caspar Night" tags="" position="350,850" size="100,100">&lt;&lt;if not hasTag(&#39;wymerus-peeped&#39;)&gt;&gt;
    While walking the dark courtyard, you swear you&#39;re hearing strange noises coming from the other side of the courtyard. You carefully sneak in that direction and you notice two figures beneath an archway. You&#39;re not quite sure but the soft sounds coming from them seem carnal in nature.?nl
    Once you focus on the sounds you come to a sudden realization... It actually sounds like it&#39;s two men making out in the dark here...
&lt;&lt;else&gt;&gt;
    You once again find &lt;&lt;name wymerus &#39;Lord&#39;&gt;&gt; in the dark together with his squire, ?Caspar. You can sneak closer to find a good spot and peep on them.
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &quot;Find a hiding spot closer to peep on them&quot; &#39;Caspar Peeping&#39; depravity small&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Quietly leave&quot; &#39;Bedtime&#39; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="64" name="Caspar Peeping" tags="spicy" position="475,850" size="100,100">&lt;&lt;addsin &#39;peeping&#39;&gt;&gt;
&lt;&lt;first&gt;&gt;
    &lt;&lt;addtag &#39;wymerus-peeped&#39;&gt;&gt;
    Once you manage to sneak a bit closer you make out the large figure of &lt;&lt;name wymerus &#39;Lord&#39;&gt;&gt;. He&#39;s leaning against a pillar and you can hear him let out soft, approving grunts. Only now do you recognise what the second figure is doing, they&#39;re kneeled in front of ?Wymerus, apparently providing a certain kind of stimulation to him, using their mouth. It only takes a small amount of moonlight reflected off the face of the one giving service for you to recognise the red, curly hair of ?Caspar, the squire of &lt;&lt;name wymerus &#39;Lord&#39;&gt;&gt;.?nl
    The soft wet sounds you heard earlier are definitely caused by the blowjob you see happening here.
    Another thing that draws your attention now is the surprisingly large size of ?Wymerus&#39;s cock. It&#39;s intriguing to see ?Caspar being able to take that thing so far in his mouth.
    &lt;&lt;if settings.vids&gt;&gt;
        &lt;&lt;video &quot;caspar/caspar_blowjob.webm&quot;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;img &quot;caspar/peeping_blowjob_{theme}.jpg&quot;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    While seeing this scene happening, you notice your own dick started to get hard.
    &lt;&lt;if settings.sph&gt;&gt;
        A thought enters your mind: your own member compares nothing to the size you see here, you&#39;re not even sure if you&#39;re half as big as ?Wymerus. You tell yourself that&#39;s because his is just massive, but secretly you know yours is definitely on the tiny side as well.
    &lt;&lt;/if&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;include &#39;Caspar Peeping 2&#39;&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;include &#39;Caspar Peeping 1&#39;&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;include &#39;Caspar Peeping 3&#39;&gt;&gt;
&lt;&lt;finally&gt;&gt;
    &lt;&lt;include `either(&#39;Caspar Peeping 1&#39;, &#39;Caspar Peeping 2&#39;, &#39;Caspar Peeping 3&#39;)`&gt;&gt;
&lt;&lt;/first&gt;&gt;

&lt;&lt;decision &quot;Let lust take over and masturbate in the dark&quot;&gt;&gt;
    &lt;&lt;addsin &#39;masturbation&#39;&gt;&gt;
    You take out your cock and start masturbating while looking at this exciting display of carnal sins. 
    &lt;&lt;if settings.vids&gt;&gt;
        &lt;&lt;if settings.sph&gt;&gt;
            &lt;&lt;video &#39;player/masturbate_sph.webm&#39;&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;video &#39;player/masturbate.webm&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    While fapping in the dark you imagine yourself as a part of their secret sexual acts. Whose place do you imagine taking in this fantasy??nl
    &lt;&lt;decision &quot;?Caspar&#39;s position&quot;&gt;&gt;
        You imagine yourself in ?Caspar&#39;s position, servicing ?Wymerus. You think about yourself prioritising his pleasure above all else. You even wonder if you could take his big cock and how you could be his little slut.?nl
        &lt;&lt;if settings.cum&gt;&gt;
            &lt;&lt;decision &quot;Cum in your hand and eat it&quot;&gt;&gt;
                &lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;
                &lt;&lt;if settings.vids&gt;&gt;
                    &lt;&lt;video &#39;player/swallow{2}.webm&#39;&gt;&gt;
                &lt;&lt;/if&gt;&gt;
                As you let your mind wander to thoughts of being rewarded with cum, like ?Caspar is right now, you immediately orgasm, you spurt a few streams of cum all over your hand. Your eyes filled with lust you immediately take it in your mouth and let it slide down your throat, imagining it as ?Wymerus&#39; cum.
                &lt;&lt;decisiongroup 1&gt;&gt;
                &lt;&lt;addstat depravity small&gt;&gt;
            &lt;&lt;/decision&gt;&gt;
            &lt;&lt;decision &quot;Climax on the floor&quot;&gt;&gt;
                As you let your mind wander to thoughts of being rewarded with cum, like ?Caspar is right now, you immediately orgasm, as your ?penis lets out streams of white cum on the cold dark stones of the courtyard.
                &lt;&lt;decisiongroup 1&gt;&gt;
            &lt;&lt;/decision&gt;&gt;
        &lt;&lt;else&gt;&gt;
            These thoughts very quickly bring you to orgasm, afterwards you quickly recover and clean yourself up.
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;decisiongroup 1&gt;&gt;
        &lt;&lt;addstat submissiveness small&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &quot;?Wymerus&#39; place&quot;&gt;&gt;
        You imagine yourself as ?Wymerus, dominating over ?Caspar. You run your hands through his soft curly hair while he services you. As you imagine yourself making him your bitch, you reach your climax and cum on the cold courtyard stones, covered by darkness.
        &lt;&lt;decisiongroup 1&gt;&gt;
        &lt;&lt;addstat dominance medium&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decisiongroup 1&gt;&gt;
    &lt;&lt;addstat depravity small&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Having seen enough, you quietly sneak away&quot; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="65" name="Caspar Peeping 1" tags="spicy" position="600,850" size="100,100">You see ?Wymerus walking over to ?Caspar, who is kneeled on the floor. You can already see the massive bulge ?Wymerus is packing while he fumbles with his belt and unleases his big cock. You hear a smacking sound as it immediately hits ?Caspar in the face.
&lt;&lt;wymerus&gt;&gt;Clean my big sword for me, my squire. Why don&#39;t you use your mouth again?&lt;&lt;/wymerus&gt;&gt;
Without hesitation, ?Caspar takes his cock in his mouth and starts slobbering over his shaft. 
&lt;&lt;if settings.vids&gt;&gt;
    &lt;&lt;video &quot;caspar/caspar_blowjob.webm&quot;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;img &quot;caspar/peeping_blowjob_{theme}.jpg&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;
You notice ?Caspar takes out his own much smaller penis and starts masturbating while servicing the lord. It only takes a little bit before ?Wymerus smacks his hand away.
&lt;&lt;wymerus&gt;&gt;Did I tell you you could masturbate, boy? I know you are a little slut and nothing turns you on as much as this but you should really be focusing on cleaning my shaft. We&#39;ve had quite a long training session today and I&#39;m all sweaty now.&lt;&lt;/wymerus&gt;&gt;
?Caspar takes the cock out of his mouth and slowly massages it while looking up at his master.
&lt;&lt;caspar&gt;&gt;I&#39;m sorry my lord, I&#39;m your squire and of course I will do anything to make sure your sword is nice and clean. I will e- mhaarfhm&lt;&lt;/caspar&gt;&gt;
?Caspar is quickly interrupted as ?Wymerus suddenly grabs his head with both hands and violently shoves his cock down his throat.
&lt;&lt;wymerus&gt;&gt;Enough excuses, this is taking too long, I will take matters in my own hand.&lt;&lt;/wymerus&gt;&gt;
You watch as ?Wymerus pushes him against the stone wall and starts face-fucking the young squire. They&#39;ve completely forgotten to mind their secrecy as you can hear the lord loudly grunting while pumping his massive cock in and out of his mouth.?nl
?Caspar is completely relaxed as he lets his mouth be used by his knight. After a little while you notice the situation he finds himself in is turning him on too much and he starts masturbating his little dick again while being face-fucked.?nl
Shortly later the lord starts pumping faster and faster, suddenly he shoves his cock in all the way to the base, holding it there. His balls slapping against ?Caspar&#39;s chin as ?Wymerus loudly grunts and presumably deposits all his cum down his squire&#39;s throat. While his mouth and throat is completely filled with cock and cum, you can somehow still hear ?Caspar moan as he faps his dick faster and faster before cumming on the courtyard floor, letting out a few white strands of cum from his penis.?nl
?Wymerus leaves his cock in his squire&#39;s mouth for a bit before taking it out. A thick strain of cum connects the cock-head to ?Caspar&#39;s lips. The young squire makes sure there is no cum left on his master&#39;s tool before giving the cock a wet kiss and looking up to him to say thanks for letting him provide service.?nl</tw-passagedata><tw-passagedata pid="66" name="Caspar Peeping 2" tags="spicy" position="725,850" size="100,100">You see ?Wymerus and ?Caspar standing next to a training dummy. You can hear a slight argument happening as they&#39;re discussing training exercises.
&lt;&lt;caspar&gt;&gt;My lord, you know I would do anything for you but what I simply mean to say is- aah&lt;&lt;/caspar&gt;&gt;
The squire is interrupted as ?Wymerus suddenly grabs him, flips him around and bends him over.
&lt;&lt;wymerus&gt;&gt;Enough of this back-talk, let me remind you exactly who the squire is and who the knight is.&lt;&lt;/wymerus&gt;&gt;
?Caspar leans against the training dummy as ?Wymerus rips down his pants, revealing his bare ass. The squire moans as his master spits directly on his asshole and starts massaging it. With his other hand ?Wymerus unbuckles his belt and takes out his hardening cock.
&lt;&lt;caspar&gt;&gt;My lord, please, I meant no offense- Ah!&lt;&lt;/caspar&gt;&gt;
His pleading is interrupted by loud moaning as ?Wymerus aligned his massive cock with the entrance and pushed forward.
&lt;&lt;if settings.vids&gt;&gt;
    &lt;&lt;video &quot;caspar/caspar_doggy1.webm&quot;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;img &quot;caspar/peeping_doggy_{theme}.jpg&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;wymerus&gt;&gt;What was that, squire? Do you want me to stop?&lt;&lt;/wymerus&gt;&gt;
He slowly pushes in and out of ?Caspar&#39;s asshole while the squire moans louder and louder.
&lt;&lt;caspar&gt;&gt; No, my lord, please use me- Ah! Please fuck me hard, my lord!&lt;&lt;/caspar&gt;&gt;
&lt;&lt;if settings.vids&gt;&gt;
    &lt;&lt;video &quot;caspar/caspar_doggy2.webm&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;
The young squire is bent over, holding on to the training dummy with both hands while he is being railed from behind. The lord grunts louder and louder and you can definitely make out the sound of his balls slapping. After this goes on for a while, ?Wymerus speeds up and suddenly pulls out of his squire&#39;s ass. ?Caspar immediately turns around and kneels down, he opens his mouth and sticks out his tongue.
&lt;&lt;wymerus&gt;&gt;Show me how good of a squire you are.&lt;&lt;/wymerus&gt;&gt;
The lord is masturbating his cock, aimed at ?Caspar&#39;s face when you see thick ropes of cum flying all over the squire&#39;s face and onto his tongue. His curly red hair is covered with white cum and he holds one of his eyes closed. ?Caspar shows his master what landed in his mouth, proceeds to swallow it and now shows his empty mouth with a proud smile.
&lt;&lt;if settings.vids&gt;&gt;
    &lt;&lt;video &quot;caspar/caspar_facial.webm&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;wymerus&gt;&gt; Well done, boy. Now, you&#39;re not allowed to clean that up yet, I enjoy seeing you walk around while I marked my territory all over your face.&lt;&lt;/wymerus&gt;&gt;</tw-passagedata><tw-passagedata pid="67" name="Caspar Peeping 3" tags="spicy" position="850,850" size="100,100">From your peeping place you can see ?Caspar standing over ?Wymerus. It looks like the lord is drunk, lying in the center of the training field.
&lt;&lt;caspar&gt;&gt;My lord, please get up. I think you&#39;ve had too much to drink during practise today, let&#39;s get you to bed.&lt;&lt;/caspar&gt;&gt;
He tries pulling on the lord&#39;s much bigger body, to no avail.
&lt;&lt;wymerus&gt;&gt;No, my boy.. *hic* I am horny, squire... *hic* Take care of my shaft again while I lie here...&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;caspar&gt;&gt;What? Right in the middle of the courtyard? What if someone walks by? We should at least hide somewhere in the corner like normally, my lord.&lt;&lt;/caspar&gt;&gt;
&lt;&lt;wymerus&gt;&gt;I am too tired and horny to move right now. *hic* I have given you a command, I expect you to follow it.&lt;&lt;/wymerus&gt;&gt;
You hear ?Caspar sigh loudly as he starts unbuckling his master&#39;s belt. He kneels down beside him and starts massaging his soft cock.
&lt;&lt;if settings.sph&gt;&gt;
    Even limp, ?Wymerus&#39; cock is much bigger than your ?dick.
&lt;&lt;/if&gt;&gt;
?Caspar looks slightly annoyed to be masturbating his lord in the middle of the courtyard, he keeps looking around to make sure nobody spots them, luckily he hasn&#39;t been able to see you hiding. After a little while you can clearly see that ?Wymerus&#39; member is standing full mast, you can see the outline of the large cock in the dark.
&lt;&lt;caspar&gt;&gt;I&#39;m still surprised how little the alcohol affects your stamina, my lord&lt;&lt;/caspar&gt;&gt;
He says before lowering his head on his lord&#39;s cock and giving him a sloppy blowjob. You see ?Caspar&#39;s head going up and down really quickly, it looks like he wants to get this over with as soon as possible.
&lt;&lt;if settings.vids&gt;&gt;
    &lt;&lt;video &quot;caspar/caspar_lying_blowjob.webm&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;wymerus&gt;&gt;Good, my squire. *hic* But I need more. *hic* Sit on top of it.&lt;&lt;/wymerus&gt;&gt;
You hear a suction plop sound as ?Caspar takes his master&#39;s cock out of his mouth.
&lt;&lt;caspar&gt;&gt;My lord, have you gone mad? Someone will definitely spot us if I start riding you right now.&lt;&lt;/caspar&gt;&gt;
&lt;&lt;wymerus&gt;&gt;I have *hic* given you an order, squire. *hic* Get on top of me.&lt;&lt;/wymerus&gt;&gt;
You again hear a loud sigh coming from ?Caspar. &lt;&lt;name wymerus &#39;Lord&#39;&gt;&gt; is giving commands while not moving a single inch, it looks like he expects his squire to do all the work here. His loyal squire switches position, he takes off his pants and moves on top of him, squatting right above his large member.?nl
He slowly moves down, having properly wetted the massive cock he takes his lord inside of him and immediately let out a loud moan before putting his hand over his mouth, seeming surprised by his reaction.?nl
He tries to stay quiet while finding the right pace but still, every time he moves down he lets out a soft moan. Seeing him work for his master like this so out in the open is really thrilling.
&lt;&lt;if settings.vids&gt;&gt;
    &lt;&lt;video &quot;caspar/caspar_riding.webm&quot;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;img &quot;caspar/peeping_riding_{theme}.jpg&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;
Finally, ?Wymerus shows some real signs of life as he suddenly grabs his squire by his sides and starts pumping him up and down even faster.?nl
They both start moaning very loudly as the squire lowers himself, completely enveloping his master&#39;s cock as they both cum at the same time.
You suddenly hear a guard open the door to the courtyard.
&lt;&lt;guard&gt;&gt;Is anyone there? Show yourself!&lt;&lt;/guard&gt;&gt;
Both the lord and the squire scramble to their feet and run out of here, right before the guard could spot them.</tw-passagedata><tw-passagedata pid="68" name="Caspar Courtyard Reading" tags="" position="975,850" size="100,100">The night sky is clear and the moon shines brightly on the softly bubbling fountain in the center of the courtyard. It seems that ?Caspar and ?Wymerus aren&#39;t up to their normal activities this evening, so you step forward toward the fountain, breathing in the fresh air.

&lt;&lt;caspar&gt;&gt;?Title, is that you?&lt;&lt;/caspar&gt;&gt;

You almost jump out of your skin as ?Caspar&#39;s voice echoes across the courtyard. You look over and see him on the cobblestones, reclined against a training dummy with a book in his hands. You clear your throat, trying to act natural.

&lt;&lt;player&gt;&gt;Ah, ?Caspar, what are you doing out here at this time of night?&lt;&lt;/player&gt;&gt;

?Caspar quickly puts the book down, but not before you just make out that the cover seems to depict a drawing of an exaggeratedly muscled knight and squire in an embrace. Is he reading a romance novel?

&lt;&lt;caspar&gt;&gt;Just enjoying the night air! ?Wymerus was feeling ill and couldn&#39;t make it to training this evening.&lt;&lt;/caspar&gt;&gt;

You think back on ?Caspar and ?Wymerus&#39;s &quot;trainings&quot; and have to quickly conceal a smirk.

&lt;&lt;player&gt;&gt;A bit odd to train in dark corners so late at night, don&#39;t you think?&lt;&lt;/player&gt;&gt;

Even in the low light, you could swear that ?Caspar is blushing. When he speaks, he stumbles over his words.

&lt;&lt;caspar&gt;&gt;Well, y-you know, ?Wymerus is very diligent with my lessons! I hate to go a night without him- I mean, without training...&lt;&lt;/caspar&gt;&gt;

He seems to be quite flustered. Perhaps you should just walk away and leave him to his reading... On the other hand, perhaps you could stand in for ?Wymerus for an evening...

&lt;&lt;decision &#39;Offer to help him &quot;train&quot;&#39; &#39;Caspar Sex 1&#39; depravity small&gt;&gt;
    &lt;&lt;disableif hasEquipmentTag(&#39;chastity&#39;)&gt;&gt;
        You are locked in chastity.
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Escape the conversation&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Yes, quite the shame... Well, I must be going. Enjoy your book, ?Caspar!&lt;&lt;/player&gt;&gt;
    &lt;&lt;caspar&gt;&gt;Oh, th-thank you, ?title. Good evening!&lt;&lt;/caspar&gt;&gt;
    &lt;&lt;decision &#39;Leave him to his book&#39; &#39;Courtyard&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="69" name="Caspar Sex 1" tags="spicy" position="1100,850" size="100,100">You take a step closer to him. 

&lt;&lt;player&gt;&gt;You know, ?Wymerus isn&#39;t the only one in the castle who is educated in swordplay. I could help you...train, if that&#39;s what you&#39;re looking for.&lt;&lt;/player&gt;&gt;

?Caspar sets the book aside and looks up at you with suddenly hungry expression.

&lt;&lt;caspar&gt;&gt;It would be an honor to train with you, ?title. If you would allow me, I would love to clean your sword...&lt;&lt;/caspar&gt;&gt;

You take another step closer to him, your ?dick hardening in your trousers. 

&lt;&lt;player&gt;&gt;Yes, I think that would be quite appreciated, squire.&lt;&lt;/player&gt;&gt;

&lt;&lt;caspar&gt;&gt;Perhaps we should move to a darker corner, then.&lt;&lt;/caspar&gt;&gt;

You follow him to an archway bathed in darkness. The moment you arrive there, he drops to his knees and frees your erection, stuffing it hungrily into his mouth with sloppy abandon. Surprised by his sudden eagerness, you moan inadvertently and throw your head back against the cold stone in pleasure.

&lt;&lt;player&gt;&gt;Excellent work, squire...&lt;&lt;/player&gt;&gt;

&lt;&lt;if settings.sph&gt;&gt;
    He pulls your ?dick out of his mouth with a wet sound and grins up at you.
    &lt;&lt;caspar&gt;&gt;I&#39;m used to polishing blades much bigger than your dagger, ?title.&lt;&lt;/caspar&gt;&gt;
    Before you can process his impertinence, the pleasure overwhelms you as he stuffs you back in his mouth again.
&lt;&lt;/if&gt;&gt;

He works your ?dick expertly up and down with great enthusiasm. After some minutes he removes you from his mouth, &lt;&lt;if settings.sph&gt;&gt;still massaging you with his fingers&lt;&lt;else&gt;&gt;still massaging you with his hand&lt;&lt;/if&gt;&gt; as he looks up at you.

&lt;&lt;caspar&gt;&gt;Please, show me how you use your sword. I need a demonstration.&lt;&lt;/caspar&gt;&gt;

You watch as he turns around and drops his trousers, revealing his bare ass to you. You feel your ?dick twitch as you approach his ass and rub the head around his hole, eliciting a low moan from him. 

&lt;&lt;player&gt;&gt;That&#39;s a good squire...&lt;&lt;/player&gt;&gt;

&lt;&lt;if settings.sph&gt;&gt;
    You push your ?dick against him and it slides in with little effort. You&#39;ve barely made it through the entrance when you run out of length, but you do your best to begin thrusting.
&lt;&lt;else&gt;&gt;
    You push your ?dick against him and after a moment it pops through the ring of muscle. He gasps in pleasure as you enter him and slowly begin to thrust inside of his ass.
&lt;&lt;/if&gt;&gt;

&lt;&lt;caspar&gt;&gt;Ah, fuck, ?Wymerus...&lt;&lt;/caspar&gt;&gt;

You almost stop thrusting as he says this. Is he imagining that you&#39;re ?Wymerus? This feels rather awkward now, but you&#39;re already balls-deep. You might as well continue.

&lt;&lt;player&gt;&gt;Um, yes, take my cock, my squire...&lt;&lt;/player&gt;&gt;

You quickly forget what he said as you refocus on the pleasure building inside of you. You grab his ass and pull him back onto your dick, making him moan loudly.

&lt;&lt;caspar&gt;&gt;Please, fuck me harder, my lord!&lt;&lt;/caspar&gt;&gt;

You ram your ?dick in and and out of him until finally you reach your peak. You pull out of him and spurt your cum across the pale skin of his back. A moment later he moans as he cums onto the cold courtyard stones, the white liquid glimmering in a stray shaft of moonlight. Languidly, he turns around and plants a surprisingly tender kiss on your ?dick.  

&lt;&lt;caspar&gt;&gt;I have much to learn, my lord. Perhaps you could return another night to continue my training.&lt;&lt;/caspar&gt;&gt;

You stuff your ?dick back into your trousers and, suddenly remembering that you&#39;re out in the open, look around quickly. Luckily, no one seems to be nearby.

&lt;&lt;player&gt;&gt;U-um, perhaps, my squire...&lt;&lt;/player&gt;&gt;
Fucking ?Caspar in this public courtyard where anyone could have walked in on you was exciting, but you feel awkward about him pretending you are ?Wymerus. You make up some excuse to leave, and as you exit the courtyard you see him settle back against the training dummy with a satisfied sigh, book in hand.

&lt;&lt;decision &#39;Retreat inside the castle&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="70" name="Caspar Reading Free Use" tags="" position="1225,850" size="100,100">You step silently into the nearly-empty courtyard. In the moonlight you can make out the form of ?Caspar, relaxed and reading a book against the side of a training dummy as the fountain bubbles away softly. You make your way through the cool night air to approach him.

&lt;&lt;player&gt;&gt;You seem to enjoy reading here.&lt;&lt;/player&gt;&gt;

?Caspar looks up at you over his book. You can clearly see on the cover an illustration of a knight and squire in an erotic embrace. 

&lt;&lt;caspar&gt;&gt;I enjoy the quiet, ?title.&lt;&lt;/caspar&gt;&gt;

You notice how he has made no effort to hide the cover of his book. As your eyes trail down, you can see even in the darkness that there seems to be a lump in his pants.

&lt;&lt;player&gt;&gt;It is peaceful, but would you not prefer to read somewhere more...private?&lt;&lt;/player&gt;&gt;

?Caspar meets your eyes briefly before looking back at the page of his book.

&lt;&lt;caspar&gt;&gt;Not at all, ?title. Sometimes I enjoy reading in public, where anyone could...make use of me.&lt;&lt;/caspar&gt;&gt;

Though his words are not directly flirtatious, he is clearly implying something. You find yourself slightly confused as he appears to have returned to reading and is now ignoring you.

&lt;&lt;player&gt;&gt;So, what if I should have use of you?&lt;&lt;/player&gt;&gt;

Without looking up from his book, you see a smile briefly flash across ?Caspar&#39;s face. 

&lt;&lt;caspar&gt;&gt;I am at your service, ?title. Feel free to use me how you wish.&lt;&lt;/caspar&gt;&gt;

You stare at him and swear that you see the lump in his pants grow even more prominent. Is he turned on by the idea of being used freely for sex? Perhaps you should give in to pleasure and take him up on this offer. On the other hand, this interaction has been a bit strange; perhaps you should leave him to his reading...

&lt;&lt;decision &#39;Take him up on his offer&#39; &#39;Caspar Sex 2&#39; depravity medium&gt;&gt;
    &lt;&lt;disableif hasEquipmentTag(&#39;chastity&#39;)&gt;&gt;
    You are locked in chastity.
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Bid him farewell and return to the castle&#39; &#39;Courtyard&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="71" name="Caspar Sex 2" tags="spicy" position="100,975" size="100,100">&lt;&lt;player&gt;&gt;Well, squire, I do in fact have use of you this evening.&lt;&lt;/player&gt;&gt;

&lt;&lt;caspar&gt;&gt;As you wish, ?title.&lt;&lt;/caspar&gt;&gt;

His tone sounds bored, yet he responds immediately to your words. You watch as he turns over, continuing to read his book by the moonlight as he presents his ass to you.?nl

Even though he is pretending to ignore you, there is something oddly attractive about his immediate receptiveness. Your ?dick twitches in your trousers as you approach him, kneeling on the stones of the courtyard. Slowly, you pull his clothes down, revealing his bare buttocks and hardening erection. 

&lt;&lt;caspar&gt;&gt;Do with me what you will, ?title. I will continue my book.&lt;&lt;/caspar&gt;&gt;

He flips through his book as you free your own erection and approach his entrance. You spit on your finger and insert it into him, massaging his hole until it relaxes enough to add another. 

&lt;&lt;player&gt;&gt;Still, um, enjoying your book?&lt;&lt;/player&gt;&gt;

&lt;&lt;caspar&gt;&gt;Yes, I&#39;ve just come to a very exciting part in the story.&lt;&lt;/caspar&gt;&gt;

You spit on your hand and massage your own ?dick, then line yourself up to his entrance. He continues flipping through pages, apparently completely uninterested in what you&#39;re doing.?nl

You find you&#39;re quite turned on by this whole situation, and despite how he&#39;s acting, ?Caspar is clearly very relaxed and ready to take you in. Hungrily, you stuff your ?dick inside of him. 

&lt;&lt;player&gt;&gt;Mmph, fuck...&lt;&lt;/player&gt;&gt;

You begin to drive your ?dick into him, your tempo quickly becoming fast and aggressive as he accepts you easily. The sound of muffled slapping fills your ears as you grasp his hips, &lt;&lt;if settings.sph&gt;&gt;thrusting your ?dick as far as you can&lt;&lt;else&gt;&gt;plunging deeper and deeper into him.&lt;&lt;/if&gt;&gt;

&lt;&lt;caspar&gt;&gt;Mm...&lt;&lt;/caspar&gt;&gt;

?Caspar&#39;s moan is barely audible, but you still catch it in between your thrusts. You see him grasping the book, no longer turning the pages. He seems to only be pretending to read at this point.

&lt;&lt;player&gt;&gt;That&#39;s a good squire, letting me use you whenever I want...&lt;&lt;/player&gt;&gt;

You fuck him hard until finally the pleasure is too much to take and you find yourself spilling inside of him, filling his ass with hot spurts of cum.

&lt;&lt;caspar&gt;&gt;Fuck...&lt;&lt;/caspar&gt;&gt;

?Caspar&#39;s voice comes at a barely audible whisper. Though he still keeps one hand on his book, the other travels downward to wrap around his dick as he quickly brings himself to orgasm. You watch his semen spurt onto the cold stones, shining white in the moonlight.?nl

Slowly, you slide out of his ass and pull your trousers back up. He does the same and quietly continues reading as though nothing has happened.

&lt;&lt;player&gt;&gt;Diligent, um, work, squire.&lt;&lt;/player&gt;&gt;

He flips to another page, not looking at you.

&lt;&lt;caspar&gt;&gt;Of course, ?title, I am happy to be of service.&lt;&lt;/caspar&gt;&gt;

This whole interaction was a bit strange, but you suppose you can&#39;t fault the man for having a specific sexual interest. It&#39;s not as if you didn&#39;t enjoy yourself. You stand up and bid him farewell.

&lt;&lt;decision &#39;Return to the castle&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="72" name="Caspar Free Use Repeating" tags="" position="225,975" size="100,100">You find ?Caspar leaning against a shadowed wall in the courtyard, reading yet another book with a titillating cover. He looks over the book as you approach.

&lt;&lt;caspar&gt;&gt;?Greeting, ?title. I am at your service, should you have use of me...&lt;&lt;/caspar&gt;&gt;

His tone sounds almost bored, but even in this dark corner you can make out a lump in his trousers. You could take advantage of his arousal right here in the shadows... Or perhaps you should not engage with this strange fantasy of his and leave him to his reading...

&lt;&lt;decision &#39;Use him for sexual gratification&#39; &#39;Caspar Sex 3&#39;&gt;&gt;
    &lt;&lt;disableif hasEquipmentTag(&#39;chastity&#39;)&gt;&gt;
    You are locked in chastity.
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Leave him to his reading&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;I was simply passing through. Enjoy your book.&lt;&lt;/player&gt;&gt;
    &lt;&lt;decision &#39;Leave&#39; &#39;Courtyard&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="73" name="Caspar Sex 3" tags="spicy" position="350,975" size="100,100">&lt;&lt;player&gt;&gt;I do, in fact.&lt;&lt;/player&gt;&gt;

&lt;&lt;caspar&gt;&gt;As you wish, ?title.&lt;&lt;/caspar&gt;&gt;

Without another word, he turns the face the wall, still reading his book. You undo his trousers and pull them down to pool around his ankles. Running a hand down the small of his back, you take a moment to appreciate his smooth, naked body.?nl

Quietly, he flips to another page.

&lt;&lt;player&gt;&gt;That&#39;s a good squire...&lt;&lt;/player&gt;&gt;

You spit on your hand to lubricate your ?dick and push against his entrance, which yields after a moment of resistance. You slide inside of him, the warm constriction around your ?dick filling you with a rush of pleasure.

&lt;&lt;player&gt;&gt;Fuck...&lt;&lt;/player&gt;&gt;

You pause for a moment inside of him and look around quickly to make sure no one is watching. When you&#39;re sure the coast is clear, you grasp onto his waist for leverage and begin to thrust.

&lt;&lt;caspar&gt;&gt;Mm...&lt;&lt;/caspar&gt;&gt;

?Caspar emits a barely audible moan as you move inside him, &lt;&lt;if settings.sph&gt;&gt;your ?dick barely making it past his entrance&lt;&lt;else&gt;&gt;your ?dick pushing deeper and deeper into his body&lt;&lt;/if&gt;&gt;. To your amazement, ?Caspar still seems to be turning pages as he reads his book.

&lt;&lt;player&gt;&gt;How is the, um, book going?&lt;&lt;/player&gt;&gt;

?Caspar&#39;s whole body is moving now with the rhythm of your thrusts.

&lt;&lt;first&gt;&gt;
    &lt;&lt;caspar&gt;&gt;Mm...well, in this chapter, Sir Johnson and his squire Willy are having to share a bed due to a shortage of rooms in an inn...&lt;&lt;/caspar&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;caspar&gt;&gt;Mm...well, in this chapter, squire Willy caught a cold, so Sir Johnson is having to warm him with his own body heat...&lt;&lt;/caspar&gt;&gt;
&lt;&lt;finally&gt;&gt;
    &lt;&lt;caspar&gt;&gt;Mm...well, in this chapter, Sir Johnson was mysteriously poisoned, and his squire Willy just learned that the only way to cure him is to suck the poison out...&lt;&lt;/caspar&gt;&gt;
&lt;&lt;/first&gt;&gt;

You continue driving your ?dick into ?Caspar, momentarily distracted as you imagine the scene.

&lt;&lt;first&gt;&gt;
    &lt;&lt;player&gt;&gt;Is there- fuck, that&#39;s good- a plot to this book, or is it just a collection of erotic scenes?&lt;&lt;/player&gt;&gt;

    ?Caspar braces himself against the wall with one hand, holding himself steady so that your thrusts reach further into him.

    &lt;&lt;caspar&gt;&gt;Why not both, ?title?&lt;&lt;/caspar&gt;&gt;
&lt;&lt;finally&gt;&gt;
    &lt;&lt;player&gt;&gt;Sounds like- fuck, that&#39;s good- a fun chapter...&lt;&lt;/player&gt;&gt;
    
    ?Caspar braces himself against the wall with one hand, holding himself steady so that your thrusts reach further into him.

    &lt;&lt;caspar&gt;&gt;It is indeed, ?title...&lt;&lt;/caspar&gt;&gt;
&lt;&lt;/first&gt;&gt;

Needing to thrust even deeper, you begin to pull ?Caspar&#39;s entire body onto your ?dick. He gives up on bracing himself on the wall and instead begins to massage his own cock, still holding the book up with his other hand.?nl

You moan loudly as you approach your orgasm, and a moment later your vision whites out as you release inside of him, your ?dick pulsing in waves of euphoria. He cries out a few seconds later as he finds his own peak.?nl

Suddenly exhausted, you withdraw from his ass and tuck yourself back into your trousers. He follows suit, still engrossed in his book.

&lt;&lt;player&gt;&gt;That was...um, great. Perhaps I&#39;ll catch you reading here another time?&lt;&lt;/player&gt;&gt;

He flips to another page nonchalantly.

&lt;&lt;caspar&gt;&gt;Yes, I expect you will. ?Greeting, ?title.&lt;&lt;/caspar&gt;&gt;

&lt;&lt;decision &#39;Bid him farewell&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="74" name="Devota" tags="" position="475,975" size="100,100"></tw-passagedata><tw-passagedata pid="75" name="Devota Acknowledgement" tags="" position="600,975" size="100,100">&lt;&lt;acknowledgement Devota&gt;&gt;
    &lt;&lt;mention assassination&gt;&gt;
    &lt;&lt;mention status&gt;&gt;
        &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;andro&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;fem&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;man&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
&lt;&lt;/acknowledgement&gt;&gt;</tw-passagedata><tw-passagedata pid="76" name="Confessions Intro" tags="" position="725,975" size="100,100">The confession booth is a small yet comforting space. As you enter, the familiar sense of anticipation settles over you. The voice of &lt;&lt;fullname devota&gt;&gt;, now softened, greets you from the other side of the screen.

&lt;&lt;devota&gt;&gt;Bless you, ?titleD. What has been burdening you lately?&lt;&lt;/devota&gt;&gt;

You take a deep breath, searching for the right words. Confession is always a moment of vulnerability, a time to reflect and seek guidance.

&lt;&lt;player&gt;&gt;?Mother, I find myself struggling with doubt and the weight of my responsibilities. How can I be sure I&#39;m making the right choices for my people?&lt;&lt;/player&gt;&gt;

A gentle silence follows, and when ?Devota finally speaks, her voice carries comfort.

&lt;&lt;devota&gt;&gt;You cannot be sure, ?titleD. But doubt is not a bad sign; quite the opposite, in fact. It is the sign of a thoughtful heart, and that is the most important quality of any leader.&lt;&lt;/devota&gt;&gt;

Her words offer you solace, a reminder that your feelings are legitimate, and that uncertainty is not a weakness.

&lt;&lt;devota&gt;&gt;All any of can do is our best. Remember that there is guidance to be found in faith, and the support of those around you.&lt;&lt;/devota&gt;&gt;

You finish your session in the confession booth, feeling bolstered by her words.

&lt;&lt;decision &#39;Leave the booth&#39; &#39;Leave Church&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="77" name="Confessions" tags="" position="850,975" size="100,100">&lt;&lt;setlocation &quot;Confession booth&quot;&gt;&gt;
&lt;&lt;set $confessions = 0&gt;&gt;
You kneel in the dimly lit confession booth, the air heavy with the scent of old wood and incense. Silence envelopes you. Through the lattice, you feel more than see the presence of &lt;&lt;fullname devota&gt;&gt; as she speaks to you.

&lt;&lt;devota&gt;&gt;Tell me, ?titleD, what has been weighing on your soul?&lt;&lt;/devota&gt;&gt;

/* LIST EVENTS */

&lt;&lt;decision &#39;Talk about the assassination attempt&#39; &#39;Confession Assassin&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;

&lt;&lt;if hasTag(&#39;crossdressing&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Talk about wearing feminine clothes&#39; &#39;Confession First Crossdress&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
    &lt;&lt;decision &#39;Talk about the femininity potion&#39; &#39;Confession First Femininity Potion&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if isInChastity()&gt;&gt;
    &lt;&lt;decision &#39;Talk about your chastity cage&#39; &#39;Confession Chastity&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;I have nothing to discuss, ?Mother&#39; &#39;No confessions&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="78" name="No confessions" tags="" position="975,975" size="100,100">/* IF PLAYER HAS EVENTS TO DISCUSS BUT DOES NOT CHOOSE TO DISCUSS THEM */
    /* &lt;&lt;player&gt;&gt;?Mother, I have nothing I wish to discuss at the moment.&lt;&lt;/player&gt;&gt;

    You know this is not entirely true, but you also know that you aren&#39;t required to tell ?Devota everything that&#39;s on your mind. There is a pause as she weighs your words, and you wonder whether she can tell that you&#39;re holding back.

    &lt;&lt;devota&gt;&gt;I understand, ?titleD. Please, go in peace. I am always here if you wish to talk.&lt;&lt;/devota&gt;&gt; */

/* IF PLAYER HAS NOTHING TO DISCUSS */
    &lt;&lt;player&gt;&gt;I must admit, ?Mother, that I can think of nothing. I&#39;ve reflected on my actions, my thoughts, and my duties, and found nothing weighing on me at this moment.&lt;&lt;/player&gt;&gt;

    Your words hang in the air, an unusual statement for one held to such high expectations. When ?Devota speaks, you swear you can almost hear a smile in her words. 

    &lt;&lt;devota&gt;&gt;I am pleased to hear it, ?titleD. Go in peace, and know that I am always here to talk should that change.&lt;&lt;/devota&gt;&gt;

&lt;&lt;decision &#39;Leave the booth&#39; &#39;Leave Church&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="79" name="Confessions continue" tags="" position="1100,975" size="100,100">&lt;&lt;devota&gt;&gt;Is there anything else you wish to discuss, my child?&lt;&lt;/devota&gt;&gt;

/* LIST EVENTS */
&lt;&lt;decision &#39;Talk about the assassination attempt&#39; &#39;Confession Assassin&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;

&lt;&lt;if hasTag(&#39;crossdressing&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Talk about wearing feminine clothes&#39; &#39;Confession First Crossdress&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
    &lt;&lt;decision &#39;Talk about ?Morgana\&#39;s feminity potion&#39; &#39;Confession First Femininity Potion&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if isInChastity()&gt;&gt;
    &lt;&lt;decision &#39;Talk about your chastity cage&#39; &#39;Confession Chastity&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Nothing more&#39; &#39;End confessions&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="80" name="Confession First Crossdress" tags="" position="1225,975" size="100,100">You take a deep breath, finding the courage to speak what has been on your mind.

&lt;&lt;player&gt;&gt;?Mother, I had a strange experience recently. For reasons I cannot currently share, I wore the clothes of a lady instead of my own.&lt;&lt;/player&gt;&gt;

There is a brief pause as ?Devota takes in this information. When she speaks, you hear no judgment in her voice, only curiosity.

&lt;&lt;devota&gt;&gt;I see, my child. How did it make you feel, to wear those clothes?&lt;&lt;/devota&gt;&gt;

Now it is your turn to pause. When you finally speak, your voice trembles slightly.

&lt;&lt;player&gt;&gt;I am conflicted, ?Mother. I felt embarrassed at the time, but I wonder if there was some small part of me that...well, enjoyed the experience...&lt;&lt;/player&gt;&gt;

&lt;&lt;devota&gt;&gt;If there was, my child, that is nothing to be ashamed of. We all learn more about ourselves as we move through life. Try to approach this part of yourself with curiosity, rather than fear.&lt;&lt;/devota&gt;&gt;

You let ?Devota&#39;s words sink into you. Perhaps she is right. Perhaps this feeling is not something you need to run from.

&lt;&lt;player&gt;&gt;Thank you for your wisdom, ?Mother.&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="81" name="Confession Assassin" tags="" position="100,1100" size="100,100">&lt;&lt;player&gt;&gt;As you know, ?Mother, I recently escaped an attempt on my life. It was terrifying, to be carefree one moment and &lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;fighting for my life the next&lt;&lt;else&gt;&gt;running for my life the next&lt;&lt;/if&gt;&gt;.&lt;&lt;/player&gt;&gt;

&lt;&lt;devota&gt;&gt;I am so sorry this happened to you, my child. Facing one&#39;s mortality is always difficult, but especially so through violence. How are you feeling?&lt;&lt;/devota&gt;&gt;

Images of the scene replay in your mind: the man running at you, the glint of a knife, &lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;fighting him in the dirt&lt;&lt;else&gt;&gt;hitting the ground as he tackled you from behind&lt;&lt;/if&gt;&gt;. A lump rises in your throat.

&lt;&lt;player&gt;&gt;I admit I am still feeling shaken. I could have died. I could still die, should there be another attack.&lt;&lt;/player&gt;&gt;

&lt;&lt;devota&gt;&gt;It is completely natural to feel scared in such circumstances. Fear helps keep us alive, and I am glad that you are still here.&lt;&lt;/devota&gt;&gt;

Though you cannot be sure if the danger has passed, you feel a sense of release at her words. It is comforting to realize that fear is not only normal, but also a helpful response to what happened to you.

&lt;&lt;player&gt;&gt;Thank you, ?Mother, for your kind words.&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="82" name="Confession First Femininity Potion" tags="" position="225,1100" size="100,100">You take a deep breath, surprised by how fast your heart is beating right now.

&lt;&lt;player&gt;&gt;I drank a magical potion which had a rather...transformative effect on my appearance. My body feels, um, a bit different now.&lt;&lt;/player&gt;&gt;

There is a moment of quiet as ?Devota takes in your words. 

&lt;&lt;devota&gt;&gt;I see, my child. How do you feel, emotionally, about these changes?&lt;&lt;/devota&gt;&gt;

It feels as though something is lodged in your throat, preventing you from being able to speak. You want to be completely honest in this quiet space, but even here, the truth is difficult to voice.

&lt;&lt;player&gt;&gt;Uh, well, part of me feels as though the changes are correct. The way I should be. But a bigger part of me wants to ignore that feeling.&lt;&lt;/player&gt;&gt;

&lt;&lt;devota&gt;&gt;Changes are often scary, but that does not necessarily mean they are bad. Sometimes it can help to voice what you are afraid of specifically.&lt;&lt;/devota&gt;&gt;

You find yourself at a loss. Of course you&#39;re afraid; you&#39;re a prince, and there are expectations for how a prince looks and acts. Even if you wanted to be something different, that is simply not an option.

&lt;&lt;player&gt;&gt;I-I&#39;m sorry, I&#39;m not sure I&#39;m ready to discuss this further...&lt;&lt;/player&gt;&gt;

&lt;&lt;devota&gt;&gt;Of course, my child. It is clear to me that you are struggling with something important. I am here to talk when you are ready.&lt;&lt;/devota&gt;&gt;

&lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="83" name="Confession Chastity" tags="" position="350,1100" size="100,100">You very awkwardly mention to her how you&#39;re in this weird situation where ?Kathryn has put your ?penis in a chastity cage. ?Devota listens attentively as you very timidly talk about the experience.?nl

You wait in silence as ?Devota processes your statement. Even though you&#39;ve told her personal things before, admitting this feels quite embarrassing.

&lt;&lt;devota&gt;&gt;I see, ?titleD. Though, you&#39;re talking about this like ?LadyKathryn has forced you to do this thing. I assume if you were to tell her to release your manhood she would do it right away, correct?&lt;&lt;/devota&gt;&gt;

You clear your throat, feeling your cheeks burning in the darkness.

&lt;&lt;player&gt;&gt;Uhm- yes. She would let me out of the cage if I asked her...&lt;&lt;/player&gt;&gt;

&lt;&lt;devota&gt;&gt;Interesting. So from that I gather that you are enjoying this experience. I suppose it must be thrilling to give someone else total control over your most intimate desires. Tell me, are you wearing the chastity cage right now?&lt;&lt;/devota&gt;&gt;

She&#39;s right... You are enjoying the experience... You awkwardly tell her the truth.

&lt;&lt;player&gt;&gt;Y- yes...&lt;&lt;/player&gt;&gt;

Through the wooden lattice you can see a smile appear on her face.

&lt;&lt;devota&gt;&gt;Thank you for sharing that with me. It is good that you feel comfortable with that, it is important for me to get a good sense of what you are dealing with, ?titleD.&lt;&lt;/devota&gt;&gt;

&lt;&lt;devota&gt;&gt;In fact, in order for me to understand the situation better, I&#39;d like to go one step further. Perhaps you would be willing to show me what it looks like? Only if you are comfortable, of course, ?titleD.&lt;&lt;/devota&gt;&gt;

You look at her but can&#39;t see her eyes in the darkness of this confession booth. Flabbergasted by her question, you think on what to do.

&lt;&lt;decision &#39;Show her your cage&#39; submissiveness small&gt;&gt;
    ?nl
    Even though it definitely feels a little strange, you decide to go along with her. You feel like you can trust her after all.
    &lt;&lt;player&gt;&gt;Uh- Okay, give me a second...&lt;&lt;/player&gt;&gt;
    You stand up in the narrow confines of the booth and work to move your garments out of the way. Once you&#39;re ready, you lower your underwear in front of the small opening between the two compartments.
    &lt;&lt;img &#39;chastity/chastity_check.gif&#39; &#39;ridge-border&#39; &#39;15em&#39;&gt;&gt;
    A thin light pierces through the wood and shines perfectly on your chastity cage as you present it to ?Devota.
    &lt;&lt;devota&gt;&gt;Very good, ?titleD. I understand your interest in this now, it looks very cute. Thank you for showing me.&lt;&lt;/devota&gt;&gt;
    You quickly put your caged ?penis away and fix your clothes before you sit down again. You feel weirdly comfortable being able to share this with ?Devota.

    &lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Decline her request&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;I&#39;m sorry, ?Devota. I don&#39;t think I feel quite comfortable sharing something like that now.&lt;&lt;/player&gt;&gt;
    &lt;&lt;devota&gt;&gt;Naturally, ?titleD, there&#39;s nothing to be sorry for. Only share what your heart is willing to bare.&lt;&lt;/devota&gt;&gt;

    &lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="84" name="End confessions" tags="" position="475,1100" size="100,100">/* &lt;&lt;= $confessions&gt;&gt; */
&lt;&lt;devota&gt;&gt;Thank you for sharing your thoughts with me, ?titleD. Everyone experiences their own difficulties in life, but the simple act of sharing them with another can help to lessen the burden.&lt;&lt;/devota&gt;&gt;

She softly recites a prayer, a wish for your health and wellbeing. A sense of release washes over you and you feel better prepared to take on the rest of your day. 

&lt;&lt;decision &#39;Take your leave&#39; &#39;Leave Church&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;

/* &lt;&lt;devota&gt;&gt;Thank you for your confessions, ?titleD. Everyone sins, but I hope you reflect on your mistakes and avoid such behaviour in the future. Now, let me absolve of these sins so that your mind can rest at ease. It is important that you take this moment to reflect on your actions, ?titleD.&lt;&lt;/devota&gt;&gt;

You hear the priest softly speak some words in latin, he seems focused on absolving you. You know that this process requires you to actually focus on what you have done wrong, but do you really want ?devota to absolve you of this? Something in you thinks it might be more fun to let you keep these depraved thoughts live on in your mind.?nl

&lt;&lt;decision &#39;Focus on your sins and let him absolve you of them&#39;&gt;&gt;
    &lt;&lt;changestat virtue confessions&gt;&gt;

    While meditating under ?devota&#39;s soft chants you feel a certain serenity wash over you. It almost feels like a holy power actually reaches down and cleanses you a little.
    &lt;&lt;devota&gt;&gt;There. That should lift the weight off your shoulders, ?titleD. I hope you let these confessions bolster you and help you walk the right path. Go in peace, ?titleD.&lt;&lt;/devota&gt;&gt;

    &lt;&lt;decision &#39;Thank him and take your leave&#39; &#39;Leave Church&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decisionicon virtue&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Ignore his call for contemplation and forgo absolution&#39;&gt;&gt;
    &lt;&lt;changestat depravity confessions&gt;&gt;

    You sit quietly in this booth, waiting for ?devota to finish his latin rambling. You have no intention of having him absolve you so easily. Instead of letting go of this sinful past, you start thinking about how great it felt to do those kinds of things this week... Perhaps you will not heed his advice to avoid it at all, perhaps you will come back and confess even more depravity.?nl
    &lt;&lt;if getStat(&#39;depravity&#39;) &lt; 60&gt;&gt;
        It takes a little while for ?devota to finish his ritual. Once he&#39;s done, you feel him looking at you as he addresses you.
        &lt;&lt;devota&gt;&gt;?TitleD, I fear that you have gone down a sinful path. Do not let your heart be corrupted. Please remember that you can confess any sins to me and I will be here to listen and guide you. I hope you reflect on these concerning developments and avoid such sinful behaviour in the future. Go in peace.&lt;&lt;/devota&gt;&gt;
        
        &lt;&lt;decision &#39;Take your leave&#39; &#39;Leave Church&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        ?devota stops halfway through a sentence as you feel him look at you. It seems like he has noticed that you have no intention of letting him absolve you.
        &lt;&lt;devota&gt;&gt;?TitleD, it seems you are unable to stray from your sinful path with the guidance I have given you so far... Perhaps it&#39;s better that we guide you in other ways...&lt;&lt;/devota&gt;&gt;

        In the darkness of the confession booth, you can vaguely see &lt;&lt;fullname devota&gt;&gt; stand up from his seat.

        &lt;&lt;devota&gt;&gt;Perhaps it is best if we satiate these sinful desires in this confession booth, so that you are not tempted outside of here anymore...&lt;&lt;/devota&gt;&gt;

        You hear a small hatch being opened in the lattice separating you two in the confession booth. You look up from your kneeling position and notice something strange pointing in your direction. You see some light shine down on &lt;&lt;fullname devota&gt;&gt;&#39;s hardening member, sticking out through an opened hole in the wooden lattice.

        &lt;&lt;devota&gt;&gt;?TitleD, in order to receive my blessing, you will satisfy your sinful nature and perform carnal acts right here in this confession booth. This way you will not be tempted in the future.&lt;&lt;/devota&gt;&gt;

        You see his cock twitch in the dimly lit confession booth, waiting for your response.
        &lt;&lt;decision &#39;Blow him (unfinished)&#39; &#39;Leave Church&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;decisionicon depravity&gt;&gt;
&lt;&lt;/decision&gt;&gt; */</tw-passagedata><tw-passagedata pid="85" name="Confession Become Princess" tags="" position="600,1100" size="100,100">&lt;&lt;player&gt;&gt;I suppose I would like to discuss the news &lt;&lt;/player&gt;&gt;

&lt;&lt;devota&gt;&gt;&lt;&lt;/devota&gt;&gt;</tw-passagedata><tw-passagedata pid="86" name="Confession Morgana visits bed?" tags="" position="725,1100" size="100,100">@TODO</tw-passagedata><tw-passagedata pid="87" name="Confession Go to Forest with Morgana" tags="" position="850,1100" size="100,100">@TODO</tw-passagedata><tw-passagedata pid="88" name="Confession Work at Tavern" tags="" position="975,1100" size="100,100">@TODO</tw-passagedata><tw-passagedata pid="89" name="Confession Sex Education Eve" tags="" position="1100,1100" size="100,100">@TODO</tw-passagedata><tw-passagedata pid="90" name="Confession Work at Brothel" tags="" position="1225,1100" size="100,100">@TODO</tw-passagedata><tw-passagedata pid="91" name="Confession Work at Gloryhole" tags="" position="100,1225" size="100,100">@TODO - blow Devota?</tw-passagedata><tw-passagedata pid="92" name="Confession Romancing Rosa" tags="" position="225,1225" size="100,100">@TODO</tw-passagedata><tw-passagedata pid="93" name="Confession Romancing Orson" tags="" position="350,1225" size="100,100">@TODO</tw-passagedata><tw-passagedata pid="94" name="Confession Romancing Eve" tags="" position="475,1225" size="100,100">@TODO</tw-passagedata><tw-passagedata pid="95" name="Confession Chastity Excursion with Kathryn" tags="" position="600,1225" size="100,100">@TODO

/* :: Sin magic
&lt;&lt;set $confessions += 1&gt;&gt;
&lt;&lt;player&gt;&gt;Father, I have allowed myself to be swayed by influences that I know should have been resisted. I permitted ?Morgana to use her magic on me as she promised it is helpful to me.&lt;&lt;/player&gt;&gt;

Your voice is steady, but the weight of your admission hangs heavily in the air. The use of magic, especially for personal gain or to alter one&#39;s natural state, is often frowned upon by the church, seen as meddling in realms beyond human reach.

&lt;&lt;devota&gt;&gt;I already feared the new royal sorceress would have a bad influence on you, ?titleD. I am aware more royalty tend to use this kind of magic for personal improvement but I must warn you that it can be a dangerous endeavor as well. The church does not advice any magic that influences the human body. Please be wary next time ?Morgana promises to help you.&lt;&lt;/devota&gt;&gt;

&lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="96" name="Sin peeping" tags="" position="725,1225" size="100,100">&lt;&lt;set $confessions += 1&gt;&gt;
&lt;&lt;player&gt;&gt;Father, I come before you with a heavy heart. I confess to an act of impropriety; I have peeped on others as they committed acts that are carnal in nature.&lt;&lt;/player&gt;&gt;

Your voice trembles slightly with the admission, the words a tangible release of the guilt you&#39;ve carried. 

&lt;&lt;devota&gt;&gt;The violation of another&#39;s privacy is a serious matter, reflecting a lapse in judgment and respect for the dignity of others. I understand it might be tempting to observe other&#39;s acts of carnal pleasures but it is vital that you pay no mind to such temptations in the future.&lt;&lt;/devota&gt;&gt;

&lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="97" name="Sin masturbation" tags="" position="850,1225" size="100,100">&lt;&lt;set $confessions += 1&gt;&gt;

&lt;&lt;player&gt;&gt;Father, I must confess... I have given in to carnal desires, to acts of self-pleasure. I know it goes against the virtues I am meant to uphold. I seek forgiveness for these actions.&lt;&lt;/player&gt;&gt;

Your voice is barely above a whisper, the admission bringing with it a flush of shame. Such matters are rarely spoken of, especially within the sacred confines of the church.

There&#39;s a brief pause before &lt;&lt;fullname devota&gt;&gt; responds, his tone imbued with a certain amount of judgment.

&lt;&lt;devota&gt;&gt;?TitleD, you are but a victim to the frailties of our human nature. It is important that you avoid such temptations in the future. Strive for purity of heart and mind. Seek to channel your energies into more noble pursuits instead.&lt;&lt;/devota&gt;&gt;

&lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="98" name="Sin wearing-panties" tags="" position="975,1225" size="100,100">&lt;&lt;set $confessions += 1&gt;&gt;

&lt;&lt;player&gt;&gt;Father, I must confess... I have had some strange desires lately. For some reason, I felt pleasure as I decided to wear undergarnments that actually belong to a lady.&lt;&lt;/player&gt;&gt;

Your voice is barely above a whisper, the admission bringing with it a flush of shame. You are quite sure nobody has ever shared a confession like this.

There&#39;s quite a long pause, you&#39;re not sure if &lt;&lt;fullname devota&gt;&gt; is thinking of a response or just completely caught of guard by this confession. 

&lt;&lt;devota&gt;&gt;I see... This is unorthodox indeed... I must confess I have trouble finding the reasoning behind the sinful nature of this... I can offer no guidance, I must think on this...&lt;&lt;/devota&gt;&gt;

His staggered response betrays a strange feeling he is having, is he... excited? It&#39;s difficult to say.

&lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="99" name="Sin blowjob" tags="" position="1100,1225" size="100,100">&lt;&lt;set $confessions += 1&gt;&gt;

&lt;&lt;player&gt;&gt;Father, this is difficult for me to confess but I&#39;ve done deeds very carnal in nature. You see, father... I have had oral sex recently...&lt;&lt;/player&gt;&gt;

You speak softly and ashamedly. It&#39;s suddenly much more quiet before ?Devota starts asking you to clarify.

&lt;&lt;devota&gt;&gt;?TitleD, this is a grave matter indeed... May I ask, who is the one that has performed oral sex on you?&lt;&lt;/devota&gt;&gt;

His question makes things all the more awkward but you decide to just be honest and give the full confession.

&lt;&lt;player&gt;&gt;Well uh- Nobody... It is was me that performed the oral sex, father... On a man...&lt;&lt;/player&gt;&gt;

There is a long, haunting pause before the priest responds to you.

&lt;&lt;devota&gt;&gt;I see... That is... unexpected. I must contemplate on this... Perhaps it is best we continue with your confessions for now... Please know you must avoid such temptations in the future.&lt;&lt;/devota&gt;&gt;

&lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="100" name="Sin cum-eating" tags="" position="1225,1225" size="100,100">&lt;&lt;set $confessions += 1&gt;&gt;

&lt;&lt;player&gt;&gt;Father, this confession might sound strange... After indulging myself in carnal pleasures to completion I somehow found myself... uhm...&lt;&lt;/player&gt;&gt;

You stammer slightly as you suddenly very much regret confessing this sin to &lt;&lt;fullname devota&gt;&gt;.

&lt;&lt;devota&gt;&gt;It&#39;s all right, ?titleD. Tell me your sins, whatever you share is only between you, me, and God.&lt;&lt;/devota&gt;&gt;

You very reluctantly continue your story.

&lt;&lt;player&gt;&gt;Well... I sort of followed my urge to, uhm, &lt;em&gt;swallow&lt;/em&gt; the seed, as it were...&lt;&lt;/player&gt;&gt;

&lt;&lt;devota&gt;&gt;I see... This is rather unorthodox... And does this sort of thing give pleasure to you?&lt;&lt;/devota&gt;&gt;

You get quite embarrassed by the sudden question. It almost sounds like he is actually intrigued.

&lt;&lt;player&gt;&gt;Uhm- well- yes, I suppose it does...&lt;&lt;/player&gt;&gt;

&lt;&lt;devota&gt;&gt;Very well. It does indeed sound sinful in nature but I must confess I am unsure there&#39;s precedent for this kind of sin... I suppose you are not hurting anyone in doing this kind of thing but I doubt drinking climax is a virtuous thing. It&#39;s good that you share this with me, ?titleD.&lt;&lt;/devota&gt;&gt;

&lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="101" name="Sin fingered" tags="" position="100,1350" size="100,100">&lt;&lt;set $confessions += 1&gt;&gt;

&lt;&lt;player&gt;&gt;Father, I must confess... I have once again given in to carnal desires... I have found pleasure through not only the usual methods but by stimulating other areas as well.&lt;&lt;/player&gt;&gt;

He thinks for a moment before he asks you an inquisitive question.

&lt;&lt;devota&gt;&gt;Other areas?&lt;&lt;/devota&gt;&gt;

&lt;&lt;player&gt;&gt;Uhm- well, through stimulation of my anus...&lt;&lt;/player&gt;&gt;

The confession hangs heavy in the air.

&lt;&lt;devota&gt;&gt;?TitleD, this is quite worrisome... Carnal pleasures should only be achieved through the tool that God has given you. It is important that you avoid such temptations in the future.&lt;&lt;/devota&gt;&gt;

&lt;&lt;decision &#39;Continue confessions&#39; &#39;Confessions continue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt; */</tw-passagedata><tw-passagedata pid="102" name="Topic Regality" tags="" position="225,1350" size="100,100">/* 
- On your own (lessons)
- Alliance making (unlocks topic with Morgana)
- Assassination attempt
- Spy for Sybille (unlock tavern work topic)
- Spied on Andreas, confronted ?Morgana
- Becoming Princess? (princess lessons)
- Announce Princess
 */

 You mention how you would like to discuss issues related to your royal nature and the stresses you receive from it.</tw-passagedata><tw-passagedata pid="103" name="Topic Morgana" tags="" position="350,1350" size="100,100">/* 
- ointment
- visit at night (unlocks topic Erotic)
- Potion
- Kitchen maid disguise (Rosa spotted)
- Morgana Forest excursion (Run in with the bandit, meeting Hyssop)
- Morgana workshop potions (uses essence)
- Confronting Morgana about assassination attempt
 */

You mention to ?Devota that you would like to discuss recent events related to your royal sorceress, ?Morgana.

&lt;&lt;first&gt;&gt;
    &lt;&lt;devota&gt;&gt;Ah, I must say the new ?RoyalSorceress seems quite intriguing. What do you wish to discuss about her?&lt;&lt;/devota&gt;&gt;
&lt;&lt;finally&gt;&gt;
    &lt;&lt;devota&gt;&gt;Of course, your unique relationship with ?Morgana is a good topic to discuss.&lt;&lt;/devota&gt;&gt;
&lt;&lt;/first&gt;&gt;</tw-passagedata><tw-passagedata pid="104" name="Topic Erotic" tags="" position="475,1350" size="100,100">/* 
- Peeping on Caspar &amp; Wymerus
- Peeping on Sybille
- Peeping on Kathryn (unlocks Kathryn Topic)
- Bandit blowjob (when I first went in the woods with Morgana...)
 */</tw-passagedata><tw-passagedata pid="105" name="Topic Kathryn" tags="" position="600,1350" size="100,100">/* 
- Confrontation in morning
- Made to wear panties
- Made to wear chastity cage
- Wearing chastity cage for an entire week (maybe just in previous)
- Town excursion with Kathryn (caught by Caspar)
- Sex with Kathryn? (sph)
 */</tw-passagedata><tw-passagedata pid="106" name="Topic Romance" tags="" position="725,1350" size="100,100">/* 
- Talk about crushes and dating in general? (talk about needing to have royal marriage but still dating anyways)
- Date 1 with Rosa
- Date 2 with Rosa
- Date 3 with Rosa
- Date 1 with Orson
- Date 2 with Orson
- Date 1 with Eve
 */</tw-passagedata><tw-passagedata pid="107" name="Topic Tavern Work" tags="" position="850,1350" size="100,100">/*
- Spy for Sybille, intro to tavern (eve and velma)
- Work as kitchen maid in public
- Short reflection on tavern work? Go to Velma, Sex education
- Tavern is a Brothel
- Work at Brothel
 */</tw-passagedata><tw-passagedata pid="108" name="Eve" tags="" position="975,1350" size="100,100">&lt;&lt;if hasTag(&#39;sexwork&#39;) and getTime() === &#39;night&#39;&gt;&gt;
    &lt;&lt;if hasQuest(&#39;brothel-intro&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Talk to ?Eve about working at the brothel&#39; &#39;Brothel Eve Intro&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;decision &#39;Work at the brothel&#39; &#39;Brothel Work&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if hasQuest(&#39;eve-give-vibrator&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Present ?Eve with your gift&#39; &#39;Eve Give Dildo&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if hasQuest(&#39;eve-date-1&#39;) and getTime() === &#39;morning&#39;&gt;&gt;
    &lt;&lt;decision &#39;Start your date with ?Eve&#39; &#39;Eve Date 1 Start&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="109" name="Eve Sex Education Intro" tags="" position="1100,1350" size="100,100">&lt;&lt;setlocation &#39;Corridor&#39;&gt;&gt;
You don&#39;t see ?Eve in the main room of the tavern, but you&#39;ve often seen her disappear into the section of the tavern with lodgings. In fact, you realize you&#39;re not sure you&#39;ve ever seen ?Eve leave the tavern before. Does she live here? You decide to step through to the backside of the corridor and enter a long, dimly-lit corridor. You wander down the hall until you come across a door marked with her name.?nl

You knock lightly. After a few moments ?Eve opens the door dressed in an elegant pink silk robe. The shape of her body is evident through the robe, and you try not to stare at the outline of her breasts as she greets you with a smile.

&lt;&lt;eve&gt;&gt;Oh, hello, ?newname! To what do I owe the pleasure?&lt;&lt;/eve&gt;&gt;

You find yourself suddenly lost for words standing in front of this gorgeous woman. She looks to you encouragingly.

&lt;&lt;player&gt;&gt;U-um, well, ?Velma said that it was time for me to receive the additional training.&lt;&lt;/player&gt;&gt;

?Eve&#39;s smile grows even brighter.

&lt;&lt;eve&gt;&gt;Well, then, you have come to the right place! Please, come on in.&lt;&lt;/eve&gt;&gt;

&lt;&lt;decision &#39;Step into her room&#39; &#39;Eve Sex Education Intro 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="110" name="Eve Sex Education Intro 2" tags="" position="1225,1350" size="100,100">&lt;&lt;setlocation &#39;Eve\&#39;s Room&#39;&gt;&gt;

She stands aside and you walk in, staring at the incredible finery in this room. ?Eve&#39;s quarters are somehow even more elaborately decorated than any room you&#39;ve seen in the palace. Fine silks line the walls, vases of fresh flowers fill the room with a sweet scent, and precious jewelry drapes across a dressing table by the window. Where did she get the money for all this?

&lt;&lt;player&gt;&gt;W-wow, your room is really nice...&lt;&lt;/player&gt;&gt;

?Eve reclines on an elaborate sofa in the center of the room and pats the space next to her, inviting you to sit down.

&lt;&lt;eve&gt;&gt;I appreciate you saying that. I&#39;ve worked hard to make this a beautiful, comfortable space.&lt;&lt;/eve&gt;&gt;

You sit down next to her, suddenly feeling very awkward. What is this additional training that ?Velma mentioned? ?Eve&#39;s room is lovely, but you&#39;re not sure what she could teach you in her personal bedroom.

&lt;&lt;eve&gt;&gt;Now, darling, I must ask you a question. Have you had many experiences in this realm? Is this all perhaps quite new to you?&lt;&lt;/eve&gt;&gt;

You suppose that ?Eve doesn&#39;t know your full history, but you had thought it was fairly obvious that you&#39;re new to being a ?barworker. 

&lt;&lt;player&gt;&gt;Yes, uh, I think that would be accurate.&lt;&lt;/player&gt;&gt;

?Eve smiles again and gently pats your hand.

&lt;&lt;eve&gt;&gt;Well, then, I&#39;ll be sure to take it slow.&lt;&lt;/eve&gt;&gt;

She sits up and pours two glasses of wine from a carafe. She hands you a glass, taking a sip of her own. 

&lt;&lt;eve&gt;&gt;Some clients, especially those who are new to the experience, feel most comfortable with a gradual build up. I start with conversation, a bit of wine, and light physical contact to ease in. A pat on the hand, a touch on the arm, a gentle caress of the face...&lt;&lt;/eve&gt;&gt;

As she says this, she runs her fingers softly along the side of your face. Your mind starts to race. Clients? Physical contact to ease in? What is this training that ?Velma has sent you to?

&lt;&lt;eve&gt;&gt;When the time feels right, I escalate. Sometimes just a visual escalation is best, but often a client is ready to jump into something more active.&lt;&lt;/eve&gt;&gt;

As though it&#39;s the most natural thing in the world, she lets her robe slip from her shoulders, revealing her breasts to you. &lt;&lt;if hasTag(&#39;eve-waterfall&#39;)&gt;&gt;Below, you see her bulge through the thin fabric of her robe.&lt;&lt;else&gt;&gt;Your eyes trail down, and through the thin robe you see what looks like...a bulge at her crotch? You realize with shock that it seems as though ?Eve has not a vulva, but a penis.&lt;&lt;/if&gt;&gt;?nl

She smiles softly and runs a hand through your hair.

&lt;&lt;eve&gt;&gt;If the client responds well, this is a good time for a more sensual touch.&lt;&lt;/eve&gt;&gt;

She leans in as if to kiss you, and suddenly everything makes sense. You don&#39;t know how it took you this long to realize it, but this part of the tavern must be a brothel, and ?Eve a sex worker. You freeze in a moment of panic. Having sex with ?Eve could be an amazing experience, but on the other hand, you weren&#39;t at all prepared for this... You could just ask her to stop...

&lt;&lt;decision &#39;Let ?Eve give you the full training&#39; &#39;Eve Sex Education Physical&#39; depravity medium&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Ask ?Eve to skip the demonstration&#39; &#39;Eve Sex Education Verbal&#39; virtue medium&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="111" name="Eve Sex Education Physical" tags="" position="100,1475" size="100,100">You&#39;re already feeling aroused just looking at ?Eve&#39;s body, and if she&#39;s leaning in to kiss you, you&#39;re certainly not going to stop her. Her lips meet yours and she kisses you softly, gently, noticing and responding to every movement you make with ease.?nl

You&#39;ve soon forgotten the entire premise of this interaction, and you become focused only on kissing ?Eve. Your kisses become deeper, and she starts to run her hands lightly along your body, passing over your hardening ?dick. ?Eve pulls away to look at you.

&lt;&lt;eve&gt;&gt;What sounds better today, ?newname? Would you prefer to be bottom or top?&lt;&lt;/eve&gt;&gt;

The question sends a jolt through you. It feels strange to be asked this question so directly, but ?Eve looks completely unphased. Since &lt;&lt;if hasTag(&#39;eve-waterfall&#39;)&gt;&gt;you know she&lt;&lt;else&gt;&gt;she apparently&lt;&lt;/if&gt;&gt; has a penis, you suppose she could just as easily take either role...

&lt;&lt;decision &#39;Choose to top&#39; &#39;Eve Sex Education Physical Top&#39;&gt;&gt;
    &lt;&lt;disableif isInChastity()&gt;&gt;
        You are locked in chastity.
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Choose to bottom&#39; &#39;Eve Sex Education Physical Bottom&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="112" name="Eve Sex Education Physical Top" tags="spicy" position="225,1475" size="100,100">&lt;&lt;player&gt;&gt;I would, uh, like to be the top...&lt;&lt;/player&gt;&gt;

?Eve gives you a bright smile and stands, letting the robe fall from her shoulders and onto the floor. &lt;&lt;if hasTag(&#39;eve-waterfall&#39;)&gt;&gt;You see she&#39;s already hard&lt;&lt;if settings.sph&gt;&gt;, and certainly much bigger than you&lt;&lt;/if&gt;&gt;. &lt;&lt;else&gt;&gt;Sure enough, you see not a vulva but a penis, already standing at attention. &lt;&lt;if settings.sph&gt;&gt;You realize that even this beautiful woman has a larger cock than you.&lt;&lt;/if&gt;&gt;&lt;&lt;/if&gt;&gt;?nl

She leads you by the hand to her large bed and begins pulling off your clothes. You never realized being undressed could be so sensual, but somehow her every movement is dripping with raw sexuality. &lt;&lt;if settings.sph&gt;&gt;She seems completely unphased when your tiny dick is revealed, though you&#39;re sure it must be one of the smallest penises she&#39;s ever seen. You start to wonder whether you&#39;ll even be able to top her with such a small dick.&lt;&lt;/if&gt;&gt;

&lt;&lt;eve&gt;&gt;Now, we always use protection to keep everyone safe, but I like to make it fun.&lt;&lt;/eve&gt;&gt;

She produces a small blue potion bottle from a drawer and holds it up, showing it to you. 

&lt;&lt;player&gt;&gt;Oh, do I...drink it?&lt;&lt;/player&gt;&gt;

?Eve chuckles and pours some into her hand.

&lt;&lt;eve&gt;&gt;Not quite. It&#39;s topical!&lt;&lt;/eve&gt;&gt;

&lt;&lt;if settings.sph&gt;&gt;
    Using her fingers, she begins to rub it onto your ?dick. She strokes you expertly up and down, sending waves of pleasure through your body. You watch as the potion sinks into your skin and disappears. As soon as it does, ?Eve wraps her mouth around your ?dick and begins sucking you off. The pleasure of it catches you off-guard and you moan loudly.?nl
&lt;&lt;else&gt;&gt;
    She begins to rub it onto your ?dick. She strokes you expertly up and down, sending waves of pleasure through your body. You watch as the potion sinks into your skin and disappears. As soon as it does, ?Eve wraps her mouth around your ?dick and begins sucking you off. The pleasure of it catches you off-guard and you moan loudly.?nl
&lt;&lt;/if&gt;&gt;

?Eve pulls your ?dick out of her mouth with a wet sound and smiles at you.

&lt;&lt;eve&gt;&gt;A bonus effect of this potion is that it acts as long-lasting magical lubrication!&lt;&lt;/eve&gt;&gt;

She takes your hand and pulls you onto the bed, lowering her mouth onto you again as you recline on the comfortable sheets. She works your ?dick up and down enthusiastically, making eye contact with you as she does. Her mouth feels like a warm, wet embrace around your ?dick, in the best way possible.?nl

&lt;&lt;if settings.sph&gt;&gt;
    She pulls your ?dick out of her mouth again and looks at you with a sultry expression.

    &lt;&lt;eve&gt;&gt;Are you ready to be inside me, darling?&lt;&lt;/eve&gt;&gt;

    Your mind overcome by lust, you can only manage a nod. You watch as ?Eve turns around and gets down on all fours on the bed. She uses her hands to spread her ass cheeks, presenting her hole to you. Looks like she wants you to take her doggy-style.

    &lt;&lt;eve&gt;&gt;Don&#39;t be shy, ?newname! I&#39;m ready for you...&lt;&lt;/eve&gt;&gt;

    After a brief moment of hesitation, you approach her entrance, your ?dick feeling impossibly hard. 
&lt;&lt;else&gt;&gt;
    She pulls your ?dick out of her mouth again and looks at you with a sultry expression.

    &lt;&lt;eve&gt;&gt;Are you ready to be inside me, darling?&lt;&lt;/eve&gt;&gt;

    Your mind overcome by lust, you can only manage a nod. You watch as ?Eve reaches over to the bedside table for a bulbous, flared object. She rubs some of the potion on it before handing it to you, then stretches out on the bed and spreads her legs. 

    &lt;&lt;eve&gt;&gt;That will help prepare me for your cock, darling. Insert it gently for a few moments, then remove it and repeat a few more times.&lt;&lt;/eve&gt;&gt;

    After a brief moment of hesitation, you gently push the object into her hole. You watch with some fascination as the ring of muscle seems to tighten automatically, then relaxes. After several insertions, the muscle seems much looser.

    &lt;&lt;eve&gt;&gt;I&#39;m ready for you...&lt;&lt;/eve&gt;&gt;

    You abandon the bulbous object and approach her entrance, your ?dick feeling impossibly hard. 
&lt;&lt;/if&gt;&gt;

Slowly, you push the tip of your ?dick through her hole. It feels amazing as the circle of muscle squeezes the head tight, and you have to pause just to take in the sensation.

&lt;&lt;if settings.sph&gt;&gt;
    &lt;&lt;eve&gt;&gt;Ah~! Though it&#39;s always good to start with some fingering, I meant that I&#39;m actually ready for your &lt;em&gt;cock&lt;/em&gt; so you can stick that in me instead if you want!&lt;&lt;/eve&gt;&gt;
    You look down at your ?dick as you&#39;re penetrating her tight asshole and feel a deep sense of humiliation. 
    &lt;&lt;player&gt;&gt;Uhm- yes- It&#39;s already inside actually...&lt;&lt;/player&gt;&gt;
    She turns her head and looks back at you with an embarrassed look on her face.
    &lt;&lt;eve&gt;&gt;Oh! I&#39;m so sorry! My bad! I can definitely feel it! Keep fucking me with that nice cock!&lt;&lt;/eve&gt;&gt;
    You try to ignore the blunder, sex can be awkward at times so it&#39;s no biggie, but somehow there&#39;s something inside you that doesn&#39;t want to ignore it... Her genuinely mistaking your ?dick for your finger because it is so small is actually making you rock hard right now...
&lt;&lt;else&gt;&gt;
    Ever so slowly, you begin to push deeper and deeper, feeling ?Eve relax from the inside the further you go. Once you&#39;re completely inside her, her body squeezing your dick from every angle, you begin thrusting slowly. You watch as ?Eve moans in response to your movements. 
&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Oh, w-wow, ?Eve...&lt;&lt;/player&gt;&gt;

You continue thrusting into her. It takes some time before you realize the loud moaning you&#39;re hearing is not only coming from ?Eve, but also from your own mouth.

&lt;&lt;eve&gt;&gt;Oh, yes, fuck my little hole, ?newname!&lt;&lt;/eve&gt;&gt;

You watch ?Eve&#39;s body moving in pleasure as you move inside of her. The feeling is almost impossibly good, and you can feel yourself quickly building toward a climax. Part of you wants to slow down, but a stronger part of you can&#39;t stop shoving your ?dick into her.

&lt;&lt;player&gt;&gt;Fuck, that feels so good...&lt;&lt;/player&gt;&gt;

?Eve starts stroking her cock in time with your thrusts, her moans mixing with yours as you move together.

&lt;&lt;if settings.sph&gt;&gt;
    &lt;&lt;eve&gt;&gt;Ah! Fuck me deeper ?newname!&lt;&lt;/eve&gt;&gt;
    You look down and realize that you&#39;re already as far inside her as you can get and it&#39;s probably disappointing her a bit. You focus on thrusting as much as possible with your ?dick, but that doesn&#39;t help the fact that your ?dick is too short.
    &lt;&lt;player&gt;&gt;Ah, I- I&#39;m sorry, ?Eve... I&#39;m already as deep as I can... It feels amazing though...&lt;&lt;/player&gt;&gt;
    She moans louder as you thrust into her while she&#39;s stroking her much bigger cock. Between the two of you, she definitely should&#39;ve been the top...
    &lt;&lt;eve&gt;&gt;Ah- fuck- That&#39;s okay! We can&#39;t all have a big cock! Your small dick feel amazing too, you&#39;re doing great!&lt;&lt;/eve&gt;&gt;

    Hearing her call your dick small is enough to send you over the edge as you thrust not-so-deep inside of her and climax hard, shooting cum inside her ass. Hearing you orgasm, ?Eve increases her speed on her own cock and cums shortly after.?nl

&lt;&lt;else&gt;&gt;
    &lt;&lt;eve&gt;&gt;It feels so good having you inside me, ?newname...&lt;&lt;/eve&gt;&gt;

    You thrust as deep inside of her as you can and feel the end of your ?dick explode as your cum shoots inside of her. Seeing you orgasm, ?Eve increases her speed on her own cock and cums shortly after.?nl
&lt;&lt;/if&gt;&gt;

Suddenly exhausted, you collapse onto the bed next to her, breathing hard.

&lt;&lt;decision &#39;Catch your breath&#39; &#39;Eve Sex Education After&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="113" name="Eve Sex Education Physical Bottom" tags="spicy" position="350,1475" size="100,100">&lt;&lt;player&gt;&gt;Oh, I suppose I would like to be the, uh, bottom...&lt;&lt;/player&gt;&gt;

?Eve gives you a bright smile and stands, letting the robe fall from her shoulders and onto the floor. &lt;&lt;if hasTag(&#39;eve-waterfall&#39;)&gt;&gt;You see she&#39;s already hard&lt;&lt;if settings.sph&gt;&gt;, and certainly much bigger than you&lt;&lt;/if&gt;&gt;. &lt;&lt;else&gt;&gt;Sure enough, you see not a vulva but a penis, already standing at attention. &lt;&lt;if settings.sph&gt;&gt;You realize that even this beautiful woman has a larger cock than you.&lt;&lt;/if&gt;&gt;&lt;&lt;/if&gt;&gt;?nl

She leads you by the hand to her large bed and begins pulling off your clothes. You never realized being undressed could be so sensual, but somehow her every movement is dripping with raw sexuality. &lt;&lt;if settings.sph&gt;&gt;She seems completely unfazed when your tiny dick is revealed, though you&#39;re sure it must be one of the smallest penises she&#39;s ever seen.&lt;&lt;/if&gt;&gt;

&lt;&lt;if isInChastity()&gt;&gt;
    Seeing your chastity cage, she raises her eyebrows at you.
    &lt;&lt;eve&gt;&gt;I had no idea you wore a chastity cage, ?newname. What a fun surprise! You&#39;re so kinky!&lt;&lt;/eve&gt;&gt;
    The story feels too long to explain now, right before you&#39;re about to have sex, so you simply nod.
&lt;&lt;/if&gt;&gt;

You watch as ?Eve produces a small blue potion bottle from a drawer and holds it up, showing it to you. 

&lt;&lt;eve&gt;&gt;Now, we always use protection to keep everyone safe, but I like to make it fun.&lt;&lt;/eve&gt;&gt;

&lt;&lt;player&gt;&gt;Oh, do you...drink it?&lt;&lt;/player&gt;&gt;

?Eve chuckles and pours some into her hand.

&lt;&lt;eve&gt;&gt;Not quite. It&#39;s topical!&lt;&lt;/eve&gt;&gt;

You watch as she begins to rub the potion onto her cock. She strokes herself up and down sensually, looking as though she&#39;s thoroughly enjoying the process. After a few moments, the liquid sinks into her skin and disappears.

&lt;&lt;eve&gt;&gt;A bonus effect of this potion is that it acts as long-lasting magical lubrication!&lt;&lt;/eve&gt;&gt;

She takes your hand and pulls you onto the bed, leading you to recline comfortably on the sheets. 

&lt;&lt;eve&gt;&gt;Now, when topping a client it&#39;s important to ensure they&#39;re as relaxed as possible. You can approach that in many ways, but I have my favorites...&lt;&lt;/eve&gt;&gt;

&lt;&lt;if isInChastity()&gt;&gt;
    She runs her hands gently along your body, trailing closer and closer to your ass. She seems to be building your anticipation on purpose, and by the time she rubs a finger along your entrance, the touch is enough to send a shiver through your body. She pours more of the potion onto her fingers and gently massages your hole. You can feel the magical lubricating effect making her fingers glide across your skin.

    &lt;&lt;player&gt;&gt;Oh, that&#39;s good...&lt;&lt;/player&gt;&gt;

    Just as her fingers are starting to feel like a tease, she leans down and runs her tongue around your hole. The pleasure of it catches you off-guard and you moan loudly. ?Eve works your ass with her tongue enthusiastically, and soon you&#39;re feeling as though you want something more.?nl

    ?Eve looks up as smiles at you.
&lt;&lt;else&gt;&gt;
    She runs her hands gently along your body, trailing closer and closer to your ?dick. She seems to be building your anticipation on purpose, and by the time she wraps &lt;&lt;if settings.sph&gt;&gt;her fingers&lt;&lt;else&gt;&gt;her hand&lt;&lt;/if&gt;&gt; around your ?dick the touch is enough to send a wave of pleasure through your body. She strokes you up and down expertly, spitting on her hand between strokes.

    &lt;&lt;player&gt;&gt;Oh, that&#39;s good...&lt;&lt;/player&gt;&gt;

    Just as her &lt;&lt;if settings.sph&gt;&gt;fingers are&lt;&lt;else&gt;&gt;hand is&lt;&lt;/if&gt;&gt; starting to feel like a tease, she leans down and wraps her mouth around you. The pleasure of it catches you off-guard and you moan loudly. ?Eve works your ?dick up and down enthusiastically, making eye contact with you as she does. Her mouth feels like a warm, wet embrace around your ?dick, in the best way possible.?nl

    ?Eve pulls your ?dick out of her mouth with a wet sound and smiles at you.
&lt;&lt;/if&gt;&gt;

&lt;&lt;eve&gt;&gt;How are you feeling, darling? Are you ready to have something inside you?&lt;&lt;/eve&gt;&gt;

You feel pretty relaxed, but you can&#39;t help but glance at her large cock and wonder how it could possibly fit inside you. ?Eve seems to notice your hesitation, and she smiles gently.

&lt;&lt;eve&gt;&gt;Don&#39;t worry, we&#39;ll start with something more manageable.&lt;&lt;/eve&gt;&gt;

She reaches over to the bedside table for a bulbous, flared object. She rubs some of the potion on it and softly guides your legs open. 

&lt;&lt;eve&gt;&gt;This will help prepare you for my cock, darling. I&#39;ll insert it gently for a few moments, then remove it and repeat a few times. As I&#39;m going, try to breathe deeply and focus on relaxing your muscles as much as you can.&lt;&lt;/eve&gt;&gt;

You nod, and watch as ?Eve slowly begins to push the object against your hole. You feel a heavy pressure until the object pops through your ring of muscle and enters your ass. You hear a moan escape your lips from some combination of pleasure and pain.

&lt;&lt;eve&gt;&gt;How is that for you?&lt;&lt;/eve&gt;&gt;

She lets the object sit inside your ass for a moment then withdraws it again carefully. You stare at her, the sensation already quite overwhelming.

&lt;&lt;player&gt;&gt;Wow, that was- uh, well, really nice... It hurt a little, but I think I just need to relax more...&lt;&lt;/player&gt;&gt;

?Eve gives you a genuine smile.

&lt;&lt;eve&gt;&gt;That&#39;s great! Learning to relax is definitely a skill, but you&#39;ll see the muscle starts to stretch out with just a bit of help.&lt;&lt;/eve&gt;&gt;

She inserts the object inside you again, her movements still slow and careful. The second time feels more comfortable, and the third even more so. It&#39;s not long before you&#39;re feeling much more relaxed and in control of your body&#39;s reaction. 

&lt;&lt;eve&gt;&gt;What do you think? Are you ready for me?&lt;&lt;/eve&gt;&gt;

Your mind is overcome with lust, and all you can manage is a nod. You watch as ?Eve slowly approaches your entrance and pushes the tip of her cock against your hole. You feel that pressure again, then her dick moves through the circle of muscle and slides inside you.?nl

You gasp, and ?Eve pauses there, just the tip of her dick inside of you. You breathe deeply and focus on relaxing. As you do so, ?Eve gradually pushes deeper and deeper inside of you. It takes some time, but eventually she is fully buried inside your ass.

&lt;&lt;player&gt;&gt;Oh, w-wow, ?Eve...&lt;&lt;/player&gt;&gt;

She looks at you, her face full of pleasure. 

&lt;&lt;eve&gt;&gt;Fuck, ?newname, it feels so good to be inside you.&lt;&lt;/eve&gt;&gt;

Slowly, she starts to thrust her cock inside you. She begins gently at first, then increases her speed as your body relaxes even further. Soon she is properly fucking you, and you realize the loud moaning you&#39;re hearing is not only coming from ?Eve, but also from your own mouth.?nl

You never expected having your ass full of cock could feel this good, but every time ?Eve thrusts inside you, a wave of incredible pleasure ripples through your body. You close your eyes and focus on taking her into you, moving with her as she pushes repeatedly into your ass.

&lt;&lt;eve&gt;&gt;You&#39;re really a natural at this, ?newname...&lt;&lt;/eve&gt;&gt;

You can only moan in response as ?Eve continues fucking you&lt;&lt;if !isInChastity()&gt;&gt;, and you can feel yourself already building toward a climax&lt;&lt;/if&gt;&gt;. Part of you wants ?Eve to slow down and make this last longer, but a stronger part of you wants her to keep shoving her cock inside you as fast as she can.

&lt;&lt;player&gt;&gt;Fuck, that feels so good...&lt;&lt;/player&gt;&gt;

&lt;&lt;if isInChastity()&gt;&gt;
    Your ?dick is straining mightily against the chastity cage. You wish you could touch yourself, to increase the pleasure of this moment even more, but you can&#39;t. Luckily, ?Eve seems to be enjoying herself greatly. She continue thrusting inside of you as deep as she can, her moans mixing with yours as you move together. A thin strand of pre-cum escapes your ?dick and falls through the cage.

    &lt;&lt;eve&gt;&gt;Awh, look at all the pre-cum coming out of your caged ?dick... That&#39;s so hot...&lt;&lt;/eve&gt;&gt;

    You feel her push her cock deep into you one final time and watch as she orgasms with a cry, her cock pulsing inside you as her cum shoots into your ass.
&lt;&lt;else&gt;&gt;
    Without even thinking about it, you grab your ?dick and start to pleasure yourself as ?Eve continues thrusting inside of you. ?Eve seems to be on the same page. She&#39;s now thrusting as deep inside you as she can, her moans mixing with yours as you move together.

    &lt;&lt;eve&gt;&gt;I want to see you cum, ?newname...&lt;&lt;/eve&gt;&gt;

    Hearing her say this as she&#39;s buried inside your ass pushes you over the edge. You feel the end of your ?dick explode as your cum shoots into the air. ?Eve pushes her cock deep into you one final time and orgasms as well. You feel her pulse inside you as her cum shoots into your ass.?nl
&lt;&lt;/if&gt;&gt;

?Eve stays there for a moment, coming down from her orgasm, before slowly withdrawing her cock from your ass and collapsing next to you on the bed.

&lt;&lt;decision &#39;Catch your breath&#39; &#39;Eve Sex Education After&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="114" name="Eve Sex Education Verbal" tags="spicy" position="475,1475" size="100,100">You lean back slightly. ?Eve notices and immediately pulls back, respecting your body language.

&lt;&lt;player&gt;&gt;Ah- uh, would it be alright if we skipped the...um...physical demonstration?&lt;&lt;/player&gt;&gt;

&lt;&lt;eve&gt;&gt;Of course, ?newname! That&#39;s not a problem at all.&lt;&lt;/eve&gt;&gt;

Cheerfully, she pulls her robe back up and reclines comfortably on the sofa, taking a sip of her wine. 

&lt;&lt;eve&gt;&gt;This is actually a great example of how we always make sure to stop if a client isn&#39;t completely into the experience! They are paying to have a good time, after all. Now, if the client did want to keep going, here&#39;s what I what do next...&lt;&lt;/eve&gt;&gt;

She spends the next hour explaining her full process to you, including an incredible amount of detail about many ways to have sex. When she&#39;s finally done, she looks at you with a bright smile.

&lt;&lt;eve&gt;&gt;Well, there you have it, ?newname! You have finished the training. All you have to do is ask ?Velma if you&#39;d like to try working in the brothel yourself.&lt;&lt;/eve&gt;&gt;

You almost choke at this. You, a sex worker in a brothel? It&#39;s not something you ever imagined for yourself. Still, ?Eve seems to be quite happy in her work, and judging by her room she&#39;s clearly well-paid for it.

&lt;&lt;player&gt;&gt;Thank you, I will...uh, think about it.&lt;&lt;/player&gt;&gt;

You finally leave, walking out in a daze. That was a lot of very direct information about sex, and now you have this new possibility of working in the brothel yourself... Despite the strangeness of the experience, you feel as though you&#39;ve learned a great deal.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Return to ?Velma&#39; &#39;Velma After Sex Education&#39;&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="115" name="Eve Sex Education After" tags="" position="600,1475" size="100,100">&lt;&lt;increasetime 1&gt;&gt;

You lie there with ?Eve, both of you catching your breath. At some point ?Eve fetches your wine cups, and a board of cheeses and fruits appears, seemingly from nowhere. You recline together on her bed in open bathrobes, the conversation flowing more naturally than you would have expected after such an experience.?nl

?Eve pops a grape into her mouth and looks at you cheerfully. 

&lt;&lt;eve&gt;&gt;So, ?newname, how was that for you? &lt;&lt;/eve&gt;&gt;

You stare off into the distance for a moment, trying to put it into words.

&lt;&lt;player&gt;&gt;It was...amazing. I mean, I suppose you are, um, an expert, but I&#39;m not sure I even knew I could feel that good.&lt;&lt;/player&gt;&gt;

?Eve chuckles, looking delighted.

&lt;&lt;eve&gt;&gt;I&#39;m so happy to hear it. I know that these things can be overwhelming at times, but it did look like you were enjoying yourself...&lt;&lt;/eve&gt;&gt;

She winks at you and takes a sip of wine. There is a comfortable pause as you meet her eyes, and ?Eve looks at you with a broad smile on her face. 

&lt;&lt;eve&gt;&gt;So, since you had such a nice time, do you think you might want to try it again sometime?&lt;&lt;/eve&gt;&gt;

The question catches you off-guard. Does she mean in the sense of her work, as in you could hire her some time for more sex? Or could she possibly mean something more...personal? She is undoubtedly very good at sex, but could you be open for something more with ?Eve?

&lt;&lt;decision &#39;Subtly indicate your romantic interest&#39; &#39;Eve Sex Education Indicate interest&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Keep your relationship non-romantic&#39; &#39;Eve Sex Education Rejected&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="116" name="Eve Sex Education Indicate interest" tags="" position="725,1475" size="100,100">&lt;&lt;addtag &#39;eve-romance&#39;&gt;&gt;

You smile back at her, holding her gaze a long time.

&lt;&lt;player&gt;&gt;Yes, I certainly would... I meant it when I said I&#39;ve never, uh, felt that way before...&lt;&lt;/player&gt;&gt;

Her smile brightens and she reaches out a hand to rest over your hand. Even though you literally just had sex, suddenly this touch feels nearly as intimate.

&lt;&lt;eve&gt;&gt;In case it&#39;s not clear, I wouldn&#39;t charge you. That felt different for me, too. I would love to have sex with you again.&lt;&lt;/eve&gt;&gt;

Her total directness about sex almost makes you laugh. 

&lt;&lt;player&gt;&gt;Yes, I think I would like that.&lt;&lt;/player&gt;&gt;

With zero hesitation, she leans forward and kisses you. Even though you&#39;ve already kissed her today, it feels different now. You relax into the kiss, enjoying the feeling of having her close to you.?nl

After some time, she pulls away, still smiling at you.

&lt;&lt;eve&gt;&gt;You know, ?newname, now that you&#39;ve done the training, all you have to do is speak with ?Velma if working in the brothel is something you&#39;d like to try.&lt;&lt;/eve&gt;&gt;

You almost choke at this. You, a sex worker in a brothel? It&#39;s not something you ever imagined for yourself. Still, ?Eve seems to be quite happy in her work, and judging by her room she&#39;s clearly well-paid for it.

&lt;&lt;player&gt;&gt;Oh, yes, I will...uh, think about it.&lt;&lt;/player&gt;&gt;

You continue easily chatting and occasionally kissing until the wine, cheese, and fruit is all gone. Eventually you put your clothes back on and bid farewell to ?Eve. You kiss her a final time before you leave her room, still a bit dazed from the amazing sex, turning over the idea of working in the brothel in your mind.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Return to ?Velma&#39; &#39;Velma After Sex Education&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="117" name="Eve Sex Education Rejected" tags="" position="850,1475" size="100,100">You smile back at her.

&lt;&lt;player&gt;&gt;Of course, ?Eve, I would happily hire you in an instant. I&#39;m sure your fee is quite substantial, given how good you are.&lt;&lt;/player&gt;&gt;

You try to catch if ?Eve has any reaction to this, but her smile is as warm as ever.

&lt;&lt;eve&gt;&gt;You would be right about that, ?newname. You&#39;re lucky that the training is free!&lt;&lt;/eve&gt;&gt;

She laughs good-naturedly and takes another sip of her wine.

&lt;&lt;eve&gt;&gt;Speaking of which, since you&#39;ve had the training now, all you have to do is speak with ?Velma if working in the brothel is something you&#39;d like to try.&lt;&lt;/eve&gt;&gt;

You almost choke on the grape you&#39;re eating as she says this. You, a sex worker in a brothel? It&#39;s not something you ever imagined for yourself. Still, ?Eve seems to be quite happy in her work, and she&#39;s well paid for it.

&lt;&lt;player&gt;&gt;Thank you, I will...uh, think about it.&lt;&lt;/player&gt;&gt;

You continue chatting easily until the wine, cheese, and fruit is all gone. Eventually you put your clothes back on and bid farewell to ?Eve. You leave her room, still a bit dazed from the amazing sex, turning over the idea of working in the brothel in your mind.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Return to ?Velma&#39; &#39;Velma After Sex Education&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="118" name="Eve Give Dildo" tags="" position="975,1475" size="100,100">&lt;&lt;completequest &#39;eve-give-vibrator&#39;&gt;&gt;

You pause outside of ?Eve&#39;s door, feeling the weight of the wand inside your pocket. For just a moment you wonder whether giving ?Eve a sex toy is too forward, but then you remember the &quot;training&quot; she gave you. It&#39;s hard to imagine ?Eve being uncomfortable with anything sex-related. Feeling a little more confident, you knock on the door.?nl

After a few moments, ?Eve pulls open the door. She&#39;s wearing a luxurious pink robe embroidered with intricate golden threads, the neckline tied so loosely so that you can see most of her breasts beneath. Her face lights up as she sees you.

&lt;&lt;eve&gt;&gt;Oh, ?newname! It&#39;s wonderful to see you. Would you like to come in?&lt;&lt;/eve&gt;&gt;

&lt;&lt;player&gt;&gt;Oh- I would love to!&lt;&lt;/player&gt;&gt;

You follow her inside as she closes the door behind you. She sits comfortably on her sofa and you sit next to her. 

&lt;&lt;player&gt;&gt;I&#39;ve actually, um, brought you a gift!&lt;&lt;/player&gt;&gt;

You pull out the wand of vibrations, feeling suddenly awkward as you present it to her. To your relief, she picks up the wand with a look of delight on her face.

&lt;&lt;eve&gt;&gt;Oh, my goodness! Did ?Beau make this? I heard she was working on some new designs!&lt;&lt;/eve&gt;&gt;

&lt;&lt;player&gt;&gt;Oh, yes, she did! It&#39;s a wand of vibrations.&lt;&lt;/player&gt;&gt;

&lt;&lt;eve&gt;&gt;What a wonderful name. I love it. Thank you, ?newname, I can&#39;t wait to use it!&lt;&lt;/eve&gt;&gt;

?Eve grins at you, then carefully places the wand on an elaborate side table.

&lt;&lt;eve&gt;&gt;Maybe we could test it out together!&lt;&lt;/eve&gt;&gt;

You feel color rise in your cheeks as she said this. Her directness about sexual matters still catches you off-guard, even though you know to expect it by now. 

&lt;&lt;eve&gt;&gt;This is such a thoughtful gift, I&#39;d love to return the favor by asking you on a date. &lt;&lt;if hasTag(&#39;eve-waterfall&#39;)&gt;&gt;Maybe we could go for a nice swim at that waterfall in the woods where we first met!&lt;&lt;else&gt;&gt;There&#39;s a lovely waterfall in the woods where I like to swim. Maybe we could go together?&lt;&lt;/if&gt;&gt;&lt;&lt;/eve&gt;&gt;

&lt;&lt;decision &#39;Accept her invitation&#39;&gt;&gt;

    &lt;&lt;startquest &#39;eve-date-1&#39;&gt;&gt;

    &lt;&lt;player&gt;&gt;Th-that sounds wonderful!&lt;&lt;/player&gt;&gt;

    &lt;&lt;eve&gt;&gt;Amazing! My mornings are always free. Just stop by my room when you&#39;re ready and we can go together.&lt;&lt;/eve&gt;&gt;

    Feeling a mixture of nerves and excitement for your upcoming date, you bid her farewell for now.

    &lt;&lt;decision &#39;Leave her room&#39; &#39;Tavern&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decisionicon romance&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Decline her invitation&#39;&gt;&gt;

    &lt;&lt;removetag &#39;eve-romance&#39;&gt;&gt;

    &lt;&lt;player&gt;&gt;Oh, um, thank you for the invitation, but I think I will have to decline.&lt;&lt;/player&gt;&gt;

    ?Eve looks confused for a moment, but the smile returns quickly to her face.

    &lt;&lt;eve&gt;&gt;Oh, I must have misunderstood the situation! It&#39;s absolutely no problem to keep our relationship more professional. Thank you again for the lovely gift.&lt;&lt;/eve&gt;&gt;

    Though ?Eve seems to taken your rejection with grace, you can&#39;t help but feel awkward about the situation. You quickly bid her farewell for now.

    &lt;&lt;decision &#39;Leave her room&#39; &#39;Tavern&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;

&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="119" name="Eve Date 1 Start" tags="" position="1100,1475" size="100,100">&lt;&lt;completequest &#39;eve-date-1&#39;&gt;&gt;

Your heart beating fast in anticipation of your morning with ?Eve, you raise your fist to knock on her door. She answers the door quickly, and you see that she&#39;s wearing a pink silk dress with delicate ruffles around the edges.

&lt;&lt;eve&gt;&gt;Oh, ?newname! I was hoping it would be you. Are you ready to head to the waterfall?&lt;&lt;/eve&gt;&gt;

You suddenly realize that you&#39;ve quite forgotten to bring anything with you for the date.

&lt;&lt;if hasTag(&#39;eve-waterfall&#39;)&gt;&gt;
    You suppose, however, that a swimsuit isn&#39;t necessary, considering how ?Eve likes to swim in the nude.

    &lt;&lt;player&gt;&gt;Yes! Should we bring anything?&lt;&lt;/player&gt;&gt;

    &lt;&lt;eve&gt;&gt;I&#39;ve already got all we need right here!&lt;&lt;/eve&gt;&gt;

    She holds up a large bottle of red wine and gives you a wink.

    &lt;&lt;eve&gt;&gt;Shall we?&lt;&lt;/eve&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;player&gt;&gt;Ah, yes, although I&#39;ve just realized I&#39;ve forgotten to bring my swimsuit!&lt;&lt;/player&gt;&gt;

    ?Eve laughs good-naturedly as she steps out of her room and locks it behind her. 

    &lt;&lt;eve&gt;&gt;Don&#39;t worry, swimming in the nude is much more fun! I have all we need right here.&lt;&lt;/eve&gt;&gt;

    You feel a jolt in your stomach as she holds up a large bottle of red wine and gives you a wink.

    &lt;&lt;eve&gt;&gt;Shall we?&lt;&lt;/eve&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Start walking toward the waterfall&#39; &#39;Eve Date 1 Walk&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="120" name="Eve Date 1 Walk" tags="" position="1225,1475" size="100,100">&lt;&lt;setlocation &#39;Forest&#39;&gt;&gt;

You and ?Eve walk through the meadow on the outskirts of town and into the forest. Though the morning is warm and bright, the temperature cools as you step under the tall trees. The sounds of the world recede as you walk across the soft ground, and you hear the warbling of birds in the distance.?nl

As you walk together, ?Eve hooks an arm through yours and smiles at you brightly.

&lt;&lt;eve&gt;&gt;I&#39;m so excited to have sex with you later, ?newname!&lt;&lt;/eve&gt;&gt;

You choke as she says this, taken completely off-guard by her casual comment. She looks at you with concern.

&lt;&lt;eve&gt;&gt;Oh, I mean, only if you want to, of course! I&#39;m also just excited to swim!&lt;&lt;/eve&gt;&gt;

In a way, you&#39;re almost glad that she&#39;s so open about this topic. You feel yourself relax a bit knowing that if you do want to have sex with her, she will certainly be enthusiastic. You smile at her reassuringly.

&lt;&lt;player&gt;&gt;M-me too!&lt;&lt;/player&gt;&gt;

You continue your walk together, chatting and pointing out the occasional interesting mushroom as you go.

&lt;&lt;decision &#39;Arrive at the waterfall&#39; &#39;Eve Date 1 Arrive Waterfall&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="121" name="Eve Date 1 Arrive Waterfall" tags="" position="100,1600" size="100,100">&lt;&lt;setlocation &#39;Waterfall&#39;&gt;&gt;

The rush of water fills your ears as you and ?Eve approach the waterfall. You&#39;ve barely arrived at the shore when ?Eve drops the wine bottle on the soft moss and removes her dress in one swift movement.?nl

You can&#39;t help but stare at her body as she stands naked in front of you. Her breasts are round and full, and below you see her penis hanging casually, &lt;&lt;if settings.sph&gt;&gt;much larger than yours even in its relaxed state&lt;&lt;else&gt;&gt;still large in its relaxed state&lt;&lt;/if&gt;&gt;. Seeing you look at her, ?Eve grins and jumps into the water, sending splashes onto the shore.

&lt;&lt;eve&gt;&gt;Come on in, ?newname! It&#39;s nice and cold!&lt;&lt;/eve&gt;&gt;

&lt;&lt;if hasVisited(&#39;Eve Sex Education Physical&#39;)&gt;&gt;Even though ?Eve has already seen your naked body before, and seemed to quite enjoy it,&lt;&lt;else&gt;&gt;Even though ?Eve seems completely comfortable showing off her own naked body,&lt;&lt;/if&gt;&gt; you feel suddenly self-conscious. ?Eve swims up to the shore and smiles at you gently.

&lt;&lt;eve&gt;&gt;Swimming naked is very freeing, but you don&#39;t have to do it if you don&#39;t want to!&lt;&lt;/eve&gt;&gt;

You look back at her, recognizing genuine acceptance in her eyes. You realize that perhaps out of anyone in the kingdom, ?Eve is the most likely to enjoy you as you are. You borrow a fragment of her confidence and strip your clothes off, jumping into the water next to her.?nl 

?Eve laughs as you emerge above the surface, breathing hard from the shock of cold water.

&lt;&lt;player&gt;&gt;It&#39;s freezing!&lt;&lt;/player&gt;&gt;

&lt;&lt;eve&gt;&gt;Well, then, allow me to warm you up!&lt;&lt;/eve&gt;&gt;

She dives underwater and swims toward you. Laughing, you swim away from her, playing a miniature game of chase as she follows you around the pool. After some minutes she finally catches you and pulls you in toward her, both of you laughing giddily. Suddenly she&#39;s quite close to you, and you find yourself meeting her eyes.

&lt;&lt;player&gt;&gt;Th-thank you, ?Eve. For being so supportive.&lt;&lt;/player&gt;&gt;

&lt;&lt;eve&gt;&gt;Of course, ?newname! It&#39;s not hard when someone is so attractive. In fact, I&#39;m feeling quite turned on being here naked with you!&lt;&lt;/eve&gt;&gt;

Before you can stop yourself, your eyes trail downward, and you can see that even in the cool water, ?Eve is sporting a large erection. She grins at you, and you feel the tension in the air as you consider how to react.

&lt;&lt;decision &#39;Stammer a response&#39; &#39;Eve Date 1 Slow Down&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="122" name="Eve Date 1 Slow Down" tags="" position="225,1600" size="100,100">Even though you already discussed the prospect of having sex earlier, and her erection is currently pointed directly at you, you are entirely incapable of phrasing a coherent thought, her directness once again catching you completely off-guard. You manage to only mumble something and sound silly while your cheeks redden visibly.

&lt;&lt;player&gt;&gt;Ah- Yeah same- That sounds- I think I&#39;d-&lt;&lt;/player&gt;&gt;

Before you can continue your babbling ?Eve suddenly interrupts you with her laughter.

&lt;&lt;eve&gt;&gt;Hahaha, okay, I think I have an idea... I think I have something right here that&#39;ll help your jitters.&lt;&lt;/eve&gt;&gt;

She grabs the bottle of wine from the bank of the pool and pops open the cork, offering the bottle to you. You smile at her as you immediate grab it to take a swig, enjoying the rich, fruity flavor of the dark wine. 

&lt;&lt;player&gt;&gt;Wow, this is delicious. Is it from the tavern?&lt;&lt;/player&gt;&gt;

?Eve grins at you and takes a swig from the bottle herself, clearly savoring it as she moves it around her mouth before swallowing.

&lt;&lt;eve&gt;&gt;?Velma lets me take a bottle every once in a while from her private stash. She keeps the good stuff on hand for impressing wealthy merchants and traveling dignitaries, that sort of thing.&lt;&lt;/eve&gt;&gt;

&lt;&lt;player&gt;&gt;Consider me impressed, then.&lt;&lt;/player&gt;&gt;

?Eve is still smiling at you, a ghost of the wine visible on her full lips. You&#39;re quite certain you could kiss her right now, if you wanted to. After all, she was willing to jump immediately to sex...

&lt;&lt;decision &#39;Lean in to kiss her&#39; &#39;Eve Date 1 Kiss&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Let the moment pass&#39; &#39;Eve Date 1 Rejected&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="123" name="Eve Date 1 Kiss" tags="" position="350,1600" size="100,100">You move closer to her in the water, trying to calm the flutter in your chest as you approach.

&lt;&lt;player&gt;&gt;Oh, I think you, um, have a bit of wine just there...&lt;&lt;/player&gt;&gt;

?Eve seems to read your body language instantly. She moves toward you, her face now tantalizingly close to yours.

&lt;&lt;eve&gt;&gt;Well, then, ?newname, could you...get it for me?&lt;&lt;/eve&gt;&gt;

You close the gap between you, your lips meeting hers. Even the rush of the waterfall seems to fall away as you kiss each other, and you barely notice the cold of the water as a warmth spreads throughout your chest.?nl

You stay there a long time, kissing each other in the water, exploring each other&#39;s mouths until finally you break away to catch your breath. ?Eve grins at you again, this time a look of desire in her eyes. It feels particularly intimate to kiss her while both of you are entirely naked, &lt;&lt;if isInChastity()&gt;&gt;and in a way you&#39;re almost grateful that your chastity cage keeps your growing arousal hidden.&lt;&lt;else&gt;&gt;and you wonder if ?Eve can see your erection growing under the water.&lt;&lt;/if&gt;&gt; Will you give into your arousal, or just keep kissing her?&lt;br&gt;

&lt;&lt;decision &#39;Indicate your sexual interest&#39; &#39;Eve Date 1 Sex&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Don\&#39;t go beyond kissing&#39;&gt;&gt;
    &lt;br&gt;You stay together in the water, taking sips of wine in between kisses as you enjoy being close to each other. You only realize it&#39;s time to leave when the sunlight begins to grow weaker, and your shifts at the tavern will soon begin. Laughing, you dress yourselves and make your way back out of the forest hand-in-hand.

    &lt;&lt;decision &#39;Part ways with ?Eve at her room&#39; &#39;Eve Date 1 End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="124" name="Eve Date 1 Rejected" tags="" position="475,1600" size="100,100">&lt;&lt;player&gt;&gt;Oh, you, um, have some wine on your lips...&lt;&lt;/player&gt;&gt;

?Eve licks her lips and grins at you, then dives under the surface of the water. She emerges again some moments later under the waterfall.

&lt;&lt;eve&gt;&gt;Come try standing under the falls! It&#39;s fun!&lt;&lt;/eve&gt;&gt;

You follow her and let the water flow over you. The sound is loud here and the force of the water is almost painful, but at the same time it&#39;s exhilarating to feel the falls crashing over your body. You grin back at ?Eve and break into laughter from the sheer sensation. She laughs with you.?nl

You spend the rest of the morning finishing off the bottle of wine and chatting. Finally the sunlight begins to grow weaker and you realize your shifts at the tavern will soon start. You get dressed and walk back to the tavern together.

&lt;&lt;decision &#39;Part ways with ?Eve&#39; &#39;Eve Date 1 End Platonic&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="125" name="Eve Date 1 Sex" tags="spicy" position="600,1600" size="100,100">&lt;&lt;player&gt;&gt;I would love to get closer to you, ?Eve...&lt;&lt;/player&gt;&gt;

&lt;&lt;eve&gt;&gt;I&#39;m so glad you said so! Come here...&lt;&lt;/eve&gt;&gt;

She reclines on the underwater slope of the pool&#39;s edge and pulls you onto her lap. Through the water, you feel her erection brush against your stomach&lt;&lt;if !isInChastity()&gt;&gt; while your own floats free&lt;&lt;/if&gt;&gt;. You lean in to kiss her and she kisses back hungrily. After some moments, she pulls back, looking you in the eyes.

&lt;&lt;eve&gt;&gt;I would love to be inside you, ?newname...&lt;&lt;/eve&gt;&gt;

&lt;&lt;player&gt;&gt;I-I would like that very much...&lt;&lt;/player&gt;&gt;

She grins at you and pulls you in again, kissing you deeply. You feel her hand moving gently across your back in the water, dipping lower and lower until she begins to circle a finger around your entrance. You gasp involuntarily as she gently pushes her finger against the ring of muscle.

&lt;&lt;eve&gt;&gt;Let me know if I need to slow down, okay? We have all the time in the world...&lt;&lt;/eve&gt;&gt;

You nod fervently and lean in to kiss her again as she proceeds to gently push a finger through your hole. It slides through and you moan into her mouth, already anticipating something much larger taking its place.?nl

Slowly, she starts to finger you, adding a second finger after a minute or two. The sensation is already so arousing that you find yourself pushing back against her hand, thrusting her fingers even deeper inside of you. 

&lt;&lt;eve&gt;&gt;&lt;&lt;if isInChastity()&gt;&gt;Awh look at that kinky chastity cage... &lt;&lt;/if&gt;&gt;Fuck, you&#39;re so hot, ?newname! I can&#39;t wait to be inside you...&lt;&lt;/eve&gt;&gt;

&lt;&lt;player&gt;&gt;I-I&#39;m ready for you, ?Eve... I want to feel you inside me...&lt;&lt;/player&gt;&gt;

Without another word, she reaches onto the bank, pulling a lubricating potion out of a hidden pocket in her dress. She rubs some onto her erect cock and some onto your entrance. You wonder whether the potion will work underwater, but ?Eve seems to recognize your confusion and grins.

&lt;&lt;eve&gt;&gt;One of the magical features... It works underwater!&lt;&lt;/eve&gt;&gt;

She corks the remainder of the potion and throws it back onto the bank. Using your buoyancy in the water, she brings you closer and positions you just above the head of her cock. Ever so gently, she pulls you down and you feel a pressure on your asshole as the head of her cock pushes against it.?nl

After a moment, her cock presses through the muscle and you feel her erection slide inside of you. You gasp loudly as a wave of pleasure moves through your body. 

&lt;&lt;player&gt;&gt;Fuck! That feels so good!&lt;&lt;/player&gt;&gt;

She kisses you again, pausing a moment as you adjust to her large cock being inside of you. Then she begins to thrust, not by moving her own body, but by moving you up and down in the water. It is a unique sensation and something about her controlling your body in this way is incredibly arousing. &lt;&lt;if isInChastity()&gt;&gt;Your own ?dick is now straining mightily against its cage.&lt;&lt;/if&gt;&gt;

&lt;&lt;eve&gt;&gt;Mmph, you&#39;re so tight around my cock, ?newname!&lt;&lt;/eve&gt;&gt;

&lt;&lt;player&gt;&gt;F-fuck...&lt;&lt;/player&gt;&gt;

Her tempo speeds up as she propels you harder and harder onto her erection. You feel yourself stretching around her, the pulses of pleasure as her cock massages you from the inside. &lt;&lt;if !isInChastity()&gt;&gt;Even in the cold water, your ?dick is now rock-hard from the rapturous sensation.&lt;&lt;/if&gt;&gt;

&lt;&lt;eve&gt;&gt;I&#39;m all the way inside you!&lt;&lt;/eve&gt;&gt;

She pulls you down again and you moan loudly as her cock reaches its deepest point. You&#39;re taking her so far inside you that you feel your ass cheeks press into her pelvis.

&lt;&lt;if isInChastity()&gt;&gt;
    She looks down in the water, grinning as she looks at your caged ?dick.
    
    &lt;&lt;eve&gt;&gt;You&#39;re leaking so much pre-cum from your cage... Maybe I can even get you to cum simply by fucking you...&lt;&lt;/eve&gt;&gt;

    As she says this, still plunging you onto her cock over and over, your pleasure builds higher and higher. Hearing her talk about your chastity cage is turning you on so much, and feeling her hard cock grind against your prostate is nearly sending you over the edge... You&#39;ve never been this close to cumming just from pleasuring your ass before...
&lt;&lt;else&gt;&gt;
    She looks down in the water, grinning as she notices how erect you are.
    
    &lt;&lt;eve&gt;&gt;You&#39;re so hard right now! Do you want to cum, ?newname?&lt;&lt;/eve&gt;&gt;

    As she says this, still plunging you onto her cock over and over, your pleasure builds to a peak. You moan in affirmation and wrap your &lt;&lt;if settings.sph&gt;&gt;fingers&lt;&lt;else&gt;&gt;hand&lt;&lt;/if&gt;&gt; around your ?dick, quickly bringing yourself to orgasm as your cum shoots into the clear water.
&lt;&lt;/if&gt;&gt;

&lt;&lt;eve&gt;&gt;Uhnf, you&#39;re so hot! I&#39;m going to cum!&lt;&lt;/eve&gt;&gt;

Her body pulses in pleasure as she spills inside of you, her hot cum filling up your ass as she lets out a sensual moan. When she withdraws herself from you, you see her cum leak out of you and into the water. Satisfied yet exhausted, you both make your way out of the water and collapse onto the grass in a patch of sunlight.

&lt;&lt;decision &#39;Catch your breath&#39; &#39;Eve Date 1 After Sex&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="126" name="Eve Date 1 After Sex" tags="" position="725,1600" size="100,100">&lt;&lt;settime &#39;Evening&#39;&gt;&gt;

Time seems to stretch as you spend much of the day there with ?Eve, lying naked in the sun. You chat and laugh together, enjoying each other&#39;s bodies and mouths as you like, until the sunlight starts to grow weaker and you realize your shifts at the tavern will soon begin.?nl

You dress yourselves and make you way back out of the forest happily, hand-in-hand.

&lt;&lt;decision &#39;Part ways with ?Eve at her room&#39; &#39;Eve Date 1 End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="127" name="Eve Date 1 End Platonic" tags="" position="850,1600" size="100,100">&lt;&lt;settime &#39;Evening&#39;&gt;&gt;
&lt;&lt;setlocation &#39;Eve\&#39;s Room&#39;&gt;&gt;
&lt;&lt;removetag &#39;eve-romance&#39;&gt;&gt;

You slow to a stop in front of ?Eve&#39;s door, suddenly feeling awkward. You&#39;ve had a lovely time with ?Eve today, but you never felt inclined to go beyond talking. It seems as though your relationship should remain more friendly, though you&#39;re not sure how to tell ?Eve this.

&lt;&lt;eve&gt;&gt;You know, ?newname, I had a wonderful time spending the day with you, and I just want you to know that it&#39;s no problem if you&#39;d rather stay friends!&lt;&lt;/eve&gt;&gt;

You look at her quickly, and recognize complete authenticity in her statement. She seems genuinely excited that you got to spend quality time together, regardless of whether you did anything more physical.

&lt;&lt;player&gt;&gt;Oh, um, thank you for saying so, ?Eve. I think I would like that!&lt;&lt;/player&gt;&gt;

She grins at you. 

&lt;&lt;eve&gt;&gt;That&#39;s so exciting! You&#39;re a great friend, ?newname, and I&#39;m so glad I met you.&lt;&lt;/eve&gt;&gt;

Though you still feel a bit awkward, you can&#39;t help but be grateful for her warm reaction. You reach out for a hug, and she gladly returns it. You bid farewell for now, glad to have such a supportive friend on your side.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Part ways with ?Eve&#39; &#39;Tavern&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="128" name="Eve Date 1 End" tags="" position="975,1600" size="100,100">&lt;&lt;settime &#39;Evening&#39;&gt;&gt;
&lt;&lt;setlocation &#39;Eve\&#39;s Room&#39;&gt;&gt;
&lt;&lt;addtag &#39;eve-romance&#39;&gt;&gt;

You slow to a stop in front of ?Eve&#39;s door, your hands still intertwined. 

&lt;&lt;player&gt;&gt;I-I&#39;ve had such a lovely time with you today, ?Eve!&lt;&lt;/player&gt;&gt;

&lt;&lt;if hasVisited(&#39;Eve Date 1 Sex&#39;)&gt;&gt;
    &lt;&lt;eve&gt;&gt;I loved having sex with you, ?newname! I hope we can do it again soon!&lt;&lt;/eve&gt;&gt;
    You&#39;re still not used to her being so open about this topic. You feel yourself blushing and look around the hallway. Luckily no one seems to be nearby.?nl
&lt;&lt;else&gt;&gt;
    &lt;&lt;eve&gt;&gt;I loved spending the day with you, ?newname! I hope we can do it again soon!&lt;&lt;/eve&gt;&gt;
&lt;&lt;/if&gt;&gt;

You smile at her and lean in for a kiss. She meets your lips passionately, and already part of you wants to spend more time just like this, but you have to get on with your evening. You bid her farewell for now, looking forward to the next time you can spend one-on-one time together.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Part ways with ?Eve&#39; &#39;Tavern&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="129" name="Hyssop" tags="" position="1100,1600" size="100,100">&lt;&lt;if questStep(&#39;princess-lessons-intro&#39;) is 3&gt;&gt;
    &lt;&lt;decision &#39;Discuss your new lessons with ?Hyssop&#39; &#39;Hyssop Princess Training Intro&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &#39;Speak to ?Hyssop&#39; &#39;Hyssop Talk&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="130" name="Hyssop Talk" tags="" position="1225,1600" size="100,100">&lt;&lt;money mushrooms true&gt;&gt;

&lt;&lt;hyssop&gt;&gt;Oh hi, ?player! How nice of you to visit again, let me get you a cup of tea!&lt;&lt;/hyssop&gt;&gt;

You sit down at their table and accept the nice hot mug of herbal tea.

&lt;&lt;hyssop&gt;&gt;So, what brings you to this neck of the woods?&lt;&lt;/hyssop&gt;&gt;


&lt;&lt;if hasQuest(&#39;princess-lessons&#39;) and !hasCounter(&#39;hyssop-training&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Tell them you are here for a training session&#39;&gt;&gt;
        &lt;&lt;include &#39;Hyssop Princess Training&#39;&gt;&gt;
        &lt;&lt;decisionicon fashion&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;View clothes&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;I&#39;d actually love to have another look at what clothes you have been working on!&lt;&lt;/player&gt;&gt;
    &lt;&lt;first&gt;&gt;
        &lt;&lt;hyssop&gt;&gt;Awesome! I just finished a new royal outfit, I think you&#39;ll love it!&lt;&lt;/hyssop&gt;&gt;
        Before ?Hyssop hurriedly moves to grab their tailoring work, you stop them to ask them a question.
        &lt;&lt;player&gt;&gt;Actually, ?Hyssop... I was wondering how I can pay you for these clothes, I have some gold on me but I don&#39;t know what your prices are.&lt;&lt;/player&gt;&gt;
        They look at you a little confused. ?Hyssop suddenly starts laughing.
        &lt;&lt;hyssop&gt;&gt;Gold? What use would I have for that?&lt;&lt;/hyssop&gt;&gt;
        Okay, not a fan of gold, you guess. You&#39;re still not sure how you can pay them for the clothes...
        &lt;&lt;player&gt;&gt;Uhm, wait, so you want to give me the clothes for free?&lt;&lt;/player&gt;&gt;
        ?Hyssop strokes their fingers along their chin as if looking for an idea.
        &lt;&lt;hyssop&gt;&gt;Hmm... No, I suppose that wouldn&#39;t be quite fair...&lt;&lt;/hyssop&gt;&gt;
        Suddenly they point up a finger, it seems like they have an idea.
        &lt;&lt;hyssop&gt;&gt;Aha! I know how you can pay me! Why don&#39;t you bring over more of those mushrooms you and ?Morgana found in the woods! If you spend some time gathering mushrooms, you can use them to buy the clothes from me. I&#39;m a genius!&lt;&lt;/hyssop&gt;&gt;
        Their excitement for thinking of a bargaining system is kind of cute.
        &lt;&lt;player&gt;&gt;I suppose that sounds like a fair deal, I&#39;ll see if I can find more mushrooms for you later.&lt;&lt;/player&gt;&gt;
        &lt;&lt;hyssop&gt;&gt;Amazing! We have a deal then, pleasure doing business! Now, why don&#39;t you have a look at the goods I&#39;m offering, see what exactly it is you&#39;ll be gathering those shrooms for!&lt;&lt;/hyssop&gt;&gt;
    &lt;&lt;finally&gt;&gt;
        &lt;&lt;hyssop&gt;&gt;Gladly! You just keep those mushrooms coming and you can have all clothes that you want!&lt;&lt;/hyssop&gt;&gt;
    &lt;&lt;/first&gt;&gt;
    &lt;&lt;decision &#39;Browse clothes&#39; &#39;Hyssop Store&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decisionicon mushrooms&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Simply visiting&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;I happened to be around and wanted to give my favourite forest druid a visit!&lt;&lt;/player&gt;&gt;
    &lt;&lt;hyssop&gt;&gt;Awwh, I didn&#39;t know I was your &lt;em&gt;favorite&lt;/em&gt; forest druid! That&#39;s quite the honor!&lt;&lt;/hyssop&gt;&gt;
    You spend some time together with ?Hyssop in their hut. They tell you all kinds of things about the forest and their new hobbies. Even though they pick up new creative activities almost daily, tailoring still seems to be their favorite.?nl
    After drinking quite a few cups of ?Hyssop&#39;s lovely tea you bid farewell to them. They thank you for stopping by and even hand you a small bag of homemade treats when you leave. Even though they pretty much chose the life of a hermit, ?Hyssop seems to really like receiving visitors.
    &lt;&lt;decision &#39;Leave&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;if hasQuest(&#39;rosa-flowers&#39;) and !hasTag(&#39;rosa-purple-flower&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Ask about the flowers ?Rosa mentioned&#39; &#39;Rosa Find Flower Hyssop&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="131" name="Hyssop Princess Training Intro" tags="" position="100,1725" size="100,100">&lt;&lt;advancequest &#39;princess-lessons-intro&#39;&gt;&gt;

?Hyssop looks up excitedly as you enter their hut. They appear to pinning pieces of cloth to a dress form, though you&#39;re unsure what kind of clothing item it will eventually form.

&lt;&lt;hyssop&gt;&gt;&gt;Oh! Hi there!&lt;&lt;/hyssop&gt;&gt;

?Hyssop runs over and gives you a warm embrace. They step back, beaming at you with a proud look on their face. 

&lt;&lt;hyssop&gt;&gt;?Morgana visited and explained everything already. I&#39;m so excited for you, Princess! And don&#39;t worry, this secret is safe with me!&lt;&lt;/hyssop&gt;&gt;

You feel the color rise in your cheeks. You&#39;re not used to being referred to as a princess, but at the same time, hearing it fills your chest with some mixture of warmth and thrill. 

&lt;&lt;player&gt;&gt;Th-thank you, ?Hyssop.&lt;&lt;/player&gt;&gt;

?Hyssop grins as they lift up a massive basket full to the brim with what looks like makeup supplies, hair accessories, and cloth in various colors. 

&lt;&lt;hyssop&gt;&gt;I&#39;m so glad you asked me for help, I&#39;ve never been more excited for a lesson in my life!&lt;&lt;/hyssop&gt;&gt;

You would wager that ?Hyssop has probably been excited for every single lesson they have ever been a part of. 

&lt;&lt;player&gt;&gt;Oh, wow, that looks like a lot to learn...&lt;&lt;/player&gt;&gt;

?Hyssop places the basket down cheerfully.

&lt;&lt;hyssop&gt;&gt;Don&#39;t worry, I&#39;ll guide you through everything: hair, makeup, and clothes! Of course, these things aren&#39;t what make you a princess. You&#39;re already a princess! I just hope you&#39;ll find that experimenting with your appearance can be a lot of fun. Tea?&lt;&lt;/hyssop&gt;&gt;

Before you get a chance to respond, ?Hyssop has already conjured a beautiful ceramic teapot and three cups, which they deftly fill with lightly pink tea that smells distinctly floral.?nl

&lt;&lt;player&gt;&gt;Um, sure! It smells lovely.&lt;&lt;/player&gt;&gt;

You sit with ?Hyssop for some time, sipping tea and enjoying a bowl of fresh berries. Part of you is anxious to start your lessons immediately, but at the same time, another part is relieved that you have a bit more time to adjust mentally to this new situation.?nl

When the teapot has been emptied and refilled several times, ?Hyssop excitedly gets up from their chair.

&lt;&lt;hyssop&gt;&gt;So, are you ready for your first lesson?&lt;&lt;/hyssop&gt;&gt;

&lt;&lt;decision &#39;Start your first lesson&#39;&gt;&gt;
    &lt;&lt;include &#39;Hyssop Princess Training&#39;&gt;&gt;
    &lt;&lt;decisionicon fashion&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="132" name="Hyssop Princess Training" tags="" position="225,1725" size="100,100">&lt;&lt;if !hasVisited(&#39;Hyssop Princess Training 1&#39;)&gt;&gt;
    &lt;&lt;goto &#39;Hyssop Princess Training 1&#39;&gt;&gt;
&lt;&lt;elseif !hasVisited(&#39;Hyssop Princess Training 2&#39;)&gt;&gt;
    &lt;&lt;goto &#39;Hyssop Princess Training 2&#39;&gt;&gt;
&lt;&lt;elseif !hasVisited(&#39;Hyssop Princess Training 3&#39;)&gt;&gt;
    &lt;&lt;goto &#39;Hyssop Princess Training 3&#39;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;goto `either(&#39;Hyssop Princess Training 1&#39;, &#39;Hyssop Princess Training 2&#39;, &#39;Hyssop Princess Training 3&#39;)`&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="133" name="Hyssop Princess Training End" tags="" position="350,1725" size="100,100">&lt;&lt;decision &#39;Thank ?Hyssop and take your leave&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;changestat fashion 1&gt;&gt;&lt;&lt;addcounter &#39;hyssop-training&#39; 1&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="134" name="Hyssop Princess Training 1" tags="" position="475,1725" size="100,100">When you enter the hut, you see that ?Hyssop is currently busy mixing something in a wooden bowl.

&lt;&lt;hyssop&gt;&gt;Oh, hi, friend!&lt;&lt;/hyssop&gt;&gt;

?Hyssop drops their spoon and runs over to hug you. As they do, you notice an odd smell in the room.

&lt;&lt;first&gt;&gt;
    &lt;&lt;player&gt;&gt;Great to see you! May I ask, though, what is that smell?&lt;&lt;/player&gt;&gt;

    ?Hyssop sniffs the air, then chuckles.
    
    &lt;&lt;hyssop&gt;&gt;Oh, that&#39;s hair dye! Speaking of which, are you here for a lesson? Because I would love to teach you all about hair today!&lt;&lt;/hyssop&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;player&gt;&gt;Mixing up more hair dye?&lt;&lt;/player&gt;&gt;
    &lt;&lt;hyssop&gt;&gt;Yes! You can never have too many colors available, you know! How about another lesson in hair today?&lt;&lt;/hyssop&gt;&gt;
&lt;&lt;/first&gt;&gt;

&lt;&lt;player&gt;&gt;That sounds lovely.&lt;&lt;/player&gt;&gt;

?Hyssop packages the dye into a small glass bottle and places it on a shelf, ready for later use. 

&lt;&lt;hyssop&gt;&gt;Now, take a seat in front of this mirror here!&lt;&lt;/hyssop&gt;&gt;

&lt;&lt;first&gt;&gt;
    You sit down in an elaborate, twisted vine chair and look back at your reflection. 

    &lt;&lt;hyssop&gt;&gt;Oh, you have beautiful &lt;&lt;= hair()&gt;&gt; hair! Is alright if I touch it?&lt;&lt;/hyssop&gt;&gt;

    &lt;&lt;player&gt;&gt;Oh- um, yes, of course...&lt;&lt;/player&gt;&gt;

    ?Hyssop smiles at you and runs their hands through your hair gently, sending a tingle down the back of your neck.

    &lt;&lt;hyssop&gt;&gt;I can see you&#39;re doing well with the first aspect of hair styling, which is having clean, healthy hair! Sometimes it can be fun to add a scent with fragrant powders. Would you like some?&lt;&lt;/hyssop&gt;&gt;

    ?Hyssop holds up a jar, letting you sniff the contents. You inhale a light scent of herbs and flowers.

    &lt;&lt;player&gt;&gt;Oh, that&#39;s lovely! Yes, please.&lt;&lt;/player&gt;&gt;

    ?Hyssop applies some of the powder to your hair. You breathe in the pleasant smell as they comb the powder through with a beautiful carved wooden comb. You relax into your chair, enjoying the luxurious experience.

    &lt;&lt;if hairValue() &gt; 1 &gt;&gt;
        &lt;&lt;hyssop&gt;&gt;Now we can move on to styling! Your &lt;&lt;= hair()&gt;&gt; hair is perfectly suited to hairstyles involving braids and ribbons.&lt;&lt;/hyssop&gt;&gt;

        You watch in the mirror as ?Hyssop expertly weaves your hair into several different hairstyles, often using multiple braids interwoven with silky ribbons. They explain the method cheerfully as they go. As they finish each style, you admire yourself in the mirror, feeling transformed in some small way.

        &lt;&lt;player&gt;&gt;These all look beautiful! I don&#39;t suppose I could...do these styles myself?&lt;&lt;/player&gt;&gt;

        &lt;&lt;hyssop&gt;&gt;Possibly, though your arms might get pretty tired! Hairstyles of this complexity are usually executed by a second person, but next time I&#39;ll show you what you can accomplish all by yourself!&lt;&lt;/hyssop&gt;&gt;
    &lt;&lt;elseif hairValue()  &lt;= 1 &gt;&gt;
        &lt;&lt;hyssop&gt;&gt;Now we can move on to styling! Your &lt;&lt;= hair()&gt;&gt; hair is perfectly suited a number of styles.&lt;&lt;/hyssop&gt;&gt;

        You watch in the mirror as ?Hyssop expertly demonstrates several different hairstyles, some accentuating your &lt;&lt;= hair()&gt;&gt; hair with flowers or ribbons, others blending your hair seamlessly with extensions to give the appearance of longer hair.

        &lt;&lt;player&gt;&gt;These all look beautiful! I don&#39;t suppose I could...do these styles myself?&lt;&lt;/player&gt;&gt;

        &lt;&lt;hyssop&gt;&gt;Definitely, though your arms might get a bit tired with the more complex ones! Intricate hairstyles are normally executed by a second person, but next time I&#39;ll show you what you can accomplish yourself!&lt;&lt;/hyssop&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;then&gt;&gt;
    You sit down in front of the mirror and look at ?Hyssop in the reflection expectantly.

    &lt;&lt;hyssop&gt;&gt;Today I thought I could show you how to accomplish some hairstyles yourself! Working with your own hair can be tricky at times, but it just takes a bit of practice.&lt;&lt;/hyssop&gt;&gt;

    &lt;&lt;if hairValue() &gt; 1 &gt;&gt;
        ?Hyssop sets a second mirror on a nearby table, allowing you to see the back of your head, then instructs you in creating a braid with your own hair. The motions are at first unintuitive, but after several tries and several breaks for your tired arm muscles, you create a fine braid which you tie off with a piece of ribbon.
    &lt;&lt;elseif hairValue() &lt;= 1 &gt;&gt; 
        ?Hyssop sets a second mirror on a nearby table, allowing you to see the back of your head, then instructs you in creating several hairstyles suited to &lt;&lt;= hair()&gt;&gt; hair. The motions are at first unintuitive, especially whenever you need to involve the hair at the back of your head, but eventually you create a pretty style involving an abundance of hair pins and curled, silky ribbons.
    &lt;&lt;/if&gt;&gt;   

    &lt;&lt;hyssop&gt;&gt;Oh, well done, Princess! You look beautiful!&lt;&lt;/hyssop&gt;&gt;

    You can&#39;t help but grin at yourself in the mirror, admiring your handiwork. It seems that with practice, you could certainly create such a hairstyle every day, if you wanted to.?nl
&lt;&lt;finally&gt;&gt;
    You sit down in front of the mirror and look at ?Hyssop in the reflection expectantly.

    &lt;&lt;hyssop&gt;&gt;Since you&#39;re really getting the hang of hairstyling, why don&#39;t why try a more complex style today?&lt;&lt;/hyssop&gt;&gt;

    Feeling more confident in your movements now, you follow ?Hyssop&#39;s instructions to create an even more detailed hairstyle than you did in your previous lesson. It takes a great deal of time, hair pins, and ribbons, and some sections take multiple tries, but eventually &lt;&lt;if hairValue() &gt; 1 &gt;&gt;you complete a style of complicated interwoven braids accented with small white flowers picked from ?Hyssop&#39;s garden.&lt;&lt;elseif hairValue() &lt;= 1 &gt;&gt;you complete a style that weaves your hair into a golden circlet accented with small white flowers picked from ?Hyssop&#39;s garden.&lt;&lt;/if&gt;&gt; The style would look perfectly at home at a royal ball.?nl

    ?Hyssop stands back, their face full of pride as they take in your new look.

    &lt;&lt;hyssop&gt;&gt;Oh, wow... You look amazing, Princess!&lt;&lt;/hyssop&gt;&gt;

    You can&#39;t help but feel proud of yourself, too.

    &lt;&lt;player&gt;&gt;Thank you, ?Hyssop! I love it!&lt;&lt;/player&gt;&gt;
&lt;&lt;/first&gt;&gt;

Feeling like a new person, you thank ?Hyssop for their instruction and leave the hut.

&lt;&lt;include &#39;Hyssop Princess Training End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="135" name="Hyssop Princess Training 2" tags="" position="600,1725" size="100,100">You enter the hut to find ?Hyssop arranging a table covered with a colorful array of makeup items. The amount of tiny pots filled with tinted creams and powders is dazzling, &lt;&lt;first&gt;&gt;and you have no idea what most of it is used for&lt;&lt;finally&gt;&gt;though you&#39;re starting to recognize more of them&lt;&lt;/first&gt;&gt;.

&lt;&lt;hyssop&gt;&gt;Ah, I had a feeling you would show up today! Come in, come in!&lt;&lt;/hyssop&gt;&gt;

?Hyssop rushes over to give you a warm embrace and shows you the table of makeup items proudly.

&lt;&lt;player&gt;&gt;I suppose we&#39;re covering makeup today?&lt;&lt;/player&gt;&gt;

&lt;&lt;hyssop&gt;&gt;Yes, this is my entire collection! Tea?&lt;&lt;/hyssop&gt;&gt;

?Hyssop sits by the table in a chair made of vines and produces a steaming pot seemingly out of nowhere. You sit down next to them and accept a little cup of tea. You take a sip, enjoying the fresh, herbal flavor.

&lt;&lt;first&gt;&gt;
    &lt;&lt;hyssop&gt;&gt;Now, the wonderful thing about makeup is that the possibilities are endless! You might find that you prefer a fresh face, in which case I make a lovely moisturizing cream you might enjoy. But if you enjoy the ornamentation that makeup offers, you can be endlessly creative with the colors and designs that you choose!&lt;&lt;/hyssop&gt;&gt;

    It already sounds daunting, the fact that makeup apparently offers limitless possibility. The sea of little pots in front of you seems to blend together in front of your eyes as you stare at them.

    &lt;&lt;hyssop&gt;&gt;But let&#39;s start with the basics! The general categories are items for the skin and colors for the lips, cheeks, and eyelids.&lt;&lt;/hyssop&gt;&gt;

    ?Hyssop indicates each of these categories on the table. It seems that each item comes in a variety of forms, from powder to cream, and also in a varieties of colors and shades. You notice that one collection of pots in particular includes more unique shades of blue, green, and purple.

    &lt;&lt;player&gt;&gt;What are those for?&lt;&lt;/player&gt;&gt;

    ?Hyssop looks at you excitedly.

    &lt;&lt;hyssop&gt;&gt;Oh, these are for the eyes! I find they&#39;re the most fun to play around with.&lt;&lt;/hyssop&gt;&gt;

    Even though you have a better idea of what all the items in front of you are for, you still have no idea how to use them.

    &lt;&lt;player&gt;&gt;Could you...apply some of this on me?&lt;&lt;/player&gt;&gt;

    &lt;&lt;hyssop&gt;&gt;I would love nothing more!&lt;&lt;/hyssop&gt;&gt;

    ?Hyssop almost vibrates with excitement as they peruse their collection, pulling out a small selection of items. They begin to apply them on your face, explaining how they made each item from a variety of forest plants.?nl

    The experience is oddly relaxing, drinking tea as ?Hyssop gently does your makeup. Eventually they hold up a mirror, and you see in your reflection that your skin looks just a little more even, your lips and cheeks are just a touch more vibrant red, and there is a slight brown shimmer on your eyelids.

    &lt;&lt;hyssop&gt;&gt;How do you like it?&lt;&lt;/hyssop&gt;&gt;

    &lt;&lt;player&gt;&gt;Oh, wow... You&#39;re really good at this, ?Hyssop!&lt;&lt;/player&gt;&gt;

    ?Hyssop beams at the compliment. You&#39;re not lying, either: ?Hyssop has artfully accentuated your features without making you look too different from yourself.

    &lt;&lt;hyssop&gt;&gt;I&#39;m so glad you&#39;re happy with it! I think you look really pretty.&lt;&lt;/hyssop&gt;&gt;

    You already feel you&#39;ve learned a lot today, even though you haven&#39;t tried applying any makeup yourself yet. After chatting with ?Hyssop a bit longer, you take your leave for the day, already excited to return for your next lesson.
&lt;&lt;then&gt;&gt;
    &lt;&lt;hyssop&gt;&gt;I thought today you could try applying some of the makeup yourself!&lt;&lt;/hyssop&gt;&gt;

    Though the array of items on the table remains daunting, you figure you have little to lose if you just follow ?Hyssop&#39;s instructions.

    &lt;&lt;player&gt;&gt;Okay... Can you show me how?&lt;&lt;/player&gt;&gt;

    &lt;&lt;hyssop&gt;&gt;Of course! Let&#39;s start easy, with some powder.&lt;&lt;/hyssop&gt;&gt;

    ?Hyssop guides you through applying the various items to create a similar appearance to the look they gave you during your first makeup lesson. Your own efforts certainly come across more heavy-handed than ?Hyssop&#39;s, but you&#39;re surprised by how pleasant the result is.?nl

    By the time you finish the look, ?Hyssop beams at you proudly.

    &lt;&lt;hyssop&gt;&gt;You&#39;re really getting the hang of this! Maybe next time you could try a more exciting look, with some of those brighter colors!&lt;&lt;/hyssop&gt;&gt;

    &lt;&lt;player&gt;&gt;Okay, that could be fun!&lt;&lt;/player&gt;&gt;

    Feeling proud of your work, you bid farewell to ?Hyssop, looking forward to your next lesson.
&lt;&lt;finally&gt;&gt;
    &lt;&lt;hyssop&gt;&gt;Would you like to try some of the fun colors today?&lt;&lt;/hyssop&gt;&gt;

    &lt;&lt;player&gt;&gt;Yes! Can you help me pick a nice combination?&lt;&lt;/player&gt;&gt;

    &lt;&lt;hyssop&gt;&gt;Of course! I think this blue would look lovely with this pink here...&lt;&lt;/hyssop&gt;&gt;

    With ?Hyssop&#39;s help, you slowly apply a makeup look with much bolder colors than before. Your hand seems to be improving and the result looks much more refined than last time, though the strong colors on your face will take some getting used to. 

    &lt;&lt;hyssop&gt;&gt;Wow, I love how that turned out! Those colors look so good on you!&lt;&lt;/hyssop&gt;&gt;

    &lt;&lt;player&gt;&gt;You think so?&lt;&lt;/player&gt;&gt;

    &lt;&lt;hyssop&gt;&gt;Yes! But to be honest, the most important part of any look, makeup or not, is that you feel good!&lt;&lt;/hyssop&gt;&gt;

    You allow yourself a small smile at your reflection in the mirror. You&#39;re not sure yet if this is something you&#39;ll want to do every day, but it does feel good to have fun with your appearance.?nl 
    
    Feeling as though you&#39;re finally getting the hang of this makeup thing, you thank ?Hyssop for their help and head back into the forest.
&lt;&lt;/first&gt;&gt;

&lt;&lt;include &#39;Hyssop Princess Training End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="136" name="Hyssop Princess Training 3" tags="" position="725,1725" size="100,100">You enter the hut and find ?Hyssop working at their dress form. They seem to be making progress on an elaborate gown constructed of a silky royal blue material. 

&lt;&lt;hyssop&gt;&gt;Oh! ?Greeting, Princess! Back for another lesson?&lt;&lt;/hyssop&gt;&gt;

?Hyssop rushes over and wraps you in a warm embrace. They stand back, grinning excitedly at you.

&lt;&lt;player&gt;&gt;Yes! What will we work on today?&lt;&lt;/player&gt;&gt;

?Hyssop seems to almost vibrate with excitement.

&lt;&lt;hyssop&gt;&gt;I thought today we could work on one of my favorite pastimes of all: fashion!&lt;&lt;/hyssop&gt;&gt;

&lt;&lt;first&gt;&gt;
    They stand aside, sweeping out their arms dramatically to indicate a rack stuffed with items of clothing in a wide variety of colors and styles. 

    &lt;&lt;player&gt;&gt;You have some very fun clothes!&lt;&lt;/player&gt;&gt;

    &lt;&lt;hyssop&gt;&gt;Thank you! Would you like to try some on?&lt;&lt;/hyssop&gt;&gt;

    It feels a bit funny to try on someone else&#39;s clothes, but you have to admit that many of the garments are intriguing you.

    &lt;&lt;player&gt;&gt;Okay, sure, that sounds fun!&lt;&lt;/player&gt;&gt;

    ?Hyssop pulls out several outfits. You see dresses in a rainbow of colors, some accented with embroidery and others with ruffles or intricate beadwork. You also see a selection of suits in equally interesting colors and finishing details, as well as a few garments that seem to be somewhere in between. 

    &lt;&lt;hyssop&gt;&gt;All of these are fit for a princess! Why don&#39;t you try them on and see what you like best?&lt;&lt;/hyssop&gt;&gt;

    You take the clothes behind a screen and try them on one by one, emerging each time to show ?Hyssop how you look. Each time they cheer excitedly, apparently equally thrilled by every look.

    &lt;&lt;hyssop&gt;&gt;Wow, you looked amazing in all of those outfits!&lt;&lt;/hyssop&gt;&gt;

    You grin, feeling the warmth of ?Hyssop&#39;s unconditional support. You don&#39;t feel fully confident yet, but you definitely liked how you looked in several of the garments.

    &lt;&lt;player&gt;&gt;I&#39;m sure it&#39;ll take more time to figure out my sense of fashion, but that was really fun!&lt;&lt;/player&gt;&gt;
&lt;&lt;then&gt;&gt;
    You watch as ?Hyssop pulls out a large basket filled with cloth scraps in a variety of colors and textures.

    &lt;&lt;hyssop&gt;&gt;Let&#39;s take a more academic look at the topic today!&lt;&lt;/hyssop&gt;&gt;

    Secretly, you&#39;re a little disappointed that you apparently won&#39;t be trying on more clothes. Still, ?Hyssop&#39;s words leave you intrigued.

    &lt;&lt;player&gt;&gt;Academic? What do you mean?&lt;&lt;/player&gt;&gt;

    ?Hyssop beckons you to sit down and lays out a selection of fabric scraps for your perusal.

    &lt;&lt;hyssop&gt;&gt;There are many aspects of fashion design that help to describe the final appearance of a garment! Some of the most basic are form, line, color, and texture.&lt;&lt;/hyssop&gt;&gt;

    Though you immediately feel lost, ?Hyssop guides you through each of the concepts, using the fabric scraps as examples. Quite some time passes as they go into great detail on each topic. Finally, you feel you have to interrupt.

    &lt;&lt;player&gt;&gt;This is all quite interesting, ?Hyssop, but why will this help me become a princess?&lt;&lt;/player&gt;&gt;

    &lt;&lt;hyssop&gt;&gt;Ah, yes, excellent question! Your selection of garments conveys messages to others. Every tiny detail of an outfit can help convey a certain mood, send hidden messages, signify social status or wealth. They can even convey whether you are looking for a partner!&lt;&lt;/hyssop&gt;&gt;

    Here, ?Hyssop chuckles, waggling their eyebrows at you. You feel yourself blush. 
    
    &lt;&lt;player&gt;&gt;Oh- um, how can they do that?&lt;&lt;/player&gt;&gt;

    They immediately launch back into another highly detailed explanation. By the time ?Hyssop declares you&#39;re done with the lesson for the day, you truly feel as though you&#39;ve learned a lot.?nl
&lt;&lt;finally&gt;&gt;
    They pour you a cup of tea and invite you to sit in a comfortable chair as they pull a beautiful dress from their collection and hang it on display.

    &lt;&lt;hyssop&gt;&gt;Today I thought you could practice applying what you have learned! Let&#39;s work together to analyze the design of this dress, and the implicit messages it might send to others.&lt;&lt;/hyssop&gt;&gt;

    Fascinated by this exercise, you sip your tea and answer ?Hyssop&#39;s prompts to think about not only the intentional design of the dress, but what wearing might convey in various social contexts.?nl

    Eventually, it seems you have both said as much as you can about the dress. ?Hyssop puts it away carefully, a look of pride on their face.

    &lt;&lt;hyssop&gt;&gt;I&#39;m so happy with how much you&#39;ve already learned! You seem to have a real knack for this topic.&lt;&lt;/hyssop&gt;&gt;

    You feel proud of yourself, too. After chatting a bit longer, you feel it&#39;s time to leave.
&lt;&lt;/first&gt;&gt;

You thank ?Hyssop for their time and return to the forest.

&lt;&lt;include &#39;Hyssop Princess Training End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="137" name="Kathryn" tags="" position="850,1725" size="100,100">&lt;&lt;if $location is &#39;Garden&#39;&gt;&gt;
    &lt;&lt;if getTime() is &#39;night&#39;&gt;&gt;
        &lt;&lt;decision &#39;You spot ?Kathryn fooling around together with some noble&#39; &#39;Kathryn Peeking&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;elseif $location is &#39;Dining hall&#39;&gt;&gt;
    &lt;&lt;if !hasCounter(&#39;kathryn-dinner-party&#39;)&gt;&gt;
        &lt;&lt;if getTime() is &#39;evening&#39;&gt;&gt;
            &lt;&lt;decision &#39;?Kathryn seems to be hosting a dinner party in the hall right now&#39; &#39;Kathryn Dinner Party&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;if questStep(&#39;kathryn-chastity-week&#39;) is 8&gt;&gt;
                &lt;&lt;decision &#39;Tell ?Kathryn you completed the week of chastity&#39; &#39;Kathryn Chastity Week Complete&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
            &lt;&lt;/if&gt;&gt;
            &lt;&lt;if getTime() is &#39;noon&#39; and hasQuest(&#39;kathryn-chastity-excursion&#39;)&gt;&gt;
                &lt;&lt;decision &#39;Tell ?Kathryn you are ready for the excursion&#39; &#39;Kathryn Smithy Excursion 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
            &lt;&lt;/if&gt;&gt;
            &lt;&lt;decision &#39;You see ?Kathryn preparing the dining hall for an event&#39; &#39;Kathryn Dinner Preparation&#39;&gt;&gt;
                &lt;&lt;disableif hasQuest(&#39;kathryn-dinner-invitation&#39;)&gt;&gt;
                    I should not bother ?Kathryn any more before the dinner starts...
            &lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;if isInChastity()&gt;&gt;
        &lt;&lt;decision &#39;Ask ?Kathryn to be unlocked from chastity&#39; &#39;Kathryn Chastity Unlock&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="138" name="Kathryn Acknowledgement" tags="" position="975,1725" size="100,100">&lt;&lt;acknowledgement Kathryn&gt;&gt;
    &lt;&lt;mention assassination&gt;&gt;
        ?Kathryn suddenly looks at you with probably the most sincere expression she has ever given you as she lowers her voice.
        &lt;&lt;kathryn&gt;&gt;In full sincerity, I&#39;m glad to see you survived that bloody assassin. If ?Sybille would allow it, I would take revenge on him in the dungeon right now. Nobody touches my little prince.&lt;&lt;/kathryn&gt;&gt;
        &lt;&lt;player&gt;&gt;That&#39;s, well... Thanks, ?Kathryn. That&#39;s strangely sweet.&lt;&lt;/player&gt;&gt;
        It&#39;s strange seeing her be this honest with you. You almost want to comment on it before you see her nod, signaling the end to her to her caring attitude.
    &lt;&lt;mention status&gt;&gt;
        &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
            She stops and squints slightly as she looks you up and down.
            &lt;&lt;kathryn&gt;&gt;Look at you, ?titleK. So soft and delicate. Have you really become a princess, or are you just a boy pretending to be one?&lt;&lt;/kathryn&gt;&gt;
            You ignore her, but her words sting.
            &lt;&lt;kathryn&gt;&gt;That&#39;s okay. I don&#39;t mind. In fact, I kind of like it. You&#39;re a bit prettier than before. Maybe you&#39;ll start to catch some attention.&lt;&lt;/kathryn&gt;&gt;
            She smirks, and you try to push down the embarrassment and shame that her words bring.
        &lt;&lt;elseif face() is &#39;andro&#39;&gt;&gt;
            She stops and squints slightly as she looks you up and down.
            &lt;&lt;kathryn&gt;&gt;Are you... Looking even more feminine?&lt;&lt;/kathryn&gt;&gt;
            She gets a mischievous smile as she sees you blush and cuts you off before you can utter a response.
            &lt;&lt;kathryn&gt;&gt;Oh my god, so it&#39;s really true isn&#39;t it, you&#39;re turning into a little sissy princess!&lt;&lt;/kathryn&gt;&gt;
            You try to argue back but she just starts full on laughing at you.
            &lt;&lt;kathryn&gt;&gt;That is is just too good to be true! ?Morgana is actually turning you into a sissy! What are you going to do wear a pink sissy dress tomorrow?&lt;&lt;/kathryn&gt;&gt;
            &lt;&lt;player&gt;&gt;No! Stop it! It&#39;s not true!&lt;&lt;/player&gt;&gt;
            You try to make her stop but she&#39;s not believing you for a second. It takes a full minute for her to stop laughing at you.
            &lt;&lt;kathryn&gt;&gt;Hahahaha! Oh... That&#39;s just golden. I can&#39;t believe you used to call yourself a man... Pathetic.&lt;&lt;/kathryn&gt;&gt;
            She has to wipe a tear from her eyes from laughing too much.
        &lt;&lt;elseif face() is &#39;fem&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;man&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;mention chastity&gt;&gt;
        You see her eyes peeking down towards your crotch area and a sly smile appear on her face. You stare at her in confusion as she lets out a slight laugh and whispers to you.
        &lt;&lt;kathryn&gt;&gt;So how does the cage feel, ?titleK? It&#39;s probably quite frustrating to have that ?dick of yours locked up like that...&lt;&lt;/kathryn&gt;&gt;
        You instantly starts blushing as you can&#39;t believe she&#39;s mentioning this to you while you&#39;re in public. You&#39;re not quite sure what to do so you very awkwardly try to change the subject. Luckily, probably because she has achieved her bullying, ?Kathryn decides to let you ignore the situation.
    &lt;&lt;mention kathryn-peeking&gt;&gt;
        &lt;&lt;if isInChastity()&gt;&gt;
            She looks at you with a very angry grimace. She&#39;s probably still mad about how you&#39;ve been peeking on her. Luckily she seems to not want to chastise you in front of other people so she chooses to be silent about it here. You choose to do the same.
        &lt;&lt;else&gt;&gt;
            She looks at you with a quick grimace before it turns into a sly smile as she looks down towards your crotch. It seems like she&#39;s less annoyed with you peeking on her now that you&#39;re being properly punished for it. You blush under her gaze.
        &lt;&lt;/if&gt;&gt;
&lt;&lt;/acknowledgement&gt;&gt;</tw-passagedata><tw-passagedata pid="139" name="Kathryn Dinner Preparation" tags="" position="1100,1725" size="100,100">&lt;&lt;generatenoble&gt;&gt;
&lt;&lt;changeschedule kathryn &#39;night&#39; &#39;Garden&#39;&gt;&gt;
&lt;&lt;first&gt;&gt;
    You walk into the grand dining hall and see ?Kathryn preparing it for an event. You see her talking to ?ChefPepper, the man she always hires to cook for her dinner parties.
    &lt;&lt;kathryn&gt;&gt;Perhaps that marvelous &lt;&lt;dish&gt;&gt; you made recently would be a good option for tonight?&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;pepper&gt;&gt;Oh my, I&#39;m glad to hear you liked it, &lt;&lt;fullname kathryn&gt;&gt;, but I must insist on cooking something different for your gathering this evening. I strive to always adapt my dishes whenever possible.&lt;&lt;/pepper&gt;&gt;
    She smiles at the chef, probably knowing she won&#39;t be disappointed.
    &lt;&lt;kathryn&gt;&gt;Very well, I suppose. I&#39;m looking forward to it, ?ChefPepper.&lt;&lt;/kathryn&gt;&gt;
    ?ChefPepper bows to ?Kathryn and starts exiting the dining hall, probably to get started on the cooking. He walks past you and gives you a smile with a respectful nod. You walk up to ?Kathryn to address her.
    &lt;&lt;include &#39;Kathryn Dinner Preparation Check In&#39;&gt;&gt;
&lt;&lt;finally&gt;&gt;
    You walk into the grand dining hall and you see ?Kathryn giving orders to servants in quick succession. You see one of them run over with the finest silver cutlery of the castle, ?Kathryn then gives the servant clear instructions on how to best lay them in a pleasing order. She&#39;s always been a micromanager.?nl

    &lt;&lt;kathryn&gt;&gt;Oh hello there, ?title.&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;include &#39;Kathryn Acknowledgement&#39;&gt;&gt;
    &lt;&lt;if questStep(&#39;princess-lessons-intro&#39;) is 4&gt;&gt;
        &lt;&lt;decision &#39;Quietly discuss your new lessons with ?Kathryn&#39; &#39;Kathryn Princess Training Intro&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;if hasQuest(&#39;princess-lessons&#39;) and !hasCounter(&#39;kathryn-training&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Tell her you are here for a training session&#39;&gt;&gt;
            &lt;&lt;include &#39;Kathryn Princess Training&#39;&gt;&gt;
            &lt;&lt;decisionicon etiquette&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;decision &#39;Check in with her&#39; &#39;Kathryn Dinner Preparation Check In&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Try to get an invitation to her dinner party&#39; &#39;Kathryn Dinner Preparation Ask Invitation&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;if isInChastity()&gt;&gt;
        &lt;&lt;decision &#39;Ask to be unlocked from chastity&#39; &#39;Kathryn Chastity Unlock&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/first&gt;&gt;</tw-passagedata><tw-passagedata pid="140" name="Kathryn Dinner Preparation Check In" tags="" position="1225,1725" size="100,100">&lt;&lt;addcounter &#39;kathryn-dinner-party&#39; 1&gt;&gt;
&lt;&lt;player&gt;&gt;What are you preparing the dining hall for?&lt;&lt;/player&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Well, what does it look like? I&#39;m putting together a small dinner party for a delegation coming to visit me.&lt;&lt;/kathryn&gt;&gt;
She gives you a quick answer before going back to &#39;managing&#39; the servants.
&lt;&lt;player&gt;&gt;Oh I was not aware of this, anyone of note coming over?&lt;&lt;/player&gt;&gt;
?Kathryn sighs and turns to you, giving you her full attention now.
&lt;&lt;kathryn&gt;&gt;Anyone of note? Of course they&#39;re of note! Even &lt;&lt;noble&gt;&gt; is coming to visit.&lt;&lt;/kathryn&gt;&gt;
You stare at her with a dumbfounded expression. Are you supposed to know who that is?
&lt;&lt;player&gt;&gt;I&#39;ve never heard of him.&lt;&lt;/player&gt;&gt;
She now looks even more agitated.
&lt;&lt;kathryn&gt;&gt;And this exactly why you were not invited, I don&#39;t want you to embarrass me in front of my guests. Now run along ?titleK, I&#39;m far too busy to keep chatting.&lt;&lt;/kathryn&gt;&gt;
Even though she&#39;s far too degrading towards you, you never really liked to attend any royal dinner parties so you are more than happy to not join her this evening.
&lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="141" name="Kathryn Dinner Preparation Ask Invitation" tags="" position="100,1850" size="100,100">&lt;&lt;player&gt;&gt;Another dinner party, ?Kathryn? Always quite the hostess.&lt;&lt;/player&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Well, the duties of a courtly lady are never done, ?titleK. I must always be prepared to entertain guests and keep up appearances. It&#39;s a burden, but one I bear with grace.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;player&gt;&gt;Indeed you do...&lt;&lt;/player&gt;&gt;
You trail off, recalling the many times you&#39;ve seen her hosting events like this. You&#39;re frankly impressed by her ability to keep up with it all.?nl
She gently snaps her fingers in front of your face, bringing you back to the present.
&lt;&lt;player&gt;&gt;Ah, sorry, I was lost in thought. I was intending to beg an invitation to tonight&#39;s dinner, if you&#39;d have me?&lt;&lt;/player&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Oh...&lt;&lt;/kathryn&gt;&gt;
You see her carefully thinking over her next words.
&lt;&lt;if hasRead(&#39;dinner-etiquette&#39;)&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;The dinner party mostly consists of people far below your status. Why, &lt;&lt;noble&gt;&gt; will be the only landed noble tonight...&lt;&lt;/kathryn&gt;&gt;
    She notices your face fall in disappointment, and appears to think for a moment.
    &lt;&lt;kathryn&gt;&gt;Perhaps a brief appearance instead? You could greet the guests and then retire to your chambers. It would be a good show of respect - something to let them buzz about to their acquaintances. Besides which, you&#39;d give me a reprieve from their constant attention... Would that interest you?&lt;&lt;/kathryn&gt;&gt;
    You fail to contain a smile as you nod in agreement, happy to finally garner some approval from her - time to put your book learning into practice.
    &lt;&lt;kathryn&gt;&gt;Good, now I must get back to my preparations. See you tonight, ?titleK!&lt;&lt;/kathryn&gt;&gt;
    She turns back to the servants, but stops and looks back with a final remark.
    &lt;&lt;kathryn&gt;&gt;And do try to be on your best behavior, won&#39;t you? I&#39;d hate to have to scold you in front of my guests. If you don&#39;t feel up to it, you don&#39;t have to attend, I&#39;ll manage on my own.&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;Accommodating as always, ?Kathryn. Amazing that you can be so considerate to me and yet still make the lesser nobles squirm with a mere look!&lt;&lt;/player&gt;&gt;
    You say with a smile, eliciting an actual laugh from her.
    &lt;&lt;player&gt;&gt;Thank you for the invitation, and good luck as always.&lt;&lt;/player&gt;&gt;
    You swear you see a twinkle in her eye as she turns back to her work.
    &lt;&lt;startquest &#39;kathryn-dinner-invitation&#39;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;addcounter &#39;kathryn-dinner-party&#39; 1&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;I&#39;m afraid it wouldn&#39;t be proper for your royal highness to partake with such lowly attendees. Why, &lt;&lt;noble&gt;&gt; will be the only landed noble tonight...&lt;&lt;/kathryn&gt;&gt;
    You look at her, disappointed with pleading eyes.
    &lt;&lt;player&gt;&gt;But I don&#39;t mind, ?Kathryn, I&#39;d still be happy to join!&lt;&lt;/player&gt;&gt;
    She looks at you uncomfortably and sighs loudly.
    &lt;&lt;kathryn&gt;&gt;Ugh well you see, ?titleK, I must admit that every time I have sat close to you during dinner parties in the past I was always quite... surprised by your etiquette.&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Or, well, lack thereof, I should say.&lt;&lt;/kathryn&gt;&gt;
    You look at her quite surprised.
    &lt;&lt;player&gt;&gt;A- Are you saying I&#39;m not proper enough?&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Well uhm- don&#39;t take this personally, ?title, but I do think you lack the mannerism for a fancy dinner like this, I do want to uphold a certain level of class.&lt;&lt;/kathryn&gt;&gt;
    Her plainness is quite hurtful.
    &lt;&lt;kathryn&gt;&gt;Perhaps you could become better acquainted with dinner manners by first - I don&#39;t know - reading a book about it in the library or something?&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;Uhm- Okay, well, have fun with the dinner party...&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Sorry, ?title. Perhaps you&#39;ll be better suited next time.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="142" name="Kathryn Dinner Party" tags="" position="225,1850" size="100,100">&lt;&lt;addcounter &#39;kathryn-dinner-party&#39; 1&gt;&gt;
&lt;&lt;if hasQuest(&#39;kathryn-dinner-invitation&#39;)&gt;&gt;
    &lt;&lt;completequest &#39;kathryn-dinner-invitation&#39;&gt;&gt;
    You walk into the grand dining hall as the steward announces your presence. At the head of the table sits ?Kathryn, who pauses her conversation with the nobleman sitting next to her. She rises with the crowd, somehow more graceful than everyone else, standing out of respect for your arrival.
    &lt;&lt;kathryn&gt;&gt;Oh. ?Title, how nice of you to join us.&lt;&lt;/kathryn&gt;&gt;
    You bow slightly towards ?Kathryn, before starting towards the head of the table. You scan the room, recalling heraldry and symbols that mark the higher born of the attendees. You make it a point to acknowledge those highest ranking guests as you make your way to ?Kathryn.?nl
    As you approach her, she gives you a warm smile and a nod of approval, and the other nobles reclaim their seats. You catch the eye of the nobleman next to her and address him directly with a polite greeting.
    &lt;&lt;player&gt;&gt;&lt;&lt;noble&gt;&gt;, what a pleasure to have you in attendance. I trust your journey was not too arduous?&lt;&lt;/player&gt;&gt;
    &lt;&lt;say `getNoble()`&gt;&gt;The pleasure is all mine, ?title, and I must complement the quality of your roads here - never has a carriage ride passed so pleasantly.&lt;&lt;/say&gt;&gt;
    You share a brief laugh with the nobleman before turning your attention back to the rest of the room.
    &lt;&lt;player&gt;&gt;I am sure everyone is enjoying the dinner party hosted by our marvelous &lt;&lt;fullname kathryn&gt;&gt;.&lt;&lt;/player&gt;&gt;
    A few of the guests nod in agreement, and ?Kathryn gives a small curtsy in thanks.
    &lt;&lt;kathryn&gt;&gt;I thank you, ?title. But the honour is not all mine, we have ?ChefPepper to thank for the brilliant cooking tonight.&lt;&lt;/kathryn&gt;&gt;
    She gestures over to ?ChefPepper as he&#39;s currently carrying a large silver tray to the central table and puts it down.
    &lt;&lt;pepper&gt;&gt;Much appreciated, &lt;&lt;fullname kathryn&gt;&gt;. Might I take this opportunity to present the next course: &lt;&lt;dish&gt;&gt;.&lt;&lt;/pepper&gt;&gt;
    ?ChefPepper lifts the silver cover from the tray, revealing the main course, which elicits an applause from the gathering.
    &lt;&lt;say `getNoble()`&gt;&gt;Marvelous, it looks delicious! Will you be joining us for dinner, ?title?&lt;&lt;/say&gt;&gt;
    &lt;&lt;player&gt;&gt;I have other matters to attend, so I must eschew dinner tonight, I simply wanted to drop by and welcome you all here tonight.&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Oh, ?title, that&#39;s quite alright. We understand the burdens of your station. Thank you for gracing us, even if only for a moment.&lt;&lt;/kathryn&gt;&gt;
    With that, she raises a glass in toast of your health and you take your leave, the guests returning to their meals and conversation as you exit the dining hall.
    &lt;&lt;decision &#39;Return to the hallway&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;generatenoble&gt;&gt;
    &lt;&lt;changeschedule kathryn &#39;night&#39; &#39;Garden&#39;&gt;&gt;
    You walk into the grand dining hall and you immediately see the large table set for a small dinner party. At the head of the table sits ?Kathryn, she looks very interested in some nobleman that&#39;s sitting next to her. The moment she notices you, her charming demeanor instantly stops.
    &lt;&lt;kathryn&gt;&gt;Oh. &lt;&lt;fullname player&gt;&gt;. How nice of you to join us.&lt;&lt;/kathryn&gt;&gt;
    You can definitely feel ?Kathryn&#39;s frustration for barging in on her dinner party but you suppose there&#39;s no turning back now and take it as your que to walk closer as the entire table greets you. You seem to have interrupted the gregarious atmosphere but some servants quickly make room for you and pull up a chair so you can join the table.
    &lt;&lt;player&gt;&gt;I did not know you were hosting a dinner party this evening, ?Kathryn.&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Ah, I must have forgotten to inform you, ?title. It&#39;s a dinner hosted for our friends here. I assume you have heard of &lt;&lt;noble&gt;&gt;?&lt;&lt;/kathryn&gt;&gt;
    The man sitting next to ?Kathryn gives you a respectful nod. You have never heard of this man before in your life.
    &lt;&lt;player&gt;&gt;I can&#39;t say that I have, it&#39;s nice to meet you, &lt;&lt;noble&gt;&gt;.&lt;&lt;/player&gt;&gt;
    &lt;&lt;say `getNoble()`&gt;&gt;The pleasure is all mine, ?title.&lt;&lt;/say&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;We were just discussing the finer points of court etiquette. Perhaps you could enlighten us with your thoughts?&lt;&lt;/kathryn&gt;&gt;

    You take a seat, feeling a bit uneasy under ?Kathryn&#39;s watchful gaze. The conversation continues, with Kathryn directing subtle barbs in your direction.
    &lt;&lt;kathryn&gt;&gt;It&#39;s fascinating how etiquette varies from court to court, isn&#39;t it, &lt;&lt;noble&gt;&gt;? For instance, our dear prince here has such... unique interpretations of protocol. Don&#39;t you agree, ?title?&lt;&lt;/kathryn&gt;&gt;
    You notice a faint smirk playing on ?Kathryn&#39;s lips, though she maintains her ladylike demeanor.

    &lt;&lt;player&gt;&gt;Uhm, yes, I suppose it&#39;s always a learning experience.&lt;&lt;/player&gt;&gt;

    &lt;&lt;kathryn&gt;&gt;Oh, absolutely. One must always strive to improve. Like remembering to bow to the host before sitting at a table, for example. A small detail, but so important. Don&#39;t you think, &lt;&lt;noble&gt;&gt;?&lt;&lt;/kathryn&gt;&gt;

    &lt;&lt;say `getNoble()`&gt;&gt;Indeed, &lt;&lt;fullname kathryn&gt;&gt;. Such details reflect one&#39;s respect and upbringing.&lt;&lt;/say&gt;&gt;
    You realize ?Kathryn is subtly pointing out that you did not bow to her before you sat down at the table.
    &lt;&lt;player&gt;&gt;You are quite right, ?Kathryn. It&#39;s a custom I shall remember.&lt;&lt;/player&gt;&gt;

    &lt;&lt;kathryn&gt;&gt;I&#39;m sure you will, ?title. After all, we all have our little lapses now and then. It&#39;s what makes us human.&lt;&lt;/kathryn&gt;&gt;

    The rest of the dinner continues in a similar fashion, with ?Kathryn deftly steering the conversation to highlight your perceived shortcomings while maintaining her charming facade for &lt;&lt;noble&gt;&gt;. After quite some time the guests start to leave the table as the dinner comes to a conclusion. ?Kathryn has been staring at you with a slight grimace for a while, it seems like she is annoyed with your lack of decorum during the dinner, oh well, you don&#39;t care about that much anyways. She pulls you apart for moment and talks to you in a hushed tone.
    &lt;&lt;kathryn&gt;&gt;Perhaps next time you could ask me first before barging in on my dinner party...&lt;&lt;/kathryn&gt;&gt;

    You nod to her, understanding her annoyance. You find the right moment to thank the other guests for their company any take your leave out of the dining hall.

    &lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="143" name="Kathryn Chastity Unlock" tags="" position="350,1850" size="100,100">&lt;&lt;if getTime() is &#39;evening&#39;&gt;&gt;
    You walk into the grand dining hall as ?Kathryn is hosting a dinner party. Having to ask this while she&#39;s having guests over is going to be quite humiliating.?nl
    She notices you enter and she immediately takes a moment you announce you to the entire room, loudly.
    &lt;&lt;kathryn&gt;&gt;Ah, look like our Royal ?Prince has blessed us with his presence! Welcome, ?title!&lt;&lt;/kathryn&gt;&gt;
    You awkwardly wave at the gathering before hurriedly making your way to ?Kathryn&#39;s side.
    &lt;&lt;player&gt;&gt;Uhm, thank you, ?Kathryn? Would it be possible to talk to you?... Privately?&lt;&lt;/player&gt;&gt;
    She has a knowing smirk on her face as she looks to you.
    &lt;&lt;kathryn&gt;&gt;Oh, in the middle of my dinner party, ?title? Can&#39;t it wait? What&#39;s so important that I&#39;d have to excuse myself?&lt;&lt;/kathryn&gt;&gt;
    You awkwardly look at the floor, knowing full well she&#39;s playing with you and wants you to admit why you&#39;re here before she helps you.
    &lt;&lt;player&gt;&gt;C- Could you... perhaps... u- unlock me from my... confinement...&lt;&lt;/player&gt;&gt;
    She gives you an even bigger, satisfied smirk as she gives you the decency of whispering this next part to you.
    &lt;&lt;kathryn&gt;&gt;Ah- You need your keyholder to let your ?penis of of your little cage then... I&#39;m sure that can be arranged...&lt;&lt;/kathryn&gt;&gt;
    You almost die of humiliation, hoping none of the other attendees heard her. She suddenly stands up and addresses the room.
    &lt;&lt;kathryn&gt;&gt;Esteemed guests, I&#39;m afraid I must excuse myself for a moment. The ?Prince requires me for a &lt;em&gt;private&lt;/em&gt; matter.&lt;&lt;/kathryn&gt;&gt;
    She guides you out of the dining hall, making you very happy to be out of that situation.

    &lt;&lt;decision &#39;Follow her&#39; &#39;Kathryn Chastity Unlock Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;elseif getTime() is &#39;night&#39;&gt;&gt;
    Even though ?Kathryn is currently spending some alone time with a nobleman, you really want to get out of your cage right now so you decide to just confront her right now. You sneak over towards the gazebo where they are currently getting intimate on a bench together.?nl
    You see the two of them making out quite intensely and you decide to simply stand there and awkwardly clear your throat to get ?Kathryn&#39;s attention. She looks up at you, her eyes full of lust. She&#39;s surprisingly unbothered by you disturbing them. 
    &lt;&lt;kathryn&gt;&gt;Oh hello, ?titleK. Do you need something?&lt;&lt;/kathryn&gt;&gt;
    ?Kathryn&#39;s companion is obviously more startled by your intrusion than she is, but she quickly quiets him.
    &lt;&lt;kathryn&gt;&gt;The ?Prince is just coming for a visit. Why don&#39;t you continue what you were doing earlier while I chat with ?him?&lt;&lt;/kathryn&gt;&gt;
    The confused nobleman looks at you and then back at ?Kathryn. Completely wrapped in the moment, he goes along with the strange request and you are surprised to see him move himself downwards as he places his mouth on ?Kathryn&#39;s eager pussy. She immediately moans loudly as she looks at you.
    &lt;&lt;kathryn&gt;&gt;Ah! Just... like that... Now, what can I help you with ?titleK?&lt;&lt;/kathryn&gt;&gt;
    You awkwardly walk a bit closer as you consider how to phrase this question.
    &lt;&lt;player&gt;&gt;Uhm, I was wondering if you could maybe... unlock me...&lt;&lt;/player&gt;&gt;
    She moans louder as she grabs the nobleman&#39;s hair while he&#39;s deftly using his tongue to pleasure her.
    &lt;&lt;kathryn&gt;&gt;Oh fuck! Wait- ?TitleK, you came here because you need me to unlock your ?penis from it&#39;s pathetic cage?&lt;&lt;/kathryn&gt;&gt;
    Where you chose to talk quietly and leave much of the question to implication, she chooses to do the exact opposite. The nobleman lets out a confused grunt and intends to release himself from her snatch after that remark but ?Kathryn shushes him again and motions from him to simply focus on his task at hand.
    &lt;&lt;player&gt;&gt;Uhm... Yes... I need you to unlock my chastity cage...&lt;&lt;/player&gt;&gt;
    You stare at the floor, full of humiliation as ?Kathryn lets out a mix of moans and laughs, the latter probably because of you.
    &lt;&lt;kathryn&gt;&gt;Ah... Well, as you can see, I&#39;m quite busy right now, ?titleK... But perhaps I could come to your bedroom in a bit, after we&#39;re done here... It might take a while though...&lt;&lt;/kathryn&gt;&gt;
    You look at her, strangely gratefully and agree to her suggestion.
    &lt;&lt;player&gt;&gt;O- Okay, I&#39;ll wait for you... Uhm- Have fun.&lt;&lt;/player&gt;&gt;
    She doesn&#39;t even respond as you walk away from them. As you move back to the castle you can still hear her moans as she&#39;s vigorously being eaten out.

    &lt;&lt;decision &#39;Wait in your bedroom for her to finish having sex&#39; &#39;Kathryn Chastity Unlock Bedroom Wait&#39;&gt;&gt;&lt;&lt;addstat submissiveness small&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    You walk up to ?Kathryn as she&#39;s busy and carefully approach her.
    &lt;&lt;player&gt;&gt;?Kathryn? Can I talk to you?... Privately?&lt;&lt;/player&gt;&gt;
    She turns around to face you with a smirk.
    &lt;&lt;kathryn&gt;&gt;What? No, can&#39;t you see I&#39;m busy? I&#39;m preparing for a dinner party. If you need to discuss something we can do that right here.&lt;&lt;/kathryn&gt;&gt;
    Before you respond she shouts a few more commands to the servants setting up the room. You try to whisper to her in the rowdy room.
    &lt;&lt;player&gt;&gt;Can you please... Unlock me?&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;What? ?titleK, it&#39;s very loud in here, you&#39;re going to have to speak up.&lt;&lt;/kathryn&gt;&gt;
    You look at her angrily as she&#39;s clearly bullying you. You really need your dick free right now so you decide to just go along with it.
    &lt;&lt;player&gt;&gt;Can you please unlock my chastity cage?!&lt;&lt;/player&gt;&gt;
    She looks at you contentedly, you&#39;re not sure if anyone here heard but she definitely did. She leans closer to you, whispering now.
    &lt;&lt;kathryn&gt;&gt;Ah you want me to unlock the cage of your ?dick? Why didn&#39;t you say so... Here, let&#39;s excuse ourselves for now.&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;decision &#39;Follow her&#39; &#39;Kathryn Chastity Unlock Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="144" name="Kathryn Chastity Unlock Bedroom Wait" tags="spicy" position="475,1850" size="100,100">&lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
You make your way over to your private quarters. You&#39;ve decided to patiently wait for her to finish getting fucked by some nobleman so she can unlock your ?penis when she has time. &lt;&lt;first&gt;&gt;This is probably one of the most submissive things you&#39;ve ever done...&lt;&lt;/first&gt;&gt;?nl

It takes quite a while for her to visit you so your mind starts to wonder as you&#39;re waiting and you lie down on the bed. ?Kathryn seems to get intimate with almost every half-important dinner guests she invites yet all she seems to enjoy doing with you is locking up your ?penis... What do these noblemen have that you don&#39;t??nl

You start thinking about ?Kathryn&#39;s naked form when you slip a hand under your garments, slowly caressing your locked up ?dick...
&lt;&lt;img &quot;kathryn/garden_peeking_{theme}.jpg&quot;&gt;&gt;
Thinking about her beautiful body is turning you on quite a lot and your ?dick is straining hard in the small cage. As you&#39;re softly massaging your balls and ?dick, suddenly the door to your bedroom busts open. ?Kathryn casually walks inside, not even considering to knock first.

&lt;&lt;kathryn&gt;&gt;Wew! Sorry that took so long, ?titleK. That was a marvelously good plow, he had quite the stamina.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;Uh- No problem, ?Kathryn... I didn&#39;t mean to disturb your evening of intimacy.&lt;&lt;/player&gt;&gt;

&lt;&lt;if settings.cum&gt;&gt;
    ?Kathryn walks over to your bed with a big, naughty smile on her face. She&#39;s wearing the exact same thing as she was earlier in the gazebo and noticeably, she has not taken the time to fix her dress much.?nl
    A single strap is hanging loose and half the skirt of her dress is still hiked up. Her make-up is not looking much better, her lipstick smeared and her mascara slightly out of place. She genuinely looks like she just finished getting railed by &lt;&lt;noble&gt;&gt;.

    &lt;&lt;kathryn&gt;&gt;Maybe you could help me out with something before I let you out of that cage...?&lt;&lt;/kathryn&gt;&gt;

    &lt;&lt;player&gt;&gt;Uhm- Of course. What is it?&lt;&lt;/player&gt;&gt;

    &lt;&lt;kathryn&gt;&gt;It&#39;ll only take a moment. See, I brought you a present... I was hoping you could help me clean up something...&lt;&lt;/kathryn&gt;&gt;

    She looks down towards where her dress scandalously reveals far too much of her private area and then looks back up at you with a wicked smile. She seems to wait a moment for you to allow her into your bed.

    &lt;&lt;decision &#39;Clean her out&#39; depravity medium&gt;&gt;
        &lt;&lt;spicy&gt;&gt;

        &lt;&lt;include &#39;Kathryn Clean Cum&#39;&gt;&gt;

        &lt;&lt;kathryn&gt;&gt;Service well done. Now let&#39;s get you out of that cage...&lt;&lt;/kathryn&gt;&gt;

        &lt;&lt;decision &#39;Get unlocked&#39;&gt;&gt;
            She joins on your bed and takes out the tiny key that locks your ?dick.

            &lt;&lt;include &#39;Kathryn Chastity Unlock Talk&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
        
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Decline her proposal&#39;&gt;&gt;
        &lt;&lt;player&gt;&gt;Ah, I&#39;m sorry ?Kathryn... Could you just let me out of the cage?&lt;&lt;/player&gt;&gt;
        She takes a step back and gives you a nod.

        &lt;&lt;kathryn&gt;&gt;Awh, fine, ?titleK. I suppose I&#39;ll clean up by myself then. Here, let me get you out of that cage.&lt;&lt;/kathryn&gt;&gt;

        She joins on your bed and takes out the tiny key that locks your ?dick.

        &lt;&lt;include &#39;Kathryn Chastity Unlock Talk&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    She looks at you as you&#39;re lying on your bed. She gives you a mischievous smile.
    &lt;&lt;kathryn&gt;&gt;You are a good ?boy for waiting so patiently, ?titleK. I can see you&#39;re eager to get out of your cage...&lt;&lt;/kathryn&gt;&gt;

    She joins on your bed and takes out the tiny key that locks your ?dick.

    &lt;&lt;include &#39;Kathryn Chastity Unlock Talk&#39;&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="145" name="Kathryn Chastity Unlock Bedroom" tags="" position="600,1850" size="100,100">&lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
You move to your bedroom together and as she closes the door she takes out the tiny key that locks your ?dick.

&lt;&lt;include &#39;Kathryn Chastity Unlock Talk&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="146" name="Kathryn Chastity Unlock Talk" tags="" position="725,1850" size="100,100">&lt;&lt;if randomFloat(1) &gt; 0.33&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Isn&#39;t this fun? Me being in total control of your ?penis. I do expect you to come back and have it locked up again.&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;I&#39;ll... consider it... Could you please unlock me now?&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Of course! Go on, show me that ?penis!&lt;&lt;/kathryn&gt;&gt;
    You expose your cage and she inserts the tiny key to unlock the cage.
    &lt;&lt;include &#39;Kathryn Chastity Unlock End&#39;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Well you little pervert, you&#39;re going to need to convince me you deserve to be unlocked again.&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;Wh- What do you mean? Why can&#39;t you just unlock it? I promise I&#39;ll be good...&lt;&lt;/player&gt;&gt;
    She raises an eyebrow, and lets out a dismissive chuckle.
    &lt;&lt;kathryn&gt;&gt;Oh, my ?titleK, you have already shown how little you can be trusted. You should have behaved yourself, now you are going to have to work for it.&lt;&lt;/kathryn&gt;&gt;
    Her face now bears a mischievous grin, as if she has been looking forward to the opportunity to make you squirm.
    &lt;&lt;player&gt;&gt;Fine, ?Kathryn. What do you want me to do?&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;It&#39;s simple, just repeat after me: &quot;I am a perverted &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;sissy princess&lt;&lt;else&gt;&gt;little prince&lt;&lt;/if&gt;&gt; with a ?penis that&#39;s locked up because I can&#39;t control my urges.&quot;&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;decision &#39;Repeat her words&#39; submissiveness large&gt;&gt;
        You lower your head in submission, knowing that you have no choice but to comply with her demands.
        &lt;&lt;player&gt;&gt;I... I am a perverted &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;sissy princess&lt;&lt;else&gt;&gt;little prince&lt;&lt;/if&gt;&gt; with a ?penis that&#39;s locked up because I can&#39;t control my urges...&lt;&lt;/player&gt;&gt;
        Kathryn smirks, clearly pleased with how quickly you folded.
        &lt;&lt;kathryn&gt;&gt;Very good, ?titleK! I&#39;m glad you understand why this is necessary. Now be sure to come back soon so I can lock that thing up again.&lt;&lt;/kathryn&gt;&gt;
        She exposes your cage and inserts the tiny key to unlock it.
        &lt;&lt;include &#39;Kathryn Chastity Unlock End&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Refuse&#39; dominance small&gt;&gt;
        Your expression sours as an indignant fire rises in your heart. You will not beg for release like that.
        &lt;&lt;player&gt;&gt;No way I&#39;m going to say that, ?Kathryn! Just release me already!&lt;&lt;/player&gt;&gt;
        She rolls her eyes at you as she takes out the tiny key to your ?penis.
        &lt;&lt;kathryn&gt;&gt;Ugh, fine. You&#39;re no fun at all, you know that?&lt;&lt;/kathryn&gt;&gt;
        She exposes your cage and inserts the tiny key to unlock it.
        &lt;&lt;include &#39;Kathryn Chastity Unlock End&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="147" name="Kathryn Chastity Unlock End" tags="" position="850,1850" size="100,100">&lt;&lt;kathryn&gt;&gt;There, now don&#39;t go do anything perverted, ?titleK.&lt;&lt;/kathryn&gt;&gt;
She exits your bedroom, leaving you alone with a once-again free ?penis.
&lt;&lt;unequipchastity&gt;&gt;
&lt;&lt;decision &#39;Leave&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="148" name="Kathryn Peeking" tags="" position="975,1850" size="100,100">&lt;&lt;addcounter &#39;kathryn-night&#39; 1&gt;&gt;
&lt;&lt;first&gt;&gt;
    You spot ?Kathryn, over in small gazebo in the center of the castle gardens. She seems to be with a nobleman who you don&#39;t recognise. She always enjoys inviting aristocrats over for &#39;diplomatic&#39; reasons. One of these reasons is very visible right now as she&#39;s currently making out with him on a bench in the middle of the gardens.
&lt;&lt;finally&gt;&gt;
    You once again spot ?Kathryn over in the small gazebo, making out with another aristocrat. You could try to sneak closer and take a good peek. Though, you&#39;re sure she&#39;s not going to be happy if you get caught...
&lt;&lt;/first&gt;&gt;

&lt;&lt;decision &#39;Peek from the bushes&#39; depravity small&gt;&gt;
    &lt;&lt;if isInChastity() and settings.sph and hasCompletedQuest(&#39;kathryn-chastity-excursion&#39;) and randomFloat(1) &gt; 0.5&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Peeking Alone&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Peeking 2&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Allow them their privacy and leave&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;if isInChastity()&gt;&gt;
    &lt;&lt;decision &#39;Ask ?Kathryn to be unlocked from chastity&#39; &#39;Kathryn Chastity Unlock&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="149" name="Kathryn Peeking Alone" tags="" position="1100,1850" size="100,100">&lt;&lt;changeschedule kathryn &#39;night&#39; &#39;None&#39;&gt;&gt;
You sneak up closer to the gazebo to try and get a better view of the scene. You can clearly hear ?Kathryn&#39;s loud moaning as she doesn&#39;t seem to care much for drawing attention. Only once you get closer to her is it that you realize your original perception was wrong, she&#39;s not fooling around with a nobleman like she usually does at all...?nl

Instead, you see her, alone, on the small bench with her legs spread, masturbating vividly. The scene intrigues you so much that you decide to just get up from the bushes and walk in her direction. It&#39;s kind of weird seeing her masturbate all alone, you&#39;re very curious why there&#39;s no fancy man fucking her deep right now.?nl

She has her eyes closed as she&#39;s clearly playing with her clit so you manage to get quite close before she notices you.

&lt;&lt;kathryn&gt;&gt;Oh, ?titleK, of course you&#39;re here.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;Uhm, yes... uh- why are you alone right now?&lt;&lt;/player&gt;&gt;

She continues softly masturbating as she talks to you. She seems to be very used to doing perverted stuff while you&#39;re watching.

&lt;&lt;kathryn&gt;&gt;Ah well, &lt;&lt;noble&gt;&gt; was supposed to join me here tonight but then I received the bad news that he is feeling sick, so he couldn&#39;t attend to me.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;Oh, that&#39;s too bad, uhm- I&#39;m sorry that happened.&lt;&lt;/player&gt;&gt;

She&#39;s still caught up with her fapping session so doesn&#39;t seem to pay that much mind to the conversation.

&lt;&lt;kathryn&gt;&gt;Yes, it&#39;s quite unfortunate... I heard he is very well endowed and I was much looking forward to enjoying that this evening... I was already on my way here so then I decided to just have a private session instead.&lt;&lt;/kathryn&gt;&gt;

You wonder how this can really be considered a &lt;em&gt;private&lt;/em&gt; session, seeing as it&#39;s out in the open and she is well aware that you- uhm- enjoy peeking here from time to time. As you&#39;re thinking of what to say, you suddenly see her sit up slightly, she clearly just thought of an idea.

&lt;&lt;kathryn&gt;&gt;Wait, that&#39;s it! I keep forgetting this sometimes because of your &lt;em&gt;situation&lt;/em&gt;, but you actually have a penis!&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;Uhm, yes, I do in fact have a dick...&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Right, well, I can&#39;t believe I&#39;m suggesting this but I&#39;m simply too horny right now. ?TitleK, would you like to use your ?dick to fuck me right now?&lt;&lt;/kathryn&gt;&gt;
Even though the lead up was obvious in hindsight, the question still catches you off-guard. Never in your wildest dreams have you even thought ?Kathryn would ask this to you. Question is, do you want to?

&lt;&lt;decision &#39;Yes! Definitely!&#39; &#39;Kathryn Peeking Alone 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Not tonight&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Ah, uhm, sorry... Not tonight, ?Kathryn.&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Oh who am I kidding, your pathetic ?dick would never satisfy me anyways... Would you mind leaving me alone, ?titleK? I find it harder to pleasure myself with you standing there.&lt;&lt;/kathryn&gt;&gt;

    &lt;&lt;decision &#39;Leave her alone&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="150" name="Kathryn Peeking Alone 2" tags="spicy" position="1225,1850" size="100,100">&lt;&lt;unequipchastity&gt;&gt;
&lt;&lt;player&gt;&gt;Uhm- Yes! I would love to...&lt;&lt;/player&gt;&gt;

You can&#39;t seem to hold in your excitement and you&#39;re unsure what to do as you walk closer to her.

&lt;&lt;kathryn&gt;&gt;Very excited are we? Well, this is probably going to be a bad idea, but why not try it out for once!&lt;&lt;/kathryn&gt;&gt;

She gestures for you come closer as she fishes out the key to your chastity cage. She lowers your pants and puts the key in your cage, unlocking it. As your ?dick springs free, she immediately starts giggling.

&lt;&lt;kathryn&gt;&gt;Wow, I can&#39;t believe I&#39;m this desperate to have a dick inside me... Your ?dick is nothing compared to what &lt;&lt;noble&gt;&gt; would be fucking me with. Oh well, let&#39;s get this over with.&lt;&lt;/kathryn&gt;&gt;

Looks like the price of getting to have sex with ?Kathryn is having to hear her constant humiliating words, not like you&#39;re used to anything else from her.?nl

She pops up on all fours, facing away from you. She looks beautiful with her red dress almost entirely off. You position yourself behind her as she points her wet pussy towards you, inches away from your ?dick.
&lt;&lt;img &quot;kathryn/garden_peeking_{theme}.jpg&quot;&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Go on, put it in already! Let&#39;s see what that small dick feels like!&lt;&lt;/kathryn&gt;&gt;

You hold onto her as you guide your ?dick inside of her very wet vagina, it slides in very easily, giving you a blissful feeling.

&lt;&lt;kathryn&gt;&gt;Wait, are you in yet? I can&#39;t really feel-&lt;&lt;/kathryn&gt;&gt;

She turns her head as you thrust your full length into her. Only when you pelvis collides with her butt cheeks does her confusion turn into loud laughter.

&lt;&lt;kathryn&gt;&gt;Hahaha! Oh my god! I can barely feel that at all... Wow! It&#39;s even smaller than I thought...&lt;&lt;/kathryn&gt;&gt;

You thrust into her, trying to help her feel you inside of her but it doesn&#39;t seem like it helps.

&lt;&lt;kathryn&gt;&gt;Yes, try to fuck me like a real man would, ?titleK! Fuck me deeper!&lt;&lt;/kathryn&gt;&gt;

You look down with a sense of humiliation as you realize that was already as deep as you can go...

&lt;&lt;kathryn&gt;&gt;Come on, go deeper with that ?penis!&lt;&lt;/kathryn&gt;&gt;

Between blissful moans you start to apologize to her.

&lt;&lt;player&gt;&gt;Ah, I&#39;m sorry, ?Kathryn... I can&#39;t go any deeper...&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Ah fuck... You&#39;re apologizing now... That&#39;s so pathetic...&lt;&lt;/kathryn&gt;&gt;

You realize now that while you&#39;re attempting to give her a good plow, she&#39;s now using one of her hands to massage her clit while you try to fuck her. Is talking about your pathetic ?cock actually turning her on?

&lt;&lt;kathryn&gt;&gt;Oh wow... I was right to keep you in a cage, that&#39;s all your pathetic ?cock is good for...&lt;&lt;/kathryn&gt;&gt;

You feel your own arousal explode with her humiliation...

&lt;&lt;player&gt;&gt;Fuck... ?Kathryn... It feels too good- I&#39;m- I&#39;m getting close...&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;What?! Already? You&#39;ve been failing at fucking me for only like half a minute... That&#39;s unfair, you get to feel all this pleasure and I get to feel &lt;em&gt;nothing&lt;/em&gt;?!&lt;&lt;/kathryn&gt;&gt;

She suddenly lurches forward, only a few inches but it&#39;s enough to pull your ?dick out of her immediately.

&lt;&lt;kathryn&gt;&gt;No, screw that. You&#39;re not allowed to cum yet.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;What, no, I was so close... Please...&lt;&lt;/player&gt;&gt;

She turns around repositions herself, sitting down while she wraps a hand around your ?dick with a wicked grin.

&lt;&lt;kathryn&gt;&gt;Oh I&#39;ll let you cum, don&#39;t worry. I&#39;ll jerk you off to the finish, but first you&#39;re going to need to admit a few things...&lt;&lt;/kathryn&gt;&gt;

You look at her with total lust as she has one hand wrapped around your dick and the other positioned over her clit, she seems to be turned on by this perhaps as much as you are.

&lt;&lt;kathryn&gt;&gt;Haha, I&#39;ve never been able to jerk a guy off with only two finger! Tell me, ?titleK... Tell me that you are pathetic and you have a pathetic excuse for a penis...&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;decision &#39;Tell her you are pathetic&#39; submissiveness small&gt;&gt;

    Completely caught up in your horniness, you immediately go along with her.

    &lt;&lt;player&gt;&gt;I- I&#39;m pathetic... I have a pathetic excuse for a penis...&lt;&lt;/player&gt;&gt;

    As you say these words you see her masturbate both you and herself faster and faster.

    &lt;&lt;kathryn&gt;&gt;Ah fuck... That&#39;s so hot... Tell me how much better &lt;&lt;noble&gt;&gt;&#39;s cock would&#39;ve been for me...&lt;&lt;/kathryn&gt;&gt;

    &lt;&lt;decision &#39;Tell her how much better his cock would\&#39;ve been compared to yours&#39; submissiveness medium&gt;&gt;
        &lt;&lt;player&gt;&gt;&lt;&lt;noble&gt;&gt;&#39;s cock is so much bigger than mine... You deserve dicks like his and not tiny penises like mine... You should lock up my tiny cock again, it can&#39;t pleasure any woman anyways...&lt;&lt;/player&gt;&gt;

        &lt;&lt;kathryn&gt;&gt;Ahh... You&#39;re right... Your ?penis is tiny and pathetic, it looks more like a clit... I wish I had a real cock here right now...&lt;&lt;/kathryn&gt;&gt;

        She continues stroking you and you feel yourself approaching orgasm. The way her breathing is changing while she rubs herself, you gauge she is getting closer too.

        &lt;&lt;kathryn&gt;&gt;Tell me- Ah... Tell me where your pathetic ?dick really belongs...&lt;&lt;/kathryn&gt;&gt;

        &lt;&lt;decision &#39;Tell her where your ?dick belongs&#39; submissiveness large&gt;&gt;
            You know exactly what she means and you go along with her request immediately.
            &lt;&lt;player&gt;&gt;You should- You should lock up my tiny cock- Ah- It can&#39;t pleasure any woman, so you might as well- Ah- keep it in a cage! Ah fuck- I&#39;m cumming!&lt;&lt;/player&gt;&gt;

            Saying these words with sincerity is enough to send both of you over the edge. You cum hard, as your sperm flies all over ?Kathryn&#39;s hand, she would probably be annoyed by that but she&#39;s too busy moaning loudly as she orgasms herself.

            &lt;&lt;kathryn&gt;&gt;Ohhh fuckkkk...&lt;&lt;/kathryn&gt;&gt;

            She spasms visibly from her intense orgasm... You guess, in some way, you have made a woman cum tonight... Though the humiliating part of it does sting a bit.?nl

            ?Kathryn looks at you with a blissful face. 
            &lt;&lt;if settings.cum&gt;&gt;
                This quickly fades the moment she sees her cum-covered hand. 
                &lt;&lt;kathryn&gt;&gt;Ugh, you better clean this up now.&lt;&lt;/kathryn&gt;&gt;
                
                She moves her hand towards your face and without skipping a beat you immediately obey her and open your mouth.
                
                &lt;&lt;player&gt;&gt;Uh, yes of course... Let me clean it for you...&lt;&lt;/player&gt;&gt;

                You lap up your own semen and lick it all from her hand, the salty and bitter tasting fluid slides slowly down your throat, turning you on once more.

                &lt;&lt;kathryn&gt;&gt;Naturally you are a pathetic cum-slut as well...&lt;&lt;/kathryn&gt;&gt;

                It only takes a moment to clean her entire hand, swallowing your entire load. Though she humiliates you for it, she does seem to appreciate it.
            &lt;&lt;/if&gt;&gt;

            &lt;&lt;kathryn&gt;&gt;Hmm. Well done, I suppose. I guess this was kind of fun after all... Maybe I&#39;ll even allow you to do it again, only to enjoy humiliating you once more...&lt;&lt;/kathryn&gt;&gt;

            &lt;&lt;player&gt;&gt;I&#39;d be uhm- happy to help...&lt;&lt;/player&gt;&gt;

            She gets up from the bench and fixes her dress.

            &lt;&lt;kathryn&gt;&gt;Here, let&#39;s put this little thing back where it belongs.&lt;&lt;/kathryn&gt;&gt;

            She takes the chastity cage and quickly puts it on your ?dick, locking it in place. She smiles as she hides the little key in her dress, you feel weirdly happy to have her as your keyholder.

            &lt;&lt;kathryn&gt;&gt;Now, it&#39;s time for me to go. Nothing personal but I do hope I&#39;ll get to enjoy a real cock again next time. But, thanks for this I suppose.&lt;&lt;/kathryn&gt;&gt;

            She quickly walks off of the gazebo, leaving you alone.

            &lt;&lt;decision &#39;Head to bed&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;equipchastity&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="151" name="Kathryn Peeking 2" tags="spicy" position="100,1975" size="100,100">&lt;&lt;changeschedule kathryn &#39;night&#39; &#39;None&#39;&gt;&gt;
You manage to sneak into some bushes where you have quite a nice view of the events happening here. You see ?Kathryn and this nobleman make out quite passionately while sitting next to each other. The man starts to grope her through her red dress, fondling her breasts while sticking his tongue in her mouth.?nl

She starts to take off the top part of her dress, freeing her ample breasts to the open garden at night. You must say the look is quite stunning.
&lt;&lt;img &quot;kathryn/garden_peeking_{theme}.jpg&quot;&gt;&gt;

&lt;&lt;say `getNoble()`&gt;&gt;&lt;&lt;fullname kathryn&gt;&gt;... You are so beautiful...&lt;&lt;/say&gt;&gt;

You&#39;re actually quite jealous of what this nobleman is doing to her. While making out, she slowly starts to spread her legs as he is actually full on humping her now. 

&lt;&lt;kathryn&gt;&gt;Ah... &lt;&lt;noble&gt;&gt;... Please continue...&lt;&lt;/kathryn&gt;&gt;

He&#39;s now moving on top of her and it becomes difficult for you to see what happens next.

&lt;&lt;decision &#39;Try to sneak closer to get a better view&#39; &#39;Kathryn Caught&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Leave before you get caught&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="152" name="Kathryn Caught" tags="spicy" position="225,1975" size="100,100">&lt;&lt;addevent wake &#39;Kathryn Waking Abrupt&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
&lt;&lt;first&gt;&gt;
    &lt;&lt;acknowledgechanges kathryn-peeking kathryn&gt;&gt;
    You see a small path through the bushes leading closer to the gazebo. You try to make as little noise as possible though it&#39;s not like it really matters, the loud moaning and grunting is hard to overpower. At least, that&#39;s what you think before you accidentally step on a branch that makes a very loud snapping sound. Oops.?nl
    You wonder whether the noise was even loud enough for them to notice while they&#39;re so busy but that question is quickly answered when you suddenly hear the nobleman shout in your direction.

    &lt;&lt;say `getNoble()`&gt;&gt;Who goes there?! Show yourself, vagrant!&lt;&lt;/say&gt;&gt;

    You are unsure what to do as you see both of them stand up now, they&#39;re going to spot you any moment. You decide it&#39;s best to sneak out of hear but as soon as you turn around you walk straight into a tree branch, knocking you out of the bushes.?nl

    ?Kathryn looks at you with a face of anger and disgust.

    &lt;&lt;kathryn&gt;&gt;You... You little shit! You&#39;re the pervert who is peeking on us?!&lt;&lt;/kathryn&gt;&gt;

    You get up from the ground, unsure what to do when you see &lt;&lt;noble&gt;&gt; looking at you and then back at her with a quite surprised look, mouth agape. He says something to her with a much more hushed tone.
    &lt;&lt;say `getNoble()`&gt;&gt;Isn&#39;t that the prince? Should you talk to him like that?&lt;&lt;/say&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Shut up, you. Now, &lt;&lt;name player &#39;Prince&#39;&gt;&gt;, I knew you were a little pervert but I didn&#39;t think you would stoop so low.&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;I- I&#39;m sorry, ?Kathryn. I&#39;ll uh- I&#39;ll just leave you two.&lt;&lt;/player&gt;&gt;
    While you try to turn around she walks over to you adn quickly grabs your arm.
    &lt;&lt;kathryn&gt;&gt;Oh you think it&#39;s that easy? That I&#39;ll just let you go after this?&lt;&lt;/kathryn&gt;&gt;
    There&#39;s a certain fire in her eyes as she&#39;s gabbing you.
    &lt;&lt;decision &#39;Break free and run&#39; dominance medium&gt;&gt;
        You break free from her grasp and make a run for it. She stumbles back but before falling the nobleman moves to catch her.
        &lt;&lt;kathryn&gt;&gt;Get back here you little shit! I&#39;m not done with you!&lt;&lt;/kathryn&gt;&gt;
        You shout back at her as you&#39;re running back into the castle towards your bedchambers.
        &lt;&lt;player&gt;&gt;Sorry ?Kathryn, I have to go! Have a nice rest of the night!&lt;&lt;/player&gt;&gt;
        &lt;&lt;decision &#39;Quickly hide in your bedroom&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Plead with her&#39; submissiveness medium&gt;&gt;
        &lt;&lt;player&gt;&gt;Please, ?Kathryn, let me go. I swear it won&#39;t happen again.&lt;&lt;/player&gt;&gt;
        You look at her with a face full of embarrassment. Your puppy dog eyes seem to be effective as she looks you up and down and slowly let&#39;s go of you.
        &lt;&lt;kathryn&gt;&gt;Pathetic... I&#39;ll have to punish you somehow, ?titleK. I will have to think on that... Now leave, before I change my mind.&lt;&lt;/kathryn&gt;&gt;
        You quickly scamper away back to the castle.
        &lt;&lt;decision &#39;Quickly go to your bedroom&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;finally&gt;&gt;
    You see a small path through the bushes leading closer to the gazebo. You try to make as little noise as possible though it&#39;s not like it really matters, the loud moaning and grunting is hard to overpower. You have experience with this now, almost a professional voyeur, one might say. You know precisely how to avoid that treacherous branch and you cockily grin while doing so. At least, that&#39;s what you think before you accidentally step on &lt;&lt;= either(&quot;a cat&#39;s tail&quot;, &quot;a different branch&quot;, &quot;a surprisingly splashy puddle&quot;, &quot;a fat toad&quot;, &quot;a swarm of sleeping bees&quot;, &quot;another man having a peek&quot;)&gt;&gt; that now suddenly makes a very loud noise. Oops.?nl
    You try to make a sneaky run for it but it has little effect. You have a real déjà vu moment as you hear someone shout out in your direction.

    &lt;&lt;if !isInChastity()&gt;&gt;
        &lt;&lt;acknowledgechanges kathryn-peeking kathryn&gt;&gt;
        &lt;&lt;say `getNoble()`&gt;&gt;What was that?! Reveal yourself!&lt;&lt;/say&gt;&gt;
        Before you can even respond you hear ?Kathryn speak to the nobleman. 

        &lt;&lt;kathryn&gt;&gt;Ugh... leave this to me, &lt;&lt;noble&gt;&gt;. I will be right back.&lt;&lt;/kathryn&gt;&gt;

        You are caught like a deer in headlights as you see her coming your way. She stands in front of you with a &lt;em&gt;very&lt;/em&gt; disappointed look on her face.

        &lt;&lt;kathryn&gt;&gt;Again? Really?! Are you really that perverted that you can&#39;t leave me alone even when I tell you to?&lt;&lt;/kathryn&gt;&gt;
        
        You just gulp as you&#39;re not really sure how to respond to her.

        &lt;&lt;kathryn&gt;&gt;You perverted little shit... I will speak to you in the morning. Now do us all a favour and &lt;em&gt;leave.&lt;/em&gt;&lt;&lt;/kathryn&gt;&gt;

        &lt;&lt;if settings.sph&gt;&gt;
            &lt;&lt;kathryn&gt;&gt;I know you&#39;re jealous of what &lt;&lt;noble&gt;&gt; is packing but just take your little baby dick and go tug on that someplace else.&lt;&lt;/kathryn&gt;&gt;
        &lt;&lt;/if&gt;&gt;

        She turns around and walks back towards the gazebo. That was real ire in her voice, you feel kind of lucky being able to leave while only being scolded.
        &lt;&lt;decision &#39;Leave to your bedroom&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;acknowledgechanges chastity kathryn&gt;&gt;
        &lt;&lt;kathryn&gt;&gt;Oh hello, ?titleK. How nice of you to visit us, why don&#39;t you join us on the gazebo?&lt;&lt;/kathryn&gt;&gt;
        You don&#39;t really have much of a choice in this situation, you are already called out, you could simply run away but you&#39;re kind of curious why she is inviting you. You walk onto the gazebo with a very ashamed look on your face.?nl
        The nobleman looks quite confused at the situation, ?Kathryn is still half naked now with a smile on her face.
        &lt;&lt;kathryn&gt;&gt;&lt;&lt;noble&gt;&gt;, this is the prince. He sometimes likes to play peeping tom...&lt;&lt;/kathryn&gt;&gt;
        The nobleman nods to you, not sure what to do.
        &lt;&lt;kathryn&gt;&gt;I think he likes to hide in the bushes and jerk his ?dick while we are having our fun here. Isn&#39;t that right, ?titleK?&lt;&lt;/kathryn&gt;&gt;
        &lt;&lt;player&gt;&gt;No- I uh- I was just-&lt;&lt;/player&gt;&gt;
        Before you can even finish your stammering thought you are immediately interrupted by ?Kathryn.
        &lt;&lt;kathryn&gt;&gt;However, this time he&#39;s probably having a bit of trouble with that part.&lt;&lt;/kathryn&gt;&gt;
        She makes eye contact with you as she glares at you. You definitely don&#39;t like where this is going.
        &lt;&lt;kathryn&gt;&gt;Why don&#39;t you show &lt;&lt;noble&gt;&gt; why that is, ?titleK?&lt;&lt;/kathryn&gt;&gt;
        &lt;&lt;decision &#39;Obey&#39; submissiveness small&gt;&gt;
            You lower your head in shame as you&#39;re actually considering exposing yourself.
            &lt;&lt;kathryn&gt;&gt;Come on, ?titleK. Show good &lt;&lt;noble&gt;&gt; why you can&#39;t currently masturbate to us having sex.&lt;&lt;/kathryn&gt;&gt;
            Your hands are shaking as you slowly expose your underwear and lower it, revealing the &lt;&lt;= $chastity.color&gt;&gt; chastity cage around your ?dick.
            &lt;&lt;img &#39;chastity/chastity_check.gif&#39; &#39;ridge-border&#39; &#39;15em&#39;&gt;&gt;
            &lt;&lt;kathryn&gt;&gt;Hahaha, wow look at that! It is so pathetic!&lt;&lt;/kathryn&gt;&gt;
            The nobleman&#39;s look of confusion quickly turns into laughter as he sees your cage.
            &lt;&lt;say `getNoble()`&gt;&gt;That is absurd, what kind of man are you? Why can&#39;t you simply remove the thing?&lt;&lt;/say&gt;&gt;
            ?Kathryn deftly produces a small key from her dress and looks at the nobleman.
            &lt;&lt;kathryn&gt;&gt;Because I&#39;m not letting ?him...&lt;&lt;if hasQuest(&#39;kathryn-chastity-week&#39;)&gt;&gt; ?He has to hold out an entire week in chastity right now.&lt;&lt;/if&gt;&gt;&lt;&lt;/kathryn&gt;&gt;
            &lt;&lt;say `getNoble()`&gt;&gt;Hahaha! Oh my, you are quite something, &lt;&lt;fullname kathryn&gt;&gt;.&lt;&lt;/say&gt;&gt;
            ?Kathryn&#39;s disposition seems to have an arousing effect on the nobleman as he suddenly moves to embrace her again, completely ignoring the fact that you are here. He&#39;s kissing her neck as ?Kathryn makes eye contact with you.
            &lt;&lt;kathryn&gt;&gt;Now why don&#39;t you leave us to our personal time, ?titleK.&lt;&lt;/kathryn&gt;&gt;
            You turn around with a defeated posture, instantly obeying anything ?Kathryn tells you to do.
            &lt;&lt;if settings.cum and hasCompletedQuest(&#39;kathryn-chastity-excursion&#39;)&gt;&gt;
                &lt;&lt;addevent dream &#39;Kathryn Visit After Sex&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
                &lt;&lt;removeevent wake &#39;Kathryn Waking Abrupt&#39;&gt;&gt;
                As the nobleman gets back to sensually kissing her neck, ?Kathryn shouts out one final thing.
                &lt;&lt;kathryn&gt;&gt;You know what... why don&#39;t I come visit you after we&#39;m done here, ?titleK? Would you like that?&lt;&lt;/kathryn&gt;&gt;
                You awkwardly give her a confused nod, simply wanted to get out of here.
            &lt;&lt;/if&gt;&gt;
            &lt;&lt;decision &#39;Leave to your bedroom&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
        &lt;&lt;decision &#39;Run away without explanation&#39;&gt;&gt;
            &lt;&lt;player&gt;&gt;What- No, I can&#39;t...&lt;&lt;/player&gt;&gt;
            You&#39;re unsure what to do in this conversation so you decide to just quickly leave this place as you run back your bedroom.
            While you leave the gazebo you can hear ?Kathryn laugh together with the nobleman.
            &lt;&lt;kathryn&gt;&gt;He&#39;ll come around next time...&lt;&lt;/kathryn&gt;&gt;
            &lt;&lt;decision &#39;Leave to your bedroom&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;

&lt;&lt;/first&gt;&gt;</tw-passagedata><tw-passagedata pid="153" name="Kathryn Waking Abrupt" tags="" position="350,1975" size="100,100">&lt;&lt;outfit sleep&gt;&gt;
You wake up quite abruptly as you suddenly feel your blankets being pulled away.

&lt;&lt;decision &#39;Face your assailant&#39;&gt;&gt;
    &lt;&lt;if !hasVisited(&#39;Kathryn Waking Abrupt 1&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Waking Abrupt 1&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Kathryn Waking Abrupt 2&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Waking Abrupt 2&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Waking Abrupt 3&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="154" name="Kathryn Waking Abrupt 1" tags="" position="475,1975" size="100,100">You open your eyes, startled from the sudden cold as you see ?Kathryn standing next to your bed, holding your blanket and looking angry.
&lt;&lt;kathryn&gt;&gt;Wake up, ?titleK. How do you like it when someone else is peeking on you, you little pervert?&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;if hasEquipmentTag(&#39;feminine&#39;, &#39;underwear&#39;)&gt;&gt;
    &lt;&lt;addsin &#39;wearing-panties&#39;&gt;&gt;
    You realise now that all you are wearing are the very girly panties and she has full view of them.
    &lt;&lt;kathryn&gt;&gt;Wait, are you wearing panties? That is hilarious, I didn&#39;t know you&#39;re actually a sissy!&lt;&lt;/kathryn&gt;&gt;
    She completely starts laughing at you while pointing at your panties. Before you can respond she suddenly reaches forward and forcefully lowers them.
&lt;&lt;else&gt;&gt;
    You&#39;re unsure what&#39;s really happening as you&#39;re lying in bed with nothing but your pyjama shorts on, she suddenly lurches forward and pulls down your shorts. 
&lt;&lt;/if&gt;&gt;
You let out a surprised yelp as you quickly try to cover yourself up but it&#39;s too late, she caught you by surprise as she stares at your naked ?dick.?nl
&lt;&lt;if settings.sph&gt;&gt;
    As soon as she sees your ?dick she immediately starts laughing.
    &lt;&lt;kathryn&gt;&gt;Oh my god, that is the smallest little thing I&#39;ve ever seen!&lt;&lt;/kathryn&gt;&gt;
    You quickly grab a pillow and cover yourself up.
    &lt;&lt;player&gt;&gt;Shut up, ?Kathryn, what are you doing here?!&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Well I was going to give you payback for spying on me but... wow... I didn&#39;t expect your little one to be so...&lt;&lt;/kathryn&gt;&gt;
    She looks at your crotch and speaks with a tone genuine interest.
    &lt;&lt;kathryn&gt;&gt;Please, ?titleK, don&#39;t cover yourself. Come on, let me have another look, I promise I won&#39;t laugh again!&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;decision &#39;Slowly remove the pillow again&#39; submissiveness medium&gt;&gt;
        &lt;&lt;spicy&gt;&gt;
        You slowly lift the pillow. Her humiliation seems to have some effect on you as you feel your ?dick starting to get hard.
        &lt;&lt;kathryn&gt;&gt;That is so pathetic... Are you actually getting hard from me calling your dick tiny? It&#39;s barely grown any bigger at all!&lt;&lt;/kathryn&gt;&gt;
        She can&#39;t contain her laugh as she moves her hand close to your ?dick.
        &lt;&lt;kathryn&gt;&gt;Look! It&#39;s as small as my pinky!&lt;&lt;/kathryn&gt;&gt;
        &lt;&lt;player&gt;&gt;Sh- Shut up, ?Kathryn...&lt;&lt;/player&gt;&gt;
        This is probably one of the most humiliating things in your life, the worst part is how your body is responding to this. You can&#39;t believe her belittlement is actually turning you on.
        &lt;&lt;kathryn&gt;&gt;Oh but you like this, don&#39;t you? You like it when I call you pathetic. How can you even call that a cock? It&#39;s basically a clit at this point. Can you even call yourself a man, ?titleK?&lt;&lt;/kathryn&gt;&gt;
        She walks away from you while laughing loudly still. Before she exits the room she turns to you.
        &lt;&lt;kathryn&gt;&gt;Well I think I&#39;ve seen enough. That was the most pathetic thing I have seen my entire life. I don&#39;t think you would be able to satisfy anyone with that tiny thing. Now, don&#39;t go spying on me again or I will go tell everything what a pathetic little cocklet you have, got that?&lt;&lt;/kathryn&gt;&gt;
        She then slams the door shut, leaving you alone in your bedroom. Your ?dick is still rock hard from the humiliation.?nl
        &lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Tell her to leave&#39; dominance small&gt;&gt;
        &lt;&lt;player&gt;&gt;What? No! Are you crazy?! Get out of my room, ?Kathryn!&lt;&lt;/player&gt;&gt;
        She sighs and heads over to your door.
        &lt;&lt;kathryn&gt;&gt;Fine... I already saw everything I needed to anyways... I can&#39;t believe your ?dick is so pathetic, ?titleK.&lt;&lt;/kathryn&gt;&gt;
        You still need to recover from what just happened, you can
        &lt;&lt;decision &#39;Continue&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    You grab a pillow and hold it in front of you as you feel embarrassed by the blatant intrusion.
    &lt;&lt;player&gt;&gt;What the hell are you doing, ?Kathryn?!&lt;&lt;/player&gt;&gt;
    She looks quite angry at you.
    &lt;&lt;kathryn&gt;&gt;You&#39;re not a fan of this voyeurism now that you are the victim, are you, you sick pervert?&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;What?! Well maybe you shouldn&#39;t go fuck that noble in the &lt;em&gt;public&lt;/em&gt; gardens!&lt;&lt;/player&gt;&gt;
    Just before you think she can&#39;t look any angrier right now she suddenly punches you on the pillow you&#39;re holding right in front of your nuts, sending you reeling.
    &lt;&lt;kathryn&gt;&gt;Don&#39;t let it happen again, you pervert!&lt;&lt;/kathryn&gt;&gt;
    She quickly exits the room while you are recovering from the quite powerful blow to your private area.
    &lt;&lt;decision &#39;Continue&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="155" name="Kathryn Waking Abrupt 2" tags="" position="600,1975" size="100,100">&lt;&lt;kathryn&gt;&gt;Again, ?titleK?! I can&#39;t believe even you would stoop that low... But then again, I suppose there really are no perverts like you.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;if hasEquipmentTag(&#39;feminine&#39;, &#39;underwear&#39;)&gt;&gt;
    &lt;&lt;addsin &#39;wearing-panties&#39;&gt;&gt;
    You realise now that all you are wearing are the very girly panties and she has full view of them since she pulled away the blanket.
    &lt;&lt;kathryn&gt;&gt;Wait, are you kidding me... I was going to punish you by making you wear panties but it looks like I&#39;m too late...&lt;&lt;/kathryn&gt;&gt;
    She actually starts laughing at you now.
    &lt;&lt;kathryn&gt;&gt;Tell me, ?titleK. Why are you wearing the panties? Are you actually a sissy?&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;What? No, it&#39;s not like that! I&#39;m not a sissy!&lt;&lt;/player&gt;&gt;
    She suddenly lurches forward and pins you down, her knee is pushing into your crotch, hard.
    &lt;&lt;kathryn&gt;&gt;Don&#39;t lie to me, ?titleK! Admit you are a sissy and I will leave.&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;Ah! Stop! Get off me!&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Come on, just say it! Tell me you are nothing but a little sissy who likes wearing little frilly panties!&lt;&lt;/kathryn&gt;&gt;
    She is really hurting you and you just want to get out of this humiliating situation...
    &lt;&lt;player&gt;&gt;Fine! I&#39;m a little sissy who likes wearing little frilly panties... Now get off me!&lt;&lt;/player&gt;&gt;
    Your pain is relieved as she gets up from you and walks towards the door.
    &lt;&lt;kathryn&gt;&gt;See? That wasn&#39;t so hard, was it? I&#39;ll consider this your punishment for now. Peek on me again and you will regret it even more. Goodbye little sissy, make sure you keep wearing those panties.&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;decision &#39;Continue&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    You are once again in this very vulnerable position with just your shorts on. While you think this over you notice her stare at them.
    &lt;&lt;kathryn&gt;&gt;Take them off.&lt;&lt;/kathryn&gt;&gt;
    The angry look on her face makes it very clear she is not asking. Instead of her forcing your underwear down herself, she will simply have you strip naked for her now instead.
    &lt;&lt;decision &#39;Obey&#39; &#39;Kathryn Punishment&#39; submissiveness medium&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Object&#39; dominance medium&gt;&gt;
        &lt;&lt;player&gt;&gt;Absolutely not, get out of here, ?Kathryn!&lt;&lt;/player&gt;&gt;
        She starts steaming at your response.
        &lt;&lt;kathryn&gt;&gt;How dare you?! First you spy on me multiple times and then you just tell me no?! You little shit, I will murder you!&lt;&lt;/kathryn&gt;&gt;
        She is about to lurch at you when you stand up from the bed and shout back.
        &lt;&lt;player&gt;&gt;I am the &lt;em&gt;Prince&lt;/em&gt;! You will do as a say so long as you&#39;re a member of my court!&lt;&lt;/player&gt;&gt;
        &lt;&lt;kathryn&gt;&gt;Fuck you! Stop fucking spying on me you pervert!&lt;&lt;/kathryn&gt;&gt;
        You see her reconsider her hostile actions after her outburst and seeing you stand your ground.
        &lt;&lt;kathryn&gt;&gt;Fine! Have it your way! I&#39;m out of here, spy on me again and I&#39;ll come back, you asshole!&lt;&lt;/kathryn&gt;&gt;
        She storms out your room and slams the door shut behind her.
        &lt;&lt;decision &#39;Continue&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="156" name="Kathryn Waking Abrupt 3" tags="" position="725,1975" size="100,100">You open your eyes, startled from the sudden cold as you once again see ?Kathryn standing next to your bed, holding your blanket and looking angry.?nl
&lt;&lt;if hasEquipmentTag(&#39;feminine&#39;, &#39;underwear&#39;)&gt;&gt;
    You are once again in this very vulnerable position, showing your underwear. Even worse, you&#39;re actually wearing very girly panties right now...
    &lt;&lt;kathryn&gt;&gt;You&#39;re wearing the panties. Good little sissy. Now be a good girl and take them off for me.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;else&gt;&gt;
    You are once again in this very vulnerable position, showing your underwear. Problem is, you&#39;re wearing the wrong kind... You remember she ordered you to wear the panties at all times and here you are, disobeying her.
    &lt;&lt;kathryn&gt;&gt;Didn&#39;t I order you to wear your panties at all times? This underwear is not girly enough for a pervert like you, take them off!&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;/if&gt;&gt;
The angry look on her face makes it very clear she is not asking. Instead of her forcing your underwear down herself, she will simply have you strip naked for her now instead.
&lt;&lt;decision &#39;Obey&#39; &#39;Kathryn Punishment&#39; submissiveness medium&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Object&#39; dominance medium&gt;&gt;
    &lt;&lt;player&gt;&gt;Absolutely not, get out of here, ?Kathryn!&lt;&lt;/player&gt;&gt;
    She starts steaming at your response.
    &lt;&lt;kathryn&gt;&gt;How dare you?! First you spy on me multiple times and then you just tell me no?! You little shit, I will murder you!&lt;&lt;/kathryn&gt;&gt;
    She is about to lurch at you when you stand up from the bed and shout back.
    &lt;&lt;player&gt;&gt;I am the &lt;em&gt;Prince&lt;/em&gt;! You will do as a say so long as you&#39;re a member of my court!&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Fuck you! Stop fucking spying on me you pervert!&lt;&lt;/kathryn&gt;&gt;
    You see her reconsider her hostile actions after her outburst and seeing you stand your ground.
    &lt;&lt;kathryn&gt;&gt;Fine! Have it your way! I&#39;m out of here, spy on me again and I&#39;ll come back, you asshole!&lt;&lt;/kathryn&gt;&gt;
    She storms out your room and slams the door shut behind her.
    &lt;&lt;decision &#39;Continue&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="157" name="Kathryn Punishment" tags="spicy" position="850,1975" size="100,100">You reluctantly reach down and lower your underwear for her.
&lt;&lt;kathryn&gt;&gt;Good girl...&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;if isInChastity()&gt;&gt;
    You reveal your ?penis, safely locked away in your &lt;&lt;= $chastity.color&gt;&gt; cage. ?Kathryn is sporting a wicked smile as she sees this.
    &lt;&lt;kathryn&gt;&gt;Locked as it should be. Isn&#39;t that fitting?&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;No... It&#39;s- uhm-&lt;&lt;/player&gt;&gt;
    She interrupts you before you can finish your mumbled thought.
    &lt;&lt;kathryn&gt;&gt;Oh just admit it, you must be getting used to this by now. You ?dick just belongs in a cage, seeing as you continue to peek on me any chance you get.&lt;&lt;/kathryn&gt;&gt; 
&lt;&lt;elseif settings.sph&gt;&gt;
    As soon as she sees your ?dick she immediately starts laughing again.
    &lt;&lt;kathryn&gt;&gt;Wow, the patheticness of that thing really does cheer me up every time!&lt;&lt;/kathryn&gt;&gt;
    You quickly grab a pillow and cover yourself up.
    &lt;&lt;kathryn&gt;&gt;That is so pathetic... Are you actually getting hard from me calling your dick tiny? It&#39;s barely grown any bigger at all!&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;Sh- Shut up, ?Kathryn...&lt;&lt;/player&gt;&gt;
    This is probably one of the most humiliating things in your life, the worst part is how your body is responding to this. You can&#39;t believe her belittlement is actually turning you on.
    &lt;&lt;kathryn&gt;&gt;Oh but you like this, don&#39;t you? I threatened you I would tell everyone about your pathetic little dicklet and yet you still decide to spy on me again...&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;player&gt;&gt;Why do you want to see my dick again?&lt;&lt;/player&gt;&gt;
    She looks quite angry at you.
    &lt;&lt;kathryn&gt;&gt;Revenge, idiot. You&#39;re not a fan of this voyeurism now that you are the victim, are you, you sick pervert?&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Now, good thing I have thought of a fitting punishment for you, ?titleK.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;decision &#39;Hear the punishment&#39;&gt;&gt;
    &lt;&lt;if !hasEquipmentTag(&#39;feminine&#39;, &#39;underwear&#39;) and !hasVisited(&#39;Kathryn Punishment Panties&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Punishment Panties&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Kathryn Punishment Measuring&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Punishment Measuring&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Kathryn Punishment Chastity Intro&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Punishment Chastity Intro&#39;&gt;&gt;
    &lt;&lt;elseif isQuestUnstarted(&#39;kathryn-chastity-week&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Punishment Chastity Week&#39;&gt;&gt;
    &lt;&lt;elseif hasQuest(&#39;kathryn-chastity-week&#39;) and isInChastity()&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Punishment Chastity Week In Progress&#39;&gt;&gt;
    &lt;&lt;elseif isInChastity()&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Punishment Humiliation&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;goto &#39;Kathryn Punishment Chastity&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;unequip &#39;underwear&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="158" name="Kathryn Punishment Panties" tags="spicy" position="975,1975" size="100,100">&lt;&lt;addsin &#39;wearing-panties&#39;&gt;&gt;
&lt;&lt;equip &#39;panties&#39;&gt;&gt;
&lt;&lt;unlockequipment &#39;panties&#39;&gt;&gt;
As you&#39;re wondering what she has in mind she suddenly takes out some very girly, very frilly panties and throws them on the bed.
&lt;&lt;img &#39;equipment/panties.jpg&#39; null &#39;12em&#39;&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Put it on.&lt;&lt;/kathryn&gt;&gt;
You stare at her in disbelief.
&lt;&lt;player&gt;&gt;What, are you kidding me? Those are for girls, I can&#39;t put them on!&lt;&lt;/player&gt;&gt;
She suddenly looks even more angry, taking a step towards you which instantly makes you flinch.
&lt;&lt;kathryn&gt;&gt;I wasn&#39;t asking, you are a little pervert and now you will need to wear the panties. Put. Them. On.&lt;&lt;/kathryn&gt;&gt;
You really don&#39;t want to argue with her while she&#39;s so angry so you slowly start putting on the panties. They feel very soft on your skin and they very nicely envelop your ?dick.

&lt;&lt;if settings.sph&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;You would think there would be more of a bulge when a man wears panties, but not for you it seems. You really do have just a little clitty.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Well done... They look like they fit you. Now, you will wear them throughout the day and if I ever see you walk around without them I will punish you.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;player&gt;&gt;You can&#39;t be serious, what if people notice?&lt;&lt;/player&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Better make sure they don&#39;t notice then. Wouldn&#39;t want people to know you&#39;re a sissy, right?&lt;&lt;/kathryn&gt;&gt;
That word... Sissy... it sounds so humiliating...
&lt;&lt;kathryn&gt;&gt;That&#39;s enough punishment for now, I think. Don&#39;t forget to wear the panties at all times, and if I catch you peeking on me again, there will be even more consequences...&lt;&lt;/kathryn&gt;&gt;
She walks over to the door and leaves you alone in your room. You feel vulnerable and feminine as you realise you&#39;re now doing something you&#39;ve never done before: You&#39;re wearing panties...
&lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="159" name="Kathryn Punishment Measuring" tags="spicy" position="1100,1975" size="100,100">She suddenly takes out a thin piece of cloth and moves close to you, reaching for your private area.
&lt;&lt;kathryn&gt;&gt;Hold still, ?titleK.&lt;&lt;/kathryn&gt;&gt;
She expertly wraps it around the base of your ?dick and unwraps it again. You now notice the markings on the piece of cloth, is she &lt;em&gt;measuring&lt;/em&gt; your penis??nl
&lt;&lt;if settings.sph&gt;&gt;
    She has a mean grin on her face while she&#39;s working.
    &lt;&lt;kathryn&gt;&gt;I wasn&#39;t wrong, this is literally the smallest dick I have ever seen! ?TitleK, you are absolutely pathetic...&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if settings.vids&gt;&gt;
    &lt;&lt;if settings.sph&gt;&gt;
        &lt;&lt;video &#39;kathryn/kathryn_measuring_sph.webm&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;video &#39;kathryn/kathryn_measuring.webm&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
You stare quite perplexed as you see this event unfolding before you. After less than a minute she suddenly gets up again.
&lt;&lt;kathryn&gt;&gt;There! That should be all I need.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;player&gt;&gt;What was that? Why did you measure my penis?&lt;&lt;/player&gt;&gt;
&lt;&lt;kathryn&gt;&gt;That&#39;s your punishment for now, I have figured out exactly what to do with that thing of yours...&lt;&lt;/kathryn&gt;&gt;
She&#39;s already walking towards the door when she suddenly turns around to ask you a final question.
&lt;&lt;kathryn&gt;&gt;Oh, one more thing: metal, black, or pink?&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;player&gt;&gt;Wh- what? What are you on about?&lt;&lt;/player&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Shh, don&#39;t ask questions, just answer the question: metal, black or pink.&lt;&lt;/kathryn&gt;&gt;
Seeing no other option, you decide to just answer the question.

&lt;&lt;decision &#39;Metal&#39;&gt;&gt;
    &lt;&lt;setchastity &#39;metal&#39; &#39;big&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Metal? I guess?&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Splendid.&lt;&lt;/kathryn&gt;&gt;
    She turns around again and heads for the door.
    &lt;&lt;kathryn&gt;&gt;Spy on me again and you will find out exactly what I&#39;m talking about.&lt;&lt;/kathryn&gt;&gt;
    She slams the door shut behind her, leaving you alone in your bed.
    &lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Black&#39;&gt;&gt;
    &lt;&lt;setchastity &#39;black&#39; &#39;big&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Black, I suppose...&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Good.&lt;&lt;/kathryn&gt;&gt;
    She turns around again and heads for the door.
    &lt;&lt;kathryn&gt;&gt;Spy on me again and you will find out exactly what I&#39;m talking about.&lt;&lt;/kathryn&gt;&gt;
    She slams the door shut behind her, leaving you alone in your bed.
    &lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Pink&#39; femininity small&gt;&gt;
    &lt;&lt;setchastity &#39;pink&#39; &#39;big&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Pink, I guess...&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Good. That suits you.&lt;&lt;/kathryn&gt;&gt;
    She turns around again and heads for the door.
    &lt;&lt;kathryn&gt;&gt;Spy on me again and you will find out exactly what I&#39;m talking about.&lt;&lt;/kathryn&gt;&gt;
    She slams the door shut behind her, leaving you alone in your bed.
    &lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="160" name="Kathryn Punishment Chastity Intro" tags="spicy" position="1225,1975" size="100,100">&lt;&lt;acknowledgechanges chastity kathryn&gt;&gt;
She walks closer to you with one hand behind her back.
&lt;&lt;kathryn&gt;&gt;You&#39;ve let your ?dick guide you into perverted actions for too long, ?titleK. I have a solution for it. Look away.&lt;&lt;/kathryn&gt;&gt;
She points to the side, ordering you to not look at what she&#39;s doing. You meekly comply with her request as you stare at your bedroom wall while she inches closer to you.?nl
She suddenly takes a hold of your ?dick and you feel it being enveloped in something. You feel your ?dick starting to get hard but then she immediately pinches it, hurting you.
&lt;&lt;player&gt;&gt;Ouch! What are you doing?&lt;&lt;/player&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Quiet you, I know you don&#39;t get much intimate contact so it instantly turns you on when someone is rough with your ?dick but I need you to stay soft for this.&lt;&lt;/kathryn&gt;&gt;
You focus on the wall as you hear a small metallic locking sound.
&lt;&lt;kathryn&gt;&gt;There! All done!&lt;&lt;/kathryn&gt;&gt;
You look down at your ?dick in complete disbelief as she seems to have locked your ?dick in a small &lt;&lt;= $chastity.color&gt;&gt; cage. Even though it definitely weirds you out it feels kind of snug, the thing seems to be exactly your size.
&lt;&lt;img &#39;chastity/chastity.jpg&#39; &#39;ridge-border&#39; &#39;15em&#39;&gt;&gt;
&lt;&lt;player&gt;&gt;Wha- What is this?!&lt;&lt;/player&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Can&#39;t you tell? It&#39;s a chastity cage. I gave the measurements to &lt;&lt;title beau &#39;the blacksmith&#39;&gt;&gt; in town and had her make one specifically for you.&lt;&lt;/kathryn&gt;&gt;
She waves around a tiny key in front of you. You look down and notice the lock attached to the key. 
&lt;&lt;kathryn&gt;&gt;I will be keeping this key for you. The cage will keep your ?dick in check and hopefully prevent you from doing perverted things all the time like peeking on me.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;player&gt;&gt;Wait, you can&#39;t be serious ?Kathryn. How am I supposed to...&lt;&lt;/player&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Oh I&#39;m very serious, ?titleK. Don&#39;t worry, you can still pee just fine in that thing. It&#39;s just the sinful things you will have problems with now...&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;img &#39;chastity/chastity_touching.webp&#39; &#39;ridge-border&#39; &#39;30em&#39;&gt;&gt;
She bends down and taps the cage to emphasise her point. She then turns around and hides the key in her dress.
&lt;&lt;kathryn&gt;&gt;Relax, I&#39;ll let you out if you come and ask me nicely.&lt;&lt;/kathryn&gt;&gt;
She moves out of your bedroom with a smug smile and closes the door behind her. You stare at your ?dick in utter disbelief, now trapped in a &lt;&lt;= $chastity.color&gt;&gt; cage.
&lt;&lt;equipchastity&gt;&gt;
&lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="161" name="Kathryn Punishment Chastity Week" tags="spicy" position="100,2100" size="100,100">&lt;&lt;player&gt;&gt;Alright, ?Kathryn. What do you want me to do?&lt;&lt;/player&gt;&gt;
Kathryn smirks, clearly pleased with how quickly you accept your fate now.
&lt;&lt;kathryn&gt;&gt;Your first task is to kneel before me and beg for my forgiveness. Do it now.&lt;&lt;/kathryn&gt;&gt;
You feel a surge of humiliation that you struggle to choke down. Your pride bucks against the command, trying to retain its royal dignity, but you know that you have no choice but to do as she says now.
&lt;&lt;kathryn&gt;&gt;I do not have all day, and this is your only warning: obey without hesitation or your ?dick will be locked up &lt;i&gt;permanently&lt;/i&gt;.&lt;&lt;/kathryn&gt;&gt;
Your ?cock inexplicably jumps at the threat, leaving you with a confused mix of feelings - don&#39;t you want to be free? You don&#39;t have time to process this new inner conflict, however, as your pride finally buckles under her impatient gaze.?nl
You kneel before her, looking up at her with as much sincerity as you can manage.
&lt;&lt;player&gt;&gt;I am sorry for disobeying you, there is no excuse for my behavior. I can only ask for your benevolence, ?Kathryn.&lt;&lt;/player&gt;&gt;
Another satisfied smirk flits across her face as you speak.
&lt;&lt;kathryn&gt;&gt;Good girl. But you need to learn how to control that ?dick before I release it.&lt;&lt;/kathryn&gt;&gt;
She turns away from you, and your eyes dart to her ass, the soft folds of her dress emphasizing her curvaceous figure.
&lt;&lt;kathryn&gt;&gt;How about we cage you for an entire week now? As punishment for your disobedience.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;player&gt;&gt;An entire week?&lt;&lt;/player&gt;&gt;
She whirls around abruptly, fixing you with a look that steals every ounce of rebellion in your body.
&lt;&lt;kathryn&gt;&gt;Yes, a full seven-day period. Should you wish to be released sooner you can always ask but I think it is important that you learn control.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;decision &#39;Accept&#39; submissiveness large&gt;&gt;
    &lt;&lt;acknowledgechanges chastity kathryn&gt;&gt;
    &lt;&lt;startquest &#39;kathryn-chastity-week&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Uhm- Okay, I will do it, ?Kathryn.&lt;&lt;/player&gt;&gt;
    Her eyes stay fixed to your for a moment, evaluating your sincerity.
    &lt;&lt;kathryn&gt;&gt;Good. I&#39;m glad you&#39;re taking this necessary journey to control your urges.&lt;&lt;/kathryn&gt;&gt;

    &lt;&lt;if isInChastity()&gt;&gt;
        &lt;&lt;kathryn&gt;&gt;Come find me in a weeks time. I&#39;ll be proud if you make it.&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;kathryn&gt;&gt;Time to lock you up then. Come find me in a weeks time. I&#39;ll be proud if you make it.&lt;&lt;/kathryn&gt;&gt;
        After only a few moments she has your ?dick locked up again. You look down in shame at the &lt;&lt;= $chastity.color&gt;&gt; cage.
        &lt;&lt;equipchastity&gt;&gt;
    &lt;&lt;/if&gt;&gt;

     She nods to you and takes her leave.
    &lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Decline&#39; dominance medium&gt;&gt;
    &lt;&lt;player&gt;&gt;I- I&#39;m sorry, ?Kathryn, I can&#39;t... A week is far too long...&lt;&lt;/player&gt;&gt;
    She looks at you and scowls. 
    &lt;&lt;kathryn&gt;&gt;Well, that&#39;s disappointing... I suppose it&#39;s difficult for you to let go of your perverted urges.&lt;&lt;/kathryn&gt;&gt;
    She looks of in the distance, contemplating something.
    &lt;&lt;kathryn&gt;&gt;Very well, I won&#39;t force you if you don&#39;t want to, I suppose.&lt;&lt;/kathryn&gt;&gt;
    
     She nods to you and takes her leave.
    &lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="162" name="Kathryn Punishment Chastity Week In Progress" tags="spicy" position="225,2100" size="100,100">&lt;&lt;acknowledgechanges chastity kathryn&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Actually- I think I will forgo your punishment for now.&lt;&lt;/kathryn&gt;&gt;
You&#39;re looking at her with a puzzled expression.
&lt;&lt;kathryn&gt;&gt;You seem to already be suffering enough from having to deal with chastity for a week.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;if !isInChastity()&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;That does mean we&#39;ll have to lock up that ?penis again.&lt;&lt;/kathryn&gt;&gt;
    She quickly has your ?dick locked up again. You look down in shame at the &lt;&lt;= $chastity.color&gt;&gt; cage.
    &lt;&lt;equipchastity&gt;&gt;
&lt;&lt;/if&gt;&gt;
She looks at you with an almost kind expression.
&lt;&lt;kathryn&gt;&gt;To be honest... I don&#39;t really mind you peeking on me now that you&#39;re all docile with your ?dick being locked away like it should be.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="163" name="Kathryn Punishment Humiliation" tags="spicy" position="350,2100" size="100,100">&lt;&lt;acknowledgechanges chastity kathryn&gt;&gt;
She sits down next to you on your bed and gives you a smile.
&lt;&lt;kathryn&gt;&gt;You know, ever since you&#39;ve been obediently wearing that little cage around your ?dick, I really don&#39;t mind you peeping on me anymore.&lt;&lt;/kathryn&gt;&gt;
You&#39;re not sure what to respond but it also seems she&#39;s not really looking for a response. She looks away from you as she continues her tangent.
&lt;&lt;kathryn&gt;&gt;In fact, I must admit that I actually welcome having you as an audience. Being observed while fulfilling my carnal desires adds something...even more enticing, apparently.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;kathryn&gt;&gt;The problem was that having a perverted man peek from the bushes while he&#39;s stroking his ?dick felt wrong...&lt;&lt;/kathryn&gt;&gt;
She makes eye contact with you again and gives you a scrutinizing look. Once again, she doesn&#39;t seem interested in what you think about this and you know to shut before she asks you something.
&lt;&lt;kathryn&gt;&gt;But that&#39;s the whole point, isn&#39;t it? You&#39;re not really a man anymore, are you? Your ?dick locked up like that, that&#39;s not something a &lt;em&gt;real&lt;/em&gt; man would do.&lt;&lt;/kathryn&gt;&gt;
She suddenly reaches closer to you and whispers in your ear.
&lt;&lt;kathryn&gt;&gt;I want you to admit it, ?titleK. Tell me you&#39;re not a real man anymore. That&#39;s your punishment.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;decision &#39;Tell her what she wants to hear&#39; submissiveness small&gt;&gt;
    You audibly gulp before you start talking.
    &lt;&lt;player&gt;&gt;Uhm- Y- You&#39;re right... I&#39;m not a real man... I&#39;m a pathetic excuse for one with a locked up ?dick...&lt;&lt;/player&gt;&gt;
    She smiles at you as she reaches back, almost looking proud of you.
    &lt;&lt;kathryn&gt;&gt;Good! Doesn&#39;t that feel much better to admit?&lt;&lt;/kathryn&gt;&gt;
    She gets up from the bed, and looks you up and down, taking note of your locked up ?dick.
    &lt;&lt;kathryn&gt;&gt;I suppose that&#39;s all for today. Why don&#39;t you think about what I said?&lt;&lt;/kathryn&gt;&gt;
    She turns around and heads for the door.
    &lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Decline&#39; dominance small&gt;&gt;
    &lt;&lt;player&gt;&gt;I- I&#39;m sorry, ?Kathryn, I can&#39;t...&lt;&lt;/player&gt;&gt;
    She looks at you and scowls. 
    &lt;&lt;kathryn&gt;&gt;Ah, don&#39;t worry ?titleK, you&#39;ll admit to it soon enough.&lt;&lt;/kathryn&gt;&gt;
     She nods to you and takes her leave.
    &lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="164" name="Kathryn Punishment Chastity" tags="spicy" position="475,2100" size="100,100">&lt;&lt;acknowledgechanges chastity kathryn&gt;&gt;
She walks closer to you, clearly holding the chastity cage in her hand.
&lt;&lt;kathryn&gt;&gt;Well you know how this works, you&#39;ve been peeking on me again so now you&#39;re going in chastity again.&lt;&lt;/kathryn&gt;&gt;
You watch as she simply grabs your ?dick in a fluid motion and jams it inside the cage. It hurts but that doesn&#39;t seem to make her care.?nl
After only a few moments she has your ?dick locked up again. You look down in shame at the &lt;&lt;= $chastity.color&gt;&gt; cage.
&lt;&lt;img &#39;chastity/chastity.jpg&#39; &#39;ridge-border&#39; &#39;15em&#39;&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Your ?dick feels so much more at home in that cage...&lt;&lt;/kathryn&gt;&gt;
Before you can even respond she walks out your bedroom with the key to your locked cage.
&lt;&lt;equipchastity&gt;&gt;
&lt;&lt;include &#39;Kathryn End Visit&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="165" name="Kathryn End Visit" tags="spicy" position="600,2100" size="100,100">&lt;&lt;if settings.sph&gt;&gt;
    &lt;&lt;decision &#39;Masturbate thinking about what just happened&#39;&gt;&gt;
        You grab your ?dick with two fingers and start to massage it up and down. You feel a very strange combination of shame and lust as you think back on how she laughed at your pathetic excuse of a penis.?nl
        &lt;&lt;if settings.vids&gt;&gt;
            &lt;&lt;video &#39;player/masturbate_sph.webm&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        Would she actually go and tell everyone how little it is? How you are just a pathetic excuse of a man who can&#39;t use his ?dick for anything? What if she told ?Rosa, what would she think of you knowing you&#39;re hiding mostly empty space in your underwear? ?nl
        It doesn&#39;t take long for you to cum while thinking about these things, in fact, you would guess you masturbated for only around fifteen seconds after she left and now you are spurting cum over yourself. ?nl
        &lt;&lt;if settings.cum&gt;&gt;
            &lt;&lt;decision &#39;Eat your cum&#39;&gt;&gt;
                &lt;&lt;if settings.vids&gt;&gt;
                    &lt;&lt;video &#39;player/swallow{2}.webm&#39;&gt;&gt;
                &lt;&lt;/if&gt;&gt;
                Even though the feelings of shame hit you harder after climax, you are just too horny to let your cum go to waste so you gather it up and slowly lift it to your mouth as you feel your own semen slide down your throat. Being a cum-slut is much more efficient cleaning after masturbating.
                &lt;&lt;decisiongroup 1&gt;&gt;
                &lt;&lt;addstat depravity small&gt;&gt;
            &lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;decisiongroup 1&gt;&gt;
        &lt;&lt;addstat depravity small&gt;&gt;
        &lt;&lt;disableif isInChastity()&gt;&gt;
            You are locked in chastity.
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &#39;Start your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="166" name="Kathryn Visit After Sex" tags="" position="725,2100" size="100,100">Just as you&#39;re about to drift to sleep, you get woken up by someone walking into your room. Even though she told you she&#39;d be visiting, it still startles you slightly.?nl
?Kathryn walks over to your bed with a big, naughty smile on her face. She&#39;s wearing the exact same thing as she was earlier in the gazebo and noticeably, she has not taken the time to fix her dress much.?nl
A single strap is hanging loose and half the skirt of her dress is still hiked up. Her make-up is not looking much better, her lipstick smeared and her mascara slightly out of place. She genuinely looks like she just finished getting railed by &lt;&lt;noble&gt;&gt;.

&lt;&lt;kathryn&gt;&gt;Hey ?titleK, already sleeping are you? Didn&#39;t I tell you I&#39;d be visiting?&lt;&lt;/kathryn&gt;&gt;

You groggily respond to her&lt;&lt;first&gt;&gt;, not really sure why she&#39;s here&lt;&lt;/first&gt;&gt;.
&lt;&lt;player&gt;&gt;Uh, sorry ?Kathryn. I was feeling tired.&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;That&#39;s okay, this&#39;ll only take a moment. See, I brought you a present... I was hoping you could help me clean up something...&lt;&lt;/kathryn&gt;&gt;

She looks down towards where her dress scandalously reveals far too much of her private area and then looks back up at you with a wicked smile. She seems to wait a moment for you to allow her into your bed.

&lt;&lt;decision &#39;Let her into your bed&#39; depravity medium&gt;&gt;
    &lt;&lt;spicy&gt;&gt;

    &lt;&lt;include &#39;Kathryn Clean Cum&#39;&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Of course, sorry for getting quite a bit of the cum on your face but you don&#39;t really mind sleeping with that on, do you?&lt;&lt;/kathryn&gt;&gt;
    You silently give her a nod, feeling very worked up. She looks at you with a proud smiles and reaches down to give you a kiss on your forehead, gently avoiding any cum that&#39;s currently plastering your face. She turns around and retrieves her discarded panties before she leaves you alone.

    &lt;&lt;decision &#39;Continue sleeping&#39; &#39;Night&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Ask her to leave you alone&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Ah, sorry ?Kathryn... Can we do this some other time? I&#39;m really tired...&lt;&lt;/player&gt;&gt;
    She takes a step back and gives you a nod.

    &lt;&lt;kathryn&gt;&gt;Awh, fine, ?titleK. I suppose I&#39;ll clean up by myself then. Sleep tight, little ?prince.&lt;&lt;/kathryn&gt;&gt;

    &lt;&lt;decision &#39;Continue sleeping&#39; &#39;Night&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="167" name="Kathryn Clean Cum" tags="" position="850,2100" size="100,100">She walks closer to your bed and casually slips off her bright red panties, dropping them to the floor. She looks really excited as she climbs on top of you from the bottom side of the bed. She starts crawling up over your body, you look down as you can clearly her glistening vulva peeking out from under her dress.?nl
For a moment, you wonder whether she&#39;ll stop at the height of your groin, but that obviously doesn&#39;t make sense with your ?dick being locked up. She keeps going further and she immediately shocks you as she intentionally slides her wet snatch over your chastity cage, sending your ?dick reeling.
&lt;&lt;kathryn&gt;&gt;Hehe, oops... Too bad your ?dick is all locked up, isn&#39;t it?&lt;&lt;/kathryn&gt;&gt;
You make eye contact with her but are completely paralyzed by the current events. With that same playful smile she continues her movement until she reaches the headboard of your bed. She grabs it with both hands and raises her above you.?nl
She raises herself until your face is perfectly aligned with her wet pussy. 
&lt;&lt;kathryn&gt;&gt;There we go. Now, stick out your tongue, ?titleK...&lt;&lt;/kathryn&gt;&gt;
You follow the command obediently. It&#39;s at that moment that you actually notice something important. The glistening shine that her vulva gives looks a little... off... It definitely looks different from just her own arousal fluids. You now see there&#39;s an obvious white tint to the liquid...
&lt;&lt;kathryn&gt;&gt;Are you ready... I saved this up all for you... Be sure to clean all of it and to savour the flavour...&lt;&lt;/kathryn&gt;&gt;
Suddenly, the fluid drips down from inside her vagina and lands on your waiting tongue. Your suspicions are immediately confirmed, that&#39;s the bitter taste of cum. You are tasting &lt;&lt;noble&gt;&gt;&#39;s semen after he seems to have cum inside of ?Kathryn. Some of it drips into your mouth and you reflexively swallow it.
&lt;&lt;kathryn&gt;&gt;Ah, I felt it drip down, did you catch that? Good girl... Here, let me help you.&lt;&lt;/kathryn&gt;&gt;
She suddenly lowers her vulva to your mouth and you make direct contact with all of it. You immediately start licking out her pussy and you are rewarded with a huge amount of cum that you&#39;re lapping up and swallowing down.
&lt;&lt;kathryn&gt;&gt;Wow... You&#39;re really into this, aren&#39;t you? I knew you were a little cum-slut...&lt;&lt;/kathryn&gt;&gt;
Her words make you feel kind of proud as you continue diligently cleaning her pussy. It seems like &lt;&lt;noble&gt;&gt; came deep inside her and pulled out while he was still climaxing, spurting a final few waves over her entire vulva. ?Kathryn starts grinding down on your face, making some of the sperm spread all over you.
&lt;&lt;kathryn&gt;&gt;Ahh... That feels good... &lt;&lt;noble&gt;&gt; fucked me so deep and hard... It felt like he shot a &lt;em&gt;gallon&lt;/em&gt; of cum in there. I&#39;m glad you&#39;re here to clean it up, ?titleK.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;if settings.sph&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;I bet he came deeper inside me than you&#39;d ever be able to... His cock was at least three times the size of your pathetic ?penis, ?titleK.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;/if&gt;&gt;
Your ?dick is straining hard inside your little cage... You continue drinking down so much cum and it feels like it just keeps coming... The sperm tastes bitter and unpleasant but the sheer thought of doing this and being ?Kathryn&#39;s little cum-slut makes it all worth it.
&lt;&lt;kathryn&gt;&gt;Hmm... Good job, ?titleK...&lt;&lt;/kathryn&gt;&gt;
You feel like you got pretty much all of the cum off and out of her pussy. You swallowed down most of it and all you can taste is cum but some of your face is now also covered in it. ?Kathryn dismounts your face and stands up next to the bed, she looks down at you with a warm smile and puts a gentle hand on your head.
&lt;&lt;kathryn&gt;&gt;Well done, my little cum-slut... Now, show me you swallowed it all. Well, except for the cum that got on your face...&lt;&lt;/kathryn&gt;&gt;
You obediently open your mouth, showing her you indeed swallowed it.
&lt;&lt;player&gt;&gt;Thank you for letting me clean you...&lt;&lt;/player&gt;&gt;</tw-passagedata><tw-passagedata pid="168" name="Kathryn Chastity Week Complete" tags="" position="975,2100" size="100,100">&lt;&lt;addevent wake &#39;Kathryn Smithy Excursion Invite&#39;&gt;&gt;&lt;&lt;delay 5&gt;&gt;&lt;&lt;/addevent&gt;&gt;
&lt;&lt;completequest &#39;kathryn-chastity-week&#39;&gt;&gt;
&lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
You walk up to ?Kathryn with a proud gait. She makes eye contact with you from across the dining hall, it looks like she&#39;s already well aware of why you&#39;re there as she shows a sensual smile. Before you get close to her, she nudges to the doorway, casually making her way out of the dining hall with you following closely behind all the way to your bedroom. She opens the door and guides you inside, all the while not saying a single word and sporting that same proud smile.

&lt;&lt;kathryn&gt;&gt;I&#39;m proud of you, ?titleK. You actually did it! A full week of chastity... Very well done.&lt;&lt;/kathryn&gt;&gt;

She pushes you to sit down on the bed while sporting same wicked smile. She sits down next you, rather closely.

&lt;&lt;kathryn&gt;&gt;So how was it? Was it difficult to have your arousal kept in check like this?&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;It was... difficult sometimes, yes... I&#39;ve never done this for this long before...&lt;&lt;/player&gt;&gt;

She listens to you with full anticipation and you see something in her eyes that feels different... is hearing you talking about this actually... turning her on? She bites her lip slowly before she responds.

&lt;&lt;kathryn&gt;&gt;I&#39;m really happy you did this, ?titleK. This was a big step, and there&#39;s many more steps to go!&lt;&lt;/kathryn&gt;&gt;

Her lapse of whatever that feeling was seems to suddenly be replaced by excitement as she suddenly stands up, talking about the next steps.

&lt;&lt;kathryn&gt;&gt;I&#39;ve actually petitioned ?Andreas to let you have a small excursion with me into town. I think he&#39;ll need some more time to think it over, he&#39;s really careful about your safety but I&#39;ll probably have him convinced sooner than later.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;An excursion into town, what for exactly?&lt;&lt;/player&gt;&gt;

She smiles and shakes her head at you.

&lt;&lt;kathryn&gt;&gt;A &lt;em&gt;little&lt;/em&gt; reward since you completed this difficult week! Don&#39;t worry about the specifics right now, I&#39;ll come visit you soon enough once ?Andreas gives permission.&lt;&lt;/kathryn&gt;&gt;

You look at her confused, a reward sounds nice but you kind of want to ask more questions. She quickly moves on to the next topic at hand as she takes out a small key.

&lt;&lt;kathryn&gt;&gt;Now, you&#39;ve probably been dying to be let out of your cage. I can let you out right now if you want... or... if you want you can remain in the cage for a bit longer?&lt;&lt;/kathryn&gt;&gt;

Her question has a clear hint of anticipation. Whatever you choose you know she&#39;ll always let you out of the cage again if you ask her later.

&lt;&lt;decision &#39;Ask to be unlocked&#39;&gt;&gt;
    &lt;&lt;unequipchastity&gt;&gt;
    &lt;&lt;player&gt;&gt;Ah, I would really like to be unlocked...&lt;&lt;/player&gt;&gt;

    &lt;&lt;kathryn&gt;&gt;Of course, ?titleK, you deserve it.&lt;&lt;/kathryn&gt;&gt;

    She deftly exposes your caged ?penis and unlocks you cage, letting your ?penis spring free.

    &lt;&lt;kathryn&gt;&gt;I haven&#39;t seen that ?dick in a while now... Well, you go have fun with that, I better get back. I&#39;ll come visit you shortly for our little excursion.&lt;&lt;/kathryn&gt;&gt;

    She walks back out of your bedroom, leaving you alone.

    &lt;&lt;decision &#39;Return to your bedroom&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Remain in chastity&#39; submissiveness large&gt;&gt;
    &lt;&lt;player&gt;&gt;Uhm, I suppose I could stay caged for a bit longer...&lt;&lt;/player&gt;&gt;

    &lt;&lt;kathryn&gt;&gt;Awwh, you&#39;re so used to this now, I love it!&lt;&lt;/kathryn&gt;&gt;

    She quickly hides away the key and leans over to give you a quick kiss on the cheeks.

    &lt;&lt;kathryn&gt;&gt;Well, I better get back. I&#39;ll come visit you shortly for our little excursion.&lt;&lt;/kathryn&gt;&gt;

    She walks back out of your bedroom, leaving you alone.

    &lt;&lt;decision &#39;Return to your bedroom&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="169" name="Kathryn Smithy Excursion Invite" tags="" position="1100,2100" size="100,100">&lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
&lt;&lt;startquest &#39;kathryn-chastity-excursion&#39;&gt;&gt;
You groggily get out of your bed and open the door to find ?Kathryn there, looking at you with a raised eyebrow. She looks you up and down, obviously noting how you are still in your sleeping clothes.

&lt;&lt;if hasEquipmentTag(&#39;feminine&#39;, &#39;underwear&#39;)&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Still wearing the panties, I see. Good, they fit you much better, don&#39;t they?&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Isn&#39;t it time for you to get rid of that manly underwear and just wear the panties I gave you?&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;/if&gt;&gt;
You ignore her snide comment and quickly start changing into your clothes. She steps into your bedroom as you move to your wardrobe.

&lt;&lt;kathryn&gt;&gt;Did you only just wake up? It&#39;s well in the morning already, ?titleK.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;Well, yeah... Why are you here anyways, ?Kathryn?&lt;&lt;/player&gt;&gt;

She shrugs her shoulders and looks back at you while you&#39;re putting on clothes. She sits down on your bed while she waits for you to finish dressing.

&lt;&lt;kathryn&gt;&gt;What, can&#39;t I simply visit my favorite little prince without being questioned about it?&lt;&lt;/kathryn&gt;&gt;

As you&#39;re struggling to put on pants you look at her with a suspicious look for a moment.

&lt;&lt;player&gt;&gt;Seeing as you usually just visit me in the morning to abruptly pull my blankets off and humiliate me, I&#39;m sure you&#39;ve got some ulterior motive now...&lt;&lt;/player&gt;&gt;

She rolls her eyes at you and sighs, relenting to get to the point. 

&lt;&lt;kathryn&gt;&gt;Fine. I actually came to give you some good news. I talked to ?Andreas and he has agreed to let me take you on an excursion into town.&lt;&lt;/kathryn&gt;&gt;

You give her an even more suspicious look.

&lt;&lt;player&gt;&gt;You never told me why we&#39;re going into town, what are we going to do there?&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;We&#39;ll just be giving a visit to the town blacksmith, ?Beau, that&#39;s all.&lt;&lt;/kathryn&gt;&gt;

Yo&#39;re quite confused by her plan until you remember that she actually commissioned ?Beau to make your chastity cage. &lt;&lt;if isInChastity()&gt;&gt;The one that you are wearing right now...&lt;&lt;/if&gt;&gt; You audibly gulp as part of her plan now dawns on you. You lower your voice as you continue to ask her questions.

&lt;&lt;player&gt;&gt;Uhm so is this excursion related to my- uhm- &lt;em&gt;cage&lt;/em&gt;? Is this really necessary?&lt;&lt;/player&gt;&gt;

She gives you a sly smile. She seems to be satisfied that you mention this.

&lt;&lt;kathryn&gt;&gt;Yes. We&#39;re going on a little excursion because I think it&#39;s time to get you a reward. It&#39;s time to get you a brand new chastity cage. I think it&#39;s good for you to see the artistry ?Beau puts into these things first-hand. She is very proficient at this and can make any adjustments necessary to make one fit you &lt;em&gt;perfectly&lt;/em&gt;.&lt;&lt;/kathryn&gt;&gt;

You are quite dumbstruck by the idea. She&#39;s really suggesting that you come with her to the blacksmith so that she can find you a new chastity cage as if it&#39;s the same as fitting some new clothes!?nl

While you&#39;re contemplating how to respond to this, ?Kathryn stands up and walks over to your door.

&lt;&lt;kathryn&gt;&gt;Well I see you&#39;ll have to thinks things over. Why don&#39;t you come find me in the afternoon when you&#39;re ready to go on our trip into town and I&#39;ll have a guard escort ready for us.&lt;&lt;/kathryn&gt;&gt;

Unsure what to say, she waves you goodbye as you&#39;ve finally finished dressing yourself. She exits your room, leaving you alone to think about this. Something inside of you is actually curious about this excursion but you know for sure it&#39;s going to be humiliating...

&lt;&lt;decision &#39;Go on with your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="170" name="Kathryn Smithy Excursion 1" tags="" position="1225,2100" size="100,100">&lt;&lt;completequest &#39;kathryn-chastity-excursion&#39;&gt;&gt;
You walk over to ?Kathryn as she&#39;s preparing the dining hall for another dinner party.
&lt;&lt;kathryn&gt;&gt;Oh hey ?titleK. Are you ready for our excursion?&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;player&gt;&gt;Uhm... Yes, I&#39;m ready, ?Kathryn...&lt;&lt;/player&gt;&gt;
She smiles at you and takes you arm, immediately dragging you out of the dining hall.
&lt;&lt;kathryn&gt;&gt;Great! I&#39;ll leave the servants to their preparations. Let&#39;s get the guards and then we&#39;re ready to go!&lt;&lt;/kathryn&gt;&gt;

You&#39;re walking towards the exit of the castle when she suddenly drags you to a little alcove and whispers at you.

&lt;&lt;kathryn&gt;&gt;There&#39;s one more thing necessary before we go...&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;if isInChastity()&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Lower your pants, ?titleK. Show me that cage you&#39;re wearing around your ?dick.&lt;&lt;/kathryn&gt;&gt;
    You&#39;re suddenly blushing hard as she forced you into this corner. Though you don&#39;t find yourself opposing, there&#39;s a reason why you accepted to go with her on this trip after all.?nl
    You awkwardly lower your pants slightly and try to discreetly show her the cage you are wearing.
    &lt;&lt;player&gt;&gt;There... Happy now?&lt;&lt;/player&gt;&gt;
    She suddenly grabs your cage and gives it a good tug, giggling softly.
    &lt;&lt;kathryn&gt;&gt;Definitely, look at that cute thing! &lt;&lt;if hasEquipmentTag(&#39;feminine&#39;, &#39;underwear&#39;)&gt;&gt;It fits perfectly in those cute panties.&lt;&lt;else&gt;&gt;Too bad you&#39;re not wearing panties along with it.&lt;&lt;/if&gt;&gt;&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Lower your pants, ?titleK. We need to put on your cage before we go out.&lt;&lt;/kathryn&gt;&gt;
    You&#39;re suddenly blushing hard as she forced you into this corner. Though you don&#39;t find yourself opposing, there&#39;s a reason why you accepted to go with her on this trip after all.?nl
    You awkwardly lower your pants slightly and try to discreetly reveal your ?penis.?nl
    She deftly gets to work as she puts the chastity cage on your ?cock. You once again feel the familiar containment settling in.
    &lt;&lt;kathryn&gt;&gt;There we go! Locked up like it should be! &lt;&lt;if hasEquipmentTag(&#39;feminine&#39;, &#39;underwear&#39;)&gt;&gt;It fits perfectly in those cute panties.&lt;&lt;else&gt;&gt;Too bad you&#39;re not wearing panties along with it.&lt;&lt;/if&gt;&gt;&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;Great...&lt;&lt;/player&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Alright, time to get going, ?titleK.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;decision &#39;Head to the gatehouse&#39; &#39;Kathryn Smithy Excursion 1b&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="171" name="Kathryn Smithy Excursion 1b" tags="" position="100,2225" size="100,100">&lt;&lt;setlocation &#39;Gatehouse&#39;&gt;&gt;
She drags you along again as you continue your journey further down the hallway. You make your way over to the gatehouse where ?Kathryn starts commanding some knights, asking for the agreed upon guard escort.?nl

You have to wait a little while when you suddenly see ?Caspar walking in your direction together with three other guards. He salutes you and bows to ?Kathryn, who only looks annoyed back.

&lt;&lt;caspar&gt;&gt;G- greetings, ?title. &lt;&lt;fullname kathryn&gt;&gt;. I have been ordered by &lt;&lt;fullname andreas&gt;&gt; to lead the knights to keep you safe on your trip into town today.&lt;&lt;/caspar&gt;&gt;

You give ?Caspar a salute back, you didn&#39;t expect him to be the one to escort you today. You hope he doesn&#39;t find out the reason why you&#39;re going to the blacksmith today...

&lt;&lt;kathryn&gt;&gt;Great, who&#39;s idea was it to have &lt;em&gt;you&lt;/em&gt; protect us, &lt;&lt;title caspar &#39;little brother&#39;&gt;&gt;? Was there no one else available? Ugh- well whatever, are we finally ready to go then?&lt;&lt;/kathryn&gt;&gt;

?Caspar seems to visibly be hurt by his sister&#39;s comments but decides to keep it professional.

&lt;&lt;caspar&gt;&gt;Uhm- Yes. Please follow me, ?title.&lt;&lt;/caspar&gt;&gt;

?Caspar awkwardly orders the guards at the gate to open it and let us through. He takes his soldiers outside the castle and waits for you to join him. You hadn&#39;t heard ?Caspar being allowed to lead any soldiers before so this must be quite a serious assignment for him, even though in reality it&#39;s just a simple walk.


&lt;&lt;decision &#39;Exit the castle&#39; &#39;Kathryn Smithy Excursion 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="172" name="Kathryn Smithy Excursion 2" tags="" position="225,2225" size="100,100">&lt;&lt;setlocation &#39;Road&#39;&gt;&gt;
You leave the castle together with ?Kathryn and your sizeable bodyguard contingent, including ?Caspar. It feels good to be outside without a disguise on again even though you&#39;re bringing a whole parade with you.

&lt;&lt;kathryn&gt;&gt;I wish we could leave with just the two of us but this was the only way ?Andreas would agree to this.&lt;&lt;/kathryn&gt;&gt;

?Caspar is walking some distance ahead of you, giving you some privacy in the conversation.

&lt;&lt;player&gt;&gt;I suppose it&#39;s good to be careful. Are you actually disappointed that your brother is escorting us?&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Ah not really, I was just teasing him. ?Caspar&#39;ll do fine, not like anything actually dangerous is going to happen today.&lt;&lt;/kathryn&gt;&gt;

She suddenly steps closer to you, taking your arm as you walk together. She gestures around to the other knights sent to escort you together with ?Caspar.

&lt;&lt;kathryn&gt;&gt;Besides, we&#39;ve got these three other strong knights here to protect us.&lt;&lt;/kathryn&gt;&gt;

She turns to you while walking and softly whispers to you.

&lt;&lt;kathryn&gt;&gt;Those big strong knights, how do you think they&#39;d respond when they find out you&#39;re wearing a little cage around your ?penis?...&lt;&lt;/kathryn&gt;&gt;

You immediately start visibly blushing as you hear her humiliating words and your dumbstruck face is enough of a response for ?Kathryn so she continues walking as if nothing happened.?nl

As you&#39;re making your way down the road, ?Caspar shouts out to the other knights. 

&lt;&lt;caspar&gt;&gt;Keep your eyes peeled, guards! This is the spot where the ?Prince was ambushed before.&lt;&lt;/caspar&gt;&gt;

?Kathryn sighs loudly and shouts back at ?Caspar.

&lt;&lt;kathryn&gt;&gt;Always so dramatic, little brother! I&#39;m sure these knights know what to look out for.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;caspar&gt;&gt;&lt;&lt;fullname kathryn&gt;&gt;, p- perhaps you could you refrain from calling me little brother all the time-&lt;&lt;/caspar&gt;&gt;

You feel ?Kathryn is ready to shout back another snide remark. To avoid whole brother-sister fight from taking place you decide to quickly interject.

&lt;&lt;player&gt;&gt;Uhm, you&#39;re right ?Caspar, this was the spot! Thank you for your vigilance, I greatly appreciate it.&lt;&lt;/player&gt;&gt;

You see ?Caspar change from annoyed to suddenly wear a proud demeanor. ?Kathryn looks at you with a slightly annoyed expression but leaves it be.

&lt;&lt;caspar&gt;&gt;Certainly, ?title. It also looks like we&#39;re almost in town!&lt;&lt;/caspar&gt;&gt;

&lt;&lt;decision &#39;Walk to the smithy&#39; &#39;Kathryn Smithy Excursion 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="173" name="Kathryn Smithy Excursion 3" tags="" position="350,2225" size="100,100">&lt;&lt;setlocation &#39;Town square&#39;&gt;&gt;
Together with your entourage, you make your way through the town square. And like you normally do, you draw quite some attention. The street is busy today, though everyone quickly makes way for the royal escort. You hear townsfolk talk to each other, curiously discussing your presence. You can clearly hear the voice of a man who nudges the woman next to him and points her to your presence.

&lt;&lt;say &#39;Townsman&#39;&gt;&gt;Oi, see that? The ?Prince is back in town! Together with ?LadyKathryn even!&lt;&lt;/say&gt;&gt;

The woman looks up from her market stall and gives you a scrutinizing look as you walk by.

&lt;&lt;say &#39;Townswoman&#39;&gt;&gt;Strange that, these days I only see the chap when ?he goes to church on Sunday mornin&#39;... Wonder what ?he&#39;s &#39;ere for.&lt;&lt;/say&gt;&gt;

You try not to make eye contact with anyone as you slowly make your way through the crowd that&#39;s silently parted by royal knights. ?Kathryn holds your arm and you look at her face when she smiles at you. You attempt to mimic her but find doubt taking over, insecurity creeping up on you.

&lt;&lt;kathryn&gt;&gt;Don&#39;t worry, ?titleK, we&#39;re almost there.&lt;&lt;/kathryn&gt;&gt;

You nod at her and turn your gaze forwards. The mass of people makes way to reveal your intended target. The red glow of the forge is very visible, even from outside the dark cobblestone building. The smithy has a prominent location right next to the town square. ?Beau&#39;s work really is the jewel of this town. Knights far and wide come to her for her master craftsmanship. And apparently, princes looking to lock up their penises do too...?nl

The royal escort comes to a halt outside the smithy. ?Caspar nods to one of your knights who then moves to enter the place, presumably announcing your arrival. A moment later, you see some would-be customers hurrying out of the store, their visit cut short by your presence.

&lt;&lt;kathryn&gt;&gt;Perhaps, little brother, you would be so kind as to leave us alone inside? The ?Prince and I have some &lt;em&gt;private&lt;/em&gt; business to attend to together with the blacksmith.&lt;&lt;/kathryn&gt;&gt;

It seems like ?Caspar was hoping to keep a watchful gaze on you while you went in there but you are definitely happy ?Kathryn is setting boundaries, even though she&#39;s being a bit harsh on him.

&lt;&lt;caspar&gt;&gt;Oh- I&#39;m afraid that&#39;s a difficult request- I am in charge of your safekeeping, if something were to happen to ?title while you are in there-&lt;&lt;/caspar&gt;&gt;

?Kathryn quickly cuts of her sibling and reiterates her point more sternly.

&lt;&lt;kathryn&gt;&gt;Perhaps I was unclear. The ?Prince is ordering you and your knights to stay outside and keep watch here.&lt;&lt;/kathryn&gt;&gt;

?Caspar looks at her and then turns to you, expectantly waiting to hear it from you as well.

&lt;&lt;player&gt;&gt;Uhm- yes, ?LadyKathryn is right. You&#39;re better suited securing the place from outside, ?Squire. We&#39;ll be fine in there.&lt;&lt;/player&gt;&gt;

?Caspar nods to you and gives a proud salute. His awkwardness quickly fading now that you&#39;ve given him his order.?nl

The single knight who entered steps back outside, signalling that the place is secure, and moves to stand with the others to guard outside the door.

&lt;&lt;decision &#39;Head inside the Smithy&#39; &#39;Kathryn Smithy Excursion 4&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="174" name="Kathryn Smithy Excursion 4" tags="" position="475,2225" size="100,100">&lt;&lt;setlocation &#39;Smithy&#39;&gt;&gt;

?Kathryn steps inside the blacksmith as you follow closely behind her. You are immediately met with the heat of the forge. Blazingly hot, ?Beau looks to be in the middle of forging a new helmet, but seems to have put the project aside in order to welcome you to her store.?nl

You are hit by the beautiful shine from a dozen different sets of plate armour, intricate detail-work make each breastplate feel entirely unique. At the far end of the awe-inspiring smithy stands the maker. ?Beau greets you with a warm smile and a loud voice.

&lt;&lt;beau&gt;&gt;?LadyKathryn! ?Title! Welcome to my smithy! It&#39;s a rare treat to receive a royal visit to my little slice of heaven!&lt;&lt;/beau&gt;&gt;

?Beau bows to the both of you and in doing so unintentionally reinforces your perception of how much her large form towers over you. She is a hulk of a woman, thick muscled arms like tree-trunks, large calloused hands from working the forge all day, and a contrastingly warm smile to go with it. A large, friendly giant, who blesses the kingdom simply by being there.

&lt;&lt;kathryn&gt;&gt;?Beau, it&#39;s good to see you again! Sorry for interrupting your work. We won&#39;t be long, I promise.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;beau&gt;&gt;Ah, nonsense! Stay as long as you like, I have all the time in the world for you now that you&#39;ve brought the ?Prince along, hahahaha! What can I help you with today?&lt;&lt;/beau&gt;&gt;

?Beau&#39;s booming laugh echoes through the shop and only when she asks her question do you start to consider the logistics on this excursion. Surely ?Kathryn doesn&#39;t plan to be so blunt about this and put you in an awkward position. In utmost faith, you let her do the talking, curious how she&#39;s going to spin this in a way to not reveal that you are the one who you&#39;re shopping a new chastity cage for.

&lt;&lt;kathryn&gt;&gt;Yes, it&#39;s about the custom order I commissioned you for recently. It truly is beautiful craftsmanship and works perfectly as intended. Though, the only issue I noticed is that I made a slight error when I gave you the measurements. That is why I&#39;d like to hire you again for a brand new one.&lt;&lt;/kathryn&gt;&gt;

?Beau has a beaming smile as ?Kathryn compliments her work. Strange though, she didn&#39;t mention anything to you about an error in the measurements...

&lt;&lt;beau&gt;&gt;Glad to hear you&#39;re happy with the work, my ?Lady. I&#39;m even more glad to hear it&#39;s working as intended and you haven&#39;t suffered any &lt;em&gt;breach of containment&lt;/em&gt;! Hahaha!&lt;&lt;/beau&gt;&gt;

?Beau lets out another bellowing chortle and ?Kathryn is quickly infected by the iconic laugh. You awkwardly laugh along while you&#39;re still doubting what the joke was exactly...

&lt;&lt;beau&gt;&gt;Good stuff! You&#39;re here for a new commission then? I can get started right away, I have some models in the back I could modify to easily fit your requirements!&lt;&lt;/beau&gt;&gt;

?Kathryn responds quickly while you stand there, looking around the store and hoping to distract yourself from the humiliating contents of this conversation. All that needs to happen now is for ?Kathryn to give her your measurements again and then you can be done with this right after she receives your new cage. Easy stuff.

&lt;&lt;kathryn&gt;&gt;Splendid! This time I thought it&#39;d be easier if I just bring the ?Prince along ?himself so we can just take the measurements here instead of me writing them down for you.&lt;&lt;/kathryn&gt;&gt;

Wait. What. You&#39;re slowly processing the situation as ?Beau looks at you and nods. So ?Kathryn already told her the chastity cage is for you? Do they really expect you to expose yourself right here in her store so she can take some measurements of your ?dick?!

&lt;&lt;beau&gt;&gt;Well planned, ?Lady! We can do the measurements right now!&lt;&lt;/beau&gt;&gt;

?Beau and ?Kathryn both turn to you, smiling expectantly. You look back and forth between them with a flabbergasted look on your face. Is this really happening?

&lt;&lt;player&gt;&gt;Wh- What? You can&#39;t be serious, do you really want me to expose myself right here in the middle of the shop??&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Oh don&#39;t be dramatic, ?titleK. ?Beau is a professional, she&#39;s used to helping her clients out like this. We also have the entire store to ourselves right now, the knights outside will make sure nobody comes in unexpectedly.&lt;&lt;/kathryn&gt;&gt;

You look embarrassingly around the place, avoiding eye contact. Unsure how to go about this, maybe you should&#39;ve expected it to go something like this when going with ?Kathryn.

&lt;&lt;beau&gt;&gt;Fear not, ?title. I keep utmost discretion on the private business with any of my clients. I am simply here to share my expertise, of course ?Kathryn can be the one taking the measurements.&lt;&lt;/beau&gt;&gt;

?Kathryn nods at you with a thin smile. She probably expected you to go along with this so easily and the rough part is that she&#39;s actually right... You&#39;re here now and you might as well go along with it...

&lt;&lt;decision &#39;Resign to your fate&#39; &#39;Kathryn Smithy Excursion 5&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="175" name="Kathryn Smithy Excursion 5" tags="" position="600,2225" size="100,100">You sigh and look down to the floor, secretly kind of excited by the situation.

&lt;&lt;player&gt;&gt;F- fine... Let&#39;s get this over with...&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Perfect, let me help you, ?titleK.&lt;&lt;/kathryn&gt;&gt;

Immediately, ?Kathryn walks over to you, kneels down in front of you, and starts undoing your pants. Having a beautiful woman excitedly lowering your pants for you would normally be an extremely hot situation but it feels much more embarrassing if it&#39;s just to get you a new cage. Not to mention she&#39;s currently freeing your ?penis, tucked away in your current cage.?nl

She lowers your pants with much anticipation and you see her smile grow as she reveals your ?penis, safely locked away in it&#39;s cage. 

&lt;&lt;img &#39;chastity/chastity_check.gif&#39; &#39;ridge-border&#39; &#39;15em&#39;&gt;&gt;

&lt;&lt;beau&gt;&gt;Hah, wonderful to see it in action, that&#39;s some fine craftsmanship if I say so myself! Hahaha!&lt;&lt;/beau&gt;&gt;

?Kathryn takes hold of your caged ?dick and tilts it up slightly.

&lt;&lt;kathryn&gt;&gt;Certainly, it&#39;s a beautiful cage, ?Beau. But do you see what I meant earlier, there&#39;s &lt;&lt;if settings.sph&gt;&gt;a lot of &lt;&lt;/if&gt;&gt; empty space in there. It looks like the cage is &lt;&lt;if settings.sph&gt;&gt;much&lt;&lt;/if&gt;&gt; too big for the ?Prince&#39;s ?penis.&lt;&lt;/kathryn&gt;&gt;

?Beau leans down to take a closer look at your crotch. You feel your cheeks redden as everyone in the room is completely fixated on your caged ?cock, closely inspecting it.

&lt;&lt;beau&gt;&gt;Ah, I see what you mean ?LadyKathryn. I&#39;m very sorry, this cage is a standard model I altered to fit your measurements. &lt;&lt;if settings.sph&gt;&gt;In fact, I think it&#39;s the smallest model I have in my store...&lt;&lt;/if&gt;&gt; It seems like the ?Prince requires something &lt;&lt;if settings.sph&gt;&gt;&lt;em&gt;even&lt;/em&gt;&lt;&lt;/if&gt;&gt; smaller.&lt;&lt;/beau&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Yes... It looks like it, is that going to be a problem? &lt;&lt;if settings.sph&gt;&gt;I hope his ?penis is not too small to work with.&lt;&lt;/if&gt;&gt;&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;beau&gt;&gt;Fear not, it&#39;s always possible to make the cage smaller! I&#39;ll bring out some models I can modify to fit &lt;&lt;if settings.sph&gt;&gt;even&lt;&lt;/if&gt;&gt; you perfectly, ?title! ?LadyKathryn, why don&#39;t you start with getting new measurements in the meantime?&lt;&lt;/beau&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Sounds like a plan!&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;decision &#39;Have your ?penis measured again&#39; &#39;Kathryn Smithy Excursion 6&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="176" name="Kathryn Smithy Excursion 6" tags="" position="725,2225" size="100,100">&lt;&lt;unequipchastity&gt;&gt;

?Beau disappears in the back of the store while ?Kathryn takes out the small key and unlocks your cage. You feel your ?penis get used to no longer being confined as she takes off the contraption.

&lt;&lt;player&gt;&gt;You could&#39;ve told me ?Beau knew the chastity cage was for me...&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Oh hush, ?titleK. I thought you&#39;d enjoy the humiliation of the moment, much better to leave it a surprise...&lt;&lt;/kathryn&gt;&gt;

You blush and look away as she gives your ?dick a soft flick, emphasizing how you&#39;ve already started hardening now that you&#39;re out of the cage.

&lt;&lt;kathryn&gt;&gt;What, cat caught your tongue? Your little friend here seems to agree with me... Unfortunately I&#39;m going to need it to soften completely for me to get accurate measurements.&lt;&lt;/kathryn&gt;&gt;

She unexpectedly gives a quick tug on your scrotum, not hard but definitely hurting.

&lt;&lt;player&gt;&gt;Ow! Stop that!&lt;&lt;/player&gt;&gt;

Your ?dick seems to have her desired effect as it clearly softens.

&lt;&lt;kathryn&gt;&gt;Sorry, ?titleK, looks like it&#39;s working though. Let me get a quick measurement...&lt;&lt;/kathryn&gt;&gt;

?Kathryn takes out a measuring tape and holds it next to your flaccid ?penis.
&lt;&lt;if settings.vids&gt;&gt;
    &lt;&lt;if settings.sph&gt;&gt;
        &lt;&lt;video &#39;kathryn/kathryn_measuring_sph.webm&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;video &#39;kathryn/kathryn_measuring.webm&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Just need to get your flaccid length from the topside and base circumference of your whole genitals. You&#39;re used to this, ?titleK.&lt;&lt;/kathryn&gt;&gt;

She skillfully uses the measuring lint to size up your ?penis. She first measures the length of your entire ?penis from the topside. Afterwards, she grabs your scrotum and penis and wraps the measuring tape around the base of your entire genitals, measuring the circumference. This last measurement is probably to get a good size of the ring that your genitals are squeezed through and is attached to the chastity cage to keep it safely locked in place.?nl

&lt;&lt;if settings.sph&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Hmm that can&#39;t be right... It feels... smaller... I&#39;m sure I measured it to be bigger last time. Did the chastity cage actually shrink your ?penis?&lt;&lt;/kathryn&gt;&gt;
    You look at her with some shame on your face, unable to respond.?nl
&lt;&lt;/if&gt;&gt;

A moment later ?Beau returns from the back of the store, holding a small case. You avoid eye contact as she now has a full frontal view of your ?penis as ?Kathryn is measuring it.

&lt;&lt;kathryn&gt;&gt;There, that should be all we need, get your pants back on, ?titleK.&lt;&lt;/kathryn&gt;&gt;

There&#39;s nothing you&#39;d like more right now, you immediately pull up your pants, hiding your shame as quickly as possible. ?Kathryn walks over to ?Beau and hands her the measurements she noted down on a piece of paper.

&lt;&lt;beau&gt;&gt;That&#39;s great! I managed to find some smaller models from the back that I can get started to adjust to your size right away, ?title! Pretty lucky that I just have to make it &lt;&lt;if settings.sph&gt;&gt;a lot&lt;&lt;else&gt;&gt;a bit&lt;&lt;/if&gt;&gt; smaller, it would&#39;ve been much more work if I had to make it bigger! Hahaha!&lt;&lt;/beau&gt;&gt;

Did she just actually make a joke about the size of your manhood and proceed to laugh about it in front of you with no hesitation? &lt;&lt;if settings.sph&gt;&gt;You&#39;ve never felt actually humiliated by her bombastic laugh before. ?Kathryn seems to find this hilarious, laughing along with a mean look towards you. &lt;&lt;/if&gt;&gt;Unsure how to respond to this, you awkwardly laugh along with the joke as well.?nl 

After ?Beau is done laughing she looks at you with a smile to ask you a question.

&lt;&lt;beau&gt;&gt;I&#39;ve got a few different options for your cage, ?title. Come and pick your favorite!&lt;&lt;/beau&gt;&gt;

&lt;&lt;decision &#39;Choose a new cage&#39; &#39;Kathryn Smithy Excursion 7&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="177" name="Kathryn Smithy Excursion 7" tags="" position="850,2225" size="100,100">You walk over to the counter one which ?Beau has placed a small chest. She carefully opens the case, like she&#39;s revealing a treasure trove inside but instead of jewelry you see different chastity cages laid out before you.?nl

&lt;div id=&quot;toys&quot;&gt;
    &lt;div class=&quot;toy&quot;&gt;
        &lt;&lt;img &#39;equipment/chastity_metal_medium.jpg&#39; &#39;toy-img&#39;&gt;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;toy&quot;&gt;
        &lt;&lt;img &#39;equipment/chastity_black_medium.jpg&#39; &#39;toy-img&#39;&gt;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;toy&quot;&gt;
        &lt;&lt;img &#39;equipment/chastity_pink_medium.jpg&#39; &#39;toy-img&#39;&gt;&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;&lt;if settings.sph&gt;&gt;
    First thing you notice is that they are quite a bit smaller than the cage you wore before... Maybe ?Kathryn was right and the one you currently have is a bit too big but is this really going to work?

    &lt;&lt;player&gt;&gt;Uhm are you sure this is going to... uhm... fit? They look a bit small...&lt;&lt;/player&gt;&gt;

    ?Kathryn immediately bursts out laughing again.

    &lt;&lt;kathryn&gt;&gt;Hahaha, have you actually &lt;em&gt;seen&lt;/em&gt; what you have going on in your pants, ?titleK? Relax, this will fit fine! ?Beau knows what she&#39;s doing.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;beau&gt;&gt;Feel free to pick the model you like most, it will take me only a little time to adjust them to your size.&lt;&lt;/beau&gt;&gt;

You take a careful look at the options and take a moment to make your decision.

&lt;&lt;decision &#39;Pick the metal cage&#39;&gt;&gt;
    &lt;&lt;setchastity &#39;metal&#39; &#39;medium&#39;&gt;&gt;
    &lt;&lt;beau&gt;&gt;Good choice, ?title. I&#39;m a big fan of that design, glad you like it too.&lt;&lt;/beau&gt;&gt;

    ?Beau takes the chastity cage and brings it over to her forge. Looks like she&#39;s immediately going to prepare the cage for you.
    &lt;&lt;beau&gt;&gt;This&#39;ll only take a moment, ?title.&lt;&lt;/beau&gt;&gt;
    &lt;&lt;decision &#39;Wait for ?Beau to finish the chastity cage&#39; &#39;Kathryn Smithy Excursion 8&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Pick the black cage&#39;&gt;&gt;
    &lt;&lt;setchastity &#39;black&#39; &#39;medium&#39;&gt;&gt;
    &lt;&lt;beau&gt;&gt;Good choice, ?title. It&#39;ll look lovely on you.&lt;&lt;/beau&gt;&gt;

    ?Beau takes the chastity cage and brings it over to her forge. Looks like she&#39;s immediately going to prepare the cage for you.
    &lt;&lt;beau&gt;&gt;This&#39;ll only take a moment, ?title.&lt;&lt;/beau&gt;&gt;
    &lt;&lt;decision &#39;Wait for ?Beau to finish the chastity cage&#39; &#39;Kathryn Smithy Excursion 8&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Pick the pink cage&#39; femininity small&gt;&gt;
    &lt;&lt;setchastity &#39;pink&#39; &#39;medium&#39;&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Splendid choice, ?titleK. The pink color really suits you.&lt;&lt;/kathryn&gt;&gt;

    ?Beau takes the chastity cage and brings it over to her forge. Looks like she&#39;s immediately going to prepare the cage for you.
    &lt;&lt;beau&gt;&gt;This&#39;ll only take a moment, ?title.&lt;&lt;/beau&gt;&gt;
    &lt;&lt;decision &#39;Wait for ?Beau to finish the chastity cage&#39; &#39;Kathryn Smithy Excursion 8&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="178" name="Kathryn Smithy Excursion 8" tags="" position="975,2225" size="100,100">&lt;&lt;increasetime 1&gt;&gt;
You wait around in the Smithy for what feels like an eternity. Though in reality it&#39;s probably more like fifteen minutes. You stand next to ?Kathryn with an awkward silence. You&#39;re not sure how you ended up in this situation but this has probably been the most embarrassing event of your life... And the most humiliating thing is that it actually feels kind of... exhilarating... The idea of going out to get a new chastity cage made for you and ?Kathryn taking you step-by-step through this entire process is... weirdly exciting. Best not think of that now.?nl

Your thoughts are interrupted as ?Beau takes the chastity cage out of the immensely hot forge and plunges it into a vat of water, sending steam screaming throughout the room. After a short moment she retrieves the item and places it on a tray right in front of you.?nl

For a final step, you see ?Beau grab a brush and write an invisible incantation on the cage, causing a humming glow to appear for a few seconds. You&#39;ve heard of ?Beau&#39;s magical smithing before but never actually seen it in action yourself. This spell is probably to enhance the effect of the chastity cage, ensuring not even magic can get you out of this.

&lt;&lt;beau&gt;&gt;There, all done!&lt;&lt;/beau&gt;&gt;

?Kathryn steps up and carefully examens the creation with an excited fascination.

&lt;&lt;kathryn&gt;&gt;Wow, it looks wonderful, ?Beau! Beautiful work, let&#39;s try it on you right away and see how it fits on the ?Prince!&lt;&lt;/kathryn&gt;&gt;

You&#39;re startled by her enthusiasm and slightly reluctant. You try to object, knowing it&#39;s pointless.

&lt;&lt;player&gt;&gt;Uhm, is that really necessary right now? Can&#39;t we take it with us and try it on back at the castle?&lt;&lt;/player&gt;&gt;

?Kathryn looks at you, immediately annoyed.

&lt;&lt;beau&gt;&gt;Oh now that you are here, it would be easier to try it on right now so I could still make some final adjustments should they be necessary.&lt;&lt;/beau&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Exactly, ?titleK! Chop chop, get those pants off again!&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;Ugh, fine... Let&#39;s get this over with...&lt;&lt;/player&gt;&gt;

You lower your pants again, revealing your ?penis.

&lt;&lt;decision &#39;Put on your new chastity cage&#39; &#39;Kathryn Smithy Excursion 9&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="179" name="Kathryn Smithy Excursion 9" tags="" position="1100,2225" size="100,100">&lt;&lt;equipchastity&gt;&gt;
You reach for the brand new looking chastity before ?Kathryn slaps your hand away.

&lt;&lt;kathryn&gt;&gt;What are you doing, let me do that, ?titleK.&lt;&lt;/kathryn&gt;&gt;

She once again kneels down in front of you, inches away from your ?dick. Though you&#39;d perhaps dream of her kneeling down in front of you for an altogether different reason, she - unfortunately - has an entirely opposite goal for your ?penis right now. That is to lock it away in a little cage precisely so such perverted situations are to be prevented.?nl

She deftly grabs hold of your genitals, carefully looping the ring of the cage over your personal bits, ball before ball. She then takes the actual cage part and slides it over your ?penis and attaches it to the ring, locking it in place.?nl

&lt;&lt;kathryn&gt;&gt;There we are, perfect fit!&lt;&lt;/kathryn&gt;&gt;

The cage squeezes your ?penis slightly but after it&#39;s locked in place, it seems to perfectly encapsulate your length. It&#39;s compacted slightly so it definitely doesn&#39;t feel like there&#39;s empty room in there now but it also doesn&#39;t feel like it&#39;s pressuring too much. Strange, it feels rather... Comforting...

&lt;&lt;beau&gt;&gt;?Title, would you allow me to do an inspection as well?&lt;&lt;/beau&gt;&gt;

Before you can answer, ?Kathryn already responds.

&lt;&lt;kathryn&gt;&gt;Certainly, go ahead, ?Beau.&lt;&lt;/kathryn&gt;&gt;

?Beau nods and leans down in the general direction of your groin, carefully inspecting her handiwork. She has a stoic look on her face as she&#39;s diligently observing whether the fit is right for you. 

&lt;&lt;beau&gt;&gt;Hmm... yes, it seems... perfect, actually! It matches the size of your ?penis exactly, ?title. I assume it doesn&#39;t feel uncomfortable?&lt;&lt;/beau&gt;&gt;

You nod your head at her as she&#39;s doing some final observation together with ?Kathryn, making sure it&#39;s not straining you anywhere. You still can&#39;t believe you&#39;re in this weird situation where two women are totally focussed this humiliating thing encasing your ?penis...?nl

In fact, the three of you are so focused on your new chastity cage that none of you hear the front door of the Smithy suddenly get thrown open.

&lt;&lt;decision &#39;See who disturbs you&#39; &#39;Kathryn Smithy Excursion 10&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="180" name="Kathryn Smithy Excursion 10" tags="" position="1225,2225" size="100,100">All three of you get startled and turn to the door as ?Caspar hastily steps inside the Smithy, hastily shouting something to you with a slightly panicked demeanor.

&lt;&lt;caspar&gt;&gt;?Title, there&#39;s a gang of drunken louts outside, maybe we should escort you- Oh, uhm- I&#39;m sorry- uh-&lt;&lt;/caspar&gt;&gt;

?Caspar&#39;s expression is quickly replaced with pure shock as he gets a perfect view of you standing there with your pants around your ankles and a tiny chastity cage pristinely fitted around your ?dick. As both ?Beau and ?Kathryn look back at ?Caspar in shock, you quickly - but far too late - move your hands to cover up your privates.

&lt;&lt;kathryn&gt;&gt;Get out of here, you idiot!&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;caspar&gt;&gt;Oh- yes, of course, I&#39;ll give you a moment- uhm- I&#39;m sorry, ?title.&lt;&lt;/caspar&gt;&gt;

?Caspar immediately retreats back through the front door and quickly closes it behind him. There&#39;s an awkward silence that hangs through the room as you rapidly raise your pants to cover yourself up, not even thinking about the fact you&#39;re still wearing the cage.

&lt;&lt;player&gt;&gt;Uh- maybe- maybe we should go...&lt;&lt;/player&gt;&gt;

?Kathryn nods at you and looks at ?Beau, who&#39;s looking surprisingly stoic about the situation.

&lt;&lt;beau&gt;&gt;Certainly, ?title. I&#39;m very sorry about that, I should&#39;ve locked the door but I assumed it wouldn&#39;t be necessary with the knights guarding outside...&lt;&lt;/beau&gt;&gt;

&lt;&lt;kathryn&gt;&gt;That wasn&#39;t your fault, ?Beau. It&#39;s my idiot brother who shouldn&#39;t have barged in like that. I mean really? For just a few drunken people wanting to see the ?Prince?! Ugh...&lt;&lt;/kathryn&gt;&gt;

?Kathryn looks annoyed but you see it shift to a sincere caring expression as you make eye contact with her.

&lt;&lt;kathryn&gt;&gt;I&#39;m sorry, ?title. Let&#39;s just go back to the castle right now, it&#39;s probably best to go out through the back, I&#39;ll go get my brother.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;Uh- it&#39;s alright, that sounds like a good idea... Uhm- thank you ?Beau.&lt;&lt;/player&gt;&gt;

?Beau gives you a deep respectful bow as you make your way out of the store. At least you have a new chastity cage now?

&lt;&lt;decision &#39;Head back to the castle&#39; &#39;Kathryn Smithy Excursion 11&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="181" name="Kathryn Smithy Excursion 11" tags="" position="100,2350" size="100,100">&lt;&lt;setlocation &#39;Road&#39;&gt;&gt;

After carefully making your way out the back, you reconvened with your knight escort and are taken on the short journey back to the castle. There was indeed a small gang of drunks outside the Smithy, badgering your knights to let them meet you. Things unexpectedly escalated and after a small kerfuffle most of the louts are taken away by the city guards.?nl

It was probably big enough of a situation to alert you so you don&#39;t blame ?Caspar for that, it just would&#39;ve been better if he had knocked first.?nl

You proceed in the awkwardly silent walk as you make your way back. ?Kathryn walks ahead slightly as you&#39;re getting close to the castle gates. ?Caspar decides to reluctantly break the silence and walk up to you.

&lt;&lt;caspar&gt;&gt;?Title, I&#39;m very sorry for what happened earlier. I shouldn&#39;t have barged in like that when you were doing something uhm- private- If you order to have me relieved of my duties, I would understand.&lt;&lt;/caspar&gt;&gt;

&lt;&lt;decision &#39;Berate him&#39; dominance large&gt;&gt;
    You look at him with a stoic expression.
    &lt;&lt;player&gt;&gt;?Squire. Though your mission to keep me safe is vital, I do expect you to have the capacity to gauge when you first need to &lt;em&gt;knock&lt;/em&gt; on a door. Don&#39;t let this happen again and that&#39;ll be the end of this.&lt;&lt;/player&gt;&gt;
    ?Caspar holds his head down and bows to you.
    &lt;&lt;caspar&gt;&gt;Yes, ?title. I will not disappoint you again. Thank you. And uhm- your secret is safe with me, of course.&lt;&lt;/caspar&gt;&gt;
    You look at him with a stern look.
    &lt;&lt;player&gt;&gt;Good. You are excused, soldier.&lt;&lt;/player&gt;&gt;

    &lt;&lt;decision &#39;Walk back inside&#39; &#39;Kathryn Smithy Excursion 12&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Immediately forgive him&#39; submissiveness large&gt;&gt;
    You realize you can&#39;t ever be mad at ?Caspar and want to simply just get past this situation.
    &lt;&lt;player&gt;&gt;Ah- uhm, it&#39;s alright, ?Caspar, you were just trying to protect me, no need to apologize...&lt;&lt;/player&gt;&gt;
    ?Caspar smiles at you, seeming relieved.
    &lt;&lt;caspar&gt;&gt;Thank you, ?title. I won&#39;t let you down again!&lt;&lt;/caspar&gt;&gt;
    He nods to you and even though this conversation could be over he still stands still for a while, something clearly on his mind.
    &lt;&lt;caspar&gt;&gt;Uhm, one more thing, ?title...  I wanted to say that your secret is very safe with me, I won&#39;t tell a soul and uhm- if you ask me- I actually- think it&#39;s kind of cute-&lt;&lt;/caspar&gt;&gt;
    Through his stuttering it seems like he just blurted this out without really thinking about it. His cheeks are as red as his hair as he awkwardly looks away and he suddenly gives you a deep bow.
    &lt;&lt;caspar&gt;&gt;Uhh- I don&#39;t know why I said that, forgive me, ?title! Please ignore that!&lt;&lt;/caspar&gt;&gt;
    You&#39;re not really sure how to respond to that and before you can even say anything he&#39;s already walking off hurriedly.

    &lt;&lt;decision &#39;Walk back inside&#39; &#39;Kathryn Smithy Excursion 12&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="182" name="Kathryn Smithy Excursion 12" tags="" position="225,2350" size="100,100">&lt;&lt;setlocation &#39;Gatehouse&#39;&gt;&gt;
&lt;&lt;increasetime 1&gt;&gt;
Your entire escort makes it&#39;s way back through the gates, ?Caspar walks off ahead of you and the other knights make their way over to the barracks, their mission now complete. ?Kathryn turns to you for a moment.
&lt;&lt;kathryn&gt;&gt;Well, that was quite the ordeal, I hope you enjoyed our little excursion.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;Yes, uhm, it was eventful indeed... I&#39;d best go back to my bedroom for a bit to recuperate...&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;That sounds like a good idea. I hope you&#39;ll enjoy your new little cage if you need it unlocked, you know where to find me... See you later, ?titleK&lt;&lt;/kathryn&gt;&gt;

She looks down towards your crotch with a sly smile for added effect before she turns around and walks away from you. It&#39;s already late so you decide to simply head to back after this eventful day.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Go to your bedroom&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="183" name="Kathryn Princess Training Intro" tags="" position="350,2350" size="100,100">&lt;&lt;advancequest &#39;princess-lessons-intro&#39;&gt;&gt;
&lt;&lt;setlocation &#39;Garden&#39;&gt;&gt;

As you consider how to bring up discussing the recent developments with ?Kathryn, she beckons you to follow her. You fall in behind her as she leads you to the castle gardens.?nl

There you find a stone bench where she sits down, her expression already one of mild amusement. A silver tea service rests on a table beside her, untouched.

&lt;&lt;kathryn&gt;&gt;Well, well. If it isn&#39;t our dainty little heir, come to play dress-up.&lt;&lt;/kathryn&gt;&gt;

She gestures lazily to the spot across from her. You sit, feeling your cheeks grow warm already.

&lt;&lt;kathryn&gt;&gt;?Morgana told me everything. About your... ambitions. I must say, ?title, this naturally doesn&#39;t surprise me one bit. I&#39;ve been seeing this flamboyant air in you for years now...&lt;&lt;/kathryn&gt;&gt;

You open your mouth to respond, but she cuts you off with a sly smile.

&lt;&lt;kathryn&gt;&gt;Don&#39;t look so stricken. I didn&#39;t say I disapproved. Quite the opposite. I think it&#39;s adorable. And quite honestly, brave. It&#39;s quite a challenge you will be facing now.&lt;&lt;/kathryn&gt;&gt;

She picks up the teapot and pours you a cup with graceful, practiced movements.

&lt;&lt;kathryn&gt;&gt;But don&#39;t worry. You&#39;ll make a fine princess yet. You just need a little refinement. And I happen to be very good at turning messy little boys into dazzling little ladies.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;That&#39;s… kind of what I was hoping for, I think.&lt;&lt;/player&gt;&gt;

?Kathryn hands you the teacup with an expression that is somewhere between indulgence and mischief.

&lt;&lt;kathryn&gt;&gt;Of course it is. And you came to the right person. You&#39;ll find that good etiquette, like a sharp tongue, cuts both ways. And I plan to teach you both.&lt;&lt;/kathryn&gt;&gt;

You sip your tea quietly, trying not to squirm under her gaze. She watches you for a moment, then leans in slightly.

&lt;&lt;kathryn&gt;&gt;So, are you ready to learn how to eat, drink, and sit like a proper little princess? Or are you going to spill tea in your lap and run crying to ?Morgana?&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;decision &#39;Begin your first lesson&#39;&gt;&gt;
    &lt;&lt;setlocation &#39;Dining hall&#39;&gt;&gt;
    &lt;&lt;include &#39;Kathryn Princess Training&#39;&gt;&gt;
    &lt;&lt;decisionicon etiquette&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="184" name="Kathryn Princess Training" tags="" position="475,2350" size="100,100">&lt;&lt;if !hasVisited(&#39;Kathryn Princess Training 1&#39;)&gt;&gt;
    &lt;&lt;goto &#39;Kathryn Princess Training 1&#39;&gt;&gt;
&lt;&lt;elseif !hasVisited(&#39;Kathryn Princess Training 2&#39;)&gt;&gt;
    &lt;&lt;goto &#39;Kathryn Princess Training 2&#39;&gt;&gt;
&lt;&lt;elseif !hasVisited(&#39;Kathryn Princess Training 3&#39;)&gt;&gt;
    &lt;&lt;goto &#39;Kathryn Princess Training 3&#39;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;goto `either(&#39;Kathryn Princess Training 1&#39;, &#39;Kathryn Princess Training 2&#39;, &#39;Kathryn Princess Training 3&#39;)`&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="185" name="Kathryn Princess Training End" tags="" position="600,2350" size="100,100">&lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;changestat etiquette 1&gt;&gt;&lt;&lt;addcounter &#39;kathryn-training&#39; 1&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="186" name="Kathryn Princess Training Start" tags="" position="725,2350" size="100,100">&lt;&lt;if hasVisited(&#39;Kathryn Punishment Chastity Intro&#39;)&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Before we start our lesson today, I have one strict rule that you will have to follow. During our training session you will have to be properly caged, to avoid any unfortunate &#39;distractions&#39;.&lt;&lt;/kathryn&gt;&gt;

    &lt;&lt;if isInChastity()&gt;&gt;
        You awkwardly look at her, feeling embarrassed for talking about this.
        &lt;&lt;player&gt;&gt;Uhm- yes, I already am...&lt;&lt;/player&gt;&gt;
        &lt;&lt;kathryn&gt;&gt;Yes, you definitely should be since I was the one who locked you in it and didn&#39;t let you out. I will need to perform a visual inspection to make sure though. Prove it.&lt;&lt;/kathryn&gt;&gt;
        You sigh and decide to simply comply with her demands, partially undressing yourself to show her your chastity cage.
    &lt;&lt;else&gt;&gt;
        &lt;&lt;player&gt;&gt;Uhm- is this really necessary? Why would I need to be caged now?&lt;&lt;/player&gt;&gt;
        She immediately frowns at you.
        &lt;&lt;kathryn&gt;&gt;?titleK, if you want to be trained by me, you will have to adhere to &lt;em&gt;my&lt;/em&gt; rules. You will be caged now, no fussing about it.&lt;&lt;/kathryn&gt;&gt;
        You sigh and partially undress yourself. She reveals a chastity cage and starts locking your ?dick into the device.
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;img &#39;chastity/chastity_check.gif&#39; &#39;ridge-border&#39; &#39;15em&#39;&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;Very good. All locked up like you should be. Now we can get started with the lesson.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="187" name="Kathryn Princess Training 1" tags="" position="850,2350" size="100,100">&lt;&lt;first&gt;&gt;
    You enter the small parlor where ?Kathryn prepared a table elegantly set for two. She stands tall, her hands neatly folded in front of her.
    &lt;&lt;include &#39;Kathryn Princess Training Start&#39;&gt;&gt;

    &lt;&lt;kathryn&gt;&gt;I thought we might begin your lessons with one of the more deceptively simple princess duties—dinner etiquette.&lt;&lt;/kathryn&gt;&gt;

    She gestures for you to sit across from her at the table.

    &lt;&lt;kathryn&gt;&gt;A princess is always being watched, even when dining. Grace at the table is not just for show—it is a reflection of discipline, confidence, and respect for those around her.&lt;&lt;/kathryn&gt;&gt;

    &lt;&lt;player&gt;&gt;So even something as simple as eating has rules?&lt;&lt;/player&gt;&gt;

    &lt;&lt;kathryn&gt;&gt;Yes, and quite a few. But I&#39;ll guide you. Let&#39;s start with posture. Sit upright, back straight, and keep your elbows off the table unless instructed otherwise by the formality of the setting.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;finally&gt;&gt;
    You return to the parlor, and once again ?Kathryn is waiting beside a neatly set table.
    &lt;&lt;include &#39;Kathryn Princess Training Start&#39;&gt;&gt;

    &lt;&lt;kathryn&gt;&gt;Today we will continue your lessons in etiquette. We&#39;ll review utensils and expand into conversational grace.&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;/first&gt;&gt;

You adjust your seat and try to sit as instructed.

&lt;&lt;kathryn&gt;&gt;Now pick up the napkin and place it in your lap. Folded once, horizontally.&lt;&lt;/kathryn&gt;&gt;

You do as she says, mimicking her movements.

&lt;&lt;kathryn&gt;&gt;Good. This is how you begin a formal meal. Let&#39;s move on to utensils.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;kathryn&gt;&gt;In a formal setting, utensils are used from the outside in. For example, start with the outermost fork for the appetizer. Hold silverware with nothing but finesse and grace.&lt;&lt;/kathryn&gt;&gt;

You pick up the outer fork and practice the motions slowly and deliberately.

&lt;&lt;player&gt;&gt;Like this?&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Almost. Relax your wrist a little. Eating should look effortless and graceful, not like that sword-playing you do with ?Caspar in the courtyard.&lt;&lt;/kathryn&gt;&gt;

You try again. The difference is subtle, but you can feel the change in presentation.

&lt;&lt;kathryn&gt;&gt;Much better. Now, let&#39;s talk about pauses. When you&#39;re not eating, your utensils should rest in a specific position. Knife and fork on the plate, angled like this—yes, exactly like that.&lt;&lt;/kathryn&gt;&gt;

You nod, copying her example.

&lt;&lt;kathryn&gt;&gt;And no talking with your mouth full, of course. If you must pause mid-bite, you simply smile and chew gracefully before responding. Even disagreement can be delivered sweetly over soup.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;It seems like a lot to remember for a simple meal.&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;It is, but it becomes second nature. And when done well, it conveys poise and power without a single word.&lt;&lt;/kathryn&gt;&gt;

You spend the next while practicing a sample dinner course with ?Kathryn correcting your technique gently but firmly. As you finish, she smiles faintly.

&lt;&lt;kathryn&gt;&gt;You&#39;re learning quickly, ?title. A few more lessons, and you&#39;ll be dining like royalty with ease. I will see you again for your next lesson.&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;player&gt;&gt;Thank you, ?Kathryn. I already look forward to the next lesson.&lt;&lt;/player&gt;&gt;

&lt;&lt;include &#39;Kathryn Princess Training End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="188" name="Kathryn Princess Training 2" tags="" position="975,2350" size="100,100">You now notice how many tables have been moved to the side to create a big open space on the marble floor of the dining hall. ?Kathryn sits with proper poise, apparently waiting for you to mention your lessons as she gives you a graceful nod.
&lt;&lt;include &#39;Kathryn Princess Training Start&#39;&gt;&gt;
&lt;&lt;kathryn&gt;&gt;Very good, ?title. It is time &lt;&lt;first&gt;&gt;for the next part of your training&lt;&lt;finally&gt;&gt;to continue your training&lt;&lt;/first&gt;&gt;. We will move to lessons on dancing.&lt;&lt;/kathryn&gt;&gt;
You audibly gulp. Dancing is definitely not your forte...?nl

?Kathryn stands up from her chair and claps her hands. The four musicians stationed at the far side of the hall suddenly start playing a waltz-like tune.
&lt;&lt;player&gt;&gt;Wow, you even prepared a band. I suppose I could do with some practice...&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Hah, most definitely. I&#39;ve seen your poor attempts at royal galas before and I must say I was never much impressed.&lt;&lt;/kathryn&gt;&gt;
?Kathryn moves to the center of the open space and holds out her hand to you, expecting you to join her on the marvelous dancing floor.
&lt;&lt;kathryn&gt;&gt;Come now, ?titleK. Show me that I am wrong.&lt;&lt;/kathryn&gt;&gt;
You hesitantly walk up to her and take her hand. She immediately move you in a correct starting position, placing your left hand on het hip and holding her right hand in the air.
&lt;&lt;kathryn&gt;&gt;Normally, being a ?Prince, you would be expected to lead the dance, but we&#39;ll forgo that tradition for now so you can simply follow my lead instead.&lt;&lt;/kathryn&gt;&gt;
You look her in the eyes and nod. You only have a moment to notice how close you are standing to ?Kathryn, something that you rarely get to do. Before that thought can even make you blush, ?Kathryn picks an opportune moment in the rhythm to latch on with a deft waltz, and effortlessly drags you along with it.
&lt;&lt;kathryn&gt;&gt;This is a simply square-pace pattern, we&#39;ll get to more complicated parts later once you get the proper hang of this.&lt;&lt;/kathryn&gt;&gt;
Following her along is surprisingly easy. It definitely helps how experienced she&#39;s at this, you&#39;d expect it to go much poorer if you were to lead the dance.
&lt;&lt;kathryn&gt;&gt;Good, ?titlek. You&#39;re holding up well enough. Let&#39;s try some more advanced moves now.&lt;&lt;/kathryn&gt;&gt;
She takes you through some intricate motions and dancing patterns. Her guiding hand on the small of your back is all you need to stay on tune but also slowly get distracted by the moment. She&#39;s entirely focused on the lessons and while you should be too, having her give you this on-hand tutoring seems to have an unexpected effect on you. ?nl 
You feel yourself not only intertwine with the music but also the smell of her beautiful red hair. She looks at you and notices your distraction, responding to it surprisingly timidly.
&lt;&lt;kathryn&gt;&gt;Perhaps we should... stay with the lesson, ?title. Let&#39;s try that move again.&lt;&lt;/kathryn&gt;&gt;
Her call for focus pulls your mind of your haze and you immediately listen attentively again, not wanting to disappoint her by being a poor dancing partner.?nl
The lesson continues for a good half hour before ?Kathryn calls an end to it, you think you can almost hear reluctance in her voice, it seems like she enjoyed the lesson much as well.
&lt;&lt;kathryn&gt;&gt;I must say that went quite well, ?title. Perhaps, we should end our session for now though, the musicians must be getting tired.&lt;&lt;/kathryn&gt;&gt;
You take a step back, not entirely wanting to let go of her but resigning to that fate anyway. You give her a deep bow.

&lt;&lt;player&gt;&gt;Thank you for the lesson, ?Kathryn. It was very informative.&lt;&lt;/player&gt;&gt;
?Kathryn nods at you, seemingly thinking something over as the dancing lesson ends.
&lt;&lt;include &#39;Kathryn Princess Training End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="189" name="Kathryn Princess Training 3" tags="" position="1100,2350" size="100,100">&lt;&lt;player&gt;&gt;Hello ?Kathryn, I believe it is time for another- uhm- lesson.&lt;&lt;/player&gt;&gt;

Interrupting your train of thought, you see ?Orson sitting here at a dining table set for three. ?Kathryn is standing next to the table and gestures for you to sit down.

&lt;&lt;kathryn&gt;&gt;Yes, it&#39;s time for your next training, ?title. For this one, I&#39;ve asked the help of your manservant here. I assume he is trustworthy enough for the purpose.&lt;&lt;/kathryn&gt;&gt;

You sit down at the table, next to ?Orson and make eye contact with him.

&lt;&lt;orson&gt;&gt;Uhm, most definitely! I am happy to help out, ?title. Though I must admit ?LadyKathryn has not informed me with what exactly.&lt;&lt;/orson&gt;&gt;

You both look to ?Kathryn with a curious look on your faces. She moves to sit down at the last seat of the table.

&lt;&lt;kathryn&gt;&gt;Today&#39;s lesson will be on one of the most important activities a prominent host must attend to at her parties. Flirting.&lt;&lt;/kathryn&gt;&gt;

As you look at ?Orson you can definitely see his cheeks suddenly reddening, and he probably sees the same in you. That&#39;s... unexpected. &lt;&lt;if hasCompletedQuest(&#39;orson-date-1&#39;)&gt;&gt;Not that you&#39;re really new to flirting with ?Orson, but still, flirting with ?Kathryn giving instructions is definitely new to you.&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Uhm... ?Kathryn, are you sure this is actually important for me to learn right now...?&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Most definitely! The shrewdest of diplomacy is always performed with hushed voices in intimate settings. You could definitely use some pointers in that regard, ?title.&lt;&lt;/kathryn&gt;&gt;

You look at her slightly annoyed but forgo the moment to retort. You suppose it is an interesting subject to learn more about... ?Orson looks at you with some slight determination, ready to play his part and presumably be flirted with.

&lt;&lt;kathryn&gt;&gt;Now, before we get started we are missing one vital ingredient for this.&lt;&lt;/kathryn&gt;&gt;

?Kathryn snaps her fingers and immediately three attendants show up to fill your wineglasses. A rather copious amount, even.?nl

?Orson shrugs and immediately takes a swig of the fine vintage.

&lt;&lt;kathryn&gt;&gt;Nothing better to loosen the tongue than some royal wines.&lt;&lt;/kathryn&gt;&gt;

You follow suit, not really taking a proper moment to appreciate the taste as you swallow it down.

&lt;&lt;player&gt;&gt;Alright, so what&#39;s next?&lt;&lt;/player&gt;&gt;

&lt;&lt;kathryn&gt;&gt;Eager are we? I suppose it&#39;s important for us to set the scene first. ?Orson, you&#39;ll be playing the role of a visiting dignitary, loyal to the crown but perhaps more loyal to your own purse.&lt;&lt;/kathryn&gt;&gt;

?Kathryn turns to look at you.

&lt;&lt;kathryn&gt;&gt;?Title, it is your job and responsibility to ensure that loyalty through whatever means necessary. A little bit of sweet-tongued persuasiveness never fails to entice that goal. Let&#39;s get started, shall we?&lt;&lt;/kathryn&gt;&gt;

Thrown in the deep end, while you are still considering what this means, ?Orson seems to immediately take his role very seriously. He puts on a gruff voice and manifests his role.

&lt;&lt;orson&gt;&gt;Ah! Well, I must thank you for the lovely dinner, ?title. It&#39;s quite splendid getting some alone time with you, I&#39;m positively surprised by the personal attention you give me.&lt;&lt;/orson&gt;&gt;

You awkwardly shuffle in your seat, completely unsure how to handle this.

&lt;&lt;player&gt;&gt;Uhm- Yes, the dinner was lovely indeed... But I think you are also... lovely... indeed...?&lt;&lt;/player&gt;&gt;

?Kathryn slows slaps the palm of her hand against her forehead. Even ?Orson looks at you confused at you after that one. After ?Kathryn is done face-palming she lets out a huge sigh before continuing.

&lt;&lt;kathryn&gt;&gt;Okay. I&#39;m just going to chalk that off as a first attempt and simply ignore it. Let&#39;s start over and then why don&#39;t you instead try to comment on how it&#39;s your duty to give him more personal attention if he desires so. Think of something with a bit of &lt;em&gt;implication&lt;/em&gt;, ?titleK.&lt;&lt;/kathryn&gt;&gt;

You spend almost an hour going back and fourth and getting flirting tips from ?Kathryn. Her lewd suggestions leave you a bit hot and bothered, that combined with the substantial amount of wine you have drank by now, you somehow manage to channel her energy for a mere moment.

&lt;&lt;orson&gt;&gt;Oh, I&#39;m glad you like the suit, ?title. I had it custom made by a local tailor and it was surprisingly cheap, there was a fifty percent sale on the pants!&lt;&lt;/orson&gt;&gt;

A sly smile creeps up on your face as you decide to manifest the best pick-up line in existence.

&lt;&lt;player&gt;&gt;Fifty percent off, you say? I&#39;d much rather see those pants one hundred percent off.&lt;&lt;/player&gt;&gt;

A suspenseful silence fills the room. It seems you actually made ?Orson blush with that line. ?Kathryn looks at you with a raised eyebrow, you&#39;re unsure whether you did well or not until she suddenly breaks the silence by slowly clapping her hands.

&lt;&lt;kathryn&gt;&gt;That was... beautiful, ?title. Well done, you&#39;ve actually made great strides in the art of flirting. I&#39;m impressed. That&#39;ll be all for now.&lt;&lt;/kathryn&gt;&gt;

She pushes back her chair and gives a slight bow to the both of you before she takes her leave.?nl

You look at ?Orson and both of you decide to sit there for a while more, finishing your wine glasses together.

&lt;&lt;include &#39;Kathryn Princess Training End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="190" name="Leopold" tags="" position="1225,2350" size="100,100">&lt;&lt;if $location is &#39;Treasury&#39;&gt;&gt;
    &lt;&lt;if getTime() === &#39;night&#39;&gt;&gt;
        As you walk by ?Leopold&#39;s office, you notice there&#39;s still light coming out of his room. Is he still working, this late at night?
        &lt;&lt;decision &#39;Check on ?Leopold&#39; &#39;Leopold Night&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;decision &#39;See if ?Leopold can tutor you&#39; &#39;Leopold Ask&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;if hasQuest(&#39;retrieve-artifact&#39;)&gt;&gt;
            &lt;&lt;decision &#39;Ask ?Leopold about receiving your reward&#39; &#39;Leopold Artifact&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;if hasCompletedQuest(&#39;blacksmith-intro&#39;)&gt;&gt;
            &lt;&lt;decision &#39;Ask ?Leopold for gold so you can buy stuff in town&#39; &#39;Leopold Ask Money&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="191" name="Leopold Artifact" tags="" position="100,2475" size="100,100">&lt;&lt;if hasAvailableArtifact()&gt;&gt;
    You excitedly walk into ?Leopold&#39;s office and see him sitting behind his desk.
    &lt;&lt;leopold&gt;&gt;Ah, ?title. You must be here for your reward, am I correct?&lt;&lt;/leopold&gt;&gt;
    &lt;&lt;player&gt;&gt;That&#39;s right, ?Leopold. I&#39;m eager to see what the ?reliquary holds for me.&lt;&lt;/player&gt;&gt;
    ?Leopold matches your enthusiasm and from his robes he excitedly produces a set of keys.
    &lt;&lt;leopold&gt;&gt;Of course! You know, ?title, I am glad the council could agree on this for you. Our artifacts will be more than safe in your personal possession and I think I speak for the whole council when I say that you have definitely deserved this reward.&lt;&lt;/leopold&gt;&gt;
    He gets up from his desk and starts walking down the spiral staircase set in the floor of his office.
    &lt;&lt;leopold&gt;&gt;Please follow me, ?title. I will let you into the vault.&lt;&lt;/leopold&gt;&gt;
    Going down the spiral steps, you enter a dark hallway that ends into a large iron vault door. You have only ever seen this door, never going inside as your father would not allow it. ?Leopold fishes out the biggest key from his chain. He dramatically inserts it into the big keyhole. A loud &#39;clunk&#39; can be heard as the door cracks open. You see ?Leopold put some real strength in his heaving as he pulls open the gate for you. He then stands aside and motions for you to enter.
    &lt;&lt;leopold&gt;&gt;After you, ?title.&lt;&lt;/leopold&gt;&gt;

    &lt;&lt;decision &#39;Enter the Royal Reliquary&#39; &#39;Leopold Artifact 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    You excitedly walk into ?Leopold&#39;s office and see him sitting behind his desk.
    &lt;&lt;leopold&gt;&gt;Ah, ?title. You must be here for your reward, am I correct?&lt;&lt;/leopold&gt;&gt;
    &lt;&lt;player&gt;&gt;That&#39;s right, ?Leopold. I&#39;m eager to see what else the ?reliquary holds for me.&lt;&lt;/player&gt;&gt;
    &lt;&lt;leopold&gt;&gt;About that... I&#39;m afraid I have some bad news. I should&#39;ve mentioned this in the council meeting but it seems like we&#39;ve already given you any artifacts from the ?reliquary that we could bestow on you.&lt;&lt;/leopold&gt;&gt;
    You look at him with a disappointed face.
    &lt;&lt;leopold&gt;&gt;Any artifacts left are too unsafe. I&#39;m sorry, ?title, I simply cannot give you another artifact right now.&lt;&lt;/leopold&gt;&gt;
    &lt;&lt;player&gt;&gt;It&#39;s alright, ?Leopold. I understand.&lt;&lt;/player&gt;&gt;
    You give him a respectful nod and move to exit his office.
    
    &lt;&lt;decision &#39;Leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="192" name="Leopold Artifact 2" tags="" position="225,2475" size="100,100">&lt;&lt;setlocation &#39;Royal Reliquary&#39;&gt;&gt;
You slowly walk into the ?reliquary, amazed at what you are seeing. The room is lit by glowing stones laid into the pillars of the vault. You can&#39;t help but feel overwhelmed by the sheer amount of treasure surrounding you. There are golden chalices and jewel-encrusted baubles. The walls are lined with ancient swords, passed down through generations.?nl
&lt;&lt;first&gt;&gt;
    You have never actually seen the inside of this magnificent room before. Your father would never allow you to interact with the artifacts, citing it&#39;s too dangerous for kids. Now grown up, you&#39;re happy the council has given you opportunity to enter this place. Something still surprises you about that decision though.
&lt;&lt;finally&gt;&gt;
    Even though you have been here before now, the sheer magnificence of the room still baffles you. Something still surprises you about the council&#39;s decision to allow you to take an artifact under your care.
&lt;&lt;/first&gt;&gt;
 However, it definitely attests to the importance they feel for your tutelage when they&#39;re willing to give this great of a reward.?nl

?Leopold follows you closely into the room, it almost feels like he is just as amazed as you are at seeing this. He must come here much more often though, being the holder of the key that opens it.

&lt;&lt;leopold&gt;&gt;This way, ?title. I have a selection of artifacts that you can choose from.&lt;&lt;/leopold&gt;&gt;

You follow the man to the center of the large vault. A collection of artifacts are displayed on pedestals for you to inspect.

&lt;&lt;leopold&gt;&gt;Feel free to inspect them, they&#39;re not dangerous.&lt;&lt;/leopold&gt;&gt;

&lt;&lt;decision &#39;Choose an artifact&#39; &#39;Artifacts Selection&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="193" name="Leopold Acknowledgement" tags="" position="350,2475" size="100,100">&lt;&lt;acknowledgement Leopold&gt;&gt;
    &lt;&lt;mention failed&gt;&gt;
        &lt;&lt;leopold&gt;&gt;Sorry about the heavy council session recently, ?title. I&#39;m very happy to see you&#39;re here to continue studying though. Don&#39;t worry, with a bit more diligence on your part and we&#39;ll be more than happy!&lt;&lt;/leopold&gt;&gt;
    &lt;&lt;mention assassination&gt;&gt;
        &lt;&lt;leopold&gt;&gt;I am glad to see you doing so well after the attempt on your life, ?title. It was an awful ordeal.&lt;&lt;/leopold&gt;&gt;
    &lt;&lt;mention status&gt;&gt;
        &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
            He keeps staring at you, and you can&#39;t tell if he&#39;s intrigued or confused.
            &lt;&lt;leopold&gt;&gt;?Title, if you don&#39;t mind me asking, have you changed your appearance recently?&lt;&lt;/leopold&gt;&gt;
            &lt;&lt;player&gt;&gt;What do you mean?&lt;&lt;/player&gt;&gt;
            You try to feign innocence.
            &lt;&lt;leopold&gt;&gt;Well, you look different. I can&#39;t quite put my finger on it, but there&#39;s something... feminine about you.&lt;&lt;/leopold&gt;&gt;
            You&#39;re not sure what to say. Should you admit the truth to him? Would he believe you?
            &lt;&lt;player&gt;&gt;I&#39;m not sure what you&#39;re talking about, Leopold.&lt;&lt;/player&gt;&gt;
            &lt;&lt;leopold&gt;&gt;Hmmm... Well, whatever it is, it looks good on you.&lt;&lt;/leopold&gt;&gt;
            The compliment makes you blush.
        &lt;&lt;elseif face() is &#39;andro&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;fem&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;man&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
&lt;&lt;/acknowledgement&gt;&gt;</tw-passagedata><tw-passagedata pid="194" name="Leopold Ask" tags="" position="475,2475" size="100,100">You walk into &lt;&lt;fullname leopold &#39;Master&#39;&gt;&gt;&#39;s office and see him sitting behind his desk, his eyes fixed on a ledger on his desk. 
&lt;&lt;leopold&gt;&gt;Ah hello, ?title.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;include &#39;Leopold Acknowledgement&#39;&gt;&gt;
&lt;&lt;if getStatLevel(&#39;stewardship&#39;) &lt; $player.levelexpectation + 1&gt;&gt;
    He looks up and smiles at you, gesturing for you to take a seat.
    &lt;&lt;leopold&gt;&gt;Are you here for your lessons on stewardship? I am keen to tutor you again, my prince.&lt;&lt;/leopold&gt;&gt;
    Your father always said it&#39;s important to learn good financial responsibility so he asked &lt;&lt;fullname leopold &#39;Master&#39;&gt;&gt; to teach you sometimes. You never cared for it much but you get a sense that ?Leopold really enjoys teaching you.

    &lt;&lt;if hasCounter(&#39;leopold-night&#39;) or getStat(&#39;depravity&#39;) &lt; -80&gt;&gt;
        &lt;&lt;decision &quot;Indulge him and sit down&quot; &#39;Leopold Lessons&#39;&gt;&gt;&lt;&lt;decisionicon stewardship&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;decision &quot;Indulge him and sit down&quot; &#39;Leopold Lessons Horny&#39;&gt;&gt;&lt;&lt;decisionicon stewardship&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;decision &quot;Politely decline&quot;&gt;&gt;
        &lt;&lt;player&gt;&gt;I unfortunately have no time for that, &lt;&lt;fullname leopold &#39;Master&#39;&gt;&gt;.&lt;&lt;/player&gt;&gt;
        &lt;&lt;leopold&gt;&gt;That&#39;s quite alright, my prince. Come by anytime.&lt;&lt;/leopold&gt;&gt;
        You feel like he&#39;s slightly disappointed but he won&#39;t make it noticable.
        &lt;&lt;decision &quot;Leave his office&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;leopold&gt;&gt;I&#39;m afraid I&#39;m going to have to disappoint you.&lt;&lt;/leopold&gt;&gt;
    You were just about to take a seat at his desk but stop halfway through to listen to him.
    &lt;&lt;leopold&gt;&gt;You&#39;ve been doing so well with the lessons that you have run me out of material to teach you right now! I&#39;m very sorry, ?title. Perhaps you could come back after the next council meeting? I will likely have more lessons to teach you then.&lt;&lt;/leopold&gt;&gt;
    &lt;&lt;player&gt;&gt;Ah alright, I will come by another time then.&lt;&lt;/player&gt;&gt;
    &lt;&lt;decision &quot;Leave his office&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="195" name="Leopold Coins Finish" tags="" position="600,2475" size="100,100">&lt;&lt;changestat stewardship 1&gt;&gt;
&lt;&lt;leopold&gt;&gt;Very well done, ?title! Isn&#39;t it fun to see all those different kinds of coins and learn about the currencies of our nation?&lt;&lt;/leopold&gt;&gt;
You stare at him while you contemplate why he made you do a task fit for a child... He seems genuine though, perhaps he does enjoy this kind of thing.
&lt;&lt;leopold&gt;&gt;Well, that should be it for our lesson of today. Thank you for coming, ?title.&lt;&lt;/leopold&gt;&gt;

&lt;&lt;decision &#39;Thank Master ?Leopold and take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;addcounter &#39;leopold&#39; 0.5&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="196" name="Leopold Lessons" tags="" position="725,2475" size="100,100">&lt;&lt;include `either(&#39;Leopold Lessons 1&#39;, &#39;Leopold Lessons 2&#39;, &#39;Leopold Lessons 3&#39;)`&gt;&gt;
Although the lesson is probably very important, you can&#39;t help from drifting off. While you stare out of the window thinking about the fun things you could be doing instead right now you suddenly notice ?Leopold make eye contact with you as he closes the book he was just reading from.
&lt;&lt;leopold&gt;&gt;Perhaps it&#39;s more fun to put in some practical experience... Would ?title be interested in helping me sort this box for me?&lt;&lt;/leopold&gt;&gt;
He walks over to his cupboard and retrieves a large grey box. He puts four bowls on the table and empties the rest of the box in front of you, a large collection of coins in different colors and sizes. It looks like he expects you to help him sort his collection.

&lt;&lt;decision &#39;Sort the coins&#39; &#39;Minigame Coins&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;if settings.skipminigames&gt;&gt;
    &lt;&lt;decision &#39;(Cheat) Skip minigame&#39; &#39;Leopold Coins Finish&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="197" name="Leopold Lessons 1" tags="" position="850,2475" size="100,100">You listen as he explains the basics of bookkeeping and how to keep track of income and expenses. He shows you how to use a ledger to record transactions, and he gives you tips for staying organized.</tw-passagedata><tw-passagedata pid="198" name="Leopold Lessons 2" tags="" position="975,2475" size="100,100">?Leopold shows you all the different coins used as currency in the kingdom. He tells you all about the history of the royal mint and how one day you will also be printed on a coin.</tw-passagedata><tw-passagedata pid="199" name="Leopold Lessons 3" tags="" position="1100,2475" size="100,100">Today, ?Leopold takes you through the castle ledgers. He shows you all the expenses necessary for upkeep and lists the taxes that are owed from the nearby villages.</tw-passagedata><tw-passagedata pid="200" name="Leopold Lessons Horny" tags="" position="1225,2475" size="100,100">&lt;&lt;changeschedule leopold &#39;night&#39; &#39;Treasury&#39;&gt;&gt;
While tutoring you, you notice ?leopold seems a bit different than normal. He&#39;s shifting in his seat quite a bit.
At one point during the lesson, you ask him to clarify a certain part of the ledger. He stands up and moves around the desk to look at it with you. The moment he leans over your shoulder to look at the book, you suddenly see why he has been acting uncomfortable before. The massive package in his pants is very visible, mere inches from your face.

&lt;&lt;decision &quot;Stare at his bulge&quot; depravity small&gt;&gt;
    &lt;&lt;img &quot;leopold/tutor_bulge_{theme}.jpg&quot;&gt;&gt;
    For some reason, you can&#39;t keep your eyes off of his package. Every time you try to focus on what he&#39;s explaining, you find your eyes trailing back to his crotch. When he&#39;s standing close to you, you are really surprised at how big it is. You start wondering how big it is without the pants and find yourself getting slightly aroused.
    &lt;&lt;if settings.sph&gt;&gt;
        Your own boner could never make such a big bulge in your pants. Your ?penis is nothing comparing to the thing you see here.
    &lt;&lt;/if&gt;&gt;
    
    After a while he sits down again across from you and smiles at you.
    &lt;&lt;leopold&gt;&gt;Everything alright, ?title? You seem a little distracted.&lt;&lt;/leopold&gt;&gt;
    
    &lt;&lt;if getStat(&#39;depravity&#39;) &gt; 25&gt;&gt;

    &lt;&lt;/if&gt;&gt;
    &lt;&lt;decision &quot;Make up an excuse and ignore it&quot;&gt;&gt;
        &lt;&lt;player&gt;&gt;Y- yes, it&#39;s nothing. I was just daydreaming!&lt;&lt;/player&gt;&gt;
        &lt;&lt;leopold&gt;&gt;Hahaha, believe me, I understand why. This subject is definitely not as exciting as swordfighting with ?wymerus!&lt;&lt;/leopold&gt;&gt;
        As he&#39;s laughing it off you realise you have not paid any attention to the lesson this time. Unfortunately the situation distracted you so much that you learned nothing from this. 
        &lt;&lt;decision &quot;Thank him for the lesson and leave his office&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;addcounter &#39;leopold&#39; 0.5&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Try to ignore it and continue the lesson&quot; &#39;Leopold Lessons&#39;&gt;&gt;&lt;&lt;decisionicon stewardship&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="201" name="Leopold Night" tags="spicy" position="100,2600" size="100,100">&lt;&lt;changeschedule leopold &#39;night&#39; &#39;None&#39;&gt;&gt;
&lt;&lt;addcounter &#39;leopold-night&#39; 2&gt;&gt;
&lt;&lt;first&gt;&gt;
    As you enter ?Leopold&#39;s office to check on him, you can hear him softly saying something but you can&#39;t quite hear what exactly. You slowly open the door and see him sitting behind his desk. It looks like he is alone in the room so who was he talking to? ?nl
    ?Leopold is leaning back in his chair until he sees you, he immediately sits upright, slightly startled.
    &lt;&lt;leopold&gt;&gt;?Title! I&#39;m sorry, you surprised me, what are you doing here so late?&lt;&lt;/leopold&gt;&gt;
    &lt;&lt;player&gt;&gt;I was coming to check on you, ?Leopold. I was walking through the hallway and I notices the light coming from your office. Are you still working this later?&lt;&lt;/player&gt;&gt;
    He stammers slightly as he gives his reply.
    &lt;&lt;leopold&gt;&gt;Ah! Of course, yes, I was- uhm- simply finishing up a few things. I should be done soon, ?title. Thank you for your concern.&lt;&lt;/leopold&gt;&gt;
    As he&#39;s talking you see him shift slightly awkwardly in his chair. You walk closer with an inquisitive look, there&#39;s some kind of strange wet noises you are hearing coming from his desk. Your suspicion causes him to immediately try and draw your attention.
    &lt;&lt;leopold&gt;&gt;Ah but ?title, you should not worry yourself about such trivial things! Please, go sleep for the night and I will be done- ah- very shortly.&lt;&lt;/leopold&gt;&gt;
    You suspiciously look him up and down.
    &lt;&lt;leopold&gt;&gt;You know how it is, the financial work of the kingdom never ends.&lt;&lt;/leopold&gt;&gt;
    &lt;&lt;player&gt;&gt;Yeah... It never ends... Well alright, I&#39;ll leave you to it, ?Leopold. Try not to make it too late.&lt;&lt;/player&gt;&gt;
    &lt;&lt;leopold&gt;&gt;Of course, ?title.&lt;&lt;/leopold&gt;&gt;

    &lt;&lt;decision &quot;Leave his office&quot; &quot;Bedtime&quot;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;then&gt;&gt;
    You once again notice ?Leopold is in his office at night. He was acting very suspicious last time you caught him. This time, instead of barging in, you could be quiet and see if you can hear something. He might be talking again.?nl
    &lt;&lt;decision &quot;Spy on him&quot; depravity small&gt;&gt;
        He&#39;s been acting too weird to not investigate this further. You decide it&#39;s best to spy on him and see what you can find out. You open the door ever so slightly and you can barely make out his figure, once again sitting behind his desk. He&#39;s leaning back and looking down towards something you can&#39;t see. Once again, you hear him softly speak but this time, because you listen attentively, you can make out what he&#39;s saying.
        &lt;&lt;leopold&gt;&gt;Ah, that is good... Keep going...&lt;&lt;/leopold&gt;&gt;
        Who is he talking to right now?
        &lt;&lt;leopold&gt;&gt;Yeah, do you like my big cock, you slut?&lt;&lt;/leopold&gt;&gt;
        Now even more noticeable, you hear the wet sounds coming from under his desk. Someone is giving him a blowjob under there!
        &lt;&lt;leopold&gt;&gt;I know you do... Look up at me while you take my big dick down your throat... Ah yeah that&#39;s good!&lt;&lt;/leopold&gt;&gt;
        This suddenly got very exciting, who is the mystery person under the desk right now?
        &lt;&lt;leopold&gt;&gt;Keep going... Just like that... I&#39;m getting closer...&lt;&lt;/leopold&gt;&gt;
        You hear the blowjob sounds increasing in frequency. It looks like whoever is under there is trying their best to make ?Leopold reach his climax right now.
        &lt;&lt;leopold&gt;&gt;Ah fuck! I&#39;m coming!... Yes... Take it all you fucking slut, let my seed slide down your throat like that.&lt;&lt;/leopold&gt;&gt;
        ?Leopold groans loudly for quite a while, afterwards you see him relax and you can hear a gasping for air sound coming from the desk followed by some coughing.
        &lt;&lt;leopold&gt;&gt;That was wonderful, nicely done. Now get out of here while I clean up.&lt;&lt;/leopold&gt;&gt;
        ?Leopold starts to stand up and close his pants. You hear the mystery person crawling out from under the desk but you can&#39;t quite see them just yet. As you&#39;re waiting to get a look at them, ?Leopold is now walking around the desk and stands perfectly in the way from you seeing this person. Damn.?nl
        He&#39;s now standing so close to the door that there&#39;s a high chance he will spot you soon, you need to get out of here. You can&#39;t believe you didn&#39;t manage to see who the mystery person is.
        &lt;&lt;decision &quot;Leave before you get caught&quot; &quot;Bedtime&quot;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &quot;Leave him alone&quot; &quot;Bedtime&quot; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;finally&gt;&gt;
    &lt;&lt;addtag &#39;leopold-mystery&#39;&gt;&gt;
    You once again notice ?Leopold is in his office at night, probably getting another blowjob. You still don&#39;t know who the mystery person is, you could try to peek on them again.?nl
    &lt;&lt;decision &quot;Spy on them&quot; depravity small&gt;&gt;
        You open the door ever so slightly and you can barely make out his figure, once again sitting behind his desk. He&#39;s leaning back and looking down towards the mystery person. Once again, you hear him softly speak and you can make out what he&#39;s saying.
        &lt;&lt;leopold&gt;&gt;Ah, that is good... Keep going...&lt;&lt;/leopold&gt;&gt;
        &lt;&lt;leopold&gt;&gt;Yeah, do you like my big cock, you slut?&lt;&lt;/leopold&gt;&gt;
        &lt;&lt;leopold&gt;&gt;I know you do... Look up at me while you take my big dick down your throat... Ah yeah that&#39;s good!&lt;&lt;/leopold&gt;&gt;
        Who is this mysterious blowjob person under the desk right now?
        &lt;&lt;leopold&gt;&gt;Keep going... Just like that... I&#39;m getting closer...&lt;&lt;/leopold&gt;&gt;
        You hear the blowjob sounds increasing in frequency. It looks like whoever is under there is trying their best to make ?Leopold reach his climax right now.
        &lt;&lt;leopold&gt;&gt;Ah fuck! I&#39;m coming!... Yes... Take it all you fucking slut, let my seed slide down your throat like that.&lt;&lt;/leopold&gt;&gt;
        ?Leopold groans loudly for quite a while, afterwards you see him relax and you can hear a gasping for air sound coming from the desk followed by some coughing.
        &lt;&lt;leopold&gt;&gt;That was wonderful, nicely done. Now get out of here while I clean up.&lt;&lt;/leopold&gt;&gt;
        ?Leopold starts to stand up and close his pants. You hear the mystery person crawling out from under the desk but you can&#39;t quite see them just yet. As you&#39;re waiting to get a look at them, ?Leopold is now walking around the desk and stands perfectly in the way from you seeing this person. Damn.?nl
        He&#39;s now standing so close to the door that there&#39;s a high chance he will spot you soon, you need to get out of here. You can&#39;t believe you didn&#39;t manage to see who the mystery person is, again.
        &lt;&lt;decision &quot;Leave before you get caught&quot; &quot;Bedtime&quot;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &quot;Leave him alone&quot; &quot;Bedtime&quot; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;

&lt;&lt;/first&gt;&gt;</tw-passagedata><tw-passagedata pid="202" name="Leopold Ask Money" tags="" position="225,2600" size="100,100">You walk into ?Leopold&#39;s office to see him carefully stacking a tower of coins. He finishes aligning the top coin perfectly and looks up as you enter.

&lt;&lt;leopold&gt;&gt;Ah, ?title, here for a lesson in stewardship?&lt;&lt;/leopold&gt;&gt;

&lt;&lt;player&gt;&gt;Actually, ?Leopold, I was just dropping by with a quick question...&lt;&lt;/player&gt;&gt;

He looks at you expectantly. You realize suddenly how strange it is to be asking ?Leopold for gold when, as a prince, you have never had cause to handle money yourself before.

&lt;&lt;player&gt;&gt;I was just wondering whether I could withdraw some, uh, gold from the treasury?&lt;&lt;/player&gt;&gt;

?Leopold looks at you with a confused expression.

&lt;&lt;leopold&gt;&gt;Gold? But ?title, as you know, the treasury already covers all castle expenses. If you need to purchase something in town, your escort will handle the currency for you. Why would you need to access the gold yourself?&lt;&lt;/leopold&gt;&gt;

You quickly try to come up with an excuse, attempting to sound as casual as possible.

&lt;&lt;player&gt;&gt;Yes, of course. I was simply hoping to, um, tip some of the castle staff for...you know...their hard work.&lt;&lt;/player&gt;&gt;

?Leopold raises his eyebrows at you.

&lt;&lt;leopold&gt;&gt;That&#39;s not a euphemism, is it, ?title? You know that relations with castle staff are unbecoming of your station.&lt;&lt;/leopold&gt;&gt;

You feel your cheeks grow hot with embarrassment. At least ?Leopold doesn&#39;t seem to have caught on to the fact that you&#39;ve been sneaking out of the castle, but this is not going as well as you&#39;d hoped.

&lt;&lt;decision &#39;Order him to give you the money&#39;&gt;&gt;

    &lt;&lt;changemoney &#39;gold&#39; +100&gt;&gt;

    &lt;&lt;player&gt;&gt;I am the prince, ?Leopold. Need I remind you that you work for me? It is not your place to question my actions. I demand that you give me gold at once.&lt;&lt;/player&gt;&gt;

    ?Leopold stares at you, clearly surprised by your assertive response. 

    &lt;&lt;leopold&gt;&gt;Uh, yes, of course, ?title. Please forgive me. I meant no offense.&lt;&lt;/leopold&gt;&gt;

    He quickly hands over a pouch filled with &lt;&lt;money &#39;gold&#39; false 100&gt;&gt; gold.

    &lt;&lt;player&gt;&gt;Thank you. I will take my leave now.&lt;&lt;/player&gt;&gt;

    Amazed that that worked, you quickly pocket the gold and turn to depart ?Leopold&#39;s office.

    &lt;&lt;decision &#39;Return to the castle&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;

&lt;&lt;needstat &#39;dominance&#39; 100&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Give up on the issue&#39;&gt;&gt;

    &lt;&lt;player&gt;&gt;Of course not. It was a silly question. Please forget I asked it.&lt;&lt;/player&gt;&gt;

    He gives you a long look before chuckling to himself.

    &lt;&lt;leopold&gt;&gt;You know, ?title, if you wish to handle gold, you may always help me sort coins...&lt;&lt;/leopold&gt;&gt;

    &lt;&lt;player&gt;&gt;Perhaps another time.&lt;&lt;/player&gt;&gt;

    You&#39;re not sure what you expected to happen, but this is probably as good an outcome as any. You turn and quickly leave the office before ?Leopold can get any more ideas.

    &lt;&lt;decision &#39;Return to the castle&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;

&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="203" name="Morgana" tags="" position="350,2600" size="100,100">&lt;&lt;if hasQuest(&#39;interrogate-morgana&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Confront ?Morgana&#39; &#39;Morgana Confront About Assassin&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $location is &#39;Library&#39; and hasQuest(&#39;meet-morgana&#39;)&gt;&gt;
    &lt;&lt;set _quest to true&gt;&gt;
    &lt;&lt;decision &#39;You see ?Morgana here, reading some magic tome&#39; &#39;Meet Morgana 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $location is &#39;Bedroom&#39; and getTime() === &#39;night&#39;&gt;&gt;
    &lt;&lt;if hasQuest(&#39;morgana-bedroom&#39;)&gt;&gt;
        &lt;&lt;set _quest to true&gt;&gt;
        &lt;&lt;decision &#39;You hear a knocking on your bedroom door&#39; &#39;Morgana Bedroom 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;if hasQuest(&#39;morgana-potion&#39;)&gt;&gt;
        &lt;&lt;set _quest to true&gt;&gt;
        &lt;&lt;decision &#39;You hear a knocking on your bedroom door, sounds like it\&#39;s ?Morgana again&#39; &#39;Morgana Potion 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $location is &#39;Workshop&#39;&gt;&gt;
    &lt;&lt;if hasQuest(&#39;morgana-workshop-visit&#39;) and !hasCounter(&#39;morgana-quest-delay&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Talk about the next steps&#39; &#39;Morgana Forest Plan&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;elseif hasQuest(&#39;morgana-potion-store&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Inquire about the new potions&#39; &#39;Morgana Workshop New Potion&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;decision &#39;Visit ?Morgana&#39; &#39;Morgana Workshop Visit&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasQuest(&#39;morgana-ointment&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Talk to ?Morgana about the ointment&#39; &#39;Morgana Ointment 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasQuest(&#39;morgana-kitchen&#39;)&gt;&gt;
    &lt;&lt;set _quest to true&gt;&gt;
    &lt;&lt;decision &#39;Meet ?Morgana to discuss the expedition&#39; &#39;Morgana Kitchen 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasQuest(&#39;morgana-confront&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Confront ?Morgana about the effects of the potion&#39; &#39;Morgana Confront&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasQuest(&#39;morgana-discuss-princess&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Talk to ?Morgana about becoming a Princess&#39; &#39;Morgana Discuss Become Princess&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if questStep(&#39;princess-lessons-intro&#39;) is 5&gt;&gt;
    &lt;&lt;decision &#39;Discuss your Princess lessons with ?Morgana&#39; &#39;Morgana Finish Princess Training Intro&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasQuest(&#39;princess-lessons&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Tell ?Morgana you are ready to face the council&#39; &#39;Thanks for playing&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $location is &#39;Garden&#39;&gt;&gt;
    &lt;&lt;if hasQuest(&#39;morgana-ointment-garden&#39;) and getTime() === &#39;morning&#39;&gt;&gt;
        &lt;&lt;set _quest to true&gt;&gt;
        &lt;&lt;decision &#39;You spot ?Morgana, standing next to the flowerbeds&#39; &#39;Morgana Ointment 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;elseif !_quest&gt;&gt;
        &lt;&lt;decision &#39;You see ?Morgana painting on a canvas in the grass&#39; &#39;Morgana Painting&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="204" name="Morgana Acknowledgement" tags="" position="475,2600" size="100,100">&lt;&lt;acknowledgement morgana&gt;&gt;
    &lt;&lt;mention assassination&gt;&gt;
        &lt;&lt;morgana&gt;&gt;Glad to see you doing well again after that whole ordeal.&lt;&lt;/morgana&gt;&gt;
        &lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;
            &lt;&lt;morgana&gt;&gt;I have taken the liberty of telling people about your brave fought out there. You were quite impressive in such a stressful situation.&lt;&lt;/morgana&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;mention status&gt;&gt;
        &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
            As soon as ?Morgana sees you she looks at you with a face of pure joy and excitement.
            &lt;&lt;morgana&gt;&gt;Wow... The potion worked! ?Title, I never thought it would work so well!&lt;&lt;/morgana&gt;&gt;
            She looks you up and down, taking in the noticeable changes to your body.
        &lt;&lt;elseif face() is &#39;andro&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;fem&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;man&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
&lt;&lt;/acknowledgement&gt;&gt;</tw-passagedata><tw-passagedata pid="205" name="Morgana Painting" tags="" position="600,2600" size="100,100">As you walk through the castle gardens you spot ?morgana, standing in front of her easel and canvas, painting the flowerbeds filled with roses. She notices you as you approach.
&lt;&lt;morgana&gt;&gt;Ah, ?title! Perfect timing, I was about to start painting the beautiful gardens of our castle. Would you perhaps join me and share your artistic vision?&lt;&lt;/morgana&gt;&gt;
&lt;&lt;include &#39;Morgana Acknowledgement&#39;&gt;&gt;
&lt;&lt;decision &#39;Accept&#39;&gt;&gt;
    /* &lt;&lt;addcounter &#39;morgana-garden-morning&#39; 2&gt;&gt; */
    &lt;&lt;player&gt;&gt;I would be delighted to.&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Wonderful! Please grab a brush whenever you&#39;re ready.&lt;&lt;/morgana&gt;&gt;
    She grabs some extra painting supplies and sets up a second canvas, you notice she has two separate palettes holding different sets of colors.
    &lt;&lt;morgana&gt;&gt;I must confess, there&#39;s a certain magic that I have infused these colors with. Certain ingredients make for &lt;em&gt;interesting&lt;/em&gt; magical effects that could even flow from painting into artist. Please, ?title, take your pick from the palettes.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;decision &#39;Choose the light pastel colors, with mainly pink hues&#39; &#39;Minigame Painting&#39; femininity 0&gt;&gt;
        &lt;&lt;script&gt;&gt;variables().minigames.painting.palette = &quot;pastel&quot;&lt;&lt;/script&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Choose the palette with mostly deep and aggressive colors&#39; &#39;Minigame Painting&#39; masculinity 0&gt;&gt;
        &lt;&lt;script&gt;&gt;variables().minigames.painting.palette = &quot;dark&quot;&lt;&lt;/script&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;if settings.skipminigames&gt;&gt;
        &lt;&lt;decision &#39;(Cheat) Skip minigame with femininity&#39; &#39;Morgana Painting Finish&#39; femininity 0&gt;&gt;
            &lt;&lt;script&gt;&gt;
                variables().minigames.painting.palette = &quot;pastel&quot;;
                variables().minigames.painting.colors = 20;
                variables().minigames.painting.filled = 100;
            &lt;&lt;/script&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
        &lt;&lt;decision &#39;(Cheat) Skip minigame with masculinity&#39; &#39;Morgana Painting Finish&#39; masculinity 0&gt;&gt;
            &lt;&lt;script&gt;&gt;
                variables().minigames.painting.palette = &quot;dark&quot;;
                variables().minigames.painting.colors = 20;
                variables().minigames.painting.filled = 100;
            &lt;&lt;/script&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Decline&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;I&#39;m sorry, ?morgana. I&#39;m afraid I don&#39;t have the time for that right now.&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Of course, ?title. I will be here should you need me.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;decision &#39;Leave&#39; &#39;Garden&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="206" name="Morgana Painting Finish" tags="" position="725,2600" size="100,100">?Morgana takes a long look at your canvas, having a moment to take in all your work.
&lt;&lt;if $minigames.painting.colors &lt; 2 or $minigames.painting.filled &lt; 10&gt;&gt;
    &lt;&lt;morgana&gt;&gt;An original piece, I suppose, ?title. But perhaps it would capture more of your personality if you were to use more paint... I&#39;m afraid the magical properties of this paint only work when you impart enough of your own personality on the canvas.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;I&#39;m sorry, ?Morgana. Perhaps I could try that for next time.&lt;&lt;/player&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;effect charm&gt;&gt;
    &lt;&lt;if $minigames.painting.colors &gt; 2 and $minigames.painting.filled &gt; 33&gt;&gt;
        &lt;&lt;set _statAmount = 3&gt;&gt;
        &lt;&lt;morgana&gt;&gt;?Title, this is simply wonderful! I love the shapes and different colors, very well done!&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;set _statAmount = 1&gt;&gt;
        &lt;&lt;morgana&gt;&gt;This is a nice painting, ?title. Though I do wonder if you were would use more colors and paint it would be even more powerful of an image.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    You feel a strange sensation as your painting hums with a soft magic that you can almost feel flowing through you.
    &lt;&lt;if $minigames.painting.palette is &#39;pastel&#39;&gt;&gt;
        &lt;&lt;changestat femininity _statAmount&gt;&gt;
        &lt;&lt;morgana&gt;&gt;Such a feminine design you have gone for, ?title. They say an artist&#39;s choice of colors reflect their own personality. Do you feel the magic of the paint flow through you?&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;changestat masculinity _statAmount&gt;&gt;
        &lt;&lt;morgana&gt;&gt;Quite a powerful image you have made, ?title. They say an artist&#39;s choice of colors reflect their own personality. Do you feel the magic of your art flow through you?&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;player&gt;&gt;Yes... It&#39;s quite a strange feeling...&lt;&lt;/player&gt;&gt;
    You catch yourself staring at the art a bit before looking back at ?Morgana.
    &lt;&lt;player&gt;&gt;Though it was quite fun, thanks for letting me paint with you, ?Morgana.&lt;&lt;/player&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;morgana&gt;&gt;Of course, ?title. I&#39;m usually here painting in the morning should you want to join me again.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;decision &#39;Take your leave&#39; &#39;Garden&#39;&gt;&gt;&lt;&lt;effect charm off&gt;&gt;&lt;&lt;addcounter &#39;morgana-garden&#39; 1&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="207" name="Meet Morgana 1" tags="" position="850,2600" size="100,100">You walk into the castle library and see ?morgana, the royal sorceress, sitting at a table. She looks up from her book and smiles.
&lt;&lt;morgana&gt;&gt;Thank you for meeting me, ?title. I called you here to discuss the pressing matter.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;You mean the matter about my marriage? Why did you want to meet with just the two of us about that anyways?&lt;&lt;/player&gt;&gt;
It seems like she ignores the question, as she holds out her hand to you. &lt;&lt;morgana short&gt;&gt;May I?&lt;&lt;/morgana&gt;&gt; Gesturing for you to let her examine your hand.

&lt;&lt;decision &quot;Give her your hand&quot; &#39;Meet Morgana 2&#39; submissiveness medium&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Tell her you want to know what this is about first&quot; dominance medium&gt;&gt;
    &lt;&lt;player&gt;&gt;No, first tell me what this is about.&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;It&#39;s nothing to be afraid of, ?title. I simply wish to examine your hands. I have a plan to help with the marriage issue but I need to examine you first.&lt;&lt;/morgana&gt;&gt;
    You sigh and decide it&#39;s best to play along for now.
    &lt;&lt;decision &quot;Give her your hand&quot; &#39;Meet Morgana 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="208" name="Meet Morgana 2" tags="" position="975,2600" size="100,100">You lay your hand in hers and she starts carefully examining it. She runs her fingers along the lines in the palm of your hand.
&lt;&lt;morgana&gt;&gt;You have beautiful hands, ?title. I sense a strength in you.&lt;&lt;/morgana&gt;&gt;
You look at her, slightly uncomfortable. She continues and palpates your fingers slowly. You feel a slight magical energy coming from her touches.
&lt;&lt;morgana short&gt;&gt;Just hold still like that.&lt;&lt;/morgana&gt;&gt;
You feel more and more energy running from her hands. A soft purple glow starts emanating from it, it feels warm and soft but also strange.?nl
The warmth starts to feel intense, she&#39;s definitely casting some kind of spell on you.

&lt;&lt;decision &quot;Let her complete the spell&quot; femininity medium&gt;&gt;
    &lt;&lt;effect charm&gt;&gt;
    &lt;&lt;addsin &#39;magic&#39;&gt;&gt;
    You feel a strong warmth wash over you, purple light shines from your hand briefly. She looks at you, happily.
    &lt;&lt;morgana&gt;&gt;I didn&#39;t expect it to work that well, interesting.&lt;&lt;/morgana&gt;&gt;
    /* &lt;&lt;changerelation morgana 10&gt;&gt; */

    The warm feeling flowing through your body feels good, it fades after a short moment. You look at her, slightly concerned.
    &lt;&lt;player&gt;&gt;What was that spell?&lt;&lt;/player&gt;&gt;
    &lt;&lt;decision &quot;Listen to her explain the spell&quot; &#39;Meet Morgana 3&#39;&gt;&gt;
        &lt;&lt;effect charm off&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Rip your hand away&quot;&gt;&gt;
    You quickly pull your hand away before the spell could finish.
    &lt;&lt;player&gt;&gt;Stop, I didn&#39;t ask you to start casting spells on me!&lt;&lt;/player&gt;&gt;
    She looks at you, concerned.
    &lt;&lt;morgana&gt;&gt;I&#39;m sorry, ?title. I should&#39;ve explained the spell first. It&#39;s fine, we don&#39;t have to do it.&lt;&lt;/morgana&gt;&gt;
    You calm down and listen to her explanation.
    &lt;&lt;decision &quot;Listen to her explain the spell&quot; &#39;Meet Morgana 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="209" name="Meet Morgana 3" tags="" position="1100,2600" size="100,100">&lt;&lt;morgana&gt;&gt;That spell was simply to test how well my transformative magic works on you. It feels like your body responds very well to it, ?title.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;And why are you doing this to me now?&lt;&lt;/player&gt;&gt;
She looks at you with a serious face.
&lt;&lt;morgana&gt;&gt;My predecessor, ?Godric, was always careful about using transformation magic. I, however, am quite a bit more adept in that field. I believe this kind of magic can be used to our benefit.&lt;&lt;/morgana&gt;&gt;
You look at her, puzzled.
&lt;&lt;player&gt;&gt;Benefit how?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Well, it can help right now, with the marriage issue. This magic can not only improve your looks, but it can also alter your behaviour. It could help you adapt to courtly etiquette better.&lt;&lt;/morgana&gt;&gt;
You give her a slightly offended look.
&lt;&lt;morgana&gt;&gt;I&#39;m sorry, ?title. This magic is nothing but a tool that can help you, it is by no means evidence of anything you are lacking but simply there to help you improve yourself.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Very well... However, the issue with my marriage is not related to me but it lies in the fact there are no eligible princesses.&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Of course, it&#39;s difficult to explain, but just trust me when I say that this magic will help with that issue. See it as a way to easily impress the councillors on how good of a prince you are. You want to impress them, don&#39;t you?&lt;&lt;/morgana&gt;&gt;
You are a bit reluctant but decide to let her help you.
&lt;&lt;player&gt;&gt;I suppose... What is it that you would need me to do?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Join me in the garden in the morning, ?title. We can go on a little walk together to discuss this further.&lt;&lt;/morgana&gt;&gt;
This whole situation confuses you slightly. But she is the court sorceress and she is here to help you, it might be interesting to help her.
&lt;&lt;player&gt;&gt;Fine, I will see you in the garden.&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &quot;Leave her&quot; &#39;Library&#39;&gt;&gt;
    &lt;&lt;changeschedule morgana &#39;noon&#39; &#39;Garden&#39;&gt;&gt;
    &lt;&lt;completequest meet-morgana&gt;&gt;
    &lt;&lt;startquest morgana-ointment-garden&gt;&gt;
    &lt;&lt;addcounter morgana 1&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="210" name="Morgana Ointment 1" tags="" position="1225,2600" size="100,100">As you stand in the garden and see ?Morgana in the distance. You can feel the morning sun warming your back as you walk over to her. 
&lt;&lt;morgana&gt;&gt;Good morning, ?title. Lovely to have you join me.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Of course, ?Morgana. It is a nice morning for a walk. I must say you&#39;ve had me quite curious about this magical plan of yours.&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;So quick to the point, ?title! Isn&#39;t it also important to get to know each other better now that I am your new royal sorceress?&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Ah, naturally, ?Morgana. I meant no offense... Let us first have a walk together then.&lt;&lt;/player&gt;&gt;
She laughs softly and smiles at you. She gestures to take your arm as you commence your stroll.?nl
You walk together through the royal gardens, side by side. The gardens are massive, with all kinds of beautiful flowers growing in neatly organized patches maintained by the royal gardeners.
&lt;&lt;player&gt;&gt;So uhm- How are you adjusting to your new position?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Quite well, I think. Though it&#39;s taking some time to set up my workshop, I have a lot of alchemical equipment to unpack still.&lt;&lt;/morgana&gt;&gt;
You smile at her and continue asking unimportant question as you walk, though the real issue on your mind is that of her magic.
&lt;&lt;morgana&gt;&gt;I was only jesting earlier, ?title. Of course we can discuss my proposal. In fact, we&#39;re at the exact right spot for the first step of my plan.&lt;&lt;/morgana&gt;&gt;
As she piques your interest she suddenly stops in front of two large flower beds. She turns towards the flowers, carefully observing them.
&lt;&lt;player&gt;&gt;For your plan you need... Flowers?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Yes, but not just any flowers. &lt;em&gt;magical&lt;/em&gt; flowers. They are ingredients for a transformative salve I can make for you. The exact nature is not important, just that it&#39;s important for you.&lt;&lt;/morgana&gt;&gt;
You&#39;re quite confused by her need for this but you do follow her as she steps closer to the flower beds. You can hear a soft hum coming from the flowers, is that what makes them magical?
&lt;&lt;morgana&gt;&gt;Pick a flower for me, ?title. Left or right, your choice.&lt;&lt;/morgana&gt;&gt;
She looks at your expectantly. You have a puzzled look on your face and want to immediately ask for further explanation but quickly realize it must be some kind of test and she probably isn&#39;t going to give any more information. It&#39;s just picking a flower, does it really matter?
&lt;&lt;player&gt;&gt;Uhm. Okay, let me see...&lt;&lt;/player&gt;&gt;
You look carefully over the flower beds, both of them have similar flowers growing in them but the flowers on your right are a distinct blue color while the flowers on your left have a bright pink shade. They both look quite beautiful.

&lt;&lt;addtag ointment&gt;&gt;
&lt;&lt;decision &#39;Pick a blue flower&#39; &#39;Morgana Ointment Flower&#39;&gt;&gt;
    &lt;&lt;decisionicon masculinity&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Pick a pink flower&#39; &#39;Morgana Ointment Flower&#39;&gt;&gt;
    &lt;&lt;addtag ointment-fem&gt;&gt;
    &lt;&lt;decisionicon femininity&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="211" name="Morgana Ointment Flower" tags="" position="100,2725" size="100,100">You reach over to one of the flower and pull it from the ground. The bright color looks quite beautiful. You turn around and hand the flower over to ?Morgana.
&lt;&lt;morgana&gt;&gt;Interesting choice, ?title... I will get started right away.&lt;&lt;/morgana&gt;&gt;
She takes the flower from you and begins walking back towards the castle.  
&lt;&lt;player&gt;&gt;Get started on what exactly?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Feel free to follow me if you&#39;re so inclined, ?title.&lt;&lt;/morgana&gt;&gt;
You follow her, feeling a bit confused and intrigued. She leads you to your bedroom and stands at the door.
&lt;&lt;morgana&gt;&gt;Would you mind waiting in here, ?title? I will be back shortly.&lt;&lt;/morgana&gt;&gt;
She walks off in the direction of her workshop. You wonder what she is up to, but you know that you&#39;ll find out soon enough.

&lt;&lt;decision &#39;Wait for her to return&#39; &#39;Morgana Ointment 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="212" name="Morgana Ointment 2" tags="" position="225,2725" size="100,100">&lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
&lt;&lt;increasetime 1&gt;&gt;
You wait inside your bedroom for quite a while before she finally returns. She enters your chambers with a small jar filled with &lt;&lt;if hasTag(&#39;ointment-fem&#39;)&gt;&gt;pink&lt;&lt;else&gt;&gt;blue&lt;&lt;/if&gt;&gt; ointment and hands it to you.
&lt;&lt;morgana&gt;&gt;This is for you, ?title. It is important that you use it. Apply it to your skin before bathing in the morning.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;img &#39;equipment/ointment.jpg&#39; null &#39;200px&#39;&gt;&gt;
You take the jar and examine it, feeling a bit skeptical.
&lt;&lt;player&gt;&gt;What does it do?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;It will make your body more receptive to transformative magic and already provides some trace amount of that in itself.&lt;&lt;/morgana&gt;&gt;
You&#39;re not sure if you&#39;re really interested in this, but she seems adamant that you try it.
&lt;&lt;morgana&gt;&gt;Come see me once you have applied the salve three times before morning baths, the effects should be noticeable by then.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Very well, if I won&#39;t forget, I guess I could try it..&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;She says goodbye and leaves your bedroom&#39; &#39;Bedroom&#39;&gt;&gt;
    &lt;&lt;addcounter morgana 1&gt;&gt;
    &lt;&lt;completequest morgana-ointment-garden&gt;&gt;
    &lt;&lt;startquest morgana-ointment&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="213" name="Morgana Ointment 3" tags="" position="350,2725" size="100,100">You walk over to ?Morgana to talk to her. Before you say anything she takes your hand and runs her hand along your arm.
&lt;&lt;if questStep(&#39;morgana-ointment&#39;) &lt; 4&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Hmm... You haven&#39;t used the ointment much, have you? Come back to me once it&#39;s settled in more, you&#39;ll need to used it before morning bathes several times.&lt;&lt;/morgana&gt;&gt;
    You nod to her.
    &lt;&lt;player&gt;&gt;I&#39;ll suppose I&#39;ll be back later then, ?Morgana.&lt;&lt;/player&gt;&gt;
    &lt;&lt;decision &#39;Leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;completequest morgana-ointment&gt;&gt;
    &lt;&lt;if hasTag(&#39;ointment-fem&#39;)&gt;&gt;
        &lt;&lt;morgana&gt;&gt;Wonderful! Your skin feels much smoother, looks like there&#39;s less hairs as well. This is all very important for being a good prince. It&#39;s time we look at the next steps.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;morgana&gt;&gt;Wonderful! It seems like the magic in the salve really works. This will be very useful for you in the future. It&#39;s time we look at the next steps.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;player&gt;&gt;Next steps? What more could you want?&lt;&lt;/player&gt;&gt;
    She laughs slightly and looks at you.
    &lt;&lt;morgana&gt;&gt;It&#39;s not about what &lt;em&gt;I&lt;/em&gt; want, ?title. You must remember that we are doing this for you. I&#39;m simply here to serve you. Anything for you, ?title.&lt;&lt;/morgana&gt;&gt;
    She runs her hands along your arms.
    &lt;&lt;player&gt;&gt;F- fine, whatever you say, I suppose. What are the next steps of the plan then?&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;It&#39;s quite a delicate matter, ?title. We should discuss it where nobody can bother us. It&#39;s best if we go over this somewhere private...&lt;&lt;/morgana&gt;&gt;
    She stares at you with a strange glint in her eyes. Does she mean what you think she means...? While you ponder that question the answer becomes increasingly clear as she starts undoing the top part of her dress, giving a better view of her ample cleavage.
    &lt;&lt;morgana&gt;&gt;Would it be okay if I visited you in your bedroom tomorrow night? We can go over the plan on how to help you, and in turn, the kingdom.&lt;&lt;/morgana&gt;&gt;
    You can&#39;t deny you&#39;re attracted to the beautiful mage. You have always found her looming mystique quite interesting but you would never have guessed she would come onto you like this. Totally caught off guard, you stammer out a response. 
    &lt;&lt;player&gt;&gt;Uh- right- well- if that&#39;s what&#39;s needed to help the kingdom, of course.&lt;&lt;/player&gt;&gt;
    She smiles at you and touches your hand one more time as she starts leaving the room, winking at you.
    &lt;&lt;morgana&gt;&gt;Very good. See you then, ?title.&lt;&lt;/morgana&gt;&gt;

    &lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;
        &lt;&lt;addcounter &#39;morgana&#39; 1&gt;&gt;
        &lt;&lt;changeschedule morgana &#39;night&#39; &#39;Bedroom&#39;&gt;&gt;
        &lt;&lt;startquest morgana-bedroom&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="214" name="Morgana Bedroom 1" tags="" position="475,2725" size="100,100">You open the door to your bedroom and once again find ?Morgana standing there, this time during much a much later hour. She smiles at you and walks inside. You can&#39;t help but notice that she&#39;s wearing something a little more revealing: a dress that barely covers her shape. 
&lt;&lt;img &quot;morgana/bedroom_visit_{theme}.jpg&quot;&gt;&gt;
You look at her sheepishly while she smiles mischievously.
&lt;&lt;morgana&gt;&gt;Do you approve of the outfit, ?title?&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Y- yes, you are looking very nice, ?Morgana.&lt;&lt;/player&gt;&gt;
She laughs, walks over to your bed and sits down, patting her hand on the mattress next to her. You follow her and sit down on the bed. She immediately scooches closer to you. A soft glow appears in her hand, like she&#39;s holding a purple orb of pure light.?nl
She looks at your expectantly, exactly like she was when she took your hand in the library. It seems like she wants to cast another spell on you and is waiting for your approval.

&lt;&lt;decision &#39;Nod and allow her to cast the spell&#39; &#39;Morgana Bedroom 2&#39; femininity small&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Decline her magic&#39; &#39;Morgana Bedroom 2 No Spell&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="215" name="Morgana Bedroom 2 No Spell" tags="" position="600,2725" size="100,100">You shake your head at her reluctantly.
&lt;&lt;player&gt;&gt;Sorry, ?Morgana. I don&#39;t think I want one of your spells right now.&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Of course, ?title. That is well within your right, your wish is my command.&lt;&lt;/morgana&gt;&gt;
She smiles at you as she continues her explanation.
&lt;&lt;morgana&gt;&gt;I&#39;m very happy you agreed to meet with me here, ?title. You see, for the next step to help you, I&#39;ve been working on a potion. There&#39;s just one ingredient I am missing.&lt;&lt;/morgana&gt;&gt;
You look into her deep purple eyes and find comfort, it seems like she genuinely just wants the best for you.
&lt;&lt;morgana&gt;&gt;This is a little unorthodox but I require your essence, ?title... A pure extract of your most lustful desires... This fluid ingredient will allow me to unlock powerful magic to help you.&lt;&lt;/morgana&gt;&gt;
Is she really asking for your ?essence? She&#39;s your royal sorceress and her help is often vital to you but this seems a little strange. You suppose this potion is actually important if she&#39;s asking it so directly.
&lt;&lt;player&gt;&gt;Uhm, oh, that is unexpected- Well, if it&#39;s for this important potion, I- uhm- suppose I could help you with that...&lt;&lt;/player&gt;&gt;
She has a beaming smile and pulls out a small empty vial, and lays it down on the bed.
&lt;&lt;morgana&gt;&gt;I&#39;m happy to hear that, ?title. Now, for the extraction process... If you&#39;d prefer I could wait outside for you to complete this yourself.&lt;&lt;/morgana&gt;&gt;
She gives you a sultry look.
&lt;&lt;morgana&gt;&gt;Or, if you&#39;d like, I thought it would be only fair for me stay around and help you in this process...&lt;&lt;/morgana&gt;&gt;
She&#39;s directly asking you whether you&#39;d want her to stay around while you masturbate into the glass vial. The overwhelming choice makes you think for a moment.

&lt;&lt;decision &#39;Confirm that you\&#39;d like her to stay&#39; &#39;Morgana Bedroom 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Ask her to wait outside&#39; &#39;Morgana Bedroom 3 Alone&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="216" name="Morgana Bedroom 2" tags="spicy" position="725,2725" size="100,100">&lt;&lt;effect charm&gt;&gt;
You feel a rush of lust wash over you. You&#39;re pretty sure she cast some kind of aphrodisiac spell on you and all you care about now is her beautiful body.
&lt;&lt;morgana&gt;&gt;There... I&#39;m very happy you agreed to meet with me here, ?title. You see, for the next step to help you, I&#39;ve been working on a potion. There&#39;s just one ingredient I am missing.&lt;&lt;/morgana&gt;&gt;
You are far too distracted to attentively listen to her, you give her a nod while you keep staring at her breasts. She smiles at you as she continues.
&lt;&lt;morgana&gt;&gt;I require your essence, ?title... A pure extract of your most lustful desires... This fluid ingredient will allow me to unlock powerful magic to help you.&lt;&lt;/morgana&gt;&gt;
You noticed after the spell was cast you immediately got a boner. 
&lt;&lt;if settings.sph&gt;&gt;
    You see her staring down at your crotch with a slightly suspicious look.
&lt;&lt;else&gt;&gt;
    Your first instinct was to hide it but it looks like you can&#39;t even do that anymore. She seems to have taken notice as you see her smile while looking down at your crotch.
&lt;&lt;/if&gt;&gt;
&lt;&lt;player&gt;&gt;Ah, if it&#39;s for this important potion, I&#39;ll gladly help you with that...&lt;&lt;/player&gt;&gt;
She has a beaming smile and pulls out a small empty vial, and lays it down on the bed.
&lt;&lt;morgana&gt;&gt;I&#39;m happy to hear that, ?title. Now, for the extraction process... If you&#39;d prefer I could wait outside for you to complete this yourself.&lt;&lt;/morgana&gt;&gt;
She gives you a sultry look.
&lt;&lt;morgana&gt;&gt;Or, if you&#39;d like, I thought it would be only fair for me stay around and help you in this process...&lt;&lt;/morgana&gt;&gt;
She&#39;s directly asking you whether you&#39;d want her to stay around while you masturbate into the glass vial. Overcome with lust, you know you&#39;re more than happy to fill that vial for her.

&lt;&lt;decision &#39;Confirm that you\&#39;d like her to stay&#39; &#39;Morgana Bedroom 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Ask her to wait outside&#39; &#39;Morgana Bedroom 3 Alone&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="217" name="Morgana Bedroom 3 Alone" tags="spicy" position="850,2725" size="100,100">You look at her with a hesitant expression.
&lt;&lt;player&gt;&gt;Perhaps it would be better if you could give me some privacy?&lt;&lt;/player&gt;&gt;
She nods at you and immediately gets up from the bed.
&lt;&lt;morgana&gt;&gt;Of course, ?title. I will be waiting right outside. Please take your time, there&#39;s no need to rush this but it is important that you give me the essence fresh, I must use it right away.&lt;&lt;/morgana&gt;&gt;
You nod at her. She puts the glass vial in your hand and moves to exit the bedroom, leaving you alone.?nl
Strange, you&#39;re now sitting on the bed and look at the empty glass vial. It&#39;s supposedly important for her to create this potion but it definitely feels weird to jerk off for her. Might as well get this over with quickly.?nl

You lower your pants and get started with the task at hand. Luckily it doesn&#39;t take long at all to bring yourself to climax and you carefully collect the result in the glass vial.?nl

You walk over to the door and slowly open it, finding ?Morgana patiently waiting outside. She beams as she spots the filled vial.

&lt;&lt;player&gt;&gt;Uhm- there you go, ?Morgana. I hope that&#39;s enough.&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Yes, very nice, ?title! That&#39;s more than enough!&lt;&lt;/morgana&gt;&gt;
She looks more than pleased as she holds up the vial of your essence and she puts a tiny cork on it.
&lt;&lt;morgana&gt;&gt;Thank you for this, ?title. The potion is most potent when distilled while fresh, I will start working on it immediately.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Very well, uhm- good luck I guess.&lt;&lt;/player&gt;&gt;
She smiles at you as she turns around and takes her leave. Tired out, you close the bedroom door again and flop down on the bed.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Go to sleep&#39; &#39;Sleep&#39;&gt;&gt;
    &lt;&lt;effect charm off&gt;&gt;
    &lt;&lt;addcounter morgana 3&gt;&gt;
    &lt;&lt;completequest morgana-bedroom&gt;&gt;
    &lt;&lt;addsin &#39;masturbation&#39;&gt;&gt;
    &lt;&lt;startquest morgana-potion&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="218" name="Morgana Bedroom 3" tags="spicy" position="975,2725" size="100,100">You lustfully nod at her, making clear that you&#39;d love for her to help you. She slowly starts undoing the straps of her dress as she&#39;s sitting next to you. You stare in amazement as the top part of her dress falls off.
&lt;&lt;img &quot;morgana/bedroom_visit_naked_{theme}.jpg&quot;&gt;&gt;
She smiles at you as she stares at your crotch.
&lt;&lt;morgana&gt;&gt;If this sight pleases ?title, he could start pleasuring himself.&lt;&lt;/morgana&gt;&gt;
You are completely overtaken with lust as she says this.
 
&lt;&lt;if settings.sph&gt;&gt;
    She looks down at your crotch again and looks slightly confused.
    &lt;&lt;morgana&gt;&gt;?Title, I&#39;m sorry, does my form not please you? I expected this to more noticeable affect you.&lt;&lt;/morgana&gt;&gt;
    You now realise the origin of her confusion, she probably expected you to have a more visible bulge in your pants by now.
    &lt;&lt;player&gt;&gt;No- uh- you are looking wonderful, it&#39;s just uh-&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Is something wrong, ?title? You can tell me.&lt;&lt;/morgana&gt;&gt;
    You are much too horny, she was asking you to masturbate anyways so you start taking off your pants.?nl
    She looks at you with a slightly worried look, but then quickly realises why she didn&#39;t see a bulge once you take off your underpants, revealing your ?dick.?nl
    You look down at your ?penis, still small even though you are completely hard and look up at her face. She has a big smile as she stares at your ?dick. It almost looks like she&#39;s holding back a laugh.
    &lt;&lt;morgana&gt;&gt;Ah, it&#39;s quite alright, ?title. Nothing to be ashamed off, it looks very cute...&lt;&lt;/morgana&gt;&gt;
    She awkwardly laughs a bit.
    &lt;&lt;morgana&gt;&gt;And big, of course. Not just cute!&lt;&lt;/morgana&gt;&gt;
&lt;&lt;else&gt;&gt;
    Your first instinct was to hide it but it looks like you can&#39;t even do that anymore. She seems to have taken notice as you see her smile while looking down at your crotch, anticipatively.?nl
    You pull down your pants, revealing your erect cock.
    &lt;&lt;morgana&gt;&gt;Very good, ?title...&lt;&lt;/morgana&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;morgana&gt;&gt;Now, please feel free to pleasure yourself- Oh, right, let me provide visual stimulation, of course.&lt;&lt;/morgana&gt;&gt;
She says as she starts playing with her boobs. She looks down at them and starts moaning slightly. It would be very clear she&#39;s acting the part but in your horny state it doesn&#39;t matter much. You start masturbating your dick to her sitting next to you.

&lt;&lt;if settings.vids&gt;&gt;
    &lt;&lt;if settings.sph&gt;&gt;
        &lt;&lt;video &#39;player/masturbate_sph.webm&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;video &#39;player/masturbate.webm&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

You have no time to think about how surreal the situation feels to you. All you can focus on now is her perfect form. It doesn&#39;t take long before you feel yourself getting close to the climax. You don&#39;t stop to think that it might be embarrassing cumming so quickly already and start going faster and faster.
&lt;&lt;player&gt;&gt;I- I&#39;m close, ?Morgana&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Oh yes! Very good, ?title, keep going!&lt;&lt;/morgana&gt;&gt;
She immediately takes a vial that she was holding and moves it next to your dick. You start masturbating faster and faster. You look at her as you start cumming. She suddenly grabs your ?dick and aims it right at the vial, making sure all the cum lands in it.
You moan as you let her catch your entire cumshot.

&lt;&lt;if settings.vids&gt;&gt;
    &lt;&lt;if settings.sph&gt;&gt;
        &lt;&lt;video &#39;player/cum_in_vial_sph.webm&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;video &#39;player/cum_in_vial.webm&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;morgana&gt;&gt;Yes, very nice, ?title! That&#39;s more than enough!&lt;&lt;/morgana&gt;&gt;
She looks more than pleased as she holds up the vial of cum. She stuffs a tiny cork on it and puts on her dress again.
&lt;&lt;morgana&gt;&gt;Thank you for this, ?title. I will start crafting the potion immediately.&lt;&lt;/morgana&gt;&gt;
She says as she gets up to leave the room.
&lt;&lt;player&gt;&gt;Wait, you&#39;re leaving already?&lt;&lt;/player&gt;&gt;
You look at her, still recovering from what just happened.
&lt;&lt;morgana&gt;&gt;I&#39;m sorry, ?title, there&#39;s really not much time. The potion is most potent when distilled while fresh. I will finish the potion and come visit another night, we might have more fun like this, if ?title would want that.&lt;&lt;/morgana&gt;&gt;
There&#39;s nothing you would rather have than spending more time with her so you give her a nod, completely charmed. She smiles at you as she leaves the room.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Go to sleep&#39; &#39;Sleep&#39;&gt;&gt;
    &lt;&lt;effect charm off&gt;&gt;
    &lt;&lt;addcounter morgana 3&gt;&gt;
    &lt;&lt;completequest morgana-bedroom&gt;&gt;
    &lt;&lt;addsin &#39;masturbation&#39;&gt;&gt;
    &lt;&lt;startquest morgana-potion&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="219" name="Morgana Potion 1" tags="" position="1100,2725" size="100,100">You open the door for her and she immediately enters the room. The revealing outfit is once again very noticeable.
&lt;&lt;morgana&gt;&gt;I did it, ?title! The potion is ready!&lt;&lt;/morgana&gt;&gt;
She holds up a glass bottle, it has a white swirling substance inside. You look at her, quizzically.
&lt;&lt;player&gt;&gt;So... What does it do exactly?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Lots of things, here, let me explain.&lt;&lt;/morgana&gt;&gt;
She takes your hand and takes you to the bed. She sits down on the center and guides you to lay down next to her. Her black hair touches your skin as you can feel her warmth close to you. She has a mystifying and enchanting smell to her. As you lay down you see her hands glow purple again, but this time she looks at you with a questioning look.?nl

&lt;&lt;decision &#39;Allow her to cast a spell on you again&#39; femininity small&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    &lt;&lt;addsin &#39;magic&#39;&gt;&gt;
    You feel a warmth run through you again, your ?dick immediately starts swelling up even more.
    Even though you simply want to see her naked again, this potion sounds pretty important and you are still reluctant about it. She caresses your cheeks with her hands.?nl
    &lt;&lt;decision &#39;Discuss the potion&#39; &#39;Morgana Potion 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Decline her magic&#39;&gt;&gt;
    You pull away from her, indicating that you have no interest in her spells right now. The light in her hand disappears and she smiles at you.

    &lt;&lt;morgana&gt;&gt;Ah I&#39;m sorry, ?title. I know spells can feel strange sometimes, I won&#39;t cast anything if you do not wish me to.&lt;&lt;/morgana&gt;&gt;

    You nod at her and she focuses her attention back on the matter at hand.
    &lt;&lt;decision &#39;Discuss the potion&#39; &#39;Morgana Potion 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="220" name="Morgana Potion 2" tags="" position="1225,2725" size="100,100">&lt;&lt;morgana&gt;&gt;This potion will help guide you to become an even better prince. Do you remember that transformative spell I cast on you? It showed us how much your body accepts this kind of magic. This potion will start the process of the transformation.&lt;&lt;/morgana&gt;&gt;
You look at her slightly concerned.
&lt;&lt;player&gt;&gt;Transforming what exactly?&lt;&lt;if settings.cum&gt;&gt; And I don&#39;t mean to sound improper, but didn&#39;t you say one ingredient of this potion was my own sperm?&lt;&lt;/if&gt;&gt;&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;&lt;&lt;if settings.cum&gt;&gt;I know the main ingredient is a little unorthodox but m&lt;&lt;else&gt;&gt;M&lt;&lt;/if&gt;&gt;any a great kings have used similar magic, all in the pursuit of betterment. I believe I have...seen something in you... If you ever pondered the idea of living a...different life, this potion will help you achieve that.&lt;&lt;/morgana&gt;&gt;
You turn away for a moment, thinking this over. For some reason, she doesn&#39;t need to give a clear explanation for you to understand. You consider the idea of this, but your mind is occupied with other thoughts as well. Having ?Morgana here, in your bedroom at night, makes you feel... excited. Your brain is not in a position to contemplate potions and their consequences right now...?nl

She suddenly moves closer to you and whispers something to you.

&lt;&lt;morgana&gt;&gt;Perhaps... I could help you gain some focus...&lt;&lt;/morgana&gt;&gt;

She slowly moves her hand over your leg very sensually as she looks you in your eyes.

&lt;&lt;morgana&gt;&gt;Is this okay, ?title?&lt;&lt;/morgana&gt;&gt;

&lt;&lt;decision &#39;Let ?Morgana caress you&#39; &#39;Morgana Potion Handjob&#39; depravity small&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Decline her advances&#39;&gt;&gt;
    You carefully lift her hand and move it off of yourself.
    &lt;&lt;player&gt;&gt;I&#39;m sorry, ?Morgana. I think it would be improper for us to do that.&lt;&lt;/player&gt;&gt;
    She nods at you and smiles.
    &lt;&lt;morgana&gt;&gt;Of course, ?title. No need to say sorry. I should be apologizing for even suggesting it.&lt;&lt;/morgana&gt;&gt;
    You&#39;re both silent for a moment before she continues.
    &lt;&lt;morgana&gt;&gt;Perhaps we could just discuss the potion instead?&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;decision &#39;Decide on the potion&#39; &#39;Morgana Potion 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="221" name="Morgana Potion Handjob" tags="spicy" position="100,2850" size="100,100">She smiles at you and then you feel her hand moving down your body. She&#39;s softly touching your leg as she&#39;s sitting next to you.
&lt;&lt;morgana&gt;&gt;You have to believe I simply want what&#39;s best for you, ?title. I am here to serve you.&lt;&lt;/morgana&gt;&gt; 
You&#39;ve never had a woman caress you this much before and it feels heavenly. You stare at her as she starts stripping her dress.

&lt;&lt;img &quot;morgana/bedroom_visit_naked_{theme}.jpg&quot;&gt;&gt;

You are completely charmed by her. Her naked body is a sight to behold, her curves accentuate her beauty, you could stare at her for at least a few eternities. Suddenly, you feel overwhelmed by pleasure as she lays her hand on your crotch.
&lt;&lt;morgana&gt;&gt;It&#39;s alright, ?title. Let me take care of you...&lt;&lt;/morgana&gt;&gt;
She starts slowly massaging your ?dick through your pants as you let out a soft moan.
&lt;&lt;if settings.sph&gt;&gt;
    ?nl She can&#39;t seem to get a good grip with her entire hand so she quickly switches to only using a few fingers on your ?dick.
&lt;&lt;/if&gt;&gt;
&lt;&lt;morgana&gt;&gt;That&#39;s it, ?title... Allow me to serve you.&lt;&lt;/morgana&gt;&gt;
You make intense eye contact as she&#39;s masturbating you faster. You are guided almost completely by lust as you feel yourself growing closer to an orgasm.

&lt;&lt;player&gt;&gt;Ah- ?Morgana... I&#39;m close...&lt;&lt;/player&gt;&gt;

She keeps stroking faster and faster until you can&#39;t keep it in anymore.

&lt;&lt;morgana&gt;&gt;Yes... That&#39;s it, cum for me, ?title...&lt;&lt;/morgana&gt;&gt;

You moan as you &lt;&lt;if settings.cum&gt;&gt;wet your pants with cum, soaking your underwear.&lt;&lt;else&gt;&gt;reach your climax.&lt;&lt;/if&gt;&gt;?nl
She releases her grip on your ?dick as it starts to soften. She looks up at you and smiles.

&lt;&lt;morgana&gt;&gt;There, doesn&#39;t that help clear your mind? Perhaps now we can discuss the potion.&lt;&lt;/morgana&gt;&gt;
All you can do is nod at her as you recover from your intense orgasm.
&lt;&lt;decision &#39;Decide on the potion&#39; &#39;Morgana Potion 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="222" name="Morgana Potion 3" tags="" position="225,2850" size="100,100">She holds the small flask in her hand and offers it to you. The magic swirling inside is vibrant and strangely warm to the touch. A purple storm can be seen inside the bottle.?nl

This potion would have a big effect on you. From her mysterious demeanor it&#39;s difficult to guess the exact effects, but the implication seems to be that the potion would make you more...androgynous? You take the potion in your hand as you consider whether that would be something you want...?nl

?Morgana looks at you expectantly...

&lt;span class=&quot;notice danger&quot;&gt;This is an important decision that can only be made once in the story!&lt;/span&gt;
&lt;&lt;decision &#39;Drink the potion&#39; &#39;Morgana Potion Accepted&#39; femininity small&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Have her drink the potion instead&#39; &#39;Morgana Potion Denied&#39; dominance huge&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Tell her you don\&#39;t want to drink the potion&#39; &#39;Morgana Potion Neutral&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="223" name="Morgana Potion Accepted" tags="spicy" position="350,2850" size="100,100">You let her pour the contents of the potion in your mouth, you can taste the bitterness as the white substance enter your mouth. 
&lt;&lt;morgana&gt;&gt;There, please swallow, ?title.&lt;&lt;/morgana&gt;&gt;
You stare at her, completely at her mercy as you do exactly what she asks. You swallow as you feel the thick liquid slide down your throat. You immediately feel this intense warmth wash over you. It kind of feels like the spells ?Morgana has been casting on you but much more extreme. Instead of just the lustful feeling, you get the idea this affects something deeper within you.  
&lt;&lt;morgana&gt;&gt;Show me.&lt;&lt;/morgana&gt;&gt; 
She motions for you to open your mouth and you instinctively open it to show her you swallowed all of it. It almost felt like you obeyed her automatically...
She lies down next to you and stares at you with a big smile.
&lt;&lt;morgana&gt;&gt;?Title, I am so proud of you...&lt;&lt;/morgana&gt;&gt;
Her enthusiasm is slightly infecting but you also feel yourself tiring really quickly as you have trouble keeping your eyes open.
&lt;&lt;morgana&gt;&gt;Oh yes, the potion can be quite energy draining when adjusting to it. Let it wash over you ?title, go to sleep. We will see each other soon.&lt;&lt;/morgana&gt;&gt;
Your eyes start closing right after you see her get up and leave your room.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Go to sleep&#39; &#39;Sleep&#39;&gt;&gt;
    &lt;&lt;completequest morgana-potion&gt;&gt;
    &lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Event Potion Transformation&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;addevent dream &#39;Dream Event Potion Transformation&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;changeschedule morgana night &#39;None&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="224" name="Morgana Potion Denied" tags="spicy" position="475,2850" size="100,100">She looks at you in shock as you take the potion and quickly pour it into her mouth. She starts objecting but you look at her intensely.
&lt;&lt;player&gt;&gt;It&#39;s all right, I&#39;m just going to need you to try out the potion for me. It&#39;s completely safe, right? You wouldn&#39;t mind showing me how it works first?&lt;&lt;/player&gt;&gt;
She seems very reluctant and as you&#39;re making sure that she doesn&#39;t spit it out it looks like she decided to obey you, swallowing the liquid.
&lt;&lt;morgana&gt;&gt;?title... Why did you do that...&lt;&lt;/morgana&gt;&gt;
You would feel bad for manipulating her into drinking that were it not for the fact that she was planning to do the exact same thing to you.
&lt;&lt;player&gt;&gt;I&#39;m sorry, ?morgana. I&#39;m not just going to drink the magic potion you give me without seeing what it does first.&lt;&lt;/player&gt;&gt;
She looks slightly confused and you see her cheeks flush red.
&lt;&lt;morgana&gt;&gt;Well, ?title... I cannot tell you what it does but I can share that the potion is quite different when drank by another person than it was intended for...&lt;&lt;/morgana&gt;&gt;
You look at her with annoyed suspicion. Once again, ?morgana is withholding information from you. While mulling over what to say next you decide to just be forward and tell her you&#39;ve had enough of that.
&lt;&lt;player&gt;&gt;No, ?morgana. I&#39;m done with the secrecy. You will elaborate on what the potion does and tell me about it right now!&lt;&lt;/player&gt;&gt;
You see her strain against something, it&#39;s almost like she suddenly gets very distracted, like her mind is not completely here. Then, when she seemingly snaps out of it she gives you a strange look that you haven&#39;t seen before.
&lt;&lt;morgana&gt;&gt;Of course, ?title. I will stop hiding information from you. The potion contains strong transformative power. Seeing as it contains your &#39;essence&#39;, this would help your body accept magical transformations more easily and even stimulate physical changes to yourself based on your own behaviour.&lt;&lt;/morgana&gt;&gt;
Interesting, she seemed very intent on not telling you much until you directly ordered her to. She&#39;s never listened to you like that before, is this an effect of the potion?
&lt;&lt;morgana&gt;&gt;When another person ingests the potion, I&#39;m genuinely not entirely sure what happens... The transformative magic should inhibit them still, but in a much different way. Perhaps linking the two in some way?&lt;&lt;/morgana&gt;&gt;
You think you already have some idea of the effects of it as they&#39;re very visible now. ?Morgana&#39;s mysterious nature seems to not be as important to her now as she suddenly gives much more information about the potion. Which suddenly brings you to a very important question.
&lt;&lt;player&gt;&gt;Why did you want me to drink this potion?&lt;&lt;/player&gt;&gt;
You once again see her strain against something, like she&#39;s trying to fight the effects of the potion. Once she snaps out of it, she answers you.
&lt;&lt;morgana&gt;&gt;I wanted to help change you, I believed I saw a different path for you, the potion would simply let you be who you might have been on the inside... But perhaps I was wrong...&lt;&lt;/morgana&gt;&gt;
That&#39;s... A vague but genuine sounding answer... You sit there, thinking about the implications of this.
&lt;&lt;morgana&gt;&gt;I&#39;m sorry, ?title... The potion is draining my energy, I must rest. Perhaps we can speak another time.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Of course, ?morgana. I&#39;m feeling quite tired as well.&lt;&lt;/player&gt;&gt;
As she gets up from the bed she gives you a long look, she seems to be thinking something over, contemplating whether to say something but she instead just nods.
&lt;&lt;morgana&gt;&gt;Good night, ?title.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Good night, ?morgana.&lt;&lt;/player&gt;&gt;
She exits your room with a creaked closing of the door. Now alone, you feel impacted by the weight of this strange night. It&#39;s probably best to sleep on it.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Go to sleep&#39; &#39;Chapter&#39;&gt;&gt;
    &lt;&lt;completequest morgana-potion&gt;&gt;
    &lt;&lt;startquest morgana-confront&gt;&gt;
    &lt;&lt;addtag &#39;morgana-dominated&#39;&gt;&gt;
    &lt;&lt;set $chapter = 2&gt;&gt;
    &lt;&lt;set $chaptertitle = &#39;Chapter Two&#39;&gt;&gt;
    &lt;&lt;set $chaptertarget = &#39;Sleep&#39;&gt;&gt;
    &lt;&lt;set $chaptertimeskip = false&gt;&gt;
    &lt;&lt;changeschedule morgana night &#39;None&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="225" name="Morgana Potion Neutral" tags="spicy" position="600,2850" size="100,100">&lt;&lt;morgana&gt;&gt;What&#39;s wrong, ?title? Do you not wish to drink the potion?&lt;&lt;/morgana&gt;&gt;
You&#39;re almost scared of disappointing her but admit your feelings nonetheless.
&lt;&lt;player&gt;&gt;I&#39;m sorry, ?Morgana, but... No... I don&#39;t think I want to drink the potion. I know you said it could help me but I&#39;m just-&lt;&lt;/player&gt;&gt;
Before you continue your explanation she interjects you as she helps you sit upright.
&lt;&lt;morgana&gt;&gt;It&#39;s alright, ?title. You don&#39;t have to explain. If you&#39;re uninterested I won&#39;t push you.&lt;&lt;/morgana&gt;&gt;
She takes the potion away as she puts the little cork back on the bottle.
&lt;&lt;morgana&gt;&gt;At least we had some fun this evening, I hope I didn&#39;t come on too strong, ?title.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Well no, I- uhm- definitely had fun...&lt;&lt;/player&gt;&gt;
?Morgana grins at you and you blush slightly when you think about how to basically just got a handjob from your royal sorceress.
&lt;&lt;player&gt;&gt;But why did you want me to drink this potion in the first place?&lt;&lt;/player&gt;&gt;
She gives a short sigh, as if she&#39;s finally content with forgoing the secrecy.
&lt;&lt;morgana&gt;&gt;I... wanted to help change you, I believed I saw a different path for you, the potion would simply let you be who you might have been on the inside... But perhaps I was wrong.&lt;&lt;/morgana&gt;&gt;
That&#39;s... A vague but genuine sounding answer... You sit there, thinking about the implications of this.
&lt;&lt;morgana&gt;&gt;Perhaps we could discuss it more another time, It&#39;s getting late already.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Of course, ?morgana. I&#39;m feeling quite tired as well.&lt;&lt;/player&gt;&gt;
As she gets up from the bed she gives you a long look, she seems to be thinking something over, contemplating whether to say something but she instead just nods.
&lt;&lt;morgana&gt;&gt;Good night, ?title.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Good night, ?morgana.&lt;&lt;/player&gt;&gt;
She exits your room with a creaked closing of the door. Now alone, you feel impacted by the weight of this strange night. It&#39;s probably best to sleep on it.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Go to sleep&#39; &#39;Chapter&#39;&gt;&gt;
    &lt;&lt;completequest morgana-potion&gt;&gt;
    &lt;&lt;startquest morgana-confront&gt;&gt;
    &lt;&lt;set $chapter = 2&gt;&gt;
    &lt;&lt;set $chaptertitle = &#39;Chapter Two&#39;&gt;&gt;
    &lt;&lt;set $chaptertarget = &#39;Sleep&#39;&gt;&gt;
    &lt;&lt;set $chaptertimeskip = false&gt;&gt;
    &lt;&lt;changeschedule morgana night &#39;None&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="226" name="Morgana Confront" tags="" position="725,2850" size="100,100">&lt;&lt;completequest morgana-confront&gt;&gt;
&lt;&lt;changeschedule morgana evening &#39;Workshop&#39;&gt;&gt;
&lt;&lt;unlocklocation &#39;Workshop&#39;&gt;&gt;
&lt;&lt;addcounter &#39;morgana-quest-delay&#39; 3&gt;&gt;
&lt;&lt;startquest morgana-workshop-visit&gt;&gt;
&lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
    As soon as ?Morgana sees you, she looks at you with a face of pure joy and excitement.
    &lt;&lt;morgana&gt;&gt;Wow... The potion worked! ?Title, I never thought it would work so well!&lt;&lt;/morgana&gt;&gt;
    She looks you up and down, taking in the noticeable changes to your body.
    &lt;&lt;morgana&gt;&gt;Such soft skin, so delicate. Wonderful!&lt;&lt;/morgana&gt;&gt;
    You want to be mad at her, you want to shout at her to give you an explanation but before you can gather yourself to do so, something inside you doesn&#39;t want to do that. She&#39;s the one who transformed you... You feel so much better in your current body, you really can&#39;t be mad at her, can you?
    &lt;&lt;player&gt;&gt;I- uhm... Yes, the potion seems to have worked... I just wanted to know... Why did you make me do this?&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Make you? ?title, I&#39;m sorry but I did not make you do anything. I told you why you needed to take these steps and you wisely chose to listen to my council.&lt;&lt;/morgana&gt;&gt;
    You  difficult to argue with her. Though her reasoning is far from sound, you accept her explanation like that for now.
    &lt;&lt;player&gt;&gt;Very well, I do admit that the transformation feels better than expected...&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;I&#39;m very glad to hear it, ?title. Now, before we continue to take any next steps you must allow your body to adjust.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;More next steps, does that mean we are still not done with these things?&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Of course not, ?title. You have seen the real benefit to these transformations now, wouldn&#39;t you want to keep pursuing this to make yourself an even better prince?&lt;&lt;/morgana&gt;&gt;
    You do admit that you are quite intrigued in the process by now.
    &lt;&lt;player&gt;&gt;I think so, yes...&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;I&#39;m happy to hear that from you. Let&#39;s first give you some time to adjust and then discuss the next plan in my workshop. Meanwhile, you can come visit me there in the evenings, I&#39;ll make sure it&#39;s open to you, ?title.&lt;&lt;/morgana&gt;&gt;
    ?Morgana&#39;s workshop? The sorcerer&#39;s tower is the part of the castle that&#39;s completely locked off from the rest. Only the Royal Sorceress decides who goes in or out, it&#39;s quite a privilege to be allowed in there.
    &lt;&lt;player&gt;&gt;Thank you, ?Morgana. I will come by to visit you.&lt;&lt;/player&gt;&gt;
&lt;&lt;elseif hasTag(&#39;morgana-dominated&#39;)&gt;&gt;
    You walk up to ?Morgana and she immediately gives you a very courteous bow. Something feels... different about her.
    &lt;&lt;morgana&gt;&gt;I&#39;m at your service, ?title.&lt;&lt;/morgana&gt;&gt;
    She has always been respectful to you but you must say she has ever acted so... servile towards you.
    &lt;&lt;player&gt;&gt;I&#39;m glad to hear it, ?Morgana. I was hoping to discuss the recent events.&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Of course, ?title. Do you wish to know more about the effects of the potion on me?&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;Uhm, well yes, that would be a good start.&lt;&lt;/player&gt;&gt;
    She immediately answers you without so much as a hint of reluctancy.
    &lt;&lt;morgana&gt;&gt;It seems the potion has had quite a strong mental effect on me. It has changed me to become much more submissive towards you, ?title. I find it more and more difficult to not follow through on the orders you give me and now prefer to be completely transparent with you.&lt;&lt;/morgana&gt;&gt;
    You would feel kind of bad about the whole situation but you must say it mostly intrigues you right now.
    &lt;&lt;player&gt;&gt;That&#39;s very interesting to hear, how long do you think the effect lasts?&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;That is difficult to say, ?title. I first felt the effect should wear out soon but it might also have a permanent effect, I&#39;m not sure yet.&lt;&lt;/morgana&gt;&gt;
    A strange though suddenly pops into your mind.
    &lt;&lt;player&gt;&gt;And say, do you think it&#39;s possible to make more of these potions?&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Of course, ?title. I can get right on that. I&#39;m busy in my workshop most evenings, I could come by to extract more of your necessary essence and then distill it in my workshop then.&lt;&lt;/morgana&gt;&gt;
    Extracting essence... Her plain way of putting such deviant acts does make you feel turned on slightly.?nl
    You think to yourself: Wouldn&#39;t it be more efficient to handle the extraction process right there in her workshop? But that&#39;s likely difficult, the sorcerer&#39;s tower is the part of the castle that&#39;s completely locked off from the rest. Only the Royal Sorceress decides who goes in or out, it&#39;s quite a privilege to be allowed in there and you&#39;ve not heard of ?Morgana ever inviting someone in yet.
    &lt;&lt;player&gt;&gt;Perhaps I could come visit you in your workshop instead?&lt;&lt;/player&gt;&gt;
    Without skipping a beat she answers you.
    &lt;&lt;morgana&gt;&gt;Certainly, ?title. I will make sure you have access to my workshop. I will be there most evenings and you are welcome to visit.&lt;&lt;/morgana&gt;&gt;
    Well... That was easy. That potion definitely is some strong stuff.
    &lt;&lt;morgana&gt;&gt;If you come visit in a few days I might have a plan on some next steps, ?title.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;Alright, uh- I suppose I&#39;ll see you there then.&lt;&lt;/player&gt;&gt;
    She bows to you again as you leave her alone for now.
&lt;&lt;else&gt;&gt;
    You walk up to ?Morgana and she gives you a very courteous bow.
    &lt;&lt;morgana&gt;&gt;Good to see you, ?title.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;Hello, ?Morgana. I was hoping to discuss the recent events.&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Yes, I have done some reflecting and I want to take a moment to apologize to you. I feel like I&#39;ve come on too strong. I didn&#39;t mean to put you in an awkward position and make you do something you were uncomfortable with.&lt;&lt;/morgana&gt;&gt;
    She seems like she has serious concern for you as she comes with this realization to you.
    &lt;&lt;player&gt;&gt;Well, uhm, it&#39;s quite alright ?Morgana. But I would definitely prefer to be informed beforehand when you plan something like that again.&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Of course, ?title.&lt;&lt;/morgana&gt;&gt;
    She gives you another respectful bow before she meets your eyes again.
    &lt;&lt;morgana&gt;&gt;On the topic though, I hope I didn&#39;t completely scare you away from my transformative magic. I still believe it could be of benefit to you.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;I suppose I&#39;m an open-minded prince.&lt;&lt;/player&gt;&gt;
    You smile at her as she seems very happy to hear that answer.
    &lt;&lt;morgana&gt;&gt;Great! I was actually working on something in my workshop. You could come visit me in the evenings if you&#39;d like.&lt;&lt;/morgana&gt;&gt;
    She suddenly steps closer to you to whisper in your ears.
    &lt;&lt;morgana&gt;&gt;And if you&#39;re interested we could extract some more of your ?essence while you&#39;re visiting...&lt;&lt;/morgana&gt;&gt;
    You immediately start to blush at her implication. You audibly gulp before you give her a response.
    &lt;&lt;player&gt;&gt;Perhaps I could find time to visit sometime...&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Splendid, ?title. If you come visit in a few days I might have a plan on some next steps, ?title.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;Alright, uh- I suppose I&#39;ll see you there then.&lt;&lt;/player&gt;&gt;
    She bows to you again as you leave her alone for now.
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &#39;Leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="227" name="Morgana Forest Plan" tags="" position="850,2850" size="100,100">&lt;&lt;completequest morgana-workshop-visit&gt;&gt;
&lt;&lt;addcounter morgana 1&gt;&gt;
?Morgana welcomes you to her workshop and sits you down on a chair next to her desk.
&lt;&lt;morgana&gt;&gt;It&#39;s time we take a little trip, we will leave the castle and go to the nearby forest to gather some ingredients.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Very well, I will ask the guard captain to set up an escort-&lt;&lt;/player&gt;&gt;
You get cut off by her.
&lt;&lt;morgana&gt;&gt;No, ?title. It&#39;s important we go together with no one else. I can&#39;t be expected to work my magic in peace while we have a whole escort, drawing attention from everyone nearby. Besides, I&#39;ll be there to protect you so you have nothing to fear. I am quite formidable, as you know.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;But the guards will never allow this. You know they would never let me out of the castle on my own. Once they spot me trying to leave the castle they would stop me.&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;That&#39;s why we have to make sure they won&#39;t spot you. I&#39;ll explain later, meet me tomorrow, whenever you&#39;re ready to go to the forest.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Well, okay then, I will see you tomorrow...&lt;&lt;/player&gt;&gt;
&lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;
    &lt;&lt;startquest morgana-kitchen&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="228" name="Morgana Kitchen 1" tags="" position="975,2850" size="100,100">&lt;&lt;morgana&gt;&gt;There you are, ?title! Are you ready for our little expedition into the forest? Fear not, all we need to do is gather some mushrooms in the woods. There&#39;s a nice place I want to show you out there.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;first&gt;&gt;
    &lt;&lt;player&gt;&gt;Well, I&#39;m not quite ready as you haven&#39;t shared how I&#39;m supposed to get past the guards yet.&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Of course, don&#39;t worry. I have a good plan that will help you get past them. All you need is a disguise. Follow me to the kitchen.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;decision &#39;Follow her&#39; &#39;Morgana Kitchen 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;finally&gt;&gt;
    &lt;&lt;decision &#39;Follow her to the kitchen again&#39; &#39;Morgana Kitchen 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/first&gt;&gt;</tw-passagedata><tw-passagedata pid="229" name="Morgana Kitchen 2" tags="" position="1100,2850" size="100,100">&lt;&lt;setlocation &#39;Kitchen&#39;&gt;&gt;
?Morgana takes you to the kitchen, where she opens a supply closet and asks you to step inside.
&lt;&lt;morgana&gt;&gt;All you need is a proper disguise, inside you will find a kitchen maid outfit, nobody will recognise you in that.&lt;&lt;/morgana&gt;&gt;

&lt;&lt;first&gt;&gt;
You stare at her, dumbfounded.
&lt;&lt;player&gt;&gt;You want me to wear a girls uniform? Why would I do that??&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;It&#39;s the only reliable way to make sure nobody recognises you. Nobody will expect you to dress up like a girl.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;But why not disguise like a man? Can&#39;t I simply wear some different kind of clothes?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Because you would be checked, they can&#39;t simply have any man go in or out. Kitchen girls, however, enter and leave the castle all the time. Wear the outfit and you&#39;ll have no trouble getting past the guards.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;/first&gt;&gt;
Is she actually expecting you to step into the larder and change into such an outfit just like that? You can&#39;t believe you&#39;re actually considering this... You feel that her reasoning behind not being able to use a masculine disguise doesn&#39;t makes that much sense though. There&#39;s plenty of male servants in the castle, you could probably blend in if you wanted to. She does seem very convinced about the plan and you have learned that when ?Morgana is determined, she doesn&#39;t relent easily. Perhaps it might be better to just go along with her plan, she must have a reason to do it this way...

&lt;span class=&quot;notice danger&quot;&gt;This is an important decision that can only be made once in the story!&lt;/span&gt;
&lt;&lt;decision &quot;Give in and enter the supply closet&quot; &quot;Morgana Kitchen 3&quot; femininity small&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Demand a different disguise&quot; &quot;Morgana Kitchen Masculine&quot; masculinity small&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Decline this insane plan&quot; virtue small&gt;&gt;
    &lt;&lt;player&gt;&gt;No, I can&#39;t do this, this goes way too far!&lt;&lt;/player&gt;&gt;
    She takes a moment to consider your outburst before the responds calmly.
    &lt;&lt;morgana&gt;&gt;Very well, of course I wouldn&#39;t want to force you to do something you are uncomfortable. Unfortunately, it has to be just the two of us when we go out in the woods, I can&#39;t help you another way. Come find me when you reconsider.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;decision &quot;Take your leave&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;addcounter &#39;morgana&#39; 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="230" name="Morgana Kitchen 3" tags="" position="1225,2850" size="100,100">&lt;&lt;addtag crossdresser&gt;&gt;
&lt;&lt;setlocation &#39;Larder&#39;&gt;&gt;
?Morgana closes the closet door behind you and leaves you to get changed. Luckily the kitchen maid uniform is very modest, it consists of an apron over a long dress that covers you up to your ankles and a large white bonnet that covers your hair and part of your face. Wanting to get this over with as soon as possible, you start undressing.
After you rifle through the different articles of clothing you will have to put on, you suddenly notices one piece you didn&#39;t see before: A white pair of girls panties. Either ?Morgana put this here by accident or she really expects you to wear it. There&#39;s really no reason to wear it though, it serves no purpose to the disguise.

&lt;&lt;decision &quot;Keep your own underwear on&quot; virtue small&gt;&gt;
    Yeah no way you&#39;re doing &lt;em&gt;that&lt;/em&gt;. You quickly change your clothes and leave the panties there.
    &lt;&lt;decision &quot;Finish changing and leave the closet&quot; &#39;Morgana Kitchen 4&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Put on the girly panties&quot; femininity small&gt;&gt;
    &lt;&lt;unlockequipment &#39;panties&#39;&gt;&gt;
    &lt;&lt;equip &#39;panties&#39;&gt;&gt;
    &lt;&lt;addsin &#39;wearing-panties&#39;&gt;&gt;
    &lt;&lt;if isInChastity()&gt;&gt;
        You&#39;re not exactly sure why you&#39;re doing what you&#39;re doing right now but you start taking off your own underwear and slip the white panties on. You are simply too curious. The panties feel smooth on your skin, though you struggle to get them over your cage. Once they are on completely, they are nice and snug around your caged ?dick. For some reason, you feel very aroused right now, and your ?dick pulses uncomfortably inside its prison. You almost let these arousing feelings completely take over before you hear from the other side of the door.
    &lt;&lt;else&gt;&gt;
        You&#39;re not exactly sure why you&#39;re doing what you&#39;re doing right now but you start taking off your own underwear and slip the white panties on. You are simply too curious. The panties feel smooth on your skin and once you get them on completely, nice and snug around your ?dick, you immediately see the effect it has on you. The tip of your ?dick is sticking out above the panties. For some reason, you feel very aroused right now. While trying to get your ?dick situated in the panties, you almost let these arousing feelings completely take over before you hear from the other side of the door.
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Is everything alright, ?title? Do you require assistance?&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;Yes- I mean, no, it&#39;s alright and I don&#39;t need assistance! I&#39;ll be out in a second!&lt;&lt;/player&gt;&gt;
    &lt;&lt;decision &quot;Finish changing and leave the closet&quot; &#39;Morgana Kitchen 4&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="231" name="Morgana Kitchen Masculine" tags="" position="100,2975" size="100,100">&lt;&lt;player&gt;&gt;?Morgana, I thank you for the effort you put into this plan but I won&#39;t be going along with it like this. I like the idea of sneaking out of the castle but I am not going to crossdress for it. Find me a masculine disguise and I will join you.&lt;&lt;/player&gt;&gt;
Her plan is absurd to you and you won&#39;t be having it like this. She doesn&#39;t seem to accept your disagreement with her plan immediately as she tries to still convince you before she stops herself.
&lt;&lt;morgana&gt;&gt;I think you could perhaps-&lt;&lt;/morgana&gt;&gt;
As she&#39;s attempting to coerce you still, you look at her with a strong determination in your eyes. You are the prince and your preference is mandate, this is a fact you often find that needs reminding to your councillors. She meets your gaze as she&#39;s talking and very quickly cuts herself off as she looks down at the floor.
&lt;&lt;morgana&gt;&gt;Uh- Of course, ?title. I believed this plan could work better with the disguise I prepared but perhaps you are right, it could just as well work with a different outfit.&lt;&lt;/morgana&gt;&gt;
You nod at her approvingly. You&#39;re actually quite proud of yourself of convincing ?Morgana like that.
&lt;&lt;morgana&gt;&gt;Very well, I will try to find a manservant&#39;s outfit. It will get you past the guards and we can then enter the forest together. I will come find you in your room when I have everything ready.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Thank you, ?Morgana. I look forward to our excursion.&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Me too, ?title. I will come to your room soon.&lt;&lt;/morgana&gt;&gt;
She smiles at you as she leaves the kitchen, leaving you alone.

&lt;&lt;decision &quot;Leave the kitchen&quot; &#39;Hallway&#39;&gt;&gt;
    &lt;&lt;completequest morgana-kitchen&gt;&gt;
    &lt;&lt;addcounter &#39;morgana-bedroom&#39; 3&gt;&gt;
    &lt;&lt;startquest morgana-forest&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Event Morgana Forest&#39;&gt;&gt;&lt;&lt;prerequisite not hasCounter(&#39;morgana-bedroom&#39;)&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="232" name="Morgana Kitchen 4" tags="" position="225,2975" size="100,100">&lt;&lt;setlocation &#39;Kitchen&#39;&gt;&gt;
&lt;&lt;equip &#39;flats&#39;&gt;&gt;
&lt;&lt;equip &#39;kitchen_maid&#39;&gt;&gt;
You walk out of the closet, changed into a kitchen maid outfit while you are still fumbling with the bonnet. ?Morgana looks you up and down and gives you a smile. You try to avoid eye contact as to hide your embarrassment.
&lt;&lt;morgana&gt;&gt;You look great, ?title. Here, let me help you with that, once we get the bonnet on nobody will recognise you.&lt;&lt;/morgana&gt;&gt;
She takes the bonnet off your head and starts untying the bad knot you made. Right at that moment the kitchen door suddenly opens and you see ?Rosa walk in with a basket full of bread. She sees both of your standing there.
&lt;&lt;rosa&gt;&gt;Oh! My apologies, &lt;&lt;name morgana &#39;Lady&#39;&gt;&gt;, I didn&#39;t know you were here. Who&#39;s the new-&lt;&lt;/rosa&gt;&gt;
She squints and looks at you a bit puzzled.
&lt;&lt;rosa&gt;&gt;M&#39;lord? What are you doing wearing-&lt;&lt;/rosa&gt;&gt;
?Morgana immediately cuts her off.
&lt;&lt;morgana&gt;&gt;Maybe it&#39;s best you leave us alone for a bit, ?Rosa.&lt;&lt;/morgana&gt;&gt;
She looks slightly confused and embarrassed about catching you here.
&lt;&lt;rosa&gt;&gt;Of course! I am very sorry for interrupting!&lt;&lt;/rosa&gt;&gt;
She very quickly leaves the kitchen again. You immediately dash into the supply closet again and start to change back.
&lt;&lt;player&gt;&gt;See? Everyone recognises me immediately! There&#39;s no way this works! I&#39;m not doing this!&lt;&lt;/player&gt;&gt;
?Morgana tries to calm you down while you furiously start getting out of the dress.
&lt;&lt;morgana&gt;&gt;You weren&#39;t wearing the bonnet yet, ?title. It would cover you up more and ensure nobody recognises you. Don&#39;t worry, I&#39;ll have a chat with ?Rosa, she wont be telling anyone.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;We&#39;re not doing this now, ?Morgana. I don&#39;t know why I agreed to get changed in the kitchen in the first place!&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;You&#39;re right, ?title. I&#39;m sorry. I shouldn&#39;t have suggested to do this here. I think we can finish the outfit with an extra shawl, that way nobody will recognise you. How about I give you some time to consider it? When you&#39;re ready for it we can simply get you changed in your own bedroom instead.&lt;&lt;/morgana&gt;&gt;
You realise you want to get out of this dress as quickly as possible but the thing is still quite new to you. You step back into the larder and quietly ask her for help with the dress, almost defeatedly.
&lt;&lt;player&gt;&gt;Fine, can you please just help me out of this dress now?&lt;&lt;/player&gt;&gt;
She looks at you like someone looks at a hurt puppy and silently follows you into the larder, closing the door behind her.
&lt;&lt;decision &#39;Undress with the help of ?Morgana&#39; &#39;Morgana Kitchen 5&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="233" name="Morgana Kitchen 5" tags="" position="350,2975" size="100,100">&lt;&lt;setlocation &#39;Larder&#39;&gt;&gt;
?Morgana moves behind you and starts undoing the straps of your dress. She expertly guides you with raising the dress over your head.
&lt;&lt;if hasEquipmentTag(&#39;feminine&#39;, &#39;underwear&#39;)&gt;&gt;
    In your panicked state of undressing, you completely forgot you still have the panties on. You are reminded of exactly this fact the moment you step out of the dress and stand there, panties full in view in front of ?Morgana. She looks down and you can see a mischievous smile on her face as she helps undress you.
    &lt;&lt;morgana&gt;&gt;The panties suit you, ?title. Perhaps you should consider to keep wearing them, nobody will notice anyways.&lt;&lt;/morgana&gt;&gt;
    You feel very ashamed and are unsure how to respond to such a suggestion, before you say something she already cuts you off.
&lt;&lt;/if&gt;&gt;
&lt;&lt;if isInChastity()&gt;&gt;
    Morgana raises an eyebrow as she notices your oddly shaped bulge, barely managing to suppress a wry chuckle while commenting on it.
    &lt;&lt;morgana&gt;&gt;Oh, you&#39;re wearing a chastity cage? That&#39;s quite interesting, ?title, I wasn&#39;t aware someone had collared you... I suppose that&#39;s a good way to keep your urges in check.&lt;&lt;/morgana&gt;&gt;
    You feel very embarrassed as she points out the cage, though an odd shock of arousal runs through you at the same time. Are you really excited to be seen like this? You quickly try to cover yourself up as you feel her eyes linger on you.
&lt;&lt;/if&gt;&gt;
&lt;&lt;morgana&gt;&gt;I&#39;ll give you some privacy so you can finish getting dressed. Don&#39;t worry, the plan will still work, take some time to think it over. I will visit you in your bedroom in a few days, ?title. We can try again then.&lt;&lt;/morgana&gt;&gt;
You gives you a slight bow and then exits the small room, leaving you alone.

&lt;&lt;addcounter &#39;morgana-bedroom&#39; 3&gt;&gt;
&lt;&lt;if hasEquipmentTag(&#39;feminine&#39;, &#39;underwear&#39;)&gt;&gt;
    Even after that embarrassing situation, for some reason you are still considering to do something very taboo: nobody would know if you kept wearing the panties right? What harm is there in keeping them on?
    &lt;&lt;decision &quot;Change back to your own clothes including your underwear and leave the closet again&quot; &#39;Hallway&#39;&gt;&gt;
        &lt;&lt;equip underwear_1&gt;&gt;
        &lt;&lt;include &#39;Morgana Kitchen Feminine End&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &quot;Finish changing and leave the closet again, but keep wearing the panties&quot; &#39;Hallway&#39; femininity small&gt;&gt;
        &lt;&lt;changeoutfitslot standard underwear &#39;panties&#39;&gt;&gt;
        &lt;&lt;include &#39;Morgana Kitchen Feminine End&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &quot;Finish changing and leave the closet again&quot; &#39;Hallway&#39;&gt;&gt;
        &lt;&lt;include &#39;Morgana Kitchen Feminine End&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="234" name="Morgana Kitchen Feminine End" tags="" position="475,2975" size="100,100">&lt;&lt;completequest morgana-kitchen&gt;&gt;
&lt;&lt;startquest morgana-forest&gt;&gt;
&lt;&lt;addevent wake &#39;Wake Event Morgana Forest&#39;&gt;&gt;&lt;&lt;prerequisite not hasCounter(&#39;morgana-bedroom&#39;)&gt;&gt;&lt;&lt;/addevent&gt;&gt;
&lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;outfit standard&gt;&gt;</tw-passagedata><tw-passagedata pid="235" name="Morgana Forest 1" tags="" position="600,2975" size="100,100">You open the door and see ?Morgana standing there.
&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    She&#39;s holding the kitchen maid outfit.
&lt;&lt;else&gt;&gt;
    She&#39;s carrying a folded up manservant&#39;s outfit, you&#39;ve seen these clothes many times worn by attendants all around the castle. 
&lt;&lt;/if&gt;&gt;
She walks past you while handing you the package and enters your bedroom.
&lt;&lt;morgana&gt;&gt;Here you go, get changed, ?title. Time we head to the forest.&lt;&lt;/morgana&gt;&gt;
You look at the clothes and look back at her.
&lt;&lt;player&gt;&gt;Do we have to do this now? It&#39;s really early...&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Yes, it&#39;s much easier to sneak out at this time and gathering the mushrooms will take a while.&lt;&lt;/morgana&gt;&gt;
You could ask her to do this another time, she probably wouldn&#39;t mind, or you could get changed right now.

&lt;&lt;decision &quot;Get changed&quot; &quot;Morgana Forest 2&quot;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Tell her you can&#39;t do this right now&quot;&gt;&gt;
    &lt;&lt;addcounter &#39;morgana&#39; 2&gt;&gt;
    &lt;&lt;player&gt;&gt;I&#39;m sorry, ?Morgana. I have a really busy day today so I can&#39;t go to the forest with you. Maybe some other time?&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;That&#39;s quite alright, ?title. I will come by some other time.&lt;&lt;/morgana&gt;&gt;
    She takes the clothes and leaves your bedroom.
    &lt;&lt;decision &quot;Get back to your day&quot; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;disableif isMemory()&gt;&gt;
        You are unable to do this in the memory.
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="236" name="Morgana Forest 2" tags="" position="725,2975" size="100,100">You start undressing, she turns around and looks out the window.
&lt;&lt;morgana&gt;&gt;I&#39;ll face the other way, don&#39;t worry, ?title.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;if hasEquipmentTag(&#39;feminine&#39;, &#39;underwear&#39;)&gt;&gt;
    You take off your pyjama pants and try to change as quickly as possible to make sure she doesn&#39;t notice you&#39;re currently wearing panties. As you fiddle with the clothes, you look back in her direction and see her head turn quickly, was she looking at you??nl
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    &lt;&lt;unequip &#39;head&#39;&gt;&gt;
    &lt;&lt;equip &#39;flats&#39;&gt;&gt;
    &lt;&lt;equip &#39;kitchen_maid&#39;&gt;&gt;
    Putting on these clothes feels less strange now as you have already done it before but it still feels embarrassing.

    You finish putting on the outfit and successfully put on the bonnet this time as well. ?Morgana turns to you and looks you up and down.
    &lt;&lt;morgana&gt;&gt;That&#39;s a really good disguise, ?title. Dare I say, it suits you.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;Yeah right... I&#39;m just doing this so we can get those ingredients for you or whatever...&lt;&lt;/player&gt;&gt;
    She nods as she walks over to you. In her hands she holds a brown shawl that she starts winding over your shoulders, covering a part of your face.
    &lt;&lt;morgana&gt;&gt;There, now nobody will recognise you. Are you ready to walk past the guards?&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;I suppose so...&lt;&lt;/player&gt;&gt;
    You stand there with complete lack of confidence as ?Morgana takes you out of your bedroom, ready to escort you through the halls.
&lt;&lt;else&gt;&gt;
    &lt;&lt;equip manservant&gt;&gt;
    &lt;&lt;equip boots&gt;&gt;
    &lt;&lt;equip hat_1&gt;&gt;
    You put on the manservant&#39;s outfit. The clothes seem to fit you perfectly and are actually quite comfortable. It&#39;s quite strange to wear this garb, being a prince. You somehow immediately feel like you fit in more with the average people.?nl
    You finish putting on the outfit as ?morgana turns to you to inspect you.

    &lt;&lt;morgana&gt;&gt;That&#39;s a really good disguise, ?title. How does it feel?&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;It feels okay. I suppose I&#39;m just doing this so we can get those ingredients for you from the forest.&lt;&lt;/player&gt;&gt;
    She nods as she walks over to you. In her hands she holds a brown hat that she puts over your head, apparently part of the disguise.
    &lt;&lt;morgana&gt;&gt;There, I doubt anyone will recognise you like this. Are you ready to walk past the guards?&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;I suppose so...&lt;&lt;/player&gt;&gt;
    You stand there with some lack of confidence as ?Morgana takes you out of your bedroom, ready to escort you through the halls.
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &quot;Leave your bedroom&quot; &#39;Morgana Forest 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="237" name="Morgana Forest 3" tags="" position="850,2975" size="100,100">&lt;&lt;setlocation Gatehouse&gt;&gt;
&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    You take a deep breath and step out of your bedroom. The two of you walk together through the halls, ?Morgana walks slightly in front, clearly signalling you to be a working maid. Further down the hallway lies the main gate to the castle. You see two guards standing watch, terrifying you. ?Morgana leans close to you and whispers in your ear.
    &lt;&lt;morgana&gt;&gt;It&#39;s going to be alright.&lt;&lt;/morgana&gt;&gt;
    ?Morgana walks up to the gate as the guards greet her.
    &lt;&lt;guard&gt;&gt;Hail, &lt;&lt;name morgana &#39;Lady&#39;&gt;&gt;. Are you going out for the day?&lt;&lt;/guard&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Yes, I have business in the forest. I won&#39;t be needing an escort.&lt;&lt;/morgana&gt;&gt;
    The other guard turns to you and looks you up and down. You awkwardly nod at him in a greeting and then quickly look away.
    &lt;&lt;guard&gt;&gt;Very well. Is this a new maid? I don&#39;t remember seeing her before.&lt;&lt;/guard&gt;&gt;
    It feels strange being examined up and down, looking like this.
    &lt;&lt;morgana&gt;&gt;Quite so, I need her to carry some items I&#39;m gathering outside.&lt;&lt;/morgana&gt;&gt;
    The guard stares at you for longer than feels comfortable, is he onto you?
    &lt;&lt;guard&gt;&gt;Well, I wish her the best of luck. Good luck in the woods, my lady.&lt;&lt;/guard&gt;&gt;
    The guards move to open the gate for you.
&lt;&lt;else&gt;&gt;
    You take a step out of your bedroom. The two of you walk together through the halls, ?Morgana walks slightly in front, clearly signalling you to be her servant. Further down the hallway lies the main gate to the castle. You see two guards standing watch. ?Morgana walks up to the gate as the guards greet her.
    &lt;&lt;guard&gt;&gt;Hail, &lt;&lt;name morgana &#39;Lady&#39;&gt;&gt;. Are you going out for the day?&lt;&lt;/guard&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Yes, I have business in the forest. I won&#39;t be needing an escort.&lt;&lt;/morgana&gt;&gt;
    The other guard turns to you and looks you up and down. You awkwardly nod while trying to look away and not show them your face as much.
    &lt;&lt;guard&gt;&gt;Very well. Is this a new manservant? I don&#39;t remember seeing him before.&lt;&lt;/guard&gt;&gt;
    It feels strange being regarded in a much different way now by the same guards who normally greet you every time you go through these gates.
    &lt;&lt;morgana&gt;&gt;Quite so, I need him to carry some items I&#39;m gathering outside.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;guard&gt;&gt;Well, I wish her the best of luck. Good luck in the woods, my lady.&lt;&lt;/guard&gt;&gt;
    The guards move to open the gate for you.
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &quot;Leave the castle&quot; &#39;Morgana Forest 4&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="238" name="Morgana Forest 4" tags="" position="975,2975" size="100,100">&lt;&lt;setlocation Meadow&gt;&gt;
You step outside in the sunlight and make your way down the castle hill into the meadow path leading to the forest. You feel yourself calm down much more now that you are outside.
&lt;&lt;morgana&gt;&gt;See? That wasn&#39;t so hard, was it? They suspected nothing.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    &lt;&lt;player&gt;&gt;I&#39;m not sure... That one guard was staring at me quite long...&lt;&lt;/player&gt;&gt;
    ?Morgana looks at you with a slight smirk.
    &lt;&lt;morgana&gt;&gt;I don&#39;t believe that&#39;s because he was suspicious of you, ?title...&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;What are you getting at, ?Morgana?&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;I believe he simply liked the way you look, ?title. The guards can get a little improper with the kitchen maids and forget they aren&#39;t supposed to stare. You could see it as a compliment.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;He liked... How I looked? Like this?&lt;&lt;/player&gt;&gt;
    You are really unsure whether to take it as a compliment. You are afraid to admit that hearing this does make you feel something... You spend some time trying to suppress this feeling as you walk across the meadow, getting closer to the forest.
&lt;&lt;else&gt;&gt;
    &lt;&lt;player&gt;&gt;I suppose... It just felt weird disguising for them like that.&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;I understand, ?title. Unfortunately, they&#39;re not going to let you through otherwise.&lt;&lt;/morgana&gt;&gt;
    You must admit that it feels nice to get out of the castle on your own volition again. You have certainly missed walking through this meadow. You spend some time enjoying the outside air as you walk closer to the forest together with ?Morgana.
&lt;&lt;/if&gt;&gt;
&lt;&lt;morgana&gt;&gt;We&#39;re almost here, ?title.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;decision &quot;Continue into the forest&quot; &#39;Morgana Forest 5&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="239" name="Morgana Forest 5" tags="" position="1100,2975" size="100,100">&lt;&lt;setlocation Forest&gt;&gt;
After about an hour of walking you are now in the forest. It is strangely peaceful, birds are singing in the trees as nature is now completely surrounding you.
&lt;&lt;player&gt;&gt;So... Why are we here?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;We need ingredients. Well, not for us, but we&#39;re gathering them for a friend of mine who I will introduce you to later.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Wait... That&#39;s it? Why couldn&#39;t we do that with an escort? I thought you needed privacy for a secret ritual or something.&lt;&lt;/player&gt;&gt;
She looks at you, slightly embarrassed
&lt;&lt;morgana&gt;&gt;Yes, I&#39;m sorry, ?title. I may have misled you slightly.&lt;&lt;/morgana&gt;&gt;
She pauses for her but you simply wait for her to give an explanation.
&lt;&lt;morgana&gt;&gt;I mean I do prefer the privacy, I don&#39;t think we needed the escort but the reason why I asked you to wear the disguise is so you could experience this freedom again now...&lt;&lt;/morgana&gt;&gt;
&lt;&lt;morgana&gt;&gt;?Andreas is far too protective of you, I don&#39;t think he planned on letting you out of the castle at all anytime soon... This way, you can still get out of the castle on your own accord.&lt;&lt;/morgana&gt;&gt;
She looks at you with genuine concern in her eyes. Is that really why she made you do this? &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;Why she made you wear the dress? &lt;&lt;/if&gt;&gt;Whatever her motivations you must agree it&#39;s nice to be able to leave the castle again...
&lt;&lt;morgana&gt;&gt;For now, let&#39;s just focus on the mushrooms and if you&#39;re still mad at me later I will make it up to you somehow.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Fine... What kind of mushrooms do you need?&lt;&lt;/player&gt;&gt;
She walks with you deeper in the forest as she explains what it is that she&#39;s looking for.
&lt;&lt;morgana&gt;&gt;Yellow capped mushrooms, but not the ones with teal dots. They should smell faintly like the sea.&lt;&lt;/morgana&gt;&gt;
You&#39;re kind of mad at her for taking you all the way out here for such a menial task.
&lt;&lt;player&gt;&gt;Okay then... Perhaps we should split up to cover more grounds more quickly...&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;?Title, I&#39;m not sure if that&#39;s wise-&lt;&lt;/morgana&gt;&gt;
She suddenly interrupts herself as she sees your annoyed look. She probably realises you just want to get away from her for a little bit. 
&lt;&lt;morgana&gt;&gt;Very well, ?title. How about I cover this area and you can go check over near the waterfall, there should be quite a few over there. Let&#39;s meet again here once you have enough.&lt;&lt;/morgana&gt;&gt;
You nod to her and walk off deeper into the forest.
&lt;&lt;decision &#39;Find some mushrooms&#39; &#39;Morgana Forest Bandit 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="240" name="Morgana Forest Bandit 1" tags="" position="1225,2975" size="100,100">&lt;&lt;setlocation Waterfall&gt;&gt;
&lt;&lt;increasetime 1&gt;&gt;
You spend quite some time looking for the specific mushrooms. It&#39;s difficult to keep the mushrooms apart, you&#39;ve found a bunch of yellow mushrooms that don&#39;t smell like seawater and some that definitely do but are spotted instead... Still, you managed to find &lt;&lt;money mushrooms false 8&gt;&gt; mushrooms and put them in your basket while making your way over to the waterfall.?nl
Next to the water you find a few yellow capped mushrooms with teal dots, was this the kind ?Morgana told you to avoid? What could be so bad about them??nl
The sound of rushing water is pretty loud with how close you are to the waterfall. While you&#39;re crouching down to gather some mushrooms you don&#39;t even hear it when someone walks up behind you.?nl

&lt;&lt;changemoney mushrooms 8&gt;&gt;

&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    &lt;&lt;bandit&gt;&gt;What do we have here? A girl all on her own in the dark woods?&lt;&lt;/bandit&gt;&gt;
    You hear the gruff voice as you quickly turn around and see a man standing, looking rugged.
    &lt;&lt;bandit&gt;&gt;Are you lost, woman?&lt;&lt;/bandit&gt;&gt;
    You try to keep your voice soft and as feminine as possible.
    &lt;&lt;player&gt;&gt;Uh- No, I&#39;m just out on a stroll...&lt;&lt;/player&gt;&gt;
    You&#39;re really not sure what to do. This man definitely looks like a bandit, he&#39;s slowly walking closer to you as he speaks to you.
    &lt;&lt;bandit&gt;&gt;It&#39;s a dangerous place to walk around all alone... Allow me to help you find your way back.&lt;&lt;/bandit&gt;&gt;
    You slowly walk backwards, trying to match the speed that he&#39;s inching towards you. You realise walking backwards in the woods while attempting to sound feminine is quite difficult, especially when you suddenly find yourself tripping on a branch.
    &lt;&lt;player&gt;&gt;Oh thank you but I&#39;m quite alright, thank you- Ack!&lt;&lt;/player&gt;&gt;
    You tumble down to the ground, falling backwards. You&#39;re hoping your outburst didn&#39;t break your disguise to him. As you free your dress from the thick bushes and quickly lift yourself up again, you see the bandit looking at you with an inquisitive expression.
    &lt;&lt;bandit&gt;&gt;Wait... Are you... Are you even a woman?&lt;&lt;/bandit&gt;&gt;
    You look at him, feeling very embarrassed. You don&#39;t give him an answer but your awkwardness is clear enough to him. For some reason he&#39;s still staring at you, it almost feels like he&#39;s ogling you.
    &lt;&lt;bandit&gt;&gt;Well I suppose it doesn&#39;t really matter, you are looking pretty enough...&lt;&lt;/bandit&gt;&gt;
    You wonder why he&#39;s acting so strange when you suddenly notice something growing in his crotch area. You have never been in a situation like this and find yourself very much unsure what to do. Getting caught crossdressing made you feel immensely embarrassed. Seeing the man actually enjoying it makes it feel even weirder. Unfortunately the result of your indecisiveness is you just standing there, mindlessly staring at him...
    &lt;&lt;bandit&gt;&gt;You know, I can still help find your way out of these dark woods but first I was wondering whether you could help me with a little problem...&lt;&lt;/bandit&gt;&gt;
    Is he seriously asking you do what you think he means? Even before you can think on his question, something inside of you snaps as you feel like you need to get out of this situation.
&lt;&lt;else&gt;&gt;
    &lt;&lt;bandit&gt;&gt;What do we have here? A boy all on his own in the dark woods?&lt;&lt;/bandit&gt;&gt;
    You hear the gruff voice as you quickly turn around and see a man standing, looking rugged.
    &lt;&lt;bandit&gt;&gt;Are you lost?&lt;&lt;/bandit&gt;&gt;
    &lt;&lt;player&gt;&gt;Uh- No, I&#39;m just out on a stroll...&lt;&lt;/player&gt;&gt;
    You&#39;re really not sure what to do. This man definitely looks like a bandit, he&#39;s slowly walking closer to you as he speaks to you.
    &lt;&lt;bandit&gt;&gt;It&#39;s a dangerous place to walk around all alone... Allow me to help you find your way back.&lt;&lt;/bandit&gt;&gt;
    You slowly walk backwards, trying to match the speed that he&#39;s inching towards you. You realise walking backwards in the woods while attempting to keep an eye on him is quite difficult, especially when you suddenly find yourself tripping on a branch.
    &lt;&lt;player&gt;&gt;Oh thank you but I&#39;m quite alright, thank you- Ack!&lt;&lt;/player&gt;&gt;
    You almost tumble down to the ground as you fall backwards, the only thing stopping your from falling butt-first into the bushes is the outstretched arm of the bandit, holding you upright.
    &lt;&lt;bandit&gt;&gt;Careful there, fella, wouldn&#39;t want to see you fall down.&lt;&lt;/bandit&gt;&gt;
    You look at him, feeling very embarrassed. He lets go of your clothes and allows you to regain your footing but your awkwardness is clear enough to him. For some reason it feels like he&#39;s staring at you, it almost feels like he&#39;s ogling you.
    &lt;&lt;bandit&gt;&gt;Well- uh, if you need any help, feel free to ask. I&#39;m uh- always here to catch you if you fall!&lt;&lt;/bandit&gt;&gt;
    He&#39;s sort of stammering as you see him stare at you. You wonder why he&#39;s acting so strange, you have never been in a situation like this and find yourself very much unsure what to do. Unfortunately the result of your indecisiveness is you just standing there, mindlessly staring at him...
    &lt;&lt;bandit&gt;&gt;Uhm- you know, I can still help find your way out of these dark woods but first I was wondering whether you could help me with a little problem...&lt;&lt;/bandit&gt;&gt;
    Is he seriously asking you do what you think he means? You see him not-so-subtly put attention on his crotch area as he suddenly starts scratching. Does he currently have a boner? Even before you can think on his question, something inside of you snaps as you feel like you need to get out of this situation.
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &#39;Lash out&#39; &#39;Morgana Forest Bandit 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="241" name="Morgana Forest Bandit 2" tags="" position="100,3100" size="100,100">You snap out of your embarrassment and look at him with an angry face. 
&lt;&lt;player&gt;&gt;I&#39;m not doing anything like that, leave me alone!&lt;&lt;/player&gt;&gt;
The bandit, somehow actually startled, takes a few steps back to give you space. He&#39;s holding both hands halfway in the air, trying to deescalate the situation.
&lt;&lt;bandit&gt;&gt;Whoa there, I wasn&#39;t going to force you to do anything! Who do you think I am?&lt;&lt;/bandit&gt;&gt;
You look at him, quite surprised he is responding so well.
&lt;&lt;player&gt;&gt;Well, you&#39;re a bandit, aren&#39;t you? I don&#39;t know what kind of things you get up to in these woods...&lt;&lt;/player&gt;&gt;
He looks at you, slightly offended and gives a retort back.
&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    &lt;&lt;bandit&gt;&gt;Hey you&#39;re the one who&#39;s crossdressing out in the woods on your own! I just wanted to see if you were down for some fun...&lt;&lt;/bandit&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;bandit&gt;&gt;Hey you&#39;re the one who&#39;s wandering the woods on your own. I just wanted to see if you were down for some fun...&lt;&lt;/bandit&gt;&gt;
&lt;&lt;/if&gt;&gt;
You must say he felt much more intimidating before, which obviously is a red flag when he&#39;s casually looking for things like that in the woods but then again, he didn&#39;t actually put his hands on you.
&lt;&lt;player&gt;&gt;Oh... Well... I&#39;m not.&lt;&lt;/player&gt;&gt;
&lt;&lt;bandit&gt;&gt;Okay, that&#39;s fine. I&#39;m going to leave then. Try not to get lost.&lt;&lt;/bandit&gt;&gt;
You stutter a response as he turns to walk away.
&lt;&lt;player&gt;&gt;Right... Uhm... Thanks. Goodbye then.&lt;&lt;/player&gt;&gt;
The bandit casually strolls off, back from where he came. While walking away he suddenly turns his head towards you again, reluctantly shouting one last thing to you.
&lt;&lt;bandit&gt;&gt;If you ever change your mind... Come find me in my camp south of here...&lt;&lt;/bandit&gt;&gt;
Before you can respond he&#39;s already to far off to listen to you. That&#39;s probably one of the more awkward interactions you&#39;ve had in a while. You decide it&#39;s probably best to just head back to ?Morgana with the mushrooms you have found.
&lt;&lt;decision &#39;Make your way back to ?Morgana&#39; &#39;Morgana Forest 6&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="242" name="Morgana Forest 6" tags="" position="225,3100" size="100,100">&lt;&lt;setlocation &#39;Forest&#39;&gt;&gt;
You make your way back to the place where you split up from ?Morgana and after a little while you spot her, gathering mushrooms. She seems to have way more of the things in her basket than you managed to get. To be fair, you didn&#39;t expect to be jumped by a bandit out there...

&lt;&lt;morgana&gt;&gt;Ah, ?title. You brought some mushroom, very good. How did it go?&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Uh- Yeah- I mean, yes, it went fine. Do you think we have enough?&lt;&lt;/player&gt;&gt;
She looks at you a little suspiciously but you decide not to share anything about the bandit. She inspects the baskets of mushrooms and looks at you.
&lt;&lt;morgana&gt;&gt;Yes, this should be enough. Follow me, ?title.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Where are we going?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;I want you to meet a friend of mine, they have a hut deeper in the woods.&lt;&lt;/morgana&gt;&gt;
Without asking to many more questions, you follow her deeper in the forest.

&lt;&lt;decision &#39;Follow ?Morgana&#39; &#39;Morgana Forest 7&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="243" name="Morgana Forest 7" tags="" position="350,3100" size="100,100">&lt;&lt;setlocation &#39;Druid Hut&#39;&gt;&gt;
After walking for a short while you make it to an opening in the forest, it&#39;s filled with patches of flowers. Red roses, blue lilies and daffodils are lined in flower gardens bordering the woods. In the middle of this flowery glade stands a lone hut. Once you get closer you realise the outside of the hut is lined with small decorations like dried flowers and wooden totems.
&lt;&lt;player&gt;&gt;That looks cozy, who&#39;s this friend of yours that lives here?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Their name is ?Hyssop. They&#39;re the local forest druid, I used to study magic together with them. Even though ?Hyssop had a real gift for it, they never shared my ambition and instead they&#39;re simply content living in the woods and working on their hobbies.&lt;&lt;/morgana&gt;&gt;
It&#39;s interesting hearing ?Morgana talk about an old friend like this, you kind of assumed she always just wanted to be a councillor and serve the kingdom, you never wondered about her life before that.
&lt;&lt;player&gt;&gt;So why do you want me to meet this druid, is it another spell that you need their help with?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Well, not at all, actually. Funnily enough it&#39;s one of their hobbies that I think could be useful to you. Let me take you inside, you&#39;ll see.&lt;&lt;/morgana&gt;&gt;
As you&#39;re walking towards the door of the cabin you get a closer look at all the cute decorations out here. It looks like ?Hyssop has chosen a few of their favorite flowers, ones you can&#39;t even recognise, and put them in a small flowerbed out here. You inspect the windowsill and try to peek inside but can&#39;t see much at all. Before you even get close to the door, it suddenly flies open, sending you jumping.

&lt;&lt;decision &#39;Meet ?Hyssop&#39; &#39;Morgana Forest Hyssop 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="244" name="Morgana Forest Hyssop 1" tags="" position="475,3100" size="100,100">You startle backwards as the door is blasted open with an immense gust of wind. The wooden door bangs loudly against the outside of the hut. Inside the open doorframe you see a person standing there, holding a hand forwards with magical energy evaporating from it, probably the cause of the outburst. The druid looks at both of you and very excitedly starts running towards both of you.
&lt;&lt;hyssop&gt;&gt;?Morgana! You&#39;re back!&lt;&lt;/hyssop&gt;&gt;
?Hyssop runs towards the overwhelmed sorceress and immediately gives her a big hug. ?Morgana seems a bit flustered but she looks like she&#39;s used to this from ?Hyssop. After the warm embrace ?Hyssop takes a moment to look her over and then proceeds to look at you.
&lt;&lt;hyssop&gt;&gt;Sorry about the startle, I was just excited when I felt your energy, ?Morgana. Who&#39;s the friend you brought?&lt;&lt;/hyssop&gt;&gt;
&lt;&lt;morgana&gt;&gt;It&#39;s good to see you again, friend. I&#39;m sorry for not visiting earlier, it&#39;s been too long. Allow me to introduce you to &lt;&lt;name &#39;player&#39; &#39;Prince&#39;&gt;&gt;. ?Title, this is my friend ?Hyssop.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    You immediately feel very awkward as ?Morgana just outed you as the prince while currently crossdressing as a kitchen maid in the woods. You actually notice ?Hyssop staring and as you&#39;re waiting for them to make a comment about that, it looks like they instead simply move in to also give you a nice hug.
    &lt;&lt;hyssop&gt;&gt;It&#39;s a pleasure to meet you, any friend of ?Morgana is a friend of mine. I really like your outfit, ?player!&lt;&lt;/hyssop&gt;&gt;
    You blush slightly at her comment, the embarrassment slowly seeping away. 
&lt;&lt;else&gt;&gt;
    ?Hyssop immediately moves to give you a hug as well and you awkwardly accept it.
    &lt;&lt;hyssop&gt;&gt;It&#39;s a pleasure to meet you, ?player. Any friend of ?Morgana is a friend of mine!&lt;&lt;/hyssop&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;hyssop&gt;&gt;Oh! I totally forgot to welcome you inside! Please, follow me and I&#39;ll make us some tea!&lt;&lt;/hyssop&gt;&gt;

&lt;&lt;decision &#39;Go inside the cabin&#39; &#39;Morgana Forest Hyssop 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="245" name="Morgana Forest Hyssop 2" tags="" position="600,3100" size="100,100">You move inside the hut and are amazed at how much is able to fit in such a small house. It feels like the polar opposite to the palace that you are used to. A small room with many things instead of a huge space with few decorations. The walls are lined with knick-knacks and colorful decorations. From embroidery to beautiful flowers. Once you enter the main living space, you notice the room is filled with half-painted canvasses and, more predominantly, mannequins that hold unfinished garbs that ?Hyssop seems to be sewing. Even though there is quite a lot going on, the house doesn&#39;t feel chaotic per se. It seems like every little thing has their own space and lives in their own corner, a well managed accumulation of creativity.
&lt;&lt;hyssop&gt;&gt;Have a seat, I&#39;ll put some water on! Now, tell me what I can help you with.&lt;&lt;/hyssop&gt;&gt;
&lt;&lt;morgana&gt;&gt;Thank you, ?Hyssop. Well to get right to it...&lt;&lt;/morgana&gt;&gt;
?Morgana takes both baskets of mushrooms and puts them on the table.
&lt;&lt;hyssop&gt;&gt;That&#39;s... For me? ?Morgana! You shouldn&#39;t have!&lt;&lt;/hyssop&gt;&gt;
?Hyssop moves to instantly give ?Morgana another loving hug before inspecting the mushrooms.
&lt;&lt;morgana&gt;&gt;Well, I kind of felt bad for not visiting in a while, I know you always need more mushrooms for your decorations and potions. And I know these are your favorite kind so we got quite a few of them.&lt;&lt;/morgana&gt;&gt;
?Hyssop smiles at you as well.
&lt;&lt;hyssop&gt;&gt;It almost sounds like you&#39;re trying to bribe me...&lt;&lt;/hyssop&gt;&gt;
&lt;&lt;morgana&gt;&gt;Well... Perhaps we are. You see, I was wondering if you could be of assistance to the ?Prince.&lt;&lt;/morgana&gt;&gt;
?Morgana turns to you while accepting a cup of tea from ?Hyssop.
&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    &lt;&lt;morgana&gt;&gt;You see, ?title. ?Hyssop is an amazing tailor, probably the best I know. I realise the royal tailors normally make your outfits for you but seeing as you are now trying other kinds of clothes as well, perhaps you could go to ?Hyssop if you would want to look at some options that are too taboo to ask the royal tailors about.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;You mean... More girly clothes?&lt;&lt;/player&gt;&gt;
    ?Morgana turns to ?Hyssop, trying to explain your reluctance.
    &lt;&lt;morgana&gt;&gt;The ?Prince is having some issues getting used to this expansion of his wardrobe. He&#39;s very new to crossdressing like this and I was wondering if you could perhaps help with that, ?Hyssop?&lt;&lt;/morgana&gt;&gt;
    ?Hyssop looks a little confused, as if they only now realise that you are crossdressing. Almost as if the taboo side of what you&#39;re doing finally clicks now that it&#39;s directly mentioned. For some reason, this realization seems to be funny to ?Hyssop.
    &lt;&lt;hyssop&gt;&gt;Hahaha! What&#39;s with you people and all those arbitrary expectations? Just wear dresses if you want to, silly!&lt;&lt;/hyssop&gt;&gt;
    Wow, you&#39;ve never heard anyone with that particular world view. Their reaction makes you think ?Hyssop isn&#39;t concerned with gender norms at all... As you stare at them slightly flabbergasted, they seem to change their attitude slightly.
    &lt;&lt;hyssop&gt;&gt;But, if fitting in better while &quot;crossdressing&quot; is what you need help with, I&#39;d love to help, of course! Wait, I think I have something that could fit you!&lt;&lt;/hyssop&gt;&gt;
    You look at them reluctantly but they have already darted to another room to grab something for you. ?Morgana looks at you with a friendly smile.
    &lt;&lt;morgana&gt;&gt;It&#39;s only if you would want to, ?title. I just wanted you to meet ?Hyssop so you could consider going to them in the future.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;I suppose it&#39;s good to know of the druid&#39;s skills and they do seem very nice...&lt;&lt;/player&gt;&gt;
    After a few movements, ?Hyssop returns holding a beautiful long wig in their hands. The brown wig has long strait hair with two thick braids running from the front to the back.
    &lt;&lt;hyssop&gt;&gt;This&#39;ll probably help you fit in better, much better than covering your face with that shawl! I think it should fit you well!&lt;&lt;/hyssop&gt;&gt;
    You look at them a bit awkwardly but realise it&#39;s difficult to decline them now that they&#39;ve given you a gift.
    &lt;&lt;player&gt;&gt;Ah thanks, ?Hyssop. I suppose I&#39;ll try it on.&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;I didn&#39;t know you also picked up wig-making as a hobby, ?Hyssop. That looks like some really fine work!&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;decision &#39;Try on the wig&#39; &#39;Morgana Forest Hyssop 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;morgana&gt;&gt;You see, ?title. ?Hyssop is an amazing tailor, probably the best I know. I realise the royal tailors normally make your outfits for you but seeing as you are now trying other kinds of clothes as well, perhaps you could go to ?Hyssop if you would want to look at some options that work better as disguises and have a less royal feel to them.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;hyssop&gt;&gt;Oh definitely! I would gladly make some clothes for you, ?player! You can come visit me anytime.&lt;&lt;/hyssop&gt;&gt;
    You look to ?Morgana and then to ?Hyssop. You must say that having a new tailor that could help you make more disguises does sound enticing.
    &lt;&lt;player&gt;&gt;Thank you, ?Hyssop. I would love to come by sometime, thank you for the invitation.&lt;&lt;/player&gt;&gt;
    ?Morgana looks at you with a warm smile. You must admit ?Morgana&#39;s planning works out nicely for you, getting out of the castle like this was a good idea in the end. Though something has you feeling like it&#39;s probably time to head back.
    &lt;&lt;player&gt;&gt;We&#39;ve probably been away from the castle for some time now though, perhaps we could be getting back.&lt;&lt;/player&gt;&gt;
    &lt;&lt;hyssop&gt;&gt;Ah of course! Thank you so much for stopping by, if you ever need any help with your clothes, feel free to stop by!&lt;&lt;/hyssop&gt;&gt;
    &lt;&lt;morgana&gt;&gt;I can&#39;t thank you enough, ?Hyssop. I promise I&#39;ll come by soon again, the council work just has be preoccupied quite a lot.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;hyssop&gt;&gt;Don&#39;t worry about it, I&#39;ll be here!&lt;&lt;/hyssop&gt;&gt;
    You accept another warm hug from ?Hyssop before you both leave the cabin.
    &lt;&lt;decision &#39;Head back to the castle&#39; &#39;Morgana Forest 8&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="246" name="Morgana Forest Hyssop 3" tags="" position="725,3100" size="100,100">&lt;&lt;equip &#39;wig_1&#39;&gt;&gt;
You let ?Hyssop lower the wig over your head and align it correctly.
&lt;&lt;morgana&gt;&gt;You look really good, ?title.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;hyssop&gt;&gt;Yes, it goes perfect with that outfit! If you also want another outfit I can show you some things I have that would fit you well. I think I have a pink skirt somewhere that really goes well with your body, now where did I put that...&lt;&lt;/hyssop&gt;&gt;
Before ?Hyssop runs off again, ?Morgana puts a hand on their arm to stop them.
&lt;&lt;morgana&gt;&gt;Thank you, ?Hyssop. But that should be enough for now, we don&#39;t want to overwhelm the ?Prince just yet.&lt;&lt;/morgana&gt;&gt;
You look at her with a thankful expression as you are starting to definitely feel a bit overwhelmed.
&lt;&lt;player&gt;&gt;Yes, thank you for the wig, ?Hyssop. Perhaps we should be heading back to the castle though.&lt;&lt;/player&gt;&gt;
&lt;&lt;hyssop&gt;&gt;Ah of course! Thank you so much for stopping by, if you ever need any help with your clothes, feel free to stop by!&lt;&lt;/hyssop&gt;&gt;
&lt;&lt;morgana&gt;&gt;I can&#39;t thank you enough, ?Hyssop. I promise I&#39;ll come by soon again, the council work just has me preoccupied quite a lot.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;hyssop&gt;&gt;Don&#39;t worry about it, I&#39;ll be here!&lt;&lt;/hyssop&gt;&gt;
You accept another warm hug from ?Hyssop before you both leave the cabin.
&lt;&lt;decision &#39;Head back to the castle&#39; &#39;Morgana Forest 8&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="247" name="Morgana Forest 8" tags="" position="850,3100" size="100,100">&lt;&lt;setlocation &#39;Meadow&#39;&gt;&gt;
You make your way back through the woods and head towards the castle.
&lt;&lt;player&gt;&gt;Thanks for introducing me to your friend, ?Morgana. It was really nice.&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Of course, I hope you consider the offer to go out here again, I hope this has inspired you to live more freely, you should go outside whenever you feel like it, even though it&#39;s with a disguise.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Thanks, ?Morgana. I will take it into consideration. I&#39;m definitely done for now... I miss my old clothes.&lt;&lt;/player&gt;&gt;

It takes some time to head back to the castle and enter through the gatehouse again. The guards are none the wiser that you were gone this whole time. You head back to your bedroom and there you say farewell to ?Morgana as you want to change back to your old clothes.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;span class=&quot;notice good&quot;&gt;You have now unlocked the forest area that you can visit while being disguised.&lt;/span&gt;

&lt;&lt;decision &#39;Change clothes and go on with your day&#39; &#39;Bedroom&#39;&gt;&gt;
    &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
        &lt;&lt;unlockequipment &#39;flats&#39;&gt;&gt;
        &lt;&lt;unlockequipment &#39;kitchen_maid&#39;&gt;&gt;
        &lt;&lt;unlockequipment &#39;wig_1&#39;&gt;&gt;
        &lt;&lt;changeoutfit disguise &#39;wig_1&#39; &#39;kitchen_maid&#39; &#39;flats&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;unlockequipment &#39;manservant&#39;&gt;&gt;
        &lt;&lt;unlockequipment &#39;hat_1&#39;&gt;&gt;
        &lt;&lt;changeoutfit disguise &#39;hat_1&#39; &#39;manservant&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
    &lt;&lt;completequest morgana-forest&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Event Sybille Note&#39;&gt;&gt;&lt;&lt;delay 7&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;addevent wake &#39;Rosa Knocks&#39;&gt;&gt;&lt;&lt;delay 3&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Event Orson Poem&#39;&gt;&gt;&lt;&lt;delay 2&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;outfit standard&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="248" name="Morgana Workshop Visit" tags="" position="975,3100" size="100,100">&lt;&lt;if hasCompletedQuest(&#39;morgana-potion-store&#39;)&gt;&gt;
    &lt;&lt;money essence true&gt;&gt;
&lt;&lt;/if&gt;&gt;
You walk into the witches&#39; workshop and are greeted by ?Morgana, sitting at her alchemy table, surrounded by vials, books, and strange ingredients.
&lt;&lt;if !hasCompletedQuest(&#39;morgana-potion-store&#39;)&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Hello, ?title. It&#39;s actually great timing that you&#39;re visiting...&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;morgana&gt;&gt;You see, I was working on some more experiments with our specific form of alchemy... I was wondering... Would you be willing to provide more of your essence for me to use?&lt;&lt;/morgana&gt;&gt;
    Is she asking to use your ?essence again?
    &lt;&lt;decision &#39;Accept&#39; depravity small&gt;&gt;
        &lt;&lt;goto &#39;Morgana Workshop Extraction&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Decline&#39;&gt;&gt;
        &lt;&lt;player&gt;&gt;Sorry, ?Morgana. I have no interest in that right now.&lt;&lt;/player&gt;&gt;
        &lt;&lt;morgana&gt;&gt;As you wish, ?title.&lt;&lt;/morgana&gt;&gt;
        &lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Ah, welcome, ?title. Are you here to look at the potions?&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;if !hasCounter(&#39;morgana-extraction&#39;)&gt;&gt;
        She stands up and turns away for you to grab something from a shelf while she continues talking, suddenly shifting to a slightly more conspicuous tone of voice.
        &lt;&lt;morgana&gt;&gt;...Or are you here to extract more ?essence for me?&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;/if&gt;&gt;

    
    &lt;&lt;decision &#39;Browse Potions&#39;&gt;&gt;
        &lt;&lt;if hasCounter(&#39;morgana-shop&#39;)&gt;&gt;
            As you&#39;re walking up to look at her potions, ?Morgana suddenly interrupts you.
            &lt;&lt;morgana&gt;&gt;I&#39;m very sorry, ?title, but I cannot give you another potion so soon after you drank another one. I&#39;m happy with your eagerness but we must give your body some time to rest.&lt;&lt;/morgana&gt;&gt;
            &lt;&lt;player&gt;&gt;Ah, that does make sense... I&#39;ll be back some other time then.&lt;&lt;/player&gt;&gt;
            &lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;goto &#39;Morgana Store&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;decisionicon essence&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;if !hasCounter(&#39;morgana-extraction&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Extract essence&#39; depravity small&gt;&gt;
            &lt;&lt;goto &#39;Morgana Workshop Extraction&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;decision &#39;Take your leave&#39;&gt;&gt;
        &lt;&lt;player&gt;&gt;Sorry, ?Morgana, I was simply stopping by.&lt;&lt;/player&gt;&gt;
        &lt;&lt;morgana&gt;&gt;Of course, ?title.&lt;&lt;/morgana&gt;&gt;
        &lt;&lt;decision &#39;Leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="249" name="Morgana Workshop Extraction" tags="spicy" position="1100,3100" size="100,100">&lt;&lt;player&gt;&gt;Uhm, yes, of course we can extract more essence, ?Morgana.&lt;&lt;/player&gt;&gt;
She immediately reaches towards your crotch, aiming to free your ?dick. Her extreme directness has you take a step back.
&lt;&lt;player&gt;&gt;Perhaps you would like to undress for me again first?&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Ah, of course. How could I forget.&lt;&lt;/morgana&gt;&gt;
She efficiently gets rid of her dress for you.
&lt;&lt;img &quot;morgana/bedroom_visit_naked_{theme}.jpg&quot;&gt;&gt;
The sight of this has you racing and you immediately move to free your ?dick. She moves next to you, ready to help you out.

&lt;&lt;if isInChastity()&gt;&gt;
    You lower your pants, revealing the &lt;&lt;= $chastity.color&gt;&gt; chastity cage around your ?dick. 
    &lt;&lt;if !hasTag(&#39;morgana-chastity-knows&#39;)&gt;&gt;
        &lt;&lt;addtag &#39;morgana-chastity-knows&#39;&gt;&gt;
        ?Morgana immediately examines it with great fascination.
        &lt;&lt;morgana&gt;&gt;Interesting... You&#39;re wearing a chastity cage? How fascinatingly unexpected, ?title.&lt;&lt;/morgana&gt;&gt;
        You blush as you reveal one of your big secrets to ?Morgana.
        &lt;&lt;player&gt;&gt;Yes, uhm, I suppose it&#39;s a bit of a problem for what you had in mind...&lt;&lt;/player&gt;&gt;
        &lt;&lt;morgana&gt;&gt;Oh my, does that mean you cannot simply unlock it?&lt;&lt;/morgana&gt;&gt;
        You awkwardly look away as you decide to just be honest with her.
        &lt;&lt;player&gt;&gt;Uhm, no... ?Kathryn has the only key.&lt;&lt;/player&gt;&gt;
        She raises her eyebrows in surprise.
        &lt;&lt;morgana&gt;&gt;?LadyKathryn is your keyholder? This is all very interesting...&lt;&lt;/morgana&gt;&gt;
        You see her consider for a moment, like she has a million different questions she wants to ask but ultimately refrains from it.
        &lt;&lt;morgana&gt;&gt;I suppose I could use some magic to open it for us. Allow me, ?title...&lt;&lt;/morgana&gt;&gt;
        Using magic to open the chastity cage? Why hadn&#39;t you thought of that before? You could just have ?Morgana unlock you and ?Kathryn doesn&#39;t even have to find out!?nl
        Your excitement grows as ?Morgana puts her hand over your caged ?penis. A purple light glows softly and suddenly you feel a sharp shock reverberate through your genitals.
        &lt;&lt;player&gt;&gt;Ow! What happened?!&lt;&lt;/player&gt;&gt;
        You look down to see your ?penis, still stuck in the chastity cage and ?Morgana looking a bit disappointed.
        &lt;&lt;morgana&gt;&gt;Hmm... This feels like ?Beau&#39;s handiwork... She&#39;s quite adapt with her protection magic... I won&#39;t be able to break the spell, sorry, ?title.&lt;&lt;/morgana&gt;&gt;
        Well, it would&#39;ve been too good to be true anyways you suppose...
        &lt;&lt;player&gt;&gt;It&#39;s alright... What happens now then?&lt;&lt;/player&gt;&gt;
        &lt;&lt;morgana&gt;&gt;Fear not, we can still perform the extraction using an alternative method.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;morgana&gt;&gt;Ah, since ?LadyKathryn keeps you locked up we&#39;ll have to use the alternative method again.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    She has you sit down in her chair, gesturing for you to lay back. Wordlessly, she guides your legs up on the arm rests, giving her a clear view of your caged ?dick.?nl
    She grabs a vial and slathers some clear liquid on her index finger. She then looks up at you with a soft smile.
    &lt;&lt;morgana&gt;&gt;Let me take care of this for you, ?title.&lt;&lt;/morgana&gt;&gt;
    You moan softly as she slowly inserts her finger into your rectum, sending a wave of pleasure through your body. She starts fingering you with passion as you get overwhelmed with the intense feelings.?nl

    Whatever she put on her finger, it&#39;s making you feel this pleasure much more intensely. After a few insertions she reaches so deep, purposefully aiming for your prostate, making you moan loudly.
    &lt;&lt;morgana&gt;&gt;I&#39;m here to serve you, ?title... Let me make you feel good...&lt;&lt;/morgana&gt;&gt;

    Bizarre as it is, this whole situation has you extremely aroused and you feel yourself coming closer and closer.
    &lt;&lt;player&gt;&gt;Ah, ?Morgana... I- I&#39;m close...&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Yes... Let it all out...&lt;&lt;/morgana&gt;&gt;
    She fingers you so efficiently you are about to burst. She quickly takes out the vial and holds it to your caged ?dick.
    &lt;&lt;if settings.vids&gt;&gt;
        &lt;&lt;if settings.sph&gt;&gt;
            &lt;&lt;video &#39;player/cum_in_vial_sph.webm&#39;&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;video &#39;player/cum_in_vial.webm&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;

    As your orgasm hits, your ?dick dribbles white liquid slowly out of your cage, straight into the vial. 
&lt;&lt;else&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Let me take care of this, ?title.&lt;&lt;/morgana&gt;&gt;
    You moan loudly as she takes your ?dick in hand and starts stroking it.
    &lt;&lt;if settings.vids&gt;&gt;
        &lt;&lt;if settings.sph&gt;&gt;
            &lt;&lt;video &#39;morgana/morgana_handjob_sph.webm&#39;&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;video &#39;morgana/morgana_handjob.webm&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    She whispers in your ear while she keeps jerking you faster and faster.
    &lt;&lt;morgana&gt;&gt;I&#39;m here to serve you, ?title... Let me make you feel good...&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;if settings.sph&gt;&gt;
        &lt;&lt;morgana&gt;&gt;Don&#39;t worry about your lack of size... You don&#39;t need a big dick to feel good...&lt;&lt;/morgana&gt;&gt;
        Her unfortunate attempt to try and make you feel less insecure does actually make you feel more turned on... Why does the humiliation always work on you... Was that actually her intention??nl
    &lt;&lt;/if&gt;&gt;
    Bizarre as it is, this whole situation has you extremely aroused and you feel yourself coming closer and closer.
    &lt;&lt;player&gt;&gt;Ah, ?Morgana... I- I&#39;m close...&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Yes... Let it all out...&lt;&lt;/morgana&gt;&gt;
    She jerks you off so efficiently you are about to burst. She quickly takes out the vial and holds it to your ?dick.
    &lt;&lt;if settings.vids&gt;&gt;
        &lt;&lt;if settings.sph&gt;&gt;
            &lt;&lt;video &#39;player/cum_in_vial_sph.webm&#39;&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;video &#39;player/cum_in_vial.webm&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    Your ?dick erupts in a white fountain of cum, straight into the vial. 
&lt;&lt;/if&gt;&gt;
?Morgana immediately holds it up after you are finished and starts inspecting it.
&lt;&lt;morgana&gt;&gt;Yes, this is perfect! Thank you, ?title.&lt;&lt;/morgana&gt;&gt;

&lt;&lt;if hasCompletedQuest(&#39;morgana-potion-store&#39;)&gt;&gt;
    &lt;&lt;addcounter &#39;morgana-extraction&#39; 1&gt;&gt;
    She immediately start analyzing the vial while you catch your breath. With that extraction done you have successfully gathered &lt;&lt;money essence false 1&gt;&gt; vial of ?essence.
    &lt;&lt;changemoney essence 1&gt;&gt;
    &lt;&lt;decision &#39;Take your leave&#39; &#39;Workshop&#39;&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;addcounter &#39;morgana-workshop&#39; 1&gt;&gt;
    You suppose that&#39;s it then, you fix your clothes and get ready to leave her to her work. She looks to already be completely focused on that.
    &lt;&lt;player&gt;&gt;Uhm- you&#39;re welcome, ?Morgana. Good luck with the potion.&lt;&lt;/player&gt;&gt;
    &lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="250" name="Morgana Tells About Potions" tags="" position="1225,3100" size="100,100">&lt;&lt;startquest &#39;morgana-potion-store&#39;&gt;&gt;
&lt;&lt;changeschedule morgana &#39;noon&#39; &#39;Workshop&#39;&gt;&gt;
&lt;&lt;changeschedule morgana &#39;evening&#39; &#39;Workshop&#39;&gt;&gt;
&lt;&lt;changemoney essence 3&gt;&gt;

Just as you are about to leave your room for the day, you hear a knock at the door. You open it to see ?Morgana, who smiles at you and walks inside your bedroom.

&lt;&lt;morgana&gt;&gt;Good morning, ?title. I have come to tell you some exciting news.&lt;&lt;/morgana&gt;&gt;

&lt;&lt;player&gt;&gt;What news?&lt;&lt;/player&gt;&gt;

&lt;&lt;morgana&gt;&gt;I have been experimenting, ?title, and the possibilities for creating novel potions with your essence are very promising. I have already concocted several new recipes.&lt;&lt;/morgana&gt;&gt;

You look at her closely, feeling slightly strange that she has been playing around with your ?essence in such a way.

&lt;&lt;player&gt;&gt;Novel potions? You mean there are other effects beyond the potion you already made?&lt;&lt;/player&gt;&gt;

?Morgana smiles knowingly. 

&lt;&lt;morgana&gt;&gt;Indeed, ?title. If you come to my workshop I will show you what I have come up with. All I require now to finish a potion is a small supply of your essence.&lt;&lt;/morgana&gt;&gt;

&lt;&lt;player&gt;&gt;R-right, of course. I&#39;ll come take a look soon, then.&lt;&lt;/player&gt;&gt;

She nods and leaves your room, leaving you to ponder what these new potions might do. 

&lt;&lt;decision &#39;Get up&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="251" name="Morgana Workshop New Potion" tags="" position="100,3225" size="100,100">&lt;&lt;completequest &#39;morgana-potion-store&#39;&gt;&gt;

When you enter the workshop, you see ?Morgana hard at work over a bubbling cauldron, an intense look on her face. She gives it a careful stir and straightens to look at you.

&lt;&lt;morgana&gt;&gt;Ah, ?title, I assume you have come to see the potions I mentioned.&lt;&lt;/morgana&gt;&gt;

&lt;&lt;player&gt;&gt;Yes, I must admit I&#39;m quite curious. What do the potions do?&lt;&lt;/player&gt;&gt;

?Morgana points to a small collection of potion bottles.

&lt;&lt;morgana&gt;&gt;Here they are. These use the same kind of magic as my previous potion, but they are more targeted. They affect only specific parts of your being.&lt;&lt;/morgana&gt;&gt;

Does ?Morgana mean that these potions will transform specific parts of your body? This is certainly an intruiging idea.

&lt;&lt;morgana&gt;&gt;Does this possibility appeal to you, ?title? I have enough of your essence on hand to finish a potion right away.&lt;&lt;/morgana&gt;&gt;

&lt;&lt;decision &#39;Inspect the potions&#39; &#39;Morgana Store&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="252" name="Orson" tags="" position="225,3225" size="100,100">&lt;&lt;if $location is &#39;Bathroom&#39;&gt;&gt;
    &lt;&lt;decision &#39;?Orson is preparing a bath for you&#39; &#39;Orson Bathroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $location is &#39;Bedroom&#39;&gt;&gt;
    &lt;&lt;decision &#39;?Orson is here, tidying your bedchambers&#39; &#39;Orson Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $location is &#39;Library&#39;&gt;&gt;
    &lt;&lt;if getTime() === &#39;evening&#39;&gt;&gt;
        &lt;&lt;if hasQuest(&#39;orson-date-1&#39;)&gt;&gt;
            &lt;&lt;decision &#39;Find ?Orson to start your date&#39; &#39;Orson Date 1 Start&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;elseif hasQuest(&#39;orson-gift-quill&#39;)&gt;&gt;
            &lt;&lt;decision &#39;Present your gift to ?Orson&#39; &#39;Orson Gift Quill&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;elseif hasQuest(&#39;orson-date-2&#39;)&gt;&gt;
            &lt;&lt;decision &#39;Find ?Orson to start your date&#39; &#39;Orson Date 2 Start&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="253" name="Orson Acknowledgement" tags="" position="350,3225" size="100,100">&lt;&lt;acknowledgement Orson&gt;&gt;
    &lt;&lt;mention assassination&gt;&gt;
    &lt;&lt;mention status&gt;&gt;
        &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
            ?Orson looks you up and down with a suspicious look.
            &lt;&lt;orson&gt;&gt;I don&#39;t know what it is, but you look... different today, ?title. Are you feeling well?&lt;&lt;/orson&gt;&gt;
            &lt;&lt;player&gt;&gt;Yes, I&#39;m fine, ?Orson. I just decided to wear my hair differently today.&lt;&lt;/player&gt;&gt; 
            His slightly suspicious look turns into a warm smile.
            &lt;&lt;orson&gt;&gt;Well, I think you look perfectly splendid today, ?title.&lt;&lt;/orson&gt;&gt;
        &lt;&lt;elseif face() is &#39;andro&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;fem&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;man&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
&lt;&lt;/acknowledgement&gt;&gt;</tw-passagedata><tw-passagedata pid="254" name="Orson Bathroom" tags="" position="475,3225" size="100,100">&lt;&lt;addcounter &#39;orson-bathroom&#39; 1&gt;&gt;
&lt;&lt;if getDay() !== &#39;wednesday&#39;&gt;&gt;
    You enter the bathroom to find ?Orson here, preparing a bath for you.
    &lt;&lt;orson&gt;&gt;Good morning, ?title. I have prepared a bath for you, the water is nice and warm.&lt;&lt;/orson&gt;&gt;
    He stands next to you, holding a bath towel.
&lt;&lt;else&gt;&gt;
    ?Orson is already busy making your bath.
    In your morning-zombie state all you can muster is to slowly walk over to the tub. Hopefully the warm water can bring some life in your still half-sleeping state. Council meetings are such a drag.
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Let him help you undress.&#39;&gt;&gt;
&lt;&lt;orson&gt;&gt;Allow me.&lt;&lt;/orson&gt;&gt; 
    He says as he motions for you to lift your arms. He takes off your top and unknots the string that keeps your shorts up. You lower your shorts, now naked as the day you were born.?nl
    &lt;&lt;if isInChastity()&gt;&gt;
        &lt;&lt;if !hasTag(&#39;orson-chastity-knows&#39;)&gt;&gt;
            &lt;&lt;addtag &#39;orson-chastity-knows&#39;&gt;&gt;
            As ?Orson glances over your crotch you spot a genuine look of surprise on his face that dissipates after a few long seconds.
            &lt;&lt;orson&gt;&gt;Ah, I&#39;m sorry ?title, if I may ask: what is that thing covering your ?penis?&lt;&lt;/orson&gt;&gt;
            &lt;&lt;player&gt;&gt;Oh, uhm- It&#39;s a chastity cage.&lt;&lt;/player&gt;&gt;
            Feeling puzzled, ?Orson understandably continues his questioning.
            &lt;&lt;orson&gt;&gt;Oh, and so it prevents you from using your ?dick? Why did you put that on?&lt;&lt;/orson&gt;&gt;
            You look away awkwardly but for some reason you decide that you can confide anything in ?Orson and since you&#39;re here now, you might as well tell the truth.
            &lt;&lt;player&gt;&gt;Uhm- I didn&#39;t. ?Kathryn asked me to wear it... She has the only key for the cage...&lt;&lt;/player&gt;&gt;
            Even though most people would probably find this really weird, ?Orson simply gives a nod of understanding and seems to accept it for what it is. He gives you a quick smile.
            &lt;&lt;orson&gt;&gt;Ah! A power dynamic with ?LadyKathryn, how fascinating! Consider me intrigued, ?title. But don&#39;t worry, I&#39;ll stop asking questions. &lt;em&gt;For now.&lt;/em&gt;&lt;&lt;/orson&gt;&gt;
            &lt;&lt;player&gt;&gt;Uhm- yes, thank you ?Orson. We should probably get to the bathing...&lt;&lt;/player&gt;&gt;
        &lt;&lt;else&gt;&gt;
            ?Orson lays eyes on your caged ?dick, staring at it for only a moment when you see the hint of a smile appear on his face.
            &lt;&lt;orson&gt;&gt;I must admit, you look rather cute in the chastity cage, ?title.&lt;&lt;/orson&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;include &#39;Orson Acknowledgement&#39;&gt;&gt;
    It&#39;s ?Orson&#39;s utmost professionalism that lets you feel unbothered by him seeing you naked. 
    &lt;&lt;if hasTag(&#39;ointment&#39;)&gt;&gt;
        You suddenly remember the jar of ointment ?Morgana gave to you earlier. You could ask ?Orson to help you apply it.
        &lt;&lt;img &#39;equipment/ointment.jpg&#39; null &#39;200px&#39;&gt;&gt;
        &lt;&lt;if hasTag(&#39;ointment-fem&#39;)&gt;&gt;
            &lt;&lt;decision &#39;Mention the ointment&#39;&gt;&gt;
                &lt;&lt;include &#39;Orson Bath Ointment&#39;&gt;&gt;
                &lt;&lt;decisionicon femininity&gt;&gt;
            &lt;&lt;/decision&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;decision &#39;Mention the ointment&#39;&gt;&gt;
                &lt;&lt;include &#39;Orson Bath Ointment&#39;&gt;&gt;
                &lt;&lt;decisionicon masculinity&gt;&gt;
            &lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;decision &#39;Hop in the bath&#39; &#39;Orson Bath&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Have him leave you to your bath.&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Thank you, ?Orson. That&#39;ll be all.&lt;&lt;/player&gt;&gt;
    &lt;&lt;orson&gt;&gt;Certainly, ?title. I&#39;ll leave you to it then.&lt;&lt;/orson&gt;&gt;
    He turns away and walks towards the door.
    &lt;&lt;if hasTag(&#39;orson-caught&#39;)&gt;&gt;
        Before leaving he turns around and looks in your direction.
        &lt;&lt;orson&gt;&gt;And don&#39;t worry, ?title. I will be sure to leave you alone this time.&lt;&lt;/orson&gt;&gt;
        He&#39;s definitely referring to the time he caught you masturbating in the tub. Thought you feel slightly ashamed, it is strangely reassuring to know he won&#39;t disturb you and you can do whatever you in privacy now.
    &lt;&lt;/if&gt;&gt;
    You undress yourself and get ready to enter the bath.
    &lt;&lt;if hasTag(&#39;ointment&#39;)&gt;&gt;
        You suddenly remember the jar of ointment ?Morgana gave to you earlier. Now would be a good time to apply it to your skin.
        &lt;&lt;img &#39;equipment/ointment.jpg&#39; null &#39;200px&#39;&gt;&gt;
        &lt;&lt;if hasTag(&#39;ointment-fem&#39;)&gt;&gt;
            &lt;&lt;decision &#39;Apply the ointment to your skin before going in the bath&#39;&gt;&gt;
                &lt;&lt;include &#39;No Orson Bath Ointment&#39;&gt;&gt;
                &lt;&lt;decisionicon femininity&gt;&gt;
                &lt;&lt;decisiongroup 1&gt;&gt;
            &lt;&lt;/decision&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;decision &#39;Apply the ointment to your skin before going in the bath&#39;&gt;&gt;
                &lt;&lt;include &#39;No Orson Bath Ointment&#39;&gt;&gt;
                &lt;&lt;decisionicon masculinity&gt;&gt;
                &lt;&lt;decisiongroup 1&gt;&gt;
            &lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;decision &#39;Hop in the bath&#39; &#39;No Orson Bath&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="255" name="No Orson Bath Ointment" tags="" position="600,3225" size="100,100">&lt;&lt;addsin &#39;magic&#39;&gt;&gt;
&lt;&lt;if hasQuest(&#39;morgana-ointment&#39;) and questStep(&#39;morgana-ointment&#39;) &lt; 4&gt;&gt;
    &lt;&lt;advancequest &#39;morgana-ointment&#39;&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasTag(&#39;ointment-fem&#39;)&gt;&gt;
    &lt;&lt;changestat femininity medium&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;changestat masculinity medium&gt;&gt;
&lt;&lt;/if&gt;&gt;
You open the strange jar and start applying the salve to your skin. It immediately seems to have an effect on you, it feels quite tingly when you rub it on yourself. It takes a little while to get the ointment applied everywhere but you actually feel much better once you&#39;re finally done.</tw-passagedata><tw-passagedata pid="256" name="Orson Bath Ointment" tags="" position="725,3225" size="100,100">&lt;&lt;addsin &#39;magic&#39;&gt;&gt;
&lt;&lt;if hasQuest(&#39;morgana-ointment&#39;) and questStep(&#39;morgana-ointment&#39;) &lt; 4&gt;&gt;
    &lt;&lt;advancequest &#39;morgana-ointment&#39;&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasTag(&#39;ointment-fem&#39;)&gt;&gt;
    &lt;&lt;changestat femininity medium&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;changestat masculinity medium&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;player&gt;&gt;One more thing, ?Orson. ?Morgana gave me a specific ointment and told me I should apply it before taking a bath in the morning. Could you help me with this?&lt;&lt;/player&gt;&gt;
You hand the strange jar to ?Orson as he inspects it.
&lt;&lt;orson&gt;&gt;Certainly, ?title. Let me help you, please relax while I apply the salve.&lt;&lt;/orson&gt;&gt;
He opens the jar and starts slathering your skin with the strange substance. It immediately seems to have an effect on you, your skin starts tingling all over. It takes a little while for ?Orson to apply a thin layer everywhere. So far he has carefully avoided your more private area but once he covered everything else he stops and looks up at you.
&lt;&lt;orson&gt;&gt;Does the salve need to go &lt;em&gt;everwhere&lt;/em&gt;, ?title?&lt;&lt;/orson&gt;&gt;
It&#39;s quite clear he&#39;s asking whether he needs to rub it on your dick as well. ?Orson&#39;s cold professionalism about the situation continues to amaze you.
&lt;&lt;decision &#39;Give confirmation&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Yes. If you&#39;d please, ?Orson.&lt;&lt;/player&gt;&gt;
    ?Orson nods, takes a bit more of the liquid from the jar and starts to softly apply this to your ?dick.
    &lt;&lt;if settings.sph&gt;&gt;
        He&#39;s using a single finger to rub it over your ?dick, there&#39;s not much area to cover but he&#39;s working it diligently.?nl
    &lt;&lt;/if&gt;&gt;
    It doesn&#39;t take long for this treatment to jump-start the natural response of your body. Your ?dick starts growing and after a little while of ?Orson applying the salve, you are standing at full mast.?nl
    This situation must have definitely caught his attention but somehow even now he remains stoically set on his mission as he continues applying the salve. He moves to your backside as he starts to rub your butt cheeks. Once done he moves to part your butt cheeks and apply salve even there, it seems ?Orson takes his job very seriously.

    &lt;&lt;decision &#39;Request of him to give you some relief&#39; dominance small&gt;&gt;
        &lt;&lt;spicy&gt;&gt;
        &lt;&lt;addsin &#39;masturbation&#39;&gt;&gt;
        &lt;&lt;player&gt;&gt;?Orson, could you do me a favour and provide me with some relief?&lt;&lt;/player&gt;&gt;
        You seem to have suddenly taken his professionalism away as he&#39;s taken aback slightly.
        &lt;&lt;orson&gt;&gt;Uhm- Certainly, ?title.&lt;&lt;/orson&gt;&gt;
        He looks at you, waiting for you to  tell him what to do.
        &lt;&lt;player&gt;&gt;Kneel, ?Orson. And take off your clothes.&lt;&lt;/player&gt;&gt;
        He follows your command to the letter as he kneels in front of you. He starts stripping his uniform as he looks up at you. You take in his lean body, a certain twink-like stature. You move your ?dick closer as you motion for him to give you a handjob. He takes your ?dick in hand and starts stroking slowly.?nl
        Simply commanding your loyal attendant to do something like this is turning you on quite a lot. You feel his soft hand intensely masturbating your ?dick.?nl
        You close your eyes as you take in his intense hand-job, even this task he takes very seriously, it seems like he&#39;s quite good at this. He&#39;s stroking you exactly how you like it, it doesn&#39;t take long for you to feel your climax approaching.
        
        &lt;&lt;if settings.vids&gt;&gt;
            &lt;&lt;if settings.sph&gt;&gt;
                &lt;&lt;video &#39;player/masturbate_sph.webm&#39;&gt;&gt;
            &lt;&lt;else&gt;&gt;
                &lt;&lt;video &#39;player/masturbate.webm&#39;&gt;&gt;
            &lt;&lt;/if&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;player&gt;&gt;Ah! I&#39;m close...&lt;&lt;/player&gt;&gt;
        ?Orson holds up his other hand as he expertly brings you to orgasm. Your cum starts flying over his hand as he catches all of it.
        &lt;&lt;orson&gt;&gt;There you go, ?title. Now for your bath.&lt;&lt;/orson&gt;&gt;
        He grabs a tissue to clean your cum, he also takes a moment to wipe your dick for you before he gets up from his knees.
        &lt;&lt;decision &#39;Hop in the bath&#39; &#39;Orson Bath&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;disableif isInChastity()&gt;&gt;
        You are locked in chastity.
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Moan slightly as he puts a finger close to your asshole&#39; submissiveness small&gt;&gt;
        &lt;&lt;spicy&gt;&gt;
        &lt;&lt;addsin &#39;fingered&#39;&gt;&gt;
        You let out a slightly girly moan as he&#39;s spreading the salve in a very private area. ?Orson definitely seems to notice that as you suddenly feel him rub your asshole slightly more.
        &lt;&lt;orson&gt;&gt;Oh? I didn&#39;t know this is something ?title enjoys...&lt;&lt;/orson&gt;&gt;
        You finally managed to break his professionalism as this seemed to have awakened something in ?Orson. You feel him slowly start to prod your hole as you let out another moan. You feel completely under his control as he bends you over slightly and starts to whisper in your ear.
        &lt;&lt;orson&gt;&gt;Let me take care of you, ?title...&lt;&lt;/orson&gt;&gt;
        As you listen to his soothing voice you suddenly feel him penetrate you with a finger and you let out your loudest moan so far. The feeling of ecstasy is overwhelming you as you feel your legs shake slightly.
        &lt;&lt;player&gt;&gt;?Orson... Ah... So intense...&lt;&lt;/player&gt;&gt;
        He takes the cue as he now starts slowing fingering you while you&#39;re standing there, naked in the bathroom. &lt;&lt;if !isInChastity()&gt;&gt;The feeling is overwhelming you as you take your ?dick in hand and start masturbating while being finger-fucked.&lt;&lt;/if&gt;&gt; You turn slightly to look at his face and you see him smiling back at you. It&#39;s definitely not the smile he normally gives you, his face looks like he knows he is the one who is in control now.
        &lt;&lt;orson&gt;&gt;Do you want this, ?title? Why don&#39;t you ask for it? Beg me for my service.&lt;&lt;/orson&gt;&gt;
        He starts slowing down while you want him to speed up right now. The feeling of your asshole being fingered by ?Orson feels amazing right now.
        &lt;&lt;player&gt;&gt;?Orson... Please... keep finger-fucking me...&lt;&lt;/player&gt;&gt;
        &lt;&lt;orson&gt;&gt;Of course, ?title. All you had to do is ask.&lt;&lt;/orson&gt;&gt;
        &lt;&lt;if settings.vids&gt;&gt;
            &lt;&lt;video &#39;orson/fingering.webm&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        You feel him speeding up more and more and you feel your own orgasm coming closer and closer. You suddenly groan as you feel him sticking in a second finger. This super intense feeling brings you over the edge as you start cumming and moaning loudly.
        &lt;&lt;player&gt;&gt;Ahh! I&#39;m cumming!&lt;&lt;/player&gt;&gt;
        Your cum flies out, making a stain on the bathroom floor. ?Orson takes out his fingers as he looks down at you.
        &lt;&lt;if settings.cum&gt;&gt;
            &lt;&lt;orson&gt;&gt;Very good, ?title. You made quite a mess though, are you going to clean this up?&lt;&lt;/orson&gt;&gt;
            You must say it&#39;s quite strange to hear ?Orson asking you to clean up your own mess since he is usually the one to do that. It&#39;s a new experience to have him in charge.
            &lt;&lt;decision &#39;Lick your cum from the floor&#39; depravity small&gt;&gt;
                &lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;
                &lt;&lt;if settings.vids&gt;&gt;
                    &lt;&lt;video &#39;player/swallow{2}.webm&#39;&gt;&gt;
                &lt;&lt;/if&gt;&gt;
                You hear his command and immediately kneel down to lick your own cum off of the floor. The salty bitter taste moves over your tongue as you feel your own cum sliding into your mouth. You lick up all the cum and then look up at ?Orson, presenting him with your empty mouth.
                &lt;&lt;orson&gt;&gt;Good job, ?title. You are such a little cumslut, aren&#39;t you?&lt;&lt;/orson&gt;&gt;
                You hesitantly nod as he humiliates you.
                &lt;&lt;orson&gt;&gt;Now it&#39;s time for your bath, get up.&lt;&lt;/orson&gt;&gt;
                &lt;&lt;decision &#39;Hop in the bath&#39; &#39;Orson Bath&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
            &lt;&lt;/decision&gt;&gt;
            &lt;&lt;decision &#39;Clean up your cum using a tissue and hop in the bath&#39; &#39;Orson Bath&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;orson&gt;&gt;Very good, ?title. Allow me to clean up while you take your bath.&lt;&lt;/orson&gt;&gt;
            &lt;&lt;decision &#39;Go in the bath&#39; &#39;Orson Bath&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Let him finish his task&#39;&gt;&gt;
        You feel slightly strange in this situation, both because the salve has an even more intense effect in the areas ?Orson is working now and because of the intimacy of this current moment. It doesn&#39;t seem to bother ?Orson though, a more loyal servant you could not ask for.?nl
        He suddenly gets up once he&#39;s done with his service.
        &lt;&lt;orson&gt;&gt;There you go, ?title. Now for your bath.&lt;&lt;/orson&gt;&gt;
        &lt;&lt;decision &#39;Hop in the bath&#39; &#39;Orson Bath&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Tell him that\&#39;s not necessary&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;No, thank you, ?Orson. That should be enough.&lt;&lt;/player&gt;&gt;
    &lt;&lt;orson&gt;&gt;Certainly, ?title. Let&#39;s get you in the bath then.&lt;&lt;/orson&gt;&gt;
    &lt;&lt;decision &#39;Hop in the bath&#39; &#39;Orson Bath&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="257" name="No Orson Bath" tags="" position="850,3225" size="100,100">You settle into the tub and lean back, feeling your body relax. The warm water feels wonderful against your skin. You take a moment to really enjoy this bath, however, you do get a slightly indecent thought as you look down and see your ?dick bobbing in the water.
&lt;&lt;decision &#39;Enjoy some &quot;me&quot;-time&#39; 1 depravity small&gt;&gt;
    &lt;&lt;include &#39;No Orson Bath Masturbate&#39;&gt;&gt;
&lt;&lt;disableif isInChastity()&gt;&gt;
    You are locked in chastity.
&lt;&lt;/decision&gt;&gt;

&lt;&lt;if getDay() !== &#39;wednesday&#39;&gt;&gt;
    &lt;&lt;decision &#39;Finish your bath and get dressed&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Finish your bath and go to the council&#39; &#39;Council Entrance&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="258" name="Orson Bath" tags="" position="975,3225" size="100,100">?Orson holds out a hand to help you into the bathtub.
As you hold his hand you step into the tub and sink into the hot water. You can feel the warm water envelop your body. 
&lt;&lt;orson&gt;&gt;There you are, your highness. Enjoy your bath.&lt;&lt;/orson&gt;&gt; 
He gives a slight bow and leaves you alone in the bathroom.

&lt;&lt;if getDay() !== &#39;wednesday&#39;&gt;&gt;
    &lt;&lt;decision &#39;Finish your bath and get dressed&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Finish your bath and go to the council&#39; &#39;Council Entrance&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="259" name="No Orson Bath Masturbate" tags="spicy" position="1100,3225" size="100,100">&lt;&lt;if !hasTag(&#39;orson-caught&#39;)&gt;&gt;
    &lt;&lt;include &#39;Introduction Masturbate&#39;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;addsin &#39;masturbation&#39;&gt;&gt;
    You take your ?dick in hand and stroke it gently, feeling a tingle of pleasure run through your body. &lt;&lt;if settings.sph&gt;&gt;You have always used only two fingers to masturbate, your ?dick is not quite long enough to use a full hand.&lt;&lt;/if&gt;&gt; You close your eyes and let your mind wander. You find yourself thinking of ?Morgana with her perfect body.
    &lt;&lt;if hasCompletedQuest(&#39;morgana-bedroom&#39;)&gt;&gt;
        Images of her naked body once again enter your mind. You still can&#39;t believe how you got to see her naked.
        &lt;&lt;img &quot;morgana/bedroom_visit_naked_{theme}.jpg&quot;&gt;&gt;
        Your mind wanders further as you think about what might happen next time she gives you a night-time visit. Would she actually have sex with you? The though alone is driving you insane with lust as you feel yourself getting closer and closer to completion.
    &lt;&lt;else&gt;&gt;
        You wonder what she would look like in a more intimate setting. You can&#39;t deny you really long to see her naked. Perhaps it&#39;s her mysterious aura but she definitely has some effect on you. Thinking of her, what you could do with her, is driving you wild. You feel yourself getting closer and closer as you stroke yourself.
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;if settings.vids&gt;&gt;
        &lt;&lt;if settings.sph&gt;&gt;
            &lt;&lt;video &#39;player/masturbate_bath_sph.webm&#39;&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;video &#39;player/masturbate_bath.webm&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    You let out a loud grunt as you cum in the bathtub. You stare at the water as you see your sperm float around in it.
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="260" name="Orson Bedroom" tags="" position="1225,3225" size="100,100">&lt;&lt;include &#39;Orson Acknowledgement&#39;&gt;&gt;
You enter your bedroom to see ?Orson here, tidying up the place. He&#39;s folding some of your freshly washed clothes and putting them in your wardrobe.
&lt;&lt;orson&gt;&gt;Hello, ?title. How may I be of service?&lt;&lt;/orson&gt;&gt;
&lt;&lt;player&gt;&gt;Oh there&#39;s nothing, ?Orson. I was just coming to say hi.&lt;&lt;/player&gt;&gt;
&lt;&lt;orson&gt;&gt;Ah, splendid, ?title. Please let me know if I can help you with anything. I am at your service.&lt;&lt;/orson&gt;&gt;
&lt;&lt;player&gt;&gt;Of course. Thank you for cleaning up, ?Orson.&lt;&lt;/player&gt;&gt;
He nods to you as he continues cleaning your bedroom.
&lt;&lt;decision &#39;Take your leave&#39; &#39;Bedroom&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="261" name="Orson Poem 1" tags="" position="100,3350" size="100,100">As you&#39;re getting up, you notice an unfamiliar piece of folded paper lying on your desk. Your name is written on the front in curling letters. Could this be a note from ?Sybille? &lt;&lt;if hasCompletedQuest(&#39;rosa-date&#39;)&gt;&gt;Or perhaps a sweet note from ?Rosa?&lt;&lt;/if&gt;&gt;?nl

You get out of bed and open the note quickly to find...a poem?

&lt;&lt;note&gt;&gt;

Thine eyes glitter like emeralds,&lt;br&gt;
Thy hair strands of amber deep,&lt;br&gt;
Fair skin soft as pillow down,&lt;br&gt;
Thy laugh a chime I wish to keep.?nl

Thou art the subject of my dreams,&lt;br&gt;
The scent of blooms on summer morns,&lt;br&gt;
A whisper low of sighs in love,&lt;br&gt;
My heart a creature caught in thorns.?nl

I wish always thy face to see,&lt;br&gt;
And, mayhaps, thy hand to hold,&lt;br&gt;
For though thou may&#39;st love me not,&lt;br&gt;
Thy notice is worth more than gold.&lt;br&gt;

&lt;&lt;/note&gt;&gt;

You look around the room as though the person who wrote the note might suddenly emerge from the shadows. &lt;&lt;if hasCompletedQuest(&#39;rosa-date&#39;)&gt;&gt;Could ?Rosa really have written this? She hasn&#39;t mentioned writing poetry, and you&#39;re fairly sure she knows you like her. Could this mean you have a secret admirer?&lt;&lt;else&gt;&gt;You&#39;re really not sure who this could be from. Do you have a secret admirer?&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Put the note away for now&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="262" name="Orson Poem 2" tags="" position="225,3350" size="100,100">As you come to consciousness, you feel yourself being poked in the neck by something. You sit up and feel under your pillow, finding another note with your name on it. 

&lt;&lt;note&gt;&gt;

Shall I compare thee to a winter&#39;s day?&lt;br&gt;
Thou art more warm and more full of sunlight:&lt;br&gt;
Rough winds make bare December branches sway,&lt;br&gt;
And autumn&#39;s yellows soon submit to white;?nl

Sometime too long does heaven&#39;s bright eye close,&lt;br&gt;
And often is his grey complexion dim;&lt;br&gt;
And every snow from snow is oft unfroze,&lt;br&gt;
By chance or winter&#39;s ever-changing whim;?nl

But thine eternal brilliance shall not fade,&lt;br&gt;
Nor lose possession of the heart thou ow&#39;st;&lt;br&gt;
Nor shall enternal cold make thee unmade,&lt;br&gt;
When my sun-bright affection for thee grow&#39;st:?nl

So long as my lungs breathe, or mine eyes see,&lt;br&gt;
So long lives love, and this I give to thee.

&lt;&lt;/note&gt;&gt;

Wow, whoever is writing these seems to be putting a lot of effort into their poems. You&#39;re not sure what all the lines mean, but it definitely seems like the author has a crush on you. Unfortunately the poems don&#39;t really give away much. Maybe if you wait for more poems, the writer will reveal some hints as to their identity...

&lt;&lt;decision &#39;Put the note away for now&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="263" name="Orson Poem 3" tags="" position="350,3350" size="100,100">You almost don&#39;t see it, but as you are getting out of bed a small piece of crumpled paper catches your eye in the waste paper basket under your desk. Could this be a discarded note from your secret admirer? You retrieve the paper and smooth it out. You see another poem, shorter this time.

&lt;&lt;note&gt;&gt;

There once was a prince of such beauty,&lt;br&gt;
That working for him was no duty.&lt;br&gt;
The castle staff swooned,&lt;br&gt;
While verses they crooned,&lt;br&gt;
Their dreams filled with that royal booty.

&lt;&lt;/note&gt;&gt;

You put down the note slowly. It strikes you that this poem is much less...refined than the previous ones, which is probably why the author threw it away.?nl

It feels a bit strange that some anonymous person is apparently dreaming about your ass. Still, perhaps this poem provides you some clues as to their identity. It seems like they work at the castle, though that leaves several possibilities. You could talk to someone who would know more about the castle staff... Or maybe it would be better to just forget about this and pretend you never saw the notes...

&lt;&lt;decision &#39;Resolve to discover who the writer is&#39;&gt;&gt;
    &lt;&lt;removetag &#39;orson-poem-1&#39;&gt;&gt;
    &lt;&lt;removetag &#39;orson-poem-2&#39;&gt;&gt;
    &lt;&lt;startquest &#39;find-poet&#39;&gt;&gt;
    &lt;br&gt;You&#39;re not sure how, but you&#39;re going to figure out who this poet is. It seems like a good place to start would be to talk to someone who knows a lot of the staff. Perhaps ?Rosa could help?
    &lt;&lt;decision &#39;Slip the note into your pocket for now&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decisionicon romance&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Ignore the mystery and get on with your day&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Event Orson Poem&#39;&gt;&gt;&lt;&lt;delay 7&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;br&gt;It would be too awkward to try to figure out who the author is, and in any case, it&#39;s a bit strange that they only leave you notes and haven&#39;t tried to talk to you. You crumple up the paper and throw it back in the trash can, resolving to forget about this whole situation. 
    &lt;&lt;decision &#39;Go about your day&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="264" name="Orson Poems Ask Rosa" tags="" position="475,3350" size="100,100">&lt;&lt;completequest &#39;find-poet&#39;&gt;&gt;

You approach ?Rosa in the kitchen as she is hard at work chopping a mountain of vegetables. She notices you come in and gives you a bright smile. 

&lt;&lt;rosa&gt;&gt;Oh, hello, ?titleR! How can I be of service?&lt;&lt;/rosa&gt;&gt;

You realize suddenly that asking ?Rosa about the poems is a rather awkward situation. &lt;&lt;if hasCompletedQuest(&#39;rosa-date&#39;)&gt;&gt;Will she be jealous if someone else on the kitchen staff is interested in you?&lt;&lt;else&gt;&gt;Before you can even say a word, you feel your cheeks growing a bit warm.&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Uh, well, it&#39;s rather a delicate question I suppose...&lt;&lt;/player&gt;&gt;

?Rosa sets down her knife and gives you an encouraging nod, inviting you to continue speaking.

&lt;&lt;player&gt;&gt;I, uh, well, I received these anonymous notes...&lt;&lt;/player&gt;&gt;

You look at her quickly to see if there is any sign of recognition in her face, but she just looks curious.

&lt;&lt;player&gt;&gt;They are of a...well...romantic nature. I believe that someone on the castle staff may be, uh, interested in me?&lt;&lt;/player&gt;&gt;

?Rosa giggles, covering her mouth with her hand. 

&lt;&lt;if hasCompletedQuest(&#39;rosa-date&#39;)&gt;&gt;
    &lt;&lt;rosa&gt;&gt;So, I suppose that makes two, then? That&#39;s so sweet! What do the notes say?&lt;&lt;/rosa&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;rosa&gt;&gt;Oh my goodness, how sweet! You have a secret admirer, ?titleR! May I ask what the notes say?&lt;&lt;/rosa&gt;&gt;
&lt;&lt;/if&gt;&gt;

It occurs to you that receiving romantic notes does indicate that you are desirable, so you&#39;re not sure why this feels so embarrassing. &lt;&lt;if hasCompletedQuest(&#39;rosa-date&#39;)&gt;&gt;At least ?Rosa doesn&#39;t seem to be upset that someone else is romantically interested in you.&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Well, that&#39;s what I wanted to ask you about. They are all in the form of poems. Do you know anyone on the staff who writes poetry?&lt;&lt;/player&gt;&gt;

?Rosa considers your question for a moment, looking thoughtful.

&lt;&lt;rosa&gt;&gt;No, I don&#39;t believe poetry is a common activity for everyday folk! Perhaps you might ask ?Sybille? She seems to know everything happening in this castle, and I hear she&#39;s quite good at puzzles.&lt;&lt;/rosa&gt;&gt;

You&#39;re not sure why you didn&#39;t think of asking ?Sybille in the first place. She&#39;ll probably take one look at a poem and know who wrote it simply based on type of paper or something.

&lt;&lt;player&gt;&gt;Of course, that&#39;s a wonderful idea. Thank you, ?Rosa.&lt;&lt;/player&gt;&gt;

You bid farewell to ?Rosa, making a mental note to discuss this topic with ?Sybille at the next opportunity.

&lt;&lt;decision &#39;Leave the kitchen&#39; &#39;Hallway&#39;&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
    &lt;&lt;startquest &#39;find-poet-2&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="265" name="Orson Poems Ask Sybille" tags="" position="600,3350" size="100,100">&lt;&lt;completequest &#39;find-poet-2&#39;&gt;&gt;
&lt;&lt;changeschedule orson &#39;evening&#39; &#39;Library&#39;&gt;&gt;

You find ?Sybille working at her desk, writing something on a piece of paper. You catch a glimpse of what looks like a set of grids with numbers in some of the boxes before she whips the paper out of sight. Was she working on some kind of puzzle?

&lt;&lt;sybille&gt;&gt;How can I assist you, ?title?&lt;&lt;/sybille&gt;&gt;

You realize that asking ?Sybille, a council member, about this question is somehow even more awkward than asking ?Rosa.

&lt;&lt;player&gt;&gt;I was, um, hoping your skill in spycraft might assist me with a...um...rather personal question...&lt;&lt;/player&gt;&gt;

?Sybille raises a single eyebrow at you. 

&lt;&lt;sybille&gt;&gt;A personal question? Of what nature?&lt;&lt;/sybille&gt;&gt;

You figure you may as well just show ?Sybille one of the notes. You pull the most recent one out of your pocket and hand it to her.

&lt;&lt;player&gt;&gt;I have been receiving anonymous poems expressing...uh, affection for me, and I was, well, wondering if you might have any idea who- who they&#39;re from...&lt;&lt;/player&gt;&gt;

?Sybille reads the poem, and you watch as a slight smirk whispers across her face.

&lt;&lt;sybille&gt;&gt;I was wondering if he would ever get up the courage...&lt;&lt;/sybille&gt;&gt;

&lt;&lt;player&gt;&gt;What? You know who wrote this?&lt;&lt;/player&gt;&gt;

?Sybille hands the paper back to you, her face once again completely neutral.

&lt;&lt;sybille&gt;&gt;Indeed. This poem was written by ?Orson.&lt;&lt;/sybille&gt;&gt;

You take a step back, feeling a moment of shock as she says this.

&lt;&lt;player&gt;&gt;What?! How do you know this?&lt;&lt;/player&gt;&gt;

&lt;&lt;sybille&gt;&gt;I have my ways. I will simply say that ?Orson enjoys hiding in dark corners in the library, writing by candlelight. This is a match for his handwriting.&lt;&lt;/sybille&gt;&gt;

You can&#39;t believe that these notes are from ?Orson. He has always acted so professional in your company. He even bathes you without so much as a twitch on his face. Still, ?Sybille seems very certain...

&lt;&lt;player&gt;&gt;Well, thank you, ?Sybille... I will have to mull this over...&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Leave the dungeons&#39; &#39;Hallway&#39;&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
    &lt;&lt;startquest &#39;find-poet-3&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="266" name="Orson Find Library" tags="" position="725,3350" size="100,100">You creep through the dim space, your eyes peeled for any signs of candlelight. You&#39;ve never noticed how many dark corners the library has. It would be easy to hide here. As you&#39;re peering into one such corner, craning your neck to see over a large pile of books, a shock of white hair comes into view.?nl

Maybe this was a bad idea. You could just leave and pretend you don&#39;t know it&#39;s ?Orson who is writing the poems. On the other hand, maybe confronting the issue head-on would be smarter...

&lt;&lt;decision &#39;Approach and confront ?Orson about the poems&#39; &#39;Orson Poems Confront&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Walk out silently and never speak of this again&#39; &#39;Hallway&#39;&gt;&gt;
    &lt;&lt;completequest &#39;find-poet-3&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="267" name="Orson Poems Confront" tags="" position="850,3350" size="100,100">&lt;&lt;completequest &#39;find-poet-3&#39;&gt;&gt;

You creep closer. ?Orson doesn&#39;t seem to have noticed you, so you tap him on the shoulder. He jumps, spilling ink across the parchment he was writing on.

&lt;&lt;orson&gt;&gt;Oh, goodness! ?Title!&lt;&lt;/orson&gt;&gt;

He stands quickly, immediately adopting his usual professional demeanor. You notice he is standing in such a way as to block your view of what he was writing.

&lt;&lt;player&gt;&gt;Oh no- I didn&#39;t mean to startle you, ?Orson. My apologies.&lt;&lt;/player&gt;&gt;

He gives you a slight bow.

&lt;&lt;orson&gt;&gt;No, ?title, the fault is mine. I will clean this mess up immediately. But first, how can I be of service to you, ?title?&lt;&lt;/orson&gt;&gt;

Yet again, you feel your cheeks growing hot, and find yourself at a loss for words. It occurs to you that you had no plan for how this conversation would go. Could you possibly return ?Orson&#39;s feelings someday? Should you tell him you&#39;re not interested? Isn&#39;t this whole situation a bit inappropriate, anyway?

&lt;&lt;decision &#39;Indicate your interest to ?Orson&#39; &#39;Orson Indicate Interest&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Turn ?Orson down gently&#39; &#39;Orson Reject Submissive&#39; submissiveness medium&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Admonish ?Orson for his inappropriate behavior&#39; &#39;Orson Reject Dominant&#39; dominance medium&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="268" name="Orson Indicate Interest" tags="" position="975,3350" size="100,100">&lt;&lt;player&gt;&gt;I- uh- well, ?Orson... I know about the poems you&#39;ve been writing me...&lt;&lt;/player&gt;&gt;

For just a moment, you see a crack appear in ?Orson&#39;s professional demeanor. He&#39;s hard to read, but it looks like some mixture of surprise and possibly...excitement?

&lt;&lt;player&gt;&gt;They were, uh, very nice poems. You are an excellent writer.&lt;&lt;/player&gt;&gt;

?Orson inclines his head at you, a hint of a smile on his face.

&lt;&lt;orson&gt;&gt;Well, thank you, ?title. I find you an excellent muse.&lt;&lt;/orson&gt;&gt;

You&#39;re definitely blushing now. He seems to notice this, and a genuine smile breaks on his face. You realize you&#39;re smiling back at him.

&lt;&lt;player&gt;&gt;Do you, um, often write poetry?&lt;&lt;/player&gt;&gt;

&lt;&lt;orson&gt;&gt;Oh! Yes, I have always considered myself a poet of sorts. I was just crafting a verse before you came in...&lt;&lt;/orson&gt;&gt;

He moves aside, revealing the piece of parchment, so stained with ink now that the words are illegible. He chuckles lightly.

&lt;&lt;orson&gt;&gt;No matter, I will recreate the lines from memory. I have always been so inspired by things of beauty; I&#39;m sure the lines will come right back to me...&lt;&lt;/orson&gt;&gt;

He trails off, looking you in the eyes. Your face somehow seems to grow even hotter at this. ?Orson thinks you&#39;re a thing of beauty?

&lt;&lt;player&gt;&gt;Oh, well, th-thank you for saying so... Perhaps you could, um, show me some more of your poetry sometime?&lt;&lt;/player&gt;&gt;

&lt;&lt;orson&gt;&gt;I would love to, ?title. Perhaps one of these evenings we could share some wine and poetry in the meadow?&lt;&lt;/orson&gt;&gt;

&lt;&lt;player&gt;&gt;That would be lovely.&lt;&lt;/player&gt;&gt;

&lt;&lt;orson&gt;&gt;Wonderful. I look forward to it, as a bird awaits the plump seed of spring.&lt;&lt;/orson&gt;&gt;

Wondering vaguely if this is some kind of intimate metaphor, you give him another smile and head back out of the library in a daze. You can&#39;t believe that you&#39;ve just arranged a date with, of all people, your faithful servant. Not only that, but he also writes poetry about you. Your day has been very strange indeed.

&lt;&lt;decision &#39;Exit the library&#39; &#39;Hallway&#39;&gt;&gt;
    &lt;&lt;addcounter &#39;orson&#39; 1&gt;&gt;
    &lt;&lt;startquest &#39;orson-date-1&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="269" name="Orson Reject Submissive" tags="" position="1100,3350" size="100,100">&lt;&lt;player&gt;&gt;I- uh- well, ?Orson... I know about the poems you&#39;ve been writing me...&lt;&lt;/player&gt;&gt;

For just a moment, you see a crack appear in ?Orson&#39;s professional demeanor. He&#39;s hard to read, but it looks like some mixture of surprise and possibly...excitement?

&lt;&lt;player&gt;&gt;They were, uh, very nice poems. You are an excellent writer.&lt;&lt;/player&gt;&gt;

?Orson inclines his head at you, a hint of a smile on his face.

&lt;&lt;orson&gt;&gt;Well, thank you, ?title. I find you an excellent muse.&lt;&lt;/orson&gt;&gt;

&lt;&lt;player&gt;&gt;Ah, yes, well, about that... I&#39;m very sorry, but I don&#39;t know if I&#39;m, um, interested...&lt;&lt;/player&gt;&gt;

?Orson&#39;s face returns instantly to a neutral, polite expression.

&lt;&lt;orson&gt;&gt;Of course, ?title. You need say nothing more. We can simply forget this ever happened.&lt;&lt;/orson&gt;&gt;

You are a bit taken aback by how quickly he has accepted your rejection. It feels a bit sudden, but on the other hand, you&#39;re happy to speak about this as little as possible.

&lt;&lt;player&gt;&gt;Oh, uh, yes, I think that would be best. Thank you, ?Orson.&lt;&lt;/player&gt;&gt;

He inclines his head as you turn and walk away, hoping you haven&#39;t hurt his feelings too much. As you&#39;re about to leave the library, you hear something that sounds like crumpling parchment.

&lt;&lt;decision &#39;Exit the library&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="270" name="Orson Reject Dominant" tags="" position="1225,3350" size="100,100">&lt;&lt;player&gt;&gt;I know about the poems you&#39;ve been writing, ?Orson.&lt;&lt;/player&gt;&gt;

For just a moment, you see a crack appear in ?Orson&#39;s professional demeanor. He&#39;s hard to read, but it looks like some mixture of surprise and possibly...excitement?

&lt;&lt;player&gt;&gt;I must say, this behavior is inappropriate for a servant to display toward his prince. I can overlook this incident given your history of excellent service, but I must ask you to maintain your professionalism going forward.&lt;&lt;/player&gt;&gt;

?Orson&#39;s face returns instantly to a neutral, polite expression.

&lt;&lt;orson&gt;&gt;Of course, ?title. I apologize for my untoward behavior. You will hear nothing more of it.&lt;&lt;/orson&gt;&gt;

&lt;&lt;player&gt;&gt;Thank you, ?Orson. I will take my leave.&lt;&lt;/player&gt;&gt;

He inclines his head as you turn and walk away. As you&#39;re leaving the library, you hear something that sounds like crumpling parchment.

&lt;&lt;decision &#39;Exit the library&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="271" name="Orson Date 1 Start" tags="" position="100,3475" size="100,100">&lt;&lt;completequest &#39;orson-date-1&#39;&gt;&gt;

You make your way through the library, the warm glow of the evening sun lighting patches on the marble floors. You find ?Orson in the same place as last time, his hair falling into his eyes as he leans over a sheet of parchment, his quill moving quickly. He notices you approach and stands, folding the parchment and slipping it into his pocket.

&lt;&lt;orson&gt;&gt;Good evening, ?title. Are you here for our meadow excursion?&lt;&lt;/orson&gt;&gt;

&lt;&lt;player&gt;&gt;Indeed I am, ?Orson!&lt;&lt;/player&gt;&gt;

He turns around a pulls a leather bag from underneath the desk he was working at. You can just make out what looks like the top of a wine bottle sticking out of the bag. Has ?Orson been carrying this around in anticipation of your date?

&lt;&lt;orson&gt;&gt;Wonderful! I have prepared some necessary supplies and am ready to depart immediately. You, however, cannot leave the castle looking like yourself. Please, follow me, ?title.&lt;&lt;/orson&gt;&gt;

You follow him curiously as he leads you out of the library.

&lt;&lt;decision &#39;Follow ?Orson&#39; &#39;Orson Date 1 Outfit&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="272" name="Orson Date 1 Outfit" tags="" position="225,3475" size="100,100">&lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;

You trail behind ?Orson as he leads you into your own bedroom. He stands aside, revealing your disguise outfit laid neatly on the bed. You stare at him.

&lt;&lt;player&gt;&gt;H-how long have you known about this, ?Orson?&lt;&lt;/player&gt;&gt;

He chuckles, clasping his hands behind his back.

&lt;&lt;orson&gt;&gt;Did you never wonder, ?title, how your outfit always stayed perfectly clean?&lt;&lt;/orson&gt;&gt;

You almost have to laugh at your own cluelessness. Of course ?Orson knows about your disguise. Even though you hid the clothes deep in your wardrobe, it has always been his job to ensure your entire room is clean and tidy. It was silly of you to think he wouldn&#39;t notice.&lt;br&gt;

&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    &lt;br&gt;You feel suddenly self-conscious, knowing that ?Orson is perfectly aware of your maid outfit. That said, he did lay it out for you, so perhaps he doesn&#39;t mind. 
&lt;&lt;/if&gt;&gt;

&lt;&lt;orson&gt;&gt;Shall I help you dress, ?title?&lt;&lt;/orson&gt;&gt;

You look at him quickly, trying to read his face, but as usual he keeps an impressively professional expression. Knowing how he feels about you, allowing him to dress you suddenly sounds like a sensual choice... Perhaps it would be less awkward just to dress yourself...

&lt;&lt;decision &#39;Change into the disguise yourself&#39;&gt;&gt;
    &lt;&lt;outfit disguise&gt;&gt;
    &lt;&lt;player&gt;&gt;Oh, I appreciate that ?Orson, but there is, um, no need...&lt;&lt;/player&gt;&gt;

    He nods, giving you a warm smile.

    &lt;&lt;orson&gt;&gt;Of course. You have been doing it yourself so far, after all.&lt;&lt;/orson&gt;&gt;

    He leaves the bedroom, allowing you to change in private. Once in your disguise, you meet him outside the door.&lt;br&gt;

    &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
        &lt;br&gt;You feel your cheeks grow hot as you stand before him in your dress. It feels strange to wear this outfit in front of him, but he doesn&#39;t so much as flinch when he sees you. 
        &lt;&lt;orson&gt;&gt;You look lovely in this dress, and now the guards will give us no trouble. To the meadow?&lt;&lt;/orson&gt;&gt;
        Does he really think you look good in this outfit? Your cheeks still feel hot, but you feel yourself relax a bit.
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;decision &#39;Leave the castle with ?Orson&#39; &#39;Orson Date 1 Leave&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Allow ?Orson to help you change into the disguise&#39;&gt;&gt;
    &lt;&lt;outfit disguise&gt;&gt;
    &lt;&lt;player&gt;&gt;O-oh, um, yes, I would appreicate that, ?Orson.&lt;&lt;/player&gt;&gt;

    &lt;&lt;orson&gt;&gt;Of course, ?title, I am happy to help.&lt;&lt;/orson&gt;&gt;

    He approaches you and begins undoing the various buckles, clasps, and fasteners on your elaborate princely outfit. After a moment, he removes the top layer of garments and lays them carefully on your bed. He then continues his methodical movements, removing your undergarments and leaving you completely naked in the cool air.?nl
    
    He glances up and catches you watching him. He gives you a warm smile. 

    &lt;&lt;orson&gt;&gt;I hope it is not too forward of me to say, ?title, but you really are quite beautiful.&lt;&lt;/orson&gt;&gt;

    He picks up your disguise clothes and begins to dress you in them, his movements still incredibly gentle. You feel your cheeks growing hot at the intimacy of the moment and the warm touch of his careful fingers.

    &lt;&lt;player&gt;&gt;Th-thank you, ?Orson.&lt;&lt;/player&gt;&gt;

    He finishes dressing you and sweeps his hands gently across the fabric on your shoulders to smooth it. &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;It feels strange to stand before him in a dress, but he doesn&#39;t flinch at your new outfit.&lt;&lt;/if&gt;&gt; 

    &lt;&lt;orson&gt;&gt;&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;There. You look lovely in this dress, and now the guards will give us no trouble.&lt;&lt;else&gt;&gt;There, now the guards will give us no trouble.&lt;&lt;/if&gt;&gt; To the meadow?&lt;&lt;/orson&gt;&gt;

    &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;Does he really think you look good in this outfit? Your cheeks still feel hot, but you feel yourself relax a bit.&lt;&lt;/if&gt;&gt;

    &lt;&lt;decision &#39;Leave the castle with ?Orson&#39; &#39;Orson Date 1 Leave&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="273" name="Orson Date 1 Leave" tags="" position="350,3475" size="100,100">&lt;&lt;setlocation &#39;Gatehouse&#39;&gt;&gt;

You walk with ?Orson past the guards. They pay little attention to you, but you notice them watching ?Orson leave with mildly curious expressions. In turn, ?Orson gives them a polite nod as you pass by together.?nl

You get the sense that ?Orson probably doesn&#39;t leave the castle very often, considering how dedicated he is to serving you. 

&lt;&lt;decision &#39;Head to the meadow&#39; &#39;Orson Date 1 Meadow Arrive&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="274" name="Orson Date 1 Meadow Arrive" tags="" position="475,3475" size="100,100">&lt;&lt;setlocation &#39;Meadow&#39;&gt;&gt;

You walk with ?Orson into the meadow and find a picturesque spot amidst the flowers that is blocked from view of the castle by a small hillock. To your surprise, ?Orson pulls a small rug from his leather bag and spreads in on the ground. He waits for you to take a seat, then sits down comfortably next to you.

&lt;&lt;orson&gt;&gt;Well, ?title, I think we have plenty of time to take in the splendor of the sunset.&lt;&lt;/orson&gt;&gt;

He pulls two silver goblets from his bag and fills them with wine, handing you one. You look at him, the glow of the evening&#39;s low sun warming his pale skin and making his white hair look golden.

&lt;&lt;player&gt;&gt;Please, ?Orson, call me by my name.&lt;&lt;/player&gt;&gt;

He makes eye contact with you and smiles warmly. 

&lt;&lt;orson&gt;&gt;I would like nothing more, ?player.&lt;&lt;/orson&gt;&gt;

You take a sip of your wine and find yourself surprised. You are used to tasting fine wines in the castle, but something about this one seems particularly special. It is a red wine, deep and rich, with complex flavor notes you couldn&#39;t even begin to describe.

&lt;&lt;player&gt;&gt;?Orson, where did you find this wine?&lt;&lt;/player&gt;&gt;

As you say this, ?Orson seems to let his guard down, looking suddenly excited.

&lt;&lt;orson&gt;&gt;Do you like it? I chose this bottle based on your taste preferences. You may notice notes of dark, brambly fruit, exotic spices, and just the barest hint of leather.&lt;&lt;/orson&gt;&gt;

You stare into your goblet. You&#39;re not sure you can taste any of those things, but it is still a delicious wine.

&lt;&lt;player&gt;&gt;You seem to know much about wine!&lt;&lt;/player&gt;&gt;

&lt;&lt;orson&gt;&gt;It is a recent passion of mine. I have actually been corresponding with a master wine steward. Once a month he sends a bottle and a description of its history, along with tasting notes and prompts to develop one&#39;s palate. It&#39;s really very interesting.&lt;&lt;/orson&gt;&gt;

You don&#39;t think you&#39;ve ever seen ?Orson become so animated about any topic before. He must really like wine.

&lt;&lt;player&gt;&gt;I would love to hear more about it.&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Continue your conversation&#39; &#39;Orson Date 1 Meadow Poem&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="275" name="Orson Date 1 Meadow Poem" tags="" position="600,3475" size="100,100">You continue talking with ?Orson as the sun drifts lower on the horizon and the wine causes you to become a bit tipsy. As the light starts to grow dim, you think of the piece of paper that ?Orson slipped into his pocket. 

&lt;&lt;player&gt;&gt;What was it that you were, um, writing in the library when I found you?&lt;&lt;/player&gt;&gt;

&lt;&lt;orson&gt;&gt;Ah, that was a poem for you. I suppose now is the time to read it, while we still have light.&lt;&lt;/orson&gt;&gt;

He pulls the piece of paper from his pocket and unfolds it. You can just make out the words on the page as he reads the poem dramatically.

&lt;&lt;note&gt;&gt;
    Within thy chest,&lt;br&gt;
    Thou guardst a gold-hammered seed,&lt;br&gt;
    Crafted, shining, lovely,&lt;br&gt;
    Hidden, grasping under dirt,&lt;br&gt;
    Like light through the door crack,&lt;br&gt;
    Like stem under snow,&lt;br&gt;
    To make jealous spring&#39;s first sparrow,&lt;br&gt;
    To birth a twining vine,&lt;br&gt;
    Growing &#39;til overgrown,&lt;br&gt;
    Both cage and nest, bonds and bed,&lt;br&gt;
    The new-year melting of the icy core of me.
&lt;&lt;/note&gt;&gt;

He puts down the paper, looking at you expectantly. 

&lt;&lt;orson&gt;&gt;Do you like it? I was experimenting with a non-metrical approach. It sounds a bit different, but there is a lovely freedom of artistic expression when one can eschew a rhyming scheme...&lt;&lt;/orson&gt;&gt;

You can&#39;t help but wonder at how ?Orson wrote what could only be described as a love poem for you. It is incredibly strange to know that your long-time servant has these feelings for you, but at the same time sitting here with him drinking wine and has felt almost...natural??nl

The sky is now bathed in shades of red and orange, and ?Orson is looking at you with a soft expression you&#39;ve never seen on his face before. He seems to really care for you... There&#39;s not a soul around... You could kiss him right now, if you wanted to...

&lt;&lt;decision &#39;Lean in to kiss him&#39; &#39;Orson Date 1 Kiss&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Let the moment pass&#39; &#39;Orson Date 1 Rejected&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="276" name="Orson Date 1 Kiss" tags="spicy" position="725,3475" size="100,100">&lt;&lt;addtag &#39;orson-romance&#39;&gt;&gt;

You lean in to kiss him and ?Orson immediately responds, meeting your lips with his own. He sighs into you as your mouths move together, dropping the poem to circle his arms around you. You let your own hand trail up to hold the side of his face, and when you pull away to look at him, he&#39;s smiling.

&lt;&lt;orson&gt;&gt;The sky is beautiful right now, ?player, but it has nothing on you.&lt;&lt;/orson&gt;&gt;

The line is cheesy enough that you almost laugh, but he seems serious, so instead you lean in to kiss him again. This time you let yourself get closer, moving your body next to his, feeling the heat of his chest and tasting the wine on his tongue. It doesn&#39;t take long for your movements to become faster, and you feel the arousal building inside yourself.?nl

You fall together to lie on the rug, kissing each other deeply. Involuntarily, you find yourself moving against him, wanting to get closer to him. You know he wants you too. You could just keep kissing him, or you could do something more...

&lt;&lt;decision &#39;Get closer to him&#39; &#39;Orson Date 1 Blowjob Choice&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Just keep kissing him&#39; &#39;Orson Date 1 Come Down&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="277" name="Orson Date 1 Rejected" tags="" position="850,3475" size="100,100">You break eye contact with ?Orson and clear your throat.

&lt;&lt;player&gt;&gt;It was a nice poem, ?Orson. When did you first become interested in poetry?&lt;&lt;/player&gt;&gt;

Noticing the shift in your tone, ?Orson sits up straighter and his soft expression slips into a more neutral one.

&lt;&lt;orson&gt;&gt;Well, I was first given a book of poetry as a young boy...&lt;&lt;/orson&gt;&gt;

You spend some more time discussing books and poetry until the sky grows dark and a chill takes the air. You pack up together and head back to the castle, parting ways for the night with a friendly wave.?nl

Though you had a nice time with ?Orson, you&#39;re not sure you&#39;re interested in pursuing a romantic relationship with him. Luckily, if his past behavior is any indication, you&#39;re sure you can count on him to continue serving you with the utmost professionalism.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Return to your bedroom and remove your disguise&#39; &#39;Bedroom&#39;&gt;&gt;
    &lt;&lt;outfit standard&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="278" name="Orson Date 1 Come Down" tags="spicy" position="975,3475" size="100,100">?Orson seems in no hurry to end your date, and you have the feeling that he would have happily done more than just kiss you this evening, if you had wanted. But he knows you well, and seems to wordlessly understand that this is all you want to do today.?nl

You&#39;re not sure how much time passes, but after a while the sky darkens and a chill takes the air. Even in the warmth of ?Orson&#39;s arms, you find yourself shivering.

&lt;&lt;orson&gt;&gt;Much as I would like to stay here forever, perhaps we should return to the castle now.&lt;&lt;/orson&gt;&gt;

&lt;&lt;player&gt;&gt;Y-yes, I&#39;m a b-bit c-cold...&lt;&lt;/player&gt;&gt;

You chuckle together, kissing one last time before packing up and heading back to the castle. You sneak in a final kiss before parting for the night.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Return to your bedroom and remove your disguise&#39; &#39;Bedroom&#39;&gt;&gt;
    &lt;&lt;outfit standard&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="279" name="Orson Date 1 Blowjob Choice" tags="spicy" position="1100,3475" size="100,100">Without even thinking about it, you find yourself pushing your crotch against his as you kiss him. You can feel your ?dick getting hard &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;under your dress&lt;&lt;else&gt;&gt;in your pants&lt;&lt;/if&gt;&gt;, and you can feel him growing hard under his own clothing.?nl

Suddenly, all these clothes are starting to feel annoying. It seems as though ?Orson is thinking the same thing. He starts undoing the tie of his pants, where in the golden light you can see a bulge waiting to be let free. &lt;&lt;if !isInChastity()&gt;&gt;You feel your own ?dick straining against your underwear.&lt;&lt;/if&gt;&gt;?nl

You start tearing your clothes off. ?Orson removes his pants, revealing his erect cock, long and gracefully curved. He looks at you with lust in his eyes, watching you undress.?nl
&lt;&lt;if isInChastity()&gt;&gt;
    You quickly lower your underwear, revealing your ?penis, locked away in a &lt;&lt;= $chastity.color&gt;&gt; chastity cage.
    &lt;&lt;orson&gt;&gt;Ah, is ?LadyKathryn making you wear that again?&lt;&lt;/orson&gt;&gt;
    &lt;&lt;player&gt;&gt;Y- yeah...&lt;&lt;/player&gt;&gt;
    He smiles and playfully taps the tip of your cage as your ?dick is straining against it&#39;s confines. The make-out session would normally make you stand full-mast in no time but now the cage is entirely cock-blocking that from happening.
    &lt;&lt;orson&gt;&gt;Awh you poor thing, well I suppose since I won&#39;t be able to pleasure you right now perhaps you could be so kind to do the honors?&lt;&lt;/orson&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;if settings.sph&gt;&gt;
        Normally when you have these intimate moments with someone for the first time, they would have a brief moment of disappointment when they set eyes on your ?dick. Luckily, since ?Orson is used to seeing you naked more often, he doesn&#39;t respond surprised when you lower your underwear and pull out your ?dick. Even though your penis is so small, you&#39;re sure he would happily pleasure you here in this meadow. 
    &lt;&lt;else&gt;&gt;
        You quickly lower your underwear and pull out your ?dick. You&#39;re sure he would happily pleasure you in this meadow. 
    &lt;&lt;/if&gt;&gt;
    On the other hand, he has always been so focused on serving you; perhaps it would be enticing for you to serve him for once...?nl
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Let ?Orson pleasure you&#39; &#39;Orson Date 1 Blowjob&#39; dominance medium&gt;&gt;
    &lt;&lt;disableif isInChastity()&gt;&gt;
        You are locked in chastity.
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Pleasure ?Orson&#39; &#39;Orson Date 1 Blowjob Role Reversal&#39; submissiveness medium&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="280" name="Orson Date 1 Blowjob" tags="spicy" position="1225,3475" size="100,100">You strip naked and lean back on the rug. Though it&#39;s nothing he hasn&#39;t seen before, ?Orson drinks in the sight of you like a man dying of thirst. His eyes roam over your entire body, lingering hungrily on your ?dick.

&lt;&lt;orson&gt;&gt;The best muse one could hope for...&lt;&lt;/orson&gt;&gt;

He sweeps his hair out of his eyes and leans forward to kiss you, his cock rubbing against yours. Leaving your mouth, he trails gentle kisses along your neck, down your chest, to the base of your ?dick. You watch him hover there, looking up at you with his icy blue eyes.

&lt;&lt;orson&gt;&gt;You want me to do this, ?player?&lt;&lt;/orson&gt;&gt;

You nod emphatically, incredibly hard, barely able to stand the anticipation. You watch as he slowly wraps his mouth around you and you feel your ?dick enveloped in a soft, warm wetness that sends ripples of pleasure through your body.

&lt;&lt;player&gt;&gt;Augh- oh, fuck...&lt;&lt;/player&gt;&gt;

?Orson smiles around your ?dick and begins &lt;&lt;if settings.sph&gt;&gt;to suck, moving his tongue around the tip.&lt;&lt;else&gt;&gt;to move his mouth up and down on the shaft, his tongue wrapping around the tip as he pulls up.&lt;&lt;/if&gt;&gt; You hear yourself moaning involuntarily as the pleasure builds inside you.?nl

He increases his speed, suckling on your ?dick with the same deft confidence he brings to all his work. Your focus narrows to the sensations in your ?dick, the way ?Orson is enveloping you while somehow achieving a perfect level of suction and stimulation with his tongue. You are so overcome by the pleasure that the watercolor sky above and the heady smell of the wildflowers in the evening sun barely register to you as he bobs on your ?dick.

&lt;&lt;player&gt;&gt;Fuck, ?Orson, that&#39;s good...&lt;&lt;/player&gt;&gt;

&lt;&lt;if settings.sph&gt;&gt;
    ?Orson shifts his position slightly and starts to thrust his mouth on you so that the tip of your ?dick hits the back of his mouth. Combined with the wet sucking, the additional stimulation builds the ecstasy to a peak inside you.
&lt;&lt;else&gt;&gt;
    He wraps a hand around the base of your ?dick and begins to pump it in time with the movements of his mouth, bringing a whole new layer of pleasure to the experience. Then he thrusts his mouth onto you so far that the tip of your ?dick hits the back of his throat, and you feel the ecstasy building to a peak inside you.
&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Ah- fuck- I&#39;m going to cum...&lt;&lt;/player&gt;&gt;

?Orson keeps his mouth on you as you orgasm hard, your cum splattering down his throat. He swallows your cum and gently sucks along your ?dick a few more times before pulling you out of his mouth. It is only now that you realize he has been pleasuring himself with his own hand, and he throws his head back as he too orgasms, his own cum splashing across the rug.?nl

You lie together on the rug, breathing heavily, kissing idly as the sun dips below the horizon. 

&lt;&lt;player&gt;&gt;You are...very skilled, ?Orson.&lt;&lt;/player&gt;&gt;

?Orson turns his head to look at you and smiles.

&lt;&lt;orson&gt;&gt;It is not difficult to perform well when one is so inspired.&lt;&lt;/orson&gt;&gt;

You smile back at him, only now starting to process that you just received a blowjob from your personal manservant. The fresh pleasure of it is still too great for you to care, however.?nl

The sky darkens and a chill takes the air. Reluctantly, you get dressed again and pack up to head back to the castle. You share a long kiss before parting for the night.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Return to your bedroom and remove your disguise&#39; &#39;Bedroom&#39;&gt;&gt;
    &lt;&lt;outfit standard&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="281" name="Orson Date 1 Blowjob Role Reversal" tags="spicy" position="100,3600" size="100,100">&lt;&lt;addsin &#39;blowjob&#39;&gt;&gt;
&lt;&lt;addtag &#39;orson-role-reversal&#39;&gt;&gt;

?Orson seems to notice you hesitating. He leans back comfortably on the rug, his cock on full display.

&lt;&lt;orson&gt;&gt;Perhaps just for this evening, ?player, you could...serve me?&lt;&lt;/orson&gt;&gt;

You finish stripping naked. Though it&#39;s nothing he hasn&#39;t seen before, ?Orson drinks in the sight of you like a man dying of thirst.

&lt;&lt;player&gt;&gt;I-I think I would like that very much...&lt;&lt;/player&gt;&gt;

He smiles at you softly and you lean over him to kiss him, feeling your ?dick rub against his. The touch makes you even harder, and you want desperately to get him inside your mouth. You move to kiss down his pale neck and his chest, making your way to the base of his shaft. You look up to meet his icy blue eyes and he gives you a nod.?nl

You can hardly believe you&#39;re doing this with your personal manservant, of all people, but lust has taken over your mind. You put a hand on his dick and begin to stroke it gently, watching as he sighs in pleasure at your touch.

&lt;&lt;orson&gt;&gt;Look how beautiful you are...&lt;&lt;/orson&gt;&gt;

Slowly, hesitatingly, you lean down and wrap your mouth around the head of his penis. You try to use just the soft parts of your mouth and lightly suck on the tip, eliciting a low moan from ?Orson as he watches you. This gives you some confidence so you begin to move your mouth along his length, sucking around the shaft.

&lt;&lt;orson&gt;&gt;Agh, fuck, ?player...&lt;&lt;/orson&gt;&gt;

His dick is too big to fit comfortably in your mouth, so you wrap a hand around the base and start to pump in time with the movements of your mouth. ?Orson is moaning loudly now as you pleasure his cock, his eyes closed and head thrown back.?nl

You use your tongue to circle around the glans of his cock and then push it deeper in your mouth. His dick hits the back of your throat and you gag involuntarily, but try to relax into the sensation as you continue pushing yourself down on him. You look up and meet his eyes, your lips still wrapped around his cock, and he tangles a hand in your hair.

&lt;&lt;orson&gt;&gt;Fuck, look how well you serve me...&lt;&lt;/orson&gt;&gt;

You start to bob your head on his dick, moving fast in time with your hand. ?Orson&#39;s moans grow louder as you do so, and he begins bucking his hips to thrust his cock deeper inside your mouth. 

&lt;&lt;orson&gt;&gt;You&#39;re going to make me cum, ?player...&lt;&lt;/orson&gt;&gt;

You feel a sense of pride in providing so much pleasure to ?Orson. Will you swallow his cum, or let him cum on the ground?&lt;br&gt;

&lt;&lt;decision &#39;Swallow his cum greedily&#39;&gt;&gt;
    &lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;
    &lt;br&gt;You continue your movements, pleasuring ?Orson&#39;s cock until his hips suddenly jerk as he pushes into your mouth a final time and his hot cum splatters down your throat. You swallow his cum enthusiastically and clean his dick off with your tongue.?nl

    &lt;&lt;if isInChastity()&gt;&gt;
        Watching him cum has you immensely aroused. Sadly, you can&#39;t really do anything about it as your own ?dick is currently locked away in chastity.
    &lt;&lt;else&gt;&gt;
        Watching him cum has you so aroused that when you start to masturbate your own ?dick, it takes only moments for you to reach your climax too, and your semen sprays across the rug. 
    &lt;&lt;/if&gt;&gt;
    You collapse next to him and lie there, breathing heavily, kissing idly as the sun dips below the horizon.

    &lt;&lt;orson&gt;&gt;You are very skilled, ?player.&lt;&lt;/orson&gt;&gt;

    You turn your head to look at him and smile.

    &lt;&lt;player&gt;&gt;I guess I was...inspired, as you might say.&lt;&lt;/player&gt;&gt;

    He smiles back at you, and you only now start to process that you just gave a blowjob to your personal manservant. The fresh pleasure of it is still too great for you to care, however.?nl

    The sky darkens and a chill takes the air. Reluctantly, you get dressed again and pack up to head back to the castle. You share a long kiss before parting for the night.
    
    &lt;&lt;if isMemory()&gt;&gt;
        &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Return to your bedroom and remove your disguise&#39; &#39;Bedroom&#39;&gt;&gt;
        &lt;&lt;outfit standard&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Finish him off with your hand&#39;&gt;&gt;
    &lt;br&gt;You pull your mouth off him with a wet slurp and continue working the shaft with your hand. After a few moments, his hips jerk as he pushes into your hand and his hot cum splatters into the air, falling on your hand and the rug.?nl

    Watching him cum has you so aroused that when you start to masturbate your own ?dick, it takes only moments for you to reach your climax too. Your semen sprays across the rug, mixing with his. You collapse next to him and lie there, breathing heavily, kissing idly as the sun dips below the horizon.

    &lt;&lt;orson&gt;&gt;You are very skilled, ?player.&lt;&lt;/orson&gt;&gt;

    You turn your head to look at him and smile.

    &lt;&lt;player&gt;&gt;I guess I was...inspired, as you might say.&lt;&lt;/player&gt;&gt;

    He smiles back at you, and you only now start to process that you just gave a blowjob to your personal manservant. The fresh pleasure of it is still too great for you to care, however.?nl

    The sky darkens and a chill takes the air. Reluctantly, you get dressed again and pack up to head back to the castle. You share a long kiss before parting for the night.

    &lt;&lt;if isMemory()&gt;&gt;
        &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Return to your bedroom and remove your disguise&#39; &#39;Bedroom&#39;&gt;&gt;
        &lt;&lt;outfit standard&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="282" name="Orson Gift Quill" tags="" position="225,3600" size="100,100">&lt;&lt;completequest &#39;orson-gift-quill&#39;&gt;&gt;
You find ?Orson in his usual spot in the library, bent over a sheet of parchment. Hearing you approach, he straightens and nods at you, the hint of a smile breaking through his professional expression.

&lt;&lt;orson&gt;&gt;Ah, ?player! You&#39;ve caught me in the middle of composing a sonnet. How may I be of service?&lt;&lt;/orson&gt;&gt;

&lt;&lt;player&gt;&gt;Actually, ?Orson, I brought a gift for you.&lt;&lt;/player&gt;&gt;

His look of curiosity turns to one of excitement as you produce the engraved quill from behind your back. 

&lt;&lt;orson&gt;&gt;Oh, my goodness, ?player! This is absolutely gorgeous.&lt;&lt;/orson&gt;&gt;

You watch anxiously as he takes the quill from you. To your relief, he turns it over in his hands with a look of pleasure on his face.

&lt;&lt;player&gt;&gt;You like it?&lt;&lt;/player&gt;&gt;

&lt;&lt;orson&gt;&gt;I adore it. The craftsmanship is superb. Those fine lines in the metal there must be so difficult to achieve...&lt;&lt;/orson&gt;&gt;

You can&#39;t help but smile as you watch his excitement over your gift.

&lt;&lt;player&gt;&gt;I&#39;m so glad you like it.&lt;&lt;/player&gt;&gt;

He looks around the library, then stands up and takes a step toward you. Smoothly, he reaches a hand out to cup the side of your face and kisses you. You breathe in his scent and find yourself sighing into him.?nl

He pulls away, a real smile playing on his lips.

&lt;&lt;orson&gt;&gt;Truly, thank you, ?player.&lt;&lt;/orson&gt;&gt; 

You lean in to kiss him again, enjoying being close to him like this. When you pull apart again, he looks thoughtful.

&lt;&lt;orson&gt;&gt;You know, a favorite musician of mine will be playing at ?tavern over the next few days. Would you perhaps extend me another kindness and accompany me to one of his shows?&lt;&lt;/orson&gt;&gt;

&lt;&lt;decision &#39;Accept his offer&#39;&gt;&gt;
    &lt;&lt;addcounter &#39;orson-library&#39; 1&gt;&gt;
    &lt;&lt;startquest &#39;orson-date-2&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;I would love to, ?Orson.&lt;&lt;/player&gt;&gt;
    He breaks into a true smile.
    &lt;&lt;orson&gt;&gt;Wonderful! Come find me one of these evenings, then.&lt;&lt;/orson&gt;&gt;
    &lt;&lt;decision &#39;Leave him to his work&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decisionicon romance&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Decline his offer&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Ah, thank you for the invite, ?Orson, but I think I&#39;ll have to skip this one.&lt;&lt;/player&gt;&gt;
    A look of disappointment flashes across ?Orson&#39;s face before returning to a neutral expression.
    &lt;&lt;orson&gt;&gt;Ah, of course, I understand. Perhaps next time.&lt;&lt;/orson&gt;&gt;
    You give him a nod and leave him to his work.
    &lt;&lt;decision &#39;Leave the library&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="283" name="Orson Date 2 Start" tags="" position="350,3600" size="100,100">&lt;&lt;completequest &#39;orson-date-2&#39;&gt;&gt;

You find ?Orson in the library. You immediately notice that instead of his usual work suit, he has changed into an equally formal, yet more colorful suit. It is made of a pale blue silk and is richly embroidered with silver threads.

&lt;&lt;player&gt;&gt;?Orson, you look amazing!&lt;&lt;/player&gt;&gt;

?Orson gives you a small smile. 

&lt;&lt;orson&gt;&gt;And you look as &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;lovely as a spring bloom&lt;&lt;else&gt;&gt;handsome as a winter evergreen&lt;&lt;/if&gt;&gt;, ?player. Shall we head to town?&lt;&lt;/orson&gt;&gt;

&lt;&lt;player&gt;&gt;Yes! I just have...uh, one request. While I&#39;m in my disguise, I have been going by the name ?newname. Could you, um, call me that while we&#39;re in town?&lt;&lt;/player&gt;&gt;

You smile at him awkwardly, hoping he doesn&#39;t find this ask too strange. To your relief, he seems to take your request in stride.

&lt;&lt;orson&gt;&gt;Of course, ?newname, that makes a great deal of sense.&lt;&lt;/orson&gt;&gt;

It feels quite strange to hear ?Orson call you by that name, but you&#39;re glad he has reacted so well.

&lt;&lt;decision &#39;Change into your disguise and go to the tavern&#39; &#39;Orson Date 2 Walk Town&#39;&gt;&gt;
    &lt;&lt;outfit disguise&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="284" name="Orson Date 2 Walk Town" tags="" position="475,3600" size="100,100">&lt;&lt;setlocation &#39;Road&#39;&gt;&gt;

You leave the castle with ?Orson, the guards paying you little notice as you pass by, and walk together toward the town. The evening air is pleasantly cool and the warm light of the setting sun plays on ?Orson&#39;s face, turning his white hair a sunny golden yellow.

&lt;&lt;player&gt;&gt;So, who is this musician we&#39;re going to see?&lt;&lt;/player&gt;&gt;

&lt;&lt;orson&gt;&gt;Oh, he&#39;s something very special. I&#39;ve never heard a bard with such a masterful command of language before. His lyrics are pure poetry spun into melodies, and his lute playing is so energetic, he&#39;ll turn any crowd to dancing within minutes.&lt;&lt;/orson&gt;&gt;

&lt;&lt;player&gt;&gt;W-wow, I&#39;m excited to hear him perform, then!&lt;&lt;/player&gt;&gt;

?Orson meets your eyes and gives you a wink.

&lt;&lt;orson&gt;&gt;It doesn&#39;t hurt that he&#39;s...well, rather easy on the eyes.&lt;&lt;/orson&gt;&gt;

You chuckle and continue your walk, laughing and chatting together until you arrive at the tavern.

&lt;&lt;decision &#39;Go inside&#39; &#39;Orson Date 2 Enter Tavern&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="285" name="Orson Date 2 Enter Tavern" tags="" position="600,3600" size="100,100">&lt;&lt;setlocation &#39;Tavern&#39;&gt;&gt;

You follow ?Orson inside the tavern. A small stage has been set up in one corner, and most of the tables are already full with cheerful patrons who seem to be waiting for the music to start. You squeeze into a small table with ?Orson and order a bottle of wine just as applause picks up in the room.?nl

You look around and to see a man step out onto the stage carrying a lute. His dark hair falls in perfect curls across his eyes, the locks interwoven with small pink flowers. He wears a flowing purple robe that seems to defy gravity as it flutters around him, his neck and wrists are dripping with shining jewelry, and his green eyes pop against perfectly applied outlines of makeup. You have to admit he is one of the most gorgeous men you have ever seen.?nl

As the man gives an exaggerated bow, flashing a brilliant smile at the crowd, you lean in to whisper in ?Orson&#39;s ear.

&lt;&lt;player&gt;&gt;I, uh, see what you mean... He&#39;s beautiful...&lt;&lt;/player&gt;&gt;

?Orson smiles at you and watches as the show starts.

&lt;&lt;merry&gt;&gt;Hello, one and all! Aren&#39;t you all looking &lt;i&gt;dashing&lt;/i&gt; on this fine evening. To those who don&#39;t know me, I&#39;m &lt;&lt;title merry &#39;Meriwether&#39;&gt;&gt; -- but please, call me &lt;i&gt;?Merry&lt;/i&gt;.&lt;&lt;/merry&gt;&gt;

&lt;&lt;changename merry Merry&gt;&gt;

The bard flashes a wink to a girl in a plain peasant dress. She whimpers, swooning at the attention.

&lt;&lt;merry&gt;&gt;And to those who do know me, well, it&#39;s lovely to see you again, my darlings.&lt;&lt;/merry&gt;&gt;

He winks at a young farmer man, who blushes visibly.

&lt;&lt;merry&gt;&gt;I think some of you may recognize this first little number about a certain lady who spent the night with a rather dashing swan...&lt;&lt;/merry&gt;&gt;

The man picks up the lute and begins to play. You&#39;ve seen plenty of court musicians before, as well as the occasional everyday town bard. This man is neither of those things. He sparkles with an almost inhuman energy. Despite being just one person, his performance on the lute and his pure voice seem to expand to fill the room as though an entire band were playing, beautiful lyrics flowing from him like a river of sweet wine. It is undeniably intoxicating, and soon the whole tavern has begun to dance.?nl

?Orson downs his goblet of wine and stands, holding out a beckoning hand.

&lt;&lt;decision &#39;Dance with him&#39; &#39;Orson Date 2 Dance&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Stay seated&#39; &#39;Orson Date 2 Refuse Dance&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="286" name="Orson Date 2 Dance" tags="" position="725,3600" size="100,100">&lt;&lt;increasetime 1&gt;&gt;

You take ?Orson&#39;s hand and stand to dance. You quickly feel out of your depth, as this is nothing like the stuffy, perfectly orchestrated dances of the castle. ?Orson, on the other hand, seems well versed in both formal dance and the unbridled, freeform enthusiasm of the townspeople. He melds them perfectly and you do your best to follow suit, only stepping on his toes a handful of times in the process.?nl

By the end of the night, you&#39;re sweaty and laughing, nearly bursting with the energy of the evening. You join the rest of the tavern in raucus cheers and applause.?nl

?Orson pulls you close, whispering into your ear over the cheers.

&lt;&lt;orson&gt;&gt;How did you like that, then, ?newname?&lt;&lt;/orson&gt;&gt;

You meet his eyes, suddenly distracted by how much you&#39;d like to kiss him right now.

&lt;&lt;player&gt;&gt;It was...amazing. I&#39;ve never seen anything like it.&lt;&lt;/player&gt;&gt;

Out of the corner of your eye, you catch the bard disappearing into a back room with a winning smile and a wave. It suddenly occurs to you that, as a ?barworker, you could easily slip into that back room and give ?Orson a chance to meet this musician he&#39;s so obsessed with...

&lt;&lt;decision &#39;Head toward the back room&#39; &#39;Orson Date 2 Pay And Stay&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Pay your bill and leave&#39; &#39;Orson Date 2 Pay And Leave&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="287" name="Orson Date 2 Refuse Dance" tags="" position="850,3600" size="100,100">&lt;&lt;increasetime 1&gt;&gt;

You feel totally out of your depth in this context, having only ever attended the stuffy, formal dances of the castle. You&#39;re quite certain you would look ridiculous if you tried to emulate the unbridled, freeform way the townspeople are dancing. You shake your head at ?Orson. He looks disappointed, but sits back down at the table with you and pours himself another glass of wine.?nl

You pass the evening watching the bard&#39;s performance with awe, though at times it&#39;s difficult to see over the throng of dancing peasants. By the end of the night you&#39;re bursting with the energy of the evening, and you join the rest of the tavern in raucus cheers and applause. ?Orson leans in to whisper in your ear.

&lt;&lt;orson&gt;&gt;How did you like that, then, ?newname?&lt;&lt;/orson&gt;&gt;

You meet his eyes, suddenly distracted by how much you&#39;d like to kiss him right now.

&lt;&lt;player&gt;&gt;It was...amazing. I&#39;ve never seen anything like it.&lt;&lt;/player&gt;&gt;

Out of the corner of your eye, you catch the bard disappearing into a back room with a winning smile and a wave. It suddenly occurs to you that, as a ?barworker, you could easily slip into that back room and give ?Orson a chance to meet this musician he&#39;s so obsessed with...

&lt;&lt;decision &#39;Head toward the back room&#39; &#39;Orson Date 2 Pay And Stay&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Pay your bill and leave&#39; &#39;Orson Date 2 Pay And Leave&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="288" name="Orson Date 2 Pay And Leave" tags="" position="975,3600" size="100,100">Just as you decide that it would be better to leave the bard in peace, ?Eve comes around to collect your payment for the evening. You reach automatically into your purse, figuring it&#39;s only fair that you pay since you technically have access to the entire castle treasury. Before you can pull any gold out, however, ?Orson steps forward.

&lt;&lt;orson&gt;&gt;Please, ?newname, you have already given me the immense pleasure of your company this evening. Allow me to pay.&lt;&lt;/orson&gt;&gt;

?Eve smiles slyly as ?Orson drops a handful of coins into her palm. He gives her a small bow.

&lt;&lt;orson&gt;&gt;Thank you for the wonderful service, and for hosting such a delightful musician. Have a wonderful evening!&lt;&lt;/orson&gt;&gt;

&lt;&lt;eve&gt;&gt;I&#39;m sure you&#39;ll be having a wonderful evening, as well!&lt;&lt;/eve&gt;&gt;

?Orson seems not to notice ?Eve&#39;s flirty tone. &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;He holds out his arm for you to take and leads you out of the tavern.&lt;&lt;else&gt;&gt;He takes your hand and leads you out of the tavern.&lt;&lt;/if&gt;&gt; As you leave you look back at ?Eve, who wiggles her eyebrows at you suggestively.

&lt;&lt;decision &#39;Walk back to the castle&#39; &#39;Orson Date 2 Walk Back&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="289" name="Orson Date 2 Walk Back" tags="" position="1100,3600" size="100,100">&lt;&lt;setlocation &#39;Road&#39;&gt;&gt;

Though you saw ?Orson drink several goblets of wine, he walks as steadily as ever, looking up at the night sky with a small smile. 

&lt;&lt;orson&gt;&gt;I&#39;ve truly had a lovely time this evening with you. &lt;&lt;if hasVisited(&#39;Orson Date 2 Back Room&#39;)&gt;&gt;And thank you for arranging for us to meet ?Merry. He was &lt;i&gt;almost&lt;/i&gt; as charming as you.&lt;&lt;else&gt;&gt;I&#39;m so glad you came with me to the show.&lt;&lt;/if&gt;&gt;&lt;&lt;/orson&gt;&gt;

&lt;&lt;if hasVisited(&#39;Orson Date 2 Back Room&#39;)&gt;&gt;You feel somewhat awkward about cutting off the meeting with ?Merry, so ?Orson&#39;s compliment catches you off-guard.&lt;&lt;else&gt;&gt;Even though you&#39;ve also had a lovely time, ?Orson&#39;s easy honesty catches you off-guard.&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;S-so have I, ?Orson. Thank you for inviting me.&lt;&lt;/player&gt;&gt;

?Orson smiles at you, then breathes in deeply. 

&lt;&lt;orson&gt;&gt;You know, the air smells familiar. Like some kind of wildflower that must have been growing around our picnic spot.&lt;&lt;/orson&gt;&gt;

You blush, thinking of the time you spent together in the meadow.

&lt;&lt;player&gt;&gt;Y-you know, I might like to do something like that again...&lt;&lt;/player&gt;&gt;

&lt;&lt;orson&gt;&gt;Oh, good, because I don&#39;t think I can wait.&lt;&lt;/orson&gt;&gt;

?Orson meets your eyes and, seeing your receptiveness, crushes his mouth into yours. You stand there in the middle of the road, kissing him deeply, your hands running over each other&#39;s bodies. Lust takes over your brain, and you want badly to be closer to him. You could sneak off the road right now and do more than just kiss him... On the other hand, it&#39;s getting late; maybe you should just head back to the castle and go to bed...

&lt;&lt;decision &#39;Sneak off the road and have some fun&#39; &#39;Orson Date 2 Road Blowjob&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;End the kiss and head to bed&#39; &#39;Orson Date 2 Go Bed&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="290" name="Orson Date 2 Road Blowjob" tags="spicy" position="1225,3600" size="100,100">&lt;&lt;setlocation &#39;Road&#39;&gt;&gt;

&lt;&lt;if hasTag(&#39;orson-role-reversal&#39;)&gt;&gt;

    &lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;

    ?Orson pulls away and smiles at you slyly, his hair tousled.

    &lt;&lt;orson&gt;&gt;How about you serve me again, ?player? You did such a wonderful job last time...&lt;&lt;/orson&gt;&gt;
    
    He pulls you off the road and into a thick circle of bushes. Gently, he pushes you onto your knees and pulls his pants down, revealing his thick cock to you, already hard and erect.

    &lt;&lt;orson&gt;&gt;Now, suck me off like a good little servant.&lt;&lt;/orson&gt;&gt;

    It still feels a bit strange to take orders from ?Orson, but at the same time, you can&#39;t help but feel yourself getting very turned on. Hungrily, you stuff his cock into your mouth and begin to suck him off enthusiastically.?nl

    You look up as you bob on his dick and see him throw his head back under the stars as he lets out a loud moan. 

    &lt;&lt;orson&gt;&gt;Fuck, that&#39;s my good servant... You service me just how I like it...&lt;&lt;/orson&gt;&gt; 

    There&#39;s something incredibly erotic about servicing your manservant like this, working your mouth for his pleasure alone. You stuff his cock deep into your throat, relaxing yourself so that you can thrust him even farther down. He moans louder, which only makes you ram yourself onto his dick even more.

    &lt;&lt;orson&gt;&gt;Oh, fuck, you&#39;re taking me in so deep...&lt;&lt;/orson&gt;&gt;

    ?Orson grabs the back of your head and starts to push you onto his cock even more. You choke a bit, but you&#39;re so turned on that you manage to relax into it and let his cock slide even further down your throat. You keep working his cock under the moonlight, not caring how loud he&#39;s moaning, fully giving yourself over to his pleasure.?nl

    He lets out a final loud moan as he suddenly cums, his hot load shooting straight down your throat. You don&#39;t even taste it as it goes down. &lt;&lt;if isInChastity()&gt;&gt;You can&#39;t touch yourself because you are locked in chastity, but you&#39;re glad that ?Orson has enjoyed himself so much.&lt;&lt;else&gt;&gt;Suddenly, you realize how hard you yourself are. You free your erection and masturbate yourself frantically, bringing yourself quickly to orgasm as you let your own cum spill across the ground.&lt;&lt;/if&gt;&gt;?nl

    ?Orson chuckles and pulls you up. You feel your &lt;&lt;if isInChastity()&gt;&gt;chastity cage&lt;&lt;else&gt;&gt;own ?dick&lt;&lt;/if&gt;&gt; rub against him as he kisses you deeply.

    &lt;&lt;orson&gt;&gt;I absolutely love the way you pleasure me. That was amazing.&lt;&lt;/orson&gt;&gt;

    You kiss him back, feeling somewhat proud of yourself. You stay there in the bushes, kissing for a bit longer before you head back to the castle and part ways for the night with a final kiss.
&lt;&lt;else&gt;&gt;

    &lt;&lt;if isInChastity()&gt;&gt;

        ?Orson pulls away and smiles at you slyly, his hair tousled.

        &lt;&lt;orson&gt;&gt;How about we sneak off the road and have some fun?&lt;&lt;/orson&gt;&gt;
        
        He pulls you off the road and into a thick circle of bushes. Your own ?dick is locked in its cage, so you will need to be the one to pleasure ?Orson tonight. You get onto your knees and watch as ?Orson pulls his pants down, revealing his thick cock to you, already hard and erect.?nl

        Hungrily, you stuff his cock into your mouth and begin to suck him off enthusiastically. You look up as you bob on his dick and see him throw his head back under the stars as he lets out a loud moan. 

        &lt;&lt;orson&gt;&gt;Fuck, that&#39;s good...&lt;&lt;/orson&gt;&gt; 

        There&#39;s something incredibly erotic about servicing your manservant like this, working your mouth for his pleasure alone. You stuff his cock deep into your throat, relaxing yourself so that you can thrust him even farther down. He moans louder, which only makes you ram yourself onto his dick even more.

        &lt;&lt;orson&gt;&gt;Oh, fuck, you&#39;re taking me in so deep...&lt;&lt;/orson&gt;&gt;

        ?Orson grabs the back of your head and starts to push you onto his cock even more. You choke a bit, but you&#39;re so turned on that you manage to relax into it and let his cock slide even further down your throat. You keep working his cock under the moonlight, not caring how loud he&#39;s moaning, fully giving yourself over to his pleasure.?nl

        He lets out a final loud moan as he suddenly cums, his hot load shooting straight down your throat. You don&#39;t even taste it as it goes down. You can&#39;t touch yourself, but you&#39;re glad that ?Orson has enjoyed himself so much.?nl

        ?Orson chuckles and pulls you up. You feel your chastity cage rub against him as he kisses you deeply.

        &lt;&lt;orson&gt;&gt;I absolutely love the way you pleasure me. That was amazing.&lt;&lt;/orson&gt;&gt;

        You kiss him back, feeling somewhat proud of yourself. You stay there in the bushes, kissing for a bit longer before you head back to the castle and part ways for the night with a final kiss.

    &lt;&lt;else&gt;&gt;

        You grab ?Orson&#39;s hand and pull him off the road into a thick circle of bushes. Keeping his eyes on yours, he slowly lowers himself into a kneeling position and pulls your pants down, revealing your hard ?dick.

        &lt;&lt;orson&gt;&gt;Please, allow me to serve you, ?player...&lt;&lt;/orson&gt;&gt;
        
        You can only nod frantically in anticipation and watch as he teases you, kissing the soft skin around your pelvis. It feels a bit strange to be so intimate with a man who is currently employed as your manservant, but at the same time, you can&#39;t help but feel incredibly turned on.?nl

        You watch as he quickly abandons the kissing and hungrily stuffs your ?dick into his mouth. You throw your head back under the stars and let out a moan as he begins to suck you off. 

        &lt;&lt;player&gt;&gt;Fuck, that&#39;s good...&lt;&lt;/player&gt;&gt; 

        There&#39;s something incredibly erotic about receiving a blowjob from your servant like this, watching him work his mouth for your pleasure alone. &lt;&lt;if settings.sph&gt;&gt;Obviously it&#39;s not hard to take your entire ?dick into his mouth, but still, his movements feel amazing. Involuntarily, you moan even louder.&lt;&lt;else&gt;&gt;He stuffs your ?dick deep into his throat, relaxing himself so that he can thrust you even farther down. Involuntarily, you moan even louder, which only makes him ram himself onto your ?dick even more.&lt;&lt;/if&gt;&gt;
        
        &lt;&lt;player&gt;&gt;Augh, fuck, ?Orson...&lt;&lt;/player&gt;&gt;

        Without thinking about it, you grab the back of ?Orson&#39;s head and start to push him onto your ?dick even more. &lt;&lt;if settings.sph&gt;&gt;It doesn&#39;t feel much different, and he&#39;s clearly having no trouble taking you in completely, but it&#39;s still enjoyable to control his movements in this way.&lt;&lt;else&gt;&gt;He chokes a bit, but he seems so turned on that he manages to relax into it and let your ?dick slide even further down his throat. He keeps working your ?dick under the moonlight, and you don&#39;t care how loud you&#39;re moaning. You give yourself fully over to your pleasure.&lt;&lt;/if&gt;&gt;?nl

        The pleasure builds to a peak and you let out a final, loud moan as you suddenly cum, your hot load shooting straight down his throat. After a few moments he moans loudly as well, and you look down to see him cumming onto the ground.?nl

        ?Orson chuckles and stands up. You feel your ?dick rub against his as he kisses you deeply.

        &lt;&lt;orson&gt;&gt;I absolutely love serving you. It&#39;s beautiful to see.&lt;&lt;/orson&gt;&gt;

        You kiss him back, noticing the taste of yourself on his tongue.

        &lt;&lt;player&gt;&gt;I think I like being served by you.&lt;&lt;/player&gt;&gt;

        You stay there in the bushes, kissing for a bit longer before you head back to the castle and part ways for the night with a final kiss.
        &lt;&lt;/if&gt;&gt;

&lt;&lt;/if&gt;&gt;

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Sneak back to your bedroom and remove your disguise&#39; &#39;Bedtime&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="291" name="Orson Date 2 Go Bed" tags="" position="100,3725" size="100,100">You pull away from ?Orson, breathing heavily. He looks at you, questioning in his face.

&lt;&lt;player&gt;&gt;It&#39;s not that I don&#39;t enjoy kissing you, ?Orson, but it&#39;s late and I need to get to bed.&lt;&lt;/player&gt;&gt;

?Orson nods, straightening his clothing out.

&lt;&lt;orson&gt;&gt;Of course, let&#39;s get you to bed.&lt;&lt;/orson&gt;&gt;

You walk together back to the castle, your conversation more subdued. ?Orson gives you a final kiss before heading off to his room.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Sneak back to your bedroom and remove your disguise&#39; &#39;Bedtime&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="292" name="Orson Date 2 Pay And Stay" tags="" position="225,3725" size="100,100">Just as you decide to sneak into the back room, ?Eve comes around to collect your payment for the evening. You reach automatically into your purse, figuring it&#39;s only fair that you pay since you technically have access to the entire castle treasury. Before you can pull any gold out, however, ?Orson steps forward.

&lt;&lt;orson&gt;&gt;Please, ?newname, you have already given me the immense pleasure of your company this evening. Allow me to pay.&lt;&lt;/orson&gt;&gt;

?Eve smiles slyly as ?Orson drops a handful of coins into her palm. He gives her a small bow.

&lt;&lt;orson&gt;&gt;Thank you for the wonderful service, and for hosting such a delightful musician. Have a wonderful evening!&lt;&lt;/orson&gt;&gt;

&lt;&lt;eve&gt;&gt;I&#39;m sure you&#39;ll be having a wonderful evening, as well!&lt;&lt;/eve&gt;&gt;

?Orson seems not to notice ?Eve&#39;s suggestive tone. He turns away to finish off the last mouthful in his goblet, and you take the opportunity to whisper to ?Eve.

&lt;&lt;player&gt;&gt;Hey, my, uh, companion here is a huge fan of the bard who played this evening. Do you think it would be alright if we went and said hello?&lt;&lt;/player&gt;&gt;

?Eve grins at you. 

&lt;&lt;eve&gt;&gt;Your date is just as much of a handsome charmer as ?Merry! Yes, of course, I&#39;ll cover for you and make sure no one interrupts your little meet and greet.&lt;&lt;/eve&gt;&gt;

&lt;&lt;player&gt;&gt;Thanks so much, ?Eve.&lt;&lt;/player&gt;&gt;

You turn to ?Orson, who is now looking at you expectantly. 

&lt;&lt;player&gt;&gt;I have a little surprise for you. Follow me...&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Take ?Orson into the back room&#39; &#39;Orson Date 2 Back Room&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="293" name="Orson Date 2 Back Room" tags="" position="350,3725" size="100,100">You lead ?Orson toward the back room. Nervously, you knock softly on the door. A smooth voice calls for you to enter, and you step inside with ?Orson behind you.?nl

You see the bard reclining on a long sofa, a goblet of wine in his hand. His shirt has been undone slightly, revealing a glimpse of his chest, and as your eyes trail downward you notice a prominent lump underneath the fine silk fabric of his trousers. You feel a heat rising over your cheeks as he flashes a wide smile your way.

&lt;&lt;merry&gt;&gt;Ah, hello there, beautiful friends! How did you like the show?&lt;&lt;/merry&gt;&gt;

Taken aback by how casual he is about being interrupted in his private room, you find yourself suddenly lost for words. Before you can say anything, ?Orson steps up and shakes the man&#39;s hand.

&lt;&lt;orson&gt;&gt;Oh, ?Merry, I am such a fan. I&#39;ve seen you play several times, and each time I find myself enthralled by your talent in not only the music but also the composition of your lyrics. You&#39;re a true artist.&lt;&lt;/orson&gt;&gt;

The bard sits up, clearly touched by ?Orson&#39;s compliments.

&lt;&lt;merry&gt;&gt;Well, thank you kindly. That means a lot to hear, especially from such a dashing patron.&lt;&lt;/merry&gt;&gt;

He winks at ?Orson, looking him up and down with a broad smile. You feel suddenly awkward, as though you&#39;re intruding on a private moment, but ?Merry&#39;s eyes suddenly shift to you. He looks you up and down as well, an unexpectedly lustful expression on his face. 

&lt;&lt;merry&gt;&gt;And thank you as well for coming to my show! It seems I had a particularly attractive crowd this evening.&lt;&lt;/merry&gt;&gt;

You&#39;re cheeks are definitely hot now. You chuckle awkwardly, smiling back at him. Is this man hitting on both you and ?Orson at the same time?

&lt;&lt;player&gt;&gt;I must agree with ?Orson. Your talent is exceptional.&lt;&lt;/player&gt;&gt;

?Merry&#39;s smile grows somehow even broader. 

&lt;&lt;merry&gt;&gt;Please, my alluring friends, sit and share this platter they brought me. It is far too much for one man, though it may satisfy the desires of three...&lt;&lt;/merry&gt;&gt;

He gestures toward a large plate of fruits and cheeses on a nearby table and shifts slightly to make space on the couch. ?Orson sits down, and you hesitate a moment before following suit. ?Merry hands you each a piece of fruit, his hands lingering as they graze across yours.?nl

You glance at ?Orson. Though still as collected as ever, he&#39;s looking at ?Merry with an intense expression. The tension in the room is palpable now, and you get the impression that this could very quickly become something much more sensual... Maybe you should stop this right now and leave with ?Orson before things get out of control. On the other hand, ?Orson seems really into this bard; maybe you should leave him here to have his fun... You have to admit, though, that part of you in intrigued to discover what fun might be possible with three people...

&lt;&lt;decision &#39;Leave ?Orson to his fun&#39; &#39;Orson Date 2 Leave Without Orson&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Stay and have fun with both ?Orson and ?Merry&#39; &#39;Orson Date 2 Threesome&#39; depravity large&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Leave with ?Orson before things get too exciting&#39; &#39;Orson Date 2 Stop Threesome&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="294" name="Orson Date 2 Leave Without Orson" tags="" position="475,3725" size="100,100">You look back and forth between ?Merry and ?Orson. Though the idea of getting intimate with a bard you just met is exciting, you&#39;re not sure it&#39;s something you want to do today. It seems as though ?Orson is open to it, though, and you don&#39;t want to spoil his fun. Maybe you should just head home and let them enjoy themselves...?nl

You stand up suddenly, and both ?Merry and ?Orson look at you.

&lt;&lt;player&gt;&gt;I just, uh, remembered something I need to do this evening... I think I&#39;m going to head home!&lt;&lt;/player&gt;&gt;

?Orson looks at you with an expression of concern.

&lt;&lt;orson&gt;&gt;Are you alright? Should I come with you?&lt;&lt;/orson&gt;&gt;

You start backing out of the room awkwardly.

&lt;&lt;player&gt;&gt;No, no, don&#39;t let me interfere! I really do have to go. Just- uh, pretend I wasn&#39;t here...&lt;&lt;/player&gt;&gt;

As you open the door and start backing into the hallway, you hear ?Orson call behind you.

&lt;&lt;orson&gt;&gt;Oh, alright, I&#39;ll see you tomorrow, then!&lt;&lt;/orson&gt;&gt;

You wave to him and shut the door. You lean against it, breathing heavily, then slip out of the tavern.?nl

As you walk back to the castle, you run over the experience in your mind. You leaving like that was definitely awkward, but you&#39;ve only been on a couple dates with ?Orson. If he wants to stay and possibly have some fun with his favorite musician, why should you get in his way? It&#39;s possible nothing will happen, anyway...?nl

By the time you arrive back at the castle, it&#39;s quite late and sleep is calling to you. 

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Sneak into your bedroom and remove your disguise&#39; &#39;Bedtime&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="295" name="Orson Date 2 Stop Threesome" tags="" position="600,3725" size="100,100">You stand up suddenly, and both ?Merry and ?Orson look at you.

&lt;&lt;player&gt;&gt;It&#39;s been lovely to meet you, ?Merry. It&#39;s getting quite late and I think we might actually need to head home now.&lt;&lt;/player&gt;&gt;

?Orson meets your eyes and you see him give you a small nod. He stands up next to you and reaches out to shake ?Merry&#39;s hand again.

&lt;&lt;orson&gt;&gt;Yes, my &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;lovely&lt;&lt;else&gt;&gt;handsome&lt;&lt;/if&gt;&gt; companion is correct. It was a pleasure to meet you, ?Merry, and I hope that I will be able to see you perform again soon.&lt;&lt;/orson&gt;&gt;

?Merry gives you both a gracious nod. 

&lt;&lt;merry&gt;&gt;Ah, of course, my friends. I am sad that I won&#39;t have the chance to share this food with you, but I thank you for your kind words and wish you a wonderful evening. May we meet again soon!&lt;&lt;/merry&gt;&gt;

You give him a parting wave and head out of the room with ?Orson. You leave the tavern together into the cool night air.

&lt;&lt;decision &#39;Walk back to the castle&#39; &#39;Orson Date 2 Walk Back&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="296" name="Orson Date 2 Threesome" tags="spicy" position="725,3725" size="100,100">&lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;

?Merry locks eyes with you as he hands you the piece of fruit. You look back at him and smile, your breathing coming heavier as you allow yourself to lean into the sensuality of the interaction. ?Merry seems to pick up on this and moves his hand to brush across your arm. 

&lt;&lt;merry&gt;&gt;Say, my friends, should we enjoy the fruit before, or after?&lt;&lt;/merry&gt;&gt;

Merry winks slyly at you both, and you share a quick glance with ?Orson. You can immediately see the arousal in his face, and you sense that he is just as interested in this becoming more than a friendly meeting as you are.

&lt;&lt;orson&gt;&gt;A sensible question. I vote after.&lt;&lt;/orson&gt;&gt;

?Merry smiles and puts down the piece of fruit. Effortlessly, without a hint of hesitation, he leans in and begins to kiss ?Orson. ?Orson responds immediately, kissing him back with a raw enthusiasm that is in itself arousing. You glance down and see ?Orson&#39;s obvious arousal through his trousers.?nl

?Orson breaks away from ?Merry and pulls you in to begin kissing you. You kiss him back, drinking him in with enthusiasm, enjoying the softness of his lips. After a few moments you come apart again, and you feel the touch of ?Merry&#39;s hand on your cheek. You turn to see him looking into your eyes.

&lt;&lt;merry&gt;&gt;May I?&lt;&lt;/merry&gt;&gt;

You nod, and he begins to kiss you. It&#39;s an entirely different experience from kissing ?Orson. Whereas ?Orson is intense and passionate, ?Merry kisses almost leisurely, as though he has all the time in the world to spend exploring you. There&#39;s something incredibly erotic about sharing pleasure with both these men at the same time, and you feel &lt;&lt;if settings.sph&gt;&gt;yourself growing quite hard&lt;&lt;else&gt;&gt;your underwear growing uncomfortably tight&lt;&lt;/if&gt;&gt;.

&lt;&lt;orson&gt;&gt;I think all these clothes are rather getting in the way...&lt;&lt;/orson&gt;&gt;

You look over to see ?Orson loosening his trousers. ?Merry begins to slowly remove his as well, freeing his large, thick erection. It feels a bit awkward to be the only one clothed, so you stand and remove yours, revealing your &lt;&lt;if settings.sph&gt;&gt;tiny dick&lt;&lt;else&gt;&gt;hard ?dick&lt;&lt;/if&gt;&gt;&lt;&lt;if hasBoobs()&gt;&gt; and your ?titties to them. You feel quite exposed, standing there naked with this new change in your body, but both ?Orson and ?Merry seem to be just as aroused as ever.&lt;&lt;else&gt;&gt;.&lt;&lt;/if&gt;&gt;

&lt;&lt;merry&gt;&gt;Oh, aren&#39;t you both gorgeous...&lt;&lt;/merry&gt;&gt;

The next moments are a blur as you come together, sharing kisses and running your hands along each other&#39;s bodies. You lose yourself in the experience and simply enjoy meeting your body with theirs, the intimacy of exploring two men at the same time.?nl

Soon you find yourself on your hands and knees, ?Orson&#39;s cock stuffed in your mouth as he reclines on the plush sofa, his head thrown back and as he lets out a series of moans. You feel ?Merry&#39;s hands running along your back from behind, and the gentle probe of something against your back entrance. While you&#39;re sucking ?Orson off, ?Merry leans down and whispers in your ear.

&lt;&lt;merry&gt;&gt;Would you like this, darling?&lt;&lt;/merry&gt;&gt;

You feel yourself grow somehow even more excited at the idea of being penetrated from behind while pleasuring ?Orson. You manage to nod enthusiastically while still taking ?Orson&#39;s dick deep in your throat.?nl

While you continue to pleasure ?Orson, you feel ?Merry begin to gently insert something small and slick into your entrance. You focus on relaxing and the object slides easily inside you. You realize it must be a finger as ?Merry begins to move it carefully in and out, allowing you to adjust to the sensation. You feel yourself quickly relaxing, probably because you&#39;re already so turned on with ?Orson&#39;s cock stuffed in your mouth. It&#39;s not long before you feel ?Merry remove the finger and slide his lubricated cock inside you.

&lt;&lt;player&gt;&gt;Mnffff, fuck...&lt;&lt;/player&gt;&gt;

The combination of pleasure and slight pain eases as you once again focus on relaxing, and after a few gentle strokes ?Merry begins to properly fuck your ass, his thick cock pushing deep inside you. You realize you&#39;re been somewhat distracted from ?Orson&#39;s dick as he places a hand on the back of your head and begins to fuck your face.

&lt;&lt;merry&gt;&gt;Fuck, your ass feels amazing...&lt;&lt;/merry&gt;&gt;

&lt;&lt;orson&gt;&gt;Your &lt;i&gt;mouth&lt;/i&gt; feels amazing...&lt;&lt;/orson&gt;&gt;

Waves of pleasure move through your body as ?Merry thrusts luxuriously into your ass on one end and ?Orson face-fucks you on the other end. The sensation is almost overwhelmingly good, and it&#39;s all you can do to hold yourself up as you take the members of these two men at the same time. You close your eyes and focus on the sensations of being stuffed on both ends with two large cocks.

&lt;&lt;orson&gt;&gt;I think I&#39;m going to cum...&lt;&lt;/orson&gt;&gt;

?Orson increases the speed of his thrusts, jamming his cock down your throat as cum explodes from the end of it. At the same moment, ?Merry picks up his speed, moving inside you with smooth, deep thrusts. He sighs in pleasure as he cums as well, and you feel his cock pulsing as his semen spurts inside you.?nl

&lt;&lt;if isInChastity()&gt;&gt;
    Both breathing heavily from their orgasms, ?Orson pulls his cock from your mouth and ?Merry gently withdraws himself from your ass. ?Orson pulls you up and begins to kiss you, and ?Merry&#39;s hands move across your back as he reaches around for your ?dick. 

    &lt;&lt;merry&gt;&gt;Oh, what&#39;s this little contraption?&lt;&lt;/merry&gt;&gt;

    You pull away from kissing ?Orson and realize that ?Merry has encountered your chastity cage. 

    &lt;&lt;player&gt;&gt;Ah, it&#39;s a...um...chastity device.&lt;&lt;/player&gt;&gt;

    &lt;&lt;merry&gt;&gt;Ha, well, it doesn&#39;t seem to have worked, does it? I wouldn&#39;t call this a particularly chaste evening. I suppose your pleasure can&#39;t be relieved, then?&lt;&lt;/merry&gt;&gt;

    You laugh awkwardly.

    &lt;&lt;player&gt;&gt;Um, no, I suppose not...&lt;&lt;/player&gt;&gt;

    ?Merry seems to accept this without further questions and flops onto the couch, languidly kissing ?Orson&#39;s bare thigh. ?Orson gives you another long kiss and smiles at you, leaning back to relax on the couch. There are a few moments of comfortable silence as the two men come down from their orgasms, though you feel your own ?dick straining against its cage.

    &lt;&lt;merry&gt;&gt;I must say, I&#39;ve never met such wonderful fans before. You two really are lovely. In fact, I think I might be fans of yours now! Shall we have that fruit?&lt;&lt;/merry&gt;&gt;

    You and ?Orson share the platter of food with ?Merry, chatting idly for some time before eventually it grows late and sleep beckons. You re-dress and part ways with ?Merry, leaving the tavern into the cool night air.
&lt;&lt;else&gt;&gt;
    Both breathing heavily from their orgasms, ?Orson pulls his cock from your mouth and ?Merry gently withdraws himself from your ass. ?Orson pulls you up onto the couch and starts kissing you. At the same time, you feel ?Merry&#39;s hands trail gently up your thighs and his warm, wet mouth closes around your ?dick. He begins to expertly suck you off, his movements full of confidence.?nl

    After some minutes of ?Merry&#39;s expert blowjob skills, you find yourself building to your peak and you spill yourself inside his mouth. He swallows your cum with pleasure, and grins at you with his winning smile.

    &lt;&lt;merry&gt;&gt;I think you enjoyed that, darling.&lt;&lt;/merry&gt;&gt;

    &lt;&lt;player&gt;&gt;Mmmf, uh, yes, you know how to use your mouth...&lt;&lt;/player&gt;&gt;

    ?Merry rises and flops onto the couch, languidly kissing your bare thigh. ?Orson gives you another long kiss and smiles at you, leaning back to relax on the couch. There are a few moments of comfortable silence as the three of you come down from your orgasms.

    &lt;&lt;merry&gt;&gt;I must say, I&#39;ve never met such wonderful fans before. You two really are lovely. In fact, I think I might be fans of yours now! Shall we have that fruit?&lt;&lt;/merry&gt;&gt;

    You and ?Orson share the platter of food with ?Merry, chatting idly for some time before eventually it grows late and sleep beckons. You re-dress and part ways with ?Merry, leaving the tavern into the cool night air.
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Walk back to the castle&#39; &#39;Orson Date 2 Threesome Walk Back&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="297" name="Orson Date 2 Threesome Walk Back" tags="" position="850,3725" size="100,100">&lt;&lt;setlocation &#39;Road&#39;&gt;&gt;

You and ?Orson set out onto the road for the castle. You feel the tiredness settling in after all the excitement.

&lt;&lt;orson&gt;&gt;?Player, that was simply...amazing. You have given me an unforgettable night.&lt;&lt;/orson&gt;&gt;

&lt;&lt;player&gt;&gt;S-so have you, ?Orson. I didn&#39;t, uh, expect to do what we did, but I really enjoyed it.&lt;&lt;/player&gt;&gt;

?Orson smiles at you.

&lt;&lt;orson&gt;&gt;Neither did I, but it was great fun.&lt;&lt;/orson&gt;&gt;

You walk back up to the castle together, sharing a final kiss before parting ways for the night.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Sneak into your bedroom and remove your disguise&#39; &#39;Bedtime&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="298" name="Pepper" tags="" position="975,3725" size="100,100">&lt;&lt;if hasQuest(&#39;rosa-date-3-chef&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Ask ?ChefPepper if he wants to help with your date&#39; &#39;Rosa Date 3 Get Chef&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Check in on ?ChefPepper&#39; &#39;Pepper Ask About Job&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="299" name="Pepper Ask About Job" tags="" position="1100,3725" size="100,100">You wander into the cookroom to see ?ChefPepper practically twirling through the room, as usual creating a dozen dishes at once with perfect ease. He looks over at you as you enter, giving you a bright smile.

&lt;&lt;pepper&gt;&gt;Well, hello, there, ?newname! Can I help you with anything?&lt;&lt;/pepper&gt;&gt;

You glance at the casually gourmet dishes ?ChefPepper is assembling, and before you can stop yourself, you blurt out a question.

&lt;&lt;player&gt;&gt;Why is it that you work here, and not at the castle?&lt;&lt;/player&gt;&gt;

He dumps out a huge mountain of dough and begins to knead it, the muscles in his arms noticeably rippling. He gives you a confused look.

&lt;&lt;pepper&gt;&gt;Well, deary, I&#39;m not sure what you mean.&lt;&lt;/pepper&gt;&gt;

&lt;&lt;player&gt;&gt;Oh, I just mean, um, that your cooking is so exquisite, surely you could be working at the castle if you wanted to?&lt;&lt;/player&gt;&gt;

He chuckles at your statement, beginning to cut off pieces of dough and shape them into loaves.

&lt;&lt;pepper&gt;&gt;Oh, I&#39;ve been asked before! I always turn it down. I just think my home-cooking is most appropriate for the tavern, you know.&lt;&lt;/pepper&gt;&gt;

As he says this, he adds a careful streak of sauce to the edge of a perfectly prepared platter of food, its presentation visibly fancier than most of the food you&#39;ve seen at royal banquets.

&lt;&lt;pepper&gt;&gt;Not to mention that I never quite mastered bread. ?Rosa&#39;s is by far the best in town, as I&#39;m sure you know.&lt;&lt;/pepper&gt;&gt;

He gives you a wink that you might just interpret as flirty. &lt;&lt;if hasCompletedQuest(&#39;rosa-date&#39;)&gt;&gt;You wonder wildly whether he&#39;s referring to something else of ?Rosa&#39;s that you might know about...&lt;&lt;/if&gt;&gt; 

&lt;&lt;player&gt;&gt;Y-yes, well, I suppose that not everyone wants to work in the castle.&lt;&lt;/player&gt;&gt;

&lt;&lt;pepper&gt;&gt;It seems not, deary.&lt;&lt;/pepper&gt;&gt;

He gives you a knowing look, and you realize that he&#39;s not incorrect. You have to admit that a part of you was thrilled at the chance to experience life away from the castle. You thank him for his time and wander back into the tavern, pondering his words.

&lt;&lt;decision &#39;Leave the cookroom&#39; &#39;Tavern&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="300" name="Rosa" tags="" position="1225,3725" size="100,100">&lt;&lt;if hasQuest(&#39;rosa-date&#39;) and getTime() === &#39;noon&#39;&gt;&gt;
    &lt;&lt;decision &#39;Go with ?Rosa to the forest&#39; &#39;Rosa Start Date&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;elseif hasTag(&#39;rosa-pink-flower&#39;) and hasTag(&#39;rosa-blue-flower&#39;) and hasTag(&#39;rosa-purple-flower&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Give ?Rosa the flowers you collected&#39; &#39;Rosa Give Flowers 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;elseif hasQuest(&#39;rosa-flowers&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Ask ?Rosa to remind you about her favorite flowers&#39; &#39;Rosa Remind About Flowers&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;elseif isQuestUnstarted(&#39;rosa-date-2&#39;) and hasCompletedQuest(&#39;rosa-flowers&#39;) and hasCompletedQuest(&#39;sybille-tavern&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Ask ?Rosa on another date&#39; &#39;Rosa Ask Date 2&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;elseif hasQuest(&#39;rosa-date-2&#39;) and getTime() === &#39;evening&#39;&gt;&gt;
    &lt;&lt;decision &#39;Ask ?Rosa to go with you to the tavern&#39; &#39;Rosa Start Date 2&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;elseif hasQuest(&#39;rosa-give-pendant&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Give ?Rosa the pendant&#39; &#39;Rosa Give Pendant&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;elseif hasQuest(&#39;rosa-date-3&#39;) and getTime() === &#39;evening&#39;&gt;&gt;
    &lt;&lt;decision &#39;Go on your dinner date with ?Rosa&#39; &#39;Rosa Start Date 3&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;You see ?Rosa working in the kitchen&#39; &#39;Rosa Ask&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasQuest(&#39;find-poet&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Ask ?Rosa about the anonymous poems&#39; &#39;Orson Poems Ask Rosa&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasTag(&#39;ask-about-cat-food&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Ask ?Rosa about cat food&#39; &#39;Rosa Get Cat Food&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasCompletedQuest(&#39;rosa-date-2&#39;) and !hasCounter(&#39;rosa-intimacy&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Sneak away with ?Rosa for some alone time&#39; &#39;Rosa Intimacy Kitchen&#39;&gt;&gt;&lt;&lt;disableif isInChastity()&gt;&gt;You are locked in chastity.&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="301" name="Rosa Acknowledgement" tags="" position="100,3850" size="100,100">&lt;&lt;acknowledgement Rosa&gt;&gt;
    &lt;&lt;mention assassination&gt;&gt;
        &lt;&lt;rosa&gt;&gt;I am so happy you&#39;re well, ?title! I got so scared when I heard the news about the assassin.&lt;&lt;/rosa&gt;&gt;
        &lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;
            &lt;&lt;rosa&gt;&gt;I even heard how you bravely fought off the offender, you are so heroic, m&#39;lord!&lt;&lt;/rosa&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;mention status&gt;&gt;
        &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
            &lt;&lt;rosa&gt;&gt;Are you looking different today, M&#39;lord? I don&#39;t know what it is but I&#39;m loving your look now, M&#39;lord!&lt;&lt;/rosa&gt;&gt;
        &lt;&lt;elseif face() is &#39;andro&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;fem&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;man&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
&lt;&lt;/acknowledgement&gt;&gt;</tw-passagedata><tw-passagedata pid="302" name="Rosa Ask" tags="" position="225,3850" size="100,100">You see ?Rosa working in the kitchen, cooking some food.
&lt;&lt;first&gt;&gt;
    &lt;&lt;rosa&gt;&gt;Hello M&#39;lord, come to check on the kitchen? If your highness is bored, I could use a hand preparing the potatoes.&lt;&lt;/rosa&gt;&gt;
    She looks at you, waiting for your response. Accepting the request feels strange for a prince but denying her feels rude.
&lt;&lt;finally&gt;&gt;
    &lt;&lt;rosa&gt;&gt;Hello M&#39;lord, welcome back. Should your highness be in a very gracious mood, I could use a hand again.&lt;&lt;/rosa&gt;&gt;
    She looks at you, waiting for your response. Normally it&#39;s quite unusual for one of the staff to ask you for help, but this isn&#39;t the first time ?Rosa has done this.
&lt;&lt;/first&gt;&gt;
&lt;&lt;include &#39;Rosa Acknowledgement&#39;&gt;&gt;
&lt;&lt;if not hasTag(&#39;rosa-humiliated&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Help her with the food&#39; &#39;Rosa Potato Peeling&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;elseif getStat(&#39;femininity&#39;) &lt; 20&gt;&gt;
    &lt;&lt;decision &#39;Help her with the food&#39; &#39;Rosa Apron&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Put on your apron and get to work&#39; &#39;Rosa Help&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &quot;Remind her that she&#39;s here to serve you, not the other way around&quot; dominance medium&gt;&gt;
    &lt;&lt;addcounter &#39;rosa-kitchen&#39; 1&gt;&gt;
    You have a serious tone as you reply to her.
    &lt;&lt;player&gt;&gt;?Rosa, you can&#39;t ask me to help you with such menial tasks, you should know this.&lt;&lt;/player&gt;&gt;
    &lt;&lt;rosa&gt;&gt;Of course, your highness. I meant nothing by it, I was just wondering if you were looking for something to pass the time.&lt;&lt;/rosa&gt;&gt; She continues peeling the potatoes on her own.
    &lt;&lt;decision &quot;Nod to her and take your leave&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="303" name="Rosa Potato Peeling" tags="" position="350,3850" size="100,100">&lt;&lt;addcounter &#39;rosa-kitchen&#39; 1&gt;&gt;
&lt;&lt;first&gt;&gt;
    You are a bit reluctant to help her, but decide to step to the kitchen table. She notices your doubtfulness.
    &lt;&lt;rosa&gt;&gt;It&#39;s fine, M&#39;lord, I&#39;ll show you how to peel the potatoes.&lt;&lt;/rosa&gt;&gt; 
    She hands you a knife and a potato. She shows you how to properly cut the skin off and wash it.?nl
&lt;&lt;finally&gt;&gt;
    You reluctantly help her once more.
    &lt;&lt;rosa&gt;&gt;Here, M&#39;lord, let&#39;s peel the potatoes again.&lt;&lt;/rosa&gt;&gt; She says as she hands you a knife and a potato.?nl
&lt;&lt;/first&gt;&gt;
You struggle a bit with cutting them quickly, there&#39;s so many of them and you&#39;re not used to doing work like this. ?Rosa sees you struggling, she moves behind you and grabs the knife with your hands and helps you peel them more efficiently. With her standing so close, you enjoy the smell of her blonde hair before she moves away to let you continue peeling.
&lt;&lt;rosa&gt;&gt;Just like that, M&#39;lord, you&#39;re doing great.&lt;&lt;/rosa&gt;&gt;
After a quite some time of peeling potatoes, you managed to finish an entire batch of them.
&lt;&lt;rosa&gt;&gt;Thank you for the help M&#39;lord, if you&#39;re ever in the mood to help out again and would like to learn more about the kitchen work, come by again.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;decision &quot;Tell her you liked it and you&#39;re more than happy to help out again&quot; submissiveness medium&gt;&gt;
    &lt;&lt;addtag &#39;rosa-humiliated&#39;&gt;&gt; 
    An excited smile forms on her face.
    &lt;&lt;rosa&gt;&gt;Yay! I will teach you to how to be a great kitchen maid, M&#39;lord!&lt;&lt;/rosa&gt;&gt;
    You blush from her statement and she looks a bit embarrassed that she blurted that out.
    &lt;&lt;rosa&gt;&gt;Great kitchen &lt;em&gt;helper&lt;/em&gt;, I meant, M&#39;lord!&lt;&lt;/rosa&gt;&gt;
    She quickly darts away to continue with her tasks.
    &lt;&lt;decision &quot;Leave the kitchen&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Nod to her and take your leave&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="304" name="Rosa Apron" tags="" position="475,3850" size="100,100">&lt;&lt;rosa&gt;&gt;Thank you, M&#39;lord! You&#39;re quite eager to do some kitchen work, aren&#39;t you?&lt;&lt;/rosa&gt;&gt;
She gives a slight laugh and smiles at you.
&lt;&lt;rosa&gt;&gt;First things first, let&#39;s get you some proper attire now. We don&#39;t want your beautiful clothes to get dirty, now do we?&lt;&lt;/rosa&gt;&gt;
She hands you an apron, you notice it looks rather feminine. 

&lt;&lt;decision &#39;Wear the apron&#39; &#39;Rosa Help&#39; submissiveness medium&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Decline the apron&quot;&gt;&gt;
    &lt;&lt;player&gt;&gt;I can&#39;t wear this! This is much too feminine!&lt;&lt;/player&gt;&gt; You say to her with a serious tone.
    &lt;&lt;rosa&gt;&gt;Of course, your highness. I&#39;m afraid I don&#39;t have anything more &#39;manly&#39; and I wouldn&#39;t want your clothes to get dirty. It&#39;s fine, I&#39;ll do the work myself.&lt;&lt;/rosa&gt;&gt; She looks slightly disappointed.
    &lt;&lt;decision &quot;Take your leave&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="305" name="Rosa Help" tags="" position="600,3850" size="100,100">&lt;&lt;addcounter &#39;rosa-kitchen&#39; 1&gt;&gt;
You spend some time helping in the kitchen. She is very grateful to you.
&lt;&lt;if getStat(&#39;femininity&#39;) &gt;= 10 and getStat(&#39;femininity&#39;) &lt; 20&gt;&gt;
    &lt;&lt;rosa&gt;&gt;Thank you, my prince. I must say I am surprised you are so keen to do a woman&#39;s work, it&#39;s refreshing to spend time with not such a &#39;manly&#39; man for once, if you get what I mean.&lt;&lt;/rosa&gt;&gt;
    She smiles at you. You know she meant it in a friendly way but it feels a bit strange.
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &quot;Leave&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="306" name="Rosa Knocks" tags="" position="725,3850" size="100,100">Before you can get out of bed, you hear a gentle knock on the door and ?Rosa&#39;s voice calling softly from the other side. 

&lt;&lt;rosa&gt;&gt;M&#39;lord, are you awake? I&#39;ve brought you your breakfast!&lt;&lt;/rosa&gt;&gt;

Reflexively, you pull the covers up to cover your body. ?Rosa doesn&#39;t usually bring you breakfast in bed. Why is she doing so now?

&lt;&lt;decision &#39;Invite her in&#39; &#39;Rosa Brings Breakfast&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Stay quiet and hope that she goes away&#39; &#39;Rosa Goes Away Sub&#39; submissiveness small&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Order her to leave you&#39; &#39;Rosa Goes Away Dom&#39; dominance small&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="307" name="Rosa Goes Away Sub" tags="" position="850,3850" size="100,100">&lt;&lt;addevent wake &#39;Rosa Knocks&#39;&gt;&gt;&lt;&lt;delay 3&gt;&gt;&lt;&lt;/addevent&gt;&gt;

You hold your breath silently, waiting for ?Rosa to go away. After a few moment, you hear a small disappointed sigh and the sound of soft footsteps retreating back into the castle.

&lt;&lt;decision &#39;Get up&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="308" name="Rosa Goes Away Dom" tags="" position="975,3850" size="100,100">&lt;&lt;addevent wake &#39;Rosa Knocks&#39;&gt;&gt;&lt;&lt;delay 3&gt;&gt;&lt;&lt;/addevent&gt;&gt;

?Rosa should know better than to bring you your breakfast in such a personal way without instruction from you. You speak loudly so that she can hear you through the door.

&lt;&lt;player&gt;&gt;This behavior is unbefitting of someone of your station, ?Rosa. I will take my breakfast in the dining hall as usual. Leave me, and do not do this again.&lt;&lt;/player&gt;&gt;

You hear a muffled sniff from the other side of the door.

&lt;&lt;rosa&gt;&gt;Yes, m&#39;lord, I apologize for my behavior.&lt;&lt;/rosa&gt;&gt;

After a moment, you hear hurried footsteps as ?Rosa retreats back into the castle.

&lt;&lt;decision &#39;Get up&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="309" name="Rosa Brings Breakfast" tags="" position="1100,3850" size="100,100">&lt;&lt;startquest rosa-bouquet&gt;&gt;

At your invitation, ?Rosa opens the door carefully, balancing a tray on one hand. She closes the door again and approaches you, setting the tray down in your lap with a smile.

&lt;&lt;rosa&gt;&gt;Good morning, m&#39;lord! I made you a special breakfast today. I hope you enjoy it.&lt;&lt;/rosa&gt;&gt;

On the tray, you see a feast. There are warm pastries and bread, a crock of creamy yellow butter, eggs, fresh fruits, a variety of cheeses and meats, porridge, and herbed potatoes. A single flower in a tiny vase decorates the tray.?nl

This breakfast is extravagant, even for a royal standard. You wonder at how ?Rosa even managed to fit it all on the tray.

&lt;&lt;player&gt;&gt;It would be hard not to enjoy such an assortment, ?Rosa. But why have you brought me this?&lt;&lt;/player&gt;&gt;

You swear you see a slight blush on ?Rosa&#39;s cheeks as she looks down, averting your gaze.

&lt;&lt;rosa&gt;&gt;No reason, m&#39;lord, I just thought that you would appreciate it.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    ?Rosa is obviously holding something back. Is she doing this because she feels bad about seeing you in the maid outfit? She must be. Nothing else could explain this sudden change in behavior.
&lt;&lt;else&gt;&gt;
    ?Rosa is obviously holding something back. You think back to the past few days, trying to remember if anything happened that would warrant such behavior. Perhaps she heard of how you snuck out of the castle with ?Morgana?
&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Well, I do appreciate it, very much. This looks delicious. Thank you, ?Rosa.&lt;&lt;/player&gt;&gt;

?Rosa looks up and meets your gaze for just a moment. She gives you another sweet smile and looks down again quickly.

&lt;&lt;rosa&gt;&gt;I must return to my work now, m&#39;lord. As you know, I&#39;m always in the kitchen, if you need me.&lt;&lt;/rosa&gt;&gt;

?Rosa makes her way back out of the room. As she&#39;s leaving, you catch sight of her face one last time and see that her cheeks are definitely rosy now.?nl

You devour the breakfast. It is indeed delicious, and a pleasant change of pace to enjoy in the privacy of your own room before tackling the duties of the day. As you set down the tray, the flower ?Rosa placed there catches your eye.?nl

Perhaps you could return the favor by bringing her flowers from the garden.

&lt;&lt;decision &#39;Get up&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="310" name="Rosa Pick Flowers" tags="" position="1225,3850" size="100,100">While strolling through the garden, you notice how many fragrant, colorful flowers are growing here. The beauty of the flowers reminds you of ?Rosa and how she so thoughtfully brought you breakfast. 
&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    Even if she only brought you the food because she felt bad for seeing you in the maid outfit, it was still a sweet gesture.
&lt;&lt;/if&gt;&gt;
Perhaps you could pick her a bouquet to show your appreciation.

&lt;&lt;decision &#39;Make your best bouquet and take them to ?Rosa&#39; &#39;Rosa Make Bouquet&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Do this another time&#39; &#39;Garden&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;

/* :: Rosa Rejected

&lt;&lt;removetag rosa-bouquet&gt;&gt;

Giving ?Rosa a bouquet is a nice idea, but you don&#39;t want her to get the wrong impression about your relationship. After all, she is a kitchen maid and you are a prince. Giving her such a gift would be improper. 

&lt;&lt;decision &#39;Continue your walk through the garden&#39; &#39;Garden&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt; */</tw-passagedata><tw-passagedata pid="311" name="Rosa Make Bouquet" tags="" position="100,3975" size="100,100">You start to pick some flowers, realizing quickly that creating a bouquet is more difficult than you expected. There seems to be some secret combination of colors, shapes, and heights that florists must know, because the bundle of flowers you&#39;re making looks nothing like those you see at royal events.?nl

Still, the flowers in soft shades of pink and blue remind you of ?Rosa, so you focus on collecting those into your best attempt at a bouquet. The result is rustic, but pretty and sweet-smelling.

&lt;&lt;decision &#39;Bring the flowers to ?Rosa&#39; &#39;Rosa Give Flowers&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="312" name="Rosa Give Flowers" tags="" position="225,3975" size="100,100">&lt;&lt;setlocation &#39;Kitchen&#39;&gt;&gt;
&lt;&lt;completequest rosa-bouquet&gt;&gt;

When you enter the kitchen, ?Rosa is chopping vegetables while a stew bubbles in a large pot. She looks up as you enter.

&lt;&lt;rosa&gt;&gt;Hello, m&#39;lord! My, what lovely flowers you have there.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;These are actually for you.&lt;&lt;/player&gt;&gt;

?Rosa looks surprised, but then breaks into a bright smile. 

&lt;&lt;rosa&gt;&gt;For me, m&#39;lord? Goodness, how thoughtful of you!&lt;&lt;/rosa&gt;&gt;

She accepts the bouquet and fetches a clay jug to place them in. They look cheerful on the wooden table.?nl

&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    While ?Rosa is arranging the flowers, the supply closet where you changed into the maid uniform catches your eye. You remember how ?Rosa walked in on you. She seems to be pretending that none of that happened. You don&#39;t think she would tell anyone; she&#39;s always been so nice, after all. But what if she did??nl

    Seeing your face, ?Rosa seems to guess what you&#39;re thinking about.

    &lt;&lt;rosa&gt;&gt;M&#39;lord, I must assure you that I saw nothing! While I must say that the new maid I saw in the kitchen looked quite lovely, I have no idea who she was. I swear on it!&lt;&lt;/rosa&gt;&gt;

    &lt;&lt;player&gt;&gt;Wait- you thought I looked nice?&lt;&lt;/player&gt;&gt;
    
    ?Rosa gives a small chuckle.

    &lt;&lt;rosa&gt;&gt;Well, yes, of course! You looked very cute.&lt;&lt;/rosa&gt;&gt;

    &lt;&lt;player&gt;&gt;Oh- well, thank you, I suppose.&lt;&lt;/player&gt;&gt;
&lt;&lt;/if&gt;&gt;

?Rosa smiles at you. You realize that she is one of the few people in the castle who expects nothing from you, and yet she has always been so kind. It seems as though she simply enjoys your presence, regardless of your station.

&lt;&lt;decision &#39;Ask her on a date&#39; &#39;Rosa Ask Date&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Thank ?Rosa again and take your leave&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Rosa Knocks&#39;&gt;&gt;&lt;&lt;delay 14&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;player&gt;&gt;I must take my leave now. Thank you again for the delicious breakfast.&lt;&lt;/player&gt;&gt;
    &lt;&lt;rosa&gt;&gt;Of course, m&#39;lord. I&#39;m sure you have many important tasks to attend to.&lt;&lt;/rosa&gt;&gt;
    &lt;&lt;decision &#39;Leave the kitchen&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="313" name="Rosa Ask Date" tags="" position="350,3975" size="100,100">&lt;&lt;player&gt;&gt;I was wondering, ?Rosa, whether you might like to spend a little time together, away from the castle?&lt;&lt;/player&gt;&gt;

?Rosa looks surprised, but happy at the suggestion. 

&lt;&lt;rosa&gt;&gt;Oh my goodness, m&#39;lord, that would be lovely! What do you have in mind?&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;Perhaps we could go to the forest one afternoon. I felt free there, away from expectations.&lt;&lt;/player&gt;&gt;

&lt;&lt;rosa&gt;&gt;That sounds wonderful. You know, there&#39;s a beautiful waterfall in the forest. We could go there. I&#39;ll pack us some sandwiches!&lt;&lt;/rosa&gt;&gt;

You&#39;re surprised at how smoothly this is going. ?Rosa doesn&#39;t seem to think your suggestion is strange at all. She just looks excited.

&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    &lt;&lt;rosa&gt;&gt;You can wear your new outfit you looked so cute in!&lt;&lt;/rosa&gt;&gt;
    &lt;&lt;player&gt;&gt;I- well, I suppose that makes sense. Yes.&lt;&lt;/player&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;rosa&gt;&gt;I wonder though, won&#39;t the guards stop you from going out the castle, m&#39;lord?&lt;&lt;/rosa&gt;&gt;
    &lt;&lt;player&gt;&gt;Yes, they would. But luckily, ?Morgana has thought of a solution to that for me, I&#39;ll be wearing a disguise to sneak out.&lt;&lt;/player&gt;&gt;
    She looks at you with a certain kind of awe.
    &lt;&lt;rosa&gt;&gt;How exciting, m&#39;lord!&lt;&lt;/rosa&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;rosa&gt;&gt;I&#39;ll put together a nice basket for us. As usual, I&#39;ll be here when you&#39;re ready to go.&lt;&lt;/rosa&gt;&gt;

?Rosa smiles at you and returns to chopping vegetables, humming a cheerful tune.

&lt;&lt;decision &#39;Leave the kitchen&#39; &#39;Hallway&#39;&gt;&gt;
    &lt;&lt;startquest rosa-date&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="314" name="Rosa Start Date" tags="" position="475,3975" size="100,100">&lt;&lt;completequest rosa-date&gt;&gt;

When you find ?Rosa, she is finishing packing a large picnic basket. She looks pretty even in her work outfit, and seems to have changed her hair for the occasion into two long braids woven with pink and blue flowers. You realize they must be from your bouquet.

&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    &lt;&lt;rosa&gt;&gt;Once you change into your outfit, we&#39;ll be ready to go, m&#39;lord!&lt;&lt;/rosa&gt;&gt;
    &lt;&lt;player&gt;&gt;Uh, yes, of course. Just give me a moment.&lt;&lt;/player&gt;&gt;
    &lt;&lt;decision &#39;Change into the maid outfit in the supply closet&#39;&gt;&gt;
        &lt;&lt;outfit disguise&gt;&gt;
        ?Rosa smiles at you as you emerge from the supply closet.
        &lt;&lt;rosa&gt;&gt;You look just as cute as last time! Shall we?&lt;&lt;/rosa&gt;&gt;
        You and ?Rosa leave the castle together. It feels strange to walk past the guards as two kitchen maids, but they pay you no notice. 
        &lt;&lt;decision &#39;Walk to the forest&#39; &#39;Rosa Date Forest&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt; 
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;rosa&gt;&gt;I&#39;m ready to go, m&#39;lord. It looks like you still have to put on your disguise though!&lt;&lt;/rosa&gt;&gt;
    &lt;&lt;player&gt;&gt;Of course, give me a moment.&lt;&lt;/player&gt;&gt;
    &lt;&lt;decision &#39;Change into the disguise in the supply closet&#39;&gt;&gt;
         &lt;&lt;outfit disguise&gt;&gt;
        ?Rosa smiles at you as you emerge from the supply closet.
        &lt;&lt;rosa&gt;&gt;You&#39;re looking quite dapper, m&#39;lord! Shall we?&lt;&lt;/rosa&gt;&gt;
        You and ?Rosa leave the castle together. It feels strange to walk past the guards as two servants, but they pay you no notice. 
        &lt;&lt;decision &#39;Walk to the forest&#39; &#39;Rosa Date Forest&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt; 
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="315" name="Rosa Date Forest" tags="" position="600,3975" size="100,100">&lt;&lt;setlocation &#39;Waterfall&#39;&gt;&gt;

&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    As you walk through the meadow and into the forest, ?Rosa throws you a quick, encouraging glance.
    &lt;&lt;rosa&gt;&gt;I just wanted to say, m&#39;lord, that I think it&#39;s nice that you&#39;re doing this. Wearing the outfit, I mean.&lt;&lt;/rosa&gt;&gt;
    You&#39;re not sure how to respond to this, but she looks like she&#39;s waiting for you to say something.
    &lt;&lt;player&gt;&gt;Well, thank you for saying so, ?Rosa.&lt;&lt;/player&gt;&gt;
&lt;&lt;/if&gt;&gt;

You and ?Rosa chat idly as you walk together to the waterfall. When you arrive, you lay out a blanket together and sit down, watching the water cascading from the falls.

&lt;&lt;rosa&gt;&gt;I&#39;m happy that you asked me here, m&#39;lord.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;I&#39;m happy that you came, ?Rosa. Why don&#39;t you call me by my name, since no one is watching us here?&lt;&lt;/player&gt;&gt;

?Rosa laughs, her eyes crinkling adorably at the edges.

&lt;&lt;rosa&gt;&gt;Of course, ?player. It feels funny, but I like saying your name.&lt;&lt;/rosa&gt;&gt;

She meets your eyes, a smile playing on her lips. You can&#39;t help but smile back.

&lt;&lt;rosa&gt;&gt;Are you hungry after our walk?&lt;&lt;/rosa&gt;&gt;

She opens the picnic basket and pulls out a spread of picnic foods. There are the promised sandwiches, but also fresh fruit, salads, pastries, and a jug of wine.

&lt;&lt;player&gt;&gt;?Rosa, you didn&#39;t have to bring so much food for just the two of us!&lt;&lt;/player&gt;&gt;

&lt;&lt;rosa&gt;&gt;I know, ?player, I just like to take care of you, is all.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;decision &#39;Enjoy the food and drink&#39; &#39;Rosa Date Forest 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="316" name="Rosa Date Forest 2" tags="" position="725,3975" size="100,100">You enjoy a long, slow lunch together, chatting and laughing about any topic that comes to mind. After what must have been hours, you feel comfortably full and slightly tipsy as you lie back on the blanket. ?Rosa joins you, her cheeks pink from the wine, staring up at the canopy above.

&lt;&lt;rosa&gt;&gt;I&#39;m so happy right now, ?player. I wish I could stay here forever.&lt;&lt;/rosa&gt;&gt;

She twirls a finger absent-mindedly through your hair. The sudden contact surprises you, but you can&#39;t help but relax into it. For a few moments, you lie in comfortable silence.

&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    &lt;&lt;player&gt;&gt;Do you really believe I look good in the maid outfit, ?Rosa?&lt;&lt;/player&gt;&gt;
    She continues to play with your hair, a soft smile on her face.
    &lt;&lt;rosa&gt;&gt;I really do, ?player. I would be happy if you wore it every day.&lt;&lt;/rosa&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;player&gt;&gt;Do you really not care that I&#39;m a prince, ?Rosa?&lt;&lt;/player&gt;&gt;
    She continues to play with your hair, a soft smile on her face.
    &lt;&lt;rosa&gt;&gt;I care not for titles, ?player. I simply enjoy you and your company.&lt;&lt;/rosa&gt;&gt;
&lt;&lt;/if&gt;&gt;

You reach a hand up to cover hers, and feel her soft, warm skin beneath yours. Still smiling, her eyes meet yours.

&lt;&lt;decision &#39;Lean in for a kiss&#39; &#39;Rosa Kiss&#39;&gt;&gt;&lt;&lt;decisionicon romance&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Allow the moment to pass&#39; &#39;Rosa End Date&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="317" name="Rosa Kiss" tags="" position="850,3975" size="100,100">You lean in for a kiss and feel ?Rosa&#39;s soft lips meet yours, her fingers still tangled in your hair. She kisses you back slowly and deliberately, as though she is savoring every moment. When you pull away for air, she is smiling again. 

&lt;&lt;rosa&gt;&gt;Oh, ?player, how I&#39;ve wanted to do that for so long.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;You- really?&lt;&lt;/player&gt;&gt;

&lt;&lt;rosa&gt;&gt;I think I was hiding it, even from myself. But I have.&lt;&lt;/rosa&gt;&gt;

You kiss her again, this time even more deeply, desire growing in your chest. She moves closer to you and the smell of her hair fills your nose. When you pull apart again, she looks a little flustered.

&lt;&lt;rosa&gt;&gt;I can&#39;t believe I get to do this with you, ?player. I don&#39;t want to move too fast now that it&#39;s really happening.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;Let&#39;s just do this today, then?&lt;&lt;/player&gt;&gt;

Looking reassured, she leans back in for another kiss. You stay this way, sharing kisses, until the light starts to dim and you realize it is time to head back to the castle. You pack up the remainder of the picnic and walk back together, sharing sweet conversation. You share a final, secret kiss before ?Rosa returns to her work in the kitchen.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Change out of your disguise and part ways with ?Rosa&#39; &#39;Hallway&#39;&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
    &lt;&lt;outfit standard&gt;&gt;
    &lt;&lt;addevent wake &#39;Rosa Brings Breakfast 2&#39;&gt;&gt;&lt;&lt;delay 3&gt;&gt;&lt;&lt;/addevent&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="318" name="Rosa End Date" tags="" position="975,3975" size="100,100">After a moment, you remove your hand. ?Rosa looks away and withdraws her own hand from your hair. For a few moments, you both watch the leaves above gently swaying in the breeze. 

&lt;&lt;player&gt;&gt;It will be getting dark soon. Perhaps we should make our way back to the castle now.&lt;&lt;/player&gt;&gt;

?Rosa nods, looking disappointed. 

&lt;&lt;rosa&gt;&gt;Yes, of course, m&#39;lord. Allow me to pack up.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Head back to the castle&#39;&gt;&gt;
    ?Rosa packs up the remainders of the picnic and you walk back to the castle together, the conversation more awkward than before.
    &lt;&lt;decision &#39;Change out of your disguise and part ways with ?Rosa&#39; &#39;Hallway&#39;&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        &lt;&lt;outfit standard&gt;&gt;
        &lt;&lt;addevent wake &#39;Rosa Brings Breakfast 2&#39;&gt;&gt;&lt;&lt;delay 3&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="319" name="Rosa Brings Breakfast 2" tags="" position="1100,3975" size="100,100">Before you can get out of bed, you hear a soft knock on the door and ?Rosa&#39;s voice from the other side.

&lt;&lt;rosa&gt;&gt;Are you awake, m&#39;lord? I&#39;ve brought you your breakfast again!&lt;&lt;/rosa&gt;&gt;

You quickly sit upright in bed and do your best to fix your hair. 

&lt;&lt;player&gt;&gt;Come in, ?Rosa!&lt;&lt;/player&gt;&gt;

She brings a tray into the room, shutting the door behind herself, and places it carefully on your lap. You see yet again a luxurious array of breakfast foods, plus a small bouquet in a tiny pot. You notice that the crock of butter has a small image of a flower drawn in it.

&lt;&lt;player&gt;&gt;This looks absolutely wonderful, ?Rosa. I am grateful for all the time you must have put into this meal.&lt;&lt;/player&gt;&gt;

She gives you a cheerful smile. 

&lt;&lt;rosa&gt;&gt;I woke up early to get started on the pastries, and to pick the flowers! Did you know that the best time to pick flowers is early in the morning, once the dew has dried?&lt;&lt;/rosa&gt;&gt;

You feel a flutter in your stomach as she looks at you, and you remember the feeling of her lips on yours... But you also remember her asking not to move too fast, so you try to focus on the conversation.

&lt;&lt;player&gt;&gt;It seems like you have a special appreciation for flowers.&lt;&lt;/player&gt;&gt;

&lt;&lt;rosa&gt;&gt;Oh, I do, they&#39;re just so beautiful, aren&#39;t they? I know most of the flowers that grow in this area. As a girl I would spend hours in the forest looking for the rarest blooms...&lt;&lt;/rosa&gt;&gt;

She looks into the distance wistfully. This gives you an idea. Perhaps to show your appreciation to ?Rosa, you could bring her some of those rare flowers.

&lt;&lt;player&gt;&gt;That sounds lovely. Which were your favorites, may I ask?&lt;&lt;/player&gt;&gt;

She looks thrilled to be asked about this topic. 

&lt;&lt;rosa&gt;&gt;Goodness, what a difficult choice!&lt;&lt;/rosa&gt;&gt;

She pauses, considering the question. Your eyes stray to her hair, and you remember the scent when you were close to her.

&lt;&lt;rosa&gt;&gt;I adore a species of blue flower that grows by the waterfall. They glow in the dark, and if you pick them at night, they keep glowing for days. I also love the pink flowers with heart-shaped petals that grow in the south of the forest.&lt;&lt;/rosa&gt;&gt;

She smiles to herself, clearly thinking back to her adventures as a girl.

&lt;&lt;rosa&gt;&gt;I also used to love the special purple roses that the forest druid ?Hyssop grows. They have the most wonderful smell, though I hear ?Hyssop uses them for dye.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;You seem to know a lot about flowers. Perhaps you could tell me more some time, away from the castle.&lt;&lt;/player&gt;&gt;

?Rosa gives you a bright look. 

&lt;&lt;rosa&gt;&gt;You know I would love that, ?player.&lt;&lt;/rosa&gt;&gt;

There is a brief moment as you look at each other. Subconsciously, you lean in toward her.

&lt;&lt;rosa&gt;&gt;I really must return to my work now, but I hope that you enjoy the breakfast.&lt;&lt;/rosa&gt;&gt;

She looks at though she is about to turn away, but then stops herself. Instead, she leans forward and plants a short but sweet kiss on your cheek. You breath in deeply, the scent of her filling your nose. She pulls away, blushing.

&lt;&lt;rosa&gt;&gt;I&#39;ll see you later, then.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;You can count on it, ?Rosa.&lt;&lt;/player&gt;&gt;

She smiles at you, then turns and scurries out of the chamber.

&lt;&lt;decision &#39;Get up&#39; &#39;Morning&#39;&gt;&gt;
    &lt;&lt;startquest rosa-flowers&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="320" name="Rosa Remind About Flowers" tags="" position="1225,3975" size="100,100">You find ?Rosa rolling out a large amount of pie dough. She looks up as you enter.

&lt;&lt;rosa&gt;&gt;Hello, there, m&#39;lord! Can I help you with anything?&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;Yes, actually. I was wondering if you could tell me again about your favorite flowers.&lt;&lt;/player&gt;&gt;

She puts down her rolling pin, looking confused. 

&lt;&lt;rosa&gt;&gt;Well, there are the blue flowers that grow by the waterfall. They&#39;re the ones that glow when you pick them in darkness. Then there are the pink ones with heart-shaped petals that grow in the south of the forest, and the purple roses that ?Hyssop cultivates.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;Thank you, that&#39;s all I needd to know...&lt;&lt;/player&gt;&gt;

?Rosa narrows her eyes at you for a moment and then gives you an amused expression. 

&lt;&lt;rosa&gt;&gt;I&#39;m sure there&#39;s no reason at all why you&#39;re asking.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;None at all!&lt;&lt;/player&gt;&gt;

She chuckles and continues rolling out her pie dough. 

&lt;&lt;rosa&gt;&gt;Well, I&#39;ll see you later then, m&#39;lord!&lt;&lt;/rosa&gt;&gt;

&lt;&lt;decision &#39;Leave the kitchen&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="321" name="Rosa Find Flower Waterfall" tags="" position="100,4100" size="100,100">&lt;&lt;addtag rosa-blue-flower&gt;&gt;
&lt;&lt;img &quot;rosa/blue_flower.jpg&quot;&gt;&gt;

Though your surroundings are unfamiliar in the dark, you quickly find your way to the waterfall by following the sound of rushing water. As you approach the falls, you immediately see a patch of glowing blue flowers near the water.?nl

You pick a handful of the flowers. Their soft glow illumates the space around you like a candle, making the forest seem less foreboding. You&#39;re sure ?Rosa will love these.

&lt;&lt;decision &#39;Make your way back into the forest&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="322" name="Rosa Find Flower Hyssop" tags="" position="225,4100" size="100,100">&lt;&lt;money &#39;mushrooms&#39; true&gt;&gt;

&lt;&lt;player&gt;&gt;I heard that you grow some very special purple roses.&lt;&lt;/player&gt;&gt;

?Hyssop looks at you with excitement.

&lt;&lt;hyssop&gt;&gt;Ah, my Tyrian Roses? Yes, I bred them specially to use as dye! They also smell lovely. How did you hear about them?&lt;&lt;/hyssop&gt;&gt;

&lt;&lt;player&gt;&gt;Well, ?Rosa mentioned them. I actually was hoping to take a few back for her, since she is such a fan.&lt;&lt;/player&gt;&gt;

?Hyssop looks thrilled that anyone would be interested in their flowers. Thankfully, they also seem completely oblivious to the implications of you bringing ?Rosa flowers.

&lt;&lt;hyssop&gt;&gt;I remember ?Rosa used to come by and ask for my roses! That was before I invented my system of trading my creations for mushrooms. I gave her so many flowers for free!&lt;&lt;/hyssop&gt;&gt;

?Hyssop chuckles cheerfully.

&lt;&lt;player&gt;&gt;I suppose you&#39;ll want some mushrooms, then, in exchange for some of the roses?&lt;&lt;/player&gt;&gt;

&lt;&lt;hyssop&gt;&gt;That would be nice! It saves me so much time when I don&#39;t have to go looking for them myself, after all. I think three hundred would be appropriate?&lt;&lt;/hyssop&gt;&gt;

You stare at ?Hyssop for a moment. Three hundred mushrooms? Where are you ever going to find that many?

&lt;&lt;player&gt;&gt;?Hyssop, that&#39;s ten times more than the outfits you sell! How special are these roses?!&lt;&lt;/player&gt;&gt;

?Hyssop looks thoughtful.

&lt;&lt;hyssop&gt;&gt;Well, I suppose you&#39;re right, ?player. I did used to give them away for free, after all! I&#39;ll give you a discount. You can have a bouquet for just twenty mushrooms!&lt;&lt;/hyssop&gt;&gt;

This still feels like way too many mushrooms for a few flowers, but ?Hyssop seems firm on this point, and you do really want those flowers...

&lt;&lt;if money(&#39;mushrooms&#39;) &gt;= 20&gt;&gt;
    &lt;&lt;decision &#39;Begrudgingly hand over 20 mushrooms&#39;&gt;&gt;
        &lt;&lt;include &#39;Rosa Buy Flower Hyssop&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Come back later to buy the flowers&#39;&gt;&gt;
        &lt;&lt;include &#39;Rosa Find Flower Hyssop Leave&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;include &#39;Rosa Find Flower Hyssop Leave&#39;&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="323" name="Rosa Find Flower Hyssop Leave" tags="" position="350,4100" size="100,100">&lt;&lt;player&gt;&gt;In that case I will come back another time to buy the flowers.&lt;&lt;/player&gt;&gt;

&lt;&lt;hyssop&gt;&gt;That&#39;s no problem! I&#39;ll be waiting here for you when you&#39;re ready.&lt;&lt;/hyssop&gt;&gt;

&lt;&lt;decision &#39;Leave the hut&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="324" name="Rosa Buy Flower Hyssop" tags="" position="475,4100" size="100,100">&lt;&lt;addtag rosa-purple-flower&gt;&gt;
&lt;&lt;img &quot;rosa/purple_flower.jpg&quot;&gt;&gt;

&lt;&lt;changemoney &#39;mushrooms&#39; -20&gt;&gt;

You hand over the mushrooms, wondering if you should have haggled more. ?Hyssop leaves the hut for a moment and returns with a bouquet of undeniably beautiful purple roses. 

&lt;&lt;hyssop&gt;&gt;Here you are! A pleasure doing business with you, ?player! I hope ?Rosa loves them.&lt;&lt;/hyssop&gt;&gt;

&lt;&lt;decision &#39;Thank ?Hyssop and return to the forest&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="325" name="Rosa Find Flower Bandit Camp" tags="" position="600,4100" size="100,100">You sneak toward the bandit camp, doing your best to stick to the shadows. Is this really where ?Rosa was referring to when she mentioned the &quot;south of the forest&quot;? It seems as though she can&#39;t have been speaking about anywhere else, but it&#39;s hard to imagine someone like ?Rosa walking around here.?nl

You creep close enough to hear the sounds of voices and raucous laughter. You pause for a moment, obvserving between the trees. It looks as though most of the camp is currently grouped in a circle, watching and cheering on some kind of competition. You can&#39;t quite make out what, exactly.?nl

Your eyes land on a patch of pink flowers growing near to the edge of the camp. This could be a good moment to collect them, while the bandits are occupied...

&lt;&lt;decision &#39;Sneak forward and collect the flowers&#39; &#39;Rosa Find Flower Bandit Interrupted&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Think better of it and return to the forest&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="326" name="Rosa Find Flower Bandit Interrupted" tags="" position="725,4100" size="100,100">&lt;&lt;addtag rosa-pink-flower&gt;&gt;
&lt;&lt;img &quot;rosa/pink_flower.jpg&quot;&gt;&gt;

You make your way forward carefully and gather a handful of the pink flowers. As the petals brush your hand, their sweet scent fills your nose, reminding you of ?Rosa...

&lt;&lt;bandit&gt;&gt;Well, what do we have here? Are you stealing my flowers?&lt;&lt;/bandit&gt;&gt;

You look around to see the familiar bandit watching you as he leans against a tree. You stumble to your feet, still clutching the flowers.

&lt;&lt;player&gt;&gt;Ah- well, I hardly think this counts as stealing...&lt;&lt;/player&gt;&gt;

The bandit smirks at you, looking you up and down with a suggestive expression.

&lt;&lt;bandit&gt;&gt;You can&#39;t exactly put them back, now, can you? So...what are you going to give me in return?&lt;&lt;/bandit&gt;&gt;

His intentions seem pretty clear at this point, not least because of the bulge growing in his pants. Based on your interactions with him so far, you can only guess that he has some strange attraction to meeting strangers in the woods...?nl

You realize that instead of responding, you have just been staring at the bandit for several seconds. He seems to interpret your silence as confusion.

&lt;&lt;bandit&gt;&gt;What I mean is that you could blow me, if you want. It&#39;s alright if you don&#39;t want to...&lt;&lt;/bandit&gt;&gt;

You almost have to laugh as he says this. He seems to be strangely respectful of your boundaries, especially for a bandit.?nl

You have to admit there&#39;s something exciting about being caught alone in the woods like this... On the other hand, maybe it would be best to get these flowers back to ?Rosa...

&lt;&lt;decision &#39;Get on your knees in front of him&#39; &#39;Bandit Blowjob&#39; depravity large&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Get out of the situation&#39; &#39;Rosa Find Flower Bandit Rejected&#39; virtue large&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="327" name="Rosa Find Flower Bandit Rejected" tags="" position="850,4100" size="100,100">&lt;&lt;player&gt;&gt;I&#39;m not interested. In fact, I&#39;m gathering these flowers for a lovely woman who I am interested in.&lt;&lt;/player&gt;&gt;

The bandit looks disappointed as you say this.

&lt;&lt;bandit&gt;&gt;Oh, I see. I guess I misjudged the situation. I just thought you&#39;d come here to find me...&lt;&lt;/bandit&gt;&gt;

&lt;&lt;player&gt;&gt;I really just came for the flowers.&lt;&lt;/player&gt;&gt;

He stuffs his hands into his pockets and starts walking back towards the camp. He calls back to you as he walks away.

&lt;&lt;bandit&gt;&gt;I&#39;ll be here if you ever change your mind.&lt;&lt;/bandit&gt;&gt;

You watch him go with some bemusement. What a strange man.

&lt;&lt;decision &#39;Sneak away from the camp&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="328" name="Rosa Give Flowers 2" tags="" position="975,4100" size="100,100">&lt;&lt;completequest rosa-flowers&gt;&gt;
&lt;&lt;removetag rosa-pink-flower&gt;&gt;
&lt;&lt;removetag rosa-blue-flower&gt;&gt;
&lt;&lt;removetag rosa-purple-flower&gt;&gt;

When you enter the kitchen, ?Rosa is hard at work preparing the next meal of the day. She looks up as you enter and a smile breaks across her face.

&lt;&lt;rosa&gt;&gt;M&#39;lord! To what do I owe the pleasure?&lt;&lt;/rosa&gt;&gt;

You proudly produce the three varieties of flowers you collected from the forest. ?Rosa gives a small gasp as she takes in the sight of them.

&lt;&lt;player&gt;&gt;You said you loved these flowers, so I collected them for you.&lt;&lt;/player&gt;&gt;

?Rosa looks genuinely touched as she accepts the flowers from you.

&lt;&lt;rosa&gt;&gt;I can&#39;t believe you spent the time to get these for me, m&#39;lord! They&#39;re beautiful!&lt;&lt;/rosa&gt;&gt;

She immediately busies herself arranging the flowers into one large bouquet. The colors look beautiful together, and the blue glow of the flowers from the waterfall is especially lovely.?nl

When she finishes with the flowers, she looks around to make sure no one is nearby and speaks in a conspiratorial whisper.

&lt;&lt;rosa&gt;&gt;If you keep this up, ?player, I might truly fall for you.&lt;&lt;/rosa&gt;&gt;

You feel a slight heat spread across your cheeks as she looks at you happily.

&lt;&lt;if hasCompletedQuest(&#39;sybille-tavern&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Ask her on another date&#39; &#39;Rosa Ask Date 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &#39;Take your leave&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;I must be going, ?Rosa, but I&#39;m so happy you like the flowers.&lt;&lt;/player&gt;&gt;
    &lt;&lt;rosa&gt;&gt;See you later, then, m&#39;lord!&lt;&lt;/rosa&gt;&gt;
    &lt;&lt;decision &#39;Leave the kitchens&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="329" name="Rosa Ask Date 2" tags="" position="1100,4100" size="100,100">&lt;&lt;player&gt;&gt;I was wondering, ?Rosa, whether you might enjoy spending some more time together, away from the castle?&lt;&lt;/player&gt;&gt;

?Rosa&#39;s smile grows somehow even bigger. 

&lt;&lt;rosa&gt;&gt;I would like that very much, ?player! I really would.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;Now that I have my disguise, perhaps we could go to the local tavern for a drink? Like normal people do.&lt;&lt;/player&gt;&gt;

?Rosa giggles at the thought of this. 

&lt;&lt;rosa&gt;&gt;That sounds lovely. I could go in the evening sometime, after my work is done.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;Consider it a date, then.&lt;&lt;/player&gt;&gt;

?Rosa tucks a strand of hair behind her ear, blushing slightly. 

&lt;&lt;rosa&gt;&gt;I&#39;ll see you then!&lt;&lt;/rosa&gt;&gt;

&lt;&lt;decision &#39;Leave the kitchens&#39; &#39;Hallway&#39;&gt;&gt;
    &lt;&lt;startquest rosa-date-2&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="330" name="Rosa Start Date 2" tags="" position="1225,4100" size="100,100">&lt;&lt;completequest rosa-date-2&gt;&gt;

You find ?Rosa tidying the kitchen after her day&#39;s work. She neatly stacks away some pots under the counter and straightens to greet you, smiling shyly.

&lt;&lt;rosa&gt;&gt;Good evening, m&#39;lord! Are you here to go on a little &lt;i&gt;excursion&lt;/i&gt;, as you called it?&lt;&lt;/rosa&gt;&gt;

She gives you a conspiratorial wink. You realize that she, adorably, has a little bit of flour on one cheek.

&lt;&lt;player&gt;&gt;Indeed I am. Although, I can&#39;t help but notice you have something on your face...&lt;&lt;/player&gt;&gt;

?Rosa looks mortified and starts rubbing at her face, but totally misses the spot.

&lt;&lt;player&gt;&gt;Ah, no, there&#39;s a bit of flour, just there...&lt;&lt;/player&gt;&gt;

Blushing, ?Rosa takes a step closer to you.

&lt;&lt;rosa&gt;&gt;I can&#39;t see it. Do you mind?&lt;&lt;/rosa&gt;&gt;

You feel a slight flutter in your stomach as you reach out to her, gently wiping the flour off yourself. She keeps eye contact with you the whole time. 

&lt;&lt;rosa&gt;&gt;Thank you so much. How embarrassing! I must have rubbed some on my face when I was baking earlier...&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;No need to be embarrassed. Are you ready to go?&lt;&lt;/player&gt;&gt;

?Rosa nods, looking around the kitchen.

&lt;&lt;rosa&gt;&gt;I&#39;ll just put away the last couple things while you change.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;decision &#39;Change into your disguise and leave the castle&#39; &#39;Rosa Date 2 Walk Town&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="331" name="Rosa Date 2 Walk Town" tags="" position="100,4225" size="100,100">&lt;&lt;outfit disguise&gt;&gt;
&lt;&lt;setlocation &#39;Road&#39;&gt;&gt;

You change into your disguise and walk out of the castle with ?Rosa. You pass by the guards without issue, and it occurs to you that they have likely started to recognize you as a regular &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;castle maid&lt;&lt;else&gt;&gt;castle manservant&lt;&lt;/if&gt;&gt;.?nl

On your way to the tavern, ?Rosa gives you a shy look out of the corner of her eye.

&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    &lt;&lt;rosa&gt;&gt;I feel lucky, you know.&lt;&lt;/rosa&gt;&gt;
    You throw her a quick glance. 
    &lt;&lt;player&gt;&gt;What do you mean?&lt;&lt;/player&gt;&gt;
    &lt;&lt;rosa&gt;&gt;To be spending the evening with you, especially when you look so pretty.&lt;&lt;/rosa&gt;&gt;
    This comment takes you aback, so you find yourself just staring at her for a moment. She smiles at you encouragingly.
    &lt;&lt;player&gt;&gt;Well, thank you, ?Rosa. I could say the same about you.&lt;&lt;/player&gt;&gt;
    She blushes, still smiling at you.
&lt;&lt;else&gt;&gt;
    &lt;&lt;rosa&gt;&gt;I feel lucky, you know.&lt;&lt;/rosa&gt;&gt;
    You throw her a quick glance. 
    &lt;&lt;player&gt;&gt;What do you mean?&lt;&lt;/player&gt;&gt;
    &lt;&lt;rosa&gt;&gt;To be spending the evening with you, away from the castle, like normal folks.&lt;&lt;/rosa&gt;&gt;
    She seems very sincere about this comment, and you have to smile.
    &lt;&lt;player&gt;&gt;I feel lucky, too.&lt;&lt;/player&gt;&gt;
&lt;&lt;/if&gt;&gt;

You continue walking, chatting and laughing together until you arrive at the tavern.

&lt;&lt;decision &#39;Go inside and find a table&#39; &#39;Rosa Date 2 Tavern&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="332" name="Rosa Date 2 Tavern" tags="" position="225,4225" size="100,100">&lt;&lt;setlocation &#39;Tavern&#39;&gt;&gt;

The tavern is even more bustling than usual. There are few empty seats left, so you and ?Rosa squeeze into a tiny table in a corner. The table is so small that your knees touch, not that you mind. A barmaid comes to take your orders, and after a few moments you settle in with your drinks.?nl

?Rosa takes a sip of her ale and looks at you happily. 

&lt;&lt;rosa&gt;&gt;So, ?player, what is it like living something like a normal life for the first time?&lt;&lt;/rosa&gt;&gt;

You gulp awkwardly as you only now realise you haven&#39;t yet told her your new name. You look around quickly to see if anyone is listening to your conversation. Luckily, the other patrons seem absorbed in their own affairs, as you quietly speak to her.

&lt;&lt;player&gt;&gt;Uhm, ?Rosa, there&#39;s something I haven&#39;t told you yet. For this disguise to work well I&#39;ve decided to take up a new name: ?newname. I know it&#39;s a little weird but could you please refer to me with that when we&#39;re outside like this?&lt;&lt;/player&gt;&gt;

You look at her with an awkward smile, it probably sounds like you&#39;re being paranoid but you really hope she understands.
&lt;&lt;rosa&gt;&gt;Oh! I am so sorry, I hadn&#39;t even though of that! Of course I will do that, ?titleR!... I mean ?newname!&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;Thank you for understanding. I hope you don&#39;t mind.&lt;&lt;/player&gt;&gt;

&lt;&lt;rosa&gt;&gt;Of course not! I will get used to it. It&#39;s a nice name.&lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt; And very pretty too, that fits you.&lt;&lt;/if&gt;&gt;&lt;&lt;/rosa&gt;&gt;

&lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt; 
    You blush and look away awkwardly. 
&lt;&lt;/if&gt;&gt;
&lt;&lt;rosa&gt;&gt;But enough about that, I still want to ask my question: What is it like for you to pretend to be a normal person like this?&lt;&lt;/rosa&gt;&gt; 

You look around the table again to make sure nobody is watching as you lean closer to ?Rosa whisper in her ear.

&lt;&lt;player&gt;&gt;Well, one of the best parts is being able to do things like this with you.&lt;&lt;/player&gt;&gt;

?Rosa pulls back to look you in the eyes. Seeing your sincerity, she smiles broadly. 

&lt;&lt;rosa&gt;&gt;That&#39;s my favorite part, as well.&lt;&lt;/rosa&gt;&gt;

She lays a hand palm-up on the tiny table, and locks eyes with you, as if inviting you to place your hand on hers. You do so, and feel her warm skin beneath yours. She squeezes your hand tightly.?nl

You continue chatting happily. She tells how she came to work in the castle, her love of cooking, and somehow even more information about her favorite flowers. In turn, you tell her about your experiences so far outside of the castle. You can&#39;t help but feel invigorated speaking to her, like a small fire is burning in your chest. Even more than last time, you want to be close to her.

&lt;&lt;decision &#39;Continue chatting until late in the night&#39; &#39;Rosa Date 2 Tavern More&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="333" name="Rosa Date 2 Tavern More" tags="" position="350,4225" size="100,100">&lt;&lt;increasetime 1&gt;&gt;

Before you know it, you have talked for hours and it has grown quite late. Most of the other patrons at the tavern have gone home. ?Rosa giggles at you tipsily over her drink, looking around the room. You smile at her blurrily, your vision swimming from the alcohol.

&lt;&lt;rosa&gt;&gt;Looks like it&#39;s just us left. Should we head back to the castle?&lt;&lt;/rosa&gt;&gt;

As she says this, a barmaid comes around to collect payment.

&lt;&lt;if money(&#39;gold&#39;) &gt;= 10&gt;&gt;
    You realize with relief that you have enough wages from working in this very tavern to pay your bill. You figure it&#39;s only fair that you pay, considering you technically have access to the entire castle treasury. You hand over the gold and stand up with ?Rosa to leave the tavern.
    &lt;&lt;changemoney &#39;gold&#39; -10&gt;&gt;
&lt;&lt;else&gt;&gt;
    You realize with embarrassment that you have no gold with you. You&#39;ve never had to carry your own gold before, nor have you had to pay for goods yourself. ?Rosa identifies your look of panic and smiles at you.
    &lt;&lt;rosa&gt;&gt;It&#39;s no problem, ?name, I&#39;m sure you&#39;re not used to having to pay for things like this! I can settle our bill.&lt;&lt;/rosa&gt;&gt;
    She hands over the gold to the barmaid, who looks very confused. You stand up together and leave the tavern.
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Walk back to the castle&#39; &#39;Rosa Date 2 Walk Back&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="334" name="Rosa Date 2 Walk Back" tags="" position="475,4225" size="100,100">&lt;&lt;setlocation &#39;Road&#39;&gt;&gt;

You walk together back to the castle, the buildings and fields around you silent as the townspeople sleep. You&#39;re finding walking in a straight line a bit difficult, but ?Rosa looks as beautiful as ever under the starlight. She clings close to you in the cold of the darkness.?nl

&lt;&lt;decision &#39;Act on your desire to kiss her&#39;&gt;&gt;
    You pass together through a small copse of trees. As you do so, you seem to both have the same idea at the same time, and you fall into an embrace against a tree. You find each other&#39;s mouths and kiss each other deeply.

    &lt;&lt;rosa&gt;&gt;Oh, ?player...&lt;&lt;/rosa&gt;&gt;

    With some surprise, you feel her pushing her body against yours. While still kissing her, you run your hands across her back. She sighs into your mouth, and you get the impression she&#39;s enjoying this just as much as you.

    &lt;&lt;player&gt;&gt;?Rosa...&lt;&lt;/player&gt;&gt;

    You let your hands travel further, until they are moving over the curves of her breasts. She lets out a small moan as you do so, and you feel &lt;&lt;if settings.sph&gt;&gt;your tiny dick&lt;&lt;else&gt;&gt;yourself&lt;&lt;/if&gt;&gt; growing hard.

    ?Rosa presses herself even more into you, and you wonder whether she can feel how aroused you are. She tangles her hands in your hair, kissing you passionately.?nl

    In the middle of kissing you, she somehow manages to lose her balance and falls to the ground. She giggles as you help pull her back to her feet.

    &lt;&lt;rosa&gt;&gt;Oh, ?player, I love being with you like this, but I do believe I have had too much to drink.&lt;&lt;/rosa&gt;&gt;

    You desperately want to continue touching her, to be as close to her as possible, but you also don&#39;t want to push too hard. In any case, your own stomach is feeling queasy from the drink.

    &lt;&lt;player&gt;&gt;So have I, I think.&lt;&lt;/player&gt;&gt;

    You laugh together for a moment, exchanging more kisses. 

    &lt;&lt;player&gt;&gt;Shall we head back to the castle, then?&lt;&lt;/player&gt;&gt;

    ?Rosa nods, smiling at you. She tangles her fingers in yours and gives you another kiss.

    &lt;&lt;decision &#39;Keep walking back to the castle&#39; &#39;Rosa Date 2 End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Keep walking back to the castle&#39; &#39;Rosa Date 2 End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="335" name="Rosa Date 2 End" tags="" position="600,4225" size="100,100">&lt;&lt;setlocation &#39;Kitchen&#39;&gt;&gt;
&lt;&lt;outfit standard&gt;&gt;

You return to the kitchen, where you change out of your disguise. Before parting ways, ?Rosa makes sure no one else is around before giving you a parting kiss.

&lt;&lt;rosa&gt;&gt;Goodnight, ?player. I had a lovely time. I hope we can spend more time together soon.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;As do I, ?Rosa.&lt;&lt;/player&gt;&gt;

She squeezes your hand and disappears toward her chambers. You watch her go, arousal simmering inside you, before heading to bed yourself.

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Go to your bedroom&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="336" name="Rosa Intimacy Kitchen" tags="" position="725,4225" size="100,100">&lt;&lt;addcounter &#39;rosa-intimacy&#39; 1&gt;&gt;
You make sure no one is around as you head into the kitchen. ?Rosa is at the oven, checking on a huge loaf of bread that looks to be partway through baking.

&lt;&lt;rosa&gt;&gt;Oh, ?titleR! Aren&#39;t you looking &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;lovely&lt;&lt;else&gt;&gt;handsome&lt;&lt;/if&gt;&gt; today.&lt;&lt;/rosa&gt;&gt;

She smiles at you, and you feel a warmth spread through your chest. Embarrassingly, you also feel yourself blushing. She approaches you, coming just close enough be an appropriate distance if someone were to see you, but you sense that she wishes she could move closer.?nl

&lt;&lt;decision &#39;Suggest to go into the larder together&#39; depravity medium&gt;&gt;
    You want to be closer to her, too. You look around the room, noticing the closed door to the larder.

    &lt;&lt;player&gt;&gt;Ah, could you perhaps...help me with something in the larder? I&#39;m on the hunt for some...uh...peaches, but I&#39;m not sure where to look.&lt;&lt;/player&gt;&gt;

    ?Rosa catches the look on your face and gives you a conspiratorial wink. 

    &lt;&lt;rosa&gt;&gt;Of course, ?titleR, I can certainly help you with that.&lt;&lt;/rosa&gt;&gt;

    &lt;&lt;decision &#39;Go with ?Rosa into the larder&#39; &#39;Rosa Handjob Larder&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;if hasCompletedQuest(&#39;rosa-date-3&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Suggest to go to your bedroom.&#39; depravity medium&gt;&gt;
        You want to be closer to her, too. Why not invite her to sneak with you over to your bedroom? You walk up to her and awkwardly stammer out the question.

        &lt;&lt;player&gt;&gt;Ah, ?Rosa... I was wondering, perhaps, if you&#39;d be so inclined, and it&#39;s totally okay if you say no-&lt;&lt;/player&gt;&gt;

        &lt;&lt;if hasVisited(&#39;Rosa Sex&#39;)&gt;&gt;
            Before you continue your bad-phrased question, she interrupts you.

            &lt;&lt;rosa&gt;&gt;You want to sneak off together to your bedchambers again, ?titleR?&lt;&lt;/rosa&gt;&gt;

            You blush, taken aback by her directness.

            &lt;&lt;player&gt;&gt;Uhm- Yes- That is what I wanted to ask.&lt;&lt;/player&gt;&gt;

            She moves closer to you with a sly smile and gives you a kiss on your cheek.

            &lt;&lt;rosa&gt;&gt;I would be delighted to... After you...&lt;&lt;/rosa&gt;&gt;
        &lt;&lt;else&gt;&gt;
            She has an amused smile on her face as she quietly observes your stammering. You finally manage to actually get to the point.

            &lt;&lt;player&gt;&gt;Would you be interested in going to- uhm- my bedroom with me.&lt;&lt;/player&gt;&gt;

            You feel your heart beating louder, waiting anxiously for her response. She suddenly moves closer to you with a sly smile and gives you a kiss on your cheek.

            &lt;&lt;rosa&gt;&gt;How daring, ?titleR. I would be delighted to... After you...&lt;&lt;/rosa&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        
        &lt;&lt;decision &#39;Sneak to your bedroom together&#39; &#39;Rosa Sex&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;

        &lt;&lt;disableif getTime() !== &#39;evening&#39;&gt;&gt;
            Only during evening.
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="337" name="Rosa Handjob Larder" tags="spicy" position="850,4225" size="100,100">&lt;&lt;setlocation &#39;Larder&#39;&gt;&gt;

You follow ?Rosa into the larder and close the door. The smell of fresh pastries hits your nose at the same moment that ?Rosa starts kissing you.?nl

You fall together against a stack of wine barrels and you kiss her back, drinking in the smell of her hair as she moves against you. Your noses bump together awkwardly and she pulls away for a moment, chuckling.

&lt;&lt;rosa&gt;&gt;You know, ?player, I&#39;ve been wanting this since I last saw you.&lt;&lt;/rosa&gt;&gt;

You realize she is being totally sincere, and at the same moment, you realize you feel the same. Still, it feels difficult to say.

&lt;&lt;player&gt;&gt;I-, uh, well, I want that too, ?Rosa.&lt;&lt;/player&gt;&gt;

She gives you a playful smile, a light pink color rising on her cheeks.

&lt;&lt;rosa&gt;&gt;Do you think we could maybe, well, try something new?&lt;&lt;/rosa&gt;&gt;

You&#39;re not sure what she&#39;s referring to, but you can&#39;t imagine you would say no to whatever it is.

&lt;&lt;player&gt;&gt;Um, y-yes, I would like that very much.&lt;&lt;/player&gt;&gt;

She runs her hand tentatively down your body, gently grazing her fingers over your crotch. You were already aroused by this situation, and now you feel &lt;&lt;if settings.sph&gt;&gt;your tiny dick&lt;&lt;else&gt;&gt;yourself&lt;&lt;/if&gt;&gt; growing quite hard.

&lt;&lt;if settings.sph&gt;&gt;
    You moves her hand rapidly all over your crotch, it seems like she&#39;s actively searching for your nearly non-existent bulge and she looks momentarily confused by it. Suddenly you feel her grab hold of your ?dick through your pants.
    &lt;&lt;rosa&gt;&gt;Ah! There it is! Thought I couldn&#39;t find it for a moment!&lt;&lt;/rosa&gt;&gt;
    Somehow, her having trouble finding your ?dick is turning you on slightly more... Especially as she continues running her fingers over your crotch.?nl
&lt;&lt;/if&gt;&gt;

You lean forward to kiss her again. She kisses you back while her hand gently massages you through your pants. Her touch already feels amazing, and you can hardly believe that you get to do something like this with ?Rosa.

&lt;&lt;rosa&gt;&gt;I hope this feels good for you?&lt;&lt;/rosa&gt;&gt;

Good is such an understatement that you almost laugh.

&lt;&lt;player&gt;&gt;It feels, uh, amazing...&lt;&lt;/player&gt;&gt;

As she continues to massage you, you reach your hands out and run them along her breasts. They feel warm and full in your hands, and you can&#39;t help but give them a light squeeze. ?Rosa giggles lightly while still kissing you.?nl

Feeling the arousal building inside yourself, you reach a hand lower to dip under the folds of her dress. Though you aren&#39;t particularly experienced in this area, you find the space between her legs and begin to rub her gently through the fabric of her undergarment.

&lt;&lt;rosa&gt;&gt;Ahhh, oh, yes, ?player, just a little to the left...&lt;&lt;/rosa&gt;&gt;

You move your hand a bit and continue to move your fingers on her. You are now very hard, &lt;&lt;if settings.sph&gt;&gt;not that this fact is very visible through your pants&lt;&lt;else&gt;&gt;and you&#39;re creating quite the tent in your pants&lt;&lt;/if&gt;&gt;.?nl

&lt;&lt;if settings.sph&gt;&gt;
    ?Rosa pulls away from kissing you, her face flushed. She gives you a quick look and, seeing the pleasure on your face, slowly pulls your pants down to reveal your tiny, hard cock. Not able to put her whole hand on it, she begins to massage you with a few fingers. She smiles at you playfully.
    &lt;&lt;rosa&gt;&gt;Awh! It&#39;s so cute!&lt;&lt;/rosa&gt;&gt;
    You&#39;re not sure what to say to this, but her touch feels so good that you can&#39;t really focus on her comment anyway.
&lt;&lt;else&gt;&gt;
    ?Rosa pulls away from kissing you, her face flushed. She gives you a quick look and, seeing the pleasure on your face, slowly pulls your pants down to reveal your erect penis. She wraps her hand around the shaft and begins to massage up and down.
&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Oh, fuck, ?Rosa...&lt;&lt;/player&gt;&gt;

You can feel a wetness spreading through the fabric of her underwear now. Wanting to get closer to her, you fumble for a moment, reaching your hand inside the underwear. You feel the soft, warm wetness between her legs and continue to rub your fingers there.?nl

Still kissing you, ?Rosa moans into your mouth as she moves herself against your hand. This somehow makes you even harder, watching her body move in pleasure like this.

&lt;&lt;rosa&gt;&gt;That feels so good, ?player...&lt;&lt;/rosa&gt;&gt;

The movement of her &lt;&lt;if settings.sph&gt;&gt;fingers&lt;&lt;else&gt;&gt;hand&lt;&lt;/if&gt;&gt; on your cock speeds up and you throw your head back, marvelling at how good this feels. You are both moaning together now, your breaths coming faster as the pleasure builds in your bodies.?nl

Suddenly, ?Rosa gasps and closes her eyes in pleasure as a series of orgasmic waves move through her body. Just the sight of her cumming brings you to your climax as well, and you feel a euphoric release as your cum splatters over ?Rosa&#39;s hand.

&lt;&lt;player&gt;&gt;Oh, ?Rosa...&lt;&lt;/player&gt;&gt;

There&#39;s a brief pause as you both come down from your orgasms, breathing heavily. You find yourself laughing a little bit, realizing that you just got a handjob in the castle larder. ?Rosa seems to realize why you are laughing and she laughs along with you.?nl

As you&#39;re chuckling together, the smell of burning reaches your nose.

&lt;&lt;rosa&gt;&gt;Oh no, the bread!&lt;&lt;/rosa&gt;&gt;

&lt;&lt;decision &#39;Leave the larder&#39; &#39;Rosa Handjob Larder 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="338" name="Rosa Handjob Larder 2" tags="" position="975,4225" size="100,100">?Rosa rushes to the oven and pulls out a totally blackened loaf of bread. 

&lt;&lt;player&gt;&gt;Oh no, I-I&#39;m sorry about the bread, ?Rosa!&lt;&lt;/player&gt;&gt;

?Rosa sets the bread down on a counter and starts to laugh again.

&lt;&lt;rosa&gt;&gt;Don&#39;t worry, ?titleR, I can make more bread! It was worth it to be able to...find some peaches for you in the larder.&lt;&lt;/rosa&gt;&gt;

You laugh with her as well, and immediately start coughing when you breathe in the smoke.

&lt;&lt;rosa&gt;&gt;Really though, I should start making more bread now, otherwise there won&#39;t be any for dinner!&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;Of course. I&#39;ll, uh, leave you to it, but I&#39;ll be back just as soon as I am...looking for some more fruit...&lt;&lt;/player&gt;&gt;

She giggles and waves as you turn to leave the kitchen, the pleasure you shared with her still fresh in your mind.

&lt;&lt;decision &#39;Leave the kitchen&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="339" name="Rosa Give Pendant" tags="" position="1100,4225" size="100,100">&lt;&lt;completequest &#39;rosa-give-pendant&#39;&gt;&gt;

As you enter the kitchen, you see ?Rosa busy at work creating row upon row of tiny, fruit-filled pastries. She looks up and smiles as you enter.

&lt;&lt;rosa&gt;&gt;Oh, hello there, ?titleR! Aren&#39;t you looking &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;pretty&lt;&lt;else&gt;&gt;dashing&lt;&lt;/if&gt;&gt; today.&lt;&lt;/rosa&gt;&gt;

You smile back at her, feeling the weight of the pendant in your pocket. &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;It feels strange to be called pretty, but a part of you kind of likes it...&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;U-um thank you! &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;I could say the same about you.&lt;&lt;else&gt;&gt;You are looking beautiful as always.&lt;&lt;/if&gt;&gt; I actually brought something for you.&lt;&lt;/player&gt;&gt;

You see her eyes light up with curiosity. She wipes her hands on her apron and approaches you. 

&lt;&lt;rosa&gt;&gt;Oh, what is it?&lt;&lt;/rosa&gt;&gt;

You pull the pendant out of your pocket and present it to her somewhat awkwardly. 

&lt;&lt;player&gt;&gt;I got this for you in, um, town. It made me think of you. I hope you like it.&lt;&lt;/player&gt;&gt;

A sweet smile comes across her face as she accepts the necklace and cups it carefully in her hands.

&lt;&lt;rosa&gt;&gt;Oh, my goodness! What a beautiful necklace! I don&#39;t think I&#39;ve ever owned anything so fine before.&lt;&lt;/rosa&gt;&gt;

She looks at you with genuine appreciation, her eyes dancing with warmth. It strikes you again how rare ?Rosa&#39;s sweet nature is, and you feel a warmth spreading in your chest as you look at her.

&lt;&lt;rosa&gt;&gt;Can you help me put it on?&lt;&lt;/rosa&gt;&gt;

She hands you the necklace and turns around, sweeping her blonde hair out of the way. You reach around her and gently fasten the necklace around her neck, breathing in the scent of her hair as you do. When she turns around again, you&#39;re close enough to kiss her, but you know it&#39;s not the best idea in such a public room.

&lt;&lt;rosa&gt;&gt;Thank you so much, ?titleR...&lt;&lt;/rosa&gt;&gt;

Standing here in this kitchen suddenly gives you an idea. You want to treat ?Rosa, to show her how you appreciate her... What if you arranged for &lt;i&gt;her&lt;/i&gt; to share a dinner with you in the grand hall for once?&lt;br&gt;

&lt;&lt;decision &#39;Invite her to dinner in the grand hall&#39;&gt;&gt;
    &lt;&lt;startquest &#39;rosa-date-3-chef&#39;&gt;&gt;

    &lt;&lt;player&gt;&gt;You know, ?Rosa, I would love to spend some more time with you. Would you like to have dinner with me?&lt;&lt;/player&gt;&gt;

    She smiles broadly at you.

    &lt;&lt;rosa&gt;&gt;Yes, of course! I would love that.&lt;&lt;/rosa&gt;&gt;

    You smile at each other, the tension between you palpable. With a bit of luck, hopefully you&#39;ll be able to get closer to each other again soon...

    &lt;&lt;player&gt;&gt;Wonderful! You don&#39;t need to do anything. I&#39;ll come find you when everything is ready.&lt;&lt;/player&gt;&gt;

    Now that you&#39;ve suggested the idea, you have a date to plan! Most importantly, you&#39;ll need to hire a chef to create a delicious meal for you two. Perhaps ?ChefPepper would be just the man for the job?

    &lt;&lt;decision &#39;Bid farewell to ?Rosa&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decisionicon romance&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Decide against it&#39;&gt;&gt;
    &lt;br&gt;As soon as you come up with the idea, you change your mind. Inviting ?Rosa to dinner in the grand hall seems almost insensitive, seeing as how she normally cooks for the people eating there.
    
    &lt;&lt;player&gt;&gt;I&#39;m so glad you like it, ?Rosa. I must be leaving now, but it was lovely to see you.&lt;&lt;/player&gt;&gt;

    &lt;&lt;rosa&gt;&gt;Yes, come back any time!&lt;&lt;/rosa&gt;&gt;

    She waves as you turn awkwardly and walk out, leaving her to continue preparing the pastries.

    &lt;&lt;decision &#39;Leave the kitchen&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="340" name="Rosa Date 3 Get Chef" tags="" position="1225,4225" size="100,100">&lt;&lt;completequest &#39;rosa-date-3-chef&#39;&gt;&gt;

You enter the kitchen to see a whirl of activity. Whereas ?Rosa always seems to prepare food in a careful, organized manner, ?ChefPepper is as usual moving through the room with a vibrant energy. He flits between workstations, stirring here and sprinkling there, a well-oiled machine of cooking productivity. He looks at you over his shoulder as you enter.

&lt;&lt;pepper&gt;&gt;Hello there, deary! Taste this sauce for me, won&#39;t you?&lt;&lt;/pepper&gt;&gt;

You oblige, taking a spoon he offers. The dark sauce is rich and savory, its flavor deeply complex. 

&lt;&lt;player&gt;&gt;Wow, that&#39;s delicious!&lt;&lt;/player&gt;&gt;

?ChefPepper smiles at you, the corners of his eyes crinkling happily. 

&lt;&lt;pepper&gt;&gt;I&#39;m so glad to hear it. You haven&#39;t lived until you&#39;ve had it on potatoes!&lt;&lt;/pepper&gt;&gt;

You remember suddenly that you&#39;ve come here for a reason. Before you can say anything, ?ChefPepper has already whirled away to another station, busily mashing something inside a steaming pot.

&lt;&lt;player&gt;&gt;Um, ?ChefPepper, I was actually wondering whether you might help me out with something. Would you be interested in cooking for a date I&#39;m planning?&lt;&lt;/player&gt;&gt;

?ChefPepper smiles at you conspiratorially while still mashing away.

&lt;&lt;pepper&gt;&gt;A date, you say? I could never turn down the chance to facilitate young love!&lt;&lt;/pepper&gt;&gt;

You suppose you should have realized it would be this easy.

&lt;&lt;player&gt;&gt;Well, great! I&#39;ll let you know when. It&#39;s just dinner for two. I&#39;ll trust you to come up with the menu, of course.&lt;&lt;/player&gt;&gt;

He flits away from the pot and starts to pull golden buns from the oven, sliding them onto a cooling rack expertly. He smiles at you through the steam rising from the buns.

&lt;&lt;pepper&gt;&gt;I look forward to it!&lt;&lt;/pepper&gt;&gt;

You can see he&#39;s quite busy, so you should probably leave now. You thank him and head back out of the kitchen, a mixture of excitement and nervousness for your date dancing in your stomach.

&lt;&lt;decision &#39;Return to the tavern&#39; &#39;Tavern&#39;&gt;&gt;
    &lt;&lt;startquest &#39;rosa-date-3&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="341" name="Rosa Start Date 3" tags="" position="100,4350" size="100,100">&lt;&lt;completequest &#39;rosa-date-3&#39;&gt;&gt;

After preparing everything for the date, you find ?Rosa in the kitchens again. She seems to have finished all her work for the day, and is sitting on a stool, her hair cascading down her back in a complicated series of braids that must have taken her some time. As you approach, you see she has a strange wooden device in front of her.

&lt;&lt;rosa&gt;&gt;Oh, ?titleR! Come see.&lt;&lt;/rosa&gt;&gt;

You stand next to her, watching curiously as she opens the device. It seems to be constructed of two flat pieces of wood with sheets of parchment between them, held closed by a small latch. She reveals a layer of parchment, and you see there a perfect little pressed flower.

&lt;&lt;rosa&gt;&gt;It&#39;s from the bouquet you gave me.&lt;&lt;/rosa&gt;&gt;

She hands you the dried flower and you hold it carefully. It feels as though the tiniest movement could tear it.

&lt;&lt;player&gt;&gt;It&#39;s beautiful. I think you&#39;re right to appreciate flowers so much.&lt;&lt;/player&gt;&gt;

She smiles at you and carefully takes back the flower, nestling it between the sheets of parchment.

&lt;&lt;rosa&gt;&gt;Should we go?&lt;&lt;/rosa&gt;&gt;

You hold out an arm to her, which she takes. Suddenly you feel a moment of doubt and hope she won&#39;t be disappointed that you&#39;re only taking her to the other side of the castle.

&lt;&lt;decision &#39;Lead her to the grand hall&#39; &#39;Rosa Date 3 Enter Hall&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="342" name="Rosa Date 3 Enter Hall" tags="" position="225,4350" size="100,100">&lt;&lt;setlocation &#39;Grand hall&#39;&gt;&gt;

She looks at you curiously as you lead her through the castle to the grand hall, being careful to avoid being seen by anyone as you go. You&#39;ve already locked all but one door to the hall, and instructed a guard to prevent anyone from interrupting your dinner this evening.?nl

As you reach the hall and slowly push the doors open for ?Rosa to enter, the nature of the date seems to dawn on her.

&lt;&lt;rosa&gt;&gt;?Player! Are we doing what I think we&#39;re doing?&lt;&lt;/rosa&gt;&gt;

You follow her into the room, suddenly anxious to see how she will receive your handiwork. Though you aren&#39;t particularly experienced in decoration, you hope you&#39;ve done a good job covering the large table in the center of the hall with flowers from the castle garden.?nl

?Rosa approaches the table, beaming from ear-to-ear. 

&lt;&lt;rosa&gt;&gt;This is absolutely beautiful. I can&#39;t believe you put in all this effort!&lt;&lt;/rosa&gt;&gt;

In a moment of wild abandon, you pull out the throne at the head of the table and motion for ?Rosa to sit. She looks suddenly nervous, as though this must certainly be against the rules.

&lt;&lt;player&gt;&gt;Don&#39;t worry! No one should be interrupting us tonight.&lt;&lt;/player&gt;&gt;

After another moment of hesitation, she slowly takes a seat. The table is massive and surrounded by chairs, but you&#39;d rather not be far away from her. You take a normal seat at her side.

&lt;&lt;rosa&gt;&gt;Oh, ?Player, this feels wrong to be sitting here.&lt;&lt;/rosa&gt;&gt;

You worry for a moment you&#39;ve made her uncomfortable, but she smiles at you and lets out a half-nervous giggle.

&lt;&lt;rosa&gt;&gt;It is kind of fun, though.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;Oh, good! This evening I want you to relax and enjoy yourself.&lt;&lt;/player&gt;&gt;

You look at her, and feel that same tension again. You want to lean in to kiss her, but at that moment the doors to the hall open and ?ChefPepper walks in, easily carrying a massive tray groaning with dishes. He sets the tray down on the table in front of you and ?Rosa.

&lt;&lt;pepper&gt;&gt;Hello there, you two lovebirds! At the prince&#39;s request, I have prepared a delicious dinner for you.&lt;&lt;/pepper&gt;&gt;

?Rosa looks up at ?ChefPepper excitedly.

&lt;&lt;rosa&gt;&gt;What have you made today, ?ChefPepper?&lt;&lt;/rosa&gt;&gt;

He uncovers the dishes one by one, explaining each in detail. The food is somehow comfortingly familiar and yet elevated, his expert plating making even simple mashed potatoes look fit for a king. ?Rosa is enraptured throughout the entire explanation, clearly thrilled to experience an elaborate meal.

&lt;&lt;pepper&gt;&gt;And finally, allow me to present the last dish: &lt;&lt;dish&gt;&gt;! I hope you enjoy!&lt;&lt;/pepper&gt;&gt;

&lt;&lt;player&gt;&gt;I-I&#39;m sure we will. Thank you so much, ?ChefPepper.&lt;&lt;/player&gt;&gt;

&lt;&lt;pepper&gt;&gt;Certainly, I will leave you now for your evening of romance. You make for a beautiful couple.&lt;&lt;/pepper&gt;&gt;

You feel yourself blushing as he says this. He gives a small bow and leaves the room. ?Rosa turns to you, a huge smile on her face.

&lt;&lt;rosa&gt;&gt;I&#39;m so grateful that you&#39;ve arranged this, ?player. It&#39;s such a treat to be cooked for by someone else.&lt;&lt;/rosa&gt;&gt;

You smile back at her, and feel that tension growing again. Now that you&#39;re alone, you lean in to kiss her. She immediately leans into you and you lose yourself kissing her for some time as the scent of flowers drifts pleasantly in the air.

&lt;&lt;decision &#39;Enjoy your meal&#39; &#39;Rosa Date 3 End Meal&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="343" name="Rosa Date 3 End Meal" tags="" position="350,4350" size="100,100">&lt;&lt;increasetime 1&gt;&gt;

You savor the evening with ?Rosa, sipping wine and sampling the many dishes luxuriously slowly as the sun sets through the windows of the hall. Eventually the only light comes from candles flickering on the table, and together you have managed to clean every plate. You feel comfortably full and content, and ?Rosa is looking as beautiful as ever.

&lt;&lt;rosa&gt;&gt;That was...amazing.&lt;&lt;/rosa&gt;&gt;

She turns to you, a playful smile on her lips. 

&lt;&lt;rosa&gt;&gt;I just want to say, ?player... I&#39;ve treasured our time together. I love being with you, no matter where we are or what we&#39;re doing.&lt;&lt;/rosa&gt;&gt;

You feel a flush rise to your cheeks. You can&#39;t help but notice how lovely ?Rosa looks in the candlelight, and you want more than anything to be closer to her. &lt;&lt;if isInChastity()&gt;&gt;Unfortunately, your ?dick is currently locked in its cage. It twitches in stifled arousal.&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Suggest moving to your bedroom&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;I-I feel the same, ?Rosa. Would you possibly like to...move to, um, my room?&lt;&lt;/player&gt;&gt;

    Her smile grows larger as you suggest this.

    &lt;&lt;rosa&gt;&gt;Very much so.&lt;&lt;/rosa&gt;&gt;

    You stand up to pull out her chair and hold out your hand, your heart beating with anticipation in your chest.
    
    &lt;&lt;decision &#39;Lead ?Rosa to your bedroom&#39; &#39;Rosa Sex&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    
    &lt;&lt;disableif isInChastity()&gt;&gt;
        You are - unfortunately - locked in chastity. Maybe you can ask her again when you&#39;re not locked?
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;End the date here&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;I-I feel the same, ?Rosa. Thank you so much for joining me for dinner this evening.&lt;&lt;/player&gt;&gt;

    You see a look of confusion cross her face as she realizes that you are wrapping up the date.

    &lt;&lt;rosa&gt;&gt;Do you not want to...well, spend a bit more time together this evening?&lt;&lt;/rosa&gt;&gt;

    You shift awkwardly in your chair. &lt;&lt;if isInChastity()&gt;&gt;You would very much like that, but your ?dick is well and truly restrained at the moment. You try desperately to think of a way to justify this sudden end to the date.&lt;&lt;/if&gt;&gt;

    &lt;&lt;player&gt;&gt;I am, um, rather tired this evening... But I hope we can spend more time together soon.&lt;&lt;/player&gt;&gt;

    She looks somewhat disappointed, but seems to accept your statement. She smiles again, and leans in for a final kiss.

    &lt;&lt;rosa&gt;&gt;Of course. Well, I hope to see you very soon, then.&lt;&lt;/rosa&gt;&gt;

    You stand and walk with her to the door of the hall, waving to her as she disappears into the castle back to her own room for the night. &lt;&lt;if isInChastity()&gt;&gt;Your ?dick switches sadly in its cage as you leave the hall alone. Perhaps you can ask her for more intimacy sometime when your ?dick isn&#39;t locked up?&lt;&lt;else&gt;&gt;You turn and leave the hall alone.&lt;&lt;/if&gt;&gt;

    &lt;&lt;if isMemory()&gt;&gt;
        &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Head to your bedroom for the night&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="344" name="Rosa Sex" tags="spicy" position="475,4350" size="100,100">&lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
&lt;&lt;addevent wake &#39;Rosa Sex Morning After&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;

You sneak with ?Rosa to your bedroom, being careful not to be seen in the hallways. You close the door and turn around to see ?Rosa looking at you with a soft smile. You smile back at her and watch as she steps up close to you.

&lt;&lt;first&gt;&gt;
    &lt;&lt;rosa&gt;&gt;I think I&#39;d like to do a little more than last time, ?player...&lt;&lt;/rosa&gt;&gt;
&lt;&lt;finally&gt;&gt;
    &lt;&lt;rosa&gt;&gt;I&#39;ve been hoping you&#39;d ask me to join you again, ?player...&lt;&lt;/rosa&gt;&gt;
&lt;&lt;/first&gt;&gt;

Her face is now inches from yours. Your back still up against the door, you lean forward to find her lips and kiss her. &lt;&lt;first&gt;&gt;Unlike in the hall, where your kisses were easy and languid, you find yourself meeting her mouth hungrily and you can feel your erection growing rapidly in your pants.&lt;&lt;finally&gt;&gt;You find yourself meeting her mouth hungrily and you can feel your erection growing rapidly in your pants.&lt;&lt;/first&gt;&gt;

&lt;&lt;first&gt;&gt;
    &lt;&lt;player&gt;&gt;S-so do I, ?Rosa...&lt;&lt;/player&gt;&gt;
&lt;&lt;finally&gt;&gt;
    ?nl
&lt;&lt;/first&gt;&gt;

She breaks away from your mouth and takes a step back. You watch, enraptured, as she slowly undoes her dress and removes her undergarments, standing naked in front of you. You drink in the sight of her, taking in the curve of her breasts and the soft space between her legs. 

&lt;&lt;img &quot;rosa/rosa_naked_{theme}.jpg&quot;&gt;&gt;

&lt;&lt;player&gt;&gt;&lt;&lt;first&gt;&gt;Oh, wow... &lt;&lt;/first&gt;&gt;You&#39;re beautiful, ?Rosa...&lt;&lt;/player&gt;&gt;

Before you can spend too long looking, she reaches out and gently begins to undress you, stealing quick kisses as she does. Soon you are completely naked in front of her, your ?dick standing at attention.

&lt;&lt;if hasBoobs()&gt;&gt;
    You see a moment of surprise as she notices your ?titties and, with a look of wonder, runs her hands across them delicately.

    &lt;&lt;rosa&gt;&gt;Are these...new? I never noticed them beneath your clothes.&lt;&lt;/rosa&gt;&gt;

    You search her face for any sign of discomfort, but she seems to be genuinely curious. 

    &lt;&lt;player&gt;&gt;U-um, yes, I drank a potion and it had this effect...&lt;&lt;/player&gt;&gt;

    She kisses you again, still running her hands gently across your ?titties. Her fingers brush your nipple and you&#39;re surprised at how enjoyable it feels.

    &lt;&lt;rosa&gt;&gt;I like them, they&#39;re cute!&lt;&lt;/rosa&gt;&gt;

    You laugh, feeling a release of anxiety as she says this.?nl
&lt;&lt;/if&gt;&gt;
&lt;&lt;if settings.sph&gt;&gt;
    She turns her gaze downward and gives your ?dick a playful stroke as she starts smiling. Suddenly some doubt hits you, are you actually able to satisfy her with your ?penis? Is she grinning because of how small it is? You look at her with a slight concern.

    &lt;&lt;player&gt;&gt;Uhm, hey, ?Rosa?&lt;&lt;/player&gt;&gt;

    She smiles at you and raises her eyebrows as she continues playing with your ?dick.

    &lt;&lt;rosa&gt;&gt;What&#39;s wrong?&lt;&lt;/rosa&gt;&gt;

    &lt;&lt;player&gt;&gt;Uhm- I just wanted to say- If my ?penis doesn&#39;t satisfy you then that&#39;s okay, we can just go back to hands stuff...&lt;&lt;/player&gt;&gt;

    She looks at you with genuine concern.

    &lt;&lt;rosa&gt;&gt;Oh, ?newname, nonsense! Is that what you&#39;re scared of? I don&#39;t care about your penis size at all, no matter how small it is! All I care about &lt;em&gt;you&lt;/em&gt;.&lt;&lt;/rosa&gt;&gt;

    She uses her hand to brush your cheek as she smiles at you and you smile back at her, genuinely feeling better about her response, even though she technically affirmed the smallness of your member. Maybe hearing her say that doesn&#39;t feel that bad actually...

    &lt;&lt;rosa&gt;&gt;I just want to feel connected to you, ?newname... And to be honest... I think your ?dick is actually really cute... Oh- sorry! I don&#39;t know if that&#39;s okay to say!&lt;&lt;/rosa&gt;&gt;

    She... Actually likes your small penis? Huh. That&#39;s unexpected. 

    &lt;&lt;player&gt;&gt;Oh- uhm- no that&#39;s fine, I mean- I&#39;m certainly glad to hear that.&lt;&lt;/player&gt;&gt;

    &lt;&lt;rosa&gt;&gt;Ah, good! I was afraid you wouldn&#39;t like to hear me put any attention on your &lt;em&gt;size&lt;/em&gt;, but honestly I think it&#39;s a positive thing! Having a small dick just makes you really cute, ?newname!&lt;&lt;/rosa&gt;&gt;

    You smile at her, caught of guard by her opinion which makes you feel confused but good at the same time...
&lt;&lt;/if&gt;&gt;
She smiles at you and holds out a hand to lead you to the bed.?nl

You lay down with her on the silky sheets, letting your hands roam across her soft skin as you kiss each other passionately. You let your hands dip lower and lower until finally you brush your fingers across the space between her legs. Gently, you start to massage her there, and she moans into your mouth. 

&lt;&lt;rosa&gt;&gt;Oh, ?player... That feels really good...&lt;&lt;/rosa&gt;&gt;

She reaches out a hand and &lt;&lt;if settings.sph&gt;&gt;uses her thumb and forefinger to stroke your ?dick&lt;&lt;else&gt;&gt;wraps it around your shaft, stroking you up and down&lt;&lt;/if&gt;&gt;. You can feel the slick wetness growing between her legs, and your ?dick is now rock-hard. She looks at you with lust in her eyes.

&lt;&lt;rosa&gt;&gt;I want you inside me, ?player...&lt;&lt;/rosa&gt;&gt;

Somehow, your ?dick seems to get even harder as she says this. You don&#39;t have to be told twice. You move your ?dick to the space between her legs and push gently against her entrance. At least, you think you do, but realize with embarrassment that you seem to be having some trouble finding it. You chuckle nervously.

&lt;&lt;player&gt;&gt;Um, could you help me...?&lt;&lt;/player&gt;&gt;

?Rosa giggles and uses her hand to guide your ?dick toward her entrance.

&lt;&lt;if settings.sph&gt;&gt;
    &lt;&lt;rosa&gt;&gt;Of course, let me get that cute little thing in the right spot.&lt;&lt;/rosa&gt;&gt;

    Hearing her say this actually makes you even more hard as she moves it to her opening. 
&lt;&lt;/if&gt;&gt;

As the head finds the right place, it glides suddenly inside her and you both gasp at the sudden sensation.

&lt;&lt;rosa&gt;&gt;Oh, wow! Th-that feels so good, ?player...&lt;&lt;/rosa&gt;&gt;

You lean down to kiss her fiercely, marvelling at the warm, wet sensation enveloping your ?dick. It&#39;s hard to restrain yourself, but you hold still for some moments while you kiss her, letting you both get used to the feeling. Soon you can&#39;t take it anymore, and you &lt;&lt;if settings.sph&gt;&gt;start to move your ?dick inside her as best as you can with your short length&lt;&lt;else&gt;&gt;begin to thrust your ?dick inside of her&lt;&lt;/if&gt;&gt;.

&lt;&lt;player&gt;&gt;Fuck, ?Rosa, you feel so good...&lt;&lt;/player&gt;&gt;

She moans loudly as you thrust into her. &lt;&lt;if settings.sph&gt;&gt;She seems to be very turned on, and you wonder for a moment whether your tiny dick is even satisfying her, but judging by the sounds she&#39;s making she definitely seems to be enjoying herself.&lt;&lt;else&gt;&gt;She seems to be very turned on, and you find that you&#39;re able to push your ?dick quite deep. You look down for a moment, appreciating the sight of her stretching around your shaft.&lt;&lt;/if&gt;&gt;?nl

As you continue to thrust inside her she locks eyes with you. Even as she is moaning in pleasure, she&#39;s still smiling. Barely believing that you get to do this with her, you reach down and kiss her deeply. As you pull away again, she lets out another loud moan.?nl

&lt;&lt;if settings.sph&gt;&gt;
    You only moved back a little bit but it was enough for your ?penis to slip out of her vagina and collide awkwardly with her labia as you thrust forwards again. You both stop for a moment to try and get you inserted again.

    &lt;&lt;rosa&gt;&gt;Oops! I guess it slips out accidentally quite often at your size, right? Here, let me get it...&lt;&lt;/rosa&gt;&gt;

    Her face still full of lust, it seems like her words genuinely aren&#39;t intended to be hurtful but merely factual. She&#39;s actually right though, this does happen more often to you but it feels different now to have that pointed out without feeling judged for it.?nl
    
    She deftly guides your ?penis back into her and you continue where you left off, giving shallow thrusts into her.?nl
&lt;&lt;else&gt;&gt;
    &lt;&lt;rosa&gt;&gt;&lt;i&gt;You&lt;/i&gt; feel so good, ?player...&lt;&lt;/rosa&gt;&gt;
&lt;&lt;/if&gt;&gt;

Still wanting to be closer to her, you wrap your arms around her and pull her into an embrace. As you do so this pushes your ?dick deeper into her, and you let out an involuntary moan. You begin to pull her body onto your ?dick, the pleasure immense with each thrust.

&lt;&lt;rosa&gt;&gt;Oh, fuck, ?player!&lt;&lt;/rosa&gt;&gt;

You increase the speed of your movements until you are slamming into her, both of you moaning loudly. You reach a hand down and massage her clit, the wetness immediately coating your fingers as you rub her. It doesn&#39;t take long until she seems to reach her peak and you feel the waves of pleasure move across her as she tightens repeatedly around your ?dick. The sight of her orgasming around you pushes you to your own peak and you moan loudly as your semen spurts inside her.

&lt;&lt;player&gt;&gt;Fuck, ?Rosa...&lt;&lt;/player&gt;&gt;

You both breathe heavily for many moments, kissing as you come down from your orgasms. Gently, you pull your ?dick out of her and collapse next to her on the bed. She turns to look at you and giggles conspiratorially, still catching her breath. 

&lt;&lt;rosa&gt;&gt;That...was...amazing...&lt;&lt;/rosa&gt;&gt;

You have to laugh with her.

&lt;&lt;player&gt;&gt;You&#39;re amazing, ?Rosa...&lt;&lt;/player&gt;&gt;

You lay there in the bed together, chatting and laughing until you both grow drowsy. You drift happily into sleep, wishing that every night could be like this. 

&lt;&lt;if isMemory()&gt;&gt;
    &lt;&lt;decision &#39;Get pulled out of the memory&#39; &#39;Memory End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;decision &#39;Fall asleep&#39; &#39;Sleep&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="345" name="Rosa Sex Morning After" tags="" position="600,4350" size="100,100">You wake to the early morning sunlight and blink as you look around your room. You see ?Rosa quietly slipping her work dress on, enjoying a glimpse of her bare breasts as she does. She looks up and smiles at you. 

&lt;&lt;rosa&gt;&gt;Oh, good morning, ?player! I&#39;m just sneaking out before everyone else wakes up.&lt;&lt;/rosa&gt;&gt;

She leans down and gives you a long kiss.

&lt;&lt;player&gt;&gt;I had a lovely time last night, ?Rosa.&lt;&lt;/player&gt;&gt;

&lt;&lt;rosa&gt;&gt;So did I, ?player. I hope we can...do it again sometime.&lt;&lt;/rosa&gt;&gt;

She smiles at you and slips out of the room, leaving you to slowly wake in the growing light.

&lt;&lt;decision &#39;Go on with your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="346" name="Sybille" tags="" position="725,4350" size="100,100">&lt;&lt;if $location is &#39;Dungeons&#39;&gt;&gt;
    &lt;&lt;if getTime() === &#39;morning&#39; and hasQuest(&#39;interrogate-assassin&#39;)&gt;&gt;
        &lt;&lt;decision &#39;See what ?Sybille\&#39;s next plan is&#39; &#39;Sybille Interrogate Assassin 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;if getTime() === &#39;night&#39;&gt;&gt;
            &lt;&lt;decision &#39;Try to find ?Sybille&#39; &#39;Sybille Night&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;if hasQuest(&#39;find-poet-2&#39;)&gt;&gt;
            &lt;&lt;decision &#39;Ask ?Sybille about the anonymous poems&#39; &#39;Orson Poems Ask Sybille&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;if questStep(&#39;princess-lessons-intro&#39;) is 2&gt;&gt;
            &lt;&lt;decision &#39;Discuss your... Princess training&#39; &#39;Sybille Princess Training Intro&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;decision &#39;?Sybille is here, doing her work in the dungeons&#39; &#39;Sybille Dungeons&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="347" name="Sybille Peeping End" tags="" position="850,4350" size="100,100">&lt;&lt;decision &quot;Leave the dungeons and head to bed&quot; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="348" name="Sybille Acknowledgement" tags="" position="975,4350" size="100,100">&lt;&lt;acknowledgement Sybille&gt;&gt;
    &lt;&lt;mention assassination&gt;&gt;
        Before you can answer she continues herself.
        &lt;&lt;sybille&gt;&gt;I must inform you that your would-be assassin has been locked here in the dungeons. I am currently in the process interrogating him.&lt;&lt;/sybille&gt;&gt;
    &lt;&lt;mention status&gt;&gt;
        &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
            ?Sybille eyes you up and down. She is very obviously looking at the changes to your body.
            &lt;&lt;sybille&gt;&gt;I see the potion ?Morgana made has had some effect on you.&lt;&lt;/sybille&gt;&gt;
            Distraught by how she knows of this, you reply slightly shocked.
            &lt;&lt;player&gt;&gt;?Sybille, how do you know about this? I thought ?Morgana wouldn&#39;t tell anyone of this!&lt;&lt;/player&gt;&gt;
            She tries to calm you down as you are embarrassed.
            &lt;&lt;sybille&gt;&gt;She didn&#39;t. It is simply my job to know what is happening in this place. Fear not, ?title, your secret is safe with me. If you wish to know, I think this transformation quite suits you.&lt;&lt;/sybille&gt;&gt;
        &lt;&lt;elseif face() is &#39;andro&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;fem&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;man&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
&lt;&lt;/acknowledgement&gt;&gt;</tw-passagedata><tw-passagedata pid="349" name="Sybille Dungeons" tags="" position="1100,4350" size="100,100">You see ?Sybille here, sitting at a desk in the room just outside the dungeons. She&#39;s writing something in a file. As soon as you approach, she closes the folder and greets you.
&lt;&lt;sybille&gt;&gt;Hello, ?title. What brings you to this part of the castle?&lt;&lt;/sybille&gt;&gt;
&lt;&lt;include &#39;Sybille Acknowledgement&#39;&gt;&gt;

&lt;&lt;if hasQuest(&#39;princess-lessons&#39;) and !hasCounter(&#39;sybille-training&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Tell her you are here for a training session&#39;&gt;&gt;
        &lt;&lt;include &#39;Sybille Princess Training&#39;&gt;&gt;
        &lt;&lt;decisionicon comport&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasQuest(&#39;sybille-note&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Mention the note she left&#39; &#39;Sybille Assassination Investigation&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;elseif getTime() === &#39;morning&#39; and hasQuest(&#39;sybille-tavern&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Tell her you\&#39;re ready for her plan&#39; &#39;Sybille Tavern Preparation&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Just passing by&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;I was simply passing by, I was curious to see what you were up to, ?Sybille.&lt;&lt;/player&gt;&gt;
    &lt;&lt;sybille&gt;&gt;Of course, ?title. I would like to show you around the place more but I fear I must insist this is not really a place for you. Perhaps I could introduce you to the dungeons sometime in the future should you still be curious.&lt;&lt;/sybille&gt;&gt;
    You are slightly disappointed but you don&#39;t feel the need to press the issue.
    &lt;&lt;player&gt;&gt;That sound good, ?Sybille. I will leave you to your work now.&lt;&lt;/player&gt;&gt;
    &lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="350" name="Sybille Night" tags="" position="1225,4350" size="100,100">&lt;&lt;addcounter &#39;sybille-night&#39; 2&gt;&gt;
&lt;&lt;if not hasTag(&#39;sybille-peeped&#39;)&gt;&gt;
    Descending the steps toward the dungeon, you see that ?Sybille&#39;s desk is dark and empty. Candlelight flickers from deeper within the dungeon, and a low sound echoes through the stone hallways. It sounds like moaning, though you&#39;re not sure whether from pain or pleasure.
&lt;&lt;else&gt;&gt;
    You once again see ?Sybille&#39;s empty desk and gather that she must be hard at work in the dungeon. You can creep closer and find a place to watch.
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &quot;Creep closer to watch ?Sybille at her work&quot; depravity small&gt;&gt;
    &lt;&lt;addsin &#39;peeping&#39;&gt;&gt;
    &lt;&lt;addtag &#39;sybille-peeped&#39;&gt;&gt;
    &lt;&lt;if !hasVisited(&#39;Sybille Peeping 1&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Sybille Peeping 1&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Sybille Peeping 2&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Sybille Peeping 2&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Sybille Peeping 3&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Sybille Peeping 3&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Sybille Training 1&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Sybille Training 1&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;include `either(&#39;Sybille Peeping 1&#39;, &#39;Sybille Peeping 2&#39;, &#39;Sybille Peeping 3&#39;, &#39;Sybille Training 1&#39;)`&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Retreat quietly back up the stairs&quot; &#39;Bedtime&#39; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="351" name="Sybille Peeping 1" tags="spicy" position="100,4475" size="100,100">You sneak further into the dungeons, staying hidden in the shadows. From the darkness, you make out a white-haired figure standing inside one of the locked dungeon cells. This must be ?Sybille, but instead of her usual black dress, she is now wearing a skin-tight black leather suit that reveals every curve of her body. Your eyes linger over her elegant shape for a moment before you realize she is standing over another figure.

&lt;&lt;img &quot;sybille/sybille_dominatrix_{theme}.jpg&quot;&gt;&gt;

&lt;&lt;sybille&gt;&gt;Do you like this, prisoner? I thought I ordered you to &lt;i&gt;moan&lt;/i&gt; when your mistress touches you. This transgression of yours will require punishment.&lt;&lt;/sybille&gt;&gt;

In the dim candlelight you can just make out that the prisoner is a dark-haired woman. She is on her hands and knees on the cold stone ground, unclothed except for a set of manacles around her wrists and a blindfold around her eyes. She is faced away from you. You can see her small asshole and the soft folds below, shiny with wetness.?nl

The prisoner moans loudly in pleasure as ?Sybille whips her ass, leaving red marks behind.

&lt;&lt;sybille&gt;&gt;I see how wet you are, prisoner. I know you want me to touch you. Stand up and spread your legs.&lt;&lt;/sybille&gt;&gt;

The prisoner stands up and ?Sybille locks her wrists to metal rings set into the dungeon cell wall. The prisoner moans as she spreads her legs submissively.?nl

?Sybille runs the end of her whip down the prisoner&#39;s body, moving over the curve of her breasts and stopping just before the space between her legs. 

&lt;&lt;sybille&gt;&gt;Do you want your mistress to touch you, prisoner?&lt;&lt;/sybille&gt;&gt;

The prisoner opens her mouth to speak, but ?Sybille immediately whips her again, this time across the breasts.

&lt;&lt;sybille&gt;&gt;I told you not to speak, girl. You are only allowed to moan.&lt;&lt;/sybille&gt;&gt;

The prisoner lets out a load moan as the whip hits and nods forcefully.?nl

?Sybille retrieves a small set of metal clamps that had been hanging on the wall and clips them to the prisoner&#39;s erect nipples. The woman cries out in a mixture of pain and pleasure.

&lt;&lt;sybille&gt;&gt;I will allow you to speak to your mistress but one time. If you want me to touch you, you must whisper into my ear all that you know about Master ?Leopold&#39;s private affairs.&lt;&lt;/sybille&gt;&gt;

?Sybille leans her head expectantly toward the prisoner&#39;s mouth. You watch with amazement as the woman begins to whisper into ?Sybille&#39;s ear, her legs shaking in orgasmic anticipation. Is this how ?Sybille acquires her information??nl

After a few moments, ?Sybille straightens and smiles dangerously.

&lt;&lt;sybille&gt;&gt;That&#39;s a good prisoner. You deserve to be rewarded.&lt;&lt;/sybille&gt;&gt; 

?Sybille trails a hand down the woman&#39;s body, moving torturously slowly, until she reaches the wetness between her legs. She slowly inserts a finger into the prisoner&#39;s pussy. The prisoner moans again, barely able to remain standing on her shaky legs. ?Sybille begins to fuck the woman with her fingers, her other hand rubbing her wet clit.

&lt;&lt;sybille&gt;&gt;Since you are a good little prisoner, you will cum when I tell you to. Until then, you are not allowed to cum.&lt;&lt;/sybille&gt;&gt;

The prisoner barely manages to nod, her body moving in waves of pleasure as ?Sybille moves between her legs.

&lt;&lt;sybille&gt;&gt;Not yet, girl...&lt;&lt;/sybille&gt;&gt;

The woman&#39;s moans become louder as she is clearly approaching orgasm. She slides down the wall slightly, pushing herself harder onto ?Sybille&#39;s fingers as her legs lose the ability to hold her upright.

&lt;&lt;sybille&gt;&gt;Not quite yet, good little prisoner...&lt;&lt;/sybille&gt;&gt;

?Sybille&#39;s hands are moving furiously, and the prisoner&#39;s moans are now echoing forcefully through the dungeon.

&lt;&lt;sybille&gt;&gt;Good prisoner. Cum for your mistress.&lt;&lt;/sybille&gt;&gt;

The woman gives a final shout as she cums, her body rippling over ?Sybille&#39;s fingers as her orgasm hits her in a series of waves. Her legs give out and she hangs from her manacles, exhausted.

&lt;&lt;sybille&gt;&gt;You have pleased your mistress, prisoner. Perhaps I will return to you tomorrow, if you are lucky.&lt;&lt;/sybille&gt;&gt;

As ?Sybille begins to turn from the prisoner, you realize that this is your cue to leave.

&lt;&lt;include &#39;Sybille Peeping End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="352" name="Sybille Peeping 2" tags="spicy" position="225,4475" size="100,100">&lt;&lt;addtag &#39;lumberjack-peeped&#39;&gt;&gt;

You sneak deeper into the dungeons until you find ?Sybille inside an unlocked dungeon cell. She is standing straddled above a man who is lying on the floor. From your position, you can see that he is large, burly, and muscled, with ruddy skin and a bushy beard. He is currently gagged and naked except for a black leather harness that attaches to a metal ring that is snug around the base of his large, hard cock. 

&lt;&lt;if settings.sph&gt;&gt;
    Before you can even imagine wearing such a ring yourself, you realize it would be impossible. Your own penis is small enough that the ring would simply fall off.
&lt;&lt;/if&gt;&gt;?nl
Sybille is once again wearing the black dominatrix outfit.

&lt;&lt;img &quot;sybille/sybille_dominatrix_{theme}.jpg&quot;&gt;&gt;

&lt;&lt;sybille&gt;&gt;That&#39;s a good boy. Your mistress enjoys seeing you become so hard.&lt;&lt;/sybille&gt;&gt; 

?Sybille lifts a foot and slowly presses her black leather boot onto the large man&#39;s penis. Despite the aggressiveness of the act, you&#39;re surprised at how careful ?Sybille is with her movements. She is obviously not trying to hurt the man.

&lt;&lt;sybille&gt;&gt;I think you deserve a special treat this time, my little woodcutter, considering you have brought me such &lt;i&gt;valuable&lt;/i&gt; information recently.&lt;&lt;/sybille&gt;&gt;

From the floor, the man lets out a low moan through his gag. Underneath ?Sybille&#39;s foot, his cock twitches.

&lt;&lt;sybille&gt;&gt;You are a lucky boy. Today, your mistress will allow you to pleasure &lt;i&gt;her&lt;/i&gt;.&lt;&lt;/sybille&gt;&gt;

You watch as ?Sybille, still straddling the man, undoes a series of small buttons around the crotch of her black leather suit. As the suit opens it reveals a small tuft of white hair and a glimpse of her soft, parted lips.?nl

She removes the man&#39;s gag and lowers herself gracefully onto his mouth. He begins to lick and suck at her clit, eager and sloppy. ?Sybille throws her head back with a sigh of pleasure.

&lt;&lt;sybille&gt;&gt;Ahh, that&#39;s my good little woodcutter. You exist to serve your mistress.&lt;&lt;/sybille&gt;&gt;

You watch for several minutes as ?Sybille rides the man&#39;s face, letting out soft moans. The man&#39;s cock is almost bursting out of its metal ring now, and he too is moaning into her.

&lt;&lt;sybille&gt;&gt;Fuck, my good little fuck-toy...&lt;&lt;/sybille&gt;&gt;

The man increases his speed, his face now shining with wetness, as ?Sybille pushes herself hungrily into him. 

&lt;&lt;sybille&gt;&gt;Mmm, keep going, boy...&lt;&lt;/sybille&gt;&gt;

With a final thrust of her hips against the man&#39;s mouth, ?Sybille cries out softly as she orgasms, her back arching and her mouth open in bliss. Beneath her, the man moans low into her as his own cock explodes. Cum shoots into the air, splattering over his body.?nl

After catching her breath for a few moments, ?Sybille stands up slowly and surveys the man with a smile. She drags a boot across his chest, smearing his cum over his skin.

&lt;&lt;sybille&gt;&gt;I see you have made a mess of yourself. I will allow it this time, since you performed so well for your mistress, but I will not be so lenient next time.&lt;&lt;/sybille&gt;&gt;

As ?Sybille begins to rebutton her suit, you suspect it is again time to leave.

&lt;&lt;include &#39;Sybille Peeping End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="353" name="Sybille Peeping 3" tags="spicy" position="350,4475" size="100,100">The sound of a woman moaning leads you deeper in the dungeons, to a familiar cell. ?Sybille is inside, dressed in her tight black leather suit. The dark-haired woman prisoner you saw before is tied to a bare wooden cot with a series of intricate knots. She is naked, in a prostrate position, her face on the cot and her ass facing upward.

&lt;&lt;img &quot;sybille/sybille_dominatrix_{theme}.jpg&quot;&gt;&gt;

&lt;&lt;sybille&gt;&gt;I see how much you are enjoying this, prisoner. I am sure you want nothing more than for me to touch you right now.&lt;&lt;/sybille&gt;&gt;

The woman moans as ?Sybille gently moves a large white feather across her clit, teasing her. Even from the shadows, you can see the space between the woman&#39;s legs is shining wet and swollen with arousal.

&lt;&lt;sybille&gt;&gt;I want to hear you beg.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;say &#39;Prisoner&#39;&gt;&gt;Please, mistress... Please touch me...&lt;&lt;/say&gt;&gt;

?Sybille smiles, withdrawing the feather. The woman moans, begging louder.

&lt;&lt;sybille&gt;&gt;You belong to your mistress, prisoner. I decide when you feel pleasure.&lt;&lt;/sybille&gt;&gt;

Breathing heavily, the woman moves within her bonds, searching desperately for stimulation.

&lt;&lt;say &#39;Prisoner&#39;&gt;&gt;Yes, mistress... Please touch me, please...&lt;&lt;/say&gt;&gt;

?Sybille strokes the woman&#39;s clit with the feather again. The woman&#39;s moans grow louder and louder as ?Sybille teases her. Just before the moans reach a crescendo, she removes the feather once more.?nl

Though her back is turned to you, you swear you hear a smile in ?Sybille&#39;s voice when she speaks.

&lt;&lt;sybille&gt;&gt;This is the third time you have come to watch me at my work, ?title. Why don&#39;t you step out of the shadows and come closer?&lt;&lt;/sybille&gt;&gt;

You freeze, as though ?Sybille might forget you&#39;re there if you stay quiet. How did she know you were watching this whole time, and why didn&#39;t she mention it before? You could run out of the dungeons right now and pretend this never happened... On the other hand, she seems to be inviting you to join this exciting situation; perhaps you should step out of the shadows... 

&lt;&lt;decision &#39;Step forward and join ?Sybille&#39; &#39;Sybille Peeping 3 Join&#39; depravity medium&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Flee out of the dungeons&#39; &#39;Hallway&#39; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="354" name="Sybille Peeping 3 Join" tags="spicy" position="475,4475" size="100,100">You step forward from the shadows as ?Sybille turns to face you. Her smile grows wider. 

&lt;&lt;sybille&gt;&gt;Step into the cell, then, ?title.&lt;&lt;/sybille&gt;&gt;

She produces a key from a small pocket in her suit and unlocks the cell door. As you step inside, still processing how ?Sybille could have known about all your little excursions to the dungeons, she looks you up and down with an exacting eye.

&lt;&lt;sybille&gt;&gt;This prisoner needs punishing, ?title. She may yet tell us valuable information. Would you prefer to join in, or watch?&lt;&lt;/sybille&gt;&gt;

You look at the prisoner, still breathing heavily in her vulnerable state. Could you be someone so dominant, and do with her as you wish? Perhaps there is also something enticing about imagining yourself in her place, the one being dominated...

&lt;&lt;decision &#39;Help punish the prisoner&#39; &#39;Sybille Peeping 3 Dom&#39; dominance medium&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Watch, imagining yourself as the prisoner&#39; &#39;Sybille Peeping 3 Sub&#39; submissiveness medium&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="355" name="Sybille Peeping 3 Dom" tags="spicy" position="600,4475" size="100,100">&lt;&lt;player&gt;&gt;I will assist, ?Sybille.&lt;&lt;/player&gt;&gt;

A flash of something like satisfaction flits across ?Sybille&#39;s face. She pulls a black leather flogger from the wall and hands it to you.

&lt;&lt;sybille&gt;&gt;Try this, ?title. Strike her on the buttocks, here. You must be firm, but gentle in your punishment. True masters know the most information is learned from prisoners who are begging for more.&lt;&lt;/sybille&gt;&gt;

You grasp the flogger and release it onto the woman&#39;s ass. She moans, straining against her bonds in pleasure. It&#39;s a new feeling, being so intimately in control of someone&#39;s body in this way. You can see why ?Sybille seems to like it so much.

&lt;&lt;sybille&gt;&gt;Do you like this, prisoner? The prince himself is punishing you. You are a lucky girl.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;say &#39;Prisoner&#39;&gt;&gt;?Title, I am yours to do with as you wish...&lt;&lt;/say&gt;&gt;

You continue striking the woman with the flogger, enjoying the flush of pink spreading across her ass. She moans louder with each hit. Behind you, ?Sybille watches with a dark smile.

&lt;&lt;sybille&gt;&gt;Tell your prince what you want, prisoner.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;say &#39;Prisoner&#39;&gt;&gt;Let me cum, ?title... Please, let me cum...&lt;&lt;/say&gt;&gt;

While you continue flogging her, ?Sybille pulls a phallic leather object from the wall and runs it slowly along the prisoner&#39;s back and across her face.

&lt;&lt;sybille&gt;&gt;You want to cum, prisoner? You know what you must give me.&lt;&lt;/sybille&gt;&gt;

?Sybille leans close to the prisoner&#39;s mouth. The woman is now shaking, a brief touch away from orgasm. She whispers desperately into ?Sybille&#39;s ear.?nl

?Sybille straightens and smiles at you, looking satisfied.

&lt;&lt;sybille&gt;&gt;Shall we allow her to cum, ?title?&lt;&lt;/sybille&gt;&gt;

Is ?Sybille really letting you make this decision? It could feel powerful, denying the prisoner her peak after so much teasing and build-up. But it could also be powerful to be the one to allow her to orgasm, to watch her body move through the pleasure at your command...

&lt;&lt;decision &#39;Allow the prisoner to cum&#39; &#39;Sybille Peeping 3 Dom Allowed&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Do not allow the prisoner to cum&#39; &#39;Sybille Peeping 3 Dom Denied&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="356" name="Sybille Peeping 3 Dom Allowed" tags="spicy" position="725,4475" size="100,100">&lt;&lt;player&gt;&gt;Good prisoners should be rewarded, ?Sybille.&lt;&lt;/player&gt;&gt;

?Sybille nods at you.

&lt;&lt;sybille&gt;&gt;The prince is right, prisoner. You have earned your pleasure.&lt;&lt;/sybille&gt;&gt;

?Sybille runs the leather dildo down the prisoner&#39;s body and slowly pushes it inside of her. The woman cries out in pleasure, her body moving in a wave of ecstasy. You are distracted for a moment as you watch the prisoner&#39;s swollen lips stretch around the thick phallus, shining with slippery wetness.?nl 

Shaking your head, you refocus on your task. As you continue to flog the prisoner, her moans grow louder with each impact.  

&lt;&lt;if settings.sph&gt;&gt;
    You have to admit that being in control here is turning you on, though even the hardness in your pants is not enough to create even a small bulge.
&lt;&lt;else&gt;&gt;
    You have to admit that being in control here is turning you on, and you feel a bulge growing in your pants.
&lt;&lt;/if&gt;&gt;

&lt;&lt;sybille&gt;&gt;Good little prisoner.&lt;&lt;/sybille&gt;&gt;

?Sybille pushes the dildo into the woman rhythmically, drawing cries of pleasure each time it reaches its deepest point.  With practiced, coordinated movement, her other hand rubs the woman&#39;s clit. She increases her speed and soon the woman&#39;s cries are echoing through the dungeon.

&lt;&lt;sybille&gt;&gt;You may cum now.&lt;&lt;/sybille&gt;&gt;

With a great shudder, the woman orgasms around the dildo as a final moan escapes her lips. She collapses as much as she can while tied up, her skin still shining pink in the places where you flogged her.?nl

?Sybille turns to you and holds out a hand for the flogger.

&lt;&lt;sybille&gt;&gt;Excellent work, ?title. I think that concludes your education for today. I will see to it that the prisoner is made presentable again.&lt;&lt;/sybille&gt;&gt;

You can hardly believe what you just took part in, but at the same time you have to admit the whole experience was intoxicating. Perhaps you might return again some time...

&lt;&lt;include &#39;Sybille Peeping End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="357" name="Sybille Peeping 3 Dom Denied" tags="spicy" position="850,4475" size="100,100">&lt;&lt;player&gt;&gt;No, I do not think every little secret should be so highly rewarded, ?Sybille.&lt;&lt;/player&gt;&gt;

?Sybille gives you a long look. If you didn&#39;t know better, you might think she was impressed.

&lt;&lt;sybille&gt;&gt;Indeed not, ?title.&lt;&lt;/sybille&gt;&gt;

The prisoner struggles futilely against her bonds. 

&lt;&lt;say &#39;Prisoner&#39;&gt;&gt;Please, ?title! Please let me cum!&lt;&lt;/say&gt;&gt;

You flog her again, this time a touch harder, to remind her of her place.

&lt;&lt;if settings.sph&gt;&gt;
    You have to admit that being in control here is turning you on, though even the hardness in your pants is not enough to create even a small bulge.
&lt;&lt;else&gt;&gt;
    You have to admit that being in control here is turning you on, and you feel a bulge growing in your pants.
&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Not today, prisoner.&lt;&lt;/player&gt;&gt;

?Sybille runs the leather phallus along the woman&#39;s body again, stopping just before reaching the space between her legs. The woman moans in anticipation, then in disappointment.

&lt;&lt;sybille&gt;&gt;Perhaps you will be luckier tomorrow, girl.&lt;&lt;/sybille&gt;&gt;

?Sybille turns to you and holds out a hand for the flogger.

&lt;&lt;sybille&gt;&gt;Excellent work, ?title. I think that concludes your education for today. I will see to it that the prisoner is cleaned up.&lt;&lt;/sybille&gt;&gt;

You can hardly believe what you just took part in, but at the same time you have to admit the whole experience was intoxicating. Perhaps you might return again some time...

&lt;&lt;include &#39;Sybille Peeping End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="358" name="Sybille Peeping 3 Sub" tags="spicy" position="975,4475" size="100,100">&lt;&lt;player&gt;&gt;I would prefer to watch you as you work.&lt;&lt;/player&gt;&gt;

?Sybille smiles, as though you are confirming what she already knows. She turns back to the prisoner.

&lt;&lt;sybille&gt;&gt;You are lucky, prisoner. Today the prince himself is watching your punishment.&lt;&lt;/sybille&gt;&gt;

She retrieves a black leather flogger from the wall and begins to strike the woman&#39;s ass. The woman moans, straining against her bonds in pleasure. You imagine yourself in her place, tied with ropes, the feeling of the flogger hitting your own bare skin.

&lt;&lt;say &#39;Prisoner&#39;&gt;&gt;Mistress, I am yours to do with as you wish...&lt;&lt;/say&gt;&gt;

?Sybille continues hitting the woman with the flogger, eliciting a flush of pink across her buttocks. The woman moans louder with each hit. You imagine your own ass burning from the impact of the flogger, the sting as it hits your flesh repeatedly.?nl

&lt;&lt;if settings.sph&gt;&gt;
    You have to admit that imagining yourself in the prisoner&#39;s place is turning you on, though your tiny penis causes no bulge in your pants. Even ?Sybille would have no idea how your body is reacting right now.
&lt;&lt;else&gt;&gt;
    You have to admit that imagining yourself in the prisoner&#39;s place is turning you on, and you feel a bulge growing in your pants.
&lt;&lt;/if&gt;&gt;

&lt;&lt;sybille&gt;&gt;Tell your mistress what you want, prisoner.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;say &#39;Prisoner&#39;&gt;&gt;Let me cum, mistress... Please, let me cum...&lt;&lt;/say&gt;&gt;

&lt;&lt;sybille&gt;&gt;You want to cum, prisoner? You know what you must give me.&lt;&lt;/sybille&gt;&gt;

?Sybille leans close to the prisoner&#39;s mouth. The woman is now shaking and sweaty with desire. She whispers fervently into ?Sybille&#39;s ear. After a moment, ?Sybille straightens, looking satisfied. 

&lt;&lt;sybille&gt;&gt;Since the prisoner has given me what I want, I will reward her. Do you know how, ?title?&lt;&lt;/sybille&gt;&gt;

?Sybille runs the flogger gently, tantalizingly along your shoulder and down your arm. She does not strike, but simply allows you to feel its touch. You are surprised at how arousing this simple gesture of power is.

&lt;&lt;player&gt;&gt;Ah- well, I can guess...&lt;&lt;/player&gt;&gt;

?Sybille smiles at you, withdrawing the flogger. She hangs the flogger back on the wall and retrieves a phallic leather object.

&lt;&lt;sybille&gt;&gt;What she wants is to be dominated, ?title. You might know something about that.&lt;&lt;/sybille&gt;&gt;

?Sybille turns away from you. Slowly, gently, she runs the leather phallus down the prisoner&#39;s body and pushes it inside of her. The woman moans, moving against her bonds in a wave of pleasure. For a moment, you imagine someone doing the same to you.

&lt;&lt;sybille&gt;&gt;Good little prisoner...&lt;&lt;/sybille&gt;&gt;

?Sybille pushes the dildo into the woman rhythmically, drawing cries of ecstasy each time it reaches its deepest point. With practiced, coordinated movement, her other hand rubs the woman&#39;s clit. She increases her speed and soon the woman&#39;s cries are echoing through the dungeon. You find yourself, in some way, jealous of this prisoner.

&lt;&lt;sybille&gt;&gt;You may cum now.&lt;&lt;/sybille&gt;&gt;

With a great shudder, the woman orgasms around the dildo as a final moan escapes her lips. She collapses as much as she can while tied up, her skin still shining pink in the places where ?Sybille flogged her.?nl

?Sybille turns to you, a smirk on her lips.

&lt;&lt;sybille&gt;&gt;I hope you learned something while watching me work, ?title. I think that concludes your education for today. I will see to it that the prisoner is cleaned up.&lt;&lt;/sybille&gt;&gt;

You can hardly believe that you just watched this interaction, but at the same time you have to admit the whole experience was intoxicating. Perhaps you might return again some time...

&lt;&lt;include &#39;Sybille Peeping End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="359" name="Sybille Assassination Investigation" tags="" position="1100,4475" size="100,100">&lt;&lt;player&gt;&gt;I received the note you left me. What&#39;s with all the secrecy, ?Sybille? Did you learn anything about the assassin?&lt;&lt;/player&gt;&gt;
She stands in front of you clasping her hands as she looks at you with an intense expression.

&lt;&lt;sybille&gt;&gt;I&#39;m sorry, ?title. Normally I would announce this kind of news to the entire council during a meeting but the nature of my discovery has lead me to believe it to be best to share it with only you.&lt;&lt;/sybille&gt;&gt;

You stare at her with a puzzled look on your face as you wait for her to explain further.

&lt;&lt;sybille&gt;&gt;Unfortunately, after interrogating the would-be assassin, I now have reason to believe the plan behind this failed attempt on your life did not originate from some other nation but instead was orchestrated by another member of the royal council.&lt;&lt;/sybille&gt;&gt;

Shocked, you take a step back as you look at her in disbelief.

&lt;&lt;player&gt;&gt;?Sybille, are you certain? Why would someone betray me like that?&lt;&lt;/player&gt;&gt;

&lt;&lt;sybille&gt;&gt;I&#39;m afraid I am quite certain about this, the assassin shared about a meeting with his secret benefactor, clearly describing a royal councillor. Curiously, he can&#39;t seem to give any specifications that narrow it down more than that. You can see now why I opted not to share this with the rest of the councillors now and instead wanted to discuss this only with you, ?title.&lt;&lt;/sybille&gt;&gt;

You&#39;re not quite sure what to say, this news troubles you deeply.

&lt;&lt;sybille&gt;&gt;As for the motive behind such a heinous act, I am not quite sure why one of the councillors would want this. None of the councillors would stand to gain with your demise. Currently, since ?Andreas has ordered the entire castle on lockdown, there&#39;s no opportunity for something like this to happen again. You are - of course - under constant protection here.&lt;&lt;/sybille&gt;&gt;

You look away slightly concerned, the castle may be entirely secured but your new secret hobby of disguising yourself and sneaking out of the place is very likely a safety concern... As you look back at her you catch a glint in her eyes and the slightest hint of a knowing smile.

&lt;&lt;sybille&gt;&gt;Is something troubling you, ?title? Something you would like to share?&lt;&lt;/sybille&gt;&gt;

Well... Perhaps it&#39;s best to share this with her...

&lt;&lt;player&gt;&gt;Well, ?Sybille, I have actually been...&lt;&lt;/player&gt;&gt;

You stumble over your words as you feel like a kid that has to admit to their bad behaviour.

&lt;&lt;sybille&gt;&gt;Sneaking off in a disguise together with ?Morgana?&lt;&lt;/sybille&gt;&gt;

&lt;&lt;player&gt;&gt;Wha... How did you know?&lt;&lt;/player&gt;&gt;

You have a look of utter surprise on your face as soon as she mentions this, how does she know about this?

&lt;&lt;sybille&gt;&gt;It is my job to know, ?title. And fear not, your secrets are safe with me, of course. As for the safety concern, I think ?Morgana is right actually, from what I&#39;ve gathered your disguise works quite well and perhaps ?Andreas is being overly protective right now.&lt;&lt;/sybille&gt;&gt;

You nod at her.
&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    You feel yourself blush at the thought that ?Sybille mentions your kitchen maid outfit like that. 
&lt;&lt;/if&gt;&gt;

&lt;&lt;sybille&gt;&gt;We cannot allow any council members to catch wind of what we know. What we need now is more information. Luckily, these little excursions of yours can prove to be useful to us right now.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;player&gt;&gt;H- how so?&lt;&lt;/player&gt;&gt;

&lt;&lt;sybille&gt;&gt;&lt;&lt;fullname andreas&gt;&gt; has a fondness for the ale at the local tavern and likes to do some of his dealings there as well. If you went undercover, working there, you could listen to the conversations. I could even tutor you in the art of spycraft.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;player&gt;&gt;But why me? Why not use any official spy in your network? You must have someone in town, right?&lt;&lt;/player&gt;&gt;

&lt;&lt;sybille&gt;&gt;Yes, many. But unfortunately I cannot depend on them right now. I may be the official royal spymistress but that does not mean other councillors have their own network of information. You are one of the few people I know I can trust right now.&lt;&lt;/sybille&gt;&gt;

Working undercover at the tavern? That sounds extremely far outside of your comfort zone... But then again, getting out of the castle like that does sound very adventurous... You are quite conflicted and unsure what to do...

&lt;&lt;sybille&gt;&gt;Take some time to think it over, ?title. I know it sounds like a dangerous idea but I believe you to be more than capable of it. I urge you to consider the importance of this mission.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;player&gt;&gt;Very well... I will think it over... Thank you for sharing this all with me, ?Sybille.&lt;&lt;/player&gt;&gt;

&lt;&lt;sybille&gt;&gt;Of course, ?title. Please come find me in the morning when you are ready.&lt;&lt;/sybille&gt;&gt;

With that, you exit the dungeons and make your way back to the castle halls. You are quite perplexed by all this. Are you actually going to work at the tavern in order to spy on one of the councillors?

&lt;&lt;decision &#39;Leave ?Sybille&#39; &#39;Hallway&#39;&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
    &lt;&lt;completequest sybille-note&gt;&gt;
    &lt;&lt;startquest sybille-tavern&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="360" name="Sybille Tavern Preparation" tags="" position="1225,4475" size="100,100">&lt;&lt;completequest sybille-tavern&gt;&gt;
You clear your throat as you stammer out the reason you are here.
&lt;&lt;player&gt;&gt;I&#39;m uh- r-ready for your plan ?Sybille.&lt;&lt;/player&gt;&gt;
Great, that was about the confidence level of a sack of potatoes.
&lt;&lt;sybille&gt;&gt;Right. Well today will be simple, you&#39;ll just be giving a quick visit to the tavern to get yourself acquainted with the working environment. Don&#39;t worry, we&#39;ll have plenty of time to make you sound more self-assured later. Did you bring your disguise?&lt;&lt;/sybille&gt;&gt;
You nod at her as you show her your now trusted disguise.
&lt;&lt;sybille&gt;&gt;Splendid. You can get changed here. I will be right back, I have some business down in the dungeon.&lt;&lt;/sybille&gt;&gt;
She opens the drawer of her desk and retrieves some kind of flogger as she stands up and leaves you in her office. The room is dark and the cold cobblestones keep a clear conformity to the dungeons itself, deeper down through the door ?Sybille just left through.?nl
While she&#39;s gone, you suddenly get a spark of curiosity as you look over her now unguarded desk. On it, you see a letter that seems quite interesting and you quickly open it.
&lt;&lt;note&gt;&gt;
    &lt;&lt;title sybille &#39;Lady Whispers&#39;&gt;&gt;,?nl
    Your wish is my command.&lt;br&gt;
    I will happily take on this important friend of yours as a new ?barworker.?nl
    - V
&lt;&lt;/note&gt;&gt;
You read through the strange letter with suspicion. Is this talking about you? Before you get completely lost in thought, you quickly focus back to the task at hand.

&lt;&lt;decision &#39;Change into your disguise&#39; &#39;Sybille Tavern Preparation 2&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="361" name="Sybille Tavern Preparation 2" tags="" position="100,4600" size="100,100">&lt;&lt;outfit disguise&gt;&gt;
You deftly put on the &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;maid dress&lt;&lt;else&gt;&gt;manservant uniform&lt;&lt;/if&gt;&gt;. You&#39;re strangely enough getting quite used to these clothes now, something you&#39;d have never expected before.

As if just on cue, you hear ?Sybille knock on the door to check if you are done before entering.
&lt;&lt;player&gt;&gt;All finished!&lt;&lt;/player&gt;&gt;
She opens the door and enters the room. She moves over and leans against her desk as she eyes you up and down.
&lt;&lt;sybille&gt;&gt;My, that is quite a good disguise, ?title. It looks like my reports were correct&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;, you look very pretty&lt;&lt;/if&gt;&gt;. I highly doubt people will recognise you in this.&lt;&lt;/sybille&gt;&gt;
&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;You blush as she mentions this, does she really think you look pretty in the dress? &lt;&lt;/if&gt;&gt;You nod at her, you feel kind of proud that she actually approves of your disguise.
&lt;&lt;player&gt;&gt;So does this mean I am now officially one of your spies?&lt;&lt;/player&gt;&gt;
A smile draws over her face.
&lt;&lt;sybille&gt;&gt;Hah, well, there is one thing we are missing, ?title. Any good undercover spy needs to have a persona. Normally we would take time to craft an entire backstory but I don&#39;t feel that&#39;s necessary for now. All we need now is a name.&lt;&lt;/sybille&gt;&gt;
A new name? The feeling of using a new name somehow has you quite excited for this whole thing. You look at her as she continues.
&lt;&lt;sybille&gt;&gt;Give yourself a new name, ?title. &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;If you were a woman, what would you want to call yourself?&lt;&lt;else&gt;&gt;Any plausible name is fine.&lt;&lt;/if&gt;&gt;&lt;&lt;/sybille&gt;&gt;
You look at her, quite overwhelmed by this sudden but important decision. &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;The idea of having to pick a feminine name somehow has you feeling quite strange... A thought crosses your mind: would this actually be your name if you were a woman instead?&lt;&lt;/if&gt;&gt;
&lt;&lt;player&gt;&gt;Uhm... a new name, that&#39;s difficult...&lt;&lt;/player&gt;&gt;
You stare towards the cold cobblestone walls as you go over a list of possible names in your head. ?Sybille is patiently waiting for your response. After a while you look at her, a fresh idea in your mind.

&lt;&lt;timed 40ms&gt;&gt;
&lt;&lt;player&gt;&gt;How about &lt;div id=&#39;name-picker&#39;&gt;&lt;&lt;textbox &quot;$player.newname&quot; `hasTag(&#39;crossdresser&#39;) ? &#39;Alexandra&#39; : &#39;James&#39;`&gt;&gt;&lt;/div&gt;?&lt;&lt;/player&gt;&gt;
&lt;&lt;/timed&gt;&gt;

&lt;&lt;decision &#39;Decide on the name&#39;&gt;&gt;
    &lt;&lt;replace &#39;#name-picker&#39; &#39;transition&#39;&gt;&gt;?newname&lt;&lt;/replace&gt;&gt;
    &lt;&lt;replace &quot;#portrait-container&quot;&gt;&gt;&lt;&lt;include &#39;Portrait&#39;&gt;&gt;&lt;&lt;/replace&gt;&gt;
    You look at her as she judges your new name. She stares at you with an intense look, seemingly mulling over your idea very seriously. The anticipation makes you quite nervous. After a mere few seconds that feel much longer to you she has seemingly made her decision as she makes an approving nod.
    &lt;&lt;sybille&gt;&gt;?newname... I like it. It fits you.&lt;&lt;/sybille&gt;&gt;
    Hearing yourself being referenced with this new name has you feeling strangely confident. You&#39;re definitely going to need to get used to refer to yourself like that when you&#39;re disguised from now on.
    &lt;&lt;sybille&gt;&gt;Good, that settles it. You should have everything needed for us to start this little operation. Are you ready to be a spy, ?newname?&lt;&lt;/sybille&gt;&gt;
    &lt;&lt;player&gt;&gt;I- I think so. I&#39;m ready.&lt;&lt;/player&gt;&gt;
    Your reluctance is definitely noticed by ?Sybille but it seems like she accepts that this is the best she&#39;s going to get from you now.
    &lt;&lt;sybille&gt;&gt;Glad to hear it. I have great confidence in you, ?title. And don&#39;t fret too much, today you won&#39;t be doing anything important yet. Simply head to the tavern and my contact will explain everything to you there. The goal is simply to get yourself acquainted with the environment.&lt;&lt;/sybille&gt;&gt;
    You&#39;re not sure if she&#39;s actually telling the truth but hearing her say that she believes in you does give you a bit of confidence regardless.
    &lt;&lt;player&gt;&gt;Sounds like a plan... Well here I go then... Thank you, ?Sybille.&lt;&lt;/player&gt;&gt;
    You say farewell to her as you step out of her office, now wearing your disguise and wielding a brand new name to go along with it.
    &lt;&lt;decision &#39;Head outside&#39; &#39;Sybille Tavern Preparation 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="362" name="Sybille Tavern Preparation 3" tags="" position="225,4600" size="100,100">&lt;&lt;setlocation &#39;Gatehouse&#39;&gt;&gt;
You step into the castle halls and head toward the front gates. Even though you&#39;re quite used to the guards checking you over whenever you leave the castle like this, you still feel anxious as you head in the direction of the exit. Strangely, it looks like you won&#39;t have to deal with any of that today, there seems to be no guard in sight. Curious. You&#39;ve never seen this happen before.?nl
You decide not to mull on the thought for too long as slowly push open the castle gates and carefully peek outside. No guards outside either. It seems like ?Sybille set this up for you to make your exit easier. Though her methods are quite mysterious, you realise it&#39;s pretty nice to have the Royal Spymistress look out for you like this.?nl
&lt;&lt;decision &#39;Exit the castle&#39; &#39;Sybille Tavern Preparation 4&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="363" name="Sybille Tavern Preparation 4" tags="" position="350,4600" size="100,100">&lt;&lt;setlocation &#39;Road&#39;&gt;&gt;
As you exit the castle, you take a breath of fresh air and head down the road towards town. Here you are, dressed like a &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;maid&lt;&lt;else&gt;&gt;servant&lt;&lt;/if&gt;&gt;, on your way to work at the local tavern. It&#39;s a very strange feeling, you&#39;ve never really worked a single day in your life and you never expected to work like this.?nl
You walk down the dirt road, passing the mighty stone walls and leave them behind you. A heap of mixed feelings flow through you in this very moment. Are you even good enough for this whole spying thing? Is it really safe to go out on your own? &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;Why do you actually keep crossdressing like this?&lt;&lt;else&gt;&gt;Why are you pretending to be servant like this?&lt;&lt;/if&gt;&gt; The overwhelming thoughts nearly get to you as you feel your breath quickening, panic setting in...?nl
You stop to lean against a tree, trying to catch your breath before you actually break down. It doesn&#39;t seem to work, countless thoughts of your current situation start flooding your mind and you feel a cold sweat setting in. Your eyes quickly dart around, looking for something to focus on to try and distract yourself. In a moment of careful coincidence, something seems to find you instead.?nl
Like a slow giant, peeking out over the trees, the piercing warmth of a morning sun washes over you. The rising light, both ponderous and sudden, makes you cover your eyes from it&#39;s full might. The morning cold making way for a new dawn. Your panic unexpectedly retreated, a moment of peace catches you off-guard and by force.?nl
Excitement. The word somehow now dangles in your mind. It&#39;s the answer you instinctively cling to. It&#39;s why it doesn&#39;t matter whether&#39;s safe. It&#39;s why you think you&#39;ll make a somewhat decent spy. It&#39;s the &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;frightening &lt;&lt;/if&gt;&gt;answer to why you disguise yourself like this. It excites you. And that is enough.?nl
You take a deep breath and continue your journey down the dirt path, feeling quite different. It feels like a new chapter in your life. Prince ?player, the undercover tavern spy. Or, well, ?newname, actually... 

&lt;&lt;decision &#39;Set out for the tavern&#39; &#39;Chapter&#39;&gt;&gt;
    &lt;&lt;set $chapter = 3&gt;&gt;
    &lt;&lt;set $chaptertitle = &#39;Chapter Three&#39;&gt;&gt;
    &lt;&lt;set $chaptertarget = &#39;Tavern Velma Intro&#39;&gt;&gt;
    &lt;&lt;set $chaptertimeskip = false&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="364" name="Sybille Training 1" tags="spicy" position="475,4600" size="100,100">You creep deep into the dungeons, following a distant sound of metal against stone to an out-of-the-way cell. From the shadows you see ?Sybille with her back turned, her white hair falling down her back as she arranges a collection of torture implements on the wall. Even though her back is still turned, you hear her voice echo off the cold stones.

&lt;&lt;sybille&gt;&gt;Good evening, ?title. You&#39;ve come to watch me at my work again, have you?&lt;&lt;/sybille&gt;&gt;

Her voice makes you jump. You thought you were being totally silent. As if she will forget you&#39;re there, you shrink instinctively further into the shadows.

&lt;&lt;sybille&gt;&gt;Step into the candlelight, ?title. Let me see you.&lt;&lt;/sybille&gt;&gt;

?Sybille turns around, and you see that her skin-tight black leather suit is unbuttoned quite far, revealing a glimpse of her pale breasts.

&lt;&lt;img &quot;sybille/sybille_dominatrix_{theme}.jpg&quot;&gt;&gt;

Entranced by the sight of her body, you step obediently into the flickering light. 

&lt;&lt;player&gt;&gt;I am, um, sorry for intruding. I was simply curious about your...work.&lt;&lt;/player&gt;&gt;

?Sybille gives you a dark smile.

&lt;&lt;sybille&gt;&gt;Yes, you are certainly curious, ?title. I have been rather bored this evening, which is why you find me arranging my tools.&lt;&lt;/sybille&gt;&gt;

Your eyes trail over to the wall, trying to make out what exactly the tools are. In the gloom, you can make out a pair of handcuffs, a whip, chains, and something that looks...like a miniature pillory? ?Sybille follows your gaze.

&lt;&lt;sybille&gt;&gt;Interested in what that does?&lt;&lt;/sybille&gt;&gt;

&lt;&lt;player&gt;&gt;Um, w-well, yes, I suppose I am...&lt;&lt;/player&gt;&gt;

?Sybille steps closer and gives you a careful look. You try unsuccessfully to not stare at her breasts.

&lt;&lt;sybille&gt;&gt;You seem particularly interested in what I do. Perhaps I could give you a sort of...demonstration. You could learn my technique.&lt;&lt;/sybille&gt;&gt;

What is ?Sybille offering? Is she suggesting she could perform her techniques on &lt;i&gt;you&lt;/i&gt;? You stare at her, awkwardly trying to gather your thoughts.

&lt;&lt;sybille&gt;&gt;Try not to drool; I can see you are interested. Step into the cell if you would like to learn more.&lt;&lt;/sybille&gt;&gt;

She turns around and walks back into the cell, turning her back to you again as she pulls the pillory-like device from the wall. Your thoughts race as you consider your options. Should you leave now, and pretend this never happened? Should you step into the cell, and let ?Sybille demonstrate her techniques...on you?&lt;br&gt;

&lt;&lt;decision &#39;Decline her offer&#39; virtue small&gt;&gt;
    &lt;br&gt;This situation has quickly gone too far. You take a step back.

    &lt;&lt;player&gt;&gt;Ah, well, thank you for the offer, ?Sybille, but I think I have to decline.&lt;&lt;/player&gt;&gt;

    Her face is unreadable as she gives you a long look.

    &lt;&lt;sybille&gt;&gt;Of course, ?title. The offer still stands if you change your mind.&lt;&lt;/sybille&gt;&gt;

    You turn and quickly leave the dungeon.

    &lt;&lt;include &#39;Sybille Peeping End&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Accept her offer&#39; &#39;Sybille Training 2&#39; depravity medium&gt;&gt;
&lt;&lt;disableif isInChastity()&gt;&gt;
    You are locked in chastity.
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="365" name="Sybille Training 2" tags="spicy" position="600,4600" size="100,100">The way that ?Sybille utterly commands every interaction is impressive, and you have to admit a bit arousing. You step into the cell after her, somehow both apprehensive and excited.

&lt;&lt;sybille&gt;&gt;You, ?title, are of course not a prisoner. However, my technique is quite similar regardless of my subject.&lt;&lt;/sybille&gt;&gt;

She turns around, holding the small pillory-like item in her hands.

&lt;&lt;sybille&gt;&gt;The key is pleasure. I will always stop, if requested. But my goal is to make it so that my subject wants desperately, with every fiber of their being, for me to continue. That is where I gain control.&lt;&lt;/sybille&gt;&gt;

She looks you up and down. Her gaze feels piercing, as though she can read all your secrets on your face.

&lt;&lt;sybille&gt;&gt;Undress.&lt;&lt;/sybille&gt;&gt;

You feel a jolt at this sudden order, not to mention the indecency of undressing in front of a woman who is technically your employee. Still, there&#39;s something about her that makes you want to comply with her every word. You find yourself removing your clothes, revealing your now-hard ?dick &lt;&lt;if hasBoobs()&gt;&gt;and ?titties&lt;&lt;/if&gt;&gt; to her as you stand there naked.&lt;br&gt;

&lt;&lt;if hasBoobs()&gt;&gt;
    &lt;br&gt;Her eyes slide over your chest, taking in your ?titties with something like a look of satisfaction. She doesn&#39;t comment on them, and you get the sense that she is unsurprised.
&lt;&lt;/if&gt;&gt;

&lt;&lt;sybille&gt;&gt;Part of having control, ?title, is ensuring that the subject cannot satisfy their desires on their own. That&#39;s why I use items like this.&lt;&lt;/sybille&gt;&gt;

She opens the pillory, and you realize suddenly what the holes are for. You stand there motionless as she places your hands through the two exterior holes, and your ?dick and balls through the hole in the middle. Before you even fully register this, she locks the cock pillory and tucks the key into her suit.

&lt;&lt;img &quot;sybille/penis_pillory.jpg&quot;&gt;&gt;

&lt;&lt;sybille&gt;&gt;Now I am in control. What do you call someone who is in control?&lt;&lt;/sybille&gt;&gt;

You feel an odd mixture of pleasure and discomfort as your ?dick strains against the pillory. &lt;&lt;if settings.sph&gt;&gt;It seems as though the center hole is adjustable, so even your tiny dick can be locked inside.&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Um, m-mistress...&lt;&lt;/player&gt;&gt;

?Sybille smiles at you. She pulls a whip from the wall and runs it along your body as you stand there, your ?dick stuffed in the pillory and your hands locked in place. 

&lt;&lt;sybille&gt;&gt;That&#39;s correct, ?title. For now, I am your mistress.&lt;&lt;/sybille&gt;&gt;

Reading the arousal in your face, she draws the whip back and hits it lightly against the soft part of your buttocks. You jump momentarily at the sensation, but the slight sting is surprisingly erotic.

&lt;&lt;sybille&gt;&gt;And a mistress is always in control.&lt;&lt;/sybille&gt;&gt;

She begins to whip you. She is obviously well practiced in this technique, as she easily recognizes when to hit harder and when to hit softer. After many minutes of this, during which she coolly explains her technique to you, you discover a new kind of pleasure in the pain of the whip. You find yourself moaning loudly each time it lands on your red skin.

&lt;&lt;player&gt;&gt;Yes, mistress, that feels so good...&lt;&lt;/player&gt;&gt;

?Sybille smiles, looking pleased.

&lt;&lt;sybille&gt;&gt;Then it is time to move on. Always remind your subject that you are in control.&lt;&lt;/sybille&gt;&gt;

She hangs up the whip, then approaches you slowly. She places a hand on your trapped ?dick and begins to play with it with one hand while the other plays with your nipples. Both sensations find some balance between pleasure and pain, and you moan loudly again. Your ?dick starts to get quite hard, which causes it to strain even more against the pillory.

&lt;&lt;sybille&gt;&gt;Do you like being trapped, ?title? Do you like not being in control of your own body? Do you want to be told when you may feel pleasure?&lt;&lt;/sybille&gt;&gt;

You moan again as her hand expertly massages your trapped ?dick.

&lt;&lt;player&gt;&gt;Yes, mistress, yes...&lt;&lt;/player&gt;&gt;

&lt;&lt;sybille&gt;&gt;Tell me what you want.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;player&gt;&gt;I...I want to cum, mistress...&lt;&lt;/player&gt;&gt;

She smiles darkly at you and slowly pulls the pillory key from her suit. Tantalizingly, she undoes the lock and releases your hard ?dick from its entrapment.You want badly to touch yourself, but you quickly realize she is not unlocking your wrists.

&lt;&lt;sybille&gt;&gt;Do not worry, ?title. Your mistress will determine when you feel that sweet release.&lt;&lt;/sybille&gt;&gt;

She begins to massage your ?dick again, this time her movements faster as she strokes your ?dick up and down with her long, pale fingers. She is quite close to you now, and you can&#39;t help but stare at her round breasts as she deftly jerks you off.

&lt;&lt;sybille&gt;&gt;Your mistress orders you to cum, now.&lt;&lt;/sybille&gt;&gt;

You were already close from the movements of her hand on your ?dick and the sight of her naked breasts. This command pushes you over the edge, and you find yourself orgasming hard, your cum spraying over the cold flagstones. The stimulation of the whip and the prior entrapment of your ?dick only seem to heighten the sensation, and your vision almost blackens as the orgasm moves through you.

&lt;&lt;sybille&gt;&gt;Yes, show your mistress her effect on you...&lt;&lt;/sybille&gt;&gt;

As you come down from your peak, the reality of the situation hits you. You&#39;re standing naked in front of your spymaster, your wrists locked in a pillory, and she just whipped you and brought you to orgasm in front of her. She doesn&#39;t seem remotely bothered by the situation, but suddenly you feel incredibly awkward. Luckily, she has already started to free your wrists.

&lt;&lt;sybille&gt;&gt;Excellent work, ?title. I hope you have learned a great deal about my techniques, but feel free to return another time for more lessons.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;player&gt;&gt;Uh, th-thank you, ?Sybille.&lt;&lt;/player&gt;&gt;

You hurriedly re-dress and retreat from the dungeon, leaving ?Sybille to continue organizing her torture implements.

&lt;&lt;include &#39;Sybille Peeping End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="366" name="Sybille Princess Training Intro" tags="" position="725,4600" size="100,100">&lt;&lt;advancequest &#39;princess-lessons-intro&#39;&gt;&gt;
As you approach, you see ?Sybille working on a piece of paper marked with a series of connected boxes. You just make out that she has filled some of the boxes with words before she whips the paper out of sight. 

&lt;&lt;sybille&gt;&gt;?Greeting, ?title. I have been expecting you.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;player&gt;&gt;Oh, for my, um, lessons?&lt;&lt;/player&gt;&gt;

She frowns at you with intense eyes.

&lt;&lt;sybille&gt;&gt;I&#39;ve had an...impactful conversation with ?Morgana. Though I by no means approve of her methods I understand that you wish to look past her transgressions for now.&lt;&lt;/sybille&gt;&gt;

She lets out a sigh as she continues.

&lt;&lt;sybille&gt;&gt;Of course, I will accept your decision on this. I am here to serve you. I also suppose there&#39;s something more important to focus on now.&lt;&lt;/sybille&gt;&gt;

?Sybille&#39;s demeanor changes as she now smiles at you with a very supportive expression.

&lt;&lt;sybille&gt;&gt;I&#39;m proud of you, ?title, for following your true desires. You will make an excellent princess.&lt;&lt;/sybille&gt;&gt;

You feel your cheeks grow hot. ?Sybille is not one to give compliments lightly.

&lt;&lt;player&gt;&gt;Th-thank you. You don&#39;t seem very...surprised about my news.&lt;&lt;/player&gt;&gt;

?Sybille is still smiling, though you detect that this particular expression is genuine.

&lt;&lt;sybille&gt;&gt;Indeed not. It is my job to read people, after all. Of course, I will keep all this absolutely secret for now. Shall we begin?&lt;&lt;/sybille&gt;&gt;

It seems that ?Sybille knew who you were meant to be long before you did. The realization is embarrassing, but you don&#39;t have long to dwell on it, as your lesson is now beginning.

&lt;&lt;decision &#39;Start your first lesson&#39;&gt;&gt;
    &lt;&lt;include &#39;Sybille Princess Training&#39;&gt;&gt;
    &lt;&lt;decisionicon comport&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="367" name="Sybille Princess Training" tags="" position="850,4600" size="100,100">&lt;&lt;if !hasVisited(&#39;Sybille Princess Training 1&#39;)&gt;&gt;
    &lt;&lt;goto &#39;Sybille Princess Training 1&#39;&gt;&gt;
&lt;&lt;elseif !hasVisited(&#39;Sybille Princess Training 2&#39;)&gt;&gt;
    &lt;&lt;goto &#39;Sybille Princess Training 2&#39;&gt;&gt;
&lt;&lt;elseif !hasVisited(&#39;Sybille Princess Training 3&#39;)&gt;&gt;
    &lt;&lt;goto &#39;Sybille Princess Training 3&#39;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;goto `either(&#39;Sybille Princess Training 1&#39;, &#39;Sybille Princess Training 2&#39;, &#39;Sybille Princess Training 3&#39;)`&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="368" name="Sybille Princess Training End" tags="" position="975,4600" size="100,100">&lt;&lt;decision &#39;Thank ?Sybille and take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;changestat comport 1&gt;&gt;&lt;&lt;addcounter &#39;sybille-training&#39; 1&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="369" name="Sybille Princess Training 1" tags="" position="1100,4600" size="100,100">&lt;&lt;first&gt;&gt;
    &lt;&lt;sybille&gt;&gt;As you know, there is much expected of princesses. In these lessons we shall cover the intricacies of physical comportment, including posture, walking in raised footwear, and vocal training.&lt;&lt;/sybille&gt;&gt;

    She pauses for a moment, looking at you intently.

    &lt;&lt;sybille&gt;&gt;At the same time, ?title, there is no one way of being a princess. I encourage you to take from these lessons only what you find useful, and abandon what you do not. That said, today we will begin with posture.&lt;&lt;/sybille&gt;&gt;

    She approaches you, carefully examining your appearance. You do your best to display the royal stance your tutors taught you as a child.

    &lt;&lt;sybille&gt;&gt;Good. You have already mastered the basics of good posture. Standing up straight, shoulders slightly back and down, chin up...&lt;&lt;/sybille&gt;&gt;

    &lt;&lt;player&gt;&gt;I suppose those childhood lessons paid off.&lt;&lt;/player&gt;&gt;

    You chuckle awkwardly under her intense gaze. She nods thoughtfully.

    &lt;&lt;sybille&gt;&gt;Let us put this posture into practice. Walk across the room.&lt;&lt;/sybille&gt;&gt;
&lt;&lt;finally&gt;&gt;
    &lt;&lt;sybille&gt;&gt;Let us continue your lessons in comportment. Today we will practice posture again. Cross the room, employing what you learned in our previous lesson.&lt;&lt;/sybille&gt;&gt;
&lt;&lt;/first&gt;&gt;

You make your way across the room, suddenly feeling quite self-conscious.

&lt;&lt;sybille&gt;&gt;Try again, but this time imagine that you are floating in a straight line. Place one foot in front of the other as you walk, and allow your hips to sway naturally as you move.&lt;&lt;/sybille&gt;&gt;

You walk back across the room, fumbling slightly as you try to employ all these tips at once.

&lt;&lt;player&gt;&gt;Like this?&lt;&lt;/player&gt;&gt;

&lt;&lt;sybille&gt;&gt;That is too exaggerated. Try again, but do not force your body. Allow your movements to be natural and easy.&lt;&lt;/sybille&gt;&gt;

You walk back and forth across the room many more times, taking small adjustments from ?Sybille with each pass. Soon you&#39;re starting to feel more confident in this adjusted way of moving, and it&#39;s almost starting to feel natural.?nl

At some point, ?Sybille smiles, looking satisfied. 

&lt;&lt;sybille&gt;&gt;You have made excellent progress, ?title. I think we can conclude the lesson for today.&lt;&lt;/sybille&gt;&gt;

You thank her and make your way out of the dungeon, practicing this new way of walking as you go.

&lt;&lt;include &#39;Sybille Princess Training End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="370" name="Sybille Princess Training 2" tags="" position="1225,4600" size="100,100">You see ?Sybille at her desk, busy oiling a leather whip with great care. She puts it down as you approach.

&lt;&lt;sybille&gt;&gt;Ah, ?title, ?greeting. Are you here for another lesson?&lt;&lt;/sybille&gt;&gt;

&lt;&lt;player&gt;&gt;Yes, what will we work on today?&lt;&lt;/player&gt;&gt;

She stands up and walks around the desk. You see that she is wearing an impressively tall pair of black leather boots, their pointed heels so sharp they might pierce skin. You wonder how she could possibly balance on such things.?nl

?Sybille notices you looking at her footwear and gives you a sly smile.

&lt;&lt;sybille&gt;&gt;These shoes are a preview of your lesson. Today you will practice walking in raised heels.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;first&gt;&gt;
    You feel a wave of relief as she produces a pair of shoes from her desk with a much smaller and broader heel.
&lt;&lt;then&gt;&gt;
    You feel slight apprehension as she produces a pair of shoes from her desk with a sizeable heel.
&lt;&lt;finally&gt;&gt;
    You feel alarmed as she produces a pair of shoes from her desk with what feels like an impossibly tall heel.
&lt;&lt;/first&gt;&gt;

She hands them to you. You remove your shoes and carefully slip on the heels.

&lt;&lt;sybille&gt;&gt;Raised footwear is ultimately unnatural to wear and requires a new way of moving. When you step, put your foot down heel first. You will need to take smaller, slower steps, especially as you learn to balance.&lt;&lt;/sybille&gt;&gt;

As she explains this, you carefully straighten to a standing position. Your ankles wobble underneath you and you suddenly find yourself crashing to the cold flagstones of the dungeon floor.

&lt;&lt;player&gt;&gt;Ahh-! This is harder than I expected!&lt;&lt;/player&gt;&gt;

?Sybille helps you back to your feet, and you gain a sudden appreciation for how perfectly she balances in her own high shoes.

&lt;&lt;sybille&gt;&gt;Like many things, it simply takes practice. Place the weight on your heels and use your toes to balance.&lt;&lt;/sybille&gt;&gt;

You focus on standing again, this time finding a delicate balance in your precarious new shoes.

&lt;&lt;sybille&gt;&gt;Excellent. Now try taking a step or two.&lt;&lt;/sybille&gt;&gt;

You slowly take one step, then another, feeling like an awkward baby lamb. 

&lt;&lt;player&gt;&gt;How do you do this all day long?&lt;&lt;/player&gt;&gt;

&lt;&lt;sybille&gt;&gt;Carefully. Now try leaning back slightly as you walk, and focus on traveling in a straight line.&lt;&lt;/sybille&gt;&gt;

You take another few steps, starting to feel a bit more confident as you learn how to balance in the shoes. ?Sybille guides you for some time more, offering more adjustments until you are finally able to walk across the room with some measure of poise.

&lt;&lt;sybille&gt;&gt;Well done today, ?title. I think we will conclude our lesson here for now.&lt;&lt;/sybille&gt;&gt;

You return the shoes to her and make your way out of the dungeon, your feet and calves sore from using your muscles in a new way.

&lt;&lt;include &#39;Sybille Princess Training End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="371" name="Sybille Princess Training 3" tags="" position="100,4725" size="100,100">You find ?Sybille writing at her desk. She folds the paper and tucks it out of sight as you approach.

&lt;&lt;sybille&gt;&gt;Hello, ?title, back for another lesson?&lt;&lt;/sybille&gt;&gt;

You nod, and before you can say anything she stands up briskly.

&lt;&lt;first&gt;&gt;
    &lt;&lt;sybille&gt;&gt;Excellent. Our lesson today will take place in a cell.&lt;&lt;/sybille&gt;&gt;

    &lt;&lt;player&gt;&gt;You don&#39;t mean...?&lt;&lt;/player&gt;&gt;

    She chuckles, seeing the look on your face.

    &lt;&lt;sybille&gt;&gt;Nothing untoward, ?title. I simply believe the resonance will provide a better experience.&lt;&lt;/sybille&gt;&gt;

    You follow her curiously deeper into the dungeon and inside an empty cell, far away from any prisoners. It&#39;s quiet here, private even, and every sound is magnified off the damp stone walls. ?Sybille turns to you in the low light.

    &lt;&lt;sybille&gt;&gt;It is time to practice your vocal quality. Changing your voice is a difficult skill, but one that can be mastered. Observe.&lt;&lt;/sybille&gt;&gt;

    You listen as she deftly alters her voice, her normally intense yet sultry timbre instantly changing to the light, unpretentious tone of a town girl. She alters her voice again, now slightly lower and gruff, giving the perfect impression of a young castle guard. Before you get used to this new voice, she alters it again, this time sounding exactly like a kindly elderly woman.?nl

    You stare at her as she slips effortlessly back into her own voice. 

    &lt;&lt;player&gt;&gt;How do you do that?&lt;&lt;/player&gt;&gt;

    &lt;&lt;sybille&gt;&gt;A great deal of practice and observation, ?title. If you wish to effect a feminine voice, a higher pitch is of course the first element most think of. However, just as important are tone and intonation.&lt;&lt;/sybille&gt;&gt;

    She walks you through each of these concepts, demonstrating how a higher pitch, warm vocal tone, and melodic speech patterns can convey a feminine quality.

    &lt;&lt;sybille&gt;&gt;Let us begin with a pitch exercise. Start by humming, beginning at what feels like a normal pitch and sliding gently upward from there. This will help to extend your vocal range.&lt;&lt;/sybille&gt;&gt;

    You follow her instructions, humming haltingly out loud as she watches you closely. Feeling awkward, your voice catches in your throat, which you clear loudly. 

    &lt;&lt;sybille&gt;&gt;Worry not, ?title. Give it another try.&lt;&lt;/sybille&gt;&gt;

    You try again, this time achieving a smoother humming sound as you slowly increase your pitch. The exercise feels strange and you&#39;re not sure if it&#39;s helping, but you might as well keep going.
&lt;&lt;then&gt;&gt;
    &lt;&lt;sybille&gt;&gt;Let us continue your vocal training. Come with me.&lt;&lt;/sybille&gt;&gt;

    You follow her back to the familiar dungeon cell and clear your throat in anticipation.

    &lt;&lt;sybille&gt;&gt;Today we will try softening your tone. Begin by relaxing your throat and jaw, taking slow and deep breaths. Try to soften your consonants and slightly elongate your vowels. Speak this sentence: &lt;i&gt;I am the princess of ?kingdom.&lt;/i&gt;&lt;&lt;/sybille&gt;&gt;

    You take a deep breath, relax your muscles, and repeat the phrase, trying to adjust your pronunciation as instructed. You fumble over your words midway through the sentence and stop, feeling embarrassed.

    &lt;&lt;sybille&gt;&gt;Worry not, ?title. Give it another try.&lt;&lt;/sybille&gt;&gt;

    &lt;&lt;player&gt;&gt;I am the princess of ?kingdom.&lt;&lt;/player&gt;&gt;

    This time you achieve a bit more success following ?Sybille&#39;s instructions. You&#39;re almost surprised at how different your voice already sounds with this small adjustment.
&lt;&lt;finally&gt;&gt;    
    &lt;&lt;sybille&gt;&gt;Let us continue your vocal training. Come with me.&lt;&lt;/sybille&gt;&gt;

    You follow her back to the familiar dungeon cell and clear your throat in anticipation.

    &lt;&lt;sybille&gt;&gt;Today we will try adjusting your intonation. Using a melodic intonation, with rising and falling pitches, can convey a more feminine quality. Try repeating the phrase &lt;i&gt;I am the princess of ?kingdom&lt;/i&gt; first with a flat intonation, then with a varied one.&lt;&lt;/sybille&gt;&gt;

    &lt;&lt;player&gt;&gt;I am the princess of ?kingdom.&lt;&lt;/player&gt;&gt;

    You repeat the phrase flatly, then again with rising and falling intonations. It sounds a bit unnatural at first, but as you practice it a few more times, it starts to sound better.
&lt;&lt;/first&gt;&gt;

&lt;&lt;sybille&gt;&gt;Excellent, ?title! I can already hear improvement. Do not forget that this process takes much time and practice. Continue.&lt;&lt;/sybille&gt;&gt;

You keep practicing for some time until ?Sybille ends the lesson for the day. You make your way back out of the dungeon, practicing the new technique you learned under your breath.

&lt;&lt;include &#39;Sybille Princess Training End&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="372" name="Velma" tags="" position="225,4725" size="100,100">&lt;&lt;if hasQuest(&#39;velma-progress&#39;) and getTime() !== &#39;night&#39;&gt;&gt;
    &lt;&lt;decision &#39;Talk to ?Velma about your progress&#39; &#39;Velma Talk Progress&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if hasQuest(&#39;boarding-room&#39;) and getTime() !== &#39;night&#39;&gt;&gt;
    &lt;&lt;decision &#39;Talk to ?Velma about your reward&#39; &#39;Velma Boarding Room&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if hasQuest(&#39;velma-note&#39;) and getTime() === &#39;evening&#39;&gt;&gt;
    &lt;&lt;decision &#39;Talk to ?Velma about the plan to spy on ?Andreas&#39; &#39;Tavern Back Room Andreas 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="373" name="Velma Talk Progress" tags="" position="350,4725" size="100,100">&lt;&lt;completequest &#39;velma-progress&#39;&gt;&gt;
&lt;&lt;setlocation &#39;Velma\&#39;s Office&#39;&gt;&gt;
&lt;&lt;unlocklocation &#39;Corridor&#39;&gt;&gt;
&lt;&lt;unlocklocation &#39;Eve\&#39;s Room&#39;&gt;&gt;

You&#39;ve been working at the tavern for quite a bit now and you get the sense that you&#39;re doing quite well, it might be time to discuss the next steps with ?Velma. As soon as you enter the tavern you try to spot her. She doesn&#39;t seem to be anywhere in the main room, it seems like she must be in her office so you head in that direction.?nl

You carefully knock on her door and wait patiently for a response.

&lt;&lt;velma&gt;&gt;Come in.&lt;&lt;/velma&gt;&gt;

You head into her small office and see her writing something in a large book, it looks like the financial accounts of the place. You sit across from her as she stops what she&#39;s doing to give you the full attention.

&lt;&lt;velma&gt;&gt;Ah, ?newname. What can I do for you?&lt;&lt;/velma&gt;&gt;

&lt;&lt;player&gt;&gt;?MadameVelma, I have been working here for a bit of time now and I&#39;m starting to feel like I&#39;m really fitting in. I think the cover is really working and I think I&#39;m ready for the next steps in spying on ?Andreas.&lt;&lt;/player&gt;&gt;

She looks at you with a serious expression.

&lt;&lt;velma&gt;&gt;Hmm... Yes, I suppose it&#39;s time to discuss our next steps. As you know, ?Andreas prefers to rent a private room in the tavern. He is an exacting customer, with high expectations. To be able to serve him, you will need to complete additional training.&lt;&lt;/velma&gt;&gt;

You suppose this makes sense. ?Andreas is used to the service in the castle, and you would hate to blow your cover by raising his suspicions.

&lt;&lt;player&gt;&gt;Yes, of course ?MadameVelma. Where can I acquire this additional training?&lt;&lt;/player&gt;&gt;

&lt;&lt;velma&gt;&gt;?Eve is one of our best here at the tavern. She&#39;ll tell you everything you need to know. Just come find me when you&#39;re done.&lt;&lt;/velma&gt;&gt;

&lt;&lt;player&gt;&gt;Thank you, ?MadameVelma. I&#39;ll return to you when I&#39;ve completed the training.&lt;&lt;/player&gt;&gt;

?Velma nods to you and you head out of her office to look for ?Eve.

&lt;&lt;decision &#39;Go find ?Eve&#39; &#39;Eve Sex Education Intro&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="374" name="Velma After Sex Education" tags="" position="475,4725" size="100,100">&lt;&lt;setlocation &#39;Velma\&#39;s Office&#39;&gt;&gt;
&lt;&lt;addcounter &#39;tavern-work&#39; 1&gt;&gt;

You wander dazedly through the halls of what you now realize is a brothel before remembering that you&#39;re meant to check back in with ?Velma. You go find her in her office again, where she appears to still be working in that large book. She looks up as you enter.

&lt;&lt;velma&gt;&gt;Hello, ?newname. How did your additional training go?&lt;&lt;/velma&gt;&gt;

You can&#39;t believe ?Velma is being so nonchalant about sending you to sex training. You feel your cheeks getting hot.

&lt;&lt;player&gt;&gt;Uh, well... You know... I sure learned a lot about sex!&lt;&lt;/player&gt;&gt;

?Velma stares at you for a moment, then starts to chuckle.

&lt;&lt;velma&gt;&gt;Oh no, dear, did ?Eve mix those two up again? I only wanted her to give you the private room server training!&lt;&lt;/velma&gt;&gt;

You stare back at her.

&lt;&lt;player&gt;&gt;Ah, no, she definitely gave me...another kind of training...&lt;&lt;/player&gt;&gt;

?Velma gives a knowing smile. 

&lt;&lt;velma&gt;&gt;She&#39;s very good at what she does, isn&#39;t she? I&#39;m sure you learned a lot. Well, if anything you&#39;re simply overprepared now. If I&#39;m being honest, the private room training is quite similar, just without the sex part.&lt;&lt;/velma&gt;&gt;

&lt;&lt;player&gt;&gt;Ah- okay then. So, I can work in ?Andreas&#39;s room now?&lt;&lt;/player&gt;&gt;

?Velma looks you up and down with a critical eye.

&lt;&lt;velma&gt;&gt;Yes dear, I think you&#39;re ready. The man is quite unpredictable in his planning so I am unsure when he will visit next. I will let you know as soon as he makes a reservation.&lt;&lt;/velma&gt;&gt;

&lt;&lt;player&gt;&gt;Thank you, ?Madame. I will be ready for it.&lt;&lt;/player&gt;&gt;

&lt;&lt;velma&gt;&gt;Very good. Now if there is nothing else.&lt;&lt;/velma&gt;&gt;

You can&#39;t help but be excited that you&#39;ll finally have a chance to learn some real information soon. As you start to turn to leave, you remember what ?Eve said. Since you&#39;ve had the training, you could ask ?Velma about working in the brothel...

&lt;span class=&quot;notice danger&quot;&gt;This is an important decision that can only be made once in the story!&lt;/span&gt;

&lt;&lt;decision &#39;Ask about working in the brothel&#39; &#39;Velma Work Brothel&#39; depravity large&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Think better of the idea&#39; &#39;Velma Work No Brothel&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="375" name="Velma Work Brothel" tags="" position="600,4725" size="100,100">&lt;&lt;addtag &#39;sexwork&#39;&gt;&gt;
&lt;&lt;startquest &#39;brothel-intro&#39;&gt;&gt;
&lt;&lt;addcounter &#39;eve-tavern&#39; 1&gt;&gt;

You turn back around to face ?Velma.

&lt;&lt;player&gt;&gt;?MadameVelma, I was wondering... Now that I&#39;ve received that training, could I work in the brothel as well?&lt;&lt;/player&gt;&gt;

?Velma looks at you with surprise. 

&lt;&lt;velma&gt;&gt;You, ?newname, would like to work in the brothel?&lt;&lt;/velma&gt;&gt;

You feel suddenly embarrassed having even asked the question.

&lt;&lt;player&gt;&gt;I- um, just learned a lot from ?Eve, and I guess I am interested after all...&lt;&lt;/player&gt;&gt;

&lt;&lt;velma&gt;&gt;There&#39;s no need to be embarrassed, ?newname, this is certainly a possibility. You must know, however, that sex work is not always as glamorous or as fun as it may seem when you&#39;re with ?Eve. It is still a job, and one you are well-compensated for. Do you understand that?&lt;&lt;/velma&gt;&gt;

You can hardly believe you&#39;re having this conversation, and even though the idea of being a sex worker is a little scary, you can&#39;t help but feel excited as well.

&lt;&lt;player&gt;&gt;Yes, I understand that.&lt;&lt;/player&gt;&gt;

&lt;&lt;velma&gt;&gt;Why don&#39;t you think it over a bit more? Go tell ?Eve your decision once you&#39;re ready. I am more than willing to give you this opportunity then.&lt;&lt;/velma&gt;&gt;

&lt;&lt;player&gt;&gt;Uhm- okay, that sounds good, ?MadameVelma.&lt;&lt;/player&gt;&gt;

?Velma gives you a small smile.

&lt;&lt;velma&gt;&gt;I should hope so, dear. Now please, I must return to my work.&lt;&lt;/velma&gt;&gt;

You nod your thanks and leave her office, your head buzzing with the choice you have just made. You suppose it&#39;s best to think it over a bit more before going to ?Eve. When you walk out into the tavern you see it&#39;s already closed for the night.

&lt;&lt;decision &#39;Leave the tavern&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;settime night&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="376" name="Velma Work No Brothel" tags="" position="725,4725" size="100,100">&lt;&lt;startquest &#39;boarding-room&#39;&gt;&gt;

Working in a brothel is certainly an...interesting proposition, but right now you&#39;re content to keep working in the tavern as a normal ?barworker. You nod farewell to ?Velma and just as you&#39;re about to leave she calls out to you. 

&lt;&lt;velma&gt;&gt;Oh, ?newname, one more thing before you leave. I have a certain reward for you, a token for the good work you do here. It&#39;s already late though, so please come find me another day and I will give it to you.&lt;&lt;/velma&gt;&gt;

Okay... Certainly mysterious.

&lt;&lt;player&gt;&gt;Uhm, of course, ?Madame. I will come find you later.&lt;&lt;/player&gt;&gt;

She nods to you, signalling for you to leave. You walk out into the street, heading back to the castle. It&#39;s already late after all.
&lt;&lt;decision &#39;Leave the tavern&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;settime night&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="377" name="Velma Talk Plan" tags="" position="850,4725" size="100,100">&lt;&lt;setlocation &#39;Velma\&#39;s Office&#39;&gt;&gt;

You stand in front of ?Velma&#39;s office, ready to knock on her door.

&lt;&lt;decision &#39;Knock on her door&#39; &#39;Tavern Back Room Andreas 1&#39;&gt;&gt;&lt;&lt;settime &#39;evening&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="378" name="Wymerus" tags="" position="975,4725" size="100,100">&lt;&lt;if $location is &#39;Courtyard&#39;&gt;&gt;
    &lt;&lt;if getTime() !== &#39;night&#39;&gt;&gt;
        &lt;&lt;decision &#39;You see ?Wymerus here, training together with ?Caspar&#39; &#39;Wymerus Ask&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;if hasQuest(&#39;wymerus-book&#39;)&gt;&gt;
            &lt;&lt;decision &#39;Take the book from the library to ?Wymerus&#39; &#39;Wymerus Book&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;if hasQuest(&#39;wymerus-sword&#39;)&gt;&gt;
            &lt;&lt;decision &#39;Proudly show ?Wymerus the mythical sword&#39; &#39;Wymerus Sword&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="379" name="Wymerus Acknowledgement" tags="" position="1100,4725" size="100,100">&lt;&lt;acknowledgement Wymerus&gt;&gt;
    &lt;&lt;mention assassination&gt;&gt;
    &lt;&lt;mention status&gt;&gt;
        &lt;&lt;if face() is &#39;egg&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;andro&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;fem&#39;&gt;&gt;
        &lt;&lt;elseif face() is &#39;man&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
&lt;&lt;/acknowledgement&gt;&gt;</tw-passagedata><tw-passagedata pid="380" name="Wymerus Ask" tags="" position="1225,4725" size="100,100">You walk into the courtyard and see &lt;&lt;name wymerus &#39;Lord Marshal&#39;&gt;&gt; there, standing next to the training dummies together with his squire. He waves you over when he sees you.
&lt;&lt;if getStatLevel(&#39;swordsmanship&#39;) &lt; $player.levelexpectation + 1&gt;&gt;
    &lt;&lt;wymerus&gt;&gt;Young prince! Are you here to practice your skills with the sword? You can spar with my squire, ?Caspar, if you want.&lt;&lt;/wymerus&gt;&gt;
    /* &lt;&lt;include &#39;Wymerus Acknowledgement&#39;&gt;&gt; */
    &lt;&lt;first&gt;&gt;
        ?Caspar looks at you, a bit surprised.
        &lt;&lt;caspar&gt;&gt;I- It would be my honor, your highness.&lt;&lt;/caspar&gt;&gt;
        You have seen ?Wymerus&#39; squire once or twice but never practiced with him before.
    &lt;&lt;finally&gt;&gt;
        &lt;&lt;caspar&gt;&gt;I promise to go easy on you, your highness!&lt;&lt;/caspar&gt;&gt;
    &lt;&lt;/first&gt;&gt;
    &lt;&lt;if hasTag(&#39;wymerus-peeped&#39;)&gt;&gt;
        You think it&#39;s probably best not to mention the things you have seen them do here at night. After all, you&#39;re the one peeping on them.
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;include &#39;Caspar Acknowledgement&#39;&gt;&gt;

    &lt;&lt;decision &quot;Agree to practice swordfighting&quot; &#39;Wymerus Lessons&#39;&gt;&gt;&lt;&lt;decisionicon swordsmanship&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &quot;Politely decline&quot;&gt;&gt;
        &lt;&lt;player&gt;&gt;I&#39;m sorry, I was simply passing through.&lt;&lt;/player&gt;&gt;
        &lt;&lt;wymerus&gt;&gt;?Title, you know you&#39;re going to have to practice those swordsmanship skills sometime, come by later then!&lt;&lt;/wymerus&gt;&gt;
        &lt;&lt;decision &quot;Leave&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;wymerus&gt;&gt;Ah, ?title! Nice of you to visit us.&lt;&lt;/wymerus&gt;&gt;
    You walk over to the training dummy and grab a wooden sword.
    &lt;&lt;player&gt;&gt;I&#39;m ready for another sparring session, &lt;&lt;name wymerus &#39;Lord&#39;&gt;&gt;. Let&#39;s have at it.&lt;&lt;/player&gt;&gt;
    ?Wymerus and ?Caspar both stand there, unmoving.
    &lt;&lt;wymerus&gt;&gt;I&#39;m sorry, ?title. I fear we already went through all your forms for this week. I don&#39;t want to tire you out with any more training. Please, give your body some time to rest. Your muscles could use a breather.&lt;&lt;/wymerus&gt;&gt;
    Slightly disappointed, you put down the sparring blade again.
    &lt;&lt;player&gt;&gt;Oh, well. I suppose it&#39;s good to take a rest sometimes.&lt;&lt;/player&gt;&gt;
    &lt;&lt;wymerus&gt;&gt;Yes, please come back after the next council meeting, I think it&#39;s good to start the next lessons then.&lt;&lt;/wymerus&gt;&gt;
    You nod at ?Wymerus and walk away from them.
    &lt;&lt;decision &quot;Leave&quot; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="381" name="Wymerus Lessons" tags="" position="100,4850" size="100,100">&lt;&lt;addcounter &#39;wymerus&#39; 0.5&gt;&gt;
&lt;&lt;addcounter &#39;caspar&#39; 0.5&gt;&gt;
&lt;&lt;increasetime 1&gt;&gt;

You grab a wooden sparring sword and take your place opposite to ?Caspar.

&lt;&lt;include `either(&#39;Wymerus Lessons 1&#39;, &#39;Wymerus Lessons 2&#39;, &#39;Wymerus Lessons 3&#39;)`&gt;&gt;

&lt;&lt;changestat swordsmanship 1&gt;&gt;

&lt;&lt;decision &#39;Thank ?Caspar and ?Wymerus and take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="382" name="Wymerus Lessons 1" tags="" position="225,4850" size="100,100">You have an exciting sparring match while ?Wymerus shouts commands from the sideline. Even though you got a few good hits in, ?Caspar manages to connect his sword with your neck, winning him the match.</tw-passagedata><tw-passagedata pid="383" name="Wymerus Lessons 2" tags="" position="350,4850" size="100,100">After a bit of practicing, ?Wymerus comes over and stands behind ?Caspar to give him tips on his stance. Being much larger than ?Caspar, he reaches over his arms and shows him how to properly hold the sword. You&#39;re not quite sure but you think you notice ?Caspar&#39;s cheeks blushing.</tw-passagedata><tw-passagedata pid="384" name="Wymerus Lessons 3" tags="" position="475,4850" size="100,100">?Wymerus is especially fierce in his coaching today, he&#39;s shouting at you over and over. While you&#39;re figuring out how to take a proper defensive stance, ?Caspar spots an opening and managed to knock you over. While you&#39;re lying on the floor, ?Wymerus walks over and offers you a hand. As he lifts you, you feel how his big muscled arm easily pulls you up again.</tw-passagedata><tw-passagedata pid="385" name="Wymerus Book" tags="" position="600,4850" size="100,100">You walk up to ?Wymerus and without even properly greeting him you show him the book you found in the library.
&lt;&lt;player&gt;&gt;Look, ?Wymerus! I found an interesting book in our library, it&#39;s describing a strange fighting technique used after a heated debate.&lt;&lt;/player&gt;&gt;
&lt;&lt;wymerus&gt;&gt;Oh, hello, ?title. An interesting book, you say? Let me take a look at this thing.&lt;&lt;/wymerus&gt;&gt;
He takes the blue book from your hands and inspects it, he flips through it for a little bit and then hands it back to you.
&lt;&lt;wymerus&gt;&gt;Ah yes, &quot;The Duel of Words and Blades&quot;, I&#39;m familiar with it.&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;player&gt;&gt;You know of it? Great! I was actually wondering if we could perhaps practice the moves described in the book, it reads to be quite effective.&lt;&lt;/player&gt;&gt;
&lt;&lt;wymerus&gt;&gt;It&#39;s definitely effective, yes. Lord Lysander uses a technique that seems like it must be impossible to perform, defeating a far more skilled opponent like that. But that&#39;s just it: it&#39;s impossible.&lt;&lt;/wymerus&gt;&gt;
You look at him perplexed as you wait for him to continue explaining.
&lt;&lt;wymerus&gt;&gt; I have studies this technique in the past and I have found Lord Lysander&#39;s secret. It&#39;s not about his skillful stance at all, well, partly I suppose. But, the effectiveness of his moves are due to one thing only: that magical sword he&#39;s carrying.&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;player&gt;&gt;Wait, he used a special sword to win that fight?&lt;&lt;/player&gt;&gt;
&lt;&lt;wymerus&gt;&gt;Yes, ?sword, a mythical sword that bestows the wielder with an abundance of finesse in battle. With proper training, the sword allows you to dance around your foes, a force of wind. Lord Lysander used the sword to win the duel and then played it off like a secret technique he mastered. The story is nothing more than a fabrication...&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;player&gt;&gt;So that means I won&#39;t be able to fight like that as well?&lt;&lt;/player&gt;&gt;
Only now does ?Wymerus notice your disappointment from learning you won&#39;t be able to fight like that.
&lt;&lt;wymerus&gt;&gt;Well, I suppose I could teach you the technique, but it&#39;s really no use without having that sword. I actually heard your father mention it a few years ago, something about trying to find it by raiding a specific castle. But even if he did find it, you know how possessive the ?King gets about his magical swords...&lt;&lt;/wymerus&gt;&gt;
Even though the book is a lie, a plan hatches in your mind. If your father raided the castle holding the sword, would it be a great coincidence if the ?reliquary currently holds the blade? With this idea given form you nod to ?Wymerus.
&lt;&lt;player&gt;&gt;Thank you, ?Wymerus. I&#39;ll keep an eye out for the sword!&lt;&lt;/player&gt;&gt;
He salutes you as you take your leave.
&lt;&lt;wymerus&gt;&gt;Any time, ?title. Let me know if you somehow run into the thing, I&#39;ll be more than happy to show you how to use it.&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;completequest wymerus-book&gt;&gt;

&lt;&lt;decision &#39;Leave&#39; &#39;Hallway&#39;&gt;&gt;
&lt;&lt;addcounter &#39;wymerus&#39; 0.5&gt;&gt;
&lt;&lt;addcounter &#39;caspar&#39; 0.5&gt;&gt;
&lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="386" name="Wymerus Sword" tags="" position="725,4850" size="100,100">You walk up to ?Wymerus and without saying a word you brandish your new magical sword: ?sword. ?Wymerus has a look of utter disbelief on his face.
&lt;&lt;wymerus&gt;&gt;That sword... Is that... ?sword? How did you find it?&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;player&gt;&gt;The ?reliquary. I got it as a reward from ?Leopold.&lt;&lt;/player&gt;&gt;
Suddenly ?Wymerus starts laughing.
&lt;&lt;wymerus&gt;&gt;Hahaha! You&#39;re saying this legendary sword has been here the whole time?&lt;&lt;/wymerus&gt;&gt;
You nod at him, surprised by his joyousness.
&lt;&lt;wymerus&gt;&gt;That&#39;s hilarious. I knew your father was rather protective of his swords but I can&#39;t believe he never told me he has this...&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;wymerus&gt;&gt;Well, that&#39;s a wonderful find, ?title. You will make a good owner to this beautiful sword. Would you like me to teach you how to use it?&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;player&gt;&gt;Yes please, that would be wonderful!&lt;&lt;/player&gt;&gt;
With your permission, ?Wymerus takes the mythical sword and shows you how to hold a proper stance. You spend the next few hours going over forms on how to use the thing. Strangely enough, it&#39;s rather similar than using a normal sword, the only change is that ?Wymerus tells you to focus your energy on the sword more and help it guide you through the wind more effectively.?nl
After only a few hours you already feel quite confident with it. It feels like you have spent years mastering the blade, this sword definitely has magical power in it. You show your apparent mastery by slicing up one of the training dummies right in front of ?Wymerus.
&lt;&lt;wymerus&gt;&gt;Very good, ?title. Your form is good, your focus is keen and you move with the sword instead of against it. That&#39;s basically all there is to it, I wish you the best of luck with this artifact.&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;player&gt;&gt;Thank you for teaching me, ?wymerus. I&#39;m very happy to have you guiding me.&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Leave&#39; &#39;Hallway&#39;&gt;&gt;
&lt;&lt;completequest wymerus-sword&gt;&gt;
&lt;&lt;addcounter &#39;wymerus&#39; 0.5&gt;&gt;
&lt;&lt;addcounter &#39;caspar&#39; 0.5&gt;&gt;
&lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="387" name="Beau Store" tags="" position="850,4850" size="100,100">&lt;&lt;store beau&gt;&gt;

&lt;&lt;decision &#39;Return&#39; &#39;Smithy&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="388" name="Beau Purchase Gift Quill" tags="" position="975,4850" size="100,100">You point at the intricately crafted quill and ?Beau retrieves it for you from the glass case.

&lt;&lt;beau&gt;&gt;Good choice! A beautiful gift for a beautiful person!&lt;&lt;/beau&gt;&gt;

You hand her the gold coins and she happily accepts them, giving you your item in return.

&lt;&lt;player&gt;&gt;Thank you, ?Beau. It looks really nice!&lt;&lt;/player&gt;&gt;

&lt;&lt;beau&gt;&gt;You&#39;re welcome, as always!&lt;&lt;/beau&gt;&gt;

You&#39;re sure ?Orson is going to love this quill. You pocket the gift and save it for a good moment to give to him.

&lt;&lt;decision &#39;Leave&#39; &#39;Smithy&#39;&gt;&gt;
    &lt;&lt;startquest &#39;orson-gift-quill&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="389" name="Beau Purchase Gift Pendant" tags="" position="1100,4850" size="100,100">You point at the beautiful flower pendant and ?Beau retrieves it for you from the glass case.

&lt;&lt;beau&gt;&gt;Good choice! A beautiful gift for a beautiful person!&lt;&lt;/beau&gt;&gt;

You hand her the gold coins and she happily accepts them, giving you your item in return.

&lt;&lt;player&gt;&gt;Thank you, ?Beau. It looks really nice!&lt;&lt;/player&gt;&gt;

&lt;&lt;beau&gt;&gt;You&#39;re welcome, as always!&lt;&lt;/beau&gt;&gt;

You&#39;re sure ?Rosa is going to love this pendant. You pocket the gift and save it for a good moment to give to her.

&lt;&lt;decision &#39;Leave&#39; &#39;Smithy&#39;&gt;&gt;
    &lt;&lt;startquest &#39;rosa-give-pendant&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="390" name="Beau Purchase Gift Vibrator" tags="" position="1225,4850" size="100,100">You point at the delicately crafted silver wand and ?Beau retrieves it for you from the glass case.

&lt;&lt;beau&gt;&gt;Good choice! A sensual gift for a sensual person! Haha!&lt;&lt;/beau&gt;&gt;

You hand her the gold coins and she happily accepts them, giving you your item in return.

&lt;&lt;player&gt;&gt;Um, yes, thank you, ?Beau. It looks really nice!&lt;&lt;/player&gt;&gt;

&lt;&lt;beau&gt;&gt;You&#39;re welcome, as always!&lt;&lt;/beau&gt;&gt;

You&#39;re sure ?Eve is going to love this wand. You pocket the gift and save it for a good moment to give to her.

&lt;&lt;decision &#39;Leave&#39; &#39;Smithy&#39;&gt;&gt;
    &lt;&lt;startquest &#39;eve-give-vibrator&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="391" name="Beau Purchase Copper Dildo" tags="" position="100,4975" size="100,100">You bring the copper dildo to the counter and lay it in front of ?Beau. You awkwardly try to avoid eye contact as you try to make this purchase.

&lt;&lt;beau&gt;&gt;This one then? Good starting choice! It&#39;s got all kinds of nice features: modestly sized, realistic sensation and warmth, positional locking, all that to achieve a nice climax! For you and the dildo! Hahaha!&lt;&lt;/beau&gt;&gt;

You&#39;re not sure what she means exactly as she suddenly bursts out laughing again. You awkwardly join in and hand her the required amount of gold coins as she puts the dildo in a little baggie for you.

&lt;&lt;beau&gt;&gt;Enjoy, friend! Be sure not to get worn out, the tool for sure wont! Hahaha!&lt;&lt;/beau&gt;&gt;

&lt;&lt;player&gt;&gt;Uhm- yeah. Thank you.&lt;&lt;/player&gt;&gt;

You quickly decide to get out of here before her laugh draws any attention to this place.

&lt;&lt;decision &#39;Quickly take your leave&#39; &#39;Smithy&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="392" name="Beau Purchase Iron Dildo" tags="" position="225,4975" size="100,100"></tw-passagedata><tw-passagedata pid="393" name="Beau Purchase Gold Dildo" tags="" position="350,4975" size="100,100"></tw-passagedata><tw-passagedata pid="394" name="Beau Purchase Crystal Dildo" tags="" position="475,4975" size="100,100"></tw-passagedata><tw-passagedata pid="395" name="Beau Purchase Chastity Pink Big" tags="" position="600,4975" size="100,100">&lt;&lt;setchastity &#39;pink&#39; &#39;big&#39;&gt;&gt;
&lt;&lt;include &#39;Beau Purchase Chastity&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="396" name="Beau Purchase Chastity Black Big" tags="" position="725,4975" size="100,100">&lt;&lt;setchastity &#39;black&#39; &#39;big&#39;&gt;&gt;
&lt;&lt;include &#39;Beau Purchase Chastity&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="397" name="Beau Purchase Chastity Metal Big" tags="" position="850,4975" size="100,100">&lt;&lt;setchastity &#39;metal&#39; &#39;big&#39;&gt;&gt;
&lt;&lt;include &#39;Beau Purchase Chastity&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="398" name="Beau Purchase Chastity Pink Medium" tags="" position="975,4975" size="100,100">&lt;&lt;setchastity &#39;pink&#39; &#39;medium&#39;&gt;&gt;
&lt;&lt;include &#39;Beau Purchase Chastity&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="399" name="Beau Purchase Chastity Black Medium" tags="" position="1100,4975" size="100,100">&lt;&lt;setchastity &#39;black&#39; &#39;medium&#39;&gt;&gt;
&lt;&lt;include &#39;Beau Purchase Chastity&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="400" name="Beau Purchase Chastity Metal Medium" tags="" position="1225,4975" size="100,100">&lt;&lt;setchastity &#39;metal&#39; &#39;medium&#39;&gt;&gt;
&lt;&lt;include &#39;Beau Purchase Chastity&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="401" name="Beau Purchase Chastity" tags="" position="100,5100" size="100,100">/* TODO: If not crossdressing */
You subtly indicate your interest in purchasing a chastity cage to ?Beau. Unfortunately, she doesn&#39;t seem to catch onto your discreet communication and replies with a loud voice.

&lt;&lt;beau&gt;&gt;Oh, you&#39;re looking to purchase a chastity cage, ?newname? How adventurous! Hahaha!&lt;&lt;/beau&gt;&gt;

You hope the other customers in her store are to preoccupied to have heard that but you&#39;re probably wrong on that... ?Beau retrieves the specific cage you indicated and puts it on the counter. Finally, talking a bit softer she raises her eyebrows as she asks you a question.

&lt;&lt;beau&gt;&gt;So... Who&#39;s the lucky guy who you&#39;ll be caging up, eh?&lt;&lt;/beau&gt;&gt;

You awkwardly look around to make sure nobody overhears you.

&lt;&lt;player&gt;&gt;Uhm- Actually...it&#39;s for me... And I was kind of hoping you could replace the one I&#39;m- uh- currently wearing...&lt;&lt;/player&gt;&gt;

?Beau raises her eyebrows, but out of surprise this time.

&lt;&lt;beau&gt;&gt;Oh my! That&#39;s even more adventurous! Hah, of course I can do that for you! Hop in the back and I&#39;ll replace that cage for you with this brand new one, I&#39;m sure your keyholder will love it!&lt;&lt;/beau&gt;&gt;

Relieved you quickly dart to get some privacy and get this cage swapped.

&lt;&lt;decision &#39;Have your cage replaced and quickly leave the store&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;equipchastity&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="402" name="Hyssop Store" tags="" position="225,5100" size="100,100">&lt;&lt;store hyssop&gt;&gt;

&lt;&lt;decision &#39;Return&#39; &#39;Druid Hut&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="403" name="Trying Dress Hyssop" tags="" position="350,5100" size="100,100">?Hyssop hands you the new dress with a gleeful smile on their face.
&lt;&lt;hyssop&gt;&gt;Go on, try it on! I can&#39;t wait to see how it looks!&lt;&lt;/hyssop&gt;&gt;
You look around their hut kind of awkwardly, it definitely feels too intense to change in front of their. They suddenly seems to notice your reluctance.
&lt;&lt;hyssop&gt;&gt;Oh! Right, you&#39;d probably want to change in my bedroom, go ahead!&lt;&lt;/hyssop&gt;&gt;
Relieved, you take the dress into their bedroom and try it on there. You&#39;re not sure why you&#39;re doing this but it feels really nice to try on these clothes. You take off your earlier garbs and slide the dress over your head. Strangely enough it actually seems to fit perfectly. You double check whether you put it on correctly and take a deep breath before stepping out of the bedroom to show ?Hyssop.
&lt;&lt;hyssop&gt;&gt;Oh my, that looks amazing! I know I&#39;m basically complimenting myself when I say that but I actually think you&#39;re looking great in it! How does it feel?&lt;&lt;/hyssop&gt;&gt;
You blush slightly and look away, hearing their compliments.
&lt;&lt;player&gt;&gt;T- thanks ?Hyssop. I think I really like it...&lt;&lt;/player&gt;&gt;
&lt;&lt;hyssop&gt;&gt;Yeah, and it fits almost perfectly, look at that! I&#39;ll just need to make some small adjustment here...&lt;&lt;/hyssop&gt;&gt;
?Hyssop moves to adjust your side, measuring how the dress fits your body.
&lt;&lt;hyssop&gt;&gt;There, should be completely perfect now! Give us a twirl!&lt;&lt;/hyssop&gt;&gt;
Something about their enthusiasm makes you feel excited as well. You try to give a quick but beautiful twirl. While you spin, the bottom part of your dress moves upwards in the air. There&#39;s something about wearing the dress that actually feels freeing. You look at yourself in the mirror and suddenly catch yourself getting a glimpse of a different person. You know that it&#39;s actually yourself looking back but looking at that now, you feel like a different person altogether. This moment has you feeling excited and strange at the same time.
&lt;&lt;player&gt;&gt;It- It&#39;s wonderful, ?Hyssop. Thank you.&lt;&lt;/player&gt;&gt;
They look at you with a proud smile.
&lt;&lt;hyssop&gt;&gt;I&#39;m glad you like it! Feel free to ask if there&#39;s anything else you need!&lt;&lt;/hyssop&gt;&gt;
You nod to them, still cherishing the strangely euphoric moment.
&lt;&lt;decision &#39;Return&#39; &#39;Hyssop Store&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="404" name="Morgana Store" tags="" position="475,5100" size="100,100">&lt;&lt;store morgana&gt;&gt;

&lt;&lt;decision &#39;Return&#39; &#39;Workshop&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="405" name="Ointment Switch" tags="" position="600,5100" size="100,100">You hand ?Morgana a magical flower from the castle gardens. A &lt;&lt;if hasTag(&#39;ointment-fem&#39;)&gt;&gt;blue&lt;&lt;else&gt;&gt;pink&lt;&lt;/if&gt;&gt; one this time.

&lt;&lt;player&gt;&gt;Could you make a new ointment for me using this flower instead?&lt;&lt;/player&gt;&gt;

&lt;&lt;morgana&gt;&gt;Ah, certainly, ?title. I will get right on that.&lt;&lt;/morgana&gt;&gt;

She takes the flower from you and starts working on the ointment. Some time later you have received your new salve that you can use before bathing.

&lt;&lt;img &#39;equipment/ointment.jpg&#39; null &#39;200px&#39;&gt;&gt;

&lt;&lt;morgana&gt;&gt;Here you are, ?title. Be sure to use it before bathing.&lt;&lt;/morgana&gt;&gt;

&lt;&lt;if hasTag(&#39;ointment-fem&#39;)&gt;&gt;
    &lt;&lt;removetag ointment-fem&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;addtag ointment-fem&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasTag(&#39;ointment-fem&#39;)&gt;&gt;&lt;&lt;icon femininity&gt;&gt;&lt;&lt;else&gt;&gt;&lt;&lt;icon masculinity&gt;&gt;&lt;&lt;/if&gt;&gt; The ointment will now increase your &lt;&lt;if hasTag(&#39;ointment-fem&#39;)&gt;&gt;femininity&lt;&lt;else&gt;&gt;masculinity&lt;&lt;/if&gt;&gt; when used.
&lt;&lt;decision &#39;Return to the castle&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="406" name="Potion Preparation" tags="" position="725,5100" size="100,100">&lt;&lt;addcounter &#39;morgana-shop&#39; 1&gt;&gt;

?Morgana uncorks the potion bottle and pours your ?essence inside, swirling the bottle gently to incorporate the mixture. As she does so, the potion glimmers brightly.

&lt;&lt;morgana&gt;&gt;Ah, excellent. I believe this will work quite potently.&lt;&lt;/morgana&gt;&gt;

She holds out the potion to you, the cork still off, and you realize she&#39;s expecting you to drink it in front of her. It feels a bit intimate, but it&#39;s not as though you haven&#39;t had close experiences with ?Morgana before...

&lt;&lt;morgana&gt;&gt;Drink up, ?title. As you know, the potion is best used fresh.&lt;&lt;/morgana&gt;&gt;</tw-passagedata><tw-passagedata pid="407" name="Potion Finish" tags="" position="850,5100" size="100,100">You suddenly feel a powerful stream of energy flow through your body, hitting you unexpectedly. Luckily, it only takes a moment to pass and afterwards you start examining your body curiously. ?Morgana looks at you with a smile.

&lt;&lt;morgana&gt;&gt;Oh, I&#39;m afraid the potions don&#39;t work quite &lt;em&gt;that&lt;/em&gt; fast, ?title. Though it definitely won&#39;t take long, the results should be visible tomorrow.&lt;&lt;/morgana&gt;&gt;

You suppose magic can&#39;t always have instantaneous effects. You&#39;ll have to anxiously wait for tomorrow then.

&lt;&lt;player&gt;&gt;Oh- That makes sense. Uhm- thanks for the help, ?Morgana.&lt;&lt;/player&gt;&gt;

&lt;&lt;morgana&gt;&gt;Of course, I&#39;m glad I can help you with my magic like this. I&#39;m more than willing to help should you wish for more potions, all I require is more ?essence.&lt;&lt;/morgana&gt;&gt;

You nod to her and leave the workshop.

&lt;&lt;decision &#39;Return to the castle&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="408" name="Potion Increase Titty" tags="" position="975,5100" size="100,100">&lt;&lt;include &#39;Potion Preparation&#39;&gt;&gt;
&lt;&lt;decision &#39;Drink the potion&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Potion Increase Titty&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    Well, you wouldn&#39;t want the potion to lose its efficacy. You open your mouth and swallow it down.?nl

    The taste is both bitter and sweet, with a hint of...melon flavor?
    &lt;&lt;morgana&gt;&gt;I am so happy to see you embrace your feminine side, ?title. I think this change will suit you very much.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;include &#39;Potion Finish&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="409" name="Potion Decrease Titty" tags="" position="1100,5100" size="100,100">&lt;&lt;include &#39;Potion Preparation&#39;&gt;&gt;
&lt;&lt;decision &#39;Drink the potion&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Potion Decrease Titty&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    Well, you wouldn&#39;t want the potion to lose its efficacy. You open your mouth and swallow it down.?nl

    The taste is both bitter and sweet, with that same hint of melon as before.
    &lt;&lt;morgana&gt;&gt;Don&#39;t worry, your ?chest will shrink down exactly to like it was before.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;include &#39;Potion Finish&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="410" name="Potion Increase Penis" tags="" position="1225,5100" size="100,100">&lt;&lt;include &#39;Potion Preparation&#39;&gt;&gt;
&lt;&lt;decision &#39;Drink the potion&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Potion Increase Penis&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    Well, you wouldn&#39;t want the potion to lose its efficacy. You open your mouth and swallow it down.?nl

    The taste is bitter and vegetal, with a hint of...eggplant flavor?
    &lt;&lt;morgana&gt;&gt;Somehow it doesn&#39;t surprise me that you chose this potion, ?title. &lt;&lt;if settings.sph&gt;&gt;Especially in your case, this should definitely fix your little &lt;em&gt;situation&lt;/em&gt;.&lt;&lt;/if&gt;&gt;&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;include &#39;Potion Finish&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="411" name="Potion Decrease Penis" tags="" position="100,5225" size="100,100">&lt;&lt;include &#39;Potion Preparation&#39;&gt;&gt;
&lt;&lt;decision &#39;Drink the potion&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Potion Decrease Penis&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    Well, you wouldn&#39;t want the potion to lose its efficacy. You open your mouth and swallow it down.?nl

    The taste is bitter and vegetal, with a hint of...eggplant flavor?
    &lt;&lt;morgana&gt;&gt;Most people would choose to have a larger tool when given the option but I am glad to see you appreciate the smaller things in life.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;include &#39;Potion Finish&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="412" name="Potion Increase Ass" tags="" position="225,5225" size="100,100">&lt;&lt;include &#39;Potion Preparation&#39;&gt;&gt;
&lt;&lt;decision &#39;Drink the potion&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Potion Increase Ass&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    Well, you wouldn&#39;t want the potion to lose its efficacy. You open your mouth and swallow it down.?nl

    The taste is both bitter and sweet, with a hint of...peach flavor?
    &lt;&lt;morgana&gt;&gt;A good choice, ?title. I hope you&#39;ll enjoy your new enhancements...&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;include &#39;Potion Finish&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="413" name="Potion Decrease Ass" tags="" position="350,5225" size="100,100">&lt;&lt;include &#39;Potion Preparation&#39;&gt;&gt;
&lt;&lt;decision &#39;Drink the potion&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Potion Decrease Ass&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    Well, you wouldn&#39;t want the potion to lose its efficacy. You open your mouth and swallow it down.?nl

    The taste is both bitter and sweet, with a hint of...peach flavor?
    &lt;&lt;morgana&gt;&gt;Don&#39;t worry, your ?ass will shrink down exactly to how it was before.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;include &#39;Potion Finish&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="414" name="Potion Femininity" tags="" position="475,5225" size="100,100">&lt;&lt;addcounter &#39;morgana-shop&#39; 1&gt;&gt;
&lt;&lt;morgana&gt;&gt;Ah, I&#39;m glad to see you are interested in the potion still. I will prepare it right away for you, ?title.&lt;&lt;/morgana&gt;&gt;

She takes a moment to mix together several liquids. A puff of purple smoke rises from her flask as she gets closer to the final product. For the last ingredient, she pours a very viscous white liquid into the purple potion. A considerable amount of your ?essence.?nl

She finishes her mixing and hands you the magic potion.

&lt;&lt;morgana&gt;&gt;There you go, ?title. Drink up.&lt;&lt;/morgana&gt;&gt; 

You hold the flask in your hand. The swirling purple mass inside feels quite warm through the glass.

&lt;&lt;decision &#39;Drink the potion&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Potion Femininity&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;addevent dream &#39;Dream Event Potion Transformation&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;

    The taste is both bitter and sweet, yup, you can definitely taste the ?essence...

    &lt;&lt;morgana&gt;&gt;The potion is very potent, it might impact your sleep tonight. The effect of the magic will likely be noticeable in the morning already.&lt;&lt;/morgana&gt;&gt;

    &lt;&lt;player&gt;&gt;Okay. Thank you, ?Morgana...&lt;&lt;/player&gt;&gt;

    You nod to her and leave the workshop.

    &lt;&lt;decision &#39;Return to the castle&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="415" name="Wake Potion Femininity" tags="" position="600,5225" size="100,100">&lt;&lt;effect charm off&gt;&gt;
&lt;&lt;changebody face egg&gt;&gt;
&lt;&lt;acknowledgechanges &#39;status&#39;&gt;&gt;
&lt;img class=&quot;portrait themed centered&quot; character=&quot;player&quot; @src=&quot;getPortrait(&#39;player&#39;);&quot; width=&#39;400px&#39;&gt;
You wake up feeling changed. The memory of your dreams last night fade quickly but the feeling of them remain. You get out of bed and feel slightly lighter, your skin feels softer than ever and as you walk over to the mirror you notice the changes in your body. Your hair has grown out significantly overnight and your facial features feel slightly more androgynous. Someone might have a moment of doubt before placing your gender.
The rest of your body also feels different, you feel slightly more slender in your arms and shoulders.?nl
You definitely feel alarmed, it&#39;s very surprising to see yourself like this. But then again, you can&#39;t deny you also feel a sense of longing, something in you feels like this feels right. You very much try to ignore that sense for now.?nl

&lt;&lt;decision &#39;Continue your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="416" name="Wake Potion Start" tags="" position="725,5225" size="100,100">You wake up quite uncomfortably, a strange ache overtaking your body. Something feels different. Is this the effect of that potion from ?Morgana you drank yesterday? You quickly get up to see what happened to you.?nl</tw-passagedata><tw-passagedata pid="417" name="Wake Potion Increase Titty" tags="" position="850,5225" size="100,100">&lt;&lt;changebody chest increase&gt;&gt;
&lt;&lt;include &#39;Wake Potion Start&#39;&gt;&gt;

&lt;&lt;decision &#39;Examine your body&#39;&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    &lt;&lt;showbody chest outline location&gt;&gt;
        &lt;&lt;transformation chest increase&gt;&gt;
    &lt;&lt;/showbody&gt;&gt;

    You look down and watch in awe as two small mounds have appeared on your body. You commence an exploratory examination of your new ?chest. Palpations quickly turn into soft caressing, as you notice how much more sensitive your chest is, especially your nipples. An unexpected moan escapes your lips as you trail your areola.?nl

    This will definitely take some getting used to. It&#39;s a good thing your ?chest are so small nobody will notice them under your clothes...

    &lt;&lt;decision &#39;Continue your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="418" name="Wake Potion Decrease Titty" tags="" position="975,5225" size="100,100">&lt;&lt;changebody chest decrease&gt;&gt;
&lt;&lt;include &#39;Wake Potion Start&#39;&gt;&gt;

&lt;&lt;decision &#39;Examine your body&#39;&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    &lt;&lt;showbody chest outline location&gt;&gt;
        &lt;&lt;transformation chest decrease&gt;&gt;
    &lt;&lt;/showbody&gt;&gt;

    You look down and notice how your chest is once again flat, like it used to be. Though it feels strange to be back to this, it does seem like your chest is exactly the same as before.

    &lt;&lt;decision &#39;Continue your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="419" name="Wake Potion Increase Penis" tags="" position="1100,5225" size="100,100">&lt;&lt;changebody penis increase&gt;&gt;
&lt;&lt;if settings.sph&gt;&gt;
    &lt;&lt;set settings.sph = false&gt;&gt;
    &lt;&lt;script&gt;&gt;Setting.save();&lt;&lt;/script&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;include &#39;Wake Potion Start&#39;&gt;&gt;

&lt;&lt;decision &#39;Examine your body&#39;&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    &lt;&lt;showbody penis outline location ignore-chastity&gt;&gt;
        &lt;&lt;transformation penis increase&gt;&gt;
    &lt;&lt;/showbody&gt;&gt;

    You look down and watch in awe as your penis seems to have grown considerably larger. &lt;&lt;if isInChastity()&gt;&gt;Your ?dick strains for a moment in side your cage before you notice that the cage seems to magically grow with your ?dick. Nifty.&lt;&lt;else&gt;&gt;You commence an exploratory examination of your new ?dick. Palpations quickly turn into stroking as you explore the full length of your new tool.&lt;&lt;/if&gt;&gt;?nl

    Damn, you can&#39;t believe how lucky you are with ?Morgana&#39;s magic.

    &lt;&lt;decision &#39;Continue your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="420" name="Wake Potion Decrease Penis" tags="" position="1225,5225" size="100,100">&lt;&lt;changebody penis decrease&gt;&gt;
&lt;&lt;include &#39;Wake Potion Start&#39;&gt;&gt;

&lt;&lt;decision &#39;Examine your body&#39;&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    &lt;&lt;showbody penis outline location ignore-chastity&gt;&gt;
        &lt;&lt;transformation penis decrease&gt;&gt;
    &lt;&lt;/showbody&gt;&gt;

    You look down and watch in a mix of surprise and hidden lust as your penis seems to have grown considerably smaller. &lt;&lt;if isInChastity()&gt;&gt;You feel like your chastity cage is much too big now but then you notice that the cage magically shrinks down a bit, matching the size of your ?cock. Neat.&lt;&lt;else&gt;&gt;You commence an exploratory examination of your new ?dick. Palpations quickly turn into stroking and you visibly notice how much less length you have now.&lt;&lt;/if&gt;&gt;?nl

    You wonder whether any one else would ever choose to shrink their dick given the option...

    &lt;&lt;if hasSmallPenis() and !settings.sph&gt;&gt;
        &lt;&lt;set $temp = {}&gt;&gt;
        &lt;h3&gt;Content settings&lt;/h3&gt;
        &lt;label&gt;&lt;&lt;checkbox &quot;$temp.sph&quot; false true&gt;&gt; Small penis humiliation content&lt;/label&gt;
        
        &lt;&lt;decision &#39;Continue your day&#39; &#39;Morning&#39;&gt;&gt;
            &lt;&lt;set settings.sph = $temp.sph&gt;&gt;
            &lt;&lt;script&gt;&gt;Setting.save();&lt;&lt;/script&gt;&gt;
            &lt;&lt;unset $temp&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;decision &#39;Continue your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="421" name="Wake Potion Increase Ass" tags="" position="100,5350" size="100,100">&lt;&lt;changebody ass increase&gt;&gt;
&lt;&lt;include &#39;Wake Potion Start&#39;&gt;&gt;

&lt;&lt;decision &#39;Examine your body&#39;&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    /* &lt;&lt;showbody ass outline location&gt;&gt;
        &lt;&lt;transformation ass increase&gt;&gt;
    &lt;&lt;/showbody&gt;&gt; */

    You look down and watch in awe as your ass has grown considerably larger. You commence an exploratory examination of your new ?ass. You have to admit you look quite sexy with this new bubble butt.?nl

    This will probably take some getting used to. Hopefully it won&#39;t be too noticeable

    &lt;&lt;decision &#39;Continue your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="422" name="Wake Potion Decrease Ass" tags="" position="225,5350" size="100,100">&lt;&lt;changebody ass decrease&gt;&gt;
&lt;&lt;include &#39;Wake Potion Start&#39;&gt;&gt;

&lt;&lt;decision &#39;Examine your body&#39;&gt;&gt;
    &lt;&lt;effect flash&gt;&gt;
    /* &lt;&lt;showbody ass outline location&gt;&gt;
        &lt;&lt;transformation ass decrease&gt;&gt;
    &lt;&lt;/showbody&gt;&gt; */
    
    You look down and notice how your ass is once again like it used to be. Though it feels strange to be back to this, it does seem like your butt is exactly the same as before.

    &lt;&lt;decision &#39;Continue your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="423" name="Toy Use dildo_copper" tags="spicy" position="350,5350" size="100,100">You retrieve the copper dildo from the nightstand and take a moment to caress the entirety of its shape. As you&#39;re holding it, you feel the comfortable warmth and the surprisingly lifelike sensation. You notice the subtle magical hum that produces these enjoyable effects. It actually almost feels like a real cock... You now appreciate ?Beau&#39;s craftsmanship much more intimately.?nl

&lt;&lt;img &quot;equipment/dildo_copper.jpg&quot; null &#39;250px&#39;&gt;&gt;

&lt;&lt;if settings.sph&gt;&gt;
    Seeing as this is the smallest size that ?Beau offers at her store. It actually feels quite humiliating that it&#39;s already considerably larger than your own ?penis.?nl
&lt;&lt;/if&gt;&gt;

You&#39;ve taken a good moment of caressing this delightful tool and now that the foreplay is done, it&#39;s time to decide what to do with it...?nl

&lt;&lt;decision &#39;Practice your blowjob skills&#39; depravity small&gt;&gt;
    You realise your mouth started watering the moment you grabbed this dildo. You lick your lips with horny anticipation.?nl
    To get yourself in the right mood you have decided to take the correct position for this kind of work as you get off the bed and kneel down on the floor. You hold the dildo in front of you and press the small glyph on the base of the toy, activating the aura that locks the tool in mid-air, floating at your perfect mouth-height.?nl
    To start things off, you decide to give the entire length a few long licks, getting the tool nice and wet. It glistens quite beautifully as you finish covering the entire thing in your saliva.?nl
    You decide it&#39;s time to get practising as you slowly take the dildo into your mouth, only the head at first. It&#39;s only now that you can truly experience the passion that was put into creating this toy. If you were to close your eyes you wouldn&#39;t really know the difference between this and a real cock.?nl
    &lt;&lt;if isInChastity()&gt;&gt;
        You would actually want to take out your own cock right now and use a hand to pleasure yourself, but unfortunately you are currently locked away. All your ?penis can is twitch and let out trickles of pre-cum as you&#39;re getting more and more turned on by what you&#39;re doing.?nl
    &lt;&lt;else&gt;&gt;
        It is at this point that you decide to take out your own ?penis and use one of your hands to start stroking yourself. You&#39;re completely hard from arousal. The blowjob probably gets a slight reduction in quality as you&#39;re now splitting the attention and slowly masturbating while you have a fake cock in your mouth.?nl
    &lt;&lt;/if&gt;&gt;
    You patiently starting taking in more of the cock, bit by bit. No need to rush things. You move your mouth back and forth over the dildo, carefully feeling the details in the shape. You moan softly as you work the shaft using only your mouth.?nl
    You decide to take things up a notch as you attempt to take the entire length into your mouth. You slowly work up, getting closer and closer to the base before you feel your gag reflex set in.?nl
    It takes quite a bit of effort before you actually feel the dildo reach the entrance of your throat. &lt;&lt;if settings.sph&gt;&gt;Somewhere that your ?penis could never reach in a mouth.&lt;&lt;/if&gt;&gt; Finally reaching this point makes you feel ecstatic and strangely proud of yourself.?nl
    &lt;&lt;if settings.cum&gt;&gt;
        And it seems like you&#39;re not the only one happy with this as the enchanted dildo suddenly starts twitching subtly. As the entire length is current in your mouth and throat, there&#39;s not much you can do when you suddenly feel it reach its magical-induced climax.?nl
        You feel the fake cum shooting straight down your throat, skipping the usual process of first getting a taste when it slides over your tongue. This is quickly mitigates as the climaxing dildo catches you entire off-guard and you reflexively slide your mouth back off the still-spewing cock. A few strands land on your tongue, and, as you decided to take it out of your mouth, a few more spurts accidentally fly all over your face.?nl
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;if isInChastity()&gt;&gt;
        Your ?penis is straining hard against its cage as this is happening. It&#39;s actually quite torturous.?nl
    &lt;&lt;else&gt;&gt;
        While this is happening, your hand has not been idle in its appointed task and the horny situation actually brings you to a satisfying climax.?nl
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;if settings.cum&gt;&gt;
        With that, it looks like the dildo is finally done. You were definitely not expecting to be covered in magical cum from this. Not that you&#39;re complaining... You take a moment to clean yourself up - by swallowing of course - and enjoy the once-again lifelike experience, tasting very much like real cum.?nl
    &lt;&lt;/if&gt;&gt;

    When you&#39;re finished, you plant a final loving kiss on the head of the fake penis. You take a moment to calm down from the whole ordeal and stow away your toy. 
    
    &lt;&lt;if getTime() === &#39;night&#39;&gt;&gt;
        Looks like it&#39;s getting late already.

        &lt;&lt;decision &#39;Time to head to bed&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        
        &lt;&lt;decision &#39;Leave&#39; &#39;Tavern&#39;&gt;&gt;
            &lt;&lt;increasetime 1&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Insert it and train your anal proficiency&#39; depravity small&gt;&gt;
    You lie down on your back and raise your legs, quickly exposing your excited asshole. You almost try to immediately insert the toy before you remember you will need to do some preparation first. It&#39;s a good thing ?Eve gave you that training otherwise you&#39;d surely be lost with this.?nl
    You reach over, open the second drawer of the nightstand and retrieve a magical lubrication potion. Comes complimentary with the room, surely. You remove the tiny cork from the bottle and start massaging it over the dildo. The potion seeps into the copper itself as it now glows softly and is noticeably more slippery. You take a dollop of fluid left in the potion and start massaging your tight asshole.?nl
    You let out an involuntary moan as you slip a lubricated finger through your sphincter. You apply ample lubrication, making the massaging feel nice and soft. Instead of simply lubing yourself, you are now just fingering yourself as you go with the horny flow of things.?nl
    You get visibly turned on, your ?dick &lt;&lt;if isInChastity()&gt;&gt;straining hard in its cage&lt;&lt;else&gt;&gt;standing at full mast&lt;&lt;/if&gt;&gt;. Before you get too much into just the foreplay you catch a glimpse of the copper dildo, lubed and ready to go. While you continue to pleasure yourself with one hand, you use the other to grab the phallic object firmly and move it into position. You remove your finger from your asshole and hold the dildo against your opening, making you feel all kinds of excitement.?nl
    &lt;&lt;if settings.sph&gt;&gt;
        Looking at the tool about the penetrate you, you can&#39;t believe how much bigger it is than your ?dick. Whatever depth this thing could reach inside someone will always be unknown to your ?dick.?nl
    &lt;&lt;/if&gt;&gt;
    You slowly push the tool inside of you. You moan loudly as you feel the head of cock breaching your tight little hole. The pleasure is intense and beautiful as you start pushing in more and more of the fake cock, though, you must admit the warmth and sensation of it doesn&#39;t feel fake at all. If it wasn&#39;t for you moving the thing yourself, you probably wouldn&#39;t be able to differentiate between this and a real cock. You close your eyes and let out another moan as you find a steady rhythm to fuck yourself with.?nl
    &lt;&lt;if isInChastity()&gt;&gt;
        You would actually want to take out your own cock right now and use a hand to pleasure yourself, but unfortunately you are currently locked away. All your ?penis can do is twitch and let out trickles of pre-cum as you&#39;re getting more and more turned on by what you&#39;re doing.?nl
    &lt;&lt;else&gt;&gt;
        It is at this point that you decide to use your other hand to start stroking your own ?dick. You&#39;re completely hard from arousal. The ass-fucking probably gets a slight reduction in quality as you&#39;re now splitting the attention and slowly masturbating while you have a fake cock in your ass.?nl
    &lt;&lt;/if&gt;&gt;
    You decide to try something different as you take the dildo out with a wet plop, just for a second so you can reposition yourself. You flip over and get on all fours, intending to take this thing doggy-style. To make things even better, you decide to use one of this magical dildo&#39;s special features as you position it in front of your ass and touch the small glyph at the base. The dildo hums as you activate the aura that locks the tool in mid-air, floating at perfect ass-fucking height.?nl

    Slowly but surely you back up and find the cock head with your hungry asshole. You once again moan loudly as you feel the dildo entering your body. You slowly start moving yourself back and forth, sensationally fucking yourself doggy-style as the dildo hangs in place. &lt;&lt;if !isInChastity()&gt;&gt;You once again take hold of your ?penis as you&#39;re actively fucking the dildo.&lt;&lt;/if&gt;&gt;?nl

    Picking up the pace, you are panting more and more as you get used to the entire length of this cock. You are in a perfect flow, at one with the fake cock.

    &lt;&lt;if settings.cum&gt;&gt;
        And it seems like you&#39;re not the only one happy with this as the enchanted dildo suddenly starts twitching subtly. As the entire length is currently in your asshole, there&#39;s not much you can do when you suddenly feel it reach its magical-induced climax.?nl
        You feel the fake cum shooting into your ass. The climaxing dildo catches you entire off-guard and you reflexively slide your asshole back off the still-spewing cock. You then feel a few strands spurt all over your butt, violently covering you in cum.?nl
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;if isInChastity()&gt;&gt;
        Your ?penis is straining hard against its cage as this is happening. It&#39;s actually quite torturous.?nl
    &lt;&lt;else&gt;&gt;
        While this is happening, your hand has not been idle in its appointed task and the horny situation actually brings you to a satisfying climax.?nl
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;if settings.cum&gt;&gt;
        With that, it looks like the dildo is finally done. You were definitely not expecting to be covered in magical cum from this. Not that you&#39;re complaining... You take a moment to clean yourself.?nl
    &lt;&lt;/if&gt;&gt;

    When you&#39;re finished, you clean the toy and plant a final loving kiss on the head of the fake penis. You take a moment to calm down from the whole ordeal and stow away your toy.

    &lt;&lt;if getTime() === &#39;night&#39;&gt;&gt;
        Looks like it&#39;s getting late already.

        &lt;&lt;decision &#39;Time to head to bed&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        
        &lt;&lt;decision &#39;Leave&#39; &#39;Tavern&#39;&gt;&gt;
            &lt;&lt;increasetime 1&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="424" name="Toy Use dildo_iron" tags="" position="475,5350" size="100,100"></tw-passagedata><tw-passagedata pid="425" name="Toy Use dildo_gold" tags="" position="600,5350" size="100,100">docking?</tw-passagedata><tw-passagedata pid="426" name="Toy Use dildo_crystal" tags="" position="725,5350" size="100,100">magical orgasm? cum without touching?</tw-passagedata><tw-passagedata pid="427" name="Wardrobe Clothes" tags="" position="850,5350" size="100,100">&lt;&lt;setlocation &#39;Wardrobe&#39;&gt;&gt;
&lt;&lt;wardrobe&gt;&gt;

&lt;div id=&quot;wardrobe-return-button&quot;&gt;
&lt;&lt;include &#39;Wardrobe Return Button&#39;&gt;&gt;
&lt;/div&gt;</tw-passagedata><tw-passagedata pid="428" name="Wardrobe Return Button" tags="" position="975,5350" size="100,100">&lt;&lt;if isDisguised()&gt;&gt;
    Since you are currently wearing a disguise, you can try to slip out of the castle. It&#39;s probably not a good idea to prance around this place in your current outfit so you would need to change to your royal attire again to do that.
    &lt;&lt;decision &#39;Sneak out of the castle&#39;&gt;&gt;
        &lt;&lt;if isWearing(&#39;clothes&#39;)&gt;&gt;
            &lt;&lt;goto &#39;Sneak out&#39;&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;replace &quot;#wardrobe-return-button&quot;&gt;&gt;
                You&#39;re not wearing an outfit!
                &lt;&lt;include &#39;Wardrobe Return Button&#39;&gt;&gt;
            &lt;&lt;/replace&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Return&#39;&gt;&gt;
        &lt;&lt;if isWearing(&#39;clothes&#39;)&gt;&gt;
            &lt;&lt;goto &#39;Bedroom&#39;&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;replace &quot;#wardrobe-return-button&quot;&gt;&gt;
                You&#39;re not wearing an outfit!
                &lt;&lt;include &#39;Wardrobe Return Button&#39;&gt;&gt;
            &lt;&lt;/replace&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="429" name="Outfit Standard" tags="" position="1100,5350" size="100,100">&lt;&lt;outfit standard&gt;&gt;</tw-passagedata><tw-passagedata pid="430" name="Outfit Disguise" tags="" position="1225,5350" size="100,100">&lt;&lt;outfit disguise&gt;&gt;

/* OUTFITS:
[ ] Ceremonial outfit
[ ] Standard Prince outfit
[ ] Standard Princess outfit
[ ] Ceremonial dress
[ ] New normal hair, medium hair, Long wavy hair that goes to the front, Long hair that goes to the back (braids?) (different hair colors?)
[ ] 

 */</tw-passagedata><tw-passagedata pid="431" name="Quinn" tags="" position="100,5475" size="100,100">&lt;&lt;if $location is &#39;Barracks&#39;&gt;&gt;
    &lt;&lt;if getTime() === &#39;night&#39;&gt;&gt;
        &lt;&lt;decision &#39;Sneak around the barracks while it\&#39;s dark&#39; &#39;Soldiers Night&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;decision &#39;Visit the soldiers in the barracks&#39; &#39;Soldiers Day&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="432" name="Soldiers Day" tags="" position="225,5475" size="100,100">&lt;&lt;addcounter &#39;quinn&#39; 1&gt;&gt;
&lt;&lt;first&gt;&gt;
    &lt;&lt;include &#39;Soldiers Workout&#39;&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;include &#39;Soldiers Sparring&#39;&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;include &#39;Soldiers Bully&#39;&gt;&gt;
&lt;&lt;finally&gt;&gt;
    &lt;&lt;include `either(&#39;Soldiers Workout&#39;, &#39;Soldiers Sparring&#39;, &#39;Soldiers Bully&#39;)`&gt;&gt;
&lt;&lt;/first&gt;&gt;</tw-passagedata><tw-passagedata pid="433" name="Soldiers Night" tags="" position="350,5475" size="100,100">&lt;&lt;addcounter &#39;quinn&#39; 0.5&gt;&gt;
&lt;&lt;first&gt;&gt;
    Creeping around the barracks at night is a risky endeavor, but you&#39;re curious to see what the soldiers get up to after hours. The air is still thick with the smell of sweat from the day&#39;s training, and the sounds of snoring soldiers fill the room. You can hear the occasional rustle of blankets and the creak of bedsprings as the soldiers settle in for the night.
&lt;&lt;finally&gt;&gt;
    Creeping around the barracks at night is a risky endeavor, but you know that the soldiers are usually too tired to notice much. Nobody stirs as you sneak around, though that does little to quell your fear of getting caught.
&lt;&lt;/first&gt;&gt;

&lt;&lt;include `either(&#39;Quinn Peeping&#39;, &#39;Soldiers Peeping&#39;, &#39;Soldiers Peeping 2&#39;)`&gt;&gt;</tw-passagedata><tw-passagedata pid="434" name="Quinn Peeping" tags="" position="475,5475" size="100,100">&lt;&lt;addcounter &#39;quinn-night&#39; 2&gt;&gt;
&lt;&lt;set _soldierGender to either(0,1)&gt;&gt;
&lt;&lt;set _soldierPronounSet to [[&#39;his&#39;,&#39;him&#39;,&#39;he\&#39;s&#39;,&#39;he&#39;],[&#39;her&#39;,&#39;her&#39;,&#39;she\&#39;s&#39;,&#39;she&#39;]]&gt;&gt;
You manage to make your way back to the captain&#39;s quarters without getting noticed. The door is cracked open, and you can hear grunting and heavy breathing coming from inside. Your ?penis spasms involuntary at the thought of the captain&#39;s hard body, naked just behind the door. You peek through the crack and see one of the soldiers bent over in front of ?Quinn, &lt;&lt;print _soldierPronounSet[_soldierGender][0]&gt;&gt; head rolled back in pleasure as the captain rails &lt;&lt;print _soldierPronounSet[_soldierGender][1]&gt;&gt; with a strap-on.?nl

You suck in a breath, barely stifling the sound as you watch the soldier moan and writhe at her thrusts, clearly enjoying every moment of it. The captain&#39;s face is a mask of concentration, her movements precise and controlled as she guides the soldier towards the edge of pleasure. &#39;If only...&#39; you catch yourself thinking, a train of thought only interrupted by the sudden unrestrained pleading of the soldier.?nl

&lt;&lt;say &#39;Soldier&#39;&gt;&gt;Oh fuck, captain... Just like that!&lt;&lt;/say&gt;&gt;

You feel a flush of heat spread through your body as you watch the intimate scene unfold before you, and realizing that the cries of the soldier may well awaken more witnesses. The soldier&#39;s moans grow louder and more urgent, and you can tell &lt;&lt;print _soldierPronounSet[_soldierGender][2]&gt;&gt; close to the edge. With a final, powerful thrust, the captain sends &lt;&lt;print _soldierPronounSet[_soldierGender][1]&gt;&gt; over the edge, and &lt;&lt;print _soldierPronounSet[_soldierGender][3]&gt;&gt; cries out in ecstasy.?nl

The captain pulls back, a satisfied smile on her face as she gently removes herself from the solder&#39;s tired hole. She helps the soldier sit on the bed while &lt;&lt;print _soldierPronounSet[_soldierGender][3]&gt;&gt; catches &lt;&lt;print _soldierPronounSet[_soldierGender][0]&gt;&gt; breath. You quickly duck away from the crack in the door, your heart pounding in your chest. Your mind swims with what you just witnessed, but you can&#39;t deny the heat that&#39;s still burning in your veins.?nl

&lt;&lt;decision &quot;Leave quietly and go to sleep&quot; &#39;Bedtime&#39; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;disable isInChastity()&gt;&gt;
    &lt;&lt;decision &quot;Sneak back to your room to masturbate&quot; depravity small&gt;&gt;
        You make your way back to your room, your mind racing with thoughts of the captain and the soldier. You waste no time starting to pleasure yourself.?nl

        &lt;&lt;if settings.vids&gt;&gt;
            &lt;&lt;if settings.sph&gt;&gt;
                &lt;&lt;video &#39;player/masturbate_sph.webm&#39;&gt;&gt;
            &lt;&lt;else&gt;&gt;
                &lt;&lt;video &#39;player/masturbate.webm&#39;&gt;&gt;
            &lt;&lt;/if&gt;&gt;
        &lt;&lt;/if&gt;&gt;

        In no time at all you have brought yourself over your peak.
        &lt;&lt;decision &quot;Go to sleep&quot; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;reason&gt;&gt;
        You are locked in chastity.
&lt;&lt;/disable&gt;&gt;
&lt;&lt;decision &quot;Keep watching...&quot; &#39;Quinn Peeping Continued&#39; depravity small&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="435" name="Quinn Peeping Continued" tags="" position="600,5475" size="100,100">The sound of your own heartbeat drums in your ears as you turn back to the crack in the door, unable to resist the temptation to keep watching. The captain is now standing before the soldier, thrusting her hips forward so they can lap at her dripping sex. You see the soldier&#39;s own fluids leaking onto the floor below them, their face dripping with the captain&#39;s juices. Your own loins are frankly not much drier, and are practically begging for any touch at all.?nl

The captain&#39;s knees nearly buckle as the soldier&#39;s tongue works its magic, and you can see the tension building in her body. Your own body tenses in anticipation, and your hand falls to your groin with a mind of its own, groping yourself through your clothes as your better judgement fails you. You see a visible wave pass through her as she reaches her peak, her body shuddering with pleasure as she squirts all over the soldier&#39;s face.?nl

&lt;&lt;disable isInChastity()&gt;&gt;
    &lt;&lt;decision &quot;Touch yourself in the hallway&quot; depravity medium&gt;&gt;
        Transfixed by the sight before you, you can&#39;t wait any longer to get off. Your ?penis is already leaking all over itself as you reach into your pants and begin to pleasure yourself in the hallway. Thankfully nobody seems to be awake right now.?nl

        You quickly climax, coating your underwear with your fluids. As you come down from your high you realize the soldier has donned their clothes and is walking towards the doorway. You sneak away as quickly as possible, hoping nobody notices the squeak of the floorboards under your feet.
        
        &lt;&lt;decision &quot;Return to your room and go to sleep&quot; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &quot;Hurry back to your room to masturbate&quot; depravity small&gt;&gt;
        You rush back to your room, replaying the sight of the captain&#39;s orgasm in your mind.?nl
        
        &lt;&lt;if settings.vids&gt;&gt;
            &lt;&lt;if settings.sph&gt;&gt;
                &lt;&lt;video &#39;player/masturbate_sph.webm&#39;&gt;&gt;
            &lt;&lt;else&gt;&gt;
                &lt;&lt;video &#39;player/masturbate.webm&#39;&gt;&gt;
            &lt;&lt;/if&gt;&gt;
        &lt;&lt;/if&gt;&gt;

        Within seconds you are bringing yourself over the edge, your mind blacking out for a few moments as your body spasms with pleasure.?nl

        &lt;&lt;decision &quot;Go to sleep&quot; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;reason&gt;&gt;
        You are locked in chastity.
&lt;&lt;/disable&gt;&gt;
&lt;&lt;decision &quot;Go to bed frustrated&quot; &#39;Bedtime&#39; submissiveness small&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="436" name="Soldiers Peeping" tags="" position="725,5475" size="100,100">As you sneak through the barracks you can hear noises coming from the bathrooms. Overcoming your entirely reasonable trepidation, you peek inside and see three soldiers. Your mind struggles to comprehend what you are seeing: one of them is standing in front of the sink, gripping it tightly for support; the second is on the floor, sucking the first&#39;s cock, all while the third is behind the first soldier, thrusting into him with a strap-on.?nl

The carnal moans of the middle soldier overcome your initial shock, and begin to trigger your arousal. You watch the woman in the back thrust into the muscular middle soldier, her small breasts moving with subtle bounces as she plows him.?nl

With each thrust, she pushes the cock of the middle soldier down the throat of the soldier in front. He takes it admirably, not surrendering to the assault on his gag reflex. Your lust is momentarily replaced with pure admiration, until you see the soldier in the middle appear to tense, groaning with satisfaction as he fully sheaths his cock in his comrade&#39;s mouth, shooting his load down their throat.?nl

Before your sex-fogged mind can abandon all caution and offer to take sloppy fourths, you hear stirring noises in the room behind you that shock you back to reality, and you quickly retreat from your vantage point. You certainly hope you will have another opportunity to see &lt;i&gt;that&lt;/i&gt; again...

&lt;&lt;decision &quot;Sneak back out of the barracks&quot; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="437" name="Soldiers Peeping 2" tags="" position="850,5475" size="100,100">&lt;&lt;set _soldierGender to `either(&#39;male&#39;, &#39;female&#39;)`&gt;&gt;

Before you can get very far into the barracks, you hear rustling fabric in front of you. Instantly paralyzed by fear, and gratefully still hidden in the shadows of the room you peer out with heightened senses.?nl

&lt;&lt;if _soldierGender is &#39;male&#39;&gt;&gt;
    &lt;&lt;if settings.sph&gt;&gt;
        You eventually locate the source of the disturbance. Two beds away from you, you can see faint movement. As your eyes fully adjust to the dim light you can see a soldier stroking his large dick. You can&#39;t help but feel like your ?dick is worthless when you see what a real man&#39;s cock looks like.?nl

        His speed increases, and you hear a few barely stifled groans before his orgasm takes him.&lt;&lt;if settings.cum&gt;&gt; You watch as he shoots strand after strand of cum onto his chest. Hope he had a plan to clean that up... Maybe you should offer to he- Never mind. You&#39;re the Prince, that is stupid.&lt;&lt;/if&gt;&gt; Though it makes you feel rather inferior, the image of his big, hard cock is seared into your mind - perhaps you can use that later.
    &lt;&lt;else&gt;&gt;
        You eventually locate the source of the disturbance. Two beds away from you, you can see faint movement. As your eyes fully adjust to the dim light you can see a soldier stroking his dick.?nl

        His speed increases, and you hear a few barely stifled groans before his orgasm takes him.&lt;&lt;if settings.cum&gt;&gt; You watch as he shoots strand after strand of cum onto his chest. Hope he had a plan to clean that up...&lt;&lt;/if&gt;&gt; Regardless of how you felt about this experience, the image of his erect cock is seared into your mind - available for later use should you find need of it...
    &lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
    You eventually locate the source of the disturbance. Two beds away from you, you can see faint movement. As you focus your ears in that direction, you hear a faint whimper set over a soft, rhythmic squelching sound. Your eyes finally adjust and you can make out a female soldier, chest slowly heaving as she tries to control her heavy breathing.?nl

    Your heartbeat quickens as you scan her covered form and begin identifying curves and edges. Though a blanket still covers her, from its drape you can tell her legs are spread wide underneath. A tantalizing proposition, made more alluring as you hear her breath quicken, barely audible over the quiet, continual, slick squishing of her fingers in her pussy. Surely she could use someone to help her...?nl

    Before you accidentally expose yourself as a voyeur, you hear her breathing stop as she holds her breath. This change is accompanied by the soft rustle of the wool blanket as her legs close, her whole body tensing in erotica bliss. You can&#39;t see her face, but you can imagine the look of concentration as she struggles to remain silent while coasting into her climax. With a soft exhale, you realize she is done, and soon you see her rise and head to the bathroom. You suppose it is time to make your way out as well, before you are discovered.?nl
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &quot;Sneak back out of the barracks&quot; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="438" name="Soldiers Workout" tags="" position="975,5475" size="100,100">You enter the barracks to find the soldiers in the middle of an intense workout session. The air is thick with the smell of sweat, and the sounds of grunts and heavy breathing fill the room. Soldiers of all ranks are engaged in various exercises: lifting weights, doing push-ups, and wrestling each other.

You take a walk around the barracks, inspecting the dedicated workout session of the group. Several soldiers notice you and you feel like they&#39;re actually pushing harder after learning that you&#39;re here, perhaps looking to make a good impression on you.

&lt;&lt;guard&gt;&gt;Good day, ?title! It&#39;s an honor to have you here.&lt;&lt;/guard&gt;&gt;

&lt;&lt;player&gt;&gt;Good day. Keep up the hard work. Your dedication is appreciated.&lt;&lt;/player&gt;&gt;

As you walk through the barracks, you can&#39;t help but notice the soldiers&#39; toned and sweaty bodies. The sight leaves you feeling slightly flustered, especially when you see the lean body of the captain walking up to you. She is using a towel to wipe off some sweat from her forehead as she greets you.

&lt;&lt;quinn&gt;&gt;?Title, welcome to the barracks, nice of you to visit us. Perhaps you would care to join us in our workout? I know the troops would really appreciate it.&lt;&lt;/quinn&gt;&gt;

&lt;&lt;decision &#39;Join in on the workout&#39;&gt;&gt;
    You decide to take up the offer and join their workout. You quickly get changed in something a bit more comfortable for exercises and make your way over to the captain.

    &lt;&lt;quinn&gt;&gt;That&#39;s the spirit, ?title! We&#39;re currently lifting weights, do you need any help? I can help you with your pose if you want.&lt;&lt;/quinn&gt;&gt;

    &lt;&lt;decision &#39;Decline and show off as much as possible&#39; masculinity small&gt;&gt;
        You want to make a good impression so you decide to act a bit cocky to her.
        &lt;&lt;player&gt;&gt;Pff! Captain, I have more than enough experience with lifting those sacks of sand. Now hand me the bar.&lt;&lt;/player&gt;&gt;
        You point to the long wooden stick with a heavy sack filled with sand attached on both sides. The captain cocks and eyebrow but does as you say, probably waiting to see if your attitude is deserved.?nl
        You lift the bar over your head and actually surprise yourself as you manage to lift it over your head a few times. Your balance is flimsy and your stance is wobbly but you manage to actually get in a few repetitions. You throw the sacks down, muscles aching from the exercise.
        &lt;&lt;quinn&gt;&gt;Hah! I must say I&#39;m actually impressed, ?title. Let&#39;s see if you can keep this up for the entire workout.&lt;&lt;/quinn&gt;&gt;
        You spend quite some time in the barracks working out with the troops. Though you&#39;re definitely not as experienced at this as your hardened soldiers, you&#39;re doing quite well and it seems like the men are impressed with you being here, especially the captain.

        &lt;&lt;decision &#39;Finish the workout&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;

    &lt;&lt;decision &#39;Accept and follow her instructions&#39; submissiveness small&gt;&gt;
        &lt;&lt;player&gt;&gt;That would actually be nice, yes.&lt;&lt;/player&gt;&gt;
        &lt;&lt;quinn&gt;&gt;Very good, ?title. Please, follow me.&lt;&lt;/quinn&gt;&gt;
        While you are lifting a long wooden stick with heavy sacks of sands attached, the captain spends quite some time correcting your pose. She gets quite close to you and wraps her arms around you to help you achieve the right position. You feel quite vulnerable as her scent starts having a titillating effect on you.?nl

        After only ten minutes you are already completely exhausted from the workout and fall to the floor, panting. 
        &lt;&lt;quinn&gt;&gt;A bit too much for you, eh ?title? It&#39;s no shame to admit you need to stop for now.&lt;&lt;/quinn&gt;&gt;
        &lt;&lt;player&gt;&gt;Maybe that&#39;s for the best, yes...&lt;&lt;/player&gt;&gt;
        The captain lends you a hand and gets you back on your feet. Some of the soldiers look at you with a slightly surprised look, they probably expected you to last a bit longer with this.
        &lt;&lt;quinn&gt;&gt;Don&#39;t worry, ?title. You gave it your all! We&#39;ll be continuing the workout but you can go get cleaned up.&lt;&lt;/quinn&gt;&gt;
        You thank her for the help while you make your way over to get freshened up and leave the barracks.

        &lt;&lt;decision &#39;Finish the workout&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Decline the offer&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Sorry, captain. I was just having a look around. I unfortunately don&#39;t have time for such things right now.&lt;&lt;/player&gt;&gt;
    The captain nods to you and lets you get on with your day.
    &lt;&lt;decision &#39;Leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="439" name="Soldiers Sparring" tags="" position="1100,5475" size="100,100">You enter the barracks to find the soldiers engaged in lively sparring matches. The clashing of swords and the shouts of exertion echo through the room. Soldiers of all ranks are testing their skills against one another, their movements swift and precise.

As you walk through the barracks, you can&#39;t help but admire their technique and dedication. Several soldiers notice you and pause their matches to offer respectful nods.

&lt;&lt;guard&gt;&gt;Good day, ?title! It&#39;s an honor to have you here.&lt;&lt;/guard&gt;&gt;

&lt;&lt;player&gt;&gt;Good day. Your sparring looks impressive. Keep up the hard work.&lt;&lt;/player&gt;&gt;

You continue to observe the matches, feeling a mixture of admiration and excitement. The captain approaches you, a grin on her face.

&lt;&lt;quinn&gt;&gt;?Title, would you care to join us for a sparring match? It&#39;s a great way to keep your skills sharp.&lt;&lt;/quinn&gt;&gt;

&lt;&lt;decision &#39;Join in the sparring match&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Why not? It&#39;s been a while since I had a good sparring session.&lt;&lt;/player&gt;&gt;
    &lt;&lt;quinn&gt;&gt;Excellent! Let&#39;s see what you&#39;ve got, ?title!&lt;&lt;/quinn&gt;&gt;

    The soldiers form a circle around you as you take up a practice sword. Your opponent, a seasoned soldier, steps forward and bows respectfully before taking his stance.

    &lt;&lt;if getStatLevel(&#39;swordsmanship&#39;) &lt; $player.levelexpectation&gt;&gt;
        &lt;&lt;changestat swordsmanship small&gt;&gt;
        Despite your best efforts, your opponent&#39;s skill and experience quickly overwhelm you. You find yourself struggling to keep up with his swift and precise movements. After a few intense minutes, he disarms you with a final, decisive strike.

        &lt;&lt;guard&gt;&gt;Well fought, ?title! You&#39;ve got spirit, that&#39;s for sure.&lt;&lt;/guard&gt;&gt;

        &lt;&lt;player&gt;&gt;Thank you. It seems I still have much to learn.&lt;&lt;/player&gt;&gt;

        &lt;&lt;quinn&gt;&gt;Don&#39;t be discouraged, ?title. Every defeat is a lesson. Keep training and you&#39;ll improve.&lt;&lt;/quinn&gt;&gt;

        After giving a respectful bow to your opponent you move over to the side and spend some time watching the other sparring matches before moving on.
        &lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;changestat swordsmanship small&gt;&gt;
        You hold your ground, matching your opponent&#39;s movements with skill and precision. The clash of swords echoes through the barracks as you anticipate and counter his attacks. With a final, well-placed strike, you disarm your opponent, sending his sword clattering to the ground.

        &lt;&lt;guard&gt;&gt;Impressive, ?title! Your skills are truly remarkable.&lt;&lt;/guard&gt;&gt;

        &lt;&lt;player&gt;&gt;Thank you. It&#39;s been a while since I&#39;ve had such a challenging match.&lt;&lt;/player&gt;&gt;

        &lt;&lt;quinn&gt;&gt;Well done, ?title! It&#39;s clear you&#39;ve been practicing hard. Keep up the excellent work.&lt;&lt;/quinn&gt;&gt;

        After giving a respectful bow to your opponent you move over to the side and spend some time watching the other sparring matches before moving on.
        &lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Decline the offer&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Sorry, captain. I was just having a look around. I unfortunately don&#39;t have time for such things right now.&lt;&lt;/player&gt;&gt;
    The captain nods to you and lets you get on with your day.
    &lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="440" name="Soldiers Bully" tags="" position="1225,5475" size="100,100">You enter the barracks to find the soldiers engaged in their usual activities. As you walk through, observing the troops, you notice ?Caspar in the middle of a small group of soldiers, he looks slightly uncomfortable. The soldiers seem to be teasing him, their tone mocking.

&lt;&lt;guard&gt;&gt;Look who it is, the &lt;&lt;title wymerus&gt;&gt;&#39;s favorite! Thinks he&#39;s better than us because he&#39;s got connections, huh?&lt;&lt;/guard&gt;&gt;

&lt;&lt;caspar&gt;&gt;It&#39;s not like that. I work hard just like everyone else. That&#39;s why he made me his squire!&lt;&lt;/caspar&gt;&gt;

The soldiers laugh, clearly enjoying themselves at ?Caspar&#39;s expense. You feel a surge of indignation on his behalf.

&lt;&lt;decision &#39;Stand up for Caspar&#39; dominance small&gt;&gt;
    You decide to stand up for ?Caspar.
    &lt;&lt;player&gt;&gt;That&#39;s enough! ?Caspar works hard and deserves respect. I won&#39;t tolerate this kind of behavior.&lt;&lt;/player&gt;&gt;

    The soldiers immediately stop their teasing, looking surprised and a bit ashamed.

    &lt;&lt;guard&gt;&gt;?Title, we were just having a bit of fun. No harm meant.&lt;&lt;/guard&gt;&gt;

    &lt;&lt;player&gt;&gt;Fun or not, everyone here deserves respect. Especially someone as dedicated as ?Caspar.&lt;&lt;/player&gt;&gt;

    The soldiers nod, muttering apologies, and disperse. ?Caspar gives you a grateful look.

    &lt;&lt;caspar&gt;&gt;Thank you, ?title. I appreciate it.&lt;&lt;/caspar&gt;&gt;

    &lt;&lt;player&gt;&gt;You&#39;re welcome, ?Caspar. Don&#39;t let them get to you.&lt;&lt;/player&gt;&gt;

    &lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Do not intervene&#39; submissiveness small&gt;&gt;
    You decide not to intervene and see how the situation unfolds.

    Before you can decide whether to walk away, the captain steps in, her eyes blazing with anger.

    &lt;&lt;quinn&gt;&gt;What&#39;s going on here? Bullying a fellow soldier, especially in front of the prince? You should be ashamed of yourselves!&lt;&lt;/quinn&gt;&gt;

    The soldiers immediately straighten up, looking embarrassed.

    &lt;&lt;quinn&gt;&gt;I don&#39;t care if he&#39;s ?Wymerus&#39;s favorite or not. Everyone here deserves respect. Consider this your warning. If I see this behavior again, there will be consequences.&lt;&lt;/quinn&gt;&gt;

    The soldiers nod, muttering apologies, and quickly disperse. The captain turns to you and ?Caspar.

    &lt;&lt;quinn&gt;&gt;I apologize for their behavior, ?title. It won&#39;t happen again.&lt;&lt;/quinn&gt;&gt;

    &lt;&lt;player&gt;&gt;Thank you, captain. I appreciate your intervention.&lt;&lt;/player&gt;&gt;

    &lt;&lt;caspar&gt;&gt;Thank you, ?Quinn. I... I&#39;ll be fine.&lt;&lt;/caspar&gt;&gt;

    The captain nods and returns to her duties, leaving you and ?Caspar.

    &lt;&lt;decision &#39;Take your leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="441" name="Reading" tags="" position="100,5600" size="100,100">&lt;&lt;decision &#39;Find a book to read&#39; &#39;Read&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="442" name="Read" tags="" position="225,5600" size="100,100">&lt;&lt;addcounter &#39;reading-library&#39; 1&gt;&gt;

&lt;&lt;if not hasRead(&#39;dancing-knight&#39;)&gt;&gt;
    As you enter the library, the scent of old books and the flickering candlelight greet you. The shelves are lined with volumes of all sizes, each one waiting to be picked up and read. You begin wandering around, running your fingers over the spines of the books. The library is a comforting space, a place where you can lose yourself in the stories of the past.?nl
    
    &lt;&lt;include &quot;Book dancing-knight&quot;&gt;&gt;
&lt;&lt;elseif not hasRead(&#39;servant-1&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book servant-1&quot;&gt;&gt;
&lt;&lt;elseif not hasRead(&#39;histories-1&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book histories-1&quot;&gt;&gt;
&lt;&lt;elseif not hasRead(&#39;dinner-etiquette&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book dinner-etiquette&quot;&gt;&gt;
&lt;&lt;elseif not hasRead(&#39;histories-2&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book histories-2&quot;&gt;&gt;
&lt;&lt;elseif not hasRead(&#39;servant-2&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book servant-2&quot;&gt;&gt;
&lt;&lt;elseif not hasRead(&#39;servant-3&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book servant-3&quot;&gt;&gt;
&lt;&lt;elseif not hasRead(&#39;histories-3&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book histories-3&quot;&gt;&gt;
&lt;&lt;elseif not hasRead(&#39;duel&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book duel&quot;&gt;&gt;
&lt;&lt;else&gt;&gt;
    You feel like you have read most actual interesting things this library has to offer so you instead opt to just grab a book you have already read.?nl
    &lt;&lt;include `either(&#39;Book dancing-knight&#39;, &#39;Book servant-1&#39;, &#39;Book servant-2&#39;, &#39;Book servant-3&#39;, &#39;Book duel&#39;)`&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="443" name="Royal houses books" tags="" position="350,5600" size="100,100">&lt;&lt;if&gt;&gt;
 &lt;&lt;elseif not hasRead(&#39;royal-houses-1&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book royal-houses-1&quot;&gt;&gt; 
 &lt;&lt;elseif not hasRead(&#39;royal-houses-2&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book royal-houses-2&quot;&gt;&gt; 
 &lt;&lt;elseif not hasRead(&#39;royal-houses-3&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book royal-houses-3&quot;&gt;&gt; 
 &lt;&lt;elseif not hasRead(&#39;royal-houses-4&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book royal-houses-4&quot;&gt;&gt;
&lt;&lt;elseif not hasRead(&#39;royal-houses-5&#39;)&gt;&gt;
    &lt;&lt;include &quot;Book royal-houses-5&quot;&gt;&gt; 
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="444" name="Book dancing-knight" tags="" position="475,5600" size="100,100">As you reach the end of a row of shelves, you spot a book that catches your eye. It&#39;s a thin volume, bound in leather, with a faded lettering on the spine. It&#39;s got quite a long-winded title... Nevertheless, you give the strange book a try.?nl

&lt;&lt;book &#39;dancing-knight&#39; &#39;dancing-knight&#39; &#39;The Knight and the Unusual Battle Technique&#39; &#39;How to Use an Unexpected Approach to Defeat Your Enemies.&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        Once upon a time, there was a knight named Sir Edmund. He was known throughout the land for his prowess in combat and his bravery in battle.?nl
        One day, Edmund was tasked with facing a group of bandits who were terrorizing a nearby village. As he approached, he could see the fear in their eyes. They were used to facing ordinary soldiers and peasants, not someone like him.
    &lt;&lt;page&gt;&gt;
        When the battle began, Edmund took out his sword and prepared for the fight. But the bandits were crafty, and they attacked from all sides.?nl
        He was quickly surrounded, and it looked like the end for him.
    &lt;&lt;page&gt;&gt;
        Just when it seemed like he was done for, Edmund did something unexpected. He threw his sword down and began to dance. It was a strange sight to behold, but the bandits were so shocked that they didn&#39;t know how to react.?nl
        Edmund danced and twirled, moving faster and faster, until he was a blur of motion. His opponents were unable to keep up, and he was able to strike them down one by one.?nl
        By the end of the battle, Edmund was exhausted, but he had won. And he had proven that sometimes, the most unexpected strategies are the most effective...
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        Well... You don&#39;t think you learned much from that book... You reckon the author didn&#39;t actually know much about sword-fighting at all, and you&#39;ve also never heard of this &quot;Sir Edmund&quot;.?nl
        What a fantastic waste of time.
        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="445" name="Book duel" tags="" position="600,5600" size="100,100">As you reach the end of a row of shelves, you spot a book that catches your eye. It&#39;s an elegant volume, bound in fine leather, with aged letters embossed on the cover. The title reads, &quot;The Duel of Words and Blades.&quot; Intrigued, you decide to give this book a try.?nl

&lt;&lt;book &#39;duel&#39; &#39;duel&#39; &#39;The Duel of Words and Blades&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        Once upon a time, in a grand court filled with nobles and scholars, there were two men known for their sharp wit and eloquence. &lt;em&gt;Lord Lysander&lt;/em&gt;, a master wordsmith whose tongue was as quick as a rapier, and &lt;em&gt;Sir Reginald&lt;/em&gt;, a knight renowned for his strength and prowess.?nl
        One day, a debate was arranged between the two, to be held before the court and the king himself.
    &lt;&lt;page&gt;&gt;
        &lt;em&gt;Lord Lysander:&lt;/em&gt; Oh Sir Reginald, thy words are as clumsy as thy feet. Dost thou stumble through life as thou dost through this debate??nl
        &lt;em&gt;Sir Reginald:&lt;/em&gt; Master Lysander, thy words may dance like the wind, but it is substance, not air, that doth make a man. What use is a tongue that can prattle but cannot act??nl
        The court watched with bated breath as the two men exchanged barbs, each one more cutting than the last.
    &lt;&lt;page&gt;&gt;
        &lt;em&gt;Lord Lysander:&lt;/em&gt; To act without thought is but folly, Sir Knight. Thy sword may be swift, but it is the mind that guides the hand. Tell me, dost thou ever think, or merely swing blindly??nl
        &lt;em&gt;Sir Reginald:&lt;/em&gt; And to think without act is but cowardice, Lord Lysander. Thy tongue is sharp, but can it defend thee when steel is drawn? Perhaps we should test which is mightier: the pen or the sword.?nl
        The court gasped as Sir Reginald&#39;s challenge hung in the air. Unexpectedly, he drew his sword, the glint of steel catching the candlelight.
    &lt;&lt;page&gt;&gt;
        Taken aback, Lord Lysander nonetheless accepted the challenge, drawing a slender rapier from his side, seemingly emitting a soft white glow. The court watched in stunned silence as the duel began, their verbal sparring replaced by the clash of steel.?nl
        &lt;em&gt;Sir Reginald:&lt;/em&gt; Prepare thyself, wordsmith. Thy wit will not save thee now.?nl
        &lt;&lt;page&gt;&gt;
        Sir Reginald lunged, his sword aiming for Lysander&#39;s heart. But Lysander, with surprising agility, parried the blow with a technique so precise and unexpected that it seemed almost magical.?nl
        &lt;em&gt;Lord Lysander:&lt;/em&gt; Thou underestimateth me, Sir Knight. Words are not my only weapon.?nl
        His rapier moved with a fluid grace, his strikes aimed with such precision that Reginald struggled to keep up. The technique was a blend of quick feints and swift counters, a dance of steel that mesmerized the onlookers.
    &lt;&lt;page&gt;&gt;
        &lt;em&gt;Sir Reginald:&lt;/em&gt; What sorcery is this? Thy blade moves as if it were an extension of thy very will.?nl
        &lt;em&gt;Lord Lysander:&lt;/em&gt; &#39;Tis a technique learned through years of study, Sir Knight. To wield a blade as one would wield words, with precision and intent. Observe closely, for it may be thy undoing.?nl
        Lysander&#39;s final strike disarmed Reginald, his rapier sending the knight&#39;s sword clattering to the floor. A sly smile sprouts on the Lord&#39;s face while Sir Reginald slumps down, defeated. The court erupted in applause, astonished by the display. Who knew such a witty man of words could use his blade so elegantly. 
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        You close the book, feeling a strange sense of enlightenment. The technique Lord Lysander used resonates with you, and you realize that it could be applied to your own swordsmanship. 
        &lt;&lt;if not hasRead(&#39;duel&#39;)&gt;&gt;
            Perhaps you could bring this book to ?Wymerus, he might be able to teach you more about these graceful moves.?nl
            &lt;&lt;startquest wymerus-book&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="446" name="Book servant-1" tags="" position="725,5600" size="100,100">You take quite some time picking a book to read. Curious about the secrets that the top shelves keep, you climb a ladder to scale this mountain of books. These, on the summit, you spot a small book lodged deep in between two much larger encyclopedias. It&#39;s bright red and looks quite weathered. You take the book down and examine it. The title seems very interesting to say the least...

&lt;&lt;book &#39;servant&#39; &#39;servant-1&#39; &#39;The Virile Agrarian Servant&#39; &#39;Volume one&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        &lt;b&gt;Act IV, Scene X, continued&lt;/b&gt;?nl
        &lt;em&gt;Robin:&lt;/em&gt; Certainly not, kind sir! I am here but to clean your chambers.?nl

        &lt;em&gt;Magister Colto:&lt;/em&gt; Is that all you have come here for, little one? My chambers??nl
        
        &lt;em&gt;Robin:&lt;/em&gt; I have no idea what it is you imply, magister. I am but a poor agrarian servant.?nl

        &lt;em&gt;Magister Colto:&lt;/em&gt; So you are, my dumpling. And a good one at that. Such strong legs and shapely bust.?nl

        &lt;em&gt;Robin:&lt;/em&gt; You embarrass me, sir!?nl
    &lt;&lt;page&gt;&gt;
        &lt;em&gt;Magister Colto:&lt;/em&gt; Fear not. You are safe here with me.?nl
        
        &lt;em&gt;Robin:&lt;/em&gt; I must finish my cleaning, sir. The mistress will have my head if I do not!?nl
        
        &lt;em&gt;Magister Colto:&lt;/em&gt; Cleaning, eh? I have something for you. Here, polish my spear.?nl
        
        &lt;em&gt;Robin:&lt;/em&gt; But it is huge! It could take me all night!?nl
        
        &lt;em&gt;Magister Colto:&lt;/em&gt; Plenty of time, my sweet. Plenty of time.?nl

        &lt;b&gt;END OF ACT IV, SCENE X&lt;/b&gt;
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        What was that... How did this story get here... You have a lot of questions right now that you unfortunately do not have the answer to.?nl
        At least the writing&#39;s better than that stupid knight book. Perhaps you could find a second volume here somewhere...
        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="447" name="Book servant-2" tags="" position="850,5600" size="100,100">You make your way over to the bookshelf where you left the large tome about the nation&#39;s history. The moment you slide it out of it&#39;s place you suddenly spot something to the side. It&#39;s another one of those small red books and it&#39;s not where you left the first volume. Could it be... Yup, that&#39;s it. &lt;em&gt;The Virile Agrarian Servant, volume two&lt;/em&gt;.?nl
Perhaps it&#39;s unnecessary for you to be productive in your reading everyday. This very sound reasoning makes you put back the book on history and go read this virile one instead.
/* After reading that strange virile servant book you realise you cannot simply forget about that strange book. It was marked with &quot;Volume one&quot; so there must be a second one here somewhere...?nl
You spend quite some time searching, and just before you&#39;re about to give up you suddenly spot another small red book hidden in the back of a shelf somewhere. */

&lt;&lt;book &#39;servant&#39; &#39;servant-2&#39; &#39;The Virile Agrarian Servant&#39; &#39;Volume two&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        &lt;b&gt;Act VI, Scene IX, continued&lt;/b&gt;?nl

        &lt;em&gt;Robin:&lt;/em&gt; My goodness, that&#39;s quite a loaf! But how ever shall it fit my oven??nl

        &lt;em&gt;Magister Colto:&lt;/em&gt; This loaf isn&#39;t ready for baking, my sweet. It has yet to rise.?nl

        &lt;em&gt;Robin:&lt;/em&gt; If only we could hurry that along. How would I accomplish such a task??nl

        &lt;em&gt;Magister Colto:&lt;/em&gt; Oh, my foolish little agrarian servant, you must use your hands.?nl

        &lt;em&gt;Robin:&lt;/em&gt; You wish me to knead the loaf? Here??nl

        &lt;em&gt;Magister Colto:&lt;/em&gt; Of course.?nl
    &lt;&lt;page&gt;&gt;
        &lt;em&gt;Robin:&lt;/em&gt; But what if the mistress catches me? Your loaf was meant to satisfy her appetite.?nl

        &lt;em&gt;Magister Colto:&lt;/em&gt; Don&#39;t fret, my delicate flower. I&#39;ll satisfy the mistress&#39;s cravings later.?nl

        &lt;em&gt;Robin:&lt;/em&gt; Very well, but I&#39;m afraid my oven isn&#39;t hot enough. It could take hours!?nl

        &lt;em&gt;Magister Colto:&lt;/em&gt; Plenty of time, my sweet. Plenty of time.?nl

        &lt;b&gt;END OF ACT VI, SCENE IX&lt;/b&gt;
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        Well... That really doesn&#39;t answer any questions about the first volume... What is this weird relationship between the magister and the servant? ?nl
        This is probably all the answers you&#39;re going to get for now...
        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="448" name="Book servant-3" tags="" position="975,5600" size="100,100">After reading those strange virile servant books you realise you cannot simply forget about that series. It was marked as the volumes one and two, so perhaps there is a third one here somewhere...?nl
This thought motivates you to spend hours searching the library for it. Just before you&#39;re about to give up you suddenly spot another small red book hidden in the back of a shelf somewhere.

&lt;&lt;book &#39;servant&#39; &#39;servant-3&#39; &#39;The Virile Agrarian Servant&#39; &#39;Volume three&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        &lt;b&gt;Act X, Scene XXX, continued&lt;/b&gt;?nl

        &lt;em&gt;Robin:&lt;/em&gt; I am but a simple servant, I couldn&#39;t possibly do that with you!?nl

        &lt;em&gt;Magister Colto:&lt;/em&gt; My sweet, you are wonderful and most deserving to ride with me.?nl

        &lt;em&gt;Robin:&lt;/em&gt; That&#39;s very kind, magister. But I was attesting to my lack of experience...?nl

        &lt;em&gt;Magister Colto:&lt;/em&gt; Oh, that is unexpected, have you no experience riding like this before??nl

        &lt;em&gt;Robin:&lt;/em&gt; I have mounted some here and there but I have never climbed on top a beast like this!?nl
    &lt;&lt;page&gt;&gt;
        &lt;em&gt;Magister Colto:&lt;/em&gt; Ah yes, many say mine is the biggest they have seen.?nl

        &lt;em&gt;Robin:&lt;/em&gt; How would I ever lower myself on top of it??nl

        &lt;em&gt;Magister Colto:&lt;/em&gt; Fear not, my sunshine. I will lift you on top. Grab hold of my lance for me while I guide you in position.?nl

        &lt;em&gt;Robin:&lt;/em&gt; Thank you. I&#39;ve never mounted something so big before. I want to enjoy this ride for hours to come.?nl

        &lt;em&gt;Magister Colto:&lt;/em&gt; Plenty of time, my sweet. Plenty of time.?nl

        &lt;b&gt;END OF ACT X, SCENE XXX&lt;/b&gt;
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        That&#39;s... Uhm... Somehow even more descriptive than the other volumes... You are actually more worked up by the strange book than you expected... After finishing it you find yourself letting your imagination run wild for a bit.?nl
        &lt;&lt;decision &#39;Imagine yourself as the virile servant&#39; submissiveness large&gt;&gt;
            You imagine yourself as Robin, the virile agrarian servant, doing everything to please your magister... The very clear sexual innuendos make you feel like there&#39;s not much left to the imagination. Polishing his spear, kneading his bread, riding his... You&#39;d do it all for him...?nl
            It&#39;s probably best you leave the library for now...
            &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
            &lt;&lt;/decision&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
        &lt;&lt;decision &#39;Imagine yourself as the magister&#39; dominance large&gt;&gt;
            You imagine yourself as Magister Colto and having your own virile servant to play with. The very clear sexual innuendos make you feel like there&#39;s not much left to the imagination. Polishing your spear, kneading your bread, riding your... You&#39;d have the servant do it all for you...?nl
            It&#39;s probably best you leave the library for now...
            &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
            &lt;&lt;/decision&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="449" name="Book histories-1" tags="" position="1100,5600" size="100,100">While perusing the large shelves filled with books, you set your eyes on a very thick tome. Normally you would completely skip over a book that big and probably boring but something draws you to this one. Perhaps because it concerns the history of your own Kingdom. You never cared much about studying this extensively but your annoying conscience suddenly tells you that you should know these things already, especially as a ruler.?nl
You sigh as you lift the heavy book from it&#39;s shelf and set it down at a table. You sit down, preparing yourself for your very sudden spark to do something productive by reading this long book.

&lt;&lt;book &#39;histories&#39; &#39;histories-1&#39; &#39;The Extended History of Avelon&#39; &#39;A compact overview&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        Nullam molestie, turpis in lacinia imperdiet, diam lorem eleifend leo, et gravida lorem turpis eu tellus. Ut tempus et lectus quis auctor. Donec eget justo sapien. Sed diam urna, mattis eget felis et, vulputate cursus lorem. Nunc venenatis felis eu nisi rhoncus vehicula. Sed dapibus ut nisi a ultricies. Nulla non aliquam nibh. Mauris dictum dui posuere felis semper, sollicitudin egestas tellus commodo. Duis pellentesque ante ut lorem rutrum volutpat. Morbi non ligula sit amet neque malesuada pulvinar. Duis ut auctor sapien. Suspendisse a dolor eget magna laoreet vehicula in at ex. Quisque vel nisl imperdiet dolor volutpat blandit. Cras vitae risus quis nisl blandit interdum.
    &lt;&lt;page&gt;&gt;
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam pharetra libero sit amet urna pellentesque, a pharetra lacus porta. Cras sed vestibulum ex. Pellentesque dictum, nibh eu rhoncus scelerisque, magna sapien consectetur nunc, nec semper eros arcu ac ipsum. Curabitur fringilla, magna in mattis ullamcorper, arcu felis bibendum ante, at rutrum felis enim id leo. Maecenas interdum mauris velit, interdum mattis mi malesuada eu. Sed molestie, libero non mattis efficitur, mauris erat convallis felis, et efficitur sapien tortor et leo. Integer dictum est orci, ac pretium ex pellentesque quis. Vestibulum tellus quam, varius semper ultricies sit amet, luctus ut dolor.
    &lt;&lt;page&gt;&gt;
        Curabitur ut dui a est malesuada blandit ac non urna. Phasellus ut convallis justo. Nunc a ipsum sit amet libero tincidunt lacinia non vitae nunc. Nulla in nisi dapibus, cursus purus ac, sagittis eros. Nunc vel sem ac magna faucibus lacinia sit amet consectetur nulla. Quisque lacinia tellus eu turpis efficitur, non ultrices lectus molestie. Nam hendrerit suscipit quam, id pharetra leo malesuada in. Aliquam egestas enim non neque venenatis, id auctor orci sodales. Nullam molestie erat vel dignissim tincidunt. Proin a nisi quis libero aliquet fringilla. Lorem ipsum dolor sit amet, consectetur adipiscing elit.
    &lt;&lt;page&gt;&gt;
        Sed mattis venenatis sem, quis gravida nibh ultrices facilisis. Aenean erat ex, ullamcorper ut massa eu, pretium mattis nulla. Maecenas ornare, ex at volutpat tincidunt, massa justo ornare eros, non varius nulla metus nec lacus. Phasellus eget lacinia est. Mauris lacus nunc, faucibus nec interdum vel, efficitur nec metus. Integer porta, arcu ut accumsan aliquet, odio nunc laoreet nisl, ac aliquet sem diam vitae erat. Vestibulum sollicitudin tortor eu sapien ultricies tempor. Vestibulum feugiat velit sit amet magna commodo, non aliquam nisl congue. Mauris suscipit accumsan pharetra. Nunc eleifend sagittis iaculis. 
    &lt;&lt;page&gt;&gt;
        Mauris scelerisque tincidunt auctor. Sed in lorem ut lacus commodo bibendum lacinia eu mauris. Phasellus lacinia lacinia mollis. Vivamus sodales molestie efficitur. Maecenas hendrerit nunc sem, at ornare risus consequat posuere. Donec id elit blandit, suscipit elit eget, auctor dui. Nunc tristique eros et vulputate ultricies. Pellentesque nisi mauris, elementum quis ultrices et, rutrum sit amet est. Aliquam metus odio, imperdiet sit amet aliquam at, eleifend nec magna. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Morbi imperdiet nulla leo, suscipit sodales diam consectetur ac.
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        &lt;&lt;startquest history-book&gt;&gt;
        You close the book in an annoyed sigh. Why must the book be so long? That&#39;s about all the pages you have motivation for today.?nl
        You must admit that the history of your Kingdom is more interesting than you thought, it also seems important to study this. ?Andreas would probably be proud of your for doing this but you will have to continue this adventure another time when you have the courage to open the book again.
        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="450" name="Book histories-2" tags="" position="1225,5600" size="100,100">You somehow once again convince yourself that it is important to pursue this sudden flash of productivity as you once again reach for the heavy book on history.?nl
You put down the book and open it to the page that continues where you left off.

&lt;&lt;book &#39;histories&#39; &#39;histories-2&#39; &#39;The Extended History of Avelon&#39; &#39;A compact overview&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        Maecenas vitae ullamcorper tellus. Morbi pulvinar dolor sapien, id lobortis nibh maximus in. Praesent consequat lorem eu massa luctus, mollis euismod magna imperdiet. Aenean risus urna, efficitur eu magna vitae, efficitur finibus arcu. Mauris ac lectus vel mi rutrum luctus eu a tellus. Mauris pretium, leo consequat ultricies dapibus, erat lorem laoreet tellus, id lobortis neque nisl feugiat risus. Duis imperdiet, dolor eget varius sagittis, orci dui faucibus augue, vitae consequat justo mauris id justo. Ut sodales massa et ante faucibus congue.
    &lt;&lt;page&gt;&gt;
        Suspendisse tincidunt lorem nec nisl lobortis, vitae volutpat eros luctus. Ut mollis lectus quis magna mollis viverra. Vestibulum pharetra orci eget nibh tincidunt pretium. Nunc in fringilla dolor. Aenean pharetra sit amet magna nec tincidunt. Curabitur pellentesque erat fermentum massa dictum dictum. Quisque interdum varius odio vitae ornare. Donec blandit rutrum purus. Aliquam sed massa sodales, dapibus ipsum in, tincidunt leo. Curabitur ac volutpat nisl. Sed fringilla ac tortor mattis tristique. Nunc vitae sapien iaculis, ullamcorper felis quis, ultricies nulla.
    &lt;&lt;page&gt;&gt;
        Nam mattis nisl sed lacus lobortis, sit amet pellentesque neque viverra. Cras et urna nec sem auctor dapibus. Phasellus tincidunt ornare magna at porttitor. Integer tempus dui ac erat euismod eleifend. Vivamus nec vehicula tellus. Sed porttitor erat quis nisi varius, sed aliquam odio mattis. Pellentesque vitae odio nec risus laoreet suscipit ut cursus odio. Aenean ornare nisl id pharetra cursus. Vestibulum neque nibh, interdum id tempus a, dapibus quis urna. Nam sed auctor dolor, vitae porttitor nibh. Donec odio lacus, interdum quis erat id, imperdiet rutrum ipsum. Praesent tempus ipsum nec risus pulvinar, in dignissim lectus porta.
    &lt;&lt;page&gt;&gt;
        Sed vel congue orci. Nam sed lacus a odio blandit lobortis. Etiam euismod, dolor quis gravida sagittis, sem mauris luctus ipsum, vitae egestas risus orci a leo. Etiam sed justo hendrerit, suscipit ex quis, scelerisque quam. Nam nec ultrices justo. Morbi sed dui at ipsum vulputate euismod quis nec leo. Phasellus ornare lacus ac dolor auctor lobortis. Mauris et nibh eu justo imperdiet vestibulum. Curabitur dictum semper ante sed lacinia. Cras lectus libero, vestibulum sit amet augue ut, aliquam porttitor enim. Quisque convallis dictum magna, non interdum lectus viverra et. Cras molestie elit eget urna euismod, feugiat efficitur massa pretium.
    &lt;&lt;page&gt;&gt;
        Ut blandit dolor non elit rhoncus, at feugiat mi iaculis. Sed non arcu nec nisl ultrices mattis. Pellentesque id laoreet mi. Maecenas eu rhoncus enim. Ut vitae risus ac sapien pharetra pellentesque ac vel eros. Sed sed dictum sapien, ac bibendum purus. Interdum et malesuada fames ac ante ipsum primis in faucibus. Aenean dapibus dui non ullamcorper ornare. Pellentesque gravida neque vitae nisl cursus finibus.
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        You feel yourself getting drowsy so you take the sign to quickly close the book. You&#39;ve made quite some headway into the book but really can&#39;t read anymore today.?nl
        You think you could definitely finish the book with one more solid reading session. That&#39;s for another time though.
        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="451" name="Book histories-3" tags="" position="100,5725" size="100,100">Enough distractions of sultry written books, it&#39;s time to finish this history monster! You feel completely determined and pumped full of energy as you once again lift the heavy book, hopefully for the last time.?nl
However, that energy is quickly fading the moment you open the book to where you left off and are reminded of how small the lettering is... 

&lt;&lt;book &#39;histories&#39; &#39;histories-3&#39; &#39;The Extended History of Avelon&#39; &#39;A compact overview&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        Etiam elementum arcu at ipsum elementum, vitae aliquam nulla efficitur. Cras scelerisque cursus interdum. Nulla nec tortor urna. Ut gravida metus sed turpis dapibus, at interdum massa tempor. Fusce bibendum porta tellus eu ultrices. Donec ac accumsan augue. Nullam vel purus arcu. Morbi tristique, dui quis maximus ornare, odio justo euismod nisi, eu accumsan magna ligula in odio. Sed velit lorem, ornare sit amet dui vel, iaculis accumsan metus. Quisque quis turpis magna. Ut eu justo tempus, tincidunt mi in, semper ligula.
    &lt;&lt;page&gt;&gt;
        Fusce elementum, tellus nec semper elementum, leo quam fermentum leo, egestas rutrum magna purus non arcu. Nullam blandit bibendum massa, sit amet rutrum ante sagittis at. Nulla venenatis sapien a varius ultrices. Fusce a pretium tellus, nec fringilla augue. Duis in neque orci. Donec id quam vel enim tempor pulvinar. Fusce malesuada aliquam tellus vel fringilla. Nulla in iaculis dui. Mauris ullamcorper urna at lorem eleifend, sed lacinia metus interdum. Suspendisse tincidunt ante quis nisi consectetur ornare. Mauris vel blandit tortor. 
    &lt;&lt;page&gt;&gt;
        Ut placerat eu ex id mollis. Maecenas vitae orci eros. Vivamus id dignissim arcu. Maecenas aliquam lobortis quam, a vulputate nisi lobortis at. Suspendisse sodales quam convallis tellus vestibulum, non placerat felis varius. Aenean non sodales purus. Donec id ex non eros ultrices gravida. Vivamus urna eros, venenatis non condimentum eget, tincidunt eget erat. Phasellus sed malesuada ligula, quis hendrerit erat. Integer tristique orci eros, id elementum risus blandit sed. Vestibulum dictum nisl et purus blandit rutrum. Nulla ultricies orci et nibh feugiat iaculis. Ut condimentum elementum augue, in tristique dui.
    &lt;&lt;page&gt;&gt;
        Nam rutrum libero ut placerat congue. Sed dapibus scelerisque sollicitudin. Cras vestibulum bibendum lacinia. Nam maximus suscipit convallis. Vivamus lectus sem, aliquet nec ullamcorper eu, vehicula a tellus. Maecenas pulvinar sodales turpis, ac volutpat velit aliquet ut. Morbi eleifend arcu at sagittis faucibus.
    &lt;&lt;page&gt;&gt;
        Duis vitae tortor nec mauris molestie feugiat. Cras luctus erat eu aliquet facilisis. In hac habitasse platea dictumst. Etiam at tristique turpis. Suspendisse venenatis diam metus, eget volutpat urna consequat non. Praesent vestibulum at risus id elementum. Integer ornare dolor ullamcorper, sodales neque in, mollis tortor. Fusce condimentum metus nulla, eget congue purus dictum in. Cras varius elit sed sapien fringilla, vel lacinia velit varius. Aliquam quis nisl in tortor dictum aliquam sed quis nisi. Mauris enim sapien, fringilla vel erat ut, congue viverra elit. 
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        &lt;&lt;if not hasRead(&#39;histories-3&#39;)&gt;&gt;
            &lt;&lt;changestat statesmanship 2&gt;&gt;
            &lt;&lt;acknowledgechanges history-book andreas&gt;&gt;
            &lt;&lt;completequest history-book&gt;&gt;
        &lt;&lt;/if&gt;&gt;
        You close the book with a heavy thud. You have never finished a book with such satifaction before. Not because of the compelling story but just because it is now finally &lt;em&gt;over&lt;/em&gt;. You actually did it, and to be honest? The stuff you read was quite interesting, you actually feel like you learned a lot from this book.?nl 
        You feel like this knowledge of history you now gained has actually set you ahead in your statesmanship experience and you can definitely impress ?Andreas with this.?nl 
        Now, time to leave this library. You&#39;ve definitely done enough reading for a while.
        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="452" name="Book dinner-etiquette" tags="" position="225,5725" size="100,100">You browse through the shelves, your eyes landing on a prim and proper-looking volume embossed with an intricate floral pattern. It&#39;s been some time since the etiquette lessons of your youth, which you barely paid attention to anyway. Perhaps you should brush up on your knowledge. You pick up the book and flip to a random section.

&lt;&lt;book &#39;dinner-etiquette&#39; &#39;dinner-etiquette&#39; &#39;Mrs. Featherswallow\&#39;s Guide to Dining Etiquette&#39; &#39;The timeless art of culinary elegance and civility&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        Chapter 72: Sudariography?nl

        One may say with conviction that all those of royal or indeed noble blood are familiar with &lt;i&gt;floriography&lt;/i&gt;, the language of flowers. A lesser-known, yet equally important form of cryptological communication is that of &lt;i&gt;sudariography&lt;/i&gt;, the language of napkins.?nl

        These two arts communicate similar messages, but each serves its own context. Flowers, of course, are best reserved for those messages transmitted at distance, to wish an ailing friend well or covertly convey attraction to a far-flung forbidden lover. Napkins, in contrast, are the well-trained diner&#39;s means of signalling hidden messages in close quarters.
    &lt;&lt;page&gt;&gt;
        Floriography calls for a delicate touch. A single fold of a corner, or the precise angle of a seam, may determine whether a message conveys flirtation or contempt. Listed here are the meanings most frequently employed in a formal dining context.?nl

        Two corners folded inward: Chastity. A cause of great disappointment among suitors hoping for an exciting evening.?nl

        Folded square: Friendship. A sweet signal of devotion between confidants.?nl

        Folded triangle: Disdain, its recipient indicated with the foremost point. The instigator of many a duel.?nl
    &lt;&lt;page&gt;&gt;
        Two corners spread wide: Lust. If eye contact is maintained while performing the shape, expect the recipient to take this as an immediate invitation.?nl

        Four corners folded inward: Love. When accompanied by the gift of a ring, indicates an invitation of elopement.?nl

        Of course, the language of napkins is a subtle and ever-changing art. New meanings arise and old meanings change. The best classroom is therefore the formal dinner itself.?nl 
        
        Pay attention to the subtle shapes its diners create, and you will become aware of the secondary conversation that underlies every dinner event worth its salt.
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        Quite some time passes as you engross yourself in this etiquette book, fascinated by the oddly specific information it imparts. When you finally put it down, you have gained a much better understanding of how to behave at your next formal dinner.
        
        &lt;&lt;if not hasRead(&#39;dinner-etiquette&#39;)&gt;&gt;
            Perhaps you could use this newfound knowledge to get an invitation to one of ?Kathryn&#39;s dinner parties?
        &lt;&lt;/if&gt;&gt;

        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="453" name="Book royal-houses-1" tags="" position="350,5725" size="100,100">In an act of oddly determined spontanaeity, you pick a random book off the shelves and determine to read it from cover to cover!?nl

Upon reading the title, your fervor substantially diminishes. Settling into a nice chair you can only hope the authors found a way to make lists of royal families and their sigils interesting &lt;i&gt;somehow&lt;/i&gt;...

&lt;&lt;book &#39;royal-houses&#39; &#39;royal-houses-1&#39; &#39;The Illuminated Compendium of Noble Bloodlines&#39; &#39;Vol 1: An Intricate and Complete Record of Esteemed Lineages Within the Central Realms&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        Though we, the authors, expect our readers are already quite familiar with the various noble houses of our great kingdom, we have taken the liberty of providing a brief overview of the most relevant histories, before delving into the more obscure and scandalous tales of our royal families. We hope you find our work enlightening and entertaining.?nl

        It is well known that the royal family goes back for centuries. What is less known is that the greater nobility have been intermarrying for just as long. The result is a tangled web of alliances and betrayals that have shaped the course of our history.?nl
    &lt;&lt;page&gt;&gt;
        Among the central houses, honor is considered both a shield and a weapon. From ancient times, we have held that family honor is the highest ideal. This fierce loyalty, however, has not prevented betrayals.?nl

        Indeed, we recall a particular great house whose patriarch was found to have orchestrated the assassination of his own son. While the court of the time became aware of the father&#39;s treachery in due time, they could not unearth the motive, but we are pleased to write that we have discovered the reason for this heinous act.?nl
    &lt;&lt;page&gt;&gt;
        Having been caught in a compromising position with his son&#39;s wife, the father feared that his son would discover the truth and reveal him before the court. In a desperate bid to protect his reputation, the father hired an assassin to kill his son.?nl

        It is believed that this assassin fled the kingdom and was never caught. The father, however, was ultimately executed for a completely different crime - a theft from the royal treasury.?nl
    &lt;&lt;page&gt;&gt;
        More on that later; before that, we must cover the story of the youngest daughter of a lesser foriegn house who for reasons we will yet get into was betrothed to a prince of the realm. The prince, however, was already romantically involved with a distant step-cousin from a branch of the royal family that had fallen out of favor.?nl

        The king of the time, in an effort to save face, ordered that the prince&#39;s step-cousin be married off to a prince from another kingdom. This, of course, led to a rather outrageous scandal culminating in treason. Allow me to elaborate...?nl
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        The book continues in its oddly conversational tone for hundreds of pages, reading like a soap opera with intrigue and betrayal aplenty. You find yourself oddly engrossed in the tales of the noble families, including a rather salacious few stories regarding your great-grandmother, and before you know it you&#39;ve finished the first volume.?nl
        
        &lt;&lt;if not hasRead(&#39;royal-houses-1&#39;)&gt;&gt;
            Oddly enough, you find that you have retained some knowledge of the local noble lines. You feel as though you could stumble through a conversation about the various local houses, if you were unable to avoid it.
            &lt;&lt;changestat statesmanship 1&gt;&gt;
            &lt;&lt;acknowledgechanges royal-houses-1 kathryn&gt;&gt;
        &lt;&lt;/if&gt;&gt;

        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="454" name="Book royal-houses-2" tags="" position="475,5725" size="100,100">Picking a book at random from the cavernous shelves, you groan as you read the title.?nl

While the first volume felt torturous at times, you must admit that the section documenting royal scandals from ages past was rather entertaining. Who would have known your great-grandmother was such a &lt;i&gt;seductress&lt;/i&gt;? Besides, you&#39;ve always been curious about your northern neighbors...

&lt;&lt;book &#39;royal-houses&#39; &#39;royal-houses-2&#39; &#39;The Illuminated Compendium of Noble Bloodlines&#39; &#39;Vol 2: A Detailed Account of the Northern Dynasties and Relevant Heraldric Insignias&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        We greet you once again, reader, and hope that you have found our previous volume to be both enlightening and entertaining. We have taken great care to ensure that our work is both accurate and engaging, and we hope that you will find our efforts to be worthwhile.?nl

        Without further delay, we shall delve into the histories of the northern houses, and the tales of their rise and fall. These dynasties are truly a breed apart from our local kingdoms, ruling through violence and subterfuge rather than honor and tradition.?nl
    &lt;&lt;page&gt;&gt;
        Unlike the nobility of other realms, who preoccupy themselves with idle pleasures, the northern dynasties puruse their own ideal of perfection. In the north, the strong are entitled to exert absolute control, while the weak seek to perfect endurance by weathering the trials of the strong.?nl
        
        Might does not have a monopoly on strength in the north, with guile valued often above brute power. This has led to a vast history of intrigue, which we shall begin to elaborate upon as we discuss a set of great coups which greatly shaped the region&#39;s development.?nl
    &lt;&lt;page&gt;&gt;
        As they say, keep your friends close and your enemies closer. This has not always worked to the favor of the ruling house, as evidenced by the plight of the 4th dynasty of the previous age.?nl

        Indeed, their rule was ended as much by the machinations of their allies as by the swords of their enemies. The dynastic head was widely known to have a weakness for the ladies, which his allies used to their advantage.?nl
    &lt;&lt;page&gt;&gt;
        Due to an affair with the wife of a powerful ally general that led to the creation of a bastard, the patriarch of a minor house was able to extract certain concessions from the ruling house, one of which allowed them to elevate their own ill-reared sons as generals in the dynastic military.?nl

        Now, we must discuss briefly the greatest enemy of this house, who would eventually usher in the 5th dynasty. Through the aid of a powerful sorceress, and good old fashioned bribery, they were able to seduce several of these sub-par generals to their cause. This greatly undermined the stability of the ruling dynasty, kickstarting this next series of events...?nl
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        As in the first volume, the authors continue to discuss the intricacies of northern politics at considerable length. Honestly, you have read tales of heroic adventurers with less bloodshed and posturing, but it keeps your attention throughout the tome.?nl
        
        &lt;&lt;if not hasRead(&#39;royal-houses-2&#39;)&gt;&gt;
            Though almost none of the ancient dynastic families yet remain, the lesson on northern history and culture was quite helpful. You feel as though you wouldn&#39;t make a &lt;i&gt;complete&lt;/i&gt; fool of yourself if you were to interact with a northern noble.
            &lt;&lt;changestat statesmanship 1&gt;&gt;
            &lt;&lt;acknowledgechanges royal-houses-2 kathryn&gt;&gt;
            /* &lt;&lt;acknowledgechanges roval-houses-2 sybille&gt;&gt; */
        &lt;&lt;/if&gt;&gt;

        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="455" name="Book royal-houses-3" tags="" position="600,5725" size="100,100">You head to the library with grand plans to broaden your knowledge, selecting a tome with a sturdy spine and a promisingly shiny cover.?nl

Once again, you have played yourself. You nearly put it back, but you recall how &lt;i&gt;suspenseful&lt;/i&gt; the overlapping coup attempts from 3 dynastic families back were in the 2nd volume. Why not see what the western kingdoms are getting up to...

&lt;&lt;book &#39;royal-houses&#39; &#39;royal-houses-3&#39; &#39;The Illuminated Compendium of Noble Bloodlines&#39; &#39;Vol 3: A Faithful Enumeration of Distinguished Rulers and Clans of the Western Dominance&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        It is a delight for us to welcome you once more, reader. In this, our third volume, we delve into the mysteries of the western kingdom prior to its fall and fragmentation. We begin with the tale of a princess - the same that we mentioned in our first volume, that married into our kingdom&#39;s royal bloodline.?nl

        The princess herself was, as you already know, particularly adept at the art of seduction. Before she was sent to wed our prince, she made a rather scandalous round throughout the western courts, leading the church to make a rare request directly to her father, the King of the West, requesting he reign her in lest her deviance prove contagious.?nl
    &lt;&lt;page&gt;&gt;
        Now, it should be mentioned, we are not ones to judge the lives of the nobility. However, the princess&#39; actions were so scandalous as to include a number of affairs with the wives of various nobles. That is normal enough, but the scandal which sealed her plight with the church was how... verbose... the wives&#39; confessionals were. It seems the church of the time thought she might well be the end of noble progeny altogether were it not for timely intervention.?nl

        The one saving grace for her was that these copious dalliances did result in a rather prodigious number of powerful acquaintanecs she could blackmail for her own safety. On no less than 57 documented occassions she was able to stave off censure by calling upon these ranks for champions.?nl
    &lt;&lt;page&gt;&gt;
        Despite the swath of deadly duels over her honor, the king was regrettably unfruitful, with only the princess and a meager three male heirs to his lineage. Though he could not simply discard her, he was presented with a fine opportunity when our kingdom approached him about a royal marriage.?nl

        And here we leave her story, as you already know the rest from our first volume. There is much yet to be said of the western kingdom and its tumultuous fracture into the noble clans we know of in the modern era. For you see, the first and second prince were targeted for assassination for their own reasons.?nl
    &lt;&lt;page&gt;&gt;
        The first prince&#39;s fate is, we must say, a rather tragic case. Poisoned by his own wife, he was left to die in agony while she fled to the southern kingdom - smuggled by supporters from one of the most powerful clans. This deeply aggrieved the king, who had been quite fond of his eldest son.?nl

        Following the passing of the first prince, the king took ill and left many duties to the second prince. The court stirred with growing rivalry and treasonous whispers, culminating in the kidnapping and eventual execution of the second prince by another faction of the court. This leaves the plight of the third son...?nl
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        You cannot look away from the pages as the book elaborates on the internal power struggles that western kingdom suffered, the flight of the 3rd prince under cover of night, and the subsequent fracturing of the once-great kingdom.?nl
        
        &lt;&lt;if not hasRead(&#39;royal-houses-3&#39;)&gt;&gt;
            Reflecting on this volume, you find that you better understand the power dynamic between the factions, clans, and would-be-kings of the west. Though far from confident, you expect that you could handle a brief discussion on the political state of the western dominance.
            &lt;&lt;changestat statesmanship 1&gt;&gt;
            &lt;&lt;acknowledgechanges royal-houses-3 kathryn&gt;&gt;
        &lt;&lt;/if&gt;&gt;

        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="456" name="Book royal-houses-4" tags="" position="725,5725" size="100,100">At this point you have to admit you are just a glutton for punishment. You find the 4th volume of The Illuminated Compendium of Noble Bloodlines right away. Is it sad that you&#39;ve learned where the series is shelved? Probably.?nl

Still, you can&#39;t help your curiosity about just &lt;i&gt;what&lt;/i&gt; happened to the 3rd prince of the old western kingdom who fled south after its fall. You&#39;ve always been a sucker for a good hero&#39;s journey...

&lt;&lt;book &#39;royal-houses&#39; &#39;royal-houses-4&#39; &#39;The Illuminated Compendium of Noble Bloodlines&#39; &#39;Vol 4: The Exhaustive Chronicle of Venerated Families and Emblems Across the Southern Isles and Beyond&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        Reader, you may be astonished at the volume of information we have compiled for you in this, our fourth volume. Indeed, our contact with the south has been limited for many ages now, but we are happy to present the most complete collection of southern lore yet assembled.?nl

        We begin where we left off in our previous tome with the 3rd prince of the western kingdom. After his flight south following the collapse of centralized rule in the western dominance, he was captured by pirates and ransomed to one of the many southern kingdoms.?nl
    &lt;&lt;page&gt;&gt;
        While in the dungeon of this kingdom, he was subjected to various humiliations and magical experiments. After countless years, he was finally released - the kingdom&#39;s spymasters convinced they had extracted every iota of value from his mind and body.?nl

        Now alone on the streets, the prince was forced to beg for scraps of food and shelter. It was during this time that he met a mysterious individual, who offered him a chance to regain his honor and avenge his family.?nl
    &lt;&lt;page&gt;&gt;
        This individual we believe to actually be an agent of our kingdom, though almost every record has been destroyed. They provided for him the whereabouts of the first prince&#39;s wife and a vial of strength potion. You recall, she had fled to the southern kingdom after poisoning his brother, her husband the first prince.?nl

        The prince, now less man than revenant wraith, set out to find her. He tracked her to a remote isle, where she had taken up residence after drinking a brew that changed her body into a man&#39;s. The prince had also been subjected to transformation magic in the dungeon, however, and was able to get in close without being noticed.?nl
    &lt;&lt;page&gt;&gt;
        Downing the strength vial, the prince revealed himself and challenged the vile rogue to a duel. When they tried to run, he finished them in mere moments, taking their life and finally avenging his family and restoring his honor.?nl

        Regrettably, his victory was short-lived. They had nicked him with a poisoned needle, and his ravaged body was unable to withstand the toxins. He died on the beach, as would his story had not the mysterious individual brought back this tale and secreted it in the catacombs beneath the royal palace...?nl
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        The authors spend a great deal of time discussing the political fallout in the south. Evidently the release of a prisoner who went on to murder a citizen of a neighboring kingdom mere days later was something of a diplomatic incident. Admittedly you lost a great deal of interest when the 3rd prince died.?nl
        
        &lt;&lt;if not hasRead(&#39;royal-houses-4&#39;)&gt;&gt;
            Despite the latter portions of this volume being rather dull, you feel like you learned something about the laws and customs of the southern isles. You think you could probably avoid a diplomatic incident of your own now, not that you are keen to try your luck.
            &lt;&lt;changestat statesmanship 1&gt;&gt;
            &lt;&lt;acknowledgechanges royal-houses-4 kathryn&gt;&gt;
            /* &lt;&lt;acknowledgechanges royal-houses-4 morgana&gt;&gt; */
        &lt;&lt;/if&gt;&gt;

        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="457" name="Book royal-houses-5" tags="" position="850,5725" size="100,100">Having completed the other volumes, you find yourself inexplicably drawn to the 5th and final volume of The Illuminated Compendium of Noble Bloodlines.?nl

Not so long ago you would have scoffed at reading countless pages describing noble lineage. Now you find you are more engrossed in court drama than the maids! You find yourself almost saddened that this is the last volume. &lt;i&gt;Almost&lt;/i&gt;...

&lt;&lt;book &#39;royal-houses&#39; &#39;royal-houses-5&#39; &#39;The Illuminated Compendium of Noble Bloodlines&#39; &#39;Vol 5: The Compilation of the Noble Heritage and Ritual Practices Within the Eastern Kingdoms&#39;&gt;&gt;
    &lt;&lt;page&gt;&gt;
        It is our great pleasure to present you the final tome of our great compendium, reader. With this volume, we shall have covered every corner of the known world and the many kings, queens, and lesser nobles therein. And thus, we begin our discussion of the eastern kingdoms.?nl

        The noble houses of the east have even more ancient roots than our own. The first queen of the east was said to have been a god, who gifted her followers with the knowledge of herbs and magic. The eastern kingdoms are still highly regarded in both respects to this day.?nl
    &lt;&lt;page&gt;&gt;
        Throughout the ages, our kingdom has sent many princesses to the east to marry into their royal families. It is a well-known fact that the eastern kingdoms are almost exclusively matriarchal, which lends great value to our princesses who are less regarded by our other neighbors.?nl

        We have benefitted quite substantially from these marriages, as our princesses have sent back many valuable inventions and secrets from the east. You may not realize, but honeyed cake was also an imported recipe and the roles of our royal advisors are largely based on eastern courts.?nl
    &lt;&lt;page&gt;&gt;
        It is almost impossible to fathom, but the eastern kingdoms of today are a mere shadow of what they once were. A great magical calamity reportedly arose that wiped out entire civilizations and histories that pre-date the contemporary eastern powers by centuries, all in a mere night.?nl

        Now, latent magic still roams the wilds of the east and ancient structures call out to adventurers who hope hope to find occult relics that can be traded for a life of plenty.?nl
    &lt;&lt;page&gt;&gt;
        It has been many years since we last solidified an alliance with any major eastern kingdom. With no princesses to represent us to the matriarchs of the east, we have had to resort to espionage and subterfuge to maintain our influence in the region.?nl

        It is a delicate balance, as the eastern kingdoms are known to be quite ruthless in their dealings with unwelcome outsiders. That reminds us of the tale of an eastern noblewoman whose untimely death led to a war that lasted for 3 generations...?nl
    &lt;&lt;finished&gt;&gt;
        &lt;&lt;increasetime 1&gt;&gt;
        While the authors ramble on about various foreign royal families, their courts, their wars, and their beguiling rituals and customs, you find your thoughts drifting to mythical lost civilizations and the magic that could have unmade them.?nl
        
        &lt;&lt;if not hasRead(&#39;royal-houses-5&#39;)&gt;&gt;
            When you think about it, your own traditions and customs are quite similar to those of the eastern kingdoms. You think you could probably survive a conversation with an eastern noble, though there is far more to noble etiquette that you have not learned.
            &lt;&lt;changestat statesmanship 2&gt;&gt;
            &lt;&lt;acknowledgechanges royal-houses-5 kathryn&gt;&gt;
            &lt;&lt;acknowledgechanges royal-houses-5 andreas&gt;&gt;
            &lt;&lt;addtag &#39;basic-noble-history&#39;&gt;&gt;
            /* This tag will be referenced in future content, and will also change the text for Kathryn&#39;s dinner parties to reflect your new-found cultural knowledge, though you will still need etiquette lessons to not make a complete fool of yourself */
        &lt;&lt;/if&gt;&gt;

        &lt;&lt;decision &#39;Leave&#39; &#39;Library&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
&lt;&lt;/book&gt;&gt;</tw-passagedata><tw-passagedata pid="458" name="Council Bedroom" tags="" position="975,5725" size="100,100">&lt;&lt;outfit standard&gt;&gt;
You once again get woken up by ?Orson with the same message as last week.
&lt;&lt;orson&gt;&gt;I&#39;m sorry to wake you, ?title. The council meeting will be starting soon and they are expecting you.&lt;&lt;/orson&gt;&gt;
&lt;&lt;player&gt;&gt;Ugh... Fine. Would you please prepare a bath for me, ?Orson?&lt;&lt;/player&gt;&gt;
You get up groggily, why must the council always meet this early? The sun is barely up.

&lt;&lt;decision &#39;Have your morning bath before going to the council&#39; &#39;Orson Bathroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="459" name="Council Entrance" tags="" position="1100,5725" size="100,100">As you enter the grand hall you can see the councillors are already present. ?Andreas, ?Leopold, ?Morgana, ?Wymerus, ?Sybille, and ?Devota are all seated around the large table. It seems like they were waiting for you to arrive before starting the meeting.
&lt;&lt;andreas&gt;&gt;Welcome, ?title. I am glad you could join us. Please, have a seat and we can start the meeting.&lt;&lt;/andreas&gt;&gt;

Currently, there are two chairs vacant for you to pick from. One is an ordinary councillors chair and the other is the throne at the head of the table where your father would normally sit to preside over the council. You&#39;re not sure whether ?Andreas is actively testing you, having you make this decision in front of everyone but he is currently waiting for you to take your seat before starting the meeting. Which means all the councillors currently have their attention on you.

&lt;&lt;decision &#39;Sit down in a normal councillors chair&#39; submissiveness large&gt;&gt;
    It feels quite rash to suddenly take the place where your father would normally sit, you don&#39;t feel quite comfortable with that. Besides, you are not a king yet so it&#39;s probably against protocol.
    You see ?Andreas look at you for a moment before starting the meeting.
    &lt;&lt;andreas&gt;&gt;Very well, let us start. I hereby open the meeting of the ?king&#39;s council.&lt;&lt;/andreas&gt;&gt;
    &lt;&lt;decision &#39;Listen to ?Andreas&#39; &#39;Council Quests&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Take your seat at your father\&#39;s throne&#39; dominance huge&gt;&gt;
    You take your time to walk up to the throne, it is sitting slightly higher than the other council chairs and it&#39;s fittingly much more extravagant. You feel all the councillors look at you as you sit down on the throne.
    ?Andreas looks at you with a slightly surprised look, it almost looks like he&#39;s impressed.
    &lt;&lt;andreas&gt;&gt;Very well, let us start. I hereby open the meeting of the ?king&#39;s council.&lt;&lt;/andreas&gt;&gt;
    &lt;&lt;decision &#39;Listen to ?Andreas&#39; &#39;Council Quests&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="460" name="Council Quests" tags="" position="1225,5725" size="100,100">&lt;&lt;if !hasCompletedQuest(&#39;assassination-attempt&#39;)&gt;&gt;
    &lt;&lt;fullname andreas&gt;&gt; stands up to address the rest of the council.
    &lt;&lt;andreas&gt;&gt;Let us get right to it. The assassination attempt on the ?Prince&#39;s life has been a devastating blow to the security of our royal court.&lt;&lt;/andreas&gt;&gt;
    He speaks with clarity and decisiveness. Nobody can argue ?Andreas is not taking the case seriously.
    &lt;&lt;andreas&gt;&gt;&lt;&lt;name sybille &#39;Lady&#39;&gt;&gt;, where are we with the assassin? Do we have any idea who sent him?&lt;&lt;/andreas&gt;&gt;
    &lt;&lt;sybille&gt;&gt;Unfortunately not much progress has been made, ?Chancellor. The man is difficult to crack. Unfortunately, I cannot estimate the motive behind his stunt with any certainly. Give me more time and I can assure you the assassin will tell me what we want to know, my dungeons always get people to talk.&lt;&lt;/sybille&gt;&gt;
    ?Wymerus stands up from his seat.
    &lt;&lt;wymerus&gt;&gt;It must have been one of our neighboring rulers! They have been looking to exploit us even since the ?King left!&lt;&lt;/wymerus&gt;&gt;
    ?Andreas makes a calming motion towards the &lt;&lt;title wymerus&gt;&gt;.
    &lt;&lt;andreas&gt;&gt;Careful, Lord. We cannot make assumptions without evidence. Instead, please tell about the security of the castle, what measurements have you taken?&lt;&lt;/andreas&gt;&gt;
    &lt;&lt;wymerus&gt;&gt;Of course, &lt;&lt;fullname andreas&gt;&gt;. I have doubled the castle guard ever since that last Sunday. I have sent more and more patrols into town. After several sweeps of interrogations, we have found no collaborators. It looks like the assassin acted alone.&lt;&lt;/wymerus&gt;&gt;
    The council is looking to ?Andreas again. It feels strange having all these experienced people talk about a situation that happened to you without really including you much in the conversation.
    &lt;&lt;andreas&gt;&gt;Hmm... I am glad the castle seems secure but we need to know why this happened. I expect answers as soon as you have them, &lt;&lt;title sybille&gt;&gt;.&lt;&lt;/andreas&gt;&gt;
    ?Sybille nods to ?Andreas before he continues the meeting.
    &lt;&lt;decision &#39;Listen to ?Andreas&#39; &#39;Council Meeting&#39;&gt;&gt;
        &lt;&lt;completequest assassination-attempt&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;include &#39;Council Meeting&#39;&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="461" name="Council Meeting" tags="" position="100,5850" size="100,100">?Andreas now turns to you as he addresses you.
&lt;&lt;andreas&gt;&gt;?Title, as you know we have been charged with overseeing your education. We would like to inquire about your progress.&lt;&lt;/andreas&gt;&gt;
You want to give an answer but it looks like ?Andreas wasn&#39;t really looking to hear it from you as he turns to ?Leopold suddenly. You see the &lt;&lt;title leopold &#39;Tradesmaster&#39;&gt;&gt; stand up and clear his throat.
&lt;&lt;if getStatLevel(&#39;stewardship&#39;) &gt;= $player.levelexpectation&gt;&gt;
    &lt;&lt;leopold&gt;&gt;The prince&#39;s education in stewardship is going very well, he is picking up on vital subjects like the different currencies and bookkeeping rather well. I expect to be covering more complicated subject matter with him soon.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;leopold&gt;&gt;Unfortunately, I must report the prince&#39;s education in stewardship has been quite slow. ?Title, I implore you to please visit me more at the Treasury so we can continue your education.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;/if&gt;&gt;

After ?Leopold is done, ?Wymerus stands up to address the room.
&lt;&lt;if getStatLevel(&#39;swordsmanship&#39;) &gt;= $player.levelexpectation&gt;&gt;
    &lt;&lt;wymerus&gt;&gt;The prince has been performing above expectations with his swordfighting. He is already trying more advanced fighting forms and he is a very good match to my personal squire, ?Caspar.&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;wymerus&gt;&gt;?Title, I know sword fighting can be difficult but it is always expected of a good king to have good experience with it. I must ask you to come spar more often, you could use more training with your forms.&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;/if&gt;&gt;

?Andreas nods to the other two councillors as he takes over again.
&lt;&lt;if getStatLevel(&#39;statesmanship&#39;) &gt;= $player.levelexpectation&gt;&gt;
    &lt;&lt;andreas&gt;&gt;And finally, I must say that I am impressed with the prince&#39;s keen sense of governing. He has taken more than enough time with me learning the basics of statesmanship. I feel you are ready for a more difficult challenge now.
    &lt;&lt;/andreas&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;andreas&gt;&gt;And finally, I must report that the prince could use more time learning about matter of state. ?Title, I know it might be more fun to swing a sword around, but learning how to govern this kingdom is of utmost important.&lt;&lt;/andreas&gt;&gt;
&lt;&lt;/if&gt;&gt;
With all accounts over with, ?Andreas directly addresses you once again.

&lt;&lt;if getStatLevel(&#39;stewardship&#39;) &gt;= $player.levelexpectation and getStatLevel(&#39;swordsmanship&#39;) &gt;= $player.levelexpectation and getStatLevel(&#39;statesmanship&#39;) &gt;= $player.levelexpectation&gt;&gt;
    &lt;&lt;andreas&gt;&gt;I think it is clear to see that you have been surpassing our expectations, ?title. Keep up the good work and you will be ready to become a great monarch. If your father was here, he too would be proud of your progress.&lt;&lt;/andreas&gt;&gt;
    The councillors give a small applause as they all look at you and smile. You feel good being this appreciated, it feels nice that they recognise your efforts.
    &lt;&lt;player&gt;&gt;Thank you, my lords. I very much value your mentorship.&lt;&lt;/player&gt;&gt;
    You now look to ?Leopold, anxiously waiting to hear about your reward.
    &lt;&lt;leopold&gt;&gt;Ah, yes! As promised, ?title, I will let you into the ?reliquary and you will be able to pick out and artifact that you can use. Please come by the Treasury whenever you have time.&lt;&lt;/leopold&gt;&gt;
    You are smiling at the prospect of getting an artifact as you enthusiastically nod at him.
    &lt;&lt;startquest retrieve-artifact&gt;&gt;
    &lt;&lt;set $player.levelexpectation += 1&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;andreas&gt;&gt;?Title, I am afraid we have higher expectations of you than what you have currently shown us. It is important that you grasp these subjects before you can learn what it mean to be a good ruler. I hope you will make more time for your education in the future.&lt;&lt;/andreas&gt;&gt;
    The councillors give you a stern look as you sit there in your chair.
    &lt;&lt;leopold&gt;&gt;I am sorry, ?title, but this means I can&#39;t let you into the ?reliquary to pick out an artifact this week. Perhaps next week you could enter, if you study hard enough.&lt;&lt;/leopold&gt;&gt;
    &lt;&lt;player&gt;&gt;Very well... I will see what I can do.&lt;&lt;/player&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;andreas&gt;&gt;Next meeting we will continue to review your progress. I personally look forward to tutoring you again, ?title.&lt;&lt;/andreas&gt;&gt;

&lt;&lt;andreas&gt;&gt;And with that, I will close this meeting of the council. Thank you, Lords and Ladies, that will be all.&lt;&lt;/andreas&gt;&gt;
The councillors get up one by one to leave the chambers.

&lt;&lt;decision &#39;Leave the hall&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="462" name="Kingdom Stats" tags="no-title, no-location" position="225,5850" size="100,100">&lt;&lt;stowsidebars&gt;&gt;
&lt;div class=&quot;kingdom-stats passage-block&quot;&gt;
    &lt;h2 class=&quot;location-title&quot;&gt;Balance of the Kingdom&lt;/h2&gt;
    &lt;div class=&quot;stat-track stability&quot;&gt;
        &lt;div class=&quot;line&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;circles&quot;&gt;
            &lt;div class=&quot;circle&quot;&gt;&lt;&lt;img &#39;icons/skull.png&#39;&gt;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;&lt;img &#39;icons/skull.png&#39;&gt;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;&lt;icon stability&gt;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;stat-track authority&quot;&gt;
        &lt;div class=&quot;line&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;circles&quot;&gt;
            &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;&lt;icon authority&gt;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;stat-track treasury&quot;&gt;
        &lt;div class=&quot;line&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;circles&quot;&gt;
            &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;&lt;icon treasury&gt;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;stat-track whispers&quot;&gt;
        &lt;div class=&quot;line&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;circles&quot;&gt;
            &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;&lt;icon whispers&gt;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;stat-track welfare&quot;&gt;
        &lt;div class=&quot;line&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;circles&quot;&gt;
            &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt; &lt;div class=&quot;circle&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;&lt;icon welfare&gt;&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;&lt;set $test = { authority: 5, treasury: -1, whispers: -3, welfare: 2 }&gt;&gt;
&lt;&lt;textbox &quot;$test.authority&quot; `$test.authority`&gt;&gt; &lt;&lt;button &#39;authority&#39;&gt;&gt;
    &lt;&lt;changestat &#39;authority&#39; `$test.authority`&gt;&gt;
&lt;&lt;/button&gt;&gt; &lt;br&gt;

&lt;&lt;textbox &quot;$test.treasury&quot; `$test.treasury`&gt;&gt; &lt;&lt;button &#39;treasury&#39;&gt;&gt;
    &lt;&lt;changestat &#39;treasury&#39; `$test.treasury`&gt;&gt;
&lt;&lt;/button&gt;&gt; &lt;br&gt;

&lt;&lt;textbox &quot;$test.whispers&quot; `$test.whispers`&gt;&gt; &lt;&lt;button &#39;whispers&#39;&gt;&gt;
    &lt;&lt;changestat &#39;whispers&#39; `$test.whispers`&gt;&gt;
&lt;&lt;/button&gt;&gt; &lt;br&gt;

&lt;&lt;textbox &quot;$test.welfare&quot; `$test.welfare`&gt;&gt; &lt;&lt;button &#39;welfare&#39;&gt;&gt;
    &lt;&lt;changestat &#39;welfare&#39; `$test.welfare`&gt;&gt;
&lt;&lt;/button&gt;&gt; &lt;br&gt;</tw-passagedata><tw-passagedata pid="463" name="Dilemma" tags="no-title no-location" position="350,5850" size="100,100">&lt;&lt;include &#39;Kingdom Stats&#39;&gt;&gt;
&lt;&lt;if dilemmaResult()&gt;&gt;
    Last week we discussed
    &lt;&lt;include `dilemmaResult()`&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Next dilemma&#39;&gt;&gt;
    &lt;&lt;goto `randomDilemma()`&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="464" name="Dilemma Revellers of Fruit" tags="dilemma" position="475,5850" size="100,100">?TrademasterLeopold stands up and loudly clears his throat before speaking to the council.

&lt;&lt;leopold&gt;&gt;Esteemed council, I have heard some terrible news. A new cult is rising among the general populace. &quot;The Revellers of Fruit&quot; they call themselves. They have gained far too much support - hundreds of people now attend their ritualistic festivals. They must be stopped at once!&lt;&lt;/leopold&gt;&gt;

Slightly confused, you look around to the other councilors and make eye contact with ?Andreas, who raises his eyebrows, showing a like-minded disposition as you. He gives a slight cough as he turns to ?Devota.

&lt;&lt;andreas&gt;&gt;Ah, uhm- If it&#39;s a cult that&#39;s the problem, why is it that our ?Trademaster is coming with this and not you, ?Devota?&lt;&lt;/andreas&gt;&gt;

?Devota gives a shrug while she gives an explanation.

&lt;&lt;devota&gt;&gt;I&#39;m not sure, ?Chancellor. I don&#39;t really see this cult as a problem. They&#39;re quite harmless, really. All they ask for is a large offering of fruits from their members. The Fruit Festivals that ?TrademasterLeopold seems to dislike are actually quite entertaining, so many exotic fruity drinks they make!&lt;&lt;/devota&gt;&gt;

?Leopold stands up, looking slightly annoyed and continues his plight.

&lt;&lt;leopold&gt;&gt;Harmless?! It&#39;s exactly this massive amount of fruit that&#39;s the problem! Our fruit merchants simply cannot handle this increase in demand, it&#39;s ruining our fruitage-economy! We must outlaw these cultist gatherings at once!&lt;&lt;/leopold&gt;&gt;

?Andreas, while still looking a bit confused, turns to you now.

&lt;&lt;andreas&gt;&gt;Very well. ?Title, how would you suggest we go about this issue?&lt;&lt;/andreas&gt;&gt;

These fruit festivals sound quite entertaining so it&#39;d be sad to ban them. But, even though it&#39;s harsh, the kingdom&#39;s wealth would probably be better off without them seeing how adamant ?Leopold is about this...

&lt;&lt;decision &#39;Tax the Fruit Festival&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;How about, instead of banning them outright, we simply put a tax on their festivals instead? We allow them to continue their gatherings only if they hand off say...ten percent of all fruit to the crown.&lt;&lt;/player&gt;&gt;

    ?Leopold gives you a smile and and bows to you.

    &lt;&lt;leopold&gt;&gt;A genius idea, ?title! I will start writing the new tax decree immediately!&lt;&lt;/leopold&gt;&gt;

    ?Devota looks slightly disappointed, this new law will likely result in less fruit festivals for people to enjoy.
    &lt;&lt;resolvedilemma 1&gt;&gt;
    &lt;&lt;decision &#39;Continue the meeting&#39; &#39;Dilemma&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Invest in more fruit&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;I see no reason to outlaw these benevolent gatherings. Why don&#39;t we invest in more fruit instead? We could grow more fields in the countryside and pay for more shipments of exotic fruits. These festivals sound like something to be cultivated more.&lt;&lt;/player&gt;&gt;

    ?Leopold shifts a bit uncomfortably in his chair, you notice the sweat on his forehead as he nods to you.

    &lt;&lt;leopold&gt;&gt;Ah, of course, what a- uhm- splendid idea, ?title. I will try to see if I can gather the funds for that somewhere...&lt;&lt;/leopold&gt;&gt;

    ?Leopold immediately starts writing some things down, he&#39;s probably very stressed from this proposition. ?Devota looks towards you and gives you a warm smile, she seems quite happy with this solution.
    &lt;&lt;resolvedilemma 2&gt;&gt;
    &lt;&lt;decision &#39;Continue the meeting&#39; &#39;Dilemma&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="465" name="Dilemma Revellers of Fruit Result 1" tags="" position="600,5850" size="100,100">&lt;&lt;leopold&gt;&gt;My lords and ladies, I am proud to announce that the new Tax law implemented on the Fruit Festivals has had a tremendously positive effect. Our royal coffers have been bolstered by the ample amounts of fruit that we&#39;ve been able to liquidize.&lt;&lt;/leopold&gt;&gt;

?Devota very obviously rolls her eyes and stands up to responds.

&lt;&lt;devota&gt;&gt;Well yes. That may be right, ?Trademaster, but you&#39;re forgetting the fact that these taxes have effectively driven out the festivals, they&#39;re now looking for different kingdoms to move to.&lt;&lt;/devota&gt;&gt;

She sighs and takes her seat again. Looks like your decision to tax the fruit has given your kingdom a fair bit of wealth but resulted in less fun festivals for the people.</tw-passagedata><tw-passagedata pid="466" name="Dilemma Revellers of Fruit Result 2" tags="" position="725,5850" size="100,100">&lt;&lt;leopold&gt;&gt;My lords and ladies, after a considerable investment, we have received more shipments of exotic fruits and will soon start to produce more as well. All this to cultivate these Fruit Festivals...&lt;&lt;/leopold&gt;&gt;

?Devota stands up and starts clapping.

&lt;&lt;devota&gt;&gt;Fantastic work, ?TrademasterLeopold! Don&#39;t mind the cost so much! Why don&#39;t you come to experience the &lt;em&gt;fruits&lt;/em&gt; of your labour for once?&lt;&lt;/devota&gt;&gt;

?Leopold looks a bit annoyed before he gives a long sigh.

&lt;&lt;leopold&gt;&gt;Oh well, why not I suppose... Might as well go see what&#39;s so great about it...&lt;&lt;/leopold&gt;&gt;

Your decision to invest in fruits has made the festivals much more popular, which has a great impact on the mood of the people. Unfortunately, this investment did cost quite a bit of gold from your royal coffers...</tw-passagedata><tw-passagedata pid="467" name="Dungeons Locked Up" tags="" position="850,5850" size="100,100">You look back to the guard, trying to keep your breathing steady. You&#39;ve never had to answer to authority in this way before, let alone be in trouble with the law. Being powerless to change the situation feels awful, but revealing your identity is simply untenable.?nl

You take a deep breath and stand up straight, trying to salvage your dignity.

&lt;&lt;player&gt;&gt;I will choose a night in the dungeons.&lt;&lt;/player&gt;&gt;

You catch a vague expression of disappointment, but don&#39;t have long to dwell on it before you find yourself being marched up to the castle. You walk in a daze, an eternity seeming to pass before you approach an entrance on the side of the castle that leads directly to the dungeon. You marvel briefly at how you never knew this entrance existed before you feel yourself being pushed into a cell and hear the click of the door locking behind you.

&lt;&lt;say &#39;Guard&#39;&gt;&gt;Someone will come let you out...eventually. Good luck getting any sleep tonight.&lt;&lt;/say&gt;&gt;

You hear footsteps retreating into the dungeons and find yourself left there, shivering in the cold cell.

&lt;&lt;decision &#39;Settle in for the night&#39; &#39;Dungeons Locked Up Wait&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="468" name="Dungeons Locked Up Wait" tags="" position="975,5850" size="100,100">&lt;&lt;setlocation &#39;Dungeons&#39;&gt;&gt;

You look around the dungeon cell. There are a handful of others already here, most of them slumped against the cell bars in a drunken stupor. A stench of body odor and stale beer lingers in the air, mixing with an aroma of piss coming from a bucket in the corner. You sit down and try to get comfortable on the hard, hay-strewn floor.?nl

You stay there for some time, your mind racing as you replay the events of the day. Eventually you start drifting in and out of consciousness, your sense of time stretching until it feels as though you have been in this dungeon cell forever.

&lt;&lt;decision &#39;Try to find some rest&#39; &#39;Dungeons Sybille Rescue&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="469" name="Dungeons Sybille Rescue" tags="" position="1100,5850" size="100,100">&lt;&lt;settime &#39;Night&#39;&gt;&gt;

You have no idea what time it is or how many hours have passed when a familiar voice brings you back to wakefulness.

&lt;&lt;sybille&gt;&gt;Come on, let&#39;s get you up.&lt;&lt;/sybille&gt;&gt;

The other cell inhabitants glance up hopefully, but you see that ?Sybille is looking at you. In the darkness, her white hair shines like a beacon of hope.

&lt;&lt;player&gt;&gt;Oh, thank you, ?Sybille...&lt;&lt;/player&gt;&gt;

You stumble blearily out of the cell, which ?Sybille locks behind you. She leads you out of the dungeons and into her office, where she sits down at her desk and gives you an amused look. 

&lt;&lt;sybille&gt;&gt;So, you&#39;ve been naughty, I see.&lt;&lt;/sybille&gt;&gt;

You avoid her gaze, looking away in embarrassment. Out of the corner of your eye, you see ?Sybille smile.

&lt;&lt;sybille&gt;&gt;We all have to be naughty sometimes, ?title. In fact, I believe it is essential for our health. I only apologize that I could not release you sooner. I wanted to avoid any undue attention.&lt;&lt;/sybille&gt;&gt;

&lt;&lt;player&gt;&gt;Oh... Yes, I understand. Thank you again, ?Sybille.&lt;&lt;/player&gt;&gt;

She looks at you closely, clearly noting the exhaustion in your face.

&lt;&lt;sybille&gt;&gt;Please, ?title, don&#39;t let me keep you from your rest.&lt;&lt;/sybille&gt;&gt;

You nod your thanks and retreat to your bedroom, careful to avoid any others wandering the castle in the middle of the night.

&lt;&lt;decision &#39;Collapse in bed and fall asleep&#39; &#39;Sleep&#39;&gt;&gt;
    &lt;&lt;outfit standard&gt;&gt;
    &lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="470" name="Castle navigation" tags="" position="1225,5850" size="100,100">&lt;&lt;if getTime() === &#39;night&#39;&gt;&gt;
    &lt;img src=&quot;images/maps/castle_night.png&quot; class=&quot;navigation-map&quot; usemap=&quot;#castle-map&quot;&gt;
&lt;&lt;else&gt;&gt;
    &lt;img src=&quot;images/maps/castle.png&quot; class=&quot;navigation-map&quot; usemap=&quot;#castle-map&quot;&gt;
&lt;&lt;/if&gt;&gt;

&lt;map name=&quot;castle-map&quot;&gt;
    &lt;area data-passage=&quot;Bathroom&quot; alt=&quot;Bathroom&quot; center=&quot;683,227&quot; coords=&quot;455, 123, 911, 331&quot; shape=&quot;rect&quot;&gt;
    &lt;area data-passage=&quot;Treasury&quot; alt=&quot;Treasury&quot; center=&quot;683,848&quot; coords=&quot;455, 745, 911, 951&quot; shape=&quot;rect&quot;&gt;
    &lt;area data-passage=&quot;Grand hall&quot; alt=&quot;Grand hall&quot; center=&quot;683,539&quot; coords=&quot;455, 332, 911, 745&quot; shape=&quot;rect&quot;&gt;
    &lt;area data-passage=&quot;Barracks&quot; alt=&quot;Barracks&quot; center=&quot;1839,269&quot; coords=&quot;1570, 125, 2108, 413&quot; shape=&quot;rect&quot;&gt;
    &lt;area data-passage=&quot;Hallway&quot; alt=&quot;Hallway&quot; center=&quot;1902,537&quot; coords=&quot;1571, 414, 2232, 660&quot; shape=&quot;rect&quot;&gt;
    &lt;area data-passage=&quot;Gatehouse&quot; alt=&quot;Gatehouse&quot; center=&quot;2335,537&quot; coords=&quot;2232, 414, 2438, 660&quot; shape=&quot;rect&quot;&gt;
    &lt;area data-passage=&quot;Dining hall&quot; alt=&quot;Dining hall&quot; center=&quot;1777,806&quot; coords=&quot;1570, 659, 1984, 953&quot; shape=&quot;rect&quot;&gt;
    &lt;area data-passage=&quot;Larder&quot; alt=&quot;Larder&quot; center=&quot;2356,950&quot; coords=&quot;2357, 951, 87&quot; shape=&quot;circle&quot;&gt;
    &lt;area data-passage=&quot;Bedroom&quot; alt=&quot;Bedroom&quot; center=&quot;289,330&quot; coords=&quot;123, 536, 124, 211, 132, 211, 139, 210, 145, 209, 150, 208, 155, 206, 160, 204, 165, 201, 170, 199, 175, 196, 179, 192, 183, 189, 187, 185, 191, 181, 195, 176, 198, 171, 201, 166, 204, 161, 206, 155, 208, 150, 210, 144, 211, 139, 211, 134, 212, 129, 212, 124, 454, 123, 454, 536&quot; shape=&quot;poly&quot; vertical=&quot;true&quot;&gt;
    &lt;area data-passage=&quot;Kitchen&quot; alt=&quot;Kitchen&quot; center=&quot;2170,806&quot; coords=&quot;1984, 659, 2356, 660, 2356, 863, 2346, 863, 2337, 865, 2329, 867, 2321, 871, 2314, 874, 2308, 878, 2302, 882, 2295, 887, 2290, 893, 2285, 900, 2281, 907, 2277, 914, 2274, 921, 2272, 927, 2271, 934, 2270, 941, 2270, 951, 1984, 953&quot; shape=&quot;poly&quot;&gt;
    &lt;area data-passage=&quot;Library&quot; alt=&quot;Library&quot; center=&quot;289,744&quot; coords=&quot;124, 537, 455, 537, 455, 951, 208, 951, 208, 943, 208, 936, 207, 929, 204, 923, 201, 916, 198, 909, 195, 904, 191, 899, 187, 894, 182, 890, 178, 885, 173, 881, 167, 878, 162, 875, 157, 873, 152, 871, 147, 869, 142, 868, 137, 866, 132, 865, 127, 865, 122, 865&quot; shape=&quot;poly&quot; vertical=&quot;true&quot;&gt;
    &lt;area data-passage=&quot;Magic Circle&quot; alt=&quot;Magic Circle&quot; center=&quot;124,124&quot; coords=&quot;125, 125, 87&quot; shape=&quot;circle&quot;&gt;
    &lt;area data-passage=&quot;Dungeons&quot; alt=&quot;Dungeons&quot; center=&quot;2233,269&quot; coords=&quot;2107, 413, 2108, 125, 2274, 125, 2274, 111, 2275, 101, 2279, 91, 2285, 80, 2291, 72, 2297, 66, 2304, 59, 2313, 52, 2324, 49, 2334, 45, 2345, 44, 2356, 43, 2365, 43, 2375, 44, 2384, 47, 2393, 50, 2400, 54, 2407, 59, 2413, 65, 2418, 71, 2424, 79, 2428, 85, 2432, 93, 2436, 102, 2438, 111, 2438, 121, 2437, 132, 2436, 143, 2432, 151, 2428, 160, 2424, 170, 2417, 177, 2411, 185, 2404, 190, 2396, 197, 2387, 201, 2378, 202, 2368, 203, 2360, 203, 2354, 203, 2356, 414&quot; shape=&quot;poly&quot; vertical=&quot;true&quot;&gt;
    &lt;area data-passage=&quot;Courtyard&quot; alt=&quot;Courtyard&quot; center=&quot;1241,538&quot; coords=&quot;911, 290, 1073, 288, 1073, 277, 1075, 268, 1077, 260, 1079, 251, 1081, 241, 1084, 233, 1087, 225, 1091, 217, 1096, 210, 1101, 203, 1105, 195, 1109, 189, 1115, 183, 1121, 177, 1126, 171, 1131, 166, 1137, 160, 1143, 155, 1149, 151, 1155, 147, 1162, 143, 1169, 140, 1177, 137, 1183, 134, 1191, 131, 1199, 130, 1206, 129, 1213, 128, 1221, 127, 1227, 125, 1233, 125, 1239, 125, 1245, 125, 1251, 125, 1257, 126, 1263, 126, 1270, 127, 1276, 128, 1283, 130, 1290, 131, 1297, 133, 1302, 135, 1309, 139, 1314, 141, 1320, 143, 1325, 145, 1330, 149, 1335, 153, 1340, 156, 1345, 160, 1350, 164, 1355, 168, 1360, 174, 1365, 179, 1369, 185, 1373, 190, 1377, 196, 1381, 203, 1385, 209, 1388, 216, 1392, 224, 1394, 230, 1397, 237, 1399, 243, 1401, 251, 1403, 258, 1403, 266, 1404, 273, 1404, 279, 1405, 288, 1570, 290, 1570, 787, 1407, 784, 1406, 793, 1405, 801, 1405, 809, 1404, 817, 1402, 825, 1400, 831, 1398, 837, 1396, 845, 1393, 851, 1391, 857, 1388, 863, 1384, 868, 1380, 874, 1377, 879, 1372, 884, 1367, 889, 1363, 894, 1359, 898, 1355, 903, 1350, 907, 1345, 911, 1340, 915, 1336, 919, 1331, 923, 1326, 927, 1321, 929, 1316, 933, 1311, 936, 1305, 937, 1300, 940, 1294, 943, 1289, 945, 1283, 946, 1277, 948, 1270, 949, 1265, 949, 1259, 949, 1253, 949, 1247, 950, 1242, 950, 1236, 950, 1230, 950, 1224, 949, 1219, 948, 1213, 948, 1207, 947, 1201, 946, 1195, 944, 1189, 942, 1183, 941, 1177, 939, 1171, 937, 1165, 934, 1159, 931, 1154, 927, 1148, 923, 1142, 919, 1137, 915, 1131, 910, 1126, 905, 1121, 900, 1117, 895, 1112, 889, 1107, 884, 1103, 878, 1099, 872, 1097, 867, 1095, 860, 1092, 854, 1089, 848, 1087, 842, 1084, 836, 1081, 829, 1079, 822, 1078, 816, 1077, 808, 1077, 800, 1077, 793, 1077, 786, 912, 784&quot; shape=&quot;poly&quot;&gt;
    &lt;area data-passage=&quot;Garden&quot; alt=&quot;Garden&quot; center=&quot;742,1142&quot; coords=&quot;217, 1044, 2266, 1240&quot; shape=&quot;rect&quot;&gt;
    &lt;area data-passage=&quot;Workshop&quot; alt=&quot;Workshop&quot; center=&quot;122,951&quot; coords=&quot;123, 952, 86&quot; shape=&quot;circle&quot;&gt;
&lt;/map&gt;</tw-passagedata><tw-passagedata pid="471" name="Bedroom" tags="location castle" position="100,5975" size="100,100">Your bedroom is adorned with lavish tapestries depicting scenes from the legends of your ancestors. The bed is made of the finest wood and draped in expensive silken sheets. The windows overlook the gardens, where the roses are in full bloom and the lilies sway in the breeze. Your room also contains a desk, where you write letters or read books, and an armoire, where you store your clothing.</tw-passagedata><tw-passagedata pid="472" name="Wardrobe" tags="location castle" position="225,5975" size="100,100">Your extensive walk-in wardrobe is filled to the brim with royal outfits and options to pick from. Silk robes decorated with fine embroidery is all too common to you. The average peasant would be flabbergasted at the amount of clothes you have at your disposal.</tw-passagedata><tw-passagedata pid="473" name="Bathroom" tags="location castle" position="350,5975" size="100,100">The bathroom attached to your bedroom is a luxurious affair, with a large bathtub made of white marble and a separate shower. There are plush towels and bathrobes hanging on the hooks, and the shelves are stocked with expensive soaps and shampoos.</tw-passagedata><tw-passagedata pid="474" name="Hallway" tags="location castle" position="475,5975" size="100,100">The hallway is lined with portraits of your ancestors, each wearing the same regal expression. The walls are painted a deep red, and the floor is made of polished marble. You can hear the sound of your footsteps echoing down the corridor as you walk.</tw-passagedata><tw-passagedata pid="475" name="Grand hall" tags="location castle" position="600,5975" size="100,100">The grand hall is an imposing space. The walls are adorned with tapestries depicting scenes from history. In the center of the hall stands a big table surrounded by chairs, this is where the council usually gathers. At the head of the table sits an empty throne which belongs to your father.</tw-passagedata><tw-passagedata pid="476" name="Kitchen" tags="location castle" position="725,5975" size="100,100">The servant&#39;s kitchen is a bustling place, filled with the aromas of freshly baked bread and simmering stews. The walls are lined with shelves of pots and pans, and there is a large stove in the center of the room.</tw-passagedata><tw-passagedata pid="477" name="Dining hall" tags="location castle" position="850,5975" size="100,100">The dining hall is a grand space, with a long table in the center and ornate chandeliers hanging from the ceiling. There is a fireplace on one wall, and the floors are made of polished marble.</tw-passagedata><tw-passagedata pid="478" name="Garden" tags="location castle" position="975,5975" size="100,100">The castle garden is a beautiful space, with a pond in the center and a cobblestone path winding through it. There are flowerbeds filled with roses, lilies, and other colorful blooms.</tw-passagedata><tw-passagedata pid="479" name="Courtyard" tags="location castle" position="1100,5975" size="100,100">The castle courtyard is an open area surrounded by tall walls. There is a fountain in the center, and the cobblestone path leads out to the city beyond the gates.</tw-passagedata><tw-passagedata pid="480" name="Library" tags="location castle" position="1225,5975" size="100,100">The castle library is a magnificent space, with walls lined with books and shelves stacked with scrolls and manuscripts. There is a large fireplace in the center of the room, and the floors are made of polished marble.</tw-passagedata><tw-passagedata pid="481" name="Treasury" tags="location castle" position="100,6100" size="100,100">The treasury consists of a small office, home to &lt;&lt;fullname leopold &#39;Master&#39;&gt;&gt;, with next to it the door leading to the royal vault and reliquary.

/* :: Boudoir [location castle] 
The boudoir is a room in the castle where courtesans would prepare themselves to look the most pleasing. It is decorated with silk curtains and a vanity mirror. The walls are painted red and gold, and the floor is covered by a carpet. */</tw-passagedata><tw-passagedata pid="482" name="Larder" tags="location castle" position="225,6100" size="100,100">The larder is a small room filled with foodstuffs. There are barrels of wine, stacks of bread, and chests full of meat. The air is thick with the smell of fresh bread and cooking meat.</tw-passagedata><tw-passagedata pid="483" name="Barracks" tags="location castle" position="350,6100" size="100,100">This large room is where most of the castle garrison sleeps. It is bustling with soldiers either practicing or making their beds.</tw-passagedata><tw-passagedata pid="484" name="Dungeons" tags="location castle" position="475,6100" size="100,100">The castle dungeon is a dark, dank place with many corridors and cells. There are also torture chambers and a large room with a pit in the middle.</tw-passagedata><tw-passagedata pid="485" name="Workshop" tags="location castle" position="600,6100" size="100,100">The &lt;&lt;title morgana&gt;&gt;&#39; Workshop is a large room located in one of the tall castle towers. It is filled with magical items, ingredients, and books. There is also a cauldron in the center of the room that can be used to create potions.</tw-passagedata><tw-passagedata pid="486" name="Gatehouse" tags="location castle" position="725,6100" size="100,100">The castle gates stand tall and sturdy, with massive wooden doors reinforced by iron fittings. Flanked by solid stone walls, the entrance exudes a sense of security.</tw-passagedata><tw-passagedata pid="487" name="Royal Reliquary" tags="location castle" position="850,6100" size="100,100">The Royal Reliquary is filled to the brim with artifacts and gold. You see several chests filled with valuable pieces and the walls are lined with different artifacts and relics.</tw-passagedata><tw-passagedata pid="488" name="Leave castle" tags="" position="975,6100" size="100,100">You see two guards standing next to the castle gates.
&lt;&lt;if hasVisited(&#39;Sneak out&#39;)&gt;&gt;
    You could quickly change into your disguise and sneak out of the castle.
    &lt;&lt;decision &#39;Sneak out and head to the forest&#39; &#39;Meadow&#39;&gt;&gt;
        &lt;&lt;outfit disguise&gt;&gt;
        &lt;&lt;decisionicon forest&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;if hasCompletedQuest(&#39;sybille-tavern&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Sneak out and head to town&#39; &#39;Road&#39;&gt;&gt;
            &lt;&lt;outfit disguise&gt;&gt;
            &lt;&lt;decisionicon town&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Grab your disguise and sneak out the castle&#39; &#39;Disguise Change&#39;&gt;&gt;
        &lt;&lt;outfit disguise&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="489" name="Bedroom Decisions" tags="" position="1100,6100" size="100,100">&lt;&lt;if hasTag(&#39;has-artifact&#39;)&gt;&gt;
    &lt;&lt;decision &#39;View Artifacts&#39; 1&gt;&gt;
        &lt;&lt;artifacts&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &#39;Open your wardrobe&#39; &#39;Wardrobe Clothes&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;if getTime() === &#39;night&#39;&gt;&gt;
    &lt;&lt;decision &#39;Sleep&#39; &#39;Sleep&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;elseif getTime() === &#39;morning&#39;&gt;&gt;
    &lt;&lt;decision &#39;Skip day&#39; &#39;Skipday&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="490" name="Garden Decisions" tags="" position="1225,6100" size="100,100">&lt;&lt;if hasQuest(&#39;rosa-bouquet&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Pick a bouquet of flowers for ?Rosa&#39; &#39;Rosa Pick Flowers&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="491" name="Kitchen Decisions" tags="" position="100,6225" size="100,100">&lt;&lt;if hasTag(&#39;adopt-cats&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Visit the cats&#39; &#39;Visit Cats Kitchen&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="492" name="Library Decisions" tags="" position="225,6225" size="100,100">&lt;&lt;if hasQuest(&#39;find-poet-3&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Look for ?Orson&#39; &#39;Orson Find Library&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="493" name="Bandit" tags="" position="350,6225" size="100,100">&lt;&lt;decision &#39;Sneak up to the bandit camp&#39; &#39;Bandit Encounter&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="494" name="Bandit Encounter" tags="" position="475,6225" size="100,100">&lt;&lt;addcounter bandit 2&gt;&gt;
You know this is definitely the dangerous part of the woods. That bandit you met when harvesting mushrooms together with ?Morgana told you his camp was in this direction. You&#39;re not sure why you&#39;ve now decided to sneak in that direction but something has you curious...?nl

Even though you can&#39;t see anyone around you for a while you still find yourself crouching through the bushes. It&#39;s not the most comfortable path&lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;, especially in this dress&lt;&lt;/if&gt;&gt;. After sneaking for quite a while you finally notice the signs of the bandit camp in the distance. You can see the campfire and you can hear the rowdy laughter of drunk highwaymen over there. You make your way as close as you feel comfortable. Curiosity has made you do many things in life, but none of them quite as crazy as this. You get close enough to actually make out the bandits themselves, there&#39;s quite a number of them. They seem to be having a gathering complete with drunken feast. It&#39;s at this moment that you decide it&#39;s probably best to head back before you get caught.?nl


&lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;
    As soon as you turn around you see a man standing right behind you. It&#39;s the same bandit that caught you gathering mushrooms near the waterfall...
    &lt;&lt;bandit&gt;&gt;Look at that, you actually came to the camp.&lt;&lt;/bandit&gt;&gt;
    You can&#39;t believe you got caught so easily, even worse, by the same bandit who caught you before. You slowly back away but realise you can&#39;t really go backwards that far otherwise you&#39;ll be seen by the other bandits in camp. Nevertheless, the man standing in front of you is taking a step in your direction.
    &lt;&lt;bandit&gt;&gt;So what is it you came here to find? Perhaps you were hoping to get caught in the woods again...&lt;&lt;/bandit&gt;&gt;
    You look at him quite befuddled as you stammer a response.
    &lt;&lt;player&gt;&gt;No- uh, I was just curious about the camp here. N- nothing more...&lt;&lt;/player&gt;&gt;
    The bandit looks you up and down with leering eyes.
    &lt;&lt;bandit&gt;&gt;Is that why you came crossdressing again? Doesn&#39;t seem practical for sneaking through the woods...&lt;&lt;/bandit&gt;&gt;
    He&#39;s got a point there. Why is it that you came out here now, looking for trouble? You&#39;re not sure how to respond to his question and the bandit takes the moment to get even closer to you. You&#39;re suddenly thinking about the large gathering of bandits behind you. What if this guy decides to take you back to his camp? You look behind you towards the bandit camp and then look back to the guy standing in front of you with a scared look.
    &lt;&lt;bandit&gt;&gt;Are you worried I&#39;m going to alert the rest of the camp? Well don&#39;t be scared, I would much rather not get anyone else involved here.&lt;&lt;/bandit&gt;&gt;
    Hearing this gives you some slight relief which is immediately replaced with worries about his intentions.
    &lt;&lt;bandit&gt;&gt;Maybe the proposal I made last time had you intrigued. Maybe that&#39;s why you came back... Why don&#39;t you help me out with this issue I&#39;m having now...&lt;&lt;/bandit&gt;&gt;
    You see the bandit not so subtly touch his crotch area which is apparently already sporting quite the bulge. You&#39;re strangely fixated on it as he slowly puts a hand on your shoulder and softly pushes downward, indicating he wants you to go down on your knees.?nl

    Is he seriously asking you to... Last time you met the bandit, he seemed to sort of handle your rejection pretty well. You could probably just back off from this situation if you want to. Strangely enough, something in you is actually considering his request as well... All alone in the woods... Who would know about this...
    
    &lt;&lt;decision &#39;Back off&#39; &#39;Bandit Encounter Deny&#39; virtue large&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Get down on your knees...&#39; &#39;Bandit Blowjob&#39; depravity large&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    You slowly start making your way back to the safer parts of the woods. Bandits are not for you to deal with right now, it&#39;s a good thing you didn&#39;t get caught.
    &lt;&lt;decision &#39;Return to the woods&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="495" name="Bandit Encounter Deny" tags="" position="600,6225" size="100,100">You don&#39;t budge to his attempts to get you to your knees and take a step back.
&lt;&lt;player&gt;&gt;How many times do I have to tell you no?! I&#39;m not interested!&lt;&lt;/player&gt;&gt;
The bandit, quickly startled, looks at you with a flabbergasted expression.
&lt;&lt;bandit&gt;&gt;Well now, you came all the way over here in your dress simply to reject me again? I even told you where to find me and you came looking for me!&lt;&lt;/bandit&gt;&gt;
&lt;&lt;player&gt;&gt;Uhm, yeah. Just because I was curious about your camp here doesn&#39;t mean I want to do &lt;em&gt;that&lt;/em&gt; with you.&lt;&lt;/player&gt;&gt;
He looks at you, slightly offended and gives a retort back.
&lt;&lt;bandit&gt;&gt;I mean, that&#39;s all good. I&#39;m not going to force you or anything...&lt;&lt;/bandit&gt;&gt;
He seems to be thinking some things over.
&lt;&lt;bandit&gt;&gt;Sorry, I suppose I misread the situation...&lt;&lt;/bandit&gt;&gt;
&lt;&lt;player&gt;&gt;It&#39;s fine, I&#39;m just not interested. I&#39;m going to go now.&lt;&lt;/player&gt;&gt;
&lt;&lt;bandit&gt;&gt;Alright, see you around I guess.&lt;&lt;/bandit&gt;&gt;
The bandit walks past you in the direction of the camp, looking a bit disappointed. You decide to make your way back to the safer parts of the woods.
&lt;&lt;decision &#39;Return&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="496" name="Bandit Blowjob" tags="spicy" position="725,6225" size="100,100">&lt;&lt;addsin &#39;blowjob&#39;&gt;&gt;
You can&#39;t believe you&#39;re actually doing this... It&#39;s almost like your body is on auto control. Something about this bandit has you worked up and you&#39;re secretly quite curious of what&#39;s about to happen...
&lt;&lt;bandit&gt;&gt;There&#39;s a good girl... Now lower my trousers for me.&lt;&lt;/bandit&gt;&gt;
Seriously? He&#39;s going to give you commands and wants you to do everything? You think about backing out but the burning feeling inside you wants you to keep going. Your hands move forward, searching for a way to lower his pants. You stumble on a bulge right in front of your face... Is that his...??nl
You slowly manage to lower his pants and the answer to your questions suddenly hits you in the face. Literally.?nl
His cock is big. &lt;&lt;if settings.sph&gt;&gt;Much bigger than your ?dick.&lt;&lt;/if&gt;&gt; 
You stare at it in disbelief. 
&lt;&lt;bandit&gt;&gt;Yeah you like that, don&#39;t you? Come on, why don&#39;t you give it a kiss?&lt;&lt;/bandit&gt;&gt;
You stare up at him slightly annoyed. You actually don&#39;t follow his command right away but instead you do find yourself taking hold of his shaft, exploring his massive cock. Somehow you are already stroking this random bandit you met in the woods right now...
&lt;&lt;bandit&gt;&gt;Go on... Kiss it...&lt;&lt;/bandit&gt;&gt;
His tone turns slightly more demanding but it&#39;s strange to note that the actual thing convincing you are your own thoughts, wanting to continue with this. Underneath your dress, your ?dick is already rock hard. You&#39;re not sure why the situation is turning you on so much and you push the thought away as you give the penis head a wet kiss, taking in the smell and taste of his dick. It tastes... Surprisingly nice...
&lt;&lt;bandit&gt;&gt;Yes... Good girl... Now take it into your mouth...&lt;&lt;/bandit&gt;&gt;
Perhaps it&#39;s his scent that makes you so horny or perhaps you just like being submissive to this man but you somehow instantly obey his command this time. You take the dick in your mouth, at first only the cock head as you swirl your tongue around it. It doesn&#39;t take long before you try to take it more and more.
&lt;&lt;img &#39;morgana/bandit_blowjob.gif&#39; &#39;ridge-border&#39; &#39;36em&#39;&gt;&gt;
&lt;&lt;bandit&gt;&gt;Ahhh... That&#39;s nice... Keep going...&lt;&lt;/bandit&gt;&gt;
Somehow hearing his moaning and pleased remarks makes you feel sort of... Proud... Like you&#39;re actually happy that you&#39;re providing a good blowjob to this man you never met before.?nl
You eagerly take in more and more of his cock and bob your head back and forth faster and faster. His moaning continues as you do everything you can to make him feel good.
&lt;&lt;bandit&gt;&gt;I knew you were a cock-slut the moment I saw you... Actually, you don&#39;t mind if I&#39;m a little rough, right?&lt;&lt;/bandit&gt;&gt;
Did he just call you a cock-slut? Why does that make you feel more turned on...? Also, what does he mean with being more rough? You can hardly answer the question right now with his cock in your mouth and it seems like he won&#39;t actually be waiting for a response.?nl
He suddenly grabs your head with both hands and starts pulling and pushing you over his cock. It looks like he wants total control of the situation as he starts pushing his cock deeper and deeper.?nl
You feel his cock slowly starting to enter your throat as you try not to let your gag reflex kick in.
&lt;&lt;bandit&gt;&gt;Just relax your jaw and throat and let me take care of it. You&#39;ll make for a good face-fuck, slut.&lt;&lt;/bandit&gt;&gt;
Strangely enough his advice to relax somehow works as you focus hard to accommodate more and more of his cock down your throat. Instead of moving your head up and down his shaft, he is now simply holding your head in place as he starts pumping his cock back and forth using his hips. He&#39;s actually face-fucking you.?nl
The whole situation has you burning with passion, it&#39;s not really a conscious decision when you find your hand tuck itself under your dress to grab your ?dick so you can start masturbating while he&#39;s skull-fucking you.?nl
Your ?dick is rock hard as you start stroking yourself while the bandit is pumping his cock in and out of your mouth. This increasingly humiliating situation has you completely turned on.
&lt;&lt;bandit&gt;&gt;Ah fuck! Are you ready for my cum, you slut? I&#39;m going to coat the inside of your throat with it.&lt;&lt;/bandit&gt;&gt;
You stroke your ?dick faster and faster as you feel him speeding up as well. He suddenly grunts loudly as he pushes his cock in your mouth all the way to the base. You feel a thick liquid slide down your throat, you don&#39;t even have a choice in whether you swallow this or not as he&#39;s simply dumping it in your throat. At least that saves you from having the bad taste in your mouth, at least, that&#39;s what you think until he suddenly pulls his cock out your mouth and shoots a last rope right over your tongue.?nl
You don&#39;t even hesitate as you quickly swallow his cum and for some reason even look up at him to present your empty mouth to him...
&lt;&lt;bandit&gt;&gt;Fuck that was great... I didn&#39;t realise you are a cumslut as well... I can cum on your face next time if you want, make you walk around with my seed presented everywhere.&lt;&lt;/bandit&gt;&gt;
You should be done... He already came... He took his cock out of your mouth and is finished... But for some reason you are still down on your knees. You don&#39;t know whether it&#39;s the hotness of the situation or the fact that he continues to degrade you but you can only focus on one thing right now. You&#39;re really close to climaxing so you continue stroking, looking up at him. It probably looks kind of strange, a guy on his knees in a dress, rigorously masturbating himself...?nl
&lt;&lt;bandit&gt;&gt;Oh... I see... The sissy isn&#39;t done yet... Very well, I&#39;ll help you a bit. I need to clean this cock anyways.&lt;&lt;/bandit&gt;&gt;
The bandit suddenly grabs your head and simply shoves his slightly softening cock and forces it all the way down to the base. Your nose is stuffed in his pubes as you take a big inhale, seeping in his scent. You start masturbating faster and faster as he&#39;s simply holding you in place with his cock down your mouth. Does this bandit even know he just shot his cum down the prince&#39;s mouth? That he used your royal mouth as his personal fucktoy? The thoughts of him finding out have you even more turned on.?nl
It doesn&#39;t take long for you to feel your orgasm approach. You let out a very muffled moan as your mouth is currently occupied with cock as your own ?dick spurts out the biggest orgasm you&#39;ve had probably ever, completely soiling the inside of your dress.
&lt;&lt;bandit&gt;&gt;Ah there we go, glad to see you had a good time too.&lt;&lt;/bandit&gt;&gt;
The bandit slowly starts to pull his cock out of your mouth and takes a step back, fixing his trousers. You&#39;re still down on your knees, panting as you take in what just happened.
&lt;&lt;bandit&gt;&gt;You did very well, little slut.&lt;&lt;/bandit&gt;&gt;
/* &lt;&lt;bandit&gt;&gt;You should come visit us next time you&#39;re here though, I have some friends at my camp who would love to meet you and learn of your particular skills.&lt;&lt;/bandit&gt;&gt; */
You start to rise from your knees and fix your dress. He starts to walk away from you, looking satisfied.
&lt;&lt;bandit&gt;&gt;Now I must really be going. Good luck in the woods out here, try not to suck too many cocks on your way out.&lt;&lt;/bandit&gt;&gt;
You can&#39;t believe you actually just did that... And most of all enjoy it too...
&lt;&lt;if getTime() is &#39;night&#39;&gt;&gt;
    &lt;&lt;decision &#39;Time to head back to the castle&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Make your way back&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="497" name="Gather Mushrooms" tags="" position="850,6225" size="100,100">You set out in the woods to find some mushrooms. You know exactly the kind that ?Hyssop likes and which to avoid.?nl

&lt;&lt;include `either(&#39;Gather Mushrooms Bad&#39;, &#39;Gather Mushrooms Good&#39;, &#39;Gather Mushrooms Great&#39;)`&gt;&gt;

You managed to find &lt;&lt;money mushrooms false _gathered&gt;&gt; mushrooms.
&lt;&lt;changemoney mushrooms _gathered&gt;&gt;

&lt;&lt;decision &#39;Return&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="498" name="Gather Mushrooms Bad" tags="" position="975,6225" size="100,100">Feeling the adventurous spirit, you make your way into a part of the woods you haven&#39;t been to before. After a long time travelling without any luck in mushrooms you manage to find a nice patch of them next to some trees. At least... Whatever&#39;s left of them. It seems like something came through here and trampled all the mushrooms, completely destroying most of them. You manage to pick out a few that are still mostly intact but unfortunately that&#39;s all you have managed to gather today.?nl

&lt;&lt;set _gathered = random(2, 4)&gt;&gt;</tw-passagedata><tw-passagedata pid="499" name="Gather Mushrooms Good" tags="" position="1100,6225" size="100,100">You spend some time following your usual paths, gathering any mushrooms you have missed last time. It results in a decent amount, you manage to find quite a few of them.?nl

&lt;&lt;set _gathered = random(6, 8)&gt;&gt;</tw-passagedata><tw-passagedata pid="500" name="Gather Mushrooms Great" tags="" position="1225,6225" size="100,100">Once you set out deeper in the woods you manage to find a grove you haven&#39;t been to before and luckily it is crawling with mushrooms! It takes quite a bit of time to gather all of them but at the end, you&#39;re left with a basket completely filled with mushrooms!?nl

&lt;&lt;set _gathered = random(10, 12)&gt;&gt;</tw-passagedata><tw-passagedata pid="501" name="Mushroom Gathering" tags="" position="100,6350" size="100,100">&lt;&lt;addcounter &#39;mushroom-gathering&#39; 1&gt;&gt;

&lt;&lt;decision &#39;Return&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="502" name="Waterfall Relax" tags="" position="225,6350" size="100,100">&lt;&lt;addcounter &#39;waterfall&#39; 1&gt;&gt;
&lt;&lt;first&gt;&gt;
    &lt;&lt;include &#39;Waterfall Find Mushroom&#39;&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;include &#39;Lumberjack Meeting Waterfall&#39;&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;include &#39;Eve Meeting Waterfall&#39;&gt;&gt;
&lt;&lt;finally&gt;&gt;
    You approach the waterfall and take a seat beside the pool. For a time, you sit in peace with only the sounds of nature surrounding you. You feel as though you have all the time in the world and may leave whenever you wish.
    &lt;&lt;decision &#39;Return to the forest&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/first&gt;&gt;</tw-passagedata><tw-passagedata pid="503" name="Waterfall Find Mushroom" tags="" position="350,6350" size="100,100">You approach the waterfall, admiring the rainbow of colors shimmering around the falling water. There is no one else around and you hear only the crashing of water and the singing of birds.?nl

You take a seat on a mossy rock near the edge of the pool and take a moment to enjoy the silence. It&#39;s nice to be alone outside of the castle, where no one has any expectations of you and you can simply be yourself.?nl

As you sit there quietly, a glimpse of teal catches your eye amidst the grasses growing around the pool. Is it the mushroom that you saw last time you were here? Leaning forward to get a better view, you see a yellow mushroom covered in bright teal spots that almost glow in contrast to the surrounding vegetation. This must be that other kind of mushroom ?Morgana told you about. Though you know you are alone, something in the sound of the rushing water seems to beckon you to taste the  mushroom....

&lt;&lt;decision &#39;Pick the mushroom and eat it&#39; &#39;Waterfall Mushroom Trip&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Resist the urge and simply enjoy the waterfall&#39; &#39;Waterfall Meditation&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="504" name="Waterfall Meditation" tags="" position="475,6350" size="100,100">You wisely decide not to touch the mushroom. ?Morgana told you not to pick this kind; for all you know, it could be a deadly poison.?nl

You sit back on the mossy rock and continue to enjoy the sounds of the water and the birds. After a time, your eyes close, and you allow your cares to drift away.?nl

When you open your eyes again, you&#39;re not sure how much time has passed, but you feel a sense of inner peace.

&lt;&lt;decision &#39;Find your way back out of the forest&#39; &#39;Meadow&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="505" name="Waterfall Mushroom Trip" tags="" position="600,6350" size="100,100">Almost as if you are in a trance, you pluck the mushroom and swallow it. Bizarrely, it tastes the way that the earth smells after rain. It is a strange flavor, but not unpleasant.?nl

For several minutes, you sit on the rock and contemplate why you just did that. It seems like a terrible idea to eat a strange mushroom you found in the forest, especially when ?Morgana told you not to collect this kind. However, you don&#39;t feel immediately ill...?nl

As you&#39;re scanning your body for any signs of illness, you notice that the water in the waterfall seems to suddenly be moving...upwards rather than downwards? Not only that, but the rainbow colors in the water are now becoming physical, manifesting into pure whisps of color that separate into a hundred tiny dancing figures around the edge of the pool. Some of them separate from the dance and curl around your body. Each time they touch you, you feel a warm, pleasant tickling sensation. Yup, the mushroom is definitely affecting you.

&lt;&lt;decision &#39;Lie down&#39; &#39;Waterfall Mushroom Trip 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="506" name="Waterfall Mushroom Trip 2" tags="" position="725,6350" size="100,100">&lt;&lt;effect charm on &quot;rgba(0,255,127, 0.5)&quot;&gt;&gt;
You feel an intense need to lie down. You settle into the grasses next to the pool, which are impossibly soft as they envelop your body. You feel as though you are sinking into the grass for hours, your body heavy as a boulder.?nl

After what could have been days, you become aware that an inconceivably perfect voice has been singing to you from the waterfall. As you crane your neck to see, you spot something emerging from the waterfall.?nl

A being made of roiling water walks toward you, surrounded by a rainbow light so bright you can barely stand to look at it. Even though you can&#39;t quite make out the features of this being, you know with certainty that they are the most beautiful creature you have ever seen in your life.

&lt;&lt;say &#39;Spirit&#39;&gt;&gt;I have seen you once before.&lt;&lt;/say&gt;&gt; 

When they speak, their voice sounds like the rush of fast-moving water.

&lt;&lt;player&gt;&gt;I- wha- who are you?&lt;&lt;/player&gt;&gt;

As you speak, you trip over your tongue, which feels like a heavy river stone. Though you try to enunciate, your words come out slurred.

&lt;&lt;say &#39;Spirit&#39;&gt;&gt;I am the inhabitant of this waterfall, a guardian of the forest.&lt;&lt;/say&gt;&gt;

&lt;&lt;player&gt;&gt;You are so beautiful.&lt;&lt;/player&gt;&gt;

The being makes a sound that is both laughter and the burbling of water in a stream. 

&lt;&lt;say &#39;Spirit&#39;&gt;&gt;You are also beautiful. All creatures of the earth are beautiful. The trees shelter all those who walk below them, and the stream cools all feet that walk in it.&lt;&lt;/say&gt;&gt; 

Before you can say anything in response, the grasses around your body grow taller and seem to embrace you around your maid outfit.

&lt;&lt;player&gt;&gt;I- thank you. Why are you telling me this?&lt;&lt;/player&gt;&gt;

&lt;&lt;say &#39;Spirit&#39;&gt;&gt;The wind carries glimpses of the future. You are beautiful and you will be beautiful.&lt;&lt;/say&gt;&gt;

The colors around the spirit grow brighter, so bright that you shut your eyes involuntarily against the glare...

&lt;&lt;hyssop&gt;&gt;?player, is that you?&lt;&lt;/hyssop&gt;&gt;

&lt;&lt;decision &#39;Open your eyes&#39; &#39;Hyssop Interrupts Trip&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="507" name="Hyssop Interrupts Trip" tags="" position="850,6350" size="100,100">When you open your eyes, the water spirit is gone and you instead see ?Hyssop standing over you, a look of concern on their face.

&lt;&lt;hyssop&gt;&gt;Oh my goodness, ?player, did you eat one of the yellow spotted mushrooms? Oh, no, I surely would have expected ?Morgana to warn you about them! She always performed so well in our herbalism classes, too...&lt;&lt;/hyssop&gt;&gt;

Groggily, you attempt to sit up, but when you try to move your limbs they feel impossibly heavy. Your mouth feels so dry.

&lt;&lt;hyssop&gt;&gt;No, no ?player! Please stay lying down. You are not in any danger, but you are going to have an interesting next few hours! Allow me to bring you back to my cottage.&lt;&lt;/hyssop&gt;&gt;

&lt;&lt;decision &#39;Go with ?Hyssop to their cottage&#39; &#39;Hyssop Trip Sits&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="508" name="Hyssop Trip Sits" tags="" position="975,6350" size="100,100">&lt;&lt;setlocation &#39;Druid Hut&#39;&gt;&gt;

You&#39;re not sure how ?Hyssop transports you back to their cottage, but for the next several minutes your body becomes weightless and you feel as though you must be flying. You are sure that this is how birds feel when they flit effortlessly between the trees.

&lt;&lt;hyssop&gt;&gt;Ah, we are back at my home! I will set you down on this pile of cushions here. I&#39;m sure you will be very comfortable!&lt;&lt;/hyssop&gt;&gt;

The feeling of weightlessness ends and you find yourself comfortably embraced in a pile of multicolored pillows that all smell faintly of dried herbs and flowers. Lying on your back, you watch in fascination as a multitude of flowers begins to grow out of the roof and down the walls of the hut.?nl

?Hyssop disappears from your vision briefly and returns with a cup hollowed from a tree branch and a bowl of plump blue berries. 

&lt;&lt;hyssop&gt;&gt;You must drink! This water is from the freshest brook nearby. It will also do you good to get some food in your belly. These berries are my favorite treat.&lt;&lt;/hyssop&gt;&gt;

With some effort, you are able to drink the water and eat some of the berries. Feeling more comfortable now in your body, you sink back into the pillows and watch the ceiling for a time as visions of colors, plants, and flowers growing and shrinking throughout the hut engulfs your consciousness.?nl

&lt;&lt;decision &#39;Drift asleep&#39; &#39;Hyssop Trip Sits 2&#39;&gt;&gt;&lt;&lt;effect charm off&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="509" name="Hyssop Trip Sits 2" tags="" position="1100,6350" size="100,100">When the visions finally recede and you come back to yourself, you see that ?Hyssop has been sitting nearby weaving a large basket.

&lt;&lt;hyssop&gt;&gt;Ah, ?player! Welcome back!&lt;&lt;/hyssop&gt;&gt;

&lt;&lt;player&gt;&gt;How long have I been...uh, out?&lt;&lt;/player&gt;&gt;

&lt;&lt;hyssop&gt;&gt;For about four hours. I have already made two baskets!&lt;&lt;/hyssop&gt;&gt;

You see that there are indeed two completed baskets next to ?Hyssop. You sit up and clear your throat.

&lt;&lt;player&gt;&gt;I must thank you, ?Hyssop, for kindly taking care of me during that, uh, experience. I did not know that would happen if I consumed that particular mushroom.&lt;&lt;/player&gt;&gt;

?Hyssop smiles brightly. 

&lt;&lt;hyssop&gt;&gt;I am always happy to help, ?player. You might be surprised at how common an occurrence this is for me! People are always mixing up those two kinds of mushrooms. Perhaps I should put up some signs...&lt;&lt;/hyssop&gt;&gt;

You realize you have been gone from the castle now for quite a while. 

&lt;&lt;player&gt;&gt;I must be getting back to the castle. Thank you again, and I will be sure to bring you some mushrooms in the future as further thanks for your assistance.&lt;&lt;/player&gt;&gt;

?Hyssop gives you a cheerful wave as you exit the hut.

&lt;&lt;decision &#39;Make your way back out of the forest&#39; &#39;Meadow&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="510" name="Lumberjack Meeting Waterfall" tags="" position="1225,6350" size="100,100">&lt;&lt;addtag &#39;lumberjack-waterfall&#39;&gt;&gt;
&lt;&lt;changename jack Lumberjack&gt;&gt;
You approach the waterfall, feeling instantly calmed by the familiar sound of rushing water. As you settle down onto a mossy rock, you close your eyes for a moment and enjoy the sound of nearby birds and the wind in the leaves. It would be difficult to &lt;i&gt;not&lt;/i&gt; feel at peace in this place, with no one else around...

&lt;&lt;jack&gt;&gt;Oh, well, hello there!&lt;&lt;/jack&gt;&gt;

You startle and jump to your feet instinctively. Looking around, you see a large, burly man holding an axe over one shoulder. He is smiling at you through a bushy beard.?nl

&lt;&lt;if hasTag (&#39;lumberjack-peeped&#39;)&gt;&gt;
    With a jolt, you realize you recognize this man. He is the lumberjack you saw in ?Sybille&#39;s dungeon. Your eyes stray automatically to his crotch before you catch yourself. 
    &lt;&lt;if settings.sph&gt;&gt;
        It&#39;s impossible to forget how much bigger his cock was than yours.
    &lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
    You&#39;ve never seen this man before, but based on his appearance you have to assume that he is some kind of lumberjack.
&lt;&lt;/if&gt;&gt;

&lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;
    &lt;&lt;include &#39;Lumberjack Meeting Waterfall Crossdress&#39;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;if isDisguised()&gt;&gt;
        &lt;&lt;include &#39;Lumberjack Meeting Waterfall Disguise&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt; 
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Head back into the forest&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="511" name="Lumberjack Meeting Waterfall Crossdress" tags="" position="100,6475" size="100,100">Remembering how you appear, you adjust your voice to be as feminine as possible.

&lt;&lt;player&gt;&gt;Hello, sir...&lt;&lt;/player&gt;&gt;

&lt;&lt;jack&gt;&gt;Lovely day to spend some time by the waterfall. I don&#39;t believe we&#39;ve met before. Do you work at the castle?&lt;&lt;/jack&gt;&gt;

Though he&#39;s still smiling, he&#39;s giving you a long look. Can he tell that you&#39;re wearing a disguise? Did he ask about the castle because he recognizes you as the prince?

&lt;&lt;player&gt;&gt;Uh, ah... Well, you see, uh...&lt;&lt;/player&gt;&gt;

The man tilts his head, clearly confused at your anxious response.

&lt;&lt;changename jack Jack&gt;&gt;

&lt;&lt;jack&gt;&gt;Do not worry, good lady, I mean nothing by my questions. I am simply passing by on my day&#39;s work. Well met, my name is ?Jack.&lt;&lt;/jack&gt;&gt;

He gives you an encouraging smile, and you can&#39;t help but relax a little. If he&#39;s noticed anything strange about you, he isn&#39;t mentioning it.

&lt;&lt;player&gt;&gt;Uh, nice to meet you, ?Jack. Are you a woodcutter of some sort?&lt;&lt;/player&gt;&gt;

He laughs, hoisting the axe on his muscled shoulder.

&lt;&lt;jack&gt;&gt;Yes, indeed. Secretly, though, my other profession is carving...well, &lt;i&gt;delicate&lt;/i&gt; statues for my wife.&lt;&lt;/jack&gt;&gt;

You have no idea what he means by this, but you swear you see some kind of twinkle in his eye. You pause a moment, unsure how to respond.

&lt;&lt;player&gt;&gt;That sounds nice, I suppose.&lt;&lt;/player&gt;&gt;

He laughs again good-naturedly at your confusion.

&lt;&lt;jack&gt;&gt;Well, good lady, I can see I&#39;ve taken up enough of your time. Please, continue enjoying the waterfall. Perhaps we will meet again sometime. Good day for now!&lt;&lt;/jack&gt;&gt;

He waves cheerfully and disappears into the trees. You stay a while longer by the waterfall, pondering what he could have possibly meant by &lt;i&gt;delicate statues&lt;/i&gt;...</tw-passagedata><tw-passagedata pid="512" name="Lumberjack Meeting Waterfall Disguise" tags="" position="225,6475" size="100,100">&lt;&lt;player&gt;&gt;Hello there, sir.&lt;&lt;/player&gt;&gt;

&lt;&lt;jack&gt;&gt;Lovely day to spend some time by the waterfall. I don&#39;t believe we&#39;ve met before. Do you work at the castle?&lt;&lt;/jack&gt;&gt;

Though he&#39;s still smiling, he&#39;s giving you a long look. Can he tell that you&#39;re wearing a disguise? Did he ask about the castle because he recognizes you as the prince?

&lt;&lt;player&gt;&gt;Uh, ah... Well, you see, uh...&lt;&lt;/player&gt;&gt;

The man tilts his head, clearly confused at your anxious response.

&lt;&lt;changename jack Jack&gt;&gt;

&lt;&lt;jack&gt;&gt;Do not worry, good sir, I mean nothing by my questions. I am simply passing by on my day&#39;s work. Well met, my name is ?Jack.&lt;&lt;/jack&gt;&gt;

He gives you an encouraging smile, and you can&#39;t help but relax a little. He doesn&#39;t seem to have recognized you as anything more than a common man, at least not yet.

&lt;&lt;player&gt;&gt;Uh, nice to meet you, ?Jack. Are you a woodcutter of some sort?&lt;&lt;/player&gt;&gt;

He laughs, hoisting the axe on his muscled shoulder.

&lt;&lt;jack&gt;&gt;Yes, indeed. Secretly, though, my other profession is carving...well, &lt;i&gt;delicate&lt;/i&gt; statues for my wife.&lt;&lt;/jack&gt;&gt;

He gives you a conspiratorial wink, though you really have no idea what he could mean by this. You pause a moment, unsure how to respond.

&lt;&lt;player&gt;&gt;That sounds nice, I suppose.&lt;&lt;/player&gt;&gt;

He laughs again good-naturedly at your confusion.

&lt;&lt;jack&gt;&gt;Well, good sir, I can see I&#39;ve taken up enough of your time. Please, continue enjoying the waterfall. Perhaps we will meet again sometime. Good day for now!&lt;&lt;/jack&gt;&gt;

He waves cheerfully and disappears into the trees. You stay a while longer by the waterfall, pondering what he could have possibly meant by &lt;i&gt;delicate statues&lt;/i&gt;...</tw-passagedata><tw-passagedata pid="513" name="Eve Meeting Waterfall" tags="" position="350,6475" size="100,100">&lt;&lt;addtag &#39;eve-waterfall&#39;&gt;&gt;

As you&#39;re approaching the waterfall, you catch sight of someone through the trees. A woman seems to be bathing in the water. Her long pink hair floats in swirling patterns around her, and you catch glimpses of her breasts as she swims lazily around the pool.&lt;&lt;if hasCompletedQuest(&#39;tavern-intro&#39;)&gt;&gt; You now notice it&#39;s ?Eve, looks like she&#39;s enjoying a swim in the woods.&lt;&lt;/if&gt;&gt;
?nl

Before you can do anything, she spots you through the trees and gives you a wave.

&lt;&lt;eve&gt;&gt;Oh,&lt;&lt;if hasCompletedQuest(&#39;tavern-intro&#39;)&gt;&gt; ?newname, hey!&lt;&lt;else&gt;&gt; hello!&lt;&lt;/if&gt;&gt; Don&#39;t be shy, I&#39;m just enjoying a swim.&lt;&lt;/eve&gt;&gt;

You cautiously approach the waterfall, noticing how she makes no effort to cover herself in your presence. You feel suddenly embarrassed, as though you should look away.

&lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;
    Is she so comfortable because you look like just another woman to her?
&lt;&lt;/if&gt;&gt;

&lt;&lt;eve&gt;&gt;This place is so relaxing, don&#39;t you think?&lt;&lt;/eve&gt;&gt;

She looks at you expectantly, as though nothing is out of the ordinary. You try unsuccessfully not to stare at her breasts, which are currently on full display as she stands partly out of the water.

&lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;
    You clear your throat and adjust your voice to be more feminine.
&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Ah, yes, it is lovely, is it not. Do you - uh - often swim here?&lt;&lt;/player&gt;&gt;

She dips her head back in the water, her body arching gracefully. As she straightens again, droplets running down her chest, she gives you a smile. 

&lt;&lt;eve&gt;&gt;It&#39;s a secret pleasure of mine. &lt;&lt;if !hasCompletedQuest(&#39;tavern-intro&#39;)&gt;&gt;I work in the tavern, you see, so&lt;&lt;/if&gt;&gt; I love coming here for a bit of quiet. Do you mind if I join you on the shore?&lt;&lt;/eve&gt;&gt;

&lt;&lt;player&gt;&gt;I- well, be my guest.&lt;&lt;/player&gt;&gt;

She starts to walk out of the pool towards you. Though you try not to look, you can&#39;t help but take in the curves of her body as she emerges from the water.?nl 

As she walks closer, you realize with shock that the space between her legs is not a vulva, as you expected, but a penis. It moves casually as she walks, water dripping off the tip.

&lt;&lt;if settings.sph&gt;&gt;
    Even soft and unerect, she is much bigger than you have ever been. You realize with shame that even this beautiful woman has a larger penis than you.
&lt;&lt;/if&gt;&gt;

&lt;&lt;eve&gt;&gt;It&#39;s so warm today. I think I&#39;ll dry in the sun.&lt;&lt;/eve&gt;&gt;

She sits down on the grass next you, and looks up with a smile. She pats the ground. 

&lt;&lt;if !hasCompletedQuest(&#39;tavern-intro&#39;)&gt;&gt;
    &lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;
        You freeze for a moment, aware of how you currently look. Surely if you were to sit so close, she would realize that you are not just a simple village girl. She might even recognize you as the prince.?nl
    &lt;&lt;else&gt;&gt;
        You freeze for a moment, remembering your disguise. Surely if you were to sit so close, she might recognize who you are.?nl
    &lt;&lt;/if&gt;&gt;

    She laughs good-naturedly.

    &lt;&lt;eve&gt;&gt;You&#39;re not used to nakedness, are you? It&#39;s quite natural. Try to relax.&lt;&lt;/eve&gt;&gt;

    She seems insistent, and you have to admit there&#39;s something enticing about this whole experience. So you sit next to her, trying not to stare too openly at her naked body.?nl

    &lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;
        After you sit down, she gives you a long look. 

        &lt;&lt;eve&gt;&gt;You remind me of myself, some time ago. Before I quite knew myself, or at least before I fully realized my own beauty.&lt;&lt;/eve&gt;&gt;

        You look away from her, feeling uncomfortable under her gaze. 

        &lt;&lt;player&gt;&gt;H-how do you mean?&lt;&lt;/player&gt;&gt;

        Out of the corner of her eye, you see her smile in understanding. 

        &lt;&lt;eve&gt;&gt;We all must come to know ourselves over time.&lt;&lt;/eve&gt;&gt;
        
        You&#39;re not sure what she&#39;s referring to. How could you remind her of herself? You look out at the water and awkwardly change the subject.

        &lt;&lt;else&gt;&gt;
            As you sit down, she looks at you and smiles warmly. Luckily there seems to be no recognition in her eyes, and you sense that she has no idea you are the prince. 
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;player&gt;&gt;Is it not cold? The water, I mean? You seem so comfortable.&lt;&lt;/player&gt;&gt;

    She reclines lazily in the grass. The sunlight shines warmly on her body, her breasts and penis on full display.

    &lt;&lt;eve&gt;&gt;The water &lt;i&gt;is&lt;/i&gt; cold, darling. That&#39;s what makes the sunlight feel so good.&lt;&lt;/eve&gt;&gt;

    She sighs comfortably, closing her eyes. You sit in silence for some moments, wondering about this strange woman who is so secure in herself. Despite her chaste approach to nudity, or perhaps because of it, there is something arousing about her. Are you attracted to her body? Is there possibly some part of you that wants what she has??nl

    After some time passes, she opens her eyes and smiles at you.

    &lt;&lt;eve&gt;&gt;Well, I believe I&#39;m dry. It&#39;s been lovely chatting. Perhaps I&#39;ll see you in the tavern sometime.&lt;&lt;/eve&gt;&gt;

    She gives you a wink and pulls a delicate dress from the grass, slipping it over her head in one swift movement. 

    &lt;&lt;eve&gt;&gt;My name is ?Eve, by the way.&lt;&lt;/eve&gt;&gt;

    As she turns away, you manage a short farewell through your bewilderment. She walks lightly into the forest, leaving you by the waterfall with only your thoughts as company.?nl
&lt;&lt;else&gt;&gt;
    You sit next to her, quite embarrassed by the interaction.
    &lt;&lt;eve&gt;&gt;You&#39;re a little on edge, is something wrong?&lt;&lt;/eve&gt;&gt;
    &lt;&lt;player&gt;&gt;Uhm, well it&#39;s just, that uh- you are...&lt;&lt;/player&gt;&gt;
    She look at you with a puzzled expression.
    
    &lt;&lt;eve&gt;&gt;I&#39;m naked? Oh, you&#39;re not really used to that are you, ?newname?&lt;&lt;/eve&gt;&gt;
    You nod at her with a timid expression.
    &lt;&lt;eve&gt;&gt;I suppose this is a little different to seeing each other at the tavern, but it&#39;s lovely running into you!&lt;&lt;/eve&gt;&gt;
    &lt;&lt;player&gt;&gt;Is it not cold? The water, I mean? You seem so comfortable.&lt;&lt;/player&gt;&gt;

    She reclines lazily in the grass. The sunlight shines warmly on her body, her breasts and penis on full display.

    &lt;&lt;eve&gt;&gt;The water &lt;i&gt;is&lt;/i&gt; cold, darling. That&#39;s what makes the sunlight feel so good.&lt;&lt;/eve&gt;&gt;
    
    After some time passes, she opens her eyes and smiles at you.

    &lt;&lt;eve&gt;&gt;Well, I believe I&#39;m dry. It&#39;s been lovely chatting. I suppose I&#39;ll see you at work, ?newname!&lt;&lt;/eve&gt;&gt;

    As she turns away, you manage a short farewell through your bewilderment. She walks lightly into the forest, leaving you by the waterfall with only your thoughts as company.?nl
&lt;&lt;/if&gt;&gt;

You stay a few moments more, pondering this strange interaction before you too head back into the forest.

&lt;&lt;decision &#39;Leave the waterfall&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="514" name="Forest navigation" tags="" position="475,6475" size="100,100">&lt;img src=&quot;images/maps/forest.png&quot; class=&quot;navigation-map&quot; usemap=&quot;#forest-map&quot;&gt;

&lt;map name=&quot;forest-map&quot;&gt;
    &lt;area data-passage=&quot;Waterfall&quot; alt=&quot;Waterfall&quot; center=&quot;345,541&quot; coords=&quot;203,68,97,149,36,267,10,386,21,438,34,491,65,539,104,589,148,629,185,648,225,659,264,668,297,668,341,666,391,666,433,655,477,644,507,635,536,624,562,616,593,600,612,578,639,563,656,539,671,515,693,493,709,469,711,436,711,410,717,379,715,353,713,320,707,294,700,265,691,241,669,213,654,193,630,167,612,153,584,129,564,116,536,96,516,83,485,66,459,64,424,57,400,55,367,50,345,46,306,53,286,57,246,61&quot; shape=&quot;poly&quot;&gt;
    &lt;area data-passage=&quot;Bandit camp&quot; alt=&quot;Bandit camp&quot; center=&quot;766,1071&quot; coords=&quot;347,850,301,898,271,942,251,997,227,1058,220,1120,225,1174,262,1203,308,1222,384,1222,446,1222,505,1227,562,1227,621,1225,687,1220,746,1218,807,1216,864,1216,926,1216,989,1216,1044,1214,1105,1214,1167,1209,1219,1181,1259,1141,1272,1087,1265,1027,1245,977,1215,918,1167,885,1121,850,1070,815,1031,795,985,789,919,782,864,780,801,780,744,782,680,782,623,780,564,782,505,791,444,797,391,824&quot; shape=&quot;poly&quot;&gt;
    &lt;area data-passage=&quot;Druid Hut&quot; alt=&quot;Druid Hut&quot; center=&quot;1309,291&quot; coords=&quot;1105,322,1136,359,1171,399,1213,418,1235,421,1267,425,1296,429,1355,434,1414,432,1471,421,1528,405,1585,386,1629,346,1653,298,1670,237,1668,177,1660,138,1651,116,1614,81,1559,55,1500,35,1445,24,1397,15,1324,28,1267,44,1208,66,1186,74,1167,92,1134,136,1112,195,1101,234,1103,283&quot; shape=&quot;poly&quot;&gt;
    &lt;area data-passage=&quot;Meadow&quot; alt=&quot;Meadow&quot; center=&quot;2238,986&quot; coords=&quot;2014,716,2005,776,2005,837,2012,892,2021,955,2029,1014,2047,1069,2080,1115,2119,1159,2178,1168,2238,1170,2301,1166,2358,1150,2408,1122,2443,1071,2454,1019,2463,955,2466,894,2474,837,2477,776,2470,719,2466,662,2466,600,2461,539,2452,478,2446,423,2439,390,2428,362,2404,329,2383,318,2343,309,2321,313,2282,324,2260,335,2234,364,2205,399,2183,432,2159,467,2139,504,2120,537,2102,572,2078,607,2043,657&quot; shape=&quot;poly&quot;&gt;
    &lt;area data-passage=&quot;Forest&quot; alt=&quot;Forest&quot; center=&quot;1478,784&quot; coords=&quot;902,504,877,550,873,622,877,659,897,677,948,710,1002,738,1029,754,1061,751,1083,760,1116,773,1169,802,1215,837,1241,863,1261,885,1278,909,1291,927,1309,953,1329,981,1362,1003,1383,1017,1410,1019,1436,1017,1495,999,1550,973,1598,938,1635,892,1660,835,1679,778,1695,719,1695,655,1697,600,1690,546,1668,506,1646,491,1596,471,1535,464,1478,489,1419,500,1359,500,1300,495,1243,482,1186,462,1134,438,1114,436,1075,438,1059,434,1018,451,980,458,941,473&quot; shape=&quot;poly&quot;&gt;
&lt;/map&gt;</tw-passagedata><tw-passagedata pid="515" name="Meadow" tags="location forest" position="600,6475" size="100,100">You stand in the midst of the meadow, surrounded by a kaleidoscope of wildflowers swaying in the breeze. A dirt road leads towards the edge of the forest.</tw-passagedata><tw-passagedata pid="516" name="Forest" tags="location forest" position="725,6475" size="100,100">The forest is a lush expanse of towering trees, their verdant canopies creating a cathedral-like atmosphere of serenity. Sunlight filters through the leaves, dappling the mossy ground with a gentle, enchanting glow.</tw-passagedata><tw-passagedata pid="517" name="Bandit camp" tags="location forest" position="850,6475" size="100,100">Nestled within the shadows of towering trees, the bandit camp in the forest is a makeshift haven of secrecy and danger. Tattered tents and flickering campfires blend with the dense foliage, creating an ominous ambiance.</tw-passagedata><tw-passagedata pid="518" name="Waterfall" tags="location forest" position="975,6475" size="100,100">A hidden gem in the heart of the forest, the waterfall cascades down rugged rocks with an invigorating roar, sending a fine mist into the air. Sunlight pierces through the dense foliage, creating iridescent rainbows that dance in the spray, adding a touch of magic to the serene woodland scene.</tw-passagedata><tw-passagedata pid="519" name="Druid Hut" tags="location forest" position="1100,6475" size="100,100">Seemingly in the middle of nowhere, a lonely shack stands proudly in the middle of this secluded grove deep inside the forest. The hut is surrounded by several large swatches of flower patches, which appear to be intentionally cultivated. The house itself is covered in stick embezzlements, like charms and tiny totems in the shape of forest critters.</tw-passagedata><tw-passagedata pid="520" name="Leave forest" tags="" position="1225,6475" size="100,100">&lt;&lt;decision &#39;Head back to the castle&#39;&gt;&gt;
    &lt;&lt;if isDisguised()&gt;&gt;
        &lt;&lt;goto &#39;Sneak in&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;goto &#39;Walk in no disguise&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;decisionicon castle&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;if hasCompletedQuest(&#39;sybille-tavern&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Head down the road that goes into town&#39; &#39;Road&#39;&gt;&gt;
        &lt;&lt;decisionicon town&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="521" name="Forest Decisions" tags="" position="100,6600" size="100,100">&lt;&lt;money &#39;mushrooms&#39; true&gt;&gt;
&lt;&lt;if getTime() !== &#39;night&#39;&gt;&gt;
    &lt;&lt;decision &#39;Gather mushrooms in the woods&#39; &#39;Gather Mushrooms&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="522" name="Bandit camp Decisions" tags="" position="225,6600" size="100,100">&lt;&lt;if hasQuest(&#39;rosa-flowers&#39;) and !hasTag(&#39;rosa-pink-flower&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Look for the pink flowers ?Rosa mentioned&#39; &#39;Rosa Find Flower Bandit Camp&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="523" name="Waterfall Decisions" tags="" position="350,6600" size="100,100">&lt;&lt;if hasQuest(&#39;rosa-flowers&#39;) and getTime() === &#39;night&#39; and !hasTag(&#39;rosa-blue-flower&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Look for the blue flowers ?Rosa mentioned&#39; &#39;Rosa Find Flower Waterfall&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;elseif !hasCounter(&#39;waterfall&#39;) and getTime() !== &#39;night&#39;&gt;&gt;
    &lt;&lt;decision &#39;Relax by the waterfall&#39; &#39;Waterfall Relax&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="524" name="Tavern navigation" tags="" position="475,6600" size="100,100">&lt;img src=&quot;images/maps/tavern.png&quot; class=&quot;navigation-map&quot; usemap=&quot;#tavern-map&quot;&gt;

&lt;map name=&quot;tavern-map&quot;&gt;
    &lt;area shape=&quot;poly&quot; coords=&quot;206, 1037, 456, 785, 782, 784, 1036, 1035, 1038, 1239, 208, 1239&quot; data-passage=&quot;Town square&quot; alt=&quot;Town square&quot; center=&quot;614, 928&quot; /&gt;
    &lt;area shape=&quot;rect&quot; coords=&quot;2364, 112, 2478, 1051&quot; data-passage=&quot;Alley&quot; alt=&quot;Alley&quot; center=&quot;2418, 288&quot; /&gt;
    &lt;area shape=&quot;poly&quot; coords=&quot;2150, 1033, 2150, 702, 1942, 703, 1942, 123, 2356, 123, 2358, 1035&quot; title=&quot;Brothel&quot; data-passage=&quot;Brothel&quot; alt=&quot;Brothel&quot; center=&quot;2148, 430&quot; /&gt;
    /* &lt;area shape=&quot;rect&quot; coords=&quot;1777, 703, 2150, 1034&quot; data-passage=&quot;?&quot; alt=&quot;?&quot; center=&quot;1963, 868&quot; /&gt; */
    &lt;area shape=&quot;rect&quot; coords=&quot;1529, 703, 1777, 1033&quot; data-passage=&quot;Boarding Room&quot; alt=&quot;Boarding Room&quot; center=&quot;1653, 869&quot; /&gt;
    &lt;area shape=&quot;rect&quot; coords=&quot;1487, 124, 1776, 537&quot; data-passage=&quot;Eve&#39;s Room&quot; alt=&quot;Eve&#39;s Room&quot; center=&quot;1631, 330&quot; vertical=&quot;true&quot; /&gt;
    &lt;area shape=&quot;poly&quot; coords=&quot;1075, 330, 1200, 330, 1405, 537, 1777, 537, 1777, 124, 1942, 124, 1943, 704, 1367, 702, 1157, 495, 1075, 496&quot; data-passage=&quot;Corridor&quot; alt=&quot;Corridor&quot; center=&quot;1637, 620&quot; /&gt;
    &lt;area shape=&quot;rect&quot; coords=&quot;909, 123, 1198, 331&quot; data-passage=&quot;Velma&#39;s Office&quot; alt=&quot;Velma&#39;s Office&quot; center=&quot;1054, 227&quot; /&gt;
    &lt;area shape=&quot;poly&quot; coords=&quot;414, 122, 911, 123, 910, 329, 827, 411, 412, 412&quot; data-passage=&quot;Cookroom&quot; alt=&quot;Cookroom&quot; center=&quot;651, 269&quot; /&gt;
    &lt;area shape=&quot;poly&quot; coords=&quot;1157, 496, 1365, 702, 1116, 950, 868, 702, 1076, 496&quot; data-passage=&quot;Toilets&quot; alt=&quot;Toilets&quot; center=&quot;1114, 701&quot; /&gt;
    &lt;area shape=&quot;poly&quot; coords=&quot;125, 124, 414, 124, 414, 414, 827, 414, 911, 330, 1076, 331, 1077, 497, 870, 704, 124, 703&quot; data-passage=&quot;Tavern&quot; alt=&quot;Tavern&quot; center=&quot;411, 554&quot; /&gt;
&lt;/map&gt;</tw-passagedata><tw-passagedata pid="525" name="Tavern" tags="location tavern" position="600,6600" size="100,100">The local tavern, ?tavern, is located in the heart of town. Every evening the townsfolk flock to carouse and drink ale. It is the prime evening location to go to in this place. It&#39;s owned and operated by a friendly, if somewhat eccentric, lady named ?Velma. She makes her living selling beer, cider, and ale to the locals.</tw-passagedata><tw-passagedata pid="526" name="Toilets" tags="location tavern" position="725,6600" size="100,100">The Tavern&#39;s Bathroom is a dirty, smelly place filled with stale beer and urine. They consist of a series of wooden stalls containing buckets with holes through the floors that lead to the sewers below.</tw-passagedata><tw-passagedata pid="527" name="Brothel" tags="location tavern" position="850,6600" size="100,100">The foyer and lounge area of the brothel owned by ?MadameVelma. Clients enter through a guarded door from the alley behind the tavern and staff seems to enter through the brown door that leads to the tavern.</tw-passagedata><tw-passagedata pid="528" name="Boarding Room" tags="location tavern" position="975,6600" size="100,100">Your own room little room inside the tavern. It&#39;s slightly cramped and everything from the floor to the bed creaks loudly but you still love it, simply because it&#39;s yours.</tw-passagedata><tw-passagedata pid="529" name="Eve&#39;s Room" tags="location tavern" position="1100,6600" size="100,100">?Eve&#39;s room in the tavern is almost more extravagant than what you&#39;re used to. The king sized bed is covered in fine pink silken sheets and besides the ample make-up collection around her vanity table she&#39;s got lots of fragrant flowers in vases all around the room.</tw-passagedata><tw-passagedata pid="530" name="Velma&#39;s Office" tags="location tavern" position="1225,6600" size="100,100">?MadameVelma&#39;s office is surprisingly small and modestly furnished. The only thing decorating the walls is a calender to keep track of working days and tavern events. She has a small desk filled with paperwork. Her financial ledger looks quite intimidating and you&#39;re pretty sure you haven&#39;t followed ?Leopold&#39;s classes enough to handle that massive thing.</tw-passagedata><tw-passagedata pid="531" name="Cookroom" tags="location tavern" position="100,6725" size="100,100">?ChefPepper&#39;s kitchen is always filled with the smell of amazing food. The place looks chaotic and you have no idea how he manages to make such nice food all by himself here. In the corner you find Seasalt, the old stray dog that has always been by ?Pepper&#39;s side.</tw-passagedata><tw-passagedata pid="532" name="Corridor" tags="location tavern" position="225,6725" size="100,100">The long corridor that starts at the brown door of ?MadameVelma&#39;s tavern. There&#39;s numerous doors going to different rooms. The corridor is slightly dark but doesn&#39;t look uninviting.</tw-passagedata><tw-passagedata pid="533" name="Backroom" tags="location tavern" position="350,6725" size="100,100">A long ornate room reserved for the most important clients of ?MadameVelma&#39;s tavern. It has a long table with many chairs and a tiled flooring, almost feels as fancy as your castle dining hall.</tw-passagedata><tw-passagedata pid="534" name="Boarding Room Decisions" tags="" position="475,6725" size="100,100">&lt;&lt;if hasTag(&#39;sexwork&#39;) and getTime() === &#39;night&#39;&gt;&gt;
    &lt;&lt;decision &#39;Work at the brothel&#39; &#39;Brothel Work&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;decision &#39;Take out a sex toy for some fun time&#39;&gt;&gt;
        You lie down on your bed and excitedly open your nightstand drawer.
        &lt;&lt;toys&gt;&gt;
        &lt;&lt;decision &#39;Change your mind&#39; &#39;Tavern&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="535" name="Tavern Decisions" tags="" position="600,6725" size="100,100">&lt;&lt;if getTime() === &#39;evening&#39;&gt;&gt;
    &lt;&lt;if hasQuest(&#39;tavern-intro&#39;)&gt;&gt;
        &lt;&lt;decision &#39;Get starting with your first day of working&#39; &#39;Tavern Eve Intro&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;elseif hasQuest(&#39;tavern&#39;) and !hasCounter(&#39;tavern-work&#39;)&gt;&gt;
        &lt;&lt;money &#39;gold&#39; true&gt;&gt;
        &lt;&lt;decision &#39;Work at the tavern&#39; &#39;Tavern Work&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="536" name="Alley Explore" tags="" position="725,6725" size="100,100">&lt;&lt;addcounter &#39;alley-explore&#39; 1&gt;&gt;
&lt;&lt;if getTime() === &#39;night&#39;&gt;&gt;
    &lt;&lt;if not hasVisited(&#39;Alley Mugger&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Alley Mugger&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;goto `either(&#39;Alley Find Drunkard&#39;, &#39;Alley Find Couple&#39;, &#39;Alley Mugger&#39;)`&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;if not hasVisited(&#39;Alley Find Cat&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Alley Find Cat&#39;&gt;&gt;
    &lt;&lt;elseif not hasVisited(&#39;Alley Find Drunkard&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Alley Find Drunkard&#39;&gt;&gt;
    &lt;&lt;elseif not hasVisited(&#39;Alley Find Couple&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Alley Find Couple&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;goto `either(&#39;Alley Find Drunkard&#39;, &#39;Alley Find Couple&#39;)`&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="537" name="Alley Find Cat" tags="" position="850,6725" size="100,100">You wander down the alley, taking in the sights and smells of refuse. It&#39;s not particularly pleasant, and you suspect this is not a place you should be spending much time. Just as you&#39;re turning to leave, however, you hear a small, muffled cry.?nl

It takes some minutes, but eventually you move a rotten wooden crate aside to find a striped orange cat crouched in a pile of tattered rags. The cat looks quite skinny, except for a large, round belly. You&#39;re fairly certain this cat must be pregnant.?nl

The cat arches her back and hisses at you, her eyes wide. She seems scared of people, but she also seems hungry... Perhaps you could bring her some food??nl

&lt;&lt;decision &#39;Leave the cat alone&#39;&gt;&gt;
    This alley cat&#39;s wellbeing really isn&#39;t your problem, and in any case, she doesn&#39;t seem to want your help. You carefully place the wooden crate back and realize you should probably get out of this alley.
    &lt;&lt;decision &#39;Leave the alley&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Resolve to bring the cat some food&#39;&gt;&gt;
    &lt;&lt;addtag ask-about-cat-food&gt;&gt;
    You can&#39;t just leave this hungry, pregnant cat to fend for herself. You know the castle has several cats in residence to catch mice. Perhaps ?Rosa would know where to get some appropriate food??nl
    You speak to the cat in soothing tones and promise to bring her something to eat. She hisses at you, her fur standing on end, but you know she&#39;s just scared.
    &lt;&lt;decision &#39;Put the crate back and leave the alley&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="538" name="Alley Find Drunkard" tags="" position="975,6725" size="100,100">You wander through the alley, wrinkling your nose at the faint whiff of urine. You notice little except for an old man who is currently slumped against the wall of the tavern, snoring loudly. As you approach, the smell of urine and stale beer grows stronger; he seems to have soiled himself in his drunken stupor.?nl

There doesn&#39;t seem to be much of interest here.

&lt;&lt;decision &#39;Leave the alley&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="539" name="Alley Find Couple" tags="" position="1100,6725" size="100,100">As you start to enter the alley, you realize that there are two men already there, pushed up against the side of a building. You pull back to not be seen and listen for a moment. You&#39;re quite certain that you hear the sound of moaning, and something like a rhythmic slapping.?nl

They seem far too busy to have noticed you. You could just sneak away and leave them to their business... On the other hand, you could just as easily creep forward and hide behind a pile of crates to watch...

&lt;&lt;decision &#39;Creep closer to watch&#39; &#39;Alley Couple Anal&#39; depravity small &gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Back out of the alley&#39; &#39;Town square&#39; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="540" name="Alley Couple Anal" tags="spicy" position="1225,6725" size="100,100">&lt;&lt;addsin &#39;peeping&#39;&gt;&gt;

You crouch and make your way silently into the alley. From a hiding place behind old crates you can see the two men better. They are wearing simple peasant clothes, but their faces are handsome and their bodies are strong from regular physical labor. One is pressed up against the wall of the building, his back arched and his blonde hair falling into his eyes. The other, a man with pale skin and dark curly hair, is moving rhymically against him.?nl

You crouch there watching until your eyes adjust to the dim light and you can make out more detail. You can see the blonde man stroking his own thick member while pushing himself repeatedly backwards, moaning each time the dark-haired man thrusts deep inside him.

&lt;&lt;say &#39;Dark-Haired Man&#39;&gt;&gt;Fuck, your ass is good...&lt;&lt;/say&gt;&gt;

The blonde man throws his head back and moans even louder. The dark-haired man stuffs a hand over his mouth and lets out a low chuckle.

&lt;&lt;say &#39;Dark-Haired Man&#39;&gt;&gt;Not so loud, we don&#39;t want anyone to hear...&lt;&lt;/say&gt;&gt;

The blonde man moans through the fingers over his mouth, still pushing himself backward onto the other man&#39;s cock. The dark-haired man increases the speed of his thrusts, pounding hard into the blonde man with a look of hunger in his eyes.?nl

The blonde man gives up trying to coordinate his movements and allows himself to be fucked hard against the building, still moaning through the other man&#39;s fingers. Finally, he cries out as he orgasms, his cum splattering across the side of the building.

&lt;&lt;say &#39;Dark-Haired Man&#39;&gt;&gt;Oh, fuck...&lt;&lt;/say&gt;&gt;

The dark-haired man seems to reach his orgasm as well. He pulls out of the other man for a brief moment, shooting cum onto his hole before thrusting deep inside to finish his orgasm. The blonde man leans exhaustedly against the wall, moaning softly as he is filled up.?nl

As the men come down from their excitement, you realize you should probably sneak back out of the alley before they notice you...

&lt;&lt;decision &#39;Quietly leave the alley&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="541" name="Rosa Get Cat Food" tags="" position="100,6850" size="100,100">&lt;&lt;removetag ask-about-cat-food&gt;&gt;

?Rosa appears to be rolling out some kind of pastry dough when you enter the kitchen, and the delicious scent of warm spices fills the air. She looks up as you enter.

&lt;&lt;rosa&gt;&gt;Hello, m&#39;lord! Can I help you with something?&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;I hope you can. You see, on one of my...well, excursions, I came across a very hungry looking cat who also appeared to be pregnant. I don&#39;t suppose you know where I could find some food I could bring her?&lt;&lt;/player&gt;&gt;

?Rosa looks touched that you have come to her with such a question.

&lt;&lt;rosa&gt;&gt;How kind of you, m&#39;lord! Well, normally the mousing cats catch their own food throughout the castle. But I think I have something you could use...&lt;&lt;/rosa&gt;&gt;

She disappears into the larder and re-emerges a few moments later with a small cloth bundle, which she hands to you.

&lt;&lt;rosa&gt;&gt;I had a bit of meat left on a chicken carcass from today&#39;s dinner. This should be enough to feed a very hungry cat.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;Thank you so much, ?Rosa. I&#39;ll be sure she gets this.&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Bring the cat the food&#39; &#39;Alley Cat Food 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="542" name="Alley Cat Food 1" tags="" position="225,6850" size="100,100">&lt;&lt;addcounter &#39;fed-cat&#39; 1&gt;&gt;
&lt;&lt;setlocation &#39;Alley&#39;&gt;&gt;
&lt;&lt;outfit disguise&gt;&gt;
&lt;&lt;addtag feeding-cat&gt;&gt;

You make your way out of the castle in disguise and head to the town. You duck into the alley and quickly find the cat, this time curled up asleep in her bed of rags. You open the cloth of food and place it next to her gently.?nl

She wakes slowly, sniffing the air. When she sees you, she starts to recoil, but then stops when she notices the food. She immediately wolfs the food down, keeping a careful watch on you the whole time.?nl

She still looks scared, but she&#39;s no longer hissing at you. Most importantly, she&#39;s got food in her belly. You resolve to bring some scraps from your next meal the next time you come to town.

&lt;&lt;decision &#39;Sneak back into the castle and remove your disguise&#39; &#39;Bedroom&#39;&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
    &lt;&lt;outfit standard&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Stay in town for a while longer&#39; &#39;Town square&#39;&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="543" name="Alley Cat Continue Feeding" tags="" position="350,6850" size="100,100">&lt;&lt;addcounter &#39;fed-cat&#39; 1&gt;&gt;
&lt;&lt;first&gt;&gt;
    &lt;&lt;include &#39;Alley Cat Food 2&#39;&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;include &#39;Alley Cat Food 3&#39;&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;include &#39;Alley Cat Food 4&#39;&gt;&gt;
&lt;&lt;finally&gt;&gt;
    &lt;&lt;include &#39;Keep Feeding Mother Cat&#39;&gt;&gt;
&lt;&lt;/first&gt;&gt;</tw-passagedata><tw-passagedata pid="544" name="Alley Cat Food 2" tags="" position="475,6850" size="100,100">You find the cat in her usual spot. She is sleeping when you uncover her, but starts to wake as you set down a piece of meat you stashed away from your last dinner. She eats the meat, less hungrily than last time, and looks at you warily.?nl

You slowly reach out a hand and let her sniff it. She doesn&#39;t shrink away this time, so you brush a hand very gently across her fur. She still seems wary, but allows you to give her some light pats before moving away again. You figure she has had enough; you can always come back another time to give her more food.

&lt;&lt;decision &#39;Leave the alley&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="545" name="Alley Cat Food 3" tags="" position="600,6850" size="100,100">You find the cat awake. She&#39;s looking even more pregnant than before, and perhaps a little uncomfortable with her big belly. She accepts the scraps you saved for her from your last dinner gratefully, and seems to almost relax as you run your hand gently across her fur. You realize happily that she seems to be starting to trust you.?nl

After you spend some time petting the cat, you promise her you&#39;ll be back again soon with more food.

&lt;&lt;decision &#39;Leave the alley&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="546" name="Alley Cat Food 4" tags="" position="725,6850" size="100,100">Before you even get to the cat&#39;s hiding spot, you notice something is different than last time. In the quiet of the alley, you can just make out a chorus of tiny mewling voices. You pull aside the rotten crate eagerly, and see a pile of tiny kittens, their eyes not yet open. The mother cat is curled around them as they nurse, and she looks at you with trust as you approach.?nl

You gently place down another offering of meat scraps and watch as the mother cat eats gratefully. When she has finished, she even allows you to pet her kittens. They are warm and soft, and so small that they could fit in the palm of your hand.?nl

You realize that this cat will probably need even more help now that her kittens are born. Perhaps you could just keep bringing her food a while longer, until she can get it herself... On the other hand, perhaps you could bring the cat and her kittens to the castle... ?Rosa would probably know what to do with a litter of kittens...?nl

&lt;&lt;decision &#39;Leave the cat here&#39;&gt;&gt;
    You think better of trying to move a mother cat and all her kittens. You can keep bringing food any time you&#39;re in town, after all, and the castle probably doesn&#39;t need any more cats. You pet the kittens a while longer before heading back out of the alley.
    &lt;&lt;decision &#39;Leave the alley&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Bring the cats to ?Rosa&#39; &#39;Put Cats In Box&#39;&gt;&gt;
    &lt;&lt;addtag adopt-cats&gt;&gt;
    &lt;&lt;removetag feeding-cat&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="547" name="Keep Feeding Mother Cat" tags="" position="850,6850" size="100,100">You find the cat and her kittens in their usual place. The mother cat looks at you expectantly as you hand her a pile of choice pieces from your last dinner. She eats them and happily lets you pet her and her kittens, who seem to have gotten bigger since last time. After a while you stand up and say goodbye to them.

&lt;&lt;decision &#39;Leave the alley&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="548" name="Put Cats In Box" tags="" position="975,6850" size="100,100">You salvage a good-condition wooden crate from the alley and line it with some scraps of fabric. The mother cat watches you with concern as you start to place the kittens in the box, but then calms when you make room for her to jump in too. She seems willing to let you take her and her kittens with you.

&lt;&lt;decision &#39;Bring the crate to ?Rosa&#39; &#39;Bring Cats Rosa&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="549" name="Bring Cats Rosa" tags="" position="1100,6850" size="100,100">&lt;&lt;setlocation &#39;Kitchen&#39;&gt;&gt;

You bring the crate of kittens into the kitchen, just as ?Rosa is pulling a loaf of bread out of the stone oven. She recognizes you in your disguise and looks at you curiously.

&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    &lt;&lt;rosa&gt;&gt;Hello there, fellow maid! What do you have in the box?&lt;&lt;/rosa&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;rosa&gt;&gt;Hello there, sir! What do you have in the box?&lt;&lt;/rosa&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Come, look!&lt;&lt;/player&gt;&gt;

?Rosa approaches and peeks inside the box. She gasps with delight.

&lt;&lt;rosa&gt;&gt;The kittens! And the mother cat! They all look so healthy, thanks to you!&lt;&lt;/rosa&gt;&gt;

A huge smile is on ?Rosa&#39;s face as she reaches in and gently pets one of the kittens. 

&lt;&lt;player&gt;&gt;I realized that the mother cat was going to need some extra help now that her kittens are born. Do you know how we could take care of them for a while?&lt;&lt;/player&gt;&gt;

?Rosa looks suddenly excited.

&lt;&lt;rosa&gt;&gt;I would be happy to take care of them! I&#39;ve raised many a litter myself already. I have a warm spot under the counter they can stay for now, and then when they&#39;re a bit older, they can become castle mousers!&lt;&lt;/rosa&gt;&gt;

You&#39;re a bit relieved ?Rosa knows what to do, as you&#39;ve never had to take care of such helpless creatures before. You hand her the crate, and she places it down carefully in a safe corner of the kitchen.

&lt;&lt;rosa&gt;&gt;Don&#39;t worry, I&#39;ll take the very best care of them.&lt;&lt;/rosa&gt;&gt;

&lt;&lt;player&gt;&gt;Thank you so much, ?Rosa.&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Remove your disguise and head back into the castle&#39; &#39;Hallway&#39;&gt;&gt;
    &lt;&lt;outfit standard&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Return to town&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="550" name="Visit Cats Kitchen" tags="" position="1225,6850" size="100,100">You crouch down and find the mother cat curled around her litter. She happily allows you to pet her and her kittens, and purrs loudly as you scratch gently behind her ears. When you eventually pull your arm away she even bats her head against your hand, as though asking for more scratches.?nl

You stay there for a while, contentedly petting the cats until you&#39;ve had your fill.

&lt;&lt;decision &#39;Say goodbye to the cats for now&#39; &#39;Kitchen&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="551" name="Alley Mugger" tags="" position="100,6975" size="100,100">You make your way down the alley, finding it difficult to navigate in the darkness. You stumble across something under your feet, and turn around to see an old chair leg laid across the path. Just as you&#39;re wondering why someone would leave this in the middle of the walkway, a man emerges from behind a stack of crates, pointing a large knife at you.

&lt;&lt;say &#39;Mugger&#39;&gt;&gt;Oi, you, give me your purse or I&#39;ll give you the end of my knife!&lt;&lt;/say&gt;&gt;

Instinctively, you throw your hands up, keeping your eyes on the knife. Is this why people talk about not going into dark alleyways?

&lt;&lt;if money(&#39;gold&#39;) &lt; 15&gt;&gt;
    You think of the coin purse in your pocket, and know &lt;&lt;if money(&#39;gold&#39;) &lt; 1&gt;&gt;it is completely empty&lt;&lt;else&gt;&gt;you have just a few coins inside&lt;&lt;/if&gt;&gt;.
    
    &lt;&lt;player&gt;&gt;I- I have &lt;&lt;if money(&#39;gold&#39;) &lt; 1&gt;&gt;no&lt;&lt;else&gt;&gt;very little&lt;&lt;/if&gt;&gt; gold!&lt;&lt;/player&gt;&gt;

    &lt;&lt;say &#39;Mugger&#39;&gt;&gt;Haha, I&#39;ve heard that one before. Throw it over, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;little lady&lt;&lt;else&gt;&gt;good sir&lt;&lt;/if&gt;&gt;.&lt;&lt;/say&gt;&gt;

    &lt;&lt;player&gt;&gt;No, really, I&#39;m not lying...&lt;&lt;/player&gt;&gt;

    You throw your &lt;&lt;if money(&#39;gold&#39;) &lt; 1&gt;&gt;empty&lt;&lt;else&gt;&gt;mostly empty&lt;&lt;/if&gt;&gt; coin purse at his feet. He kicks it to double-check your claim.

    &lt;&lt;say &#39;Mugger&#39;&gt;&gt;Well, you could still have plenty of coins on your person. You won&#39;t mind if I double-check, of course.&lt;&lt;/say&gt;&gt;

    It doesn&#39;t really seem like a question, so you keep your hands up while he pats you down, still pointing the knife at you. When he&#39;s satisfied you aren&#39;t lying, he takes a step back.

    &lt;&lt;say &#39;Mugger&#39;&gt;&gt;Well, damn, are you really that poor? I guess you can give me something else instead...&lt;&lt;/say&gt;&gt; 

    In the darkness, you can just make out him winking at you.

    &lt;&lt;player&gt;&gt;L-like what?&lt;&lt;/player&gt;&gt;

    &lt;&lt;say &#39;Mugger&#39;&gt;&gt;Oh, you know... You could give me a bit of relief with that mouth of yours...&lt;&lt;/say&gt;&gt;

    You stare at him. Because you don&#39;t have &lt;&lt;if money(&#39;gold&#39;) &lt; 1&gt;&gt;any&lt;&lt;else&gt;&gt;a lot of&lt;&lt;/if&gt;&gt; money, this mugger wants you to give him a blowjob? You suppose the situation is exciting in a way, but on the other hand, he&#39;s the one who&#39;s the criminal here. You shouldn&#39;t have to do this if you don&#39;t want to...

    &lt;&lt;decision &#39;Get out of the situation&#39; &#39;Alley Mugger Rejected&#39; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Acquiesce to his request&#39; &#39;Alley Mugger Blowjob&#39; depravity medium&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;player&gt;&gt;W-why should I? I earned this gold, fair and square!&lt;&lt;/player&gt;&gt;

    &lt;&lt;say &#39;Mugger&#39;&gt;&gt;And I take it, fair and square, or you get the knife! Your choice, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;little lady&lt;&lt;else&gt;&gt;good sir&lt;&lt;/if&gt;&gt;.&lt;&lt;/say&gt;&gt;

    You stare at him, words escaping you. You could just hand over the gold, and he would probably leave you alone. Then again, would he really stab you if you refused?

    &lt;&lt;decision &#39;Hand over your purse&#39;&gt;&gt;
        &lt;&lt;changemoney &#39;gold&#39; -15&gt;&gt;

        &lt;br&gt;Reluctantly, you remove your coin purse from your &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;dress&lt;&lt;else&gt;&gt;pants&lt;&lt;/if&gt;&gt; and throw it to him. He rifles through, pulling out a handful of gold and stuffing it into his pocket. He throws the purse back to you.

        &lt;&lt;player&gt;&gt;You&#39;re not, uh, taking all of it?&lt;&lt;/player&gt;&gt;

        &lt;&lt;say &#39;Mugger&#39;&gt;&gt;I&#39;m not an animal! Anyway, pleasure doing business with you. Have a great night.&lt;&lt;/say&gt;&gt;

        You watch, dumbfounded, as he strolls out of the alley, whistling to himself. You&#39;ve never had to worry about money before, but now that you&#39;re earning your own gold, having it taken from you feels quite unpleasant. Still, from what you&#39;ve heard of muggings, this one was probably a best case scenario.?nl

        You stuff your now-lighter coin purse back in your &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;dress&lt;&lt;else&gt;&gt;pants&lt;&lt;/if&gt;&gt; and sigh deeply before heading back out of the alley.

        &lt;&lt;decision &#39;Leave the alley&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Refuse to give him any gold&#39;&gt;&gt;
        &lt;&lt;player&gt;&gt;N-no, I won&#39;t! I earned this gold, fair and square!&lt;&lt;/player&gt;&gt;

        It&#39;s hard to tell in the dim light, but you think you see a look of confusion on the man&#39;s face.

        &lt;&lt;say &#39;Mugger&#39;&gt;&gt;Huh. You know, no one&#39;s ever refused before. They usually just throw over the money and I leave them in peace, fair and square...&lt;&lt;/say&gt;&gt;

        You gain a bit of confidence hearing his words. Clearly this man isn&#39;t used to casually stabbing people.

        &lt;&lt;player&gt;&gt;Well, then, there&#39;s a first time for everything. Go find someone else to mug!&lt;&lt;/player&gt;&gt;

        &lt;&lt;say &#39;Mugger&#39;&gt;&gt;Hey, listen, you&#39;ve got to give me something, that&#39;s how this works. I guess you can give me something other than gold...&lt;&lt;/say&gt;&gt;

        In the darkness, you can just make out him winking at you.

        &lt;&lt;player&gt;&gt;L-like what?&lt;&lt;/player&gt;&gt;

        &lt;&lt;say &#39;Mugger&#39;&gt;&gt;Oh, you know... You could give me a bit of relief with that mouth of yours...&lt;&lt;/say&gt;&gt;

        You stare at him. Because you won&#39;t give him any money, this mugger wants you to give him a blowjob? You suppose the situation is exciting in a way, but on the other hand, he&#39;s the one who&#39;s the criminal here. You shouldn&#39;t have to do this if you don&#39;t want to...

        &lt;&lt;decision &#39;Get out of the situation&#39; &#39;Alley Mugger Rejected&#39; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;
        &lt;&lt;decision &#39;Acquiesce to his request&#39; &#39;Alley Mugger Blowjob&#39; depravity medium&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="552" name="Alley Mugger Rejected" tags="" position="225,6975" size="100,100">Even though this situation is obviously dangerous, you can&#39;t help but feel a bit angry at his suggestion. Before you can think of a more tactful way to get away, you find yourself raising your voice.

&lt;&lt;player&gt;&gt;Because you&#39;re not going to get any gold from me, you want me to suck you off? What&#39;s wrong with you?&lt;&lt;/player&gt;&gt;

The man takes a step back, lowering his knife.

&lt;&lt;say &#39;Mugger&#39;&gt;&gt;Woah, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;little lady&lt;&lt;else&gt;&gt;good sir&lt;&lt;/if&gt;&gt;, I&#39;m just a simple businessman trying to complete a transaction here. I&#39;m not some kind of criminal!&lt;&lt;/say&gt;&gt;

You stare at him, an obvious criminal, attempting to commit a crime.

&lt;&lt;say &#39;Mugger&#39;&gt;&gt;Haha, I mean, not that kind of criminal. Anyway, I guess I&#39;ll let you off this time, but I hope next time we can complete our transaction, fair and square!&lt;&lt;/say&gt;&gt;

You watch, dumbfounded, as he strolls out of the alley, whistling to himself. You&#39;ve never had to worry about money before, but now that you&#39;re earning your own gold, the thought of having it taken from you is quite unpleasant. You certainly hope you don&#39;t see this mugger again.

&lt;&lt;decision &#39;Leave the alley&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="553" name="Alley Mugger Blowjob" tags="spicy" position="350,6975" size="100,100">&lt;&lt;addsin &#39;blowjob&#39;&gt;&gt;
&lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;

&lt;&lt;player&gt;&gt;If I, uh, help you out, you&#39;ll leave me alone?&lt;&lt;/player&gt;&gt;

The man looks suddenly excited.

&lt;&lt;say &#39;Mugger&#39;&gt;&gt;Woah, I didn&#39;t expect that to work! Of course, then our transaction would be complete.&lt;&lt;/say&gt;&gt;

You&#39;re not sure why, but something about this situation is turning you on. Without another word, you get on your knees in front of the man.?nl

He grunts and lowers his pants to reveal his cock, already beginning to stiffen in front of your eyes. You hesitate for a moment, then reach out and place your hand on the shaft. Slowly, you begin to stroke, watching as he grows harder in your hand. You look up and in the dim light you can see him throw his head back. 

&lt;&lt;say &#39;Mugger&#39;&gt;&gt;Oh, yeah... Spit on it...&lt;&lt;/say&gt;&gt;

You pause for a second. He wants you to spit on it? Well, you&#39;re already pleasuring him with your hand; you might as well add some lubrication. You do as he says and spit on his cock, causing him to let out a low moan. As you continue moving your hand along the shaft, it slides effortlessly over your own saliva.

&lt;&lt;say &#39;Mugger&#39;&gt;&gt;Come on, put your mouth on it...&lt;&lt;/say&gt;&gt;

Are you really going to do this? Suck off a mugger in an alleyway? It seems you are, and some part of you is enjoying it, too. You might as well go all in.?nl

You lean forward and take his cock into your mouth, a light salty flavor coating your tongue. You begin to suck, still stroking the base of the shaft with your hand. 

&lt;&lt;say &#39;Mugger&#39;&gt;&gt;Fuck, yeah, slobber all over it...&lt;&lt;/say&gt;&gt;

You&#39;re starting to get into your task now. You pull the cock out of your mouth and spit liberally, then slide it back into your mouth. As you continue moving your mouth along the shaft, you notice that the sloppier you are, the more he seems to enjoy it. 

&lt;&lt;say &#39;Mugger&#39;&gt;&gt;Ugh, that&#39;s so good...&lt;&lt;/say&gt;&gt;


&lt;&lt;img &#39;morgana/bandit_blowjob.gif&#39; &#39;ridge-border&#39; &#39;36em&#39;&gt;&gt;
You continue sloppily sucking him off, feeling the wetness spreading on your face as you pleasure him. As you increase your speed he begins moaning loudly, clearly enjoying the loud sucking noises you&#39;re making.

&lt;&lt;say &#39;Mugger&#39;&gt;&gt;Nearly there...&lt;&lt;/say&gt;&gt;

You increase your speed even more, enthusiastically bobbing your head up and down on his dick, the wet sounds echoing through the alleyway. He lets out a long moan as he suddenly orgasms, the cum shooting unexpectedly into the back of your mouth. You almost choke for a moment, but try to relax and allow his load to slide down your throat. When you pull his cock out of your mouth with a final, wet squelch, he looks down at you, impressed.

&lt;&lt;say &#39;Mugger&#39;&gt;&gt;Damn, that was way better than any gold. I think that makes us even, fair and square.&lt;&lt;/say&gt;&gt;

You stand up, feeling suddenly awkward as he tucks his wet cock back into his pants. 

&lt;&lt;say &#39;Mugger&#39;&gt;&gt;Hey, maybe we can do this again sometime. Have a nice day, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;little lady&lt;&lt;else&gt;&gt;good sir&lt;&lt;/if&gt;&gt;!&lt;&lt;/say&gt;&gt;

You watch, dumbfounded, as he strolls out of the alley, whistling to himself. You can hardly believe that you just gave a criminal a blowjob in a sketchy alleyway. It&#39;s also getting late, you should probably leave before anything else happens.

&lt;&lt;decision &#39;Head back to the castle&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="554" name="Church Bedroom" tags="" position="475,6975" size="100,100">&lt;&lt;outfit church&gt;&gt;
?Orson enters your chambers with the soft creak of the wooden doors, the morning sun casting a warm glow through the open window. He approaches your bed, a gentle smile on his face, as he begins to draw back the heavy curtains.

&lt;&lt;orson&gt;&gt;Good morning, your highness. It&#39;s a beautiful Sunday, and the church bells will be ringing soon.&lt;&lt;/orson&gt;&gt;

You stretch beneath the covers, the thought of leaving the warm embrace of your bed unappealing. Yet, the reminder of your duties nudges at you, a silent call to start the day.

&lt;&lt;player&gt;&gt;Is it that time already, ?Orson? I suppose I should get ready then.&lt;&lt;/player&gt;&gt;

?Orson nods, moving to your wardrobe to pick out your attire for the morning service. He lays out your finely made royal vestments, specifically meant for your Sunday visitations, on the bed.?nl

As you get out of bed, ?Orson helps you dress, ensuring each piece of clothing is perfectly adjusted. The fabric feels soft against your skin, a testament to the skill of the kingdom&#39;s tailors.?nl

Once dressed, ?Orson leads you to the mirror, where you take a moment to examine your reflection. The outfit is indeed regal, fitting for a prince of your stature.

&lt;&lt;orson&gt;&gt;You look splendid, prince. Now, let&#39;s not keep the chaplain waiting. Remember, after the service, &lt;&lt;fullname devota&gt;&gt; has requested your presence for confession.&lt;&lt;/orson&gt;&gt;

You nod, a sense of anticipation settling over you. The thought of confession always brings a mixture of discomfort and relief. Speaking your deepest thoughts is never easy, even in ?Devota&#39;s supportive presence.

&lt;&lt;player&gt;&gt;Thank you, ?Orson. I&#39;ll head to the church then. I wouldn&#39;t want to be late.&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Head outside&#39; &#39;Church Walking&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="555" name="Church Walking" tags="" position="600,6975" size="100,100">&lt;&lt;if !hasCompletedQuest(&#39;assassination-attempt&#39;)&gt;&gt;
    &lt;&lt;setlocation &quot;Town square&quot;&gt;&gt;
    Leaving the castle&#39;s protective walls behind, you venture into the heart of the town, where the rhythm of daily life plays out with vibrant energy. The market is a bustling hub, filled with vendors hawking fresh produce, textiles, and artisan crafts. Laughter and chatter fill the air, blending with the smells of baked goods and smoked meats.&lt;br&gt;

    As you make your way through the crowded streets, you pass by the local tavern, its doors open wide, inviting in early patrons with the promise of hearty meals and ale. Further on, you walk by ?Beau, the town&#39;s blacksmith, working at her forge.&lt;br&gt;

    There&#39;s quite a large number of people in the town square right now. Looks like there&#39;s more people slightly late for church. In the busy crowd you somehow manage to lose your footing on a loose cobblestone. You awkwardly fall to the ground but right before the impact you feel a strong arm lifting you back up.

    &lt;&lt;beau&gt;&gt;Careful there, ?title. Wouldn&#39;t want you getting your nice clothes dirty.&lt;&lt;/beau&gt;&gt;

    Her voice is gentle, but standing so close, you can&#39;t help but feel overshadowed by her towering presence.

    &lt;&lt;player&gt;&gt;Thank you, ?Beau. I&#39;ll watch my step more carefully.&lt;&lt;/player&gt;&gt;

    Your words are brief, the encounter leaving you feeling slightly embarrassed but grateful for her quick reflexes.

    &lt;&lt;beau&gt;&gt;No trouble at all. Off to the church, then? A good day for it.&lt;&lt;/beau&gt;&gt;

    Nodding, you quickly resume your journey, eager to leave the moment behind. ?Beau&#39;s friendly chuckle follows you as you move away, the church now just a short distance ahead.
&lt;&lt;else&gt;&gt;
    &lt;&lt;setlocation Gatehouse&gt;&gt;
    At the castle gates, a small regiment of soldiers stand ready to escort you to church. You are quite annoyed by the council&#39;s ruling that you cannot leave the castle without an escort but you don&#39;t quite have it in you to stand up to ?Andreas on this topic, so you agree to let the soldiers protect you on your way to church. You suppose they&#39;re useful to have around for when another assassin decides to pop out of the bushes...
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Head to the church&#39; &#39;Church Sermon&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="556" name="Church Sermon" tags="" position="725,6975" size="100,100">&lt;&lt;setlocation &quot;Church&quot;&gt;&gt;

/* @TODO Rewrite with rework */

As you step through the ornate doors of the church, the bustling noise of the town fades into a hushed silence of the many people already sitting in the pews, waiting for the sermon to begin. ?nl

You make your way to the front, where the councilors have already gathered in their designated pews. ?Andreas, ?Wymerus, ?Leopold, ?Morgana, and ?Sybille all nod in acknowledgment as you join them, each offering a silent greeting. ?nl

&lt;&lt;fullname devota&gt;&gt; steps up to the pulpit. Her presence commands attention, and as she begins her sermon, the congregation falls into a hushed attentiveness.
&lt;&lt;devota&gt;&gt;Welcome, everyone. Let us begin the sermon.&lt;&lt;/devota&gt;&gt;
Her voice echoes through the hall, speaking of duty, sacrifice, and the virtues of faith. Her reassuring demeanor soothes you, and you do your best to absorb the wisdom in her words.?nl

As the sermon concludes and the final hymn is sung, the congregation begins to disperse, leaving in a quiet reflection of the morning&#39;s teachings. You, however, remain seated, gathering your thoughts for the confession that awaits.

&lt;&lt;decision &#39;Enter the confession booth&#39;&gt;&gt;
    &lt;&lt;if !hasVisited(&#39;Confessions Intro&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Confessions Intro&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;goto &#39;Confessions&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="557" name="Leave Church" tags="" position="850,6975" size="100,100">&lt;&lt;setlocation Church&gt;&gt;
&lt;&lt;unset $confessions&gt;&gt;
Having finished confessions, it&#39;s time to head back to the castle.
&lt;&lt;if !hasCompletedQuest(&#39;assassination-attempt&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Head back to the castle&#39; &#39;Assassination&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt; 
&lt;&lt;else&gt;&gt;
    Your soldiers await you outside of the church, ready to escort you back to the castle. You make your way through the town. It&#39;s bustling with people in the marketplace, but with some shouting from your bodyguard, people make way for you to pass.
    You can see the open tavern ready to invite people in now that the church sermon is finished. Even though you might want to get a drink, you realise the councillors would be deeply disappointed if you let yourself get in harm&#39;s way like that.
    
    &lt;&lt;decision &#39;Head back to the castle&#39; &#39;Gatehouse&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;equip &#39;prince_outfit_1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="558" name="Church Wandering" tags="" position="975,6975" size="100,100">&lt;&lt;addcounter &#39;church-wandering&#39; 1&gt;&gt;
&lt;&lt;first&gt;&gt;
    &lt;&lt;include &#39;Church Money Box&#39;&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;include &#39;Church Stained Glass&#39;&gt;&gt;
&lt;&lt;then&gt;&gt;
    &lt;&lt;include &#39;Church Saint Statue&#39;&gt;&gt;
&lt;&lt;finally&gt;&gt;
    &lt;&lt;include `either(&#39;Church Money Box&#39;, &#39;Church Stained Glass&#39;, &#39;Church Saint Statue&#39;)`&gt;&gt;
&lt;&lt;/first&gt;&gt;</tw-passagedata><tw-passagedata pid="559" name="Church Money Box" tags="" position="1100,6975" size="100,100">You make your way into the church, the bustle of the town fading into silence as you pass through the ornate doors. It seems you have entered at a rare moment when the church is totally vacant. The pews stand empty, and even ?Devota is nowhere to be seen. You imagine she must be in her office, working on her next sermon.?nl

You walk between the pews, the sound of your footsteps echoing lightly through the room. As you do so, your eyes fall on the wooden collection box at the end of the aisle. The box is normally locked, but for some reason the iron padlock is currently missing.?nl

Considering how much time you&#39;re spending in disguise now, you could really use a few more coins in your pocket. It would be so easy to take a small handful. After all, how many hundreds of coins have you yourself dropped into that very box? You would simply be borrowing from your past self... 

&lt;&lt;decision &#39;Open the collection box&#39; &#39;Church Money Box Open&#39; depravity medium&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Resist the temptation&#39; &#39;Church Money Box Ignore&#39; virtue medium&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="560" name="Church Money Box Open" tags="" position="1225,6975" size="100,100">Looking around one more time to ensure no one is watching, you approach the box and flip open the lid. Just as you&#39;re leaning over the box to look inside, you hear footsteps approaching. You rush to close the lid but before you can do so, ?Devota enters the room and locks eyes with you. Concern washes over her face as she quickly approaches, closing in on you.

&lt;&lt;devota&gt;&gt;Stealing from the church is no better than stealing from your neighbor, my child.&lt;&lt;/devota&gt;&gt;

She looks at you closely, as though wondering if she has seen you somewhere before. You avert her gaze, looking to the ground. Knowing she is accustomed to hearing your voice, you try to alter it as much as possible.

&lt;&lt;player&gt;&gt;Forgive me, ?Mother, I was only...well...&lt;&lt;/player&gt;&gt;

You trail off, realizing lying is probably not going to help your situation.

&lt;&lt;devota&gt;&gt;You must know that charity is given here freely. You need only ask.&lt;&lt;/devota&gt;&gt;

She pulls a padlock from her robes and locks the money box with a large key. As she does so, you see inside and realize that the box is completely empty. ?Devota must have just finished emptying it. She turns to you, her expression soft.

&lt;&lt;devota&gt;&gt;I forgive you, my child. Only our Lady can imagine what desperate circumstances pushed you to this act. However, stealing is not only a religious matter but a societal ill. I regret that I must report this incident to the town guards.&lt;&lt;/devota&gt;&gt;

She gestures to follow you out of the church. For a wild moment you imagine running away, but ?Devota has gotten quite a good look at you in your disguise now. There&#39;s nothing for it but to submit to whatever punishment the guards dole out. It can&#39;t be that bad, can it??nl

You walk with her for a moment, and together you quickly encounter a guard on the street. ?Devota explains the situation and then leaves you, retreating back into the church.

&lt;&lt;decision &#39;Face your fate&#39; &#39;Church Money Box Open Guard&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="561" name="Church Money Box Open Guard" tags="" position="100,7100" size="100,100">The guard looks you up and down, a small smile forming on his face. 

&lt;&lt;say &#39;Guard&#39;&gt;&gt;So, a petty thief, huh? Since you didn&#39;t actually manage to steal anything, your punishment will be light. I&#39;ll even let you choose. A cold night in the dungeons, or a warm few hours in the pillory...&lt;&lt;/say&gt;&gt;

He chuckles, still looking at you intensely. An entire night on a cold, hard dungeon ground certainly sounds unpleasant, but something tells you there&#39;s more to the pillory option than you realize.

&lt;&lt;player&gt;&gt;W-why is time in the pillory...warm?&lt;&lt;/player&gt;&gt;

&lt;&lt;say &#39;Guard&#39;&gt;&gt;Oh, you don&#39;t know? Offenders locked in the pillory are freely available for the public&#39;s use and pleasure. You certainly won&#39;t go cold.&lt;&lt;/say&gt;&gt;

You stare at the guard. Is he implying that people in the pillory are available for the sexual whims of any random passerby? Suddenly an evening in the pillory sounds frightening, but an entire night in the cold dungeon doesn&#39;t sound particularly nice, either. Both feel like steep punishments, especially since you didn&#39;t even steal anything...

&lt;&lt;decision &#39;Choose the pillory&#39; &#39;Pillory Locked Up&#39; depravity medium&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Choose the dungeons&#39; &#39;Dungeons Locked Up&#39; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="562" name="Church Money Box Ignore" tags="" position="225,7100" size="100,100">You ignore the temptation of the collection box and turn away to look at one of the beautiful stained glass windows lining the church walls. Just as you do so, you hear footsteps enter the room. You look over your shoulder to see ?Devota reattaching the padlock to the collection box and locking it with a large key.?nl

You feel relieved that you didn&#39;t approach the box. There would have been some very awkward questions if ?Devota had caught you, let alone if she recognized who you were...?nl

You figure you should probably leave now, before ?Devota tries to come talk to you.

&lt;&lt;decision &#39;Leave the church&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="563" name="Church Stained Glass" tags="" position="350,7100" size="100,100">You enter the church, feeling a sense of calm wash over you as you step into the quiet. There are several townspeople in the pews, hands clasped and heads lowered in prayer. You catch a glimpse of ?Devota as she ducks into a confessional booth.?nl

You wander around the edges of the church, admiring the way the light filters through the stained glass windows, casting colorful patterns on the floor. You stop by one window and take a closer look. You aren&#39;t sure exactly which stories are depicted in the glass, but you appreciate the bright blue in the robes of one figure, and the deep red of a bowl of apples.?nl

You spend some time wandering around the church, enjoying the stained glass and the quiet, before you feel ready to leave.

&lt;&lt;decision &#39;Leave the church&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="564" name="Church Saint Statue" tags="" position="475,7100" size="100,100">You stroll into the church. It seems to be a quiet day, with just one person praying silently in a pew. ?Devota, who is arranging some papers by the pulpit, looks up as you enter. You accidentally make eye contact with her, and before you can do anything, she leaves the pulpit and approaches you.

&lt;&lt;devota&gt;&gt;Hello, my child. Do you seek guidance or confession this day?&lt;&lt;/devota&gt;&gt;

Luckily she doesn&#39;t seem to have recognized you yet, though you&#39;re painfully aware that of anyone, she may be the most accustomed to recognizing your voice without seeing your appearance. &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;You alter your voice to sound as feminine as possible.&lt;&lt;else&gt;&gt;You alter your voice to sound lower than usual.&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Ah, no, ?Mother, I was simply...admiring this statue.&lt;&lt;/player&gt;&gt;

You point to a nearby statue of a man in long robes holding a pair of shoes in one hand and a sword in the other. ?Devota looks at the statue and back to you, a slight look of confusion on her face.

&lt;&lt;devota&gt;&gt;Saint Edmund? A venerable man, indeed. He was known as Sir Edmund in his day, and serves as a model to us all for fighting wrongdoing through...unconventional means.&lt;&lt;/devota&gt;&gt;

&lt;&lt;if hasRead(&#39;dancing-knight&#39;)&gt;&gt;
    You realize you&#39;ve heard the name Sir Edmund before, in that ridiculous book about the dancing knight. This couldn&#39;t be the same Sir Edmund, could it?
&lt;&lt;else&gt;&gt;
    You&#39;re not sure you&#39;ve ever heard of a &quot;Saint Edmund&quot; before. He can&#39;t have been a very important saint.
&lt;&lt;/if&gt;&gt;

You want to end this conversation before ?Devota recognizes you, but curiosity gets the better of you. 

&lt;&lt;player&gt;&gt;Why is he holding a pair of shoes, then?&lt;&lt;/player&gt;&gt;

?Devota looks vaguely amused at this question.

&lt;&lt;devota&gt;&gt;Well, that is illustrative of part of the parable. He used the medium of...well...dance to distract his opponents. Thus, those are his...dancing shoes.&lt;&lt;/devota&gt;&gt;

You see ?Devota unsuccessfully suppress a chuckle as she conveys this information, and you find yourself laughing with her. Still, you don&#39;t want to push your luck by talking to her for too long.

&lt;&lt;player&gt;&gt;I must be going, but thank you, ?Mother, for this wisdom.&lt;&lt;/player&gt;&gt;

?Devota gives you a mirthful nod.

&lt;&lt;devota&gt;&gt;Go in peace, my child.&lt;&lt;/devota&gt;&gt;

&lt;&lt;decision &#39;Leave the church&#39; &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="565" name="Velma Boarding Room" tags="" position="600,7100" size="100,100">&lt;&lt;setlocation &#39;Velma\&#39;s Office&#39;&gt;&gt;
&lt;&lt;completequest &#39;boarding-room&#39;&gt;&gt;
&lt;&lt;unlocklocation &#39;Boarding Room&#39;&gt;&gt;

You once again knock on ?Velma&#39;s office door and enter as soon as she responds.

&lt;&lt;velma&gt;&gt;Ah, there you are, ?newname. I realize I was slightly vague last time you were here. Allow me to show me what your reward is.&lt;&lt;/velma&gt;&gt;

She suddenly gets up from her desk and opens the door to leave.

&lt;&lt;velma&gt;&gt;Please, follow me.&lt;&lt;/velma&gt;&gt;

&lt;&lt;player&gt;&gt;Uh- Of course, ?Madame.&lt;&lt;/player&gt;&gt;

You follow ?Velma through the tavern as she leads you to the brown door at the back of the place. This is the door that leads to the brothel, the one that you&#39;ve seen ?Eve go through numerous times. Once you go through, ?Velma heads down the long corridor that connect all the different private rooms. She stops in front of a door and uses a key to open it.

&lt;&lt;decision &#39;Follow ?Velma inside the room&#39; &#39;Velma Boarding Room 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="566" name="Velma Boarding Room 2" tags="" position="725,7100" size="100,100">&lt;&lt;setlocation &#39;Boarding Room&#39;&gt;&gt;
You step into a small boarding room, it&#39;s decorated rather practically. You take a good look around as you walk inside. There&#39;s a bed, a wardrobe, a small dressing table with a mirror, and that&#39;s basically it. The place feels rather dusty but the sheets look fresh. ?nl
?Velma steps inside after you and closes the door behind her.
&lt;&lt;velma&gt;&gt;So, welcome to your new room, ?newname. I know it&#39;s not quite what you&#39;re used to but it is all I could spare right now. Consider it yours for as long as you work here.&lt;&lt;/velma&gt;&gt;
That&#39;s your reward? You look at her while going over the situation in your head. The place feels cramped and absolutely less refined than what you have at the castle but somehow you find that it actually makes you feel... happy.?nl
Through strange happenstance you have actually received something for yourself, your own tiny little room at a tavern. The fact that you have earned this by proving yourself through honest work makes you feel surprisingly positive. A feeling that is quickly revealed through the beaming smile on your face.
&lt;&lt;player&gt;&gt;You&#39;re giving me a room of my own?&lt;&lt;/player&gt;&gt;
&lt;&lt;velma&gt;&gt;I&#39;m glad you like it. I&#39;ve had some correspondence with ?Sybille and we thought it might be a good idea to give you a little room of your own. It also helps the disguise, I think. Let this be your reward for working so hard.&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;Thank you, ?Madame. It&#39;s actually lovely. I&#39;m really grateful.&lt;&lt;/player&gt;&gt;
She gives you a caring smile before she turns to open the door again.
&lt;&lt;velma&gt;&gt;Good. Take some time to settle in. I imagine you&#39;d still prefer sleeping at the castle but at least you can have your own little space here now.&lt;&lt;/velma&gt;&gt;
?Velma leaves you alone in the room. Well, your room now, actually. You take a moment to sit on the bed and take it all in. It&#39;s quite a nice bed, actually.?nl
After sitting there and staring at a wall for a good five minutes suddenly you hear a knock on the door.

&lt;&lt;decision &#39;Open the door&#39; &#39;Velma Boarding Room 3&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="567" name="Velma Boarding Room 3" tags="" position="850,7100" size="100,100">You open the door and are suddenly greeted by ?Eve, standing in front of your door.
&lt;&lt;eve&gt;&gt;Hey, ?newname! I heard this room has been assigned to you now, that&#39;s so cool! This actually used to be mine a while ago and I never got around to moving some of my stuff, do you mind if I come in to get rid of that for you?&lt;&lt;/eve&gt;&gt;
&lt;&lt;player&gt;&gt;Oh, of course, ?Eve! Come on in!&lt;&lt;/player&gt;&gt;
?Eve walks past you into the small room and heads over to the nightstand next to your bed. She immediately opens a drawer and takes out a cylindrical object. You immediately think it&#39;s pretty funny how the thing looks slightly phallic before you actually realize that yup, that is in fact a dildo.

&lt;&lt;img &quot;equipment/dildo_copper.jpg&quot; null &#39;250px&#39;&gt;&gt;

&lt;&lt;eve&gt;&gt;Alright, that should be everything. I&#39;ll be out of your hair now.&lt;&lt;/eve&gt;&gt;
Not entirely sure what&#39;s going on you quickly respond to her.
&lt;&lt;player&gt;&gt;Uhm, hey, ?Eve?&lt;&lt;/player&gt;&gt;
She casually holds the dildo as she turns to you.
&lt;&lt;eve&gt;&gt;Mmhmm, yeah, what&#39;s up?&lt;&lt;/eve&gt;&gt;
&lt;&lt;player&gt;&gt;Did you just take a dildo from my nightstand?&lt;&lt;/player&gt;&gt;
&lt;&lt;eve&gt;&gt;Oh yes, like I said, I forgot to bring this ol&#39; thing when I moved rooms. I&#39;ve got a better one now but didn&#39;t want to leave this poor buddy all abandoned.&lt;&lt;/eve&gt;&gt;
She waves the thing around to emphasize it.
&lt;&lt;player&gt;&gt;Okay, uhm- well-&lt;&lt;/player&gt;&gt;
You&#39;re not even sure what to say at this point. How can she act so casual around this? Before you can formulate your next sentence she seems to confuse your lack of words for timid interest.
&lt;&lt;eve&gt;&gt;Oh! Did you want to use this? I mean, it&#39;s probably not a good idea to go second-hand but if you want to get your own, you should visit the blacksmith in town, ?Beau. She sells all kinds of cool stuff - like these dildos - that she makes herself in the smithy. She even enchants them to make them feel more realistic, isn&#39;t that awesome!&lt;&lt;/eve&gt;&gt;

&lt;&lt;decision &#39;Respond with interest&#39; depravity small&gt;&gt;
    &lt;&lt;player&gt;&gt;?Beau sells sex-toys? I had no idea... I should... probably check that out, yeah...&lt;&lt;/player&gt;&gt;
    &lt;&lt;eve&gt;&gt;Yay! You definitely should! She has a biiig selection to pick from and some nice sizes for you to get started with!&lt;&lt;/eve&gt;&gt;
    Talking about buying dildo&#39;s has you feeling your usual awkward again.
    &lt;&lt;player&gt;&gt;That sounds pretty uh- interesting, yes.&lt;&lt;/player&gt;&gt;

    &lt;&lt;include &#39;Velma Boarding Room Ending&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Tell her you\&#39;re not really interested in that&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Uhm- Thank you for sharing this, ?Eve. But I don&#39;t think I&#39;m really interested in that.&lt;&lt;/player&gt;&gt;
    &lt;&lt;eve&gt;&gt;Oh I&#39;m sorry! That&#39;s totally fine! Just wanted to tell you about the secret sex-toy shop ?Beau is running, you can get all sorts of things there.&lt;&lt;/eve&gt;&gt;
    &lt;&lt;player&gt;&gt;That&#39;s good to know, it&#39;s definitely surprising, I had no idea ?Beau was doing something like that...&lt;&lt;/player&gt;&gt;

    &lt;&lt;include &#39;Velma Boarding Room Ending&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="568" name="Velma Boarding Room Ending" tags="" position="975,7100" size="100,100">Smiles at you and continues her journey to save the abandoned dildo.
&lt;&lt;eve&gt;&gt;Well, think it over, ?newname. Thanks for letting me get this little buddy. I&#39;ll see you around!&lt;&lt;/eve&gt;&gt;
&lt;&lt;if hasTag(&#39;eve-romance&#39;)&gt;&gt;
    Before she leaves, ?Eve suddenly catches you off guard as she plants a soft kiss on your cheek, instantly making you blush.
    &lt;&lt;eve&gt;&gt;Also... If you need any more... &lt;em&gt;private lessons&lt;/em&gt;, feel free to come by sometime.&lt;&lt;/eve&gt;&gt;
    You stammer out a reply.
    &lt;&lt;player&gt;&gt;Uh- Y- yes, that would be nice...&lt;&lt;/player&gt;&gt;
    She affectionately chuckles at your awkwardness and turns to leave your room.?nl
&lt;&lt;else&gt;&gt;
    She leaves your room.?nl
&lt;&lt;/if&gt;&gt;

With that handled, you sit back down on your bed. You curiously open the drawer of the nightstand, not sure what you&#39;re really hoping to find, but you feel a slight disappointment as you see that it&#39;s empty now. Well, at least you&#39;ve learned a bit more about this new room of yours.

&lt;&lt;decision &#39;Leave the room&#39; &#39;Tavern&#39;&gt;&gt;
    &lt;&lt;startquest &#39;blacksmith-intro&#39;&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="569" name="Brothel Eve Intro" tags="" position="1100,7100" size="100,100">It&#39;s late at night when you&#39;re walking through the tavern. There are still some patrons sipping drinks - even a few looking at you expectantly - but you&#39;re here now for an altogether different reason than serving ale.?nl
You walk up to the bar where you spot ?Eve, washing some mugs.
&lt;&lt;eve&gt;&gt;Hey ?newname! Isn&#39;t it already past your shift?&lt;&lt;/eve&gt;&gt;
You look away awkwardly and scratch your arm while you make your voice softer.
&lt;&lt;player&gt;&gt;Uhm- Yes, I&#39;m actually here for the... other work...&lt;&lt;/player&gt;&gt;
Her puzzled expression is quickly broken by a sly smile the moment she realizes what you mean.
&lt;&lt;eve&gt;&gt;Oh! ?MadameVelma gave you permission then! You can come and work at the brothel?!&lt;&lt;/eve&gt;&gt;
She lets out an excited squeal and jumps up happily, not really worrying about making a scene or your embarrassment.
&lt;&lt;player&gt;&gt;Uh- Yes, she told me I can try it out... Please don&#39;t shout about this too loud, ?Eve.&lt;&lt;/player&gt;&gt;
You quickly look around to see if anyone heard her mention the brothel work as she immediately places her hands over her mouth.
&lt;&lt;eve&gt;&gt;Oh, I&#39;m sorry! I just got excited is all! This is going to be so much fun, you get to do the best part of working here with me!&lt;&lt;/eve&gt;&gt;
She abruptly gives you a quick hug and then looks at you intensely.
&lt;&lt;eve&gt;&gt;Don&#39;t worry, this must be new and scary to you but I&#39;ll be there with you! I think it&#39;s best we go to ?MadameVelma first and let her know you&#39;re ready.&lt;&lt;/eve&gt;&gt;
You nod at her as she takes your hand and guides you to ?Velma&#39;s office.

&lt;&lt;decision &#39;Go to ?Velma&#39; &#39;Brothel Eve Intro 2&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="570" name="Brothel Eve Intro 2" tags="" position="1225,7100" size="100,100">&lt;&lt;setlocation &#39;Velma\&#39;s Office&#39;&gt;&gt;
?Eve knocks on the ?Madame&#39;s door before entering. You step into the room, right behind ?Eve and see ?Velma sitting behind her desk. She&#39;s looking at you both expectantly.
&lt;&lt;velma&gt;&gt;Yes, my dears, what can I help you with?&lt;&lt;/velma&gt;&gt;
?Eve clears her throat and gives a playful bow before responding to her.
&lt;&lt;eve&gt;&gt;My illustrious ?Madame, I am proud to present to you: your amazing and promising new &lt;em&gt;prostitute&lt;/em&gt;! More than ready to fulfill this ancient and honorable profession, ?he is ready for ?his onboarding!&lt;&lt;/eve&gt;&gt;
She holds out both arms as she turns to you, presenting you like you&#39;re the volunteer in a magic show. Your cheeks immediately turn bright red as you want to do nothing more than punch ?Eve for catching you off guard like that. You embarrassingly look at ?Velma, waiting for her response. You see an amused smile appear on her face.
&lt;&lt;velma&gt;&gt;Well, dramatics aside, it looks like you made your decision then, ?newname? Do you wish to become a sexworker at my brothel?&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;Uh- Yes, ?Madame. I wish to increase my service to you. I promise to perform any duties that the profession requires.&lt;&lt;/player&gt;&gt;
?Eve let&#39;s out a quiet excited gasp while ?Velma leans back in her chair and looks you up and down.
&lt;&lt;velma&gt;&gt;Whoa there, no need to make any promises like that, ?newname. We&#39;re a very refined establishment, you won&#39;t be required to do anything you&#39;re not comfortable with.&lt;&lt;/velma&gt;&gt;
You give her a quick nod as she continues.
&lt;&lt;velma&gt;&gt;But that fact aside, I must say I am pleasantly surprised to hear you make this decision. Even though ?Eve has a flair for dramatics, she is correct. It is a noble profession and I will gladly give you the opportunity for it.&lt;&lt;/velma&gt;&gt;
She stands up from her chair and walks past her desk.
&lt;&lt;velma&gt;&gt;Let us start the onboarding right now then, I have already prepared a room for you. Please follow me.&lt;&lt;/velma&gt;&gt;
&lt;&lt;decision &#39;Follow ?Velma&#39; &#39;Brothel Eve Intro Corridor&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="571" name="Brothel Eve Intro Corridor" tags="" position="100,7225" size="100,100">&lt;&lt;setlocation &#39;Corridor&#39;&gt;&gt;
&lt;&lt;if hasTag(&#39;eve-romance&#39;)&gt;&gt;
    ?Eve immediately takes you by the arm, excitedly clinging to you as you both walk behind ?Velma.
&lt;&lt;/if&gt;&gt;
&lt;&lt;eve&gt;&gt;Yay! This is so exciting!&lt;&lt;/eve&gt;&gt;
?Velma takes the both of you through the elusive brown door at the back of the tavern that you have seen ?Eve sneak through on multiple occasions. Behind it you find the long hallway that leads to the different boarding rooms.?nl
Someone unaware of the tavern&#39;s lewd dealings might be inclined to think this just a normal inn, it certainly looks unremarkable. At the far end of the long hallway you see a large door ordained with bright red curtains. It looks so fancy that it feels like it would better belong in your castle than this place.?nl
Though it leaves you curious for what&#39;s behind it, the mystery will have to wait. ?Velma stops halfway down the corridor and opens one of the doors, gesturing for you to step inside. Before ?Eve can excitedly step into the room first, ?Velma puts a hand in front of her to stop her.
&lt;&lt;velma&gt;&gt;Give us a moment, ?Eve. I will call you when we&#39;re ready.&lt;&lt;/velma&gt;&gt;
She nods and turns to lean against the hallway wall, waiting patiently.
&lt;&lt;decision &#39;Step inside the room&#39; &#39;Brothel Eve Intro 3&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="572" name="Brothel Eve Intro 3" tags="" position="225,7225" size="100,100">&lt;&lt;setlocation &#39;Boarding Room&#39;&gt;&gt;
&lt;&lt;completequest &#39;boarding-room&#39;&gt;&gt;
You step into a small boarding room, it&#39;s decorated rather practically. You take a good look around as you walk inside. There&#39;s a bed, a wardrobe, a small dressing table with a mirror, and that&#39;s basically it. The place feels rather dusty but the sheets look fresh. ?nl
?Velma steps inside after you and closes the door behind her.
&lt;&lt;velma&gt;&gt;So, welcome to your new room, ?newname. I know it&#39;s not quite what you&#39;re used to but it is all I could spare right now. Consider it yours for as long as you work here.&lt;&lt;/velma&gt;&gt;
You look at her while going over the situation in your head. The place feels cramped and absolutely less refined than what you have at the castle but somehow you find that it actually makes you feel... happy.?nl
Through strange happenstance you have actually received something for yourself, your own tiny little room at a brothel. The fact that you have earned this by proving yourself through honest - and now unconventional - work makes you feel surprisingly positive. A feeling that is quickly revealed through the beaming smile on your face.
&lt;&lt;player&gt;&gt;It&#39;s actually lovely, ?Madame. I&#39;m really thankful.&lt;&lt;/player&gt;&gt;
&lt;&lt;velma&gt;&gt;I&#39;m glad you like it. After you first mentioned wanting to pursue this vocation I&#39;ve had correspondence with our mutual benefactor. ?Sybille actually reasoned it might be good for you to have your own room here if you wish to do this kind of work.&lt;&lt;/velma&gt;&gt;
You stare at her quite baffled. ?Sybille already knows you want to work here at the brothel?! ?Velma seems to spot your panic and quickly interjects.
&lt;&lt;velma&gt;&gt;Before you start wondering, she didn&#39;t seem wholly surprised that you want to do this. She showed no animosity for it, in fact, I get the sense she actually encourages it.&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;Ah- uhm- well that is good to hear, I suppose. Perhaps it is good to keep her in the loop, I guess.&lt;&lt;/player&gt;&gt;
&lt;&lt;velma&gt;&gt;I&#39;m sorry, she&#39;s handed you to my care and this is something I am required to report on. Besides, she would find out sooner anyways.&lt;&lt;/velma&gt;&gt;
You look at her and nod, accepting her reasoning. She gives you a caring smile before she turns to open the door again.
&lt;&lt;velma&gt;&gt;Good. Take some time to settle in while ?Eve shows you the ropes. She&#39;ll show you how we handle picking our clients. With that I will leave you for now. Welcome to the team, ?newname.&lt;&lt;/velma&gt;&gt;
?Eve excitedly walks into the room as ?Velma leaves the two of you alone.

&lt;&lt;decision &#39;Listen to ?Eve&#39; &#39;Brothel Eve Intro 4&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="573" name="Brothel Eve Intro 4" tags="" position="350,7225" size="100,100">&lt;&lt;eve&gt;&gt;Oh ?newname, I&#39;m so excited to have you work here with us! We&#39;re going to have such a fun time!&lt;&lt;/eve&gt;&gt;
&lt;&lt;player&gt;&gt;Yes- uhm- I&#39;m also excited... But perhaps a bit nervous as well...&lt;&lt;/player&gt;&gt;
She doesn&#39;t seem surprised by your awkwardness anymore as she moves closer to comfort you. &lt;&lt;if hasTag(&#39;eve-romance&#39;)&gt;&gt;She gives you a warm hug. Being so close to her makes you immediately think of the time you spent together when she was teaching you...&lt;&lt;/if&gt;&gt;
&lt;&lt;eve&gt;&gt;Relax, sweetie! We&#39;ll take things slow, you&#39;re not expected to work tonight, I&#39;m just showing you how it all works!&lt;&lt;/eve&gt;&gt;
She takes a step back and sits down on the bed. Your bed now, actually.
&lt;&lt;eve&gt;&gt;So, crash course prostitution! It&#39;s a good thing I already went through the practical side with you otherwise we&#39;d have a lot to go over tonight!&lt;&lt;/eve&gt;&gt;
You stay quiet and let her continue as you sit down next to her.
&lt;&lt;eve&gt;&gt;First of all, like the ?Madame already mentioned, we are a very refined establishment. What that means is that you don&#39;t have to worry about entertaining anyone you don&#39;t want to spend the night with. At this place, us courtesans pick which clients we want to see, not the other way around.&lt;&lt;/eve&gt;&gt;
She actually seems rather proud while explaining this, you suppose this is part of the reason why she likes working here so much.
&lt;&lt;eve&gt;&gt;Also! All clients are briefed on our house rules beforehand and if any of them do something you are not okay with, simply call me or ?MadameVelma and they will be swiftly evicted!&lt;&lt;/eve&gt;&gt;
&lt;&lt;player&gt;&gt;That actually sounds like a pretty good system...&lt;&lt;/player&gt;&gt;
&lt;&lt;eve&gt;&gt;Exactly! Now, there are two ways you can service customers. The first is quite simple: You can head over to the bathroom and work the gloryhole. Those are really popular so you can always make some money there! You can pick whichever side you want, left or right. I assume you&#39;re already familiar with the system since the ?Madame sent you there to clean, right?&lt;&lt;/eve&gt;&gt;
You blush awkwardly at her directness. How can she be so nonchalant about that? It&#39;s good information but you decide to quickly move on from the subject.
&lt;&lt;player&gt;&gt;Ah- Uhm- Yes, I&#39;ve seen the sign explaining it in the bathrooms... What about the other way to uhm... &lt;em&gt;help&lt;/em&gt; clients?&lt;&lt;/player&gt;&gt;
&lt;&lt;eve&gt;&gt;Oh, yes! That&#39;s the whole reason you got this room, you can host visitors here. Here, I&#39;ll show you how it works, this is actually my favourite part!&lt;&lt;/eve&gt;&gt;
Without skipping a beat, ?Eve excitedly takes your hand again and drags you along. 
&lt;&lt;decision &#39;Get dragged along by ?Eve&#39; &#39;Brothel Eve Intro Corridor Again&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="574" name="Brothel Eve Intro Corridor Again" tags="" position="475,7225" size="100,100">&lt;&lt;setlocation &#39;Corridor&#39;&gt;&gt;
She leads you out of your room and down the long corridor. At the end of this hallway, she turns left, past the fancy looking door. Before you get a chance to ask her about it, she walks towards what seems like a dead-end in a dark corner. ?nl
She opens up a small hatch, hidden in the wall. You see a dim light coming through a small wooden lattice. She pulls you close to her and peeks through the secret window. A peeping hole.?nl
&lt;&lt;eve&gt;&gt;That&#39;s the waiting area. Go on, take a good look around.&lt;&lt;/eve&gt;&gt;

&lt;&lt;decision &#39;Peek through the hatch&#39; &#39;Brothel Eve Intro 5&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="575" name="Brothel Eve Intro 5" tags="" position="600,7225" size="100,100">&lt;&lt;setlocation &#39;Brothel&#39;&gt;&gt;
Through the hatch you see a luxurious lounge area. This must be the foyer of the brothel, which you notice now has it&#39;s own separate entrance from the tavern.?nl
You see all kinds of people lounging while they wait. People are chatting away, kind of like they&#39;re casually conversing at the tavern. Except here it seems like they&#39;re served wine, cheese on crackers and grapes.?nl
What strikes you the most is how common these people look, granted, it seems like there&#39;s a wide variety of folk here but that&#39;s probably what baffles you. You kind of expected a hall filled with perverts. Old men looking to sin. But no, there&#39;s all kinds of people here. Men, women, commoners, even some nobility.
&lt;&lt;eve&gt;&gt;Oh! I think I see a client that you simply &lt;em&gt;must&lt;/em&gt; pick sometime! He&#39;s actually one of my regulars.&lt;&lt;/eve&gt;&gt;
?Eve nudges you to look into a certain direction through the viewing hatch. You&#39;re not really sure who she&#39;s talking about, you take a good look through the crowd until you finally spot who she&#39;s trying to point out.?nl
&lt;&lt;decision &#39;Look where she\&#39;s pointing&#39; &#39;Brothel Eve Intro 6&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="576" name="Brothel Eve Intro 6" tags="" position="725,7225" size="100,100">In a little alcove you now spot him sitting there. ?Leopold, casually drinking some wine while he&#39;s waiting. Seeing him here suddenly has you feeling very anxious. You can &lt;em&gt;not&lt;/em&gt; let him see you here and you can &lt;em&gt;definitely not&lt;/em&gt; take him on as a client tonight.
&lt;&lt;player&gt;&gt;Him? No, uhm- no, I can&#39;t, I&#39;m sorry.&lt;&lt;/player&gt;&gt;
You slowly back off from the peeping hole, making sure he can&#39;t accidentally see you somehow.
&lt;&lt;eve&gt;&gt;Don&#39;t worry, he&#39;s great! He&#39;s actually a royal councillor and occasionally invites me up to the castle. He has this funny thing where he enjoys being &#39;serviced&#39; while he&#39;s pretending to do work.&lt;&lt;/eve&gt;&gt;
&lt;&lt;if hasTag(&#39;leopold-mystery&#39;)&gt;&gt;
    Wait... ?Eve is the one giving blowjobs to ?Leopold at night?! What a weird way to finally figure out that mystery! You immediately want to ask her more about it but you realize that it&#39;s probably not smart to mention that you peeking on them.?nl
&lt;&lt;/if&gt;&gt;
You look at her with a very shocked expression, trying to process the current situation. 
&lt;&lt;eve&gt;&gt;If you&#39;re not into men you could always pick other people, of course! Whenever you come to work you can look through the hatch to see who&#39;s available. There&#39;s a sign-in sheet where they list what they&#39;re looking for. You always have final say in who you spend the night with, that&#39;s how it works here.&lt;&lt;/eve&gt;&gt;
While she&#39;s explaining she closes the hatch again.
&lt;&lt;eve&gt;&gt;I guess that&#39;s everything you need to know about choosing clients. How about we finish up in my room? There&#39;s one more thing I need to show you.&lt;&lt;/eve&gt;&gt;

&lt;&lt;decision &#39;Follow her to her room&#39; &#39;Brothel Eve Intro 7&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="577" name="Brothel Eve Intro 7" tags="" position="850,7225" size="100,100">&lt;&lt;setlocation &#39;Eve\&#39;s Room&#39;&gt;&gt;
You enter her room and even though this isn&#39;t the first time you&#39;re here, you are even more aware of the extravagance of this place simply because of the contrast with your room. You suppose working here can definitely have it&#39;s benefits. 

&lt;&lt;eve&gt;&gt;There&#39;s one more thing part of this little masterclass that I have to show you.&lt;&lt;/eve&gt;&gt;
She walks over to the nightstand next to her bed, opens a drawer and starts rummaging in it.
&lt;&lt;if hasVisited(&#39;Eve Sex Education Physical Bottom&#39;)&gt;&gt;
    &lt;&lt;eve&gt;&gt;You were a wonderful bottom during our introduction course. But... should you wish to practice that more - especially now that you&#39;re preparing for this work - there&#39;s a really easy way to do that...&lt;&lt;/eve&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;eve&gt;&gt;This is probably only useful advice if you&#39;re planning to be on the receiving end when entertaining clients, but there is a tried and tested way to practice these skills...&lt;&lt;/eve&gt;&gt;
&lt;&lt;/if&gt;&gt;
From the nightstand she produces a large sex-toy. In her hand she holds a crystal phallic object, clearly shaped like a penis. The thing is so big she uses two hands to hold it as she presents it to you.

&lt;&lt;img &quot;equipment/dildo_crystal.jpg&quot; null &#39;250px&#39;&gt;&gt;

&lt;&lt;eve&gt;&gt;This here is my favorite. It&#39;s got a wonderful curve to it and the ridges feel wonderful.&lt;&lt;/eve&gt;&gt;

You stare at it with stupid amazement. It&#39;s strange how many times ?Eve has made you speechless this night alone but here you are once again, unsure what to say as you stare at her crystal dildo. &lt;&lt;if hasTag(&#39;eve-romance&#39;) and settings.sph&gt;&gt;If that&#39;s what ?Eve is used to, how could you ever satisfy her with what you&#39;re packing?&lt;&lt;/if&gt;&gt; 

&lt;&lt;player&gt;&gt;That&#39;s... quite something...&lt;&lt;/player&gt;&gt;

&lt;&lt;eve&gt;&gt;I know, right! I really love it! Don&#39;t worry, this is probably a bit bigger than what you can handle but that is why I am showing you this. If you desire to be a better bottom, you will need to practice!&lt;&lt;/eve&gt;&gt;

She starts freely swinging the dildo around while she&#39;s excitedly talking about it.

&lt;&lt;eve&gt;&gt;If you want to get your own, you should visit the blacksmith in town, ?Beau. She sells all kinds of cool stuff - like these dildos - that she makes herself in the smithy. She even enchants them to make them feel more realistic, isn&#39;t that awesome!&lt;&lt;/eve&gt;&gt;

&lt;&lt;decision &#39;Respond with interest&#39; depravity small&gt;&gt;
    &lt;&lt;player&gt;&gt;?Beau sells sex-toys? I had no idea... I should... probably check that out, yeah...&lt;&lt;/player&gt;&gt;
    &lt;&lt;eve&gt;&gt;Yay! You definitely should! She has a biiig selection to pick from and some nice sizes for you to get started with!&lt;&lt;/eve&gt;&gt;
    Talking about buying dildo&#39;s has you feeling your usual awkward again.
    &lt;&lt;player&gt;&gt;That sounds pretty uh- interesting, yes.&lt;&lt;/player&gt;&gt;

    &lt;&lt;include &#39;Brothel Eve Intro Ending&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Tell her you\&#39;re not really interested in that&#39;&gt;&gt;
    &lt;&lt;player&gt;&gt;Uhm- Thank you for showing me this, ?Eve. But I don&#39;t think I&#39;m really interested in that.&lt;&lt;/player&gt;&gt;
    &lt;&lt;eve&gt;&gt;Oh I&#39;m sorry! That&#39;s totally fine! Just wanted to tell you about the secret sex-toy shop ?Beau is running, you can get all sorts of things there.&lt;&lt;/eve&gt;&gt;
    &lt;&lt;player&gt;&gt;That&#39;s good to know, it&#39;s definitely surprising, I had no idea ?Beau was doing something like that...&lt;&lt;/player&gt;&gt;

    &lt;&lt;include &#39;Brothel Eve Intro Ending&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="578" name="Brothel Eve Intro Ending" tags="" position="975,7225" size="100,100">She stows the dildo back in it&#39;s hiding spot before she continues.
&lt;&lt;eve&gt;&gt;Awesome, with that settled I think that makes you completely ready for working here! You&#39;ve been a wonderful student today, ?newname!&lt;&lt;/eve&gt;&gt;
She takes a moment to give you a deep hug.
&lt;&lt;player&gt;&gt;Thanks, ?Eve! It&#39;s actually been really informative. I guess I&#39;ll be back to do some work another time.&lt;&lt;/player&gt;&gt;
&lt;&lt;eve&gt;&gt;You bet! I&#39;ve spent all this time training you now so you better come back to put in some actual work!&lt;&lt;/eve&gt;&gt;
Her playful tone is cute as ever.
&lt;&lt;if hasTag(&#39;eve-romance&#39;)&gt;&gt;
    As you turn to leave, ?Eve suddenly catches you off guard as she plants a soft kiss on your cheek, instantly making you blush.
    &lt;&lt;eve&gt;&gt;If you need any more... &lt;em&gt;private lessons&lt;/em&gt;, feel free to come by.&lt;&lt;/eve&gt;&gt;
    You stammer out a reply.
    &lt;&lt;player&gt;&gt;Uh- Y- yes, that would be nice...&lt;&lt;/player&gt;&gt;
    She affectionately chuckles at your awkwardness and gives you another hug before you take your leave.
&lt;&lt;else&gt;&gt;
    You wave her goodbye as you make your way outside.
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Leave the tavern&#39; &#39;Brothel Eve Intro 9&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="579" name="Brothel Eve Intro 9" tags="" position="1100,7225" size="100,100">&lt;&lt;setlocation &#39;Road&#39;&gt;&gt;
You step out of the tavern and into the dark night. You&#39;re walking down the road and find your head buzzing with thoughts about the events of this evening. Are you actually going to be working at a brothel now??nl
Before you start spiralling about your decision-making again you put those worrying thoughts aside and focus on the fun side of it. Though this is probably not something that will be written about in a history book, it&#39;s definitely an adventure that you&#39;re on and you actually have a much more eventful life because of this!?nl
With those sort-of comforting thoughts you casually make your way back to the castle.

&lt;&lt;decision &#39;Go to bed&#39; &#39;Bedtime&#39;&gt;&gt;
    &lt;&lt;startquest &#39;blacksmith-intro&#39;&gt;&gt;
    &lt;&lt;completequest brothel-intro&gt;&gt;
    &lt;&lt;unlocklocation &#39;Boarding Room&#39;&gt;&gt;
    &lt;&lt;unlocklocation &#39;Brothel&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="580" name="Brothel Work" tags="" position="1225,7225" size="100,100">&lt;&lt;setlocation &#39;Boarding Room&#39;&gt;&gt;
You head over to your room to prepare yourself for the work tonight. Now what are you thinking of doing this fine evening, full of lustful opportunities?

&lt;&lt;decision &#39;Training time with toys&#39; &#39;Brothel Work Training&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Pick a client to entertain in your room&#39; &#39;Brothel Work Client&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Work the gloryholes&#39; &#39;Brothel Work Gloryhole&#39;&gt;&gt;
    &lt;&lt;disableif true&gt;&gt;
        Coming soon!
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Change your mind&#39; &#39;Tavern&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="581" name="Brothel Work Training" tags="" position="100,7350" size="100,100">You lie down on your bed and excitedly open your nightstand drawer.

&lt;&lt;toys&gt;&gt;

&lt;&lt;decision &#39;Change your mind&#39; &#39;Tavern&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="582" name="Brothel Work Gloryhole" tags="" position="225,7350" size="100,100"></tw-passagedata><tw-passagedata pid="583" name="Brothel Work Client" tags="" position="350,7350" size="100,100">&lt;&lt;setlocation &#39;Corridor&#39;&gt;&gt;
You see ?Eve standing in the hallway of the boarding rooms and smiles at you as you walk up to her.
&lt;&lt;eve&gt;&gt;Hey, ?newname! Are you ready for a shift of fun activities?&lt;&lt;/eve&gt;&gt;
She gives you a quick eyebrow raise as she&#39;s basically shouting your intentions for coming here through the hallway, making you blush. You nod at her, still feeling completely awkward about the kind of work you&#39;re here to do.

&lt;&lt;eve&gt;&gt;Awesome! We&#39;ve got lots of clients waiting for attention tonight. As always it&#39;s up to you to choose who you want to take on. Here, I&#39;ll walk you to the waiting room.&lt;&lt;/eve&gt;&gt;

Both of you walk over to the foyer area of the brothel proper. ?Eve opens a small latticed window to let you peek at the waiting clients. 

&lt;&lt;decision &#39;Choose a client&#39; &#39;Brothel Work Selection&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="584" name="Brothel Work Selection" tags="" position="475,7350" size="100,100">&lt;&lt;setlocation &#39;Brothel&#39;&gt;&gt;
&lt;&lt;eve&gt;&gt;You just let me know who you want and I&#39;ll send them over to your room.&lt;&lt;/eve&gt;&gt;

You take a good look at the people lounging while they wait to be seen. There&#39;s quite a selection tonight.

&lt;&lt;set $paycheck = 10&gt;&gt;

&lt;&lt;decision &#39;A posh noblewoman, looking to spend time with a commoner&#39; &#39;Brothel Work Noblewoman&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;A burly lumberjack, looking to be dommed&#39; &#39;Brothel Work Lumberjack&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;A rugged bandit, looking to (politely) make use of you&#39; &#39;Brothel Work Bandit&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;A famous bard, looking for a gay ol\&#39; time&#39; &#39;Brothel Work Merry&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="585" name="Brothel Work End" tags="" position="600,7350" size="100,100">&lt;&lt;setlocation &#39;Tavern&#39;&gt;&gt;
&lt;&lt;addcounter &#39;eve-tavern&#39; 1&gt;&gt;
Luckily, after this eventful shift, you are quickly left alone in your room, giving you a moment to recover from what happened.?nl

You take a moment to count the money left by your client, making a total of &lt;&lt;money gold false $paycheck&gt;&gt; gold for your hard work!?nl

Even though you have your own room here, you still feel totally uncomfortable actually spending the night here. What if someone came to your castle quarters in the morning and found you missing? You couldn&#39;t handle the total lock-down they would put you in once they find you... Yes, it&#39;s best to simply sneak back to the castle now and sleep in your royal bed.

&lt;&lt;changemoney gold $paycheck&gt;&gt;

&lt;&lt;decision &#39;Head in for the night&#39; &#39;Bedtime&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="586" name="Brothel Work Noblewoman" tags="spicy" position="725,7350" size="100,100">&lt;&lt;setlocation &#39;Boarding Room&#39;&gt;&gt;
&lt;&lt;set _tip = 5&gt;&gt;
&lt;&lt;set $paycheck += _tip&gt;&gt;

Just as you&#39;ve finished preparing yourself you hear a knock on your door. You open the door and take a step back.?nl
Your client, a noblewoman, slowly walks into your room. You give her a small bow, welcoming her without a word as you close the door behind her.?nl
She&#39;s wearing a beautifully intricate dress, white adorned with yellow and purple flowers. On her head, she has donned a small hat, exactly matching the colors of her outfit. This woman definitely enjoys showing off her upper class status.?nl
She stands in the middle of the room as she takes a good look around the place. You recognize her from that time you met her in the tavern and she was looking for company with common folk, the exact thing what she&#39;s looking for now. She finishes her inspection by turning her gaze to you and looking you up and down. There is an intense silence in the room as you feel her eyes watching you from head to toe. You stand there, silently waiting to see what she does next.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;My my, what a small dirty room. I suppose that makes sense for such a lowly peasant ?man like yourself...&lt;&lt;/say&gt;&gt;

She has a sly smile on her face and raises her eyebrows as she talks to you like you&#39;re a commoner. You get the sense that she wants you to just go along with it. You try to get in your role for this, it still feels ironic how she&#39;s asking this roleplaying from the person who is probably furthest from a peasant in the entire kingdom.

&lt;&lt;player&gt;&gt;Uhm- Yes, I&#39;m sorry the accommodation is not what you&#39;re accustomed to, my lady. I am just a poor commoner after all...&lt;&lt;/player&gt;&gt;

You&#39;re pretty sure that sounded absolutely unbelievable, but strangely enough it seems to work on her as she slowly sits down in the chair with a big grin on her face.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;I must say, it&#39;s wonderful to see you working here now, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;lovely girl&lt;&lt;else&gt;&gt;handsome boy&lt;&lt;/if&gt;&gt;. I look back fondly to your service at the tavern...&lt;&lt;if hasVisited(&#39;Tavern Work Event Noblewoman Oral&#39;)&gt;&gt; Especially round the back...&lt;&lt;/if&gt;&gt;&lt;&lt;/say&gt;&gt;

You blush at her remark and respond, trying to stay in your role.

&lt;&lt;player&gt;&gt;Thank you, my lady. I will serve you any way I can...&lt;&lt;/player&gt;&gt;

She smiles at you and then takes another look around the room you quickly get the sense an idea forms in her head.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Well, my good servant, I see a dirty rag over there, why don&#39;t you grab it and start scrubbing this dirty floor? It&#39;s could really use a good cleaning...&lt;&lt;/say&gt;&gt;

She points to a rag you have hanging on a little hook next to the wardrobe. It doesn&#39;t actually look dirty at all but you suppose she just likes emphasizing that detail for dramatics.?nl 
Though you&#39;re not entirely sure what you&#39;re doing, you go along with her suggestion, grab the towel and kneel down to start cleaning the floor. She indicates that she would like you to clean close to where she&#39;s sitting so you naturally oblige.
&lt;&lt;player&gt;&gt;Of course, my lady. I&#39;ll get this all proper and clean for you.&lt;&lt;/player&gt;&gt;
You try to channel your inner ?Rosa and immediately feel bad the moment you realize that&#39;s what you&#39;re doing. You also quickly realize there&#39;s not much point to cleaning this with a dry towel as you&#39;re basically just rubbing the wooden floor.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Yes, very good... What dirty hands you have, peasant... Why don&#39;t you come over here and clean my feet for me?&lt;&lt;/say&gt;&gt;

You look up at her as you&#39;re in the middle of pretending to do cleaning and give her a questioning look. You quickly snap out of it and decide to simply go along with it.

&lt;&lt;player&gt;&gt;Uh- naturally, my lady. I&#39;ll make sure your feet are nice and clean.&lt;&lt;/player&gt;&gt;

You stay kneeled and scoot closer to her as she removed her foot from her heels, lifting it in your direction. You try to sensually grab it and start massaging it with the towel.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Oh my, what a dirty rag you&#39;re using on my pristine feet... If that&#39;s how you wish to clean them, servant...&lt;&lt;/say&gt;&gt;

You are here now so might as well continue. You take the towel and caress both her feet diligently. It feels like this is doing very little, you&#39;re not actually cleaning nor dirtying her feet, just rubbing a rag over it.?nl

The whole thing feels very silly to you but as you look up you notice it has a completely different effect on her. She has lifted the skirt of her dress and slipped a hand under there, playing with herself as she&#39;s watching you. She seems to not be wearing any underwear and from this position you have a direct view of her exposed vulva as she&#39;s softly playing with her clit. It looks like she&#39;s soaking wet from this already.?nl

Looking at this entirely distracts you from your role as you&#39;re now experiencing the first thing that&#39;s actually turning &lt;em&gt;you&lt;/em&gt; on during this whole interaction.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Ah... Why have you stopped, my &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;pretty&lt;&lt;else&gt;&gt;dashing&lt;&lt;/if&gt;&gt; little commoner? Is it because you see something you&#39;d rather be cleaning instead? Oh that would be so dirty... You&#39;d have to use your fingers though...&lt;&lt;/say&gt;&gt;

Though the way she speak still very silly, this command you actually really want to do. You drop the rag on the floor and reach over, slowly caressing her thighs and move upwards to help her.

&lt;&lt;player&gt;&gt;Of course, my lady. Your wish is my command. Allow me to help you with that.&lt;&lt;/player&gt;&gt;

She&#39;s actually panting heavily in the chair as she leans back and removes her own hand, allowing you to take over for her.?nl

You start with slowly caressing her folds with one hand, moving your fingers up and down the length of her glistening vulva. You sensually make your way to the location that she was playing with herself, her exposed clit feels intensely aroused as you start to massage it with care.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Oh yes, you dirty peasant! Flick my bean with your calloused commoner fingers! Stick a dirty finger in my snatch!&lt;&lt;/say&gt;&gt;

You immediately do as she says and use your other hand to start pushing a finger inside of her. She moans loudly as you penetrate her and slowly start fingering her. You look up as she makes eye contact with you, her face full of pleasure.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Ah yes... Keep going... Just like that, you dirty ?man...&lt;&lt;/say&gt;&gt;

You find the right rhythm and finger her with intense passion. She starts moaning louder and louder as you continue to hold the exact same pace, not slowing down or speeding up much at all, this seems to get her going the most.?nl

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Oh f- fuck! I&#39;m coming! I&#39;m coming at the hands of some dirty commoner! Ah!&lt;&lt;/say&gt;&gt;

It doesn&#39;t take long at all before you have her moaning as loud as you think she possibly can. She arches her back in the chair and actually lifts herself up from as she about to experience an intense climax. You try to keep fingering pussy during her erratic movement but accidentally slip out as she orgasms.?nl 
You&#39;re about to receive the full benefits of having front-row seats at a water show as you witness her fluids squirt out from her genitals, launching all over your face, covering you. She lets out a final moan, louder than ever and strangely similar to those exotic dolphins.?nl
The moment her crescendo has passed, she flops back down in the chair with a satisfied sigh. You grab the towel from the floor and start cleaning your face, drenched in her wetness.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Pff.. My my, you were quite something...&lt;&lt;/say&gt;&gt;

She takes a moment to calm down while you clean yourself before you see her casually stand up and fix her dress, getting ready to leave.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Definitely your money&#39;s worth, I must visit you again sometime my lovely peasant.&lt;&lt;/say&gt;&gt;

&lt;&lt;player&gt;&gt;Thank you, I am glad you enjoyed it.&lt;&lt;/player&gt;&gt;

You give her a respectful bow and she hands you a small pouch of coins, looks like she gave you a tip of &lt;&lt;money gold false `_tip`&gt;&gt; gold.

She gives a formal bow back to you, not a deep one because you are a commoner to her. She opens the door to your room and leaves you alone as you hear the sound of her high heels clacking down the corridor.?nl

What a strange lady. Job well done, you suppose though.

&lt;&lt;decision &#39;Finish for the night&#39; &#39;Brothel Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="587" name="Brothel Work Lumberjack" tags="spicy" position="850,7350" size="100,100">&lt;&lt;setlocation &#39;Boarding Room&#39;&gt;&gt;
&lt;&lt;set _tip = 10&gt;&gt;
&lt;&lt;set $paycheck += _tip&gt;&gt;

You hear a knock on your door. When you go to answer it, you see a large, burly man with a bushy beard standing in front of you. 

&lt;&lt;if hasTag(&#39;lumberjack-peeped&#39;) and hasTag(&#39;lumberjack-waterfall&#39;)&gt;&gt;
    With a jolt, you realize that this is ?Jack, the woodcutter you not only met at the waterfall, but also saw in ?Sybille&#39;s dungeon. You see a flicker of recognition in his eyes, and he gives you a friendly smile.
&lt;&lt;elseif hasTag(&#39;lumberjack-waterfall&#39;)&gt;&gt;
    With a jolt, you realize this is ?Jack, the woodcutter you met by the waterfall. You see a flicker of recognition in his eyes, and he gives you a friendly smile. 
&lt;&lt;elseif hasTag(&#39;lumberjack-peeped&#39;)&gt;&gt;
    With a jolt, you recognize this man to be the woodcutter you saw in ?Sybille&#39;s dungeon. He doesn&#39;t seem to recognize you, though he does give you a friendly smile.
&lt;&lt;else&gt;&gt;
    You don&#39;t think you&#39;ve seen him before, but he gives you a friendly smile.
&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Welcome, come on in.&lt;&lt;/player&gt;&gt;

You stand aside awkwardly as he walks into the room, looking at you expectantly.

&lt;&lt;jack&gt;&gt;Thank you for choosing me today, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;mistress&lt;&lt;else&gt;&gt;master&lt;&lt;/if&gt;&gt;.&lt;&lt;/jack&gt;&gt;

It feels strange to be called &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;mistress&lt;&lt;else&gt;&gt;master&lt;&lt;/if&gt;&gt;, but you suppose that this is your job now, and you did choose someone who wanted to be dominated. You figure you should embrace the role. &lt;&lt;if hasTag(&#39;lumberjack-peeped&#39;)&gt;&gt;Luckily you already have an idea of what he likes.&lt;&lt;/if&gt;&gt; 

&lt;&lt;player&gt;&gt;Uh, yes, I expect you to...do exactly as I say.&lt;&lt;/player&gt;&gt;

&lt;&lt;jack&gt;&gt;Yes, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;mistress&lt;&lt;else&gt;&gt;master&lt;&lt;/if&gt;&gt;. What do you wish for me to do?&lt;&lt;/jack&gt;&gt;

You look at him, &lt;&lt;if hasTag(&#39;lumberjack-peeped&#39;)&gt;&gt;trying to think of what ?Sybille would say.&lt;&lt;else&gt;&gt;trying to think of what someone in a dominant role would say.&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Take your clothes off.&lt;&lt;/player&gt;&gt;

He immediately complies and begins to strip off his clothes hurriedly. As he removes his garments, he reveals rippling muscles and his large cock, already hardening in his excitement. 

&lt;&lt;jack&gt;&gt;What must I do next, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;mistress&lt;&lt;else&gt;&gt;master&lt;&lt;/if&gt;&gt;?&lt;&lt;/jack&gt;&gt;

You&#39;re starting to kind of enjoy commanding him like this, and you feel your own arousal starting to creep in as you look at his muscled body.

&lt;&lt;player&gt;&gt;Get on the bed.&lt;&lt;/player&gt;&gt;

He sits on the bed, looking at you for the next command.

&lt;&lt;player&gt;&gt;No, not like that. Get on your, um, knees.&lt;&lt;/player&gt;&gt;

He quickly gets onto his hands and knees, revealing a pert asshole tucked between two muscled buttocks. Starting to get into the role now, you run a hand along his back and up to his face, which you gently turn to face you. He whimpers quietly, and you see his cock twitch, hanging hard and thick between his legs.

&lt;&lt;player&gt;&gt;How will you serve me today? Will your &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;mistress&lt;&lt;else&gt;&gt;master&lt;&lt;/if&gt;&gt; enjoy your mouth, or your ass?&lt;&lt;/player&gt;&gt;

&lt;&lt;jack&gt;&gt;Whatever my &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;mistress&lt;&lt;else&gt;&gt;master&lt;&lt;/if&gt;&gt; desires, I am at your whim...&lt;&lt;/jack&gt;&gt;

Luckily, something about being totally in charge is starting to get you very excited, and you feel your own ?dick hard in your undergarments. You climb onto the bed and &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;raise your dress&lt;&lt;else&gt;&gt;lower your trousers&lt;&lt;/if&gt;&gt;, revealing your hard ?dick to him.?nl

&lt;&lt;if settings.sph&gt;&gt;
    He looks up and sees your tiny dick. You feel suddenly awkward, playing a dominant role with such a small penis, but to your surprise your tiny member seems to only make him more excited.

    &lt;&lt;jack&gt;&gt;Oh, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;mistress&lt;&lt;else&gt;&gt;master&lt;&lt;/if&gt;&gt;... I am honored to submit to you...&lt;&lt;/jack&gt;&gt;

    You briefly wonder whether being dominated by someone with such a small penis somehow makes this more attractive to him, but the will of your ?dick takes over your thoughts.?nl
&lt;&lt;/if&gt;&gt;

Feeling quite turned on now, you rub the end of your ?dick along his cheek. He moans softly, looking up at you obediently. He opens his mouth expectantly, and you slowly insert your ?dick inside. The warm wetness envelops your ?dick and you hear yourself let out a quiet moan as well. Suddenly you remember that he likes being told what to do.

&lt;&lt;player&gt;&gt;Go on, suck me off.&lt;&lt;/player&gt;&gt;

Eagerly, he begins to suck you off, &lt;&lt;if settings.sph&gt;&gt;easily fitting your entire ?dick in his mouth&lt;&lt;else&gt;&gt;taking your ?dick impressively far into his throat&lt;&lt;/if&gt;&gt;. You place a hand on his head and guide his movements as he bobs on your ?dick, his own moans melding with yours. He seems to really enjoy being under your control.

&lt;&lt;player&gt;&gt;Mmmf, fuck, that&#39;s good... Keep going...&lt;&lt;/player&gt;&gt;

He continues bobbing enthusiastically on your ?dick, and as he does, you enjoy the view of his strong body moving compliantly to give you pleasure. Soon the pleasure starts to build to a peak.

&lt;&lt;player&gt;&gt;Stop. I want to enjoy your ass, too.&lt;&lt;/player&gt;&gt;

He immediately stops moving, looking up at you with your ?dick stuffed in his mouth. You pull yourself out of his mouth with a wet sound and circle around him, lining yourself up with his asshole. You retrieve a lubrication potion from the bedside table and rub it onto your ?dick, then generously apply some to his entrance. He whimpers in pleasure.

&lt;&lt;jack&gt;&gt;Oh, yes, take me, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;mistress&lt;&lt;else&gt;&gt;master&lt;&lt;/if&gt;&gt;...&lt;&lt;/jack&gt;&gt;

He clearly has experience with this, as he is already visibly relaxing himself for you to enter him. It doesn&#39;t seem like he needs a lot of warmup, so you maneuver yourself to his hole and slowly start to push inside of him. As you enter his ass, he lets out a rapturous moan and you feel a blissfully tight embrace on the head of your ?dick.

&lt;&lt;player&gt;&gt;Ahh, fuck, your ass feels amazing...&lt;&lt;/player&gt;&gt;

&lt;&lt;if settings.sph&gt;&gt;
    You can&#39;t really go any deeper than this, but after pausing for a moment to allow him to relax, you start to thrust as much as you can into his ass.
&lt;&lt;else&gt;&gt;
    You pause there for a moment, allowing him to relax, before starting to thrust properly into his ass.  
&lt;&lt;/if&gt;&gt;

Pushing into him feels amazing, and you let out a low moan. You grab his tight asscheeks and use them to pull yourself onto him, eliciting sounds of pleasure from him as he takes you in. At some point you even forget the premise of this interaction, and loose yourself in the heavenly feeling of fucking this big, burly man exactly how you want.

&lt;&lt;jack&gt;&gt;Fuck yes...&lt;&lt;/jack&gt;&gt;

&lt;&lt;if settings.sph&gt;&gt;
    It&#39;s hard to get a real rhythm going with such a small dick, but you do your best, and soon the stimulation on the head of your cock is starting to build toward a peak. 
&lt;&lt;else&gt;&gt;
    You&#39;re pounding into his ass now, enjoying the way his hole has stretched to accommodate your ?dick as you thrust into him over and over. The pleasure is becoming overwhelming, and you can feel yourself reaching your peak.
&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Fuck, I&#39;m going to fill you up...&lt;&lt;/player&gt;&gt;

You thrust a few final times as you spill inside his ass, your cum shooting deep inside him as waves of pleasure move over your body. He moans as you fill him up, but does not touch his own raging erection. You realize he&#39;s probably waiting for an instruction from you.

&lt;&lt;player&gt;&gt;Touch yourself. I want you to cum.&lt;&lt;/player&gt;&gt;

You watch as he eagerly wraps a large hand around his cock and begins to masturbate himself with you still inside him, your ?dick slowly beginning to soften after your orgasm. It only takes a few moments before he orgasms, his cum shooting across the bed as he moans loudly. When he&#39;s finished, you pull out of him slowly and tuck your ?dick back into your clothes.

&lt;&lt;jack&gt;&gt;Oh, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;mistress&lt;&lt;else&gt;&gt;master&lt;&lt;/if&gt;&gt;, thank you so much for your attentions today.&lt;&lt;/jack&gt;&gt;

It seems as though he still wants to be commanded. You look to his clothes on the floor.

&lt;&lt;player&gt;&gt;You are welcome. Now, get dressed and leave me.&lt;&lt;/player&gt;&gt;

&lt;&lt;jack&gt;&gt;Yes, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;mistress&lt;&lt;else&gt;&gt;master&lt;&lt;/if&gt;&gt;. Thank you, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;mistress&lt;&lt;else&gt;&gt;master&lt;&lt;/if&gt;&gt;.&lt;&lt;/jack&gt;&gt;

He quickly re-dresses and leaves the room after handing you your fee of &lt;&lt;money gold false `_tip`&gt;&gt; gold, a large smile across his face as he goes. It seems as though he was very satisfied with the experience, even if it took you some time to get into your role.

&lt;&lt;decision &#39;Finish for the night&#39; &#39;Brothel Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="588" name="Brothel Work Bandit" tags="spicy" position="975,7350" size="100,100">&lt;&lt;setlocation &#39;Boarding Room&#39;&gt;&gt;
&lt;&lt;set _tip = 15&gt;&gt;
&lt;&lt;set $paycheck += _tip&gt;&gt;

You&#39;ve just finished preparing when you hear a knock at your door. You go to answer it, and see a familiar rugged man standing in front of you. This is the bandit you met in the forest. Seeing you, he grins.

&lt;&lt;bandit&gt;&gt;Oh, hello again. You work here?&lt;&lt;/bandit&gt;&gt;

&lt;&lt;player&gt;&gt;Uh, yes, I do. Come in.&lt;&lt;/player&gt;&gt;

He walks into the room, obviously looking you up and down. Amazingly, you can see through the fabric of his pants that he already seems to be getting an erection.

&lt;&lt;bandit&gt;&gt;I have a little problem I&#39;m hoping you can help me with...&lt;&lt;/bandit&gt;&gt;

You see him indicate his crotch. He seems to enjoy referring to his erections as &quot;problems,&quot; which you suppose they probably are, considering how fast he seems to get them.

&lt;&lt;bandit&gt;&gt;I only have one request...I want to use you. You know, sexually...if that would be okay with you...&lt;&lt;/bandit&gt;&gt;

You almost have to laugh at this oddly polite request.

&lt;&lt;player&gt;&gt;Of course, sir. That is my role here.&lt;&lt;/player&gt;&gt;

He seems almost excited as you say this, and you swear you see his cock twitch inside his now-tented trousers. He slowly approaches you and begins to undress you, taking in your naked body with a lustful expression on his face.

&lt;&lt;bandit&gt;&gt;I like to be a bit rough, if that would be alright...&lt;&lt;/bandit&gt;&gt;

&lt;&lt;player&gt;&gt;Yes, of course...&lt;&lt;/player&gt;&gt;

He grins and pushes you down onto the bed, standing above you as he pulls his now raging hard erection free. He hits your cheek repeatedly with his cock, making a soft slapping sound. You part your just lips slightly, and without any further pretense he stuffs his penis inside your mouth.?nl

You begin to suck on his dick. It&#39;s big enough that it nearly fills your entire mouth, and you&#39;re having difficulty taking it in all the way. 

&lt;&lt;bandit&gt;&gt;You like my big cock, huh?&lt;&lt;/bandit&gt;&gt;

You try to make a sound of agreement, but it comes out quite muffled due to all the cock in the way. You continue sucking, looking up at him as you do. He seems to enjoy it, but you get the sense that he wants to be a bit more in control.

&lt;&lt;bandit&gt;&gt;Would it be okay if I face-fucked you?&lt;&lt;/bandit&gt;&gt;

You again make a sound of agreement. He grins, placing both hands on the back of your head, and holds you still while he fucks your mouth. He sighs in pleasure as he stuffs his cock deep into your throat, and you do your best to simply receive it.

&lt;&lt;bandit&gt;&gt;Oh, fuck, that&#39;s good...&lt;&lt;/bandit&gt;&gt;

He&#39;s now ramming his cock down your throat, moaning loudly as he holds your head in place with his muscled arms. Something about being used like this is turning you on, and you feel your own ?dick &lt;&lt;if isInChastity()&gt;&gt;straining against its cage&lt;&lt;else&gt;&gt;steadily growing&lt;&lt;/if&gt;&gt;.

&lt;&lt;bandit&gt;&gt;Ah, fuck... Would it also be alright if I fucked your ass? Hard?&lt;&lt;/bandit&gt;&gt;

You nod in a agreement. As soon as you do, he pulls his cock out of your mouth and roughly flips you over on the bed, exposing your naked ass to him. You hear him applying lubricating potion to himself, and feel a slippery finger push gently yet firmly through your asshole. You focus on relaxing, and after a few moments of preparing you he pushes his cock inside you.

&lt;&lt;bandit&gt;&gt;Mmph, your ass is good...&lt;&lt;/bandit&gt;&gt;

He starts with some gentle thrusts, giving you time to adjust to having his massive cock in your ass. Quickly, however, he ramps up his speed. It isn&#39;t long before you feel his strong hands grip around your waist, pulling your body onto his cock as he thrusts into you hard.?nl

He seems to really enjoy using you. You figure you might as well play into the fantasy.

&lt;&lt;player&gt;&gt;Use me like your little fuck toy...&lt;&lt;/player&gt;&gt;

You can almost feel his cock grow even harder as you say this, and all you can do is relax into the experience as he pulls your body roughly onto his raging cock.

&lt;&lt;bandit&gt;&gt;Fuck, fuck, is it alright if I cum inside you?&lt;&lt;/bandit&gt;&gt;

You nod and feel a moment later the waves of pleasure roll over him as he spills his cum deep in your ass, moaning loudly as he does. &lt;&lt;if isInChastity()&gt;&gt;You wish you could finish yourself off, too, but you&#39;ll have to live vicariously through him.&lt;&lt;else&gt;&gt;You&#39;re too turned on by this point to ignore yourself, so you wrap a hand around your own ?dick and quickly bring yourself to orgasm too.&lt;&lt;/if&gt;&gt;?nl

There are some moments of silence as &lt;&lt;if isInChastity()&gt;&gt;he comes down from his orgasm and withdraws&lt;&lt;else&gt;&gt;you both come down from your orgasms and he withdraws&lt;&lt;/if&gt;&gt; his softening cock gently out of your ass, pulling his trousers back up. You roll over and look up at him from the bed.

&lt;&lt;bandit&gt;&gt;Wow. That was...incredible. Thank you.&lt;&lt;/bandit&gt;&gt;

&lt;&lt;player&gt;&gt;You&#39;re, uh, welcome...&lt;&lt;/player&gt;&gt;

He grins at you, hands you &lt;&lt;money gold false `_tip`&gt;&gt;, and turns to leave.

&lt;&lt;bandit&gt;&gt;Maybe I&#39;ll...see you again sometime...&lt;&lt;/bandit&gt;&gt;

He ducks out of the room. As you watch him go, you can&#39;t help but ponder what a strange man he is.

&lt;&lt;decision &#39;Finish for the night&#39; &#39;Brothel Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="589" name="Brothel Work Merry" tags="spicy" position="1100,7350" size="100,100">&lt;&lt;setlocation &#39;Boarding Room&#39;&gt;&gt;
&lt;&lt;set _tip = 10&gt;&gt;
&lt;&lt;set $paycheck += _tip&gt;&gt;

You answer the door to see a gorgeous man. Dark, shining curls fall across his handsome face and he wears a delicate purple robe that reveals a flirtatious glimpse of his chest. He gives you a genuine smile, and you can&#39;t help but notice how his vibrant green eyes are perfectly accentuated by the makeup he has applied around them. &lt;&lt;if hasVisited(&#39;Orson Date 2 Enter Tavern&#39;)&gt;&gt;You recognize this as ?Merry, the beautiful bard you saw perform at the tavern.&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Well, hello, there. Come on in.&lt;&lt;/player&gt;&gt;

He walks into the room, looking around with curiosity. He seems to be completely comfortable in the space, as though this he is simply visiting an old friend. &lt;&lt;if hasVisited(&#39;Orson Date 2 Back Room&#39;)&gt;&gt;You suppose he must recognize you from when you visited him in the back room at the tavern.&lt;&lt;/if&gt;&gt;

&lt;&lt;merry&gt;&gt;You look absolutely beautiful today, friend.&lt;&lt;/merry&gt;&gt;

You see him looking you up and down with an obvious lustful expression on his face. He seems so genuine in his compliment that you feel a light blush rising on your cheeks.

&lt;&lt;player&gt;&gt;I-I mean, &lt;&lt;if hasVisited(&#39;Orson Date 2 Back Room&#39;)&gt;&gt;so do you, ?Merry.&lt;&lt;else&gt;&gt;so do you, good sir.&lt;&lt;/if&gt;&gt;&lt;&lt;/player&gt;&gt;

He seems to be waiting for you to make the first move, so you approach him slowly and play idly with the collar of his robe. It appears tied loosely enough that you might be able to tug it open in a single movement.

&lt;&lt;player&gt;&gt;What is it you&#39;re looking for today?&lt;&lt;/player&gt;&gt;

?Merry smiles at you, undoing the tie. His robe drapes open, casually revealing his hardening cock.

&lt;&lt;merry&gt;&gt;A little give, a little take. I&#39;d love for us to start with you putting your beautiful mouth to good use...&lt;&lt;/merry&gt;&gt;

You run your hand down his chest and carress his thickening penis with the barest touch.

&lt;&lt;player&gt;&gt;I would be happy to help with that.&lt;&lt;/player&gt;&gt;

As gracefully as you can, you remove your own clothes and get on your knees in front of ?Merry. You look up at him, making eye contact as you kiss along his thigh, working toward his erection. After giving him some moments to get accustomed to your touch, you wrap your mouth around the head of his cock.?nl

He sighs with pleasure as you take him in your mouth, starting shallow at first and moving ever deeper. You wrap a hand around the base of the shaft, stimulating him in time with the movements of your mouth.

&lt;&lt;merry&gt;&gt;Oh, wow, you&#39;re good at that.&lt;&lt;/merry&gt;&gt;

You keep looking up at him as you stuff his cock in your mouth. Even while you&#39;re sucking him off he seems utterly relaxed, simply happy to be here with you in this moment. He even has an enraptured smile on his face.?nl

You lose track of time bobbing on his dick, enjoying the challenge of relaxing yourself to take him deeper inside your mouth and discovering new ways of using your tongue to stimulate him. Eventually he places a hand gently on your shoulder, and looks towards the bed.

&lt;&lt;merry&gt;&gt;I think we&#39;ll need to switch it up now, my friend, or you may bring me to that pleasurable peak before I get to feel you inside me.&lt;&lt;/merry&gt;&gt;

Your ?dick throbs in anticipation as you stand and follow him toward the bed. He spreads out luxuriously on his back, raising his legs to present his ass to you. &lt;&lt;if settings.sph&gt;&gt;You look down at your own hard ?dick, its small length making you doubtful about your ability to penetrate him pleasurably.&lt;&lt;else&gt;&gt;You look down at your own ?dick, hard in anticipation of entering this gorgeous man.&lt;&lt;/if&gt;&gt; Quickly, you rub lubrication potion onto yourself and him, and after some moments of preparation, line yourself up with his entrance.?nl

You push the head of your ?dick through his hole, enjoying the sigh it elicits from him. You pause a moment, then slowly build up your movements as you &lt;&lt;if settings.sph&gt;&gt;do your best to push into him with your short length.&lt;&lt;else&gt;&gt;push into him.&lt;&lt;/if&gt;&gt;

&lt;&lt;if hasVisited(&#39;Orson Date 2 Back Room&#39;)&gt;&gt;
    &lt;&lt;player&gt;&gt;Your ass feels amazing, ?Merry.&lt;&lt;/player&gt;&gt;
    &lt;&lt;merry&gt;&gt;Just wanted to switch it up since last time, you know... Fuck, yes, that&#39;s good...&lt;&lt;/merry&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;player&gt;&gt;Your ass feels amazing...&lt;&lt;/player&gt;&gt;
&lt;&lt;/if&gt;&gt;

He looks up at you, still smiling in pleasure as you thrust into him, the constriction on your ?dick sending waves of pleasure through your body. &lt;&lt;if settings.sph&gt;&gt;You&#39;re certainly not reaching any record depths, but you&#39;re managing as much as you can to keep up a steady rhythm, enjoying the low moans he lets out as you do.&lt;&lt;else&gt;&gt;He lets out a low moan each time you reach your depth, which only makes you want to fuck his ass harder.&lt;&lt;/if&gt;&gt;?nl

&lt;&lt;if settings.sph&gt;&gt;
    You get the sense that he is quite experienced in this area, and has probably taken much, much larger dicks than yours. Still, the harder you ram into him the more loudly he moans, until eventually you&#39;re fucking him so hard that there&#39;s a loud slap with every thrust.  
&lt;&lt;else&gt;&gt;
    You get the sense that he is quite experienced in this area. The harder you ram your ?dick into him, the more loudly he moans, until eventually you&#39;re fucking him so hard that there is a loud slap every time you thrust into him.
&lt;&lt;/if&gt;&gt;

The pleasure builds up inside you and you can tell you&#39;re about to cum. 

&lt;&lt;player&gt;&gt;Augh, fuck, I&#39;m going to fill you up with my cum...&lt;&lt;/player&gt;&gt;

You saying this seems to push him over the edge too. You watch the white liquid explode from his thick cock just as your own orgasm hits, the pleasure moving through you as you spurt your cum inside of him. You cry out in ecstasy, your moans melding with his in a beautiful harmony of pleasure.?nl

Just as you&#39;re returning to earth again, he pulls you toward him and kisses you, your ?dick still inside him.

&lt;&lt;merry&gt;&gt;You, my friend, are incredible, and incredibly sexy.&lt;&lt;/merry&gt;&gt;

You chuckle, pulling your ?dick out of his ass with a wet squelch. You fall next to him on the bed, kissing him a few more times as you lie together in a comfortable silence.?nl

Eventually, he re-dresses and hands you a handful of coins ammounting to &lt;&lt;money gold false `_tip`&gt;&gt; gold. 

&lt;&lt;merry&gt;&gt;I know I&#39;m paying you for this, but I hope you enjoyed yourself as much as I did. I&#39;ll see you next time, my beautiful friend.&lt;&lt;/merry&gt;&gt;

You smile at him, bidding him farewell as you let him out of your room. As you close the door again, you think how lovely it would be if all your clients were as pleasant to work with as ?Merry.

&lt;&lt;decision &#39;Finish for the night&#39; &#39;Brothel Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="590" name="Tavern Velma Intro" tags="" position="1225,7350" size="100,100">&lt;&lt;setlocation &#39;Town square&#39;&gt;&gt;
You make your way through the town in the direction of the tavern. The town square already feels fully alive with the hustle and bustle of merchants peddling their goods out here. There&#39;s a bit of a crowd you have to make your way through before you can get closer to the tavern.?nl
It&#39;s strange, you&#39;ve never really experienced a mass of people while in your disguise like this. It almost feels like you are fitting in, like you are one of the common people. You really hope nobody notices that you have no idea what it&#39;s like to not be royalty.?nl
After a short you have found your way to the destination. You take some time to stand in front of the tavern and look at it, delaying the moment you will have to go inside. The wooden sign sways softly above the entrance, showing ?tavern proudly in bold letters.?nl
You take a deep breath before you step forward and over the tavern doors.

&lt;&lt;decision &#39;Head inside&#39; &#39;Tavern Velma Intro 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="591" name="Tavern Velma Intro 2" tags="" position="100,7475" size="100,100">&lt;&lt;setlocation &#39;Tavern&#39;&gt;&gt;
You set foot inside the tavern, taking a good look around. It seems to be very quiet, not many people visiting the place in the morning makes sense, you suppose. It&#39;s quite spacious inside, there&#39;s lots of different tables for people but with enough room to make your way around them. It would probably feel more cramped when the place is packed at night, probably.?nl
You take some steps forward, very much not sure of yourself. Behind the bar, you notice a woman staring at you with a certain intrigue. She has an assertive air to her and she looks slightly aged. She nods at you and makes a hand wave suggesting for you to step up the bar. You immediately do as she says, probably best to report to the staff right away.
&lt;&lt;velma&gt;&gt;Welcome to ?tavern. What can I do for you, dear?&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;Thanks... Uhm... I&#39;m actually supposed to- uh- work here...&lt;&lt;/player&gt;&gt;
Great, what an intro... She looks you up and down with a curious expression.
&lt;&lt;velma&gt;&gt;Ah, you&#39;re the one ?Sybille told me about... Wow, you&#39;re really new to this whole thing, aren&#39;t you dear?&lt;&lt;/velma&gt;&gt;
She must be ?Sybille&#39;s contact at the tavern. You immediately feel embarrassed that she notices how new you are to this, you&#39;re also not really sure what exactly ?Sybille has told her and what she is referring to.
&lt;&lt;player&gt;&gt;Uhm, yes, I&#39;m not really... used to this environment.&lt;&lt;/player&gt;&gt;
&lt;&lt;velma&gt;&gt;It&#39;s okay, dear. I was made aware of that and ?Sybille asked me to help you with that.&lt;&lt;/velma&gt;&gt;
Her wisened eyes look at your with a sincere concern, you can definitely sense something motherly here, like she just decided that she wants to take care of you are take you under her wing. You take a seat at the bar.
&lt;&lt;velma&gt;&gt;My name is ?Velma. I&#39;m the owner of this little place, I&#39;m very glad to have you here.&lt;&lt;/velma&gt;&gt;
She&#39;s the owner? Somehow you didn&#39;t quite expect that but it makes sense, she already feels quite commanding in a gentle way.
&lt;&lt;player&gt;&gt;Ah, thank you, ?Velma. I&#39;m glad to have the opportunity to work here. My name is ?player.&lt;&lt;/player&gt;&gt;
You look at her with a smile that quickly fades the moment you realise your mistake from her slightly quizzical reaction on her face.
&lt;&lt;velma&gt;&gt;Now, that doesn&#39;t sound quite right, does it? Why don&#39;t you try that again, dear.&lt;&lt;/velma&gt;&gt;
You slightly bow your head in shame. How can you instantly forget the first rule of working undercover...
&lt;&lt;player&gt;&gt;Uhm- Yes, sorry! My name is ?newname, that&#39;s it, of course!&lt;&lt;/player&gt;&gt;
&lt;&lt;velma&gt;&gt;Much better. Try to practise that more often. You must be sure to not make a mistake like that again, if that happens with anyone else it could be detrimental to your cause.&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;Yes, of course, sorry ?Velma.&lt;&lt;/player&gt;&gt;
&lt;&lt;velma&gt;&gt;As you&#39;ll be working for me it will also be important that you refer to me as ?Madame or ?MadameVelma, never just ?Velma. Is that clear?&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;Yes, Vel- ?MadameVelma. Of course.&lt;&lt;/player&gt;&gt;
Wow, you are really doing great stuff here... How could this whole conversation have gone any worse? Luckily, it seems like she&#39;s not really mad at you at all, it&#39;s almost like she expected these little hiccups from you.
&lt;&lt;velma&gt;&gt;Good. We&#39;re ready continue then. I suppose it&#39;s important for you that your schedule remains flexible. You can work here any day during the evening. I will pay you five gold pieces for every shift that you work and any tips you receive are for you to keep. Does this all sound agreeable to you?&lt;&lt;/velma&gt;&gt;
You&#39;re getting paid for this? Strangely enough you hadn&#39;t even thought about that, you don&#39;t really need the money at all but it would probably be bad for your cover if people find out you&#39;re not getting paid.
&lt;&lt;player&gt;&gt;Uh- yes, ?Madame.&lt;&lt;/player&gt;&gt;
&lt;&lt;velma&gt;&gt;Splendid, dear. I have been informed not to overwhelm you too much on your first day so I suppose we will leave it at that for now. Come back another day to start your first shift.&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;Sounds good, thank you for the explanation, ?Madame. I will come back soon to start working.&lt;&lt;/player&gt;&gt;
You stand up and make your way back outside, that&#39;s all for today, you suppose.

&lt;&lt;decision &#39;Head back to the castle&#39; &#39;Tavern Velma Intro 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="592" name="Tavern Velma Intro 3" tags="" position="225,7475" size="100,100">&lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;setlocation &#39;Road&#39;&gt;&gt;
The sun, now higher in the sky, shines down on you as you walk this same path back with a reinvigorated spring in your step. The plan now actually starting to unfold feels very exciting. It doesn&#39;t take you long before you are back at the castle.

&lt;span class=&quot;notice good&quot;&gt;You have now unlocked the town area that you can visit while being disguised.&lt;/span&gt;

&lt;&lt;decision &#39;Head to your bedroom and get changed&#39; &#39;Bedroom&#39;&gt;&gt;
    &lt;&lt;addcounter &#39;tavern-work&#39; 1&gt;&gt;
    &lt;&lt;startquest &#39;tavern-intro&#39;&gt;&gt;
    &lt;&lt;outfit standard&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="593" name="Tavern Eve Intro" tags="" position="350,7475" size="100,100">As you head inside the tavern you see ?Velma standing in front of the bar talking with someone. It looks like she also works here, she&#39;s wearing a very cute barmaid outfit, &lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;sort of similar to what you&#39;re wearing, except it has a much shorter skirt than what you have.&lt;&lt;else&gt;&gt;with a very short skirt.&lt;&lt;/if&gt;&gt; It looks very good on her.&lt;&lt;if hasTag(&#39;eve-waterfall&#39;)&gt;&gt; Something makes you feel like you&#39;ve seen her before, but you&#39;re not sure when.&lt;&lt;/if&gt;&gt;?nl
?Velma notices you and waves you over to join them.
&lt;&lt;velma&gt;&gt;?newname, you&#39;re on time, very good. Are you ready for your first day of working?&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;Yes, I&#39;m ready to work, ?MadameVelma!&lt;&lt;/player&gt;&gt;
You feel kind of embarrassed about how your conversation with ?Velma went last time you were here so you have opted to try and make yourself come across more confident this time.
&lt;&lt;velma&gt;&gt;Good. This is ?Eve, I will leave you in her hands as she&#39;ll be the one guiding you and showing you the ropes today. It shouldn&#39;t be too busy this evening so I believe you will do fine, dear. I&#39;ll be in my office if you need me.&lt;&lt;/velma&gt;&gt;
You nod to her and ?Velma smiles to you as she leaves you two alone. You turn to face ?Eve to introduce yourself to her.
&lt;&lt;if hasTag(&#39;eve-waterfall&#39;)&gt;&gt;
    It is at this moment that you recognise what you know her from. You have seen her before in the forest by the waterfall, she was taking a swim, naked, and you walked in on her. You instinctively look down towards her crotch, remembering the moment you saw her- No, you quickly snap yourself out of it and look at her, cheeks red with embarrassment.
    &lt;&lt;eve&gt;&gt;Oh wow! It&#39;s you! I remember seeing you at the waterfall! You&#39;re the new ?barworker? That&#39;s so exciting!&lt;&lt;/eve&gt;&gt;
    She doesn&#39;t seem to feel any embarrassment about the fact that you have already seen her naked, apparently.
    &lt;&lt;eve&gt;&gt;I just realised I never asked you your name that time, such bad manners!&lt;&lt;/eve&gt;&gt;
    You sheepishly smile at her.
    &lt;&lt;player&gt;&gt;That&#39;s okay, I&#39;m ?newname. I&#39;m glad to meet you for real now.&lt;&lt;/player&gt;&gt;
&lt;&lt;else&gt;&gt;
    It looks like she beats you to it, though.
    &lt;&lt;eve&gt;&gt;Hi, I&#39;m ?Eve! You&#39;re the new ?barworker? That&#39;s very exciting! What&#39;s your name?&lt;&lt;/eve&gt;&gt;
    You sheepishly smile at her intense enthusiasm, it&#39;s quite endearing and makes you want to match her energy.
    &lt;&lt;player&gt;&gt;I&#39;m ?newname. Glad to meet you!&lt;&lt;/player&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;eve&gt;&gt;Me too! So tell me, ?newname, are you excited for your first day on the job?&lt;&lt;/eve&gt;&gt;
You&#39;re probably a bit more scared than excited, but you probably shouldn&#39;t keep saying that.
&lt;&lt;player&gt;&gt;Yes, I can&#39;t wait to get started, I might be a bit out of my depth so I&#39;m not sure what to do first...&lt;&lt;/player&gt;&gt;
&lt;&lt;eve&gt;&gt;That&#39;s okay! It&#39;s what I&#39;m here for. Let&#39;s start by showing you around a bit, why don&#39;t we head to the kitchen so you can meet our culinary genius, ?ChefPepper.&lt;&lt;/eve&gt;&gt;

&lt;&lt;decision &#39;Head to the kitchen&#39; &#39;Tavern Eve Intro Kitchen&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="594" name="Tavern Eve Intro Kitchen" tags="" position="475,7475" size="100,100">&lt;&lt;setlocation &#39;Cookroom&#39;&gt;&gt;

You follow ?Eve into the kitchen and are immediately greeted by a whirlwind of activity. A different dish seems to be boiling, baking, or marinating on every spare surface and a cocktail of delicious, savory smells wafts through the room. A scruffy dog slumbers happily in one corner.

&lt;&lt;eve&gt;&gt;Hello, ?ChefPepper! We have a lovely new ?barworker joining us. This is ?newname!&lt;&lt;/eve&gt;&gt;

It looks as though an entire team of people must work here, but indeed you see only one man. He is large and muscled, with carefully trimmed salt-and-pepper hair. You recognize this as ?ChefPepper, the renowned cook ?Kathryn hires for her dinner parties.?nl

?ChefPepper spins away from a station, whisking a massive bowl. He somehow manages to shake your hand while still continuing to whisk.

&lt;&lt;pepper&gt;&gt;Hello there, ?newname! Welcome to my kitchen. I&#39;m ?Pepper, and that&#39;s my pup, &lt;&lt;name &#39;Seasalt&#39;&gt;&gt;. Do you mind stirring that pot there for a second?&lt;&lt;/pepper&gt;&gt;

You look to the old grey dog that&#39;s comfortably lying on some pillows in his own little corner of the kitchen. &lt;&lt;name &#39;Seasalt&#39;&gt;&gt; looks at you as his tail starts waggling but seems too comfortable to actually get up and greet you. ?Pepper is pointing to a pot standing on the stove, the ladle is sitting and waiting.

&lt;&lt;player&gt;&gt;Oh, um, of course, ?ChefPepper.&lt;&lt;/player&gt;&gt;

You stir the pot carefully. It looks like some kind of creamy soup, and the steam rising from it smells delicious. As you&#39;re trying to figure out what to say next, you hear from the distance a smashing sound.

&lt;&lt;eve&gt;&gt;Ah, someone dropped a tankard again! I&#39;d better go take care of that.&lt;&lt;/eve&gt;&gt;

She disappears from the kitchen, leaving you alone with ?ChefPepper. He sets down his bowl and picks up a large cast iron pan with one hand, flipping the contents with ease. It looks so heavy you&#39;re not sure you&#39;d be able to lift it with two hands. He looks over to you with a conspiratorial smile.

&lt;&lt;pepper&gt;&gt;You know, deary, I have to admit I recognize you.&lt;&lt;/pepper&gt;&gt;

You freeze, your hand still on the ladle. You haven&#39;t even started your first shift at the tavern, and you&#39;ve already been recognized? The panic starts to well inside you as you realize how badly you&#39;ve messed up.

&lt;&lt;pepper&gt;&gt;Oh, no, don&#39;t worry, ?title! Your secret is safe with me. Your disguise is quite good, truly! And the alias suits you well.&lt;&lt;/pepper&gt;&gt;

You see in his face a look of concern as he tries to calm you down. You take a deep breath, attempting to slow your heartbeat back to a normal rhythm.

&lt;&lt;player&gt;&gt;H-how did you recognize me?&lt;&lt;/player&gt;&gt;

&lt;&lt;pepper&gt;&gt;Oh, &lt;&lt;fullname kathryn&gt;&gt; hires me to cook over at the castle sometimes and I never forget a face, deary. Especially not such a &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;pretty&lt;&lt;else&gt;&gt;handsome&lt;&lt;/if&gt;&gt; one.&lt;&lt;/pepper&gt;&gt;

Before you can say anything else, ?Eve returns to the kitchen, dumping the contents of a dustpan into a trash bin. ?ChefPepper gives you a conspiratorial wink and whirls away, now busily sliding proofed loaves of bread into the oven.

&lt;&lt;pepper&gt;&gt;It was lovely to meet you, ?newname! I&#39;m sure you have to get back to your first day now.&lt;&lt;/pepper&gt;&gt;

?Eve turns to you, a bright smile on her face.

&lt;&lt;eve&gt;&gt;Yes, thank you ?ChefPepper! We&#39;re going to start off easy, cleaning tankards, wiping tables, that sort of thing. Afterwards I&#39;ll show you how to make some drinks and how to serve the patrons in an orderly way. It&#39;s going to be great!&lt;&lt;/eve&gt;&gt;

&lt;&lt;decision &#39;Start working&#39; &#39;Tavern Eve Intro 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="595" name="Tavern Eve Intro 2" tags="" position="600,7475" size="100,100">&lt;&lt;setlocation &#39;Tavern&#39;&gt;&gt;
You spend a good few hours working together with ?Eve. She&#39;s a very gentle teacher as it must be very apparent that you have absolutely no experience doing anything close to this at all. Your royal self has never even had to do any chores yourself, let alone serve patrons at a tavern before. She doesn&#39;t seem to mind your lack of experience at all and with her guidance you very quickly pick up on how things work.
&lt;&lt;eve&gt;&gt;And that&#39;s how to tap open a new barrel, simple as that! Don&#39;t worry though, if it&#39;s being difficult you can always ask me for help!&lt;&lt;/eve&gt;&gt;
She has shown you how to correctly pour beers and how to keep the bar clean. Luckily, it&#39;s not too busy at the tavern so you have all the time to let ?Eve teach you things. It&#39;s strange, not being used to doing service work yourself, you were scared you would absolutely hate it but it actually feels like the opposite. 
&lt;&lt;eve&gt;&gt;?newname! Can you bring these beers to the people over there?&lt;&lt;/eve&gt;&gt;
&lt;&lt;player&gt;&gt;On it!&lt;&lt;/player&gt;&gt;
While you bring the three tankards for the customers sitting by the window you realise you get into this satisfied feeling of flow. It feels like this is the first time that you&#39;re actually part of the common folk, even though you know that you aren&#39;t. It seems like the disguise is finally working for you now. You return some empty cups to the bar, you see ?Eve talking to a customer and ?Velma walks by, smiling at you.
&lt;&lt;velma&gt;&gt;Look at you, you&#39;re doing great, dear. All used to being a ?barworker, I see.&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;Ah, thank you ?Madame. ?Eve is a great teacher.&lt;&lt;/player&gt;&gt;
?Velma nods to you with a proud smile and leaves towards her office again. You spend some time cleaning the bar when ?Eve walks up to you.
&lt;&lt;eve&gt;&gt;I have to help a customer for a little while but I&#39;ll be back soon, you okay with holding the fort while I&#39;m gone?&lt;&lt;/eve&gt;&gt;
You immediately feel some doubtfulness creep over you but somehow your new sense of security seems to bat the panick away.
&lt;&lt;player&gt;&gt;Uh- Yes, of course, I&#39;ll be fine!&lt;&lt;/player&gt;&gt;
?Eve gives you a happy smile and she walks off through a door in the back of the tavern of which you&#39;re not really sure where it leads. Next to the door, you see a man who was apparently waiting for her as she nods to him and he immediately follows behind her, closing the door behind them. Strange.?nl

&lt;&lt;decision &#39;Continue working&#39; &#39;Tavern Eve Intro 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="596" name="Tavern Eve Intro 3" tags="" position="725,7475" size="100,100">Only a little while later, you realise that telling ?Eve you&#39;ll be fine was actually a failed attempt at manifesting that. She&#39;s been gone for quite some time now and you are completely overwhelmed with the amount of people that you still have to serve. You bring new drinks to one table and some woman at another table starts shouting for you to hurry up.
&lt;&lt;say &#39;Patron&#39;&gt;&gt;Hey, you! ?Barworker! Where&#39;s my drink?! I&#39;ve been waiting for so long now!&lt;&lt;/say&gt;&gt;
&lt;&lt;player&gt;&gt;Yes, sorry, madam. I&#39;ll be with you shortly!&lt;&lt;/player&gt;&gt;
You quickly run back to the bar but almost run into another customer that decided to stand up the exact moment you were about to dart behind his chair. Narrowly avoiding the collision you quickly start grabbing more tankards before you realise there are no clean ones anymore. You almost panic completely when at that moment, ?Eve returns.?nl
She has a satisfied smile on her face as she fixes the shoulder strap of her blouse. Her hair is slightly disheveled.
&lt;&lt;eve&gt;&gt;I&#39;m back! Sorry, that took &lt;em&gt;way&lt;/em&gt; longer than expected! How&#39;s it going here?&lt;&lt;/eve&gt;&gt;
You tell her what&#39;s going on and she immediately reads the panic in your eyes. She puts a comforting hand on your shoulders before she tells you how you&#39;re going to fix the situation together. Her calm solution immediately makes you feel a lot better and together you manage to bring everything back in order.?nl
The rest of your shift goes by much more smoothly. Even though ?Eve still leaves you alone to see a customer quite a few more time, you think you&#39;re doing pretty well. After a few more hours, the last patrons start to leave the bar as you&#39;re cleaning up. ?Velma comes out of her office to come and speak to you.

&lt;&lt;decision &#39;Speak to ?Velma&#39; &#39;Tavern Eve Intro 4&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="597" name="Tavern Eve Intro 4" tags="" position="850,7475" size="100,100">?Velma looks you up and down as you take a break from cleaning to talk to her. She looks over towards ?Eve, who then comes to join the two of you.
&lt;&lt;velma&gt;&gt;Well?&lt;&lt;/velma&gt;&gt;
She has a very serious tone, you&#39;re not sure what she wants you to say to that question so you&#39;re slow to stammer something before you realise the question was not for you.
&lt;&lt;eve&gt;&gt;Yes, &lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;s&lt;&lt;/if&gt;&gt;he&#39;s good. Fitted in quickly, obviously new to the service work but that would be the same for any new ?barworker. I think it works!&lt;&lt;/eve&gt;&gt;
It&#39;s strange hearing ?Eve give ?Velma very intentful analysis about you while still keeping her enthusiasm. ?Velma gives a decisive nod and smiles at you, breaking the serious air. She swiftly dismisses ?Eve, who turns away to continue cleaning.
&lt;&lt;velma&gt;&gt;Good, that settles it then. You have done well on your trial day, dear. I think this operation will work and I will let our mutual contact know.&lt;&lt;/velma&gt;&gt;
Wait so does that mean ?Eve knew you are working undercover and ?Velma asked her to test you? This day feels much more intense than it already but you are so happy you managed to get through it.
&lt;&lt;player&gt;&gt;Thank you, ?Madame. I won&#39;t disappoint you.&lt;&lt;/player&gt;&gt;
&lt;&lt;velma&gt;&gt;Glad to hear it, dear. Now, I also was informed about your target, spying on &lt;&lt;name andreas &#39;Councillor&#39;&gt;&gt; will be difficult. He&#39;s an infrequent but specific customer, always rents a private room in the back of the tavern and he actually prefers to pick the staff that serves his table for the evening himself. You will have to become a more regular ?barworker first, this will mean that you&#39;ll have to spend some time working here now.&lt;&lt;/velma&gt;&gt;
Even though it&#39;s important information she&#39;s giving you, you also feel that not everything is landing after the long evening of working.
&lt;&lt;velma&gt;&gt;I will speak to you when you are ready for the next part. For now, welcome to ?tavern and we&#39;re glad to have you on board. Now go home and get some rest, dear.&lt;&lt;/velma&gt;&gt;
You give ?Velma a nod and thank her for the opportunity before you leave the tavern, very tired after a long evening of working. It looks like ?Sybille&#39;s plan is slowly starting to work, now to first get good at this whole ?barworker thing.

&lt;&lt;decision &#39;Leave the place&#39; &#39;Town square&#39;&gt;&gt;
    &lt;&lt;completequest &#39;tavern-intro&#39;&gt;&gt;
    &lt;&lt;startquest &#39;tavern&#39;&gt;&gt;
    &lt;&lt;unlocklocation &#39;Cookroom&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Morgana Tells About Potions&#39;&gt;&gt;&lt;&lt;delay 1&gt;&gt;&lt;&lt;/addevent&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="598" name="Tavern Work" tags="" position="975,7475" size="100,100">You start your shift at the tavern, ready for a good day of working. It still feels weird to be doing this, nobody knowing you are the prince but you are excited for what this evening will bring.?nl

&lt;&lt;set $paycheck = 5&gt;&gt;

&lt;&lt;decision &#39;Start working&#39;&gt;&gt;
    &lt;&lt;if questStep(&#39;tavern&#39;) &lt; 8&gt;&gt;
        &lt;&lt;advancequest tavern&gt;&gt;
        &lt;&lt;if questStep(&#39;tavern&#39;) is 8&gt;&gt;
            &lt;&lt;startquest &#39;velma-progress&#39;&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;if !hasVisited(&#39;Tavern Work Event Gossip&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Tavern Work Event Gossip&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Tavern Work Event Noblewoman&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Tavern Work Event Noblewoman&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Tavern Work Event Failure&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Tavern Work Event Failure&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Tavern Work Event Merchant&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Tavern Work Event Merchant&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Tavern Work Event Bathroom&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Tavern Work Event Bathroom&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Tavern Work Event Pee&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Tavern Work Event Pee&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Tavern Work Event Drunks Catcalling&#39;) and hasClothesTag(&#39;feminine&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Tavern Work Event Drunks Catcalling&#39;&gt;&gt;
    &lt;&lt;elseif !hasVisited(&#39;Tavern Work Event Rude Grandma&#39;)&gt;&gt;
        &lt;&lt;goto &#39;Tavern Work Event Rude Grandma&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;goto `either(&#39;Tavern Work Event Gossip&#39;, &#39;Tavern Work Event Noblewoman&#39;, &#39;Tavern Work Event Pee&#39;, &#39;Tavern Work Event Failure&#39;, &#39;Tavern Work Event Merchant&#39;, &#39;Tavern Work Event Rude Grandma&#39;, &#39;Tavern Work Event Bathroom&#39;)`&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="599" name="Tavern Work End" tags="" position="1100,7475" size="100,100">&lt;&lt;setlocation &#39;Tavern&#39;&gt;&gt;
&lt;&lt;addcounter &#39;tavern-work&#39; 1&gt;&gt;
&lt;&lt;increasetime 1&gt;&gt;
The rest of your shift passes by uneventfully. It takes a bit of time to clean up the place before you can leave.?nl

You&#39;ve made a total of &lt;&lt;money gold false $paycheck&gt;&gt; gold for your hard work today!

&lt;&lt;changemoney gold $paycheck&gt;&gt;

&lt;&lt;if hasTag(&#39;sexwork&#39;) and getTime() is &#39;night&#39; and hasCompletedQuest(&#39;brothel-intro&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Head to the brothel for your next shift&#39; &#39;Brothel Work&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;decision &#39;Leave the tavern&#39; &#39;Town square&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="600" name="Tavern Work Event Gossip" tags="" position="1225,7475" size="100,100">In the middle of your shift, a small group of young women in peasant dresses comes into the tavern. They take a seat in a corner, giggling loudly together.?nl

As you approach to take their orders, you overhear some of their conversation. They seem to be talking about...you?

&lt;&lt;say &quot;Brown-haired peasant girl&quot;&gt;&gt;Did you ladies see how &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;cute&lt;&lt;else&gt;&gt;handsome&lt;&lt;/if&gt;&gt; the prince looked at church? I wish he would leave the castle more often...&lt;&lt;/say&gt;&gt;

&lt;&lt;say &quot;Redhead peasant girl&quot;&gt;&gt;He&#39;s so dreamy... Do you think he would ever fall for a town girl?&lt;&lt;/say&gt;&gt;

&lt;&lt;say &quot;Blonde peasant girl&quot;&gt;&gt;Maybe he already has! He smiled at me last Sunday and my heart almost melted!&lt;&lt;/say&gt;&gt;

You clear your throat. The young women look at you with some annoyance, as though you have just interrupted an incredibly important discussion, and give you their orders quickly. You head back to the bar, thinking how strange it is to overhear townspeople talking about you like this. Not only that, but they also seem to think you&#39;re...attractive??nl

Before you can dwell on it too much, activity in the tavern picks up and you are distracted with an influx of orders.
&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="601" name="Tavern Work Event Noblewoman" tags="" position="100,7600" size="100,100">It&#39;s a slow shift at the tavern. You are quite bored until one woman walks in you&#39;ve never seen before. She is dressed in the lavish clothes of a noblewoman, and is conspicuously alone. She enters, takes a seat at the bar, and waves you over.?nl

As you approach, you see this woman is attractive and seems to know it. She carries herself gracefully, and wears a beautiful dress that accentuates her features without being revealing. She looks you up and down.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Well, hello there, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;lovely girl&lt;&lt;else&gt;&gt;handsome boy&lt;&lt;/if&gt;&gt;. I require a glass of your finest wine, and perhaps some company, if you&#39;re as bored as I would be working here.&lt;&lt;/say&gt;&gt;

&lt;&lt;player&gt;&gt;Uh, yes, of course, my lady...&lt;&lt;/player&gt;&gt;

It feels a bit strange, someone being so forward with you, and you&#39;re not sure what she means by &quot;company.&quot; Still, you bring her a glass of the good wine and she gives you a smile that seems almost calculating.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;I see you have no other customers to serve right now. Stay with me at the bar for a moment.&lt;&lt;/say&gt;&gt;

&lt;&lt;player&gt;&gt;I- well, I suppose...&lt;&lt;/player&gt;&gt;

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;I will share a secret with you. I have escaped my traveling companions to come here, so that I could drink in peace.&lt;&lt;/say&gt;&gt;

This woman is intriguing, and you have little else to do, so you figure you might as well listen to her.

&lt;&lt;player&gt;&gt;Is that so?&lt;&lt;/player&gt;&gt;

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Indeed. I have rather particular taste.&lt;&lt;/say&gt;&gt;

&lt;&lt;player&gt;&gt;In wine?&lt;&lt;/player&gt;&gt;

The noblewoman inclines her head.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;In wine, yes, but also company. I find lords and ladies to be dull. Everyday people such as yourself have so much more to offer.&lt;&lt;/say&gt;&gt;

She gives you a long, suggestive look. Is she trying to seduce you? You can&#39;t think of any other reason she would act like this. She seems to notice you considering her words and leans forward slightly on the bar, revealing the barest glimpse of her ample cleavage.?nl

Part of you is definitely excited by this woman. There aren&#39;t many customers this evening; you could easily sneak into the alley with her for some fun. On the other hand, you are in the middle of your shift, and you wouldn&#39;t want to get caught fooling around on the clock...?nl

&lt;&lt;decision &#39;Pretend to be unaware of her flirting&#39; &#39;Tavern Work Event Noblewoman Rejected&#39; virtue medium&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Subtly show her your interest&#39; depravity medium&gt;&gt;
    You open your mouth to say something suave, but in your excitement a jumble of sounds embarrassingly unlike words comes out. You feel your cheeks grow hot. If anything, the noblewoman seems to enjoy your awkwardness.

    &lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;I walked through an alley on my way here. Perhaps you could show me what you have to offer there?&lt;&lt;/say&gt;&gt;

    She subtly points toward the back door of the tavern, a smile playing on her lips. Then, without another word, she downs her drink, stands, and exits the building toward the alley.?nl

    Feeling a mixture of excitement and anxiety, you wait a few moments until no one is looking and follow.
    &lt;&lt;decision &#39;Find her in the alley&#39; &#39;Tavern Work Event Noblewoman Oral&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="602" name="Tavern Work Event Noblewoman Rejected" tags="" position="225,7600" size="100,100">&lt;&lt;set $paycheck += 1&gt;&gt;

&lt;&lt;player&gt;&gt;I&#39;m sure I wouldn&#39;t know, my lady. I really must get back to my work now.&lt;&lt;/player&gt;&gt;

The noblewoman leans back and gives you a polite nod, slipping effortless back into formality.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Of course.&lt;&lt;/say&gt;&gt;

This whole interaction made you feel quite awkward, so you pretend to be busy with something in the kitchen until she leaves. When you come to take away her glass, you find her payment plus a small tip of only &lt;&lt;money gold false 1&gt;&gt; gold on the counter.
&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="603" name="Tavern Work Event Noblewoman Oral" tags="spicy" position="350,7600" size="100,100">&lt;&lt;setlocation &#39;Alley&#39;&gt;&gt;
&lt;&lt;set $paycheck += 2&gt;&gt;

You walk out of the tavern and see the woman leaning against the wall of a building. In the low light, you can just make out a smile on her face.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Come here, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;beautiful girl&lt;&lt;else&gt;&gt;handsome boy&lt;&lt;/if&gt;&gt;.&lt;&lt;/say&gt;&gt;

You find yourself obeying her words as you approach her. 

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Do you wish to pleasure a lady? It&#39;s not an honor many common people can attest to.&lt;&lt;/say&gt;&gt;

Though this situation has you turned on, you have to stop yourself from laughing at her perception of you as a simple townsperson. If anything, you are the opposite of what she believes.

&lt;&lt;player&gt;&gt;I- uh, that is, yes, my lady...&lt;&lt;/player&gt;&gt;

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Wonderful. Then get on your knees, my &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;pretty little&lt;&lt;else&gt;&gt;dashing&lt;&lt;/if&gt;&gt; peasant.&lt;&lt;/say&gt;&gt;

You lower yourself onto your knees and watch as she lifts the hem of her skirt. You expect to see her underwear, but instead come suddenly face-to-face with the bare lips between her legs.?nl

Trying not to get distracted by thinking about how much of a turn your evening has taken, you reach out a hand and trace it cautiously between her legs. She moans softly, and your fingers come away surprisingly wet.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Don&#39;t tease me, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;girl&lt;&lt;else&gt;&gt;boy&lt;&lt;/if&gt;&gt;. Put your mouth on it.&lt;&lt;/say&gt;&gt;

You reach your head forward and tentatively begin to lick between her soft folds. It tastes a bit strange, but you enjoy the way that your tongue elicits a low moan from her. Your movements, slow at first, speed up as you notice what she likes and gain confidence in your movements.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Fuck, that&#39;s a good &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;girl&lt;&lt;else&gt;&gt;boy&lt;&lt;/if&gt;&gt;, pleasuring a noblewoman above your station in a dirty little alley...&lt;&lt;/say&gt;&gt;

You wonder vaguely whether this woman has some strange attraction to sexual encounters with peasants. Would she be disappointed if she knew you were a royal? You try to ignore these thoughts and focus on your movements.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Just like that, keep going...&lt;&lt;/say&gt;&gt;

You continue moving your tongue around her clitoris, feeling her start to push herself onto your mouth as she seeks out the sensation. You feel your ?dick hard in your pants, but it would be difficult to touch yourself in this position.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;I&#39;m close...&lt;&lt;/say&gt;&gt;

You are starting to have some difficulty breathing as she presses herself onto you, but you keep up the motion that she seems to like. Your face is now covered in her wetness. It feels both messy and somehow incredibly alluring.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;Oh, I&#39;m cumming...&lt;&lt;/say&gt;&gt;

You feel her move through a series of spasms as she orgasms on your mouth, letting out a moan of pleasure. After a moment of quiet, she runs a hand casually through your hair.

&lt;&lt;say &quot;Noblewoman&quot;&gt;&gt;You have performed wonderfully for your noblelady. I must return to my companions before they become too concerned for my whereabouts.&lt;&lt;/say&gt;&gt;

As you stand up, she gives you a handful of coins and disappears back into the town without another word. As you stand there, watching her go, you realize she has left you a small tip of &lt;&lt;money gold false 2&gt;&gt; gold.?nl

You&#39;re still hard, but you really need to get back to your shift before ?Velma notices you&#39;re gone. &lt;&lt;if settings.sph&gt;&gt;Luckily your bulge is too small to be visible through your &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;dress&lt;&lt;else&gt;&gt;pants&lt;&lt;/if&gt;&gt;, so you head back quickly into the tavern.&lt;&lt;else&gt;&gt;You adjust your erection so that it doesn&#39;t show through your &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;dress&lt;&lt;else&gt;&gt;pants&lt;&lt;/if&gt;&gt; and head back into the tavern.&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="604" name="Tavern Work Event Rude Grandma" tags="" position="475,7600" size="100,100">At the beginning of your shift, a very old woman enters the tavern and sits down at a long table normally used by large groups. She proceeds to spend the rest of the evening berating you about everything you do, complaining that you bring her drinks too slowly, that your manner is boorish, your clothes unkempt, and that the drinks are of poor quality. To your chagrin, she even stays past closing time, and you have to ask her to leave. As you stand there, waiting for her to get up from the table while she complains about poor service, something inside you snaps.

&lt;&lt;player&gt;&gt;Why are you like this?&lt;&lt;/player&gt;&gt;

The old woman finally gets up and starts walking toward the door.

&lt;&lt;say &#39;Old woman&#39;&gt;&gt;This is just how I get my frustrations out! Don&#39;t take it personally, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;girl&lt;&lt;else&gt;&gt;boy&lt;&lt;/if&gt;&gt;.&lt;&lt;/say&gt;&gt;

Without another word, she walks out the door, leaving you speechless. You&#39;re not sure you&#39;ve ever met a more unpleasant person.

&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="605" name="Tavern Work Event Failure" tags="" position="600,7600" size="100,100">It&#39;s pretty early in your shift and the place is already packed. Plates and mugs clatter as the evening rush peaks, but for you, it feels like everything is slipping through your fingers.
&lt;&lt;eve&gt;&gt;?newname, that table over there asked for wine, not ale!&lt;&lt;/eve&gt;&gt;
?Eve&#39;s voice is as bright as ever, but there&#39;s a tinge of worry underneath. You glance at the table she&#39;s pointing to and see a burly man staring at you with raised eyebrows, the ale you just brought sitting in front of him.
&lt;&lt;player&gt;&gt;Oh! My apologies, I&#39;ll fix it right away!&lt;&lt;/player&gt;&gt;
You turn toward the kitchen, tray in hand, but your footing falters. A mug of ale wobbles dangerously and tumbles off the tray, hitting the floor with a loud crash. Your face burns as you crouch to clean up the mess, muttering apologies under your breath.
&lt;&lt;velma&gt;&gt;Are you doing alright, ?newname?&lt;&lt;/velma&gt;&gt;
You look up to see ?Velma standing behind the bar, her arms crossed, her expression a mixture of concern and disappointment.?nl

Before you can answer, disaster strikes again. As you dart around the bar, your sleeve snags on a precarious pile of tankards, cautiously laid out in preparation for the evening. Time seems to slow as they tip, fall, and scatter across the floor in a cascade of clanging sounds. To you, the moment seems to last one full eternity as all the noise in the room is suddenly drowned out with the loud breaking and bouncing of mugs. The frequency of clattering sounds starts to decrease as the pile seems to finally be expended.?nl

Only after the last tankard falls, the room erupts with laughter and some concerned murmurs. You quickly try to gather them up, most of them seem intact but a good amount are definitely broken as you find some lonely ears and chipped off pieces. ?Eve quickly hurries over with a broom and takes a moment to kneel beside you.
&lt;&lt;eve&gt;&gt;It&#39;s okay! It&#39;s just mugs. Happens to the best of us... though, um, maybe not all at once!&lt;&lt;/eve&gt;&gt;
You manage a weak smile, but it fades as ?Velma approaches, her face firm.
&lt;&lt;velma&gt;&gt;That&#39;s enough for tonight, ?newname. You&#39;re clearly exhausted.&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;I&#39;m so sorry ?Madame, I can clean this up!&lt;&lt;/player&gt;&gt;
&lt;&lt;velma&gt;&gt;No, please, just go home and leave this to ?Eve. Take some rest, ?newname. Everyone has an off day, but pushing through when you&#39;re like this will only make things worse.&lt;&lt;/velma&gt;&gt;
?Velma is likely disappointed but doesn&#39;t seem to let that show much. ?Eve gives you an encouraging nod as she starts cleaning up.
&lt;&lt;eve&gt;&gt;She&#39;s right, you know. And hey, tomorrow I&#39;ll teach you my trick for not dropping everything all at once. It&#39;s a lifesaver!&lt;&lt;/eve&gt;&gt;
You can&#39;t help but chuckle faintly, despite the embarrassment tightening your chest.
&lt;&lt;player&gt;&gt;Thanks... I&#39;m sorry you have to do this.&lt;&lt;/player&gt;&gt;
She smiles at you to let you know it&#39;s okay. You reluctantly make your way to exit the tavern, leaving much earlier than planned. It seems like all the patrons have already forgotten about the moment and the loud carousing has resumed in full effect.?nl

You step outside feeling a bit disappointed in yourself but you do feel a lot better after how ?Velma and ?Eve responded to them. You&#39;re already thinking on how you can make it up to them, you&#39;ll be much more aware the next time.?nl

Pretty unfortunate to not get paid today though.

&lt;&lt;decision &#39;Leave&#39; &#39;Town square&#39;&gt;&gt;
    &lt;&lt;addcounter &#39;tavern-work&#39; 1&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="606" name="Tavern Work Event Merchant" tags="" position="725,7600" size="100,100">&lt;&lt;set $paycheck += 15&gt;&gt;

The tavern is alive with the evening rush, the clinking of mugs and hum of conversations creating a familiar, comforting rhythm. Tonight, everything seems to fall into place. Orders come quickly, and you move with confidence, balancing trays and weaving through crowded tables like you&#39;ve been doing this your whole life.
&lt;&lt;eve&gt;&gt;?newname, you&#39;re on fire tonight! That table over there just said you brought out the best ale they&#39;ve ever had. It&#39;s the same ale we&#39;ve always served, but hey, take the win!&lt;&lt;/eve&gt;&gt;
Eve laughs as she nudges you playfully, her energy infectious. You grin back, your spirits soaring. Even ?Velma, ever watchful behind the bar, gives you an approving nod.
&lt;&lt;velma&gt;&gt;Good work, ?newname. Keep this up, and I might start calling you a natural.&lt;&lt;/velma&gt;&gt;
Her praise feels monumental to you, it fuels your determination as you deliver an ale to a man seated at one of the quieter tables. His sharp, well-tailored clothing suggests he&#39;s a man of wealth, and he surveys you with a discerning gaze as you set the plate down.
&lt;&lt;player&gt;&gt;Here&#39;s your drink, sir. If there&#39;s anything else you need, just let me know.&lt;&lt;/player&gt;&gt;
&lt;&lt;say &#39;Merchant&#39;&gt;&gt;Thank you. The service has been impeccable tonight.&lt;&lt;/say&gt;&gt;
You smile politely as thanks and move on, continuing your smooth rhythm of clearing tables and delivering drinks. It&#39;s only later, as you return to clear his table, that you find something unexpected. A coin pouch resting on the table.?nl

When you pick it up, its weight surprises you. Opening it, you find &lt;&lt;money gold false 15&gt;&gt; gleaming gold coins, far more than the cost of his meal. You glance around, but the man is already gone.
&lt;&lt;player&gt;&gt;?Eve, look at this! He left me... this much? Is that normal around here?&lt;&lt;/player&gt;&gt;
?Eve peers into the pouch and lets out a low whistle.
&lt;&lt;eve&gt;&gt;That&#39;s... a lot. That&#39;s way more than he usually tips. Like, way, way more. I mean, he&#39;s a wealthy merchant and a regular here, but he&#39;s not known for generosity.&lt;&lt;/eve&gt;&gt;
&lt;&lt;player&gt;&gt;Then why would he...&lt;&lt;/player&gt;&gt;
?Eve pauses, her expression turning sly as a grin spreads across her face.
&lt;&lt;eve&gt;&gt;Ohhh, I get it now. He&#39;s got an eye on you! Makes sense, &lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;pretty&lt;&lt;else&gt;&gt;handsome&lt;&lt;/if&gt;&gt; thing like you, he probably liked looking at more than just our cozy scenery.&lt;&lt;/eve&gt;&gt;
Your face flushes instantly, cheeks red.
&lt;&lt;player&gt;&gt;That can&#39;t be it. He probably just had a good night... or... liked the ale!&lt;&lt;/player&gt;&gt;
&lt;&lt;eve&gt;&gt;Uh-huh. Sure. Whatever helps you sleep at night, ?newname.&lt;&lt;/eve&gt;&gt;
Her teasing grin doesn&#39;t let up as she bounces away to take another order. You&#39;re still standing there, flustered, when ?Velma calls out to you.
&lt;&lt;velma&gt;&gt;?newname, stop gawking at that coin pouch and get back to work. You&#39;re doing too well tonight to slack off now.&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;Right! On it!&lt;&lt;/player&gt;&gt;
Tucking the pouch away carefully, you throw yourself back into the shift, though the flush on your face doesn&#39;t fade for a while.
&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="607" name="Tavern Work Event Bathroom" tags="" position="850,7600" size="100,100">The evening shift begins as usual, the tavern gradually filling with the chatter of patrons and the clink of mugs. You slip behind the bar, preparing yourself for another night of balancing trays and dodging rowdy drinkers.
&lt;&lt;velma&gt;&gt;?newname, come over here for a moment.&lt;&lt;/velma&gt;&gt;
Her voice is calm, as it usually is, but there&#39;s an air of expectation in it that makes you pause. She&#39;s standing by the supply closet, her hands resting lightly on the handle of a mop propped against a bucket.
&lt;&lt;player&gt;&gt;Yes, ?Madame?&lt;&lt;/player&gt;&gt;
She gestures to the mop and bucket and looks at you with a stoic expression.
&lt;&lt;velma&gt;&gt;Tonight, your job is cleaning the bathrooms.&lt;&lt;/velma&gt;&gt;
You blink, unsure if you&#39;ve heard her correctly.
&lt;&lt;player&gt;&gt;The bathrooms? You want &lt;em&gt;me&lt;/em&gt; to...&lt;&lt;/player&gt;&gt;
She takes a step closer, she tilts her head and talks softy as to gently remind you of something.
&lt;&lt;velma&gt;&gt;Part of your job here is fitting in. That means taking on all the same tasks that I give your colleagues, whatever they are. People will start to notice if I keep skipping you for bathroom duty.&lt;&lt;/velma&gt;&gt;
Though you hate admitting it, she&#39;s right... You&#39;ll have to do &lt;em&gt;shit&lt;/em&gt; jobs like this from time to time as well if you want to work here.
&lt;&lt;velma&gt;&gt;The tools are here. Do it properly, and it won&#39;t take as long as you think.&lt;&lt;/velma&gt;&gt;
&lt;&lt;player&gt;&gt;Right. I... I&#39;ll get to it.&lt;&lt;/player&gt;&gt;
She nods, stepping back toward the bar without another word. You grab the bucket and mop and make your way toward the bathrooms. You take a breath, steel yourself, and push open the door to get started.

&lt;&lt;decision &#39;Start cleaning the bathroom&#39; &#39;Tavern Work Event Bathroom Cleaning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="608" name="Tavern Work Event Bathroom Cleaning" tags="" position="975,7600" size="100,100">&lt;&lt;setlocation Toilets&gt;&gt;
You make your way into the bathroom. The place reeks of piss and spilled beer, the latter also contributing to the ambience by making the floor stickier, or well, you hope it&#39;s the latter. You suddenly realise that you don&#39;t quite notice how dirty a place is until you&#39;ve been given the task to clean it.?nl
This is probably the most extreme example of work that is complete opposite to what your royal hands are used to. Nevertheless, you grab a sponge from the bucket and start scrubbing the sinks. Since everything is dirty you figure there&#39;s not much point to thinking about what to clean first.?nl
After a long while you somehow do find yourself in this decision-making thought process though. You stand before the bathroom stalls, delaying the worst by taking your time to meaninglessly decide what toilet to clean first. At least, you think it is meaningless until you stare at the doors of the last two stalls and read a cryptic note displayed between them.

&lt;&lt;note&gt;&gt;
    Hark, fair traveler!?nl
    If thou seek&#39;st thy sword well polished, turn thee left to get your way.?nl
    Yet if thou art a harlot, step to the right, without delay.?nl
    Thine deeds within are cloaked from sight; none shall say.?nl
    Let mouths meet wood for secret glory. Callooh callay!
&lt;&lt;/note&gt;&gt;

Well, you&#39;re not really sure what that&#39;s all about... Probably best to just pick a stall and get this all over with.

&lt;&lt;decision &#39;Pick the left stall&#39; &#39;Tavern Work Event Bathroom Gloryhole Receiving&#39; dominance small&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Pick the right stall&#39; &#39;Tavern Work Event Bathroom Gloryhole Giving&#39; submissiveness small&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Just focus on cleaning as fast as possible&#39; &#39;Tavern Work Event Bathroom Cleaning Finish&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="609" name="Tavern Work Event Bathroom Gloryhole Receiving" tags="spicy" position="1100,7600" size="100,100">You enter the small bathroom stall and waste no time to start cleaning. You get momentarily distracted as you notice a perfectly round hole on the right wall, opening up to the stall next to you. You quickly decide to not pay it any mind and continue your toilet scrubbing.?nl
Luckily the toilet wasn&#39;t in too bad a state and you quickly get done cleaning it. Even now, you are still not used to this dirty feeling and you take a moment to carefully wash your hands before you enter the stall again to start mopping the floor.?nl
The moment that you enter the stall you hear someone else walk into the bathroom, you quickly lock your stall door to make sure they don&#39;t accidentally walk in while you&#39;re still cleaning, close one too as they seem to be entering the stall right next to you. The strange hole definitely decreases both your privacy. Fortunately, it&#39;s dark enough that it&#39;s difficult to really look through the hole at all.?nl
You&#39;re almost done mopping the floor, taking care of every nook and cranny. The moment you turn around, you make out something strange.?nl
Through the hole in the wall, you notice an open mouth and extended tongue pointing in your direction. You stare at this for quite some time, unsure what to do until the person on the other side starts talking.
&lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Psst, are you going to give it to me or what?&lt;&lt;/say&gt;&gt;
Unsure what to do, you still stand there, frozen in place.
&lt;&lt;player&gt;&gt;Uhm... Give you what exactly?&lt;&lt;/player&gt;&gt;
The hole person lets out an annoyed sigh and moves away from the hole, retreating back into the darkness.
&lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Ugh... Do you even know what stall you are in? I&#39;m talking about your cock, of course!&lt;&lt;/say&gt;&gt;
Oh... OH... Huh, the purpose of the hole and that note outside suddenly make a lot more sense now... After having a brief moment of this strange situation finally making sense you realise you still haven&#39;t answered the person in the stall next to you as you consider what to do next. Are you actually thinking about sticking your ?cock through this hole? &lt;&lt;if settings.sph&gt;&gt;You can&#39;t help but wonder if the person is even looking for someone with a penis of your size...&lt;&lt;/if&gt;&gt;?nl

&lt;&lt;decision &#39;Stick your cock through the hole&#39; depravity small&gt;&gt;
    &lt;&lt;addtag &#39;gloryhole&#39;&gt;&gt;
    You decide to simply go with the flow of the situation and quickly free your ?penis. You move towards the hole and slowly stick it through, awkwardly hugging the wall at the same time.?nl
    &lt;&lt;if settings.sph&gt;&gt;
        Shortly after showing your ?dick, you hear a surprised snicker coming from the other side.
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Oh my, you&#39;re not really a shower then? Here, let me help you out with that.&lt;&lt;/say&gt;&gt;
        You immediately feel a warm mouth envelop your ?penis. A tongue is deftly licking all over your soft shaft and you instantly feel blood flowing to harden it. This anonymous mouth quickly gets to sucking, which rapidly makes you stand full mast.?nl
        The person takes a short break as you feel them release your ?penis, probably to inspect if you&#39;re hard.
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Wow. Not a grower either then... That&#39;s... disappointing... I was hoping to suck some big cock tonight, not this tiny thing.&lt;&lt;/say&gt;&gt;
        The embarrassment of the situation somehow turns you on even more, making your ?dick twitch. You somehow feel the need to apologise for being this way.
        &lt;&lt;player&gt;&gt;I&#39;m- I&#39;m sorry that it&#39;s not bigger...&lt;&lt;/player&gt;&gt;
        Suddenly they seem to quickly change their tone a bit.
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Oh shit, don&#39;t apologise, that&#39;s even more pathetic. Here, can&#39;t believe I&#39;m saying this but I&#39;ll suck you off, okay? Come to think of it, you&#39;re probably the easiest to deepthroat I&#39;ve ever experienced...&lt;&lt;/say&gt;&gt;
        They finish that thought by instantly taking your entire ?cock into their mouth and sucking it up and down a few times, stimulating you with their tongue. They pull their mouth away to say something degrading again while stroking you with two fingers.
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Well, it&#39;s not really deepthroating since you can&#39;t even reach my throat at all...&lt;&lt;/say&gt;&gt;
        Your cock twitches at their remarks. Why does this humiliation always turn you on like this so much...
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Ah, you like it when I call your cock tiny, don&#39;t you?&lt;&lt;/say&gt;&gt;
        Great, now they know. Before you respond they immediately start sucking again.
        &lt;&lt;player&gt;&gt;M- Maybe...&lt;&lt;/player&gt;&gt;
        Their expert blowjob skills takes you very close to your climax, though you painfully wonder to yourself if that could also be because of all the degrading remarks. There&#39;s not much cock-length to use so they&#39;re moving up and down the entire size rather quickly.
        &lt;&lt;player&gt;&gt;Ah! I&#39;m getting c- close...&lt;&lt;/player&gt;&gt;
        The person immediately stops sucking as they opt to switch to their two-finger stroking instead. Your cock is being stroked faster and faster. You once again hear their soft voice making fun of your manhood.
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;I&#39;ve never stroked a cock with only two fingers before, any more would be too much for you.&lt;&lt;/say&gt;&gt;
        You&#39;re getting closer to the edge as you hear these remarks.
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Come on, just like that. Tell me you have a pathetic tiny penis and I&#39;ll let you cum.&lt;&lt;/say&gt;&gt;
        You really don&#39;t like the idea of them stopping the handjob so close to your finish so you decide to go along with it almost instantly.
        &lt;&lt;player&gt;&gt;Ah! I- I have a p- pathetic... t- tiny... penis... Ah- I&#39;m cumming!&lt;&lt;/player&gt;&gt;
        Speaking out loud what you were commanded to say instantly brings you over the edge as you enjoy your intense orgasm. You don&#39;t even pay any mind to their laughter as your ?penis cums through the hole.
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Wow, that was actually kind of fun. Just a word of advice though: You might want to reconsider entering that stall again. Not everyone will be as lenient as me when you show that thing. Come to think of it, maybe you&#39;d be better off on this side of the wall instead... Anyways, I&#39;ll be going now.&lt;&lt;/say&gt;&gt;
        &lt;&lt;player&gt;&gt;Uhm, okay. Thanks...&lt;&lt;/player&gt;&gt;
    &lt;&lt;else&gt;&gt;
        Shortly after showing your ?dick, you immediately feel your entire length being enveloped by a warm mouth. A tongue is deftly licking all over your soft shaft and you instantly feel blood flowing to harden it. This anonymous mouth quickly gets to sucking, which rapidly makes you stand full mast.?nl
        The person seems to be totally into it, sucking you rapidly and stroking the rest of your length at the same time. They take a quick break to switch to handjob only while you hear their soft moans as they&#39;re working your ?cock, they must really enjoy giving blowjobs.
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;That&#39;s a great cock... Do you want to try fucking my face?&lt;&lt;/say&gt;&gt;
        Without waiting for a response, you let your cock be pushed backwards. You see the soft lips appear through the hole as you look down, prepared to let you fuck their mouth. You immediately take the opportunity as you force your cock through her gaping mouth. They carefully hold it in place to let you pump in and out of their head with ease.
        &lt;&lt;img &#39;tavern/gloryhole/gloryhole_receiving.gif&#39; &#39;ridge-border&#39;&gt;&gt;
        You fuck their mouth for a good amount of time before they back off, signalling that they&#39;ll take over again. Their precise stroking and expert blowjob skills very quickly bring you close to the edge.
        &lt;&lt;player&gt;&gt;Ah! I&#39;m getting c- close...&lt;&lt;/player&gt;&gt;
        The person immediately stops sucking as they opt to switch to a handjob instead. Your cock is being stroked faster and faster.
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Ah fuck yeah... Cum for me, baby.&lt;&lt;/say&gt;&gt;
        You let out a long moan as you are brought over the edge, enjoying your intense orgasm. You retreat out of the hole right after you feel an affectionate kiss placed on the tip of your penis.
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;That was great, thanks honey!&lt;&lt;/say&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    You hear them open their stall door and quickly leave the bathroom. You sit down on the toilet, taking some time to recover from your intense orgasm. Did that just really happen? You decide to not spend too much time thinking about the situation as you still have to finish your cleaning.
    &lt;&lt;decision &#39;Finish cleaning the bathrooms&#39; &#39;Tavern Work Event Bathroom Cleaning Finish&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;disableif isInChastity()&gt;&gt;
    You are locked in chastity.
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Decline&#39; virtue small&gt;&gt;
    &lt;&lt;player&gt;&gt;Ah I&#39;m sorry, I&#39;m just here to clean the toilets, I didn&#39;t know about this.&lt;&lt;/player&gt;&gt;
    &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Oh, that&#39;s okay, I didn&#39;t know you&#39;re new here. I&#39;ll just wait for the next one.&lt;&lt;/say&gt;&gt;
    &lt;&lt;player&gt;&gt;Okay, uhm- have fun.&lt;&lt;/player&gt;&gt;
    You awkwardly continue you with your work, opting to leave the person in their stall alone.
    &lt;&lt;include &#39;Tavern Work Event Bathroom Cleaning Finish&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="610" name="Tavern Work Event Bathroom Gloryhole Giving" tags="spicy" position="1225,7600" size="100,100">You enter the small bathroom stall and waste no time to start cleaning. You get momentarily distracted as you notice a perfectly round hole on the left wall, opening up to the stall next to you. You quickly decide to not pay it any mind and continue your toilet scrubbing.?nl
Luckily the toilet wasn&#39;t in too bad a state and you quickly get done cleaning it. Even now, you are still not used to this dirty feeling and you take a moment to carefully wash your hands before you enter the stall again to start mopping the floor.?nl
The moment that you enter the stall you hear someone else walk into the bathroom, you quickly lock your stall door to make sure they don&#39;t accidentally walk in while you&#39;re still cleaning, close one too as they seem to be entering the stall right next to you. The strange hole definitely decreases both your privacy. Fortunately, it&#39;s dark enough that it&#39;s difficult to really look through the hole at all.?nl
You&#39;re almost done mopping the floor as you crouch down to be able to reach every nook and cranny. The moment you turn around and look up, you see something poking out of the hole.
&lt;&lt;img &#39;tavern/gloryhole/gloryhole_dick.gif&#39; &#39;ridge-border&#39;&gt;&gt;
Yup. That&#39;s a cock. You&#39;re currently crouched down in a bathroom stall and looking up at a cock, mere inches from your face. After staring at it for some time your mind has a vivid moment of the whole thing finally making sense, the note on the doors, the hole in the wall. Yup. It&#39;s for cock.?nl
You&#39;re staring for an awkward amount of time now, unsure what to do while the cock is just sitting there. The silence is finally broken by a voice, probably coming from the person that owns the cock.
&lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Are you going to do help me out here or what?&lt;&lt;/say&gt;&gt;
Wow. The cock-owner is definitely impatient. But maybe it&#39;s fair since you&#39;re the one simply sitting here like a deer caught in lantern-lights. Your mind refocuses on the now and you finally decide to move. Are you seriously considering touching that thing? &lt;&lt;if settings.sph&gt;&gt;Your mind can&#39;t help but compare this big stick to your own much smaller twig, it&#39;s definitely at least twice the size.&lt;&lt;/if&gt;&gt;?nl

&lt;&lt;decision &#39;Pleasure the cock&#39; depravity small&gt;&gt;
    &lt;&lt;addtag &#39;gloryhole&#39;&gt;&gt;
    &lt;&lt;addsin &#39;blowjob&#39;&gt;&gt;
    Deciding to go the adventurous route, you position yourself properly in front of the hole as you get down on your knees and answer the impatient person.
    &lt;&lt;player&gt;&gt;Y- Yes...&lt;&lt;/player&gt;&gt;
    In full exploration mode - like a caveman first discovering fire - you give a single poke to the already hard boner to see how it responds. The massive thing bounces back at your prod and you take the opportunity to hold the shaft in your hand. The cock feels nice and warm as you start moving up and down.
    &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;New to this, are you? Well don&#39;t worry, I have all the time in the world for you. Get a good feel for it. It&#39;s impressive, isn&#39;t it?&lt;&lt;/say&gt;&gt;
    You roll your eyes as he&#39;s being cocky about his cock. You don&#39;t take your hands off of it though. It&#39;s difficult to admit but he&#39;s definitely right... You decide that maybe you should actually play into his ego.
    &lt;&lt;player&gt;&gt;Yeah... It&#39;s really big...&lt;&lt;/player&gt;&gt;
    I mean it might be because you&#39;re literally face to face with it now but the thing is massive. Your vertical vision is entirely covered with cock, balls to tip.
    &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;I know, right? Why don&#39;t you give it a kiss.&lt;&lt;/say&gt;&gt;
    You are taken slightly aback by his suggestion before you actually consider doing it. You stare at his cock head as you start licking your lips. You lean slightly forward and plant a soft wet kiss on the tip of his penis.
    &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;That&#39;s a good slut... Why don&#39;t you take it into your mouth while you&#39;re at it.&lt;&lt;/say&gt;&gt;
    He wouldn&#39;t have to ask you twice, your mouth is already watering at the prospect and quickly lean forward even more to take the cock into your mouth, tongue swirling around the head of his penis. The taste is strangely pleasant as you feel the rod going deeper in your mouth.?nl
    You can&#39;t seem to get the entire cock into your mouth, only getting about halfway before your gag reflex kicks in. You quickly decide to make up for the rest by stroking the base.
    &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Ah fuck, that&#39;s great. Keep going.&lt;&lt;/say&gt;&gt;
    You&#39;re getting really into it as you start blowing the cock faster and faster.
    &lt;&lt;img &#39;tavern/gloryhole/gloryhole_giving.webp&#39; &#39;ridge-border&#39;&gt;&gt;
    You mind feels at peace as your head is slowly filled with more and more cock. How would he respond when he learns that it is the prince who&#39;s currently sucking him off? You consider the fact that this might be your true purpose in life, sucking off anonymous people in a dirty bathroom stall. The thought strangely enough brings you a satisfied feeling and you continue your current task with more diligence. You try taking the cock deeper and deeper, and you actually feel yourself making good progress as you feel his tip in the back of your throat.
    &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Wow, that feels amazing! It&#39;s like you&#39;re made for this!&lt;&lt;/say&gt;&gt;
    His compliments actually make you feel a mix of pride and arousal as you continue your work.
    &lt;&lt;if isInChastity()&gt;&gt;
        You feel your ?cock straining inside your chastity cage, you can&#39;t believe you&#39;re actually this turned on and can&#39;t do anything about it. You instead opt to focus your arousal on the most important thing instead: his pleasure.
    &lt;&lt;else&gt;&gt;
        It&#39;s only now that you realise your ?dick is standing at full mast under your clothes. While you&#39;re working on his cock with your mouth and one hand, you slip the other one in your underwear and start stroking yourself. &lt;&lt;if settings.sph&gt;&gt;Two fingers is always your go-to for masturbating, that would never be enough for the massive thing in your mouth though.&lt;&lt;/if&gt;&gt;
    &lt;&lt;/if&gt;&gt;?nl
    You feel like you&#39;re getting in a majestic cock-sucking flow, at one with nature. You would want to enjoy this moment forever before you are suddenly interrupted by his voice.
    &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Ah fuck, I&#39;m getting close! Get ready for my cum!&lt;&lt;/say&gt;&gt;
    Well, all good things must come to an end, you suppose. 
    &lt;&lt;if settings.cum&gt;&gt;
        Though, this ending does have you quite excited and turned on. What will you do with that sweet batch of white goo you&#39;re about to receive??nl
        &lt;&lt;decision &#39;Let him cum in your mouth and swallow&#39; depravity small&gt;&gt;
            &lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;
            You can&#39;t wait to get his sperm in your mouth and the thought alone drives you crazy. It&#39;s the same for him apparently as you are now basically just holding your mouth against the hole and he&#39;s fucking your face-hole. He&#39;s panting heavily as you feel his cock starting to pulse in your mouth. He moans loudly while he cums.
            &lt;&lt;img &#39;tavern/gloryhole/gloryhole_swallow.gif&#39; &#39;ridge-border&#39;&gt;&gt;
            You immediately take a moment to enjoy the taste of his semen and proceed to swallow his entire load, proudly presenting your empty mouth as you open it and show it through the hole.
            &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Damn, I didn&#39;t know you&#39;re a cum-slut as well... That was amazing...&lt;&lt;/say&gt;&gt;
            &lt;&lt;include &#39;Tavern Work Event Bathroom Gloryhole Giving End&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
        &lt;&lt;decision &#39;Let him cum on the floor&#39;&gt;&gt;
            It doesn&#39;t take long for his warning to turn real as you bring him over the edge. You quickly dodge to the side as his orgasm approaches. He&#39;s moaning loudly while experiencing this.
            &lt;&lt;img &#39;tavern/gloryhole/gloryhole_spit.gif&#39; &#39;ridge-border&#39;&gt;&gt;
            &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Fuuuckkk, that feels amazing... Wow, thank you for that.&lt;&lt;/say&gt;&gt;
            &lt;&lt;include &#39;Tavern Work Event Bathroom Gloryhole Giving End&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;else&gt;&gt;
        It doesn&#39;t take long for his warning to turn real as you bring him over the edge. You quickly dodge to the side as his orgasm approaches. He&#39;s moaning loudly while experiencing this.
        &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Fuuuckkk, that feels amazing... Wow, thank you for that.&lt;&lt;/say&gt;&gt;
        &lt;&lt;include &#39;Tavern Work Event Bathroom Gloryhole Giving End&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Decline him&#39; virtue small&gt;&gt;
    &lt;&lt;player&gt;&gt;Ah I&#39;m sorry, I&#39;m just here to clean the toilets, I didn&#39;t know about this.&lt;&lt;/player&gt;&gt;
    The cock quickly retreats back through the hole.
    &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Oh, that&#39;s okay, I didn&#39;t know you&#39;re new here. Sorry about that. I&#39;ll just wait to see if someone else comes along.&lt;&lt;/say&gt;&gt;
    &lt;&lt;player&gt;&gt;Okay, uhm- have fun.&lt;&lt;/player&gt;&gt;
    You awkwardly continue you with your work, opting to leave the person in their stall alone.
    &lt;&lt;include &#39;Tavern Work Event Bathroom Cleaning Finish&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="611" name="Tavern Work Event Bathroom Gloryhole Giving End" tags="" position="100,7725" size="100,100">&lt;&lt;if isInChastity()&gt;&gt;
    You actually find yourself out of breath as you mutter out a reply.
&lt;&lt;else&gt;&gt;
    &lt;&lt;addsin &#39;masturbation&#39;&gt;&gt;
    Though your job is done, you still find yourself on your knees with one hand around your ?penis, mind only focused on what just happened. You are masturbating rapidly, not really caring if he hears you or not. It seems like he does, as you don&#39;t hear him moving around anymore. Suddenly, you once again see his majestic cock as he pushes it through the hole again.?nl
    Even though it&#39;s now soft, it&#39;s still impressive and it seems like he wants to let you play with it to help you reach your orgasm. You take his softening cock into your mouth&lt;&lt;if settings.cum&gt;&gt; and savor the taste of his cum still on it&lt;&lt;/if&gt;&gt;.
    &lt;&lt;say &#39;Anonymous person&#39;&gt;&gt;Yeah, you like that, don&#39;t you? Keep stroking your cock while you clean mine with your tongue.&lt;&lt;/say&gt;&gt;
    His commanding voice very quickly sends you over the edge. You take his cock as deep as you can and moan loudly, muffled by his member as you cum all over the bathroom floor. You savor the moment before you notice you&#39;re not really breathing anymore and let yourself slide off of his dick. You quickly give him a loving kiss on the tip before he pulls it back through the hole.
&lt;&lt;/if&gt;&gt;
&lt;&lt;player&gt;&gt;Thank you for the cock...&lt;&lt;/player&gt;&gt;
He gives a satisfied chuckle as you hear him open his stall door and exit the bathroom, leaving you alone on your knees in front of the gloryhole. You take some time to recover from what just happened. Did that just really happen? You decide to not spend too much time thinking about the situation as you still have to finish your cleaning.
&lt;&lt;decision &#39;Finish cleaning the bathrooms&#39; &#39;Tavern Work Event Bathroom Cleaning Finish&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="612" name="Tavern Work Event Bathroom Cleaning Finish" tags="" position="225,7725" size="100,100">&lt;&lt;setlocation &#39;Tavern&#39;&gt;&gt;
You&#39;re definitely tired by now but luckily it doesn&#39;t take too long for you to finish your task. You finally make your way out of the bathroom, clothes dirty as you start putting away the mop and bucket. 
&lt;&lt;eve&gt;&gt;Hey, ?newname. Nice work on the bathroom!&lt;&lt;/eve&gt;&gt;
&lt;&lt;player&gt;&gt;Thanks... That&#39;s definitely some work...&lt;&lt;/player&gt;&gt;

&lt;&lt;if hasTag(&#39;gloryhole&#39;)&gt;&gt;
    You still can&#39;t believe what happened inside there. Why is there even a gloryhole in the first place? As you&#39;re lost in thought you see her stare at you with a mischievous smile.
    &lt;&lt;eve&gt;&gt;I bet... You were in there for so long, weren&#39;t you?&lt;&lt;/eve&gt;&gt;
    Unsure what she means exactly, her intent becomes immediately clear as she raises her eyebrows and rephrases her question.
    &lt;&lt;eve&gt;&gt;Did you have any &lt;em&gt;fun&lt;/em&gt; while you were in there?&lt;&lt;/eve&gt;&gt;
    Does she... Does she know that you went to the gloryhole? You immediately feel embarrassed and your cheeks start reddening. She doesn&#39;t seem to be awkward about it at all, strangely enough.
    &lt;&lt;eve&gt;&gt;Hehe, I thought so. Well, you don&#39;t have to tell me about it if you don&#39;t want to.&lt;&lt;/eve&gt;&gt;
    She gives you a cute wink as she walks away to finish her work for the evening. Probably time for you to do the same.
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="613" name="Tavern Work Event Drunks Catcalling" tags="" position="350,7725" size="100,100">You&#39;re pretty far through your shift when you&#39;re tasked to bring a tray of drinks to the rowdiest table at the tavern. Half a dozen rough looking guys have claimed this corner of the place as their own. They seem to pay no mind to their obnoxiously loud carousing. Two of them are having some kind of fight when one of them crashes into a nearby table, causing other patrons to quickly leave that side of the tavern.?nl
You gulp as you anxiously bring the tray of drinks to the table at the center of them. Their revelry seems to stop for a moment as you suddenly feel all their eyes on you. You immediately feel miles out of your comfort zone, there&#39;s a bunch of drunk louts staring at you in your - clearly working - feminine disguise.?nl
You set down the tray with drinks and some of the men immediately reach for a mug. One man, seated in your direct vicinity, whistles loudly at you with a lecherous smile.
&lt;&lt;say &#39;Drunkard&#39;&gt;&gt;Wew, you&#39;re quite the beauty, lass. Why don&#39;t you join us and we can get to know each other a bit better?&lt;&lt;/say&gt;&gt;
His not so subtle invitation seems to immediately get the other drunks invested as well as they start lustfully cheering you on by whistling and trying to peer pressure you into joining them. The man who asked the question holds out a drink to you, waiting expectantly at your response. It feels like a very stupid idea to join them, it&#39;s probably best to get out of this situation as fast as possible. Though coincidentally, you are close to your break time, perhaps all they want is to share one drink...?nl


&lt;&lt;decision &#39;Make eye contact with ?Eve and have her save you&#39; &#39;Tavern Work Event Drunkards Catcalling Intervention&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Decline them directly&#39; dominance medium&gt;&gt;
    While the man is holding out the drink to you, you suddenly start laughing at him.
    &lt;&lt;player&gt;&gt;Hahaha! You really think you&#39;d have a shot at me with that line? Come on!&lt;&lt;/player&gt;&gt;
    He looks at you, quite confused and the whooping from the other guys quickly quiets down as well.
    &lt;&lt;player&gt;&gt;I mean for real, you all reek like the piss-drenched alley outside, why would I ever want to drink with you?&lt;&lt;/player&gt;&gt;
    The man awkwardly tries to respond, apparently trying to actually give a serious answer to that question in a now quite desperate display. You quickly spare him the situation by interjecting him.
    &lt;&lt;player&gt;&gt;That was a rhetorical question, dear. If you can&#39;t even recognize that perhaps you&#39;ve had enough to drink for tonight. How about you all finish your drinks and then get out of here in an orderly manner before you start bothering more people?&lt;&lt;/player&gt;&gt;
    The men around somehow actually seem hurt by your directness. Good. You turn to the instigator drunkard one last time.
    &lt;&lt;player&gt;&gt;To make it clear: That&#39;s also rhetorical. In fact, it&#39;s more of an order, actually.&lt;&lt;/player&gt;&gt;
    You gather some empty tankards and make your way back to the bar where you see ?Velma looking at you with a smile.
    &lt;&lt;velma&gt;&gt;Well done, ?newname. I&#39;ve been looking for a reason to make them leave. Quite impressive.&lt;&lt;/velma&gt;&gt;
    You nod at her and try to act cool in this intense internal moment of feeling like a boss ass bitch and gaining her approval for it.
    &lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Accept the drink&#39; submissiveness small&gt;&gt;
    This is probably a mistake but what the hell, might as well have one drink.
    &lt;&lt;player&gt;&gt;Ah- uhm- sure- I can probably join for one drink...&lt;&lt;/player&gt;&gt;
     You accept the mug and take a swig. The men around seem to be quite happy with this as they start cheering you on. The drunk next to you still has that lecherous smile as he pats the empty chair next to him.
     &lt;&lt;say &#39;Drunkard&#39;&gt;&gt;Can&#39;t have a fine lady like you simply stand there! Take a seat, pretty!&lt;&lt;/say&gt;&gt;
     You awkward sit down and only after notice the chair is placed suspiciously close to this gentleman. You can clearly smell his alcoholic odour from here.?nl
     Though all of them are abundantly aware of your presence, most other men resume loudly talking with each other. You don&#39;t really pay attention to the conversation, still confused as to how you ended up in this situation.?nl
     As you&#39;re wondering what it is exactly that you&#39;re doing here you feel the drunken man next to you move to slowly put his hand over your hand and hold it, resting on your lap under the table. You look at him confused as he gives you a lustful wink.?nl
     &lt;&lt;decision &#39;Quickly get out of the situation&#39; &#39;Tavern Work Event Drunkards Catcalling Intervention&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
     &lt;&lt;decision &#39;Let him move your hand&#39; &#39;Tavern Work Event Drunkards Catcalling Handjob&#39; depravity medium&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="614" name="Tavern Work Event Drunkards Catcalling Intervention" tags="" position="475,7725" size="100,100">You quickly look over the bar and try to spot ?Eve. It looks like she was already watching out for you as she seems to be observing the situation closely. The look of desperation on your face is all that was needed to set her off. She nods at you with an angry look on her face and storms over, full of determination to safe you from this situation.
&lt;&lt;eve&gt;&gt;Hey! That&#39;s enough, you wretches! She&#39;s clearly not having it!&lt;&lt;/eve&gt;&gt;
She immediately pulls you away from the group and uses a fiery gaze that you have never seen her don before as she stares at the drunks.
&lt;&lt;say &#39;Drunkard&#39;&gt;&gt;Ah come on, ?Eve! We we&#39;re just playing with the new barmaid is all! No harm done, right lass?&lt;&lt;/say&gt;&gt;
The man looks at you, hoping that you vouch for him in order to deflate the situation. It seems like ?Eve isn&#39;t even waiting to hear what you have to say as she has already made her own assessment of the situation.
&lt;&lt;eve&gt;&gt;Nope, harm&#39;s definitely done. Just like you. You&#39;re drunk, way too rowdy, and now rude to the staff as well. Time to get out of here before I call ?MadameVelma.&lt;&lt;/eve&gt;&gt;
She forcefully takes some tankards from the men as they are groan with annoyance. Luckily they know when to call it quits as they all reluctantly get up and start leaving the establishment. Most of them seem to direct their anger at the guy who invited you in the first place, calling him all kinds of stupid for his stupid actions.?nl
?Eve keeps staring daggers at them until they all leave and she turns to you look at you with a smile.
&lt;&lt;eve&gt;&gt;You alright, dear?&lt;&lt;/eve&gt;&gt;
You nod at her and give her a quick hug, thanking her for the intervention.
&lt;&lt;player&gt;&gt;Thanks, ?Eve. I&#39;m doing much better now.&lt;&lt;/player&gt;&gt;
&lt;&lt;eve&gt;&gt;Don&#39;t worry, you can always call on me when something like that happens. I was looking for a reason to kick them out anyways, I&#39;m glad you called me over!&lt;&lt;/eve&gt;&gt;

&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="615" name="Tavern Work Event Drunkards Catcalling Handjob" tags="spicy" position="600,7725" size="100,100">&lt;&lt;set $paycheck += 5&gt;&gt;

Something about this situation has you feeling strangely aroused and you respond to his wink by giving him a slight nod. Having received your approval, the man softly grabs your hand and starts moving it in his direction. Being seated so close to him makes it easy for him to take your hand and place it directly on his crotch without drawing too much attention. You immediately feel the hardness in his pants as it seems he&#39;s already at full mast for you.?nl
You use your fingers to timidly feel the entirety of his manhood. Strangely enough, he&#39;s still holding on to your wrist as you&#39;re exploring the details of his cock through the fabric of his pants.?nl
Though it seems like most of the other guys are focused on the conversation, you catch a few glances towards your arm, currently rotated towards this man&#39;s crotch under the table. While you&#39;re anxiously wondering whether they&#39;re on to the situation, the man whose bulge you&#39;re currently palpating leans over to whisper in your ear.
&lt;&lt;say &#39;Drunkard&#39;&gt;&gt;Don&#39;t worry, I just need to borrow your hand for a bit, you won&#39;t even have to do anything, you pretty thing...&lt;&lt;/say&gt;&gt;
You feel the man suddenly start to move your hand up and down under the table, keeping hold of your wrist. You tighten your grip around his bulge as he starts actively using your hand as a masturbation tool. His upper body is still turned slightly towards you as you hear his breathing turn into the hint of moans. You would focus more on keeping this thing a secret but unfortunately the situation has you too aroused to pay real mind to that.?nl
Something about having a man you don&#39;t know use your hand as a sex toy in the middle of a busy tavern has you extremely aroused. You actually find your eyes drifting down and looking at his bulge while he&#39;s pumping your hand aggressively over the entirety of it.?nl
&lt;&lt;if isInChastity()&gt;&gt;
    It&#39;s a good thing you&#39;re wearing a chastity cage, otherwise you&#39;d have to worry about people spotting your boner now too. Downside is that your cock is absolutely straining in your little cage, somehow making you even more aroused. What would these rough men do if they found out you&#39;ve got your ?penis locked up in a cage? Would they all laugh and call you a sissy, knowing you could never be as manly as them?
&lt;&lt;elseif settings.sph&gt;&gt;
    It&#39;s a good thing your own cock is not quite nearly as big as the one you&#39;re currently pleasuring, otherwise you&#39;d have to worry about people spotting your boner now too. The thought of that strangely arouses you as well. What would these rough men do if they found out you&#39;re not a girl but actually have the smallest little penis they&#39;ve ever seen? Would they laugh at you and draw the attention of the entire tavern, pointing it out for everyone?
&lt;&lt;else&gt;&gt;
    You suddenly find yourself worried about a whole new problem. Your own ?penis is now also full mast, making a tent inside your dress. It would be so embarrassing if they spotted it... Well... The idea of them seeing you crossdressing somehow intrigues you. What would they do if they found out you&#39;re not actually a woman but simply pretending right now? Is the thought of that actually turning you on as well?
&lt;&lt;/if&gt;&gt;
?nl 
You let your mind pervertedly wander about these questions simultaneously as your hand is being used to pump up and down faster and faster. Your arousal brings you in a lustful autopilot as you subconsciously help the man stroke himself as much as possible. You tighten your hand more for him and he seems to be approving of this.?nl
Perhaps he approves a little too much. Your kinky day-dreaming has you notice far too late that the man currently occupying your hand with his cock seems to let go of the idea of doing this secretly as he&#39;s leaned back, displaying his new toy for all to see as he pumps aggressively some last few times and groans loudly.?nl
You suddenly feel the wetness through the his pants as he climaxes using only your hand.&lt;&lt;if settings.cum&gt;&gt; You can clearly feel his warm cum seeping through the fabric as you see the dark stain appear on his crotch. That&#39;s quite a load... Even though he&#39;s already let go of your wrist, you seem to be holding on for a bit longer, allowing your hand to be soiled by his seed.&lt;&lt;/if&gt;&gt;?nl
Time freezes for a moment as you try to process what just happened. You are forcefully brought to the now as you hear all the guys around burst out laughing. Luckily, they seem to only be laughing at the guy you just helped orgasm.
&lt;&lt;say &#39;Other drunkard&#39;&gt;&gt;Hahaha! Look at his pants! Did you just seriously cum after getting touched for only like twenty seconds?!&lt;&lt;/say&gt;&gt;
Now that you think about it, he&#39;s right, that did go rather quickly. Granted the whole thing probably took closer to a full minute but maybe you lustfully zoned out for a bit as well there...?nl
The man is quickly taken out of his post-orgasm high as all his friends seem to be turning on him. His cheeks turn bright red as he stammers an excuse. It doesn&#39;t seem like they&#39;re having it though, one guy is laughing so hard he fell off his chair. They&#39;re all making pretty brutal jokes about him with premature ejaculation being the main theme. You kind of feel bad for the man as he&#39;s now decided to get up and quickly leave the tavern, trousers clearly stained. His &quot;friends&quot; don&#39;t seem quite finished as they decide to follow him, laughing loudly as they exit together. Poor guy.?nl
You reflect on this weird moment while cleaning out their table, you can&#39;t believe you actually gave a drunk stranger a handjob in front of his friends. As you take away the tankards, you notice &lt;&lt;money gold false 5&gt;&gt; golden coins laid on the table in front of the empty seat of your now slightly-better acquainted drunkard. Even though he was being pestered, it looks he didn&#39;t forget to give you a nice tip for letting him use your hand. You pocket the coin and wash your hands before continuing your shift.

&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="616" name="Tavern Work Event Shady" tags="" position="725,7725" size="100,100">@TODO shady merchant comes over to sell snake oil stuff
&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="617" name="Tavern Work Event Heroes" tags="" position="850,7725" size="100,100">@TODO Classic D&amp;D group, complain about crazy event (e.g.fighting dragons) and tips an obscene amount
&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="618" name="Tavern Work Event Adventurer" tags="" position="975,7725" size="100,100">@TODO level 1 adventurer trying to get a quest (asks if there are any rats in the basement that need dealing with)
&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="619" name="Tavern Work Event Pee" tags="" position="1100,7725" size="100,100">The tavern is full to bursting this evening, apparently due to a traveling caravan that has stopped in the town for the night. You rush to fill orders, barely having time to catch your breath, and as the hours pass your bladder is starting to feel just as full as the tavern.?nl

When you finally catch a spare moment, you head to the bathroom to see that there is a long line of people waiting their turn. The line barely seems to be moving at all, and you can hear what sounds like muffled moaning coming from some of the stalls. It doesn&#39;t seem like the line will be moving faster any time soon.?nl

As you&#39;re standing there, you hear patrons calling impatiently for more drinks. You could wait however long it takes to get through this line, or you could just slip out to the alley for a moment and get back to work...

&lt;&lt;decision &#39;Wait your turn in the line&#39; &#39;Tavern Work Event Pee Wait&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Sneak into the alley to piss&#39; &#39;Tavern Work Event Pee Alley&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="620" name="Tavern Work Event Pee Wait" tags="" position="1225,7725" size="100,100">&lt;&lt;set $paycheck -= 2&gt;&gt;

You wait your turn in the line, which moves excruciatingly slowly. The sounds of patrons calling for service only seems to increase the longer you&#39;re in line, and so does the annoyance in their voices.?nl

Finally you make it into a stall and release your bladder with relief. By the time you get back to your shift, however, an entire table has left without paying. You don&#39;t want this to cause any problems with ?Velma, so with a sigh you slip &lt;&lt;money gold false 2&gt;&gt;gold from tonight&#39;s paycheck into the till to cover the drinks.

&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Work End&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="621" name="Tavern Work Event Pee Alley" tags="" position="100,7850" size="100,100">&lt;&lt;setlocation &#39;Alley&#39;&gt;&gt;

You slip out the back door of the tavern into the alley. You don&#39;t see anyone around, so you turn against the side of the building, feeling as though your bladder is about to burst. Hurriedly, you &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;lift up your skirt&lt;&lt;else&gt;&gt;undo the tie of your pants&lt;&lt;/if&gt;&gt;, pull out your ?dick, and release your bladder with a sigh of relief.?nl

As you&#39;re in the middle of relieving yourself, two shadows pass by at the end of the alley and stop, looking your way. Before you can attempt to hide, you hear an authoritative voice call down the road.

&lt;&lt;say &#39;Guard&#39;&gt;&gt;You there, halt!&lt;&lt;/say&gt;&gt;

Your bladder was so full that now you&#39;ve started, you simply can&#39;t stop. You finish pissing as the guards approach and quickly stuff your ?dick away. One steps forward to speak, while the other lingers behind, a hand casually on his weapon.

&lt;&lt;say &#39;Guard&#39;&gt;&gt;Come now, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;my good woman&lt;&lt;else&gt;&gt;my good man&lt;&lt;/if&gt;&gt;, you know it is a punishable offense to relieve oneself in public.&lt;&lt;/say&gt;&gt;

&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;The guard seems to be looking you up and down curiously, and you realize that from his perspective, he just saw a woman peeing standing up. Luckily, he seems more surprised than skeptical, as if he had no idea women could do such a thing.&lt;&lt;else&gt;&gt;The guard seems to be looking you up and down, as though trying to ascertain if he recognizes you.&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;Ah, I, uh, apologize sir, I work at this establishment and the bathrooms were completely full, and there were so many customers who needed drinks, so I just slipped out quickly... I assure you I don&#39;t normally do this, and it won&#39;t happen again, though I really do need to get back to my shift...&lt;&lt;/player&gt;&gt;

&lt;&lt;say &#39;Guard&#39;&gt;&gt;Oh, you&#39;re not going back to your shift tonight.&lt;&lt;/say&gt;&gt;

The guard looks you up and down again, a small smile forming on his face. He looks back to the other guard, who smirks as well. 

&lt;&lt;say &#39;Guard&#39;&gt;&gt;You do have a choice, of course. A cold night in the dungeons, or a warm few hours in the pillory...&lt;&lt;/say&gt;&gt;

He chuckles, still looking at you intensely. An entire night on a cold, hard dungeon ground certainly sounds unpleasant, but something tells you there&#39;s more to the pillory option than you realize.

&lt;&lt;player&gt;&gt;W-why is time in the pillory...warm?&lt;&lt;/player&gt;&gt;

&lt;&lt;say &#39;Guard&#39;&gt;&gt;Oh, you don&#39;t know? Offenders locked in the pillory are freely available for the public&#39;s use and pleasure. You certainly won&#39;t go cold.&lt;&lt;/say&gt;&gt;

You stare at the guard. Is he implying that people in the pillory are available for the sexual whims of any random passerby? Suddenly time in the pillory sounds frightening, but an entire night in the cold dungeon doesn&#39;t sound particularly nice, either. Both feel like steep punishments, and you&#39;re definitely going to miss the rest of your shift...

&lt;&lt;decision &#39;Choose the pillory&#39; &#39;Pillory Locked Up&#39; depravity medium&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Choose the dungeons&#39; &#39;Dungeons Locked Up&#39; virtue small&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="622" name="Pillory Locked Up" tags="" position="225,7850" size="100,100">You look back to the guard, trying to keep your breathing steady. You&#39;ve never had to answer to authority in this way before, let alone be in trouble with the law. Being powerless to change the situation feels awful, but revealing your identity is simply untenable.?nl

You take a deep breath and stand up straight, trying to salvage your dignity.

&lt;&lt;player&gt;&gt;I will choose the pillory.&lt;&lt;/player&gt;&gt;

In a daze, you allow yourself to be marched to the pillory in the middle of the town square. You feel your head being roughly stuffed into the center hole of a post, and your hands in the two side holes. You hear the click of a lock and the laughter of a guard.

&lt;&lt;say &#39;Guard&#39;&gt;&gt;Someone will unlock you later, once the lesson has fully...penetrated. Enjoy your time.&lt;&lt;/say&gt;&gt;

You hear retreating footsteps and find yourself left there, bent over and on display for the entire town to see. Your mind races as you replay the events of the day, and you realize both how vulnerable and how humiliated this punishment has made you.

&lt;&lt;decision &#39;Wait out your sentence&#39; &#39;Pillory Blowjob&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="623" name="Pillory Blowjob" tags="spicy" position="350,7850" size="100,100">&lt;&lt;setlocation &#39;Town square&#39;&gt;&gt;
&lt;&lt;addsin &#39;blowjob&#39;&gt;&gt;
&lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;
&lt;&lt;if getTime() !== &#39;night&#39;&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;/if&gt;&gt;

You wait there in the pillory, your body starting to hurt in the unnatural position. The townspeople who pass by look at you curiously or laugh at your misfortune. Some throw old food at your head, or yell insults your way. They all eventually move on, leaving you plenty of time to reflect. You chose this option over the dungeons, even though any of these people could apparently stop and use you sexually any time they wanted. There must be some part of you that finds this arousing...?nl

As you&#39;re realizing this, a man stumbles out of ?tavern and stops, looking at you across the town square. There is a moment&#39;s pause, then he starts to swagger toward you. 

&lt;&lt;say &#39;Drunk man&#39;&gt;&gt;Hello there, &lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;pretty girl&lt;&lt;else&gt;&gt;handsome boy&lt;&lt;/if&gt;&gt;. You seem to be in an unfortunate situation...&lt;&lt;/say&gt;&gt;

You struggle to look up at him from your awkward position. You can already see a bulge in his pants, and you wonder if he&#39;s going to pull it out and use you as he wishes. The thought of this is already turning you on.

&lt;&lt;player&gt;&gt;Y-yes, I sure am... I&#39;m, uh, pretty stuck here...&lt;&lt;/player&gt;&gt;

&lt;&lt;say &#39;Drunk man&#39;&gt;&gt;That&#39;s too bad. Anyone could do what they want with you.&lt;&lt;/say&gt;&gt;

&lt;&lt;player&gt;&gt;Uh, yes, so I&#39;ve been told...&lt;&lt;/player&gt;&gt;

You swear you can see his erection growing in his pants as you say this.

&lt;&lt;say &#39;Drunk man&#39;&gt;&gt;I could use your mouth right now to gratify myself.&lt;&lt;/say&gt;&gt;

&lt;&lt;player&gt;&gt;Y-yes, you certainly could...&lt;&lt;/player&gt;&gt;

He slowly lowers his pants, revealing his already erect cock. You stare at it, feeling your own ?dick growing hard as you imagine him using your mouth for his own pleasure. Almost automatically, you find yourself opening your mouth to receive him.?nl

The man smiles and rubs the end of his cock slowly along your cheek, then stuffs himself inside your mouth. You can hardly believe you&#39;re doing this, but the situation is too exciting for you to care. With difficulty, you try to shape your mouth so that he hits only the softest parts. 

&lt;&lt;say &#39;Drunk man&#39;&gt;&gt;Fuck, you like getting used, huh?&lt;&lt;/say&gt;&gt;

Maybe he&#39;s right, but you&#39;re not going to think about it right now. You can&#39;t move much while locked in the pillory, so you focus on taking him in as he begins to fuck your mouth. You swirl your tongue around the tip of his cock and he moans, stuffing his dick even deeper in your mouth. 

&lt;&lt;say &#39;Drunk man&#39;&gt;&gt;Unfh... They should lock you up more often...&lt;&lt;/say&gt;&gt;

Your saliva builds up as he continues fucking your mouth, your spit getting all over your face and the squelching growing louder. You realize that anyone could walk by and see this man freely using you for his sexual gratification in the middle of the town square. You&#39;re already quite hard, but it&#39;s not like you can touch yourself right now.?nl

The sound of loud wooping and whistling hits your ears. Your mouth still full of cock, you tilt your head slightly and see a group of men passing through the square, apparently cheering on your blowjob. 

&lt;&lt;say &#39;Drunk man&#39;&gt;&gt;Ignore them, they can wait their turn...&lt;&lt;/say&gt;&gt;

Apparently unbothered by the attention, the man grabs your head and starts, as much as possible, to pull you down onto himself. His cock slides into the back of your throat and you gag involuntarily, but let yourself be face-fucked.

&lt;&lt;say &#39;Drunk man&#39;&gt;&gt;Fuck, I&#39;m going to cum down your throat...&lt;&lt;/say&gt;&gt;

His dick spasms as he shoots his hot load down your throat. It&#39;s thick and plentiful, and you almost choke as it spurts into the back of your mouth. You suck lightly on his dick as he cums, helping him through his orgasm.?nl

When he&#39;s finished, he pulls out of your mouth with a wet sound and stuffs his cock back in his pants. He gives you a genuine smile.

&lt;&lt;say &#39;Drunk man&#39;&gt;&gt;Hey, that was great. Maybe I&#39;ll see you around some time...&lt;&lt;/say&gt;&gt;

He tips his hat at you and stumbles off into the town, humming a tune drunkenly to himself.?nl

The taste of his cum is still lingering in your mouth when a smirking guard comes to unlock you from the pillory some time later. You stretch your body with relief and consider how if you&#39;d chosen the dungeons, you&#39;d probably still be locked up right now.

&lt;&lt;decision &#39;Leave the pillory&#39; &#39;Town square&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="624" name="Town navigation" tags="" position="475,7850" size="100,100">&lt;img src=&quot;images/maps/town.png&quot; class=&quot;navigation-map&quot; usemap=&quot;#town-map&quot;&gt;

&lt;map name=&quot;town-map&quot;&gt;
    &lt;area data-passage=&quot;Smithy&quot; alt=&quot;Smithy&quot; center=&quot;1568,931&quot; coords=&quot;1364,741,1691,741,1940,989,1940,1070,1861,1153,1447,1153,1237,947,1239,868&quot; shape=&quot;poly&quot;&gt;
    &lt;area data-passage=&quot;Road&quot; alt=&quot;Road&quot; center=&quot;2368,957&quot; coords=&quot;2479,736,2455,756,2431,760,2409,787,2374,800,2352,824,2328,843,2326,865,2304,892,2291,962,2278,982,2247,1017,2242,1047,2221,1076,2225,1089,2194,1120,2175,1144,2155,1163,2126,1190,2104,1205,2102,1218,2067,1229,2083,1238,2479,1236,2477,933&quot; shape=&quot;poly&quot;&gt;
    &lt;area data-passage=&quot;Tavern&quot; alt=&quot;Tavern&quot; center=&quot;1684,225&quot; coords=&quot;902,40,2026,40,2026,491,1445,491,1281,329,906,329&quot; shape=&quot;poly&quot;&gt;
    &lt;area data-passage=&quot;Alley&quot; alt=&quot;Alley&quot; center=&quot;2207,280&quot; coords=&quot;2045,500,2362,2&quot; shape=&quot;rect&quot; vertical=&quot;true&quot;&gt;
    &lt;area data-passage=&quot;Town square&quot; alt=&quot;Town square&quot; center=&quot;1154,572&quot; coords=&quot;952,492,1071,374,1241,374,1360,490,1360,661,1244,779,1071,779,950,661&quot; shape=&quot;poly&quot;&gt;
    &lt;area data-passage=&quot;Church&quot; alt=&quot;Church&quot; center=&quot;293,567&quot; coords=&quot;203,746,185,741,164,737,137,728,111,717,93,697,69,678,56,654,50,632,41,601,39,575,41,546,50,527,56,500,74,481,87,459,102,450,120,437,142,426,164,415,185,413,203,410,205,332,367,329,372,406,781,413,786,487,865,496,862,658,788,656,786,741,372,748,370,820,207,820&quot; shape=&quot;poly&quot;&gt;
&lt;/map&gt;</tw-passagedata><tw-passagedata pid="625" name="Road" tags="location town" position="600,7850" size="100,100">You stand in the midst of the meadow, surrounded by a kaleidoscope of wildflowers swaying in the breeze. A dirt road leads towards the edge of the forest.</tw-passagedata><tw-passagedata pid="626" name="Town square" tags="location town" position="725,7850" size="100,100">The square is the bustling heart of the town. It is here that they gather to celebrate festivals and ceremonies. It&#39;s close to both the local tavern and smithy. There is a beautiful fountain in the middle of the square.</tw-passagedata><tw-passagedata pid="627" name="Smithy" tags="location town" position="850,7850" size="100,100">The smithy is a small building, made of wood and brick, with a large chimney and a stone floor. It contains a furnace and a large anvil. It is used to make iron tools, weapons, and armor. It is owned and operated by ?Beau the blacksmith.</tw-passagedata><tw-passagedata pid="628" name="Alley" tags="location town" position="975,7850" size="100,100">The alley is a dingy place filled with garbage and rats. It leads to the back door of the tavern and is used by the bums and drunks to access the establishment without paying. A faint smell of urine hangs heavy in the air, mingling with the sweet scent of alcohol.</tw-passagedata><tw-passagedata pid="629" name="Church" tags="location town" position="1100,7850" size="100,100">The interior of the church is bathed in the soft, colorful light filtering through the stained glass windows, casting patterns on the stone floor. The air carries the scent of incense and polished wood, a comforting aroma that always brought a sense of peace.</tw-passagedata><tw-passagedata pid="630" name="Confession booth" tags="location town" position="1225,7850" size="100,100">The confession booth is a small and cramped wooden box. It has a wooden lattice between you and where the priest sits.</tw-passagedata><tw-passagedata pid="631" name="Leave town" tags="" position="100,7975" size="100,100">&lt;&lt;decision &#39;Head back to the castle&#39;&gt;&gt;
    &lt;&lt;if isDisguised()&gt;&gt;
        &lt;&lt;goto &#39;Sneak in&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;goto &#39;Walk in no disguise&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;decisionicon castle&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Head through the meadow to the forest&#39; &#39;Meadow&#39;&gt;&gt;
    &lt;&lt;decisionicon forest&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="632" name="Church Decisions" tags="" position="225,7975" size="100,100">&lt;&lt;if !hasCounter(&#39;church-wandering&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Wander around the church&#39; &#39;Church Wandering&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="633" name="Alley Decisions" tags="" position="350,7975" size="100,100">&lt;&lt;if !hasCounter(&#39;alley-explore&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Look around the alley&#39;&gt;&gt;
        &lt;&lt;include &#39;Alley Explore&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasTag(&#39;feeding-cat&#39;) and !hasCounter(&#39;fed-cat&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Bring the alley cat food&#39; &#39;Alley Cat Continue Feeding&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="634" name="Disguise Change" tags="" position="475,7975" size="100,100">&lt;&lt;setlocation &#39;Wardrobe&#39;&gt;&gt;
&lt;&lt;outfit disguise&gt;&gt;
You head into your bedroom and open your wardrobe. You pull out your disguise and get changed.?nl
Feeling ready to head out of the castle, you get ready to walk past the guards using your trusted disguise.
&lt;&lt;decision &#39;Sneak out of the castle&#39; &#39;Sneak out&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="635" name="Sneak out" tags="" position="600,7975" size="100,100">&lt;&lt;setlocation &#39;Gatehouse&#39;&gt;&gt;
&lt;&lt;first&gt;&gt;
    As you&#39;re making your way through the long corridors of the castle, you feel your heartbeat thumping in your chest. The closer you get to the gate, the more you start to think this is a really stupid idea. What if they recognise you? How would the guards feel about finding their Prince, trying to sneak out with a disguise like this. ?Andreas would be so disappointed...?nl

    You&#39;re forced to swallow your insecurities as you&#39;re walking towards the big gates of the castle. Just a few more meters...
    &lt;&lt;guard&gt;&gt;You! Stop right there!&lt;&lt;/guard&gt;&gt;
    You stop dead in your tracks as you see the guard pointing towards you.
    &lt;&lt;player&gt;&gt;Uhm, yes, how can I help you sir?&lt;&lt;/player&gt;&gt;
    &lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;
        You try to use your most feminine voice as you give him your reply. You hope you don&#39;t sound as stupid as you think you do.
        &lt;&lt;guard&gt;&gt;You&#39;re that new kitchen maid right? Please state the reason for leaving the castle.&lt;&lt;/guard&gt;&gt;
        You pull up your shawl and try to avoid eye contact. You feel the guard&#39;s leering gaze pass over you as he&#39;s inspecting you.
        &lt;&lt;player&gt;&gt;I&#39;m out on some errands, sir. I need to pick up some ingredients for the kitchen from town.&lt;&lt;/player&gt;&gt;
        You feel very small standing in front of this strong guardsman. As prince, you could easily command him to stand aside but that&#39;s obviously not an option now.
        &lt;&lt;guard&gt;&gt;Ah, very well. Good luck at the market then, be sure not to stay away for long.&lt;&lt;/guard&gt;&gt;
        &lt;&lt;player&gt;&gt;Thank you, sir. I&#39;ll be careful.&lt;&lt;/player&gt;&gt;
        You hurriedly walk past him through the open gate and let out a big sigh of relief. How have they not recognised you? The idea of their prince crossdressing to get out of the castle is so ridiculous, the thought probably hasn&#39;t even crossed their minds.
    &lt;&lt;else&gt;&gt;
        You try to not let the guard see your face as much, taking to look at the floor instead.
        &lt;&lt;guard&gt;&gt;You&#39;re that new manservant right? Please state the reason for leaving the castle.&lt;&lt;/guard&gt;&gt;
        You feel the guard&#39;s leering gaze pass over you as he&#39;s inspecting you.
        &lt;&lt;player&gt;&gt;I&#39;m out on some errands, sir. I need to pick up some ingredients for the kitchen from town.&lt;&lt;/player&gt;&gt;
        You feel very strange standing in front of this guardsman. As prince, you could easily command him to stand aside but that&#39;s obviously not an option now.
        &lt;&lt;guard&gt;&gt;Ah, very well. Good luck at the market then, be sure not to stay away for long.&lt;&lt;/guard&gt;&gt;
        &lt;&lt;player&gt;&gt;Thank you, sir. I&#39;ll be careful.&lt;&lt;/player&gt;&gt;
        You hurriedly walk past him through the open gate and let out a big sigh of relief. How have they not recognised you? The idea of their prince disguising as a pauper to get out of the castle is so ridiculous, the thought probably hasn&#39;t even crossed their minds.
    &lt;&lt;/if&gt;&gt;
&lt;&lt;finally&gt;&gt;
    Even though it&#39;s not the first time you leave the castle like this, it still feels scary walking towards the gates. You walk by the guards, hoping that they don&#39;t stop you before you go outside. One of the guards looks you over and gives you a nod as you move towards the exit. It seems like they&#39;re used to you as a new &lt;&lt;if hasClothesTag(&#39;feminine&#39;)&gt;&gt;kitchen maid&lt;&lt;else&gt;&gt;manservant&lt;&lt;/if&gt;&gt; now.
&lt;&lt;/first&gt;&gt;
&lt;&lt;decision &#39;Head to the forest&#39; &#39;Meadow&#39;&gt;&gt;
    &lt;&lt;decisionicon forest&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;if hasCompletedQuest(&#39;sybille-tavern&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Head to town&#39; &#39;Road&#39;&gt;&gt;
        &lt;&lt;decisionicon town&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="636" name="Sneak in" tags="" position="725,7975" size="100,100">&lt;&lt;setlocation &#39;Gatehouse&#39;&gt;&gt;
You quickly make your way through the castle gates, hoping not to be stopped by the guards again. As you slowly walk through and look over to the guard post, it seems to be your lucky day. The guard on duty is currently leaning against a wall with his eyes closed and snoring loudly. You easily walk back inside, deciding to ignore this slightly worrying security breach and accept it as a blessing right now.?nl
Very deftly, you make your way through the hallways until you reach the door to your bedroom and you quickly make your way inside. From here, it&#39;s probably smart to head to your wardrobe right away and change into one of your normal outfits.
&lt;&lt;decision &#39;Sneak into your bedroom and change clothes&#39; &#39;Bedroom&#39;&gt;&gt;
    &lt;&lt;outfit standard&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="637" name="Walk in no disguise" tags="" position="850,7975" size="100,100">&lt;&lt;setlocation &#39;Gatehouse&#39;&gt;&gt;
You try to nonchalantly make your way through the gate, but as you could have expected, you are stopped by the guards.
&lt;&lt;guard&gt;&gt;Halt- Uh, ?title, why did you come from outside? Aren&#39;t you supposed to stay in the castle? ?Andreas specifically ordered it.&lt;&lt;/guard&gt;&gt;
&lt;&lt;player&gt;&gt;Well, yes... I was just outside for a little bit...&lt;&lt;/player&gt;&gt;
You&#39;re not quite sure how to handle this situation where you obviously disobeyed the rules.
&lt;&lt;guard&gt;&gt;Uhm, we&#39;ll have to report this to &lt;&lt;fullname andreas&gt;&gt;. He&#39;s not going to like this.&lt;&lt;/guard&gt;&gt;
Oh no, you definitely don&#39;t want them to do that. ?Andreas is going to be so disappointed in you...
&lt;&lt;player&gt;&gt;Yes, you could do that, but then again... ?Andreas is not going to be happy with the guards who failed to protect the prince by letting him leave the castle, right? You&#39;re the ones on duty so unfortunately it is your responsibility...&lt;&lt;/player&gt;&gt;
You do your best to try and persuade them.
&lt;&lt;player&gt;&gt;Perhaps it&#39;s best if we both just look the other way, there&#39;s no need to get ?Andreas involved in this.&lt;&lt;/player&gt;&gt;
The guard looks at you a little reluctantly.
&lt;&lt;guard&gt;&gt;Fine... Perhaps that is for the best. But please, ?title. I must urge you not to leave the castle again without an escort. There might be more assassins about.&lt;&lt;/guard&gt;&gt;
&lt;&lt;player&gt;&gt;Thank you for your concern, soldier. I must be going now though.&lt;&lt;/player&gt;&gt;
The guard stands back and resumes their position. You nod at the guard and make your way down the hallway.

&lt;&lt;decision &#39;Leave&#39; &#39;Hallway&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="638" name="Introduction 1" tags="" position="975,7975" size="100,100">&lt;&lt;setlocation Introduction&gt;&gt;
&lt;&lt;stowsidebars&gt;&gt;
&lt;&lt;changename &#39;player&#39; $player.name&gt;&gt;
/* &lt;&lt;updatemeter gender `getStatFraction(&#39;gender&#39;)`&gt;&gt; */
&lt;div class=&quot;sound-button&quot;&gt;
&lt;&lt;button `settings.sound ? &#39;&lt;span class=&quot;icon-single volume-up&quot;&gt;&lt;/span&gt;&#39; : &#39;&lt;span class=&quot;icon-single volume-mute&quot;&gt;&lt;/span&gt;&#39;`&gt;&gt;&lt;&lt;togglesound&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;/div&gt;
&lt;p&gt;
You are &lt;&lt;name player &#39;&#39; both&gt;&gt;, prince of a small kingdom called ?kingdom. You&#39;ve never liked the high expectations people have of you as prince. Your father wanted you to spend more time training, honing your skills with a sword. He frequently presented you in court to try and show you the art of oratory. After some time, it was clear this was never your thing, you much preferred reading books and spending time in the castle gardens.?nl
Recently, your father has left the kingdom with a contingent of knights on a &#39;perilous&#39; mission. He always liked his adventurous past. To you, it sounded like he made an excuse to experience some thrill again. That&#39;s all fine to you, normally it would give you time to focus on things &lt;em&gt;you&lt;/em&gt; like to do, but, in his infinite wisdom, &lt;&lt;name king &#39;the&#39;&gt;&gt; has decided that he will leave some matters of state to your responsibility. He said it&#39;s the perfect time for you to learn this, you are an adult, these things will be expected of you. Your father has ordered you to take his place on the royal council, you&#39;re actually quite anxious about this.?nl
Your father will be gone for quite some time, who knows how well you will manage the kingdom in the meantime...
&lt;/p&gt;
&lt;&lt;decision &#39;Wake up&#39; &#39;Chapter&#39;&gt;&gt;&lt;&lt;startquest introduction&gt;&gt;&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Skip ahead (Not recommended for first time)&#39; &#39;Skip&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="639" name="Introduction Bedroom" tags="" position="1100,7975" size="100,100">&lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
You wake up to the sound of a gentle knock on your bedroom door. You slowly sit up in your bed as you groggily give a reply.
&lt;&lt;player&gt;&gt;Come in...&lt;&lt;/player&gt;&gt;
The door opens and your attendant, ?Orson, enters the room.

&lt;&lt;orson&gt;&gt;Good morning, ?title.&lt;&lt;/orson&gt;&gt; 
He says with a bow. &lt;&lt;orson&gt;&gt;You&#39;re going to be late for the council meeting.&lt;&lt;/orson&gt;&gt;
You rub your eyes and look around the room. Sunlight streaks through your bedroom and lands on your face as ?Orson starts opening the curtains.
&lt;&lt;player&gt;&gt;I&#39;m sorry, ?orson. I must have overslept.&lt;&lt;/player&gt;&gt;
&lt;&lt;orson&gt;&gt;It&#39;s no trouble, ?title. I&#39;ll get a bath ready and help you look presentable.&lt;&lt;/orson&gt;&gt;
You step out of bed and stretch, feeling a bit sore from your night of sleep.
?Orson opens the bathroom door and fills the bathtub with hot water. While you make your way to the bathroom, he prepares a fresh towel and robe for you to use after your bath.
&lt;&lt;decision &#39;Let him help you undress.&#39; &#39;Introduction Bathroom&#39;&gt;&gt;&lt;&lt;addtag &#39;orson-undress&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Motion for him to leave you to your bath.&#39; &#39;Introduction Bathroom&#39; virtue medium&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="640" name="Introduction Bathroom" tags="" position="1225,7975" size="100,100">&lt;&lt;setlocation &#39;Bathroom&#39;&gt;&gt;
&lt;&lt;if hasTag(&#39;orson-undress&#39;)&gt;&gt;
    &lt;&lt;include &#39;Introduction-bath-undress&#39;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;include &#39;Introduction-bath-alone&#39;&gt;&gt;
&lt;&lt;/if&gt;&gt;
You settle into the tub and lean back, feeling your body relax. Your body is lithe and lean, with barely any muscle definition to speak of. You&#39;ve always been a little bit on the smaller side, with a slight frame and delicate features.
You look down and see your cock bobbing in the water. &lt;&lt;if settings.sph&gt;&gt;It&#39;s definitely a bit on the smaller side as far as you know.&lt;&lt;/if&gt;&gt;
A naughty thought enters your mind as you think about pleasuring yourself right now.
&lt;&lt;player&gt;&gt;Maybe there&#39;s enough time...&lt;&lt;/player&gt;&gt;
&lt;&lt;decision &#39;Enjoy some &quot;me&quot;-time&#39; 1 depravity small&gt;&gt;
&lt;&lt;include &#39;Introduction Masturbate&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Get dressed and head down the hallway.&#39; &#39;Introduction Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="641" name="Introduction-bath-undress" tags="" position="100,8100" size="100,100">&lt;&lt;orson&gt;&gt;Let me help you with that.&lt;&lt;/orson&gt;&gt; 
He says as he motions for you to lift your arms. He takes off your top and unknots the string that keeps your shorts up. You lower your shorts, now naked as the day you were born.
Even though ?Orson only attends to you for a few years, you already feel quite close to him. It&#39;s his utmost professionalism that lets you feel unbothered by him seeing you naked. He holds out a hand to help you into the bathtub.
You step into the tub and sink yourself into the hot water. You can feel the warm water envelop your body. 
&lt;&lt;orson&gt;&gt;There you are, ?title. Enjoy your bath.&lt;&lt;/orson&gt;&gt; He turns to leave you alone in the bathroom.?nl</tw-passagedata><tw-passagedata pid="642" name="Introduction-bath-alone" tags="" position="225,8100" size="100,100">&lt;&lt;orson&gt;&gt;Of course, ?title. Enjoy your bath.&lt;&lt;/orson&gt;&gt; He says as he leaves you alone in the bathroom.
You undress, step into the tub and sink into the hot water. As you step into the bath, you can feel the warm water envelop your body.?nl</tw-passagedata><tw-passagedata pid="643" name="Introduction Masturbate" tags="spicy" position="350,8100" size="100,100">You take your dick in hand and stroke it gently, feeling a tingle of pleasure run through your body. You close your eyes and let your mind wander. There is a new servant who works in the kitchen, ?Rosa. You would love to get closer with her - not that you have any experience with &lt;em&gt;that&lt;/em&gt; - but simply thinking of her makes you feel ecstatic. You think of her smooth skin, blonde hair, and that beautiful summer dress she wore that one time. If only you didn&#39;t lack the confidence to compliment her on it.
&lt;&lt;if settings.vids&gt;&gt;
    &lt;&lt;if settings.sph&gt;&gt;
        &lt;&lt;video &#39;player/masturbate_bath_sph.webm&#39;&gt;&gt;
    &lt;&lt;else&gt;&gt;
        &lt;&lt;video &#39;player/masturbate_bath.webm&#39;&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;
As you continue stoking your cock in the bath, you feel your orgasm coming closer and closer, when right at that moment, the door opens.
&lt;&lt;orson&gt;&gt;Sorry, ?title, I forgot to bring you some clean clothes - oh!&lt;&lt;/orson&gt;&gt;
You stare at him, looking embarrassed. He quickly turns away from you and places some clothes next to the bath. 
&lt;&lt;orson&gt;&gt;I&#39;m very sorry, ?title, I will give you some privacy.&lt;&lt;/orson&gt;&gt;
Feeling ashamed, it&#39;s probably best to just get out of the bath now.
&lt;&lt;addsin &#39;masturbation&#39;&gt;&gt;
&lt;&lt;addtag &#39;orson-caught&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="644" name="Introduction Hallway" tags="" position="475,8100" size="100,100">&lt;&lt;setlocation &#39;Hallway&#39;&gt;&gt;
You quickly get dressed and head down the hallway. As you walk down the hall, you see a guard standing at attention &lt;&lt;guard&gt;&gt;Good morning, ?title.&lt;&lt;/guard&gt;&gt; he says, bowing slightly. The guard looks you up an down, slight smile on his face. &lt;&lt;guard&gt;&gt;You look nice today.&lt;&lt;/guard&gt;&gt;

&lt;&lt;decision &quot;Awkwardly thank him, as the compliment catches you off guard&quot; submissiveness medium&gt;&gt;
    You blush slightly under his gaze and stammer a response.
    &lt;&lt;player&gt;&gt;T-thank you.. Good morning to you, too&lt;&lt;/player&gt;&gt;
    You nod to him and continue down the hallway, you can&#39;t help but feel a little self-conscious. It&#39;s a nice compliment but why did he have to look you up and down like that?
    &lt;&lt;decision &quot;Head into the grand hall&quot; &#39;Introduction Council&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Remind the guard he should focus on his duty&quot; dominance medium&gt;&gt;
    &lt;&lt;player&gt;&gt;Shouldn&#39;t you focus on your guard duties, soldier?&lt;&lt;/player&gt;&gt; You say to him with a serious tone.
    &lt;&lt;guard&gt;&gt;Of course, ?title. I meant nothing by it.&lt;&lt;/guard&gt;&gt; He immediately faces forwards, eyes peeled to the empty hallway.
    You nod to him. As you continue down the hallway you wonder why the guard suddenly thinks it&#39;s okay to be so friendly with you. 
    &lt;&lt;decision &quot;Head into the grand hall&quot; &#39;Introduction Council&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &quot;Ignore his compliment and head into the grand hall&quot; &#39;Introduction Council&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="645" name="Introduction Council" tags="" position="600,8100" size="100,100">&lt;&lt;setlocation &#39;Grand hall&#39;&gt;&gt;
You walk into the grand hall and make your way around the large table to take your seat. You see ?Orson standing in the corner, ready to attend to you. &lt;&lt;if hasTag(&#39;orson-caught&#39;)&gt;&gt;You accidentally make eye contact, and quickly look away. It feels slightly embarrassing, knowing what he saw you do just a few moments ago. You push the thoughts from your mind and turn your attention to the council meeting at hand.&lt;&lt;/if&gt;&gt;?nl

It looks like the councillors had already started the meeting.
&lt;&lt;andreas&gt;&gt;Ah, ?title, welcome! We we&#39;re just initiating the newest member of the council. I hereby welcome the new Royal Sorceress to our council, &lt;&lt;name morgana &#39;Lady&#39;&gt;&gt;. I think I speak for everyone when I say that I have the utmost belief that she will be of great benefit to the crown.&lt;&lt;/andreas&gt;&gt;
?Morgana stands up and looks to the other councillors.
&lt;&lt;morgana&gt;&gt;Thank you, &lt;&lt;fullname andreas&gt;&gt;. I am glad to be here. I hope to be of much service to you and the realm.&lt;&lt;/morgana&gt;&gt;
She stares at you with a slight smile as you nod to her. Her predecessor, &lt;&lt;name godric &#39;Master&#39;&gt;&gt;, used to be your teacher until he left to accompany your father. Thinking about it, you&#39;ve never really interacted with this disciple of his besides saying hello a few times. She has quite the mysterious air to her.

&lt;&lt;decision &#39;Listen to ?Andreas as he continues the meeting&#39; &#39;Introduction Council 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="646" name="Introduction Council 2" tags="" position="725,8100" size="100,100">&lt;&lt;andreas&gt;&gt;Now for the matter at hand. Honourable council, when the ?King left he told me we have a job to do: We need to find an alliance with one of our neighboring kingdoms. It is high time we strengthen our position, forging a pact with a powerful ally will do exactly that.&lt;&lt;/andreas&gt;&gt;
You see &lt;&lt;fullname leopold&gt;&gt; stand up from his chair.
&lt;&lt;leopold&gt;&gt;Hear hear! I have been advocating for this plan for years now, I am glad the ?King agrees as well.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;fullname wymerus&gt;&gt; speaks up.
&lt;&lt;wymerus&gt;&gt;I agree with this strategy. With the ?King away on his quest, I fear we are less defensible. Our army is in need of a strengthening alliance.&lt;&lt;/wymerus&gt;&gt;
Suddenly &lt;&lt;fullname sybille&gt;&gt; stands up. She has a soft spoken voice but is very direct in her tone.
&lt;&lt;sybille&gt;&gt; My Lords, I agree with the necessity of the plan, however, our diplomatic relations have been strained recently. It seems that currently only one reliable method of alliance-making remains: A royal marriage.&lt;&lt;/sybille&gt;&gt;
Suddenly you feel the room looking at you. You respond with a certain uncertainty in the your voice as the proposition catches you off guard.
&lt;&lt;player&gt;&gt;Marriage? I am the my father&#39;s only child, are you saying you&#39;re looking for someone to marry me?&lt;&lt;/player&gt;&gt;
&lt;&lt;sybille&gt;&gt;I am, ?title. But do not fear, there is a complication that makes this solution quite difficult. Unfortunately, none of our neighboring nations have an available princess in the royal family, only eligible bachelors.&lt;&lt;/sybille&gt;&gt;
You feel slightly relieved, it&#39;s unfortunate that you can&#39;t help the kingdom this way, but you are definitely &lt;em&gt;not&lt;/em&gt; ready for marriage.
&lt;&lt;andreas&gt;&gt;Well, about that matter, I gathered &lt;&lt;name morgana &#39;Lady&#39;&gt;&gt; has a solution to this problem. My lady, would you care to elaborate on this?&lt;&lt;/andreas&gt;&gt;
As you shift your attention to &lt;&lt;title morgana &#39;the sorceress&#39;&gt;&gt;, you notice she has been staring at you. She makes eye contact with you and you see the hint of a smile on her face. She stands up slowly and addresses the room. 
&lt;&lt;morgana&gt;&gt;That matter is best discussed between myself and the young prince. ?Title, perhaps you could offer me a visit in the library sometime later?&lt;&lt;/morgana&gt;&gt;
You are confused as to why she is being so secretive, but you nod towards her.
&lt;&lt;player&gt;&gt;Of course, if that&#39;s what the new royal sorceress asks.&lt;&lt;/player&gt;&gt;
While looking at the rest of the council you notice &lt;&lt;fullname devota&gt;&gt;, the religious representation in the council, eying ?Morgana suspiciously. She was never in favor of letting wizards and witches on the council.

&lt;&lt;decision &#39;Turn to ?Andreas as he addresses you directly&#39; &#39;Introduction Council 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="647" name="Introduction Council 3" tags="" position="850,8100" size="100,100">&lt;&lt;andreas&gt;&gt;Very well. In the mean time, the &lt;&lt;name king&gt;&gt; has also charged us councillors with continuing your education while he is gone, ?title. It&#39;s important that you keep up your skills in matters of state and sword. You can always come by to start your training, the councillors will make time for you.&lt;&lt;/andreas&gt;&gt;
Each of your instructors stands up to address you.
&lt;&lt;leopold&gt;&gt;?Title, come find me in the Treasury whenever you want to continue your education in stewardship.&lt;&lt;/leopold&gt;&gt;
&lt;&lt;wymerus&gt;&gt;If you&#39;re looking to improve your skills in swordsmanship, I&#39;m usually sparring together with my squire out in the Courtyard. You are more than welcome to join us, ?title.&lt;&lt;/wymerus&gt;&gt;
&lt;&lt;andreas&gt;&gt;And you can find me right in this room, visit me so we can continue your education in statesmanship.&lt;&lt;/andreas&gt;&gt;
People have great expectations of the heir to the kingdom, your father and the council find it utmost important that you improve your necessary skills. You haven&#39;t been that keen to do this yourself. It&#39;s rather boring. But alas, royalty requires conciliation so you give them all an understanding nod.
&lt;&lt;andreas&gt;&gt;During the next council sessions we will review your progress, ?title. I know feels quite invasive but know that we only mean the best for you. Your father has charged us with this task and we will do everything we can to help you in this regard. And to make these matters more appealing to you I have decided together with the other councillors to give you a reward should you live up to our expectations.&lt;&lt;/andreas&gt;&gt;
/* &lt;&lt;player&gt;&gt;If my father has decided this is important... Fine, I will try to do my best.&lt;&lt;/player&gt;&gt; */
You are immediately much more intrigued at hearing about a reward when ?Andreas turns to ?Leopold.
&lt;&lt;player&gt;&gt;A reward? What is it?&lt;&lt;/player&gt;&gt;
You sit up in your chair, waiting anxiously to hear more about this reward.
&lt;&lt;leopold&gt;&gt;Yes, ?title. We have decided that should you pass our inquiry on our weekly council meetings, I will allow you to enter the ?reliquary and pick out an artifact. Of course, not all of them are safe so I wouldn&#39;t be able to lend those to you but there are quite a few magical items that you might find particularly interesting.&lt;&lt;/leopold&gt;&gt; 
An artifact from the ?reliquary! Your father never allowed you to touch the things in there, this is amazing! You struggle containing your excitement as you try to hold back a beaming smile.
&lt;&lt;player&gt;&gt;A royal artifact? That is quite something... Thank you councillors, I will do my very best to impress you and pass your examination next week!&lt;&lt;/player&gt;&gt;
&lt;&lt;andreas&gt;&gt;Very good, ?title. And with that, I suppose that concludes the meeting of this council, thank you my lords, my lady. ?Title, it was good to have you in attendance.&lt;&lt;/andreas&gt;&gt;
All the council members start to leave the chamber to get back to their respective duties.

&lt;&lt;decision &#39;Leave the grand hall&#39; &#39;Introduction Kathryn&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="648" name="Introduction Kathryn" tags="" position="975,8100" size="100,100">&lt;&lt;setlocation Hallway&gt;&gt;
As you make your way through the large doors of the grand hall, you notice ?Kathryn down the hallway walking towards you. Because of her family&#39;s importance, your father took her in as his ward some time ago. Since then, she&#39;s been noticeably jealous of you for having a more prominent position than her. While all nobles of the court usually respect you because of your title, she is one of the few people who never adhered to that. She likes bullying you for all kinds of stuff. You can&#39;t remember the last conversation you&#39;ve had where she wasn&#39;t condescending towards you about any arbitrary thing she decides to belittle you for.?nl 
You&#39;ve learning to recognise that when she&#39;s approaching you this intently with that deviously smile on her face, it usually means bad times for you.
&lt;&lt;kathryn&gt;&gt;Hello there, ?titleK. What&#39;s this talk I hear of your upcoming royal marriage?&lt;&lt;/kathryn&gt;&gt;
&lt;&lt;player&gt;&gt;What? Who told you that, ?Kathryn? It&#39;s supposed to be a secret council meeting...&lt;&lt;/player&gt;&gt;
She gives a slight laugh as she sees your irritation growing.
&lt;&lt;kathryn&gt;&gt;Relax my ?titleK, I was just kidding. I know the plans can&#39;t really go through because there are no available princesses. That must give you quite a relief, or who knows, maybe you could marry another prince instead...&lt;&lt;/kathryn&gt;&gt;

&lt;&lt;decision &#39;Reply flabbergasted by her suggestion&#39; submissiveness medium&gt;&gt;
    &lt;&lt;player&gt;&gt;What- I haven&#39;t-&lt;&lt;/player&gt;&gt;
    &lt;&lt;kathryn&gt;&gt;It&#39;s fine, ?titleK. No need to admit to any feelings right now. I&#39;m just very keen to see what our new &lt;&lt;title morgana &#39;sorceresses&#39;&gt;&gt; solution is to your little &#39;no princess&#39; problem... I hear she has quite the experience with some powerful magic.&lt;&lt;/kathryn&gt;&gt;
    &lt;&lt;player&gt;&gt;What&#39;s that supposed to mean? Also, how do you even know about that as well?&lt;&lt;/player&gt;&gt;
    Her remarks are making you quite anxious which is very noticeable from the worried tone in your questions.
    &lt;&lt;kathryn&gt;&gt;You&#39;re easily scared, aren&#39;t you, ?titleK? Don&#39;t worry, you&#39;ll probably get your answers soon. Now just run along, don&#39;t you have any princely business to attend to or something?&lt;&lt;/kathryn&gt;&gt;
    You never really enjoy your interactions with ?Kathryn, it seems like you always get humiliated somehow. She&#39;s right though, you have enough to do for today. With ?Morgana expecting you in the library and the rest of the council waiting for you to start training, it&#39;s probably going to be quite busy.
    &lt;&lt;decision &#39;Leave to find ?Morgana&#39; &#39;Chapter&#39;&gt;&gt;&lt;&lt;include &#39;Introduction Finish&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Respond in kind&#39; dominance medium&gt;&gt;
    &lt;&lt;player&gt;&gt;Really? You&#39;re going to bully me with something so trivial? I suppose you&#39;re just jealous I&#39;m the one that everyone looks to when it comes to actual important stuff. Nobody cares about &quot;&lt;&lt;fullname kathryn&gt;&gt;&quot;, I suppose you wish you had a seat at the council, don&#39;t you?&lt;&lt;/player&gt;&gt;
    She looks quite shocked by your bold reply.
    &lt;&lt;kathryn&gt;&gt;Wha- You little shi- Fine, have fun being coddled by all the councillors over unimportant stuff like this. I&#39;m actually keen to see how our new &lt;&lt;title morgana &#39;sorceress&#39;&gt;&gt; will solve this &#39;no princess&#39; issue for you...&lt;&lt;/kathryn&gt;&gt;
    And how did she know about that? While you wonder that she already walks off, leaving you alone.?nl
    Well, you can&#39;t keep chatting anyways, you have enough to do for today. With ?Morgana expecting you in the library and the rest of the council waiting for you to start training, it&#39;s probably going to be quite busy.
    &lt;&lt;decision &#39;Leave to find ?Morgana&#39; &#39;Chapter&#39;&gt;&gt;&lt;&lt;include &#39;Introduction Finish&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="649" name="Introduction Finish" tags="" position="1100,8100" size="100,100">&lt;&lt;set $chapter = 1&gt;&gt;
&lt;&lt;set $chaptertitle = &#39;Chapter One&#39;&gt;&gt;
&lt;&lt;set $chaptertarget = &#39;Hallway&#39;&gt;&gt;
&lt;&lt;completequest introduction&gt;&gt;
&lt;&lt;startquest meet-morgana&gt;&gt;
&lt;&lt;startquest level-expectation&gt;&gt;</tw-passagedata><tw-passagedata pid="650" name="Pee" tags="" position="1225,8100" size="100,100">Feeling the need to relief yourself, you quickly make your way over to the toilet.

&lt;&lt;decision &#39;Sit down to pee&#39;&gt;&gt;
    You &lt;&lt;if hasTag(&#39;crossdressing&#39;)&gt;&gt;raise your skirt&lt;&lt;else&gt;&gt;lower your pants&lt;&lt;/if&gt;&gt; and sit down on the toilet. You aim your ?dick down between your legs and unleash the stream of piss into the toilet. You instantly feel relieved, letting out a satisfied sigh.?nl
    
    /* &lt;&lt;if settings.watersports &amp;&amp; getTime() !== &#39;night&#39; &amp;&amp; !hasCounter(&#39;orson-pee&#39;) &amp;&amp; randomFloat(1) &gt; 0.6&gt;&gt;
        You are pretty much done peeing when suddenly ?Orson enters the bathroom, looking quite hasted. He practically runs over to you with an awkward looking jog before he stops dead in his tracks when he sees you on the toilet.
        &lt;&lt;orson&gt;&gt;Oh! ?Title, I am so sorry! I really have to use the bathroom and I thought I could quickly use yours. I did not see you here at all!&lt;&lt;/orson&gt;&gt;
        He&#39;s awkwardly standing there sort of wobbling side to side, it seems like he &lt;em&gt;really&lt;/em&gt; needs to pee &lt;em&gt;right now&lt;/em&gt;.
        &lt;&lt;player&gt;&gt;Ehm, well yes, as you see, I&#39;m currently- Wait, what are you doing?&lt;&lt;/player&gt;&gt;
        Your faithful butler, ?Orson, seems to not even let you finish talking when he suddenly walks forward, overcome by the need to relieve himself. 
        &lt;&lt;orson&gt;&gt;I&#39;m so sorry ?title, I really have to go right now. I can&#39;t stop it...&lt;&lt;/orson&gt;&gt; 
        It seems like he expects you to quickly get out of the way... But what is he going to do if you don&#39;t? Just pee on you as you&#39;re sitting here?
        &lt;&lt;decision &#39;Stay seated and let it happen&#39; submissiveness small&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
        &lt;&lt;decision &#39;Order him to hold it in&#39; dominance small&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
        &lt;&lt;decision &#39;Quickly get out of the way&#39; virtue small&gt;&gt;
            You quickly get up, your ?dick flying free as you jump aside. ?Orson immediately fishes his cock out of his underwear and starts blasting the most powerful stream of piss you&#39;ve probably ever heard. He let&#39;s out a huge sigh of relief that sounds like it comes straight from his soul.
            &lt;&lt;orson&gt;&gt;Ahhh... Wow, I&#39;m so sorry, ?title. I was holding that in for a while and I definitely wouldn&#39;t have enough time to get to the other bathroom...&lt;&lt;/orson&gt;&gt;

            You &lt;&lt;if hasTag(&#39;crossdressing&#39;)&gt;&gt;fix your skirt&lt;&lt;else&gt;&gt;put your trousers back on&lt;&lt;/if&gt;&gt; and look at him with a mix of annoyance and confusion at this very strange chain of events happening. 
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/if&gt;&gt; */
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Pee standing&#39;&gt;&gt;
    You aim your ?dick straight at the toilet and unleash a stream of piss. You instantly feel relieved, letting out a satisfied sigh.?nl
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="651" name="Bedtime" tags="" position="100,8225" size="100,100">&lt;&lt;setlocation &#39;Bedroom&#39;&gt;&gt;
&lt;&lt;if isDisguised()&gt;&gt;
    It&#39;s getting late so you quickly make your way back to the castle. You quietly sneak to your room and stow away your disguise. You put on your sleep attire before you fall down on your bed, exhausted. 
&lt;&lt;else&gt;&gt;
    It&#39;s getting late so you make your way over to your bedroom and change into your sleep attire.
&lt;&lt;/if&gt;&gt;

&lt;&lt;outfit sleep&gt;&gt;
&lt;&lt;decision &#39;Sleep&#39; &#39;Sleep&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="652" name="Sleep" tags="" position="225,8225" size="100,100">&lt;&lt;outfit sleep&gt;&gt;



&lt;&lt;include &#39;Night&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="653" name="Skipday" tags="" position="350,8225" size="100,100">&lt;&lt;timed 40ms&gt;&gt;
    &lt;&lt;skipday false&gt;&gt;
&lt;&lt;/timed&gt;&gt;
You spend the day doing menial tasks, nothing of importance.

&lt;&lt;fadein 3s 3s&gt;&gt;&lt;&lt;decision &#39;Next Day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;include &#39;Start Day&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;&lt;&lt;/fadein&gt;&gt;</tw-passagedata><tw-passagedata pid="654" name="Increase Day" tags="" position="475,8225" size="100,100">&lt;&lt;timed 40ms&gt;&gt;
    &lt;&lt;increasetime 1&gt;&gt;&lt;&lt;increaseday 1&gt;&gt;
    &lt;&lt;include &#39;Start Day&#39;&gt;&gt;
    &lt;&lt;include &#39;Morning&#39;&gt;&gt;
&lt;&lt;/timed&gt;&gt;</tw-passagedata><tw-passagedata pid="655" name="Start Day" tags="" position="600,8225" size="100,100">&lt;&lt;outfit standard&gt;&gt;
&lt;&lt;if hasQuest(&#39;kathryn-dinner-invitation&#39;)&gt;&gt;
    &lt;&lt;completequest &#39;kathryn-dinner-invitation&#39;&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if hasQuest(&#39;kathryn-chastity-week&#39;) and isInChastity() and questStep(&#39;kathryn-chastity-week&#39;) &lt; 8&gt;&gt;
    &lt;&lt;advancequest &#39;kathryn-chastity-week&#39;&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="656" name="Morning" tags="" position="725,8225" size="100,100">&lt;&lt;run Save.autosave.save(getDay().toUpperFirst() + &#39; morning.&#39;)&gt;&gt;

&lt;&lt;runevents wake&gt;&gt;</tw-passagedata><tw-passagedata pid="657" name="Night" tags="" position="850,8225" size="100,100">&lt;&lt;runevents dream&gt;&gt;</tw-passagedata><tw-passagedata pid="658" name="Dream Event Default" tags="event" position="975,8225" size="100,100">Zzzzzzz...

&lt;&lt;decision &#39;Wake up&#39; &#39;Increase Day&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="659" name="Assassination" tags="" position="1100,8225" size="100,100">&lt;&lt;setlocation Road&gt;&gt;
You make your way along the road back to the castle. You always enjoy this walk by yourself on Sundays after church. It&#39;s a good moment to reflect on the teachings of &lt;&lt;fullname devota&gt;&gt;, especially after spending time in the confession booth. You always feel a bit raw after baring your soul.?nl

As you&#39;re walking across the narrow cobbled path up the hill you notice someone walking a small distance behind you. You take a quick peek back at him, you can barely see his face under his hood but it looks like he has a large scar across his face. Strange, what business would this unknown man have at the castle??nl

As you contemplate this, it almost seems like he is in a hurry as he suddenly starts walking faster, inching closer towards you. You think to yourself: &lt;&lt;player short&gt;&gt;Perhaps he&#39;s one of ?Leopold&#39;s new tradesmen.&lt;&lt;/player&gt;&gt;, but the moment you take a peek behind you to get another look at him you now notice he has pulled out a knife and is running towards you.

&lt;&lt;say &#39;Assassin&#39; &#39;images/portraits/assassin.jpg&#39;&gt;&gt;It&#39;s nothing personal, prince.&lt;&lt;/say&gt;&gt;

&lt;&lt;decision &#39;Fight him off&#39; dominance large swordsmanship 1&gt;&gt;
    &lt;&lt;addtag &#39;fought-assassin&#39;&gt;&gt;
    &lt;&lt;startquest &#39;assassination-attempt&#39;&gt;&gt;
    You quickly turn around and get ready to fight him. He&#39;s running full sprint, dagger held high. Adrenaline now pumping through your body, you think back to all the training with ?Wymerus. You&#39;re trying to take a defensive stance, he&#39;d probably still tell you your footwork is horrible but you&#39;re actually surprised you somehow managed to remember the training in this moment at all.?nl
    You spot a clear weakness in the assassin&#39;s charge, as he&#39;s running at you, you notice he&#39;s only holding the dagger with one hand. The moment he closes enough distance towards you, you decide to lunge at the dagger. Taking his blade from him is the only way you&#39;re going to win this fight, seeing as you are unarmed.?nl
    The man didn&#39;t seem to expect this as your pounce immediately brings him off balance, you manage to knock both of you down in the dirt, his dagger is knocked out of his hands and rolls a short distance away from the both of you.&lt;br&gt;
    You both are grunting on the ground as you wrestle each other in the dirt. At least you already made this assassination attempt more difficult for him.?nl
    He gives you a foul headbutt to your cheek, you don&#39;t have time to think about the pain all you can focus on is getting that dagger. As you are on top, you quickly push yourself off the ground and sprint for the dagger lying close by.?nl
    He pulls at your leg and tries to run past you. He&#39;s desperately trying to get there before but unfortunately for him, you manage to get there faster. You grab the short blade and with a flourish you turn around at immediately hold the blade to the man&#39;s neck.?nl
    Thinking you have bested him, you are quickly snapped back to reality as this man seems to care little for your threat, you are caught by surprise as he still tries to take the blade from you, pushing you back to the ground. 
    &lt;&lt;decision &#39;You think you are defeated&#39; &#39;Assassination 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Try to run&#39;&gt;&gt;
    &lt;&lt;startquest &#39;assassination-attempt&#39;&gt;&gt;
    As soon as you see this you decide that &#39;flight&#39; is definitely the best option in this situation. You make a run for it, trying to quickly climb the hill towards the castle. This man seemed to anticipate this though as he quickly manages to catch up with you. You yelp out as he suddenly tackles you to the ground. You try to crawl out of his grasp when you see him lower the blade to your abdomen.
    &lt;&lt;decision &#39;You think you are defeated&#39; &#39;Assassination 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="660" name="Assassination 2" tags="" position="1225,8225" size="100,100">&lt;&lt;effect flash&gt;&gt;
Right before you think it is all over, a purple light streaks across the sky and collides with the man on the back of the head. A thunderous blast is heard as the light blinds you for a moment. You hear the man suddenly drop to the floor as he falls over besides you, the purple light now emanating from the place where it hit him.

&lt;&lt;decision &#39;You see Morgana run towards you from a distance&#39; &#39;Assassination 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="661" name="Assassination 3" tags="" position="100,8350" size="100,100">&lt;&lt;morgana&gt;&gt;?Title, are you alright? Are you hurt anywhere?&lt;&lt;/morgana&gt;&gt;
She takes a look at you as you&#39;re now a bit in shock, delaying your response.
&lt;&lt;player&gt;&gt;I- I think I&#39;m fine. Thank you, ?Morgana.&lt;&lt;/player&gt;&gt;
?Morgana quickly inspects you with a spell, ensuring you aren&#39;t hurt anywhere. Luckily you aren&#39;t wounded except for a few bruises but things could&#39;ve turned out quite differently if she wasn&#39;t here. She helps you get back on your feet and you look over to the man lying face-first in the dirt, effectively shot by one of ?Morgana&#39;s spells.
&lt;&lt;player&gt;&gt;You saved me ?Morgana. I don&#39;t know what would&#39;ve happened if you weren&#39;t here...&lt;&lt;/player&gt;&gt;
&lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;
    &lt;&lt;morgana&gt;&gt;I actually doubt he would have won, ?title. You fought very bravely, I only knocked him out with a spell. Now, let&#39;s get you inside, the council will want to hear of this.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Don&#39;t think about that, ?title. I knocked him unconscious. Let&#39;s get you inside, the council will want to hear of this.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;/if&gt;&gt;
You lean on ?Morgana&#39;s shoulder as she takes you the rest of the way to the castle.

&lt;&lt;decision &#39;Go to the Grand Hall&#39; &#39;Assassination Meeting&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="662" name="Assassination Meeting" tags="" position="225,8350" size="100,100">&lt;&lt;increasetime 1&gt;&gt;
&lt;&lt;setlocation &#39;Grand hall&#39;&gt;&gt;
You are still in a bit of a haze, shocked by the events of nearly being killed. You focus on ?Morgana&#39;s face as she&#39;s both escorting you with care and at the same time shouting commands across the halls. You make out several soldiers now running all over the place.
?Morgana is carrying you to the Grand hall and helps you sit in one of the chairs. She looks at you with a smile.
&lt;&lt;morgana&gt;&gt;It&#39;s okay, ?title. You&#39;re still in shock but you will feel better soon.&lt;&lt;/morgana&gt;&gt;
After a little while, the large doors of the grand hall are thrown open as you see ?Andreas walk hurriedly towards you, behind him are most of the other councillors and a retinue of guards surrounding the hall.
&lt;&lt;andreas&gt;&gt;What has happened? Is the prince well?&lt;&lt;/andreas&gt;&gt;
?Andreas was always a stern man but you have never heard him speak so direct with such a shocked expression.
?Morgana takes a moment to explain the assassination attempt that happened earlier and reassure them you are doing well.
?Andreas gives a nod and addresses the councillors here.
&lt;&lt;andreas&gt;&gt;In light of this, I open this emergency meeting of the council. We need to act swiftly. &lt;&lt;name wymerus &#39;Lord&#39;&gt;&gt;, secure the castle, we are on complete lockdown until further notice. &lt;&lt;name sybille &#39;Lady&#39;&gt;&gt;, apprehend the perpetrator and lock him in the dungeons.&lt;&lt;/andreas&gt;&gt;
&lt;&lt;sybille&gt;&gt;He is already being fetched, my lord.&lt;&lt;/sybille&gt;&gt;
&lt;&lt;andreas&gt;&gt;Good, we need to know who sent him. This might have been an act of aggression coming from one of our neighbors, and if so, it might be the start of a larger attack. We need to secure our position.&lt;&lt;/andreas&gt;&gt;
The councillors take some time to discuss emergency measures taken in response to this event. Even though it&#39;s very stressful environment right now, you feel yourself calming down now that you know you are once again safe.
?Andreas looks at you as he gives out another order.
&lt;&lt;andreas&gt;&gt;?Title. We must ensure your security from now on. I think it is best that you stay inside the castle for now, and only ever leave with armed escort when going outside.&lt;&lt;/andreas&gt;&gt;
Before you can give a response, ?Andreas looks at the rest of the council. &lt;&lt;andreas&gt;&gt;All in favour of these measures? Good, then I close this meeting, there&#39;s work to do.&lt;&lt;/andreas&gt;&gt;
One by one the councillors leave except for ?Morgana.
&lt;&lt;morgana&gt;&gt;Fear not, ?title. Everyone is just on edge because of what happened. We all want to protect you. How are you feeling?&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;I&#39;m doing much better, I have to thank you again, ?Morgana. I don&#39;t know how I could repay you.&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;Don&#39;t worry yourself about that, ?title. I was only doing my job. Now, do you need any help getting back to your chambers?&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Thank you but I&#39;m alright. I think I just need to take a rest.&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Take a rest in your chambers&#39; &#39;Assassination Bedroom&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="663" name="Assassination Bedroom" tags="" position="350,8350" size="100,100">As you enter your bedchambers, ready to just hop into your bed, you see ?Orson here, seemingly waiting for you.
&lt;&lt;orson&gt;&gt;?Title, I heard what happened, I am so glad to see you are alright.&lt;&lt;/orson&gt;&gt;
&lt;&lt;player&gt;&gt;Thank you, ?Orson. It was quite an eventful day and I think I might just want to take a rest.&lt;&lt;/player&gt;&gt;
&lt;&lt;orson&gt;&gt;Of course, ?title. Allow me to help you get changed, no need to wrinkle your nice sunday suit&lt;&lt;/orson&gt;&gt;
?Orson prepares your pyjamas and helps you get ready for bed, it&#39;s not even evening yet but you already feel wrecked. You decide it&#39;s best to go to bed early.

&lt;&lt;decision &#39;Sleep&#39; &#39;Sleep&#39;&gt;&gt;
    &lt;&lt;acknowledgechanges &#39;assassination&#39;&gt;&gt;
    &lt;&lt;increasetime 2&gt;&gt;
    &lt;&lt;equip &#39;prince_outfit_1&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;


/* Happens after working at the tavern/brothel for a while */</tw-passagedata><tw-passagedata pid="664" name="Tavern Back Room Andreas 1" tags="" position="475,8350" size="100,100">&lt;&lt;setlocation &#39;Corridor&#39;&gt;&gt;
&lt;&lt;completequest &#39;velma-note&#39;&gt;&gt;
&lt;&lt;generatenoble&gt;&gt;

You&#39;re about to knock on the office door when it swings wide open and you nearly walk into the ?Madame herself.

&lt;&lt;velma&gt;&gt;Oh, ?newname! Excellent timing. Come, walk with me and I&#39;ll brief you on what you need to know for this evening.&lt;&lt;/velma&gt;&gt;

Caught off-guard by her energy, you follow nervously as she leads you down a hallway toward the private room.

&lt;&lt;velma&gt;&gt;?ChancellorAndreas prefers to minimize distractions during his meeting, so you will be on your own this evening. Make sure you have prepared the room before they arrive, and greet them graciously as they enter.&lt;&lt;/velma&gt;&gt;

At these words, a pang of anxiety flutters in your stomach.

&lt;&lt;player&gt;&gt;On my own? But this is my first time working in the private room...&lt;&lt;/player&gt;&gt;

&lt;&lt;velma&gt;&gt;Worry not, my dear. I&#39;m sure you will do a splendid job after all your training. Just remember to be courteous and accommodating when your services are requested, and invisible when not. If you do your job well, they should forget that you&#39;re there.&lt;&lt;/velma&gt;&gt;

You suppose this is why ?Sybille sent you here in the first place. The nerves only worsen as you realize that tonight could be the moment you learn who hired that assassin. You just hope your disguise is good enough that you won&#39;t be given away.?nl

You and ?Velma come to a stop in front of the door to the private room.

&lt;&lt;player&gt;&gt;?MadameVelma, do you know why ?Andreas is so secretive about his meetings here?&lt;&lt;/player&gt;&gt;

?Velma chuckles, holding open the door for you.

&lt;&lt;velma&gt;&gt;I&#39;m afraid I don&#39;t know, but you&#39;ll find out soon enough.&lt;&lt;/velma&gt;&gt;

&lt;&lt;decision &#39;Prepare the room&#39; &#39;Tavern Back Room Andreas 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="665" name="Tavern Back Room Andreas 2" tags="" position="600,8350" size="100,100">&lt;&lt;setlocation &#39;Backroom&#39;&gt;&gt;

You spend some moments preparing the room, wiping away a light layer of dust here and a speck of dried ale there until the room is sparkling clean. Just as you&#39;re finishing up, you hear footsteps approaching down the hallway. You rush to the door and hold it open just in time for ?Andreas and a group of others you don&#39;t recognize to arrive.

&lt;&lt;player&gt;&gt;Welcome, valued guests...&lt;&lt;/player&gt;&gt;

They nod minutely as they enter, barely noticing you. Only ?Andreas&#39;s eyes linger on you, and for one wild moment you think he must recognize you, but then he looks away, seemingly uninterested. As the group takes their seats he makes an announcement.

&lt;&lt;andreas&gt;&gt;As you know, last week&#39;s movements altered the map greatly. We have much to discuss. However, let us first acquire food and drink to sustain us through this critical meeting.&lt;&lt;/andreas&gt;&gt;

You don&#39;t have much time to consider what this means as the guests immediately begin to call out their orders. Hurriedly, you mark down an extensive list of drinks and food and rush it to the cookroom.?nl

When you return, you see that the group has unrolled a large map on the table. They are placing small markers on it, as though to indicate certain locations, or perhaps people. As you cling to the wall, attempting to be invisible, a man with a dark goatee speaks up.

&lt;&lt;say &#39;Goateed nobleman&#39;&gt;&gt;A lack of leadership plagues your kingdom, ?Chancellor. Your neighbors may well consider this weakness an opportune moment to mount an offensive...&lt;&lt;/say&gt;&gt;

A sly look on his face, he uses a long stick to shift a group of markers in front of ?Andreas. You realize with shock what is happening here. This is a portrayal of war, yet you know of no war. Has ?Andreas been keeping this a secret from you? Your thoughts race as you consider the possibilities.

&lt;&lt;andreas&gt;&gt;Only a fool would consider my position one of weakness, &lt;&lt;noble&gt;&gt;. On the contrary, I consider it a personal opportunity. In chaos, those with strength emerge on top, and I have formed alliances.&lt;&lt;/andreas&gt;&gt;

?Andreas locks eyes with a golden-haired woman sitting across from him. Simultaneously, they move their sizeable combined forces across the board. The goateed man seems to realize he is outnumbered. Huffing loudly, he taps what looks like a small mallet on the table, as if in a sign of resignation.?nl

The golden-haired woman smiles dangerously at him and speaks with a commanding voice.

&lt;&lt;say &#39;Golden-haired noblewoman&#39;&gt;&gt;I had not expect you would believe that such a power vacuum be accidental, &lt;&lt;noble&gt;&gt;. You neglect to notice the orchestrated plan...&lt;&lt;/say&gt;&gt;

&lt;&lt;say `getNoble()`&gt;&gt;Bah, to hell with you and your plans. I will find a way to take advantage of your weakness.&lt;&lt;/say&gt;&gt;

Watching from your position on the wall, you feel as though your stomach has dropped out of your body. You thought you might learn something during this meeting, but you never could have expected a revelation so blatant as this. On top of keeping some kind of conflict hidden from you, ?Andreas, the chancellor of your very own council, considers the absence of the ?King a &lt;i&gt;personal opportunity?&lt;/i&gt;?nl

Part of you wants to flee from this room right now to tell ?Sybille all you know, but you know leaving your shift could arouse suspicion. You focus on calming your breathing, and by the time you&#39;ve regained your composure, the conversation seems to have shifted to a conflict not involving ?Andreas.

&lt;&lt;decision &#39;Finish your shift&#39; &#39;Tavern Back Room Andreas 3&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="666" name="Tavern Back Room Andreas 3" tags="" position="725,8350" size="100,100">&lt;&lt;changemoney &#39;gold&#39; +20&gt;&gt;

The hours tick by as ?Andreas and the nobles strategize fiercely. There seems to be a great deal of discussion before any moves are made on the map, and the social battles seem just as important as the physical ones. If you&#39;re honest, it&#39;s deadly boring, but you do your best to pay attention.?nl

By the time they finally leave, the clock has ticked long into the night, and you have a room full of dirtied goblets and dishes to clean. You do your best to return the room to its default state, wanting only to rush back to the castle.

&lt;&lt;velma&gt;&gt;Hello, dear, I&#39;m just stopping by on my way to bed. Did everything go well?&lt;&lt;/velma&gt;&gt;

&lt;&lt;player&gt;&gt;Oh! ?Madame, y-yes, I think it went well...&lt;&lt;/player&gt;&gt;

She hands you a large handful of coins amounting to &lt;&lt;money gold false 20&gt;&gt; gold.

&lt;&lt;velma&gt;&gt;It seems they agree. ?Andreas left this for you on his way out. Well done, ?newname.&lt;&lt;/velma&gt;&gt;

She smiles at you and disappears down the hallway. You pocket the coins and finish cleaning up, then begin your trek back to the castle, trying to keep your pace natural.

&lt;&lt;decision &#39;Find ?Sybille in the dungeons&#39; &#39;Sybille Inform About Andreas&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="667" name="Sybille Inform About Andreas" tags="" position="850,8350" size="100,100">&lt;&lt;setlocation &#39;Dungeons&#39;&gt;&gt;

As soon as you slip into the castle, you rush to the dungeons. Despite the late hour you see ?Sybille is here, leaning over a piece of paper. You catch a glimpse of what looks like a box full of letters, and she seems to be circling some of them to form words.?nl

Seeing you approach, ?Sybille removes the paper from her desk and slides it away inside a drawer. She stands up, looking at you with an intent expression.

&lt;&lt;sybille&gt;&gt;?Title, what have you learned?&lt;&lt;/sybille&gt;&gt;

You stand in front of her, doing your best to remain calm.

&lt;&lt;player&gt;&gt;?Sybille, it&#39;s so much worse than I could have imagined! They were planning a war! They were moving all these pieces around a big map! It sounded as though ?Andreas wanted to take control of the kingdom! And there were so many catapults! And they kept tapping the table with these miniature mallets, I don&#39;t know what that was about! And-and...&lt;&lt;/player&gt;&gt;

You trail off as you see a sudden look of amused realization on ?Sybille&#39;s face. Slowly, she takes a seat again.

&lt;&lt;sybille&gt;&gt;Ah. I should have known.&lt;&lt;/sybille&gt;&gt;

You stare at her, your heart still beating fast in your chest. 

&lt;&lt;player&gt;&gt;Known? Known what?&lt;&lt;/player&gt;&gt;

&lt;&lt;sybille&gt;&gt;I am sorry, ?title, for scaring you over this. It sounds as though ?Andreas and his friends were simply playing a game.&lt;&lt;/sybille&gt;&gt;

You realize your mouth is agape, and you close it quickly.

&lt;&lt;player&gt;&gt;A game? W-what game?&lt;&lt;/player&gt;&gt;

&lt;&lt;sybille&gt;&gt;I believe it is called Battlemallet. It is an amusing game in which one pretends to wage war against friends.&lt;&lt;/sybille&gt;&gt;

Your thoughts race, trying to re-evaluate what you just experienced in this context.

&lt;&lt;player&gt;&gt;I... You mean that all of this undercover work was for nothing?&lt;&lt;/player&gt;&gt;

?Sybille folds her hands together, looking thoughtful.

&lt;&lt;sybille&gt;&gt;I am sorry, ?title. I truly believed ?Andreas might be doing something more suspicious in the tavern. We seem to be at an impasse.&lt;&lt;/sybille&gt;&gt;

Suddenly you realize how foolish you must look in this moment, standing here in the dungeon in your ?barworker clothes. You feel somehow embarrassed, as though it is your fault that the investigation has stalled.

&lt;&lt;sybille&gt;&gt;Please do not take this personally, ?title. Undercover work is often for naught. I will think on our next steps. Return to me tomorrow.&lt;&lt;/sybille&gt;&gt;

You nod to her and make your way dejectedly back into the castle. Now that the adrenaline has worn off, exhaustion takes over, and you&#39;re too tired to consider how frustrated you feel. 

&lt;&lt;decision &#39;Return to your room and fall into bed&#39; &#39;Bedtime&#39;&gt;&gt;&lt;&lt;startquest &#39;interrogate-assassin&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="668" name="Sybille Interrogate Assassin 1" tags="" position="975,8350" size="100,100">&lt;&lt;if hasTag(&#39;sybille-peeped&#39;)&gt;&gt;
    You approach ?Sybille, seeing that she has changed into her skin-tight black leather interrogation suit. You allow your gaze to slide over the curve of her breasts for just a moment before meeting her gaze.

    &lt;&lt;img &quot;sybille/sybille_dominatrix_{theme}.jpg&quot;&gt;&gt;

    &lt;&lt;sybille&gt;&gt;As you can see, ?title, I have decided that our only path forward is to continue the interrogation of the assassin. Perhaps your presence will provide some additional...incentive.&lt;&lt;/sybille&gt;&gt;
&lt;&lt;else&gt;&gt;
    You approach ?Sybille, noticing immediately that she has changed out of her usual dress into a revealingly skin-tight black leather suit. It shows every curve of her body, and your eyes linger on the details for some moments until you eventually drag them away. Before you can ask her the reason for the outfit change, she speaks up. 

    &lt;&lt;img &quot;sybille/sybille_dominatrix_{theme}.jpg&quot;&gt;&gt;

    &lt;&lt;sybille&gt;&gt;Welcome, ?title. Would you care to accompany me to the dungeons? I have decided that our only path forward is to continue the interrogation of the assassin.&lt;&lt;/sybille&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;player&gt;&gt;U-um, of course, ?Sybille, I would be happy to join you.&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Follow ?Sybille&#39; &#39;Sybille Interrogate Assassin 1a&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="669" name="Sybille Interrogate Assassin 1a" tags="" position="1100,8350" size="100,100">You follow her into the depths of the dungeons, winding past cell upon cell until you arrive in a miserable, dark corner, where any shred of warmth seems to seep into the cold stones.

&lt;&lt;say &#39;Assassin&#39; &#39;images/portraits/assassin.jpg&#39;&gt;&gt;Back again, are we?&lt;&lt;/say&gt;&gt;

&lt;&lt;sybille&gt;&gt;Yes. And this time I have brought someone you might recognize.&lt;&lt;/sybille&gt;&gt;

You step forward. In the near-darkness you can just make out the familiar face of the man who attacked you, marred by a long, vicious-looking scar. Seeing him again sends a jolt through you, a reminder of the threat to your life. Luckily, you see his wrists and ankles are locked in iron manacles attached to the wall.

&lt;&lt;say &#39;Assassin&#39; &#39;images/portraits/assassin.jpg&#39;&gt;&gt;Ah, you. You know, I meant it when I said it&#39;s nothing personal.&lt;&lt;/say&gt;&gt;

You meet his eyes, your jaw set. ?Sybille unlocks the cell door, and you follow her inside.

&lt;&lt;sybille&gt;&gt;You have said that before. What do you mean?&lt;&lt;/sybille&gt;&gt;

The man stares back at her, tight-lipped. &lt;&lt;if hasTag(&#39;sybille-peeped&#39;)&gt;&gt;Even in the darkness you swear you can see a bulge growing in his pants. You assume ?Sybille must have used her special techniques on him already.&lt;&lt;else&gt;&gt;Through the darkness, you can just make out what looks like a bulge growing in his pants. Is he getting turned on to this situation?&lt;&lt;/if&gt;&gt;?nl

?Sybille turns to you, a dark smile on her face.

&lt;&lt;sybille&gt;&gt;Are you ready to begin, ?title?&lt;&lt;/sybille&gt;&gt;

&lt;&lt;decision &#39;Begin the interrogation&#39; &#39;Sybille Interrogate Assassin 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="670" name="Sybille Interrogate Assassin 2" tags="" position="1225,8350" size="100,100">You nod at ?Sybille through the darkness.

&lt;&lt;sybille&gt;&gt;Good. I will leave the choice to you, ?title: What approach shall we take here?&lt;&lt;/sybille&gt;&gt;

&lt;&lt;decision &#39;Speak with him diplomatically&#39;&gt;&gt;
    You turn to the man, adopting a friendly, reasonable tone of voice.

    &lt;&lt;player&gt;&gt;Come now, sir. I appreciate a man who honors a business deal, but we all know that assassination is a nasty business. The one to blame here is the person you hired you. Tell us that information, and you may walk free.&lt;&lt;/player&gt;&gt;

    The man spends a long time searching your face, as though deciding whether to trust you.

    &lt;&lt;decision &#39;Hear him talk&#39;&gt;&gt;
        &lt;&lt;goto &#39;Assassin Gives Up Info&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    
&lt;&lt;disableif getStatLevel(&#39;statesmanship&#39;) &lt; 3&gt;&gt;
    Need a statesmanship level of 3.
&lt;&lt;decisionicon statesmanship&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;Intimidate him physically&#39; dominance small&gt;&gt;
    You look around for any kind of weapon, and notice for the first time a whip tucked into a belt around ?Sybille&#39;s hips. You look pointedly at it, and she hands it to you without a word.

    &lt;&lt;player&gt;&gt;Listen here, you maggot. Our spymaster here has worked hard to glean information from you, but she must have been playing nice, because I don&#39;t see any injuries on you. That can quickly change.&lt;&lt;/player&gt;&gt;

    You let the whip fly against his cheek. He winces in pain, and you see a flush of red rise on his skin where you hit it. 

    &lt;&lt;player&gt;&gt;This is merely a suggestion of what I could do to you. Tell us what you know.&lt;&lt;/player&gt;&gt;

    You hit him again with the whip, this side on the other cheek. He winces again, but seems to be holding in any sounds of pain.

    &lt;&lt;decision &#39;Hear him talk&#39;&gt;&gt;
        &lt;&lt;goto &#39;Assassin Gives Up Info&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
    
&lt;&lt;disableif getStat(&#39;dominance&#39;) &lt; 50&gt;&gt;
    Your dominance is not high enough.
&lt;&lt;/decision&gt;&gt;
&lt;&lt;if hasTag(&#39;sexwork&#39;)&gt;&gt;
    &lt;&lt;decision &#39;Use pleasure to make him talk&#39; depravity medium&gt;&gt;
        &lt;&lt;spicy&gt;&gt;
        &lt;&lt;addsin &#39;cum-eating&#39;&gt;&gt;

        You can definitely see a tent in his pants now. &lt;&lt;if hasTag(&#39;sybille-peeped&#39;)&gt;&gt;You get the impression he has been enjoying ?Sybille&#39;s interrogation sessions. Perhaps he doesn&#39;t even want to be let go.&lt;&lt;else&gt;&gt;You get the impression that something about this interrogation context is arousing to him.&lt;&lt;/if&gt;&gt; You decide that you could use this to your advantage. You realize your undercover work at the tavern did have a purpose after all: You&#39;ve been perfectly trained in the arts of pleasure.

        &lt;&lt;player&gt;&gt;You&#39;re enjoying this, aren&#39;t you? Maybe you could be helped with that problem you have, if only you tell us what you know...&lt;&lt;/player&gt;&gt;

        &lt;&lt;say &#39;Assassin&#39; &#39;images/portraits/assassin.jpg&#39;&gt;&gt;Hah! Don&#39;t suggest something you can&#39;t deliver, ?title.&lt;&lt;/say&gt;&gt;

        You&#39;re starting to feel quite turned on, being in this position of control. Slowly, you approach and run a hand across his trousers. You feel his erection under the fabric, hard and begging to be let free.

        &lt;&lt;say &#39;Assassin&#39; &#39;images/portraits/assassin.jpg&#39;&gt;&gt;Huh, you&#39;re actually going to use ?Sybille&#39;s methods? Well go on then, prove it...&lt;&lt;/say&gt;&gt;

        You can&#39;t believe you&#39;re actually doing this but he gave you a challenge after all. You grab his cock through his pants, holding it firmly.

        &lt;&lt;player&gt;&gt;I suppose you&#39;d like for this to be...released?&lt;&lt;/player&gt;&gt;

        He nods fervently, a look of hunger in his eyes as you gently rub him through his clothes.

        &lt;&lt;say &#39;Assassin&#39; &#39;images/portraits/assassin.jpg&#39;&gt;&gt;Please...&lt;&lt;/say&gt;&gt;

        He throws his head back, letting out a low moan as you grasp his cock through the fabric of his trousers. Part of you wants to stop here, to make him spill his secrets before he spills his load, but another part is enjoying this greatly. You hear a whisper in your ear.
        
        &lt;&lt;sybille&gt;&gt;You take after me, I see, ?title. Give him what he wants, and he will beg to tell you what he knows.&lt;&lt;/sybille&gt;&gt;
    
        You don&#39;t have to be told twice. In a blur of arousal, you kneel down on the dirty dungeon floor as you free his erection, almost hitting yourself in the face with it. You use a finger the trail the entire length of it and are met with a single drop of pre-cum at the tip. You smile up at him as you see him squirming.?nl
        You should probably drag it out longer but you also can&#39;t wait any longer. You take it into your mouth, sucking with enthusiastic abandon. He moans loudly, and you take him in ever deeper, letting the head push into the softest parts of your mouth.

        &lt;&lt;say &#39;Assassin&#39; &#39;images/portraits/assassin.jpg&#39;&gt;&gt;Fuck, I can&#39;t believe the ?Prince is sucking my cock...&lt;&lt;/say&gt;&gt;

        Your mouth fills with the taste of his pre-cum as you continue to suck up and down on his cock. He moans even louder, and you realize there is something incredibly erotic about giving a blowjob to a man locked in manacles.?nl 
        
        Somehow, even though you&#39;re in charge, it makes you feel lower than him. Your own prisoner, stuck in your dirty prison and yet here you are, servicing him with your royal mouth...

        &lt;&lt;sybille&gt;&gt;That&#39;s good, keep going, ?title...&lt;&lt;/sybille&gt;&gt;

        Out of the corner of your eye, you can just barely see ?Sybille moving in the side of the cell. It seems as though she is pleasuring herself while she watches. She moans quietly, her fingers moving quickly between her legs.

        &lt;&lt;say &#39;Assassin&#39; &#39;images/portraits/assassin.jpg&#39;&gt;&gt;Fuck, I&#39;m nearly there...&lt;&lt;if settings.cum&gt;&gt; You better swallow, you royal slut.&lt;&lt;/if&gt;&gt;&lt;&lt;/say&gt;&gt;

        You thrust his cock into the back of your mouth a final time. He lets out an enraptured moan and you feel his shaft pulsing as hot liquid spurts down your throat. At the same time, you hear a quiet series of moans as ?Sybille moves through her own orgasm.?nl

        &lt;&lt;if settings.cum&gt;&gt;You don&#39;t even get to taste his semen as it&#39;s all efficiently deposited in your throat. That was... exhilarating...?nl&lt;&lt;/if&gt;&gt;

        You stand, feeling oddly proud of yourself for what you&#39;ve just done. After ?Sybille recovers, she moves behind you and puts a hand on your should as she whispers something in your ear.

        &lt;&lt;sybille&gt;&gt;I see you&#39;ve been trained well at ?Velma&#39;s brothel, ?title... Very well done...&lt;&lt;/sybille&gt;&gt;

        You nod at her, stoically returning to the matter at hand.

        &lt;&lt;player&gt;&gt;Now, tell us what you know.&lt;&lt;/player&gt;&gt;

        He chuckles, still catching his breath.

        &lt;&lt;decision &#39;Hear him talk&#39;&gt;&gt;
            &lt;&lt;goto &#39;Assassin Gives Up Info&#39;&gt;&gt;
        &lt;&lt;/decision&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;decision &#39;Come back later&#39;&gt;&gt;
    You lean over to ?Sybille to whisper to her.
    &lt;&lt;player&gt;&gt;Uhm- Sorry, ?Sybille... I can&#39;t do this right now...&lt;&lt;/player&gt;&gt;

    She looks at you with concern and quickly opens the cell door. You make your way out together, leaving the prisoner alone.

    &lt;&lt;sybille&gt;&gt;It&#39;s okay, ?title. I shouldn&#39;t have thrown this idea at you, I just wanted to try any option we have.&lt;&lt;/sybille&gt;&gt;

    &lt;&lt;player&gt;&gt;No- I&#39;m sorry, we can do this later. I just need some time.&lt;&lt;/player&gt;&gt;

    She gives you an understanding nod.

    &lt;&lt;sybille&gt;&gt;That makes sense. I will wait for you for when you&#39;re ready.&lt;&lt;/sybille&gt;&gt;

    &lt;&lt;decision &#39;Leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="671" name="Assassin Gives Up Info" tags="" position="100,8475" size="100,100">&lt;&lt;completequest &#39;interrogate-assassin&#39;&gt;&gt;

&lt;&lt;say &#39;Assassin&#39; &#39;images/portraits/assassin.jpg&#39;&gt;&gt;I swear, I&#39;ve already told you everything.&lt;&lt;/say&gt;&gt;

You lean in, your face close to his, and look at him intently.

&lt;&lt;player&gt;&gt;Really? Everything?&lt;&lt;/player&gt;&gt;

&lt;&lt;say &#39;Assassin&#39; &#39;images/portraits/assassin.jpg&#39;&gt;&gt;Yes. Listen, you seem to think I&#39;m withholding something, so I&#39;ll tell you what I told ?Sybille many times before. I had a meeting with the person who hired me, here, in this castle. They made sure there were no guards around as they let me in.&lt;&lt;/say&gt;&gt;

You look at him with suspicion. Nothing he tells you so far is new information, ?Sybille has already been over this... He was definitely hired by one of the councilors, that much you knew.

&lt;&lt;say &#39;Assassin&#39; &#39;images/portraits/assassin.jpg&#39;&gt;&gt;And after ambushing you, I can&#39;t even remember anything more about who hired me... I barely even recall when I jumped you. I only remember how &lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;I put you to the ground, easily,&lt;&lt;else&gt;&gt;you fought back fiercely before I got to you,&lt;&lt;/if&gt;&gt; and everything before that is a blur.&lt;&lt;/say&gt;&gt;

You nod at him, looking puzzled. Is this really a dead end? It really seems like this prisoner is not keeping anymore secrets, he really just can&#39;t remember...

&lt;&lt;sybille&gt;&gt;Hm. That is unfortunate. I suppose that concludes the interrogation.&lt;&lt;/sybille&gt;&gt;

The assassin looks almost disappointed, almost like he would really want to help you but just can&#39;t. 

&lt;&lt;decision &#39;Follow ?Sybille out of the cell&#39; &#39;Sybille Interrogate Assassin 3&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="672" name="Sybille Interrogate Assassin 3" tags="" position="225,8475" size="100,100">?Sybille takes you out of the prison cell and back to her small office room. She leans over her desk and lets out a loud, disappointed sigh.

&lt;&lt;sybille&gt;&gt;I&#39;m sorry, ?title. It really seems like he can&#39;t remember anything... It seems his memories have been damaged when he ambushed you. &lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;Makes sense with how hard he fell when he hit the floor.&lt;&lt;else&gt;&gt;Makes sense with how he described you hit his head.&lt;&lt;/if&gt;&gt;&lt;&lt;/sybille&gt;&gt;

You stare at ?Sybille as you go over what you know in your head. There&#39;s something that now feels off about the story.

&lt;&lt;player&gt;&gt;He&#39;s been telling you &lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;he easily outmatched me out there?&lt;&lt;else&gt;&gt;that I&#39;ve fought back intensely out there?&lt;&lt;/if&gt;&gt;&lt;&lt;/player&gt;&gt;

?Sybille looks at you with interest.

&lt;&lt;sybille&gt;&gt;Yes... That&#39;s the account he&#39;s given. &lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;But don&#39;t feel bad, ?title. Nobody expected you to beat a trained assassin.&lt;&lt;/if&gt;&gt;&lt;&lt;/sybille&gt;&gt;

&lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;
    That doesn&#39;t feel like what happened at all. You mean, you don&#39;t care about your ego here but you genuinely remember giving the man a good fight. After all that training with ?Wymerus in the yard you actually put your sword-skills to use there...
&lt;&lt;else&gt;&gt;
    That&#39;s not really what happened though... You remember immediately falling to the ground the moment you saw he jumped you. You thought you were done for and didn&#39;t give him much of a fight at all...
&lt;&lt;/if&gt;&gt;?nl

?Sybille sees your suspicious look at frowns at you.

&lt;&lt;player&gt;&gt;It just doesn&#39;t make sense... Why would he lie about how the fight went...&lt;&lt;/player&gt;&gt;

Why is this something he&#39;d lie about? &lt;&lt;if hasTag(&#39;fought-assassin&#39;)&gt;&gt;It seems very weird to try and boost his own ego through this...&lt;&lt;/if&gt;&gt; It&#39;s almost like his memory is not only missing but also...altered??nl

&lt;&lt;player&gt;&gt;?Sybille, I think his memory is not only missing... I think it&#39;s been altered.&lt;&lt;/player&gt;&gt;

&lt;&lt;sybille&gt;&gt;Altered? Interesting... But when would that have happened? You say his memory of the fight is changed but he&#39;s been under careful watch every since...&lt;&lt;/sybille&gt;&gt;

You look at her and give a sigh. She&#39;s right, he couldn&#39;t have been influenced after the assassination attempt, ?Sybille would&#39;ve known.

&lt;&lt;player&gt;&gt;You&#39;re right... I don&#39;t know how he could&#39;ve- Wait-&lt;&lt;/player&gt;&gt;

You freeze as a sudden memory comes up. The moment that damned assassin got to you and you were lying on the ground. The moment it flashed for your eyes.

&lt;&lt;decision &#39;Then it hits you&#39; &#39;Sybille Interrogate Assassin 4&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="673" name="Sybille Interrogate Assassin 4" tags="" position="350,8475" size="100,100">&lt;&lt;effect flash&gt;&gt;

The distinct purple glow that appeared at that exact moment comes to you from a memory. ?Morgana&#39;s spell. The spell that knocked out the assassin and saved your life. What if it wasn&#39;t just a spell to knock someone out? What if it was a spell to also knock away some key memories? You&#39;re intimately knowledgeable about her magic, she would probably be able to do something like this...?nl

?Sybille looks at you as you go over this haunting idea.

&lt;&lt;sybille&gt;&gt;What&#39;s wrong, ?title?&lt;&lt;/sybille&gt;&gt;

In shock, you make the split-second decision to do something very difficult. You decide to lie to ?Sybille.

&lt;&lt;player&gt;&gt;Uhm- Nothing. I&#39;m just overwhelmed by it all...&lt;&lt;/player&gt;&gt;

She looks you up and down and then gives you a nod.

&lt;&lt;sybille&gt;&gt;That is understandable, ?title. Perhaps you require some rest. We can always continue the investigation later.&lt;&lt;/sybille&gt;&gt;

Did that work, does she believe you? Though you would obviously prefer to keep ?Sybille in the loop, telling her that ?Morgana has betrayed you like this feels much too difficult. There must be a different explanation, ?Morgana can&#39;t have done this to you... You must find out.

&lt;&lt;player&gt;&gt;You&#39;re right, ?Sybille. I will go rest and we will continue this discussion later...&lt;&lt;/player&gt;&gt;

Trying to play it off, you turn around and make your way to the door, not even looking back at ?Sybille.?nl

Without another word, you make your way out of the dungeons, a single thought in your mind:?nl 

You must find ?Morgana.

&lt;&lt;decision &#39;Go find ?Morgana&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;startquest &#39;interrogate-morgana&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="674" name="Morgana Confront About Assassin" tags="" position="475,8475" size="100,100">&lt;&lt;stowsidebars&gt;&gt;
&lt;&lt;completequest &#39;interrogate-morgana&#39;&gt;&gt;
&lt;&lt;if $location is not &#39;Garden&#39;&gt;&gt;
    Instead of the where you&#39;d expect to find ?Morgana now, you find her in the garden
&lt;&lt;else&gt;&gt;
    You find ?Morgana in the garden
&lt;&lt;/if&gt;&gt;
&lt;&lt;setlocation &#39;Garden&#39;&gt;&gt;
, standing in front of a canvas, right the middle of a bed of flowers. She&#39;s currently turned away from you, entirely focused on her painting. Somehow she has managed to get to the center of this patch without trampling a single flower. You contemplate for a moment how to get to her without messing up the beautiful foliage but then quickly decide that thinking about that doesn&#39;t matter right now. You need to get some answers. Now.?nl

You step forward, flattening several pristine purple flowers with your boot, and the resulting guilty feeling lives in you for only a moment, before you step forwards again to continue your stampede.?nl

You quickly get closer to ?Morgana and it seems like she hasn&#39;t noticed you yet. She&#39;s using a purple-tipped brush to paint one of the flowers in the field. Her rendition seems almost magical in and of itself, the purple petals let loose a flurry of purple strands throughout the air, seeming to move on the canvas itself. You are momentarily distracted and find yourself standing behind her, simply staring at her paintwork. Suddenly, she starts talking to you, as if she already knew you were coming the moment you set out towards her.

&lt;&lt;morgana&gt;&gt;Shame about the flowers, ?title.&lt;&lt;/morgana&gt;&gt;

You look back and see the destruction caused by your drive. A perfect trail of footprints disturbs the otherwise immaculate flowerbed.

&lt;&lt;player&gt;&gt;Well, I need to speak to you, ?Morgana. I need to...understand.&lt;&lt;/player&gt;&gt;

She&#39;s still turned away from your and continues working on her painting. She&#39;s using very light brush strokes, seemingly only poking the canvas lightly, adding the mildest amount of paint on some precise locations. The moment you talk to her she suddenly stops for a moment, holding the paintbrush up, as if to think what to reply, before she continues painting again.

&lt;&lt;morgana&gt;&gt;I know, ?title. I suppose it&#39;s time for us to talk.&lt;&lt;/morgana&gt;&gt;

She turns her head only a moment to look at you before she focuses her attention to the painting again. She seems...conflicted, or maybe...guilty??nl

You decide to step around her canvas to regain eye contact with her, she&#39;s not going to shy away from you now. After she realizes your intention, she quickly relents and puts down her paintbrush. With her full attention on you now, you can clearly see the look of concern on her face.?nl

You look at her, going over that most important question in your head. Even though you already know the answer, you somehow still cling to this hope that there&#39;s some other explanation you haven&#39;t thought of. Sharing this moment of silent concern, you take a deep breath and let out this question that&#39;s haunting you.

&lt;&lt;player&gt;&gt;?Morgana...did you send that assassin after me?&lt;&lt;/player&gt;&gt;

She looks down towards the floor and nods to herself, as if she&#39;d been expecting this question. She looks up at you again, her troubled expression unchanging. She, in turn, takes a deep breath before she evokes an answer.

&lt;&lt;morgana&gt;&gt;Yes. I hired the assassin to ambush you outside the castle after you came back from church.&lt;&lt;/morgana&gt;&gt;

Your entire body tenses up as this fear becomes a reality. She pauses for a moment, letting the silence serve as moment to reflect on this. 

&lt;&lt;decision &#39;Taken aback, listen to her explanation&#39; &#39;Morgana Confront About Assassin 2&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="675" name="Morgana Confront About Assassin 2" tags="" position="600,8475" size="100,100">Your look of confusion is enough to convey the next most important question to her and she slowly starts explaining with a soft voice.

&lt;&lt;morgana&gt;&gt;It was never meant to hurt you, I was always there to protect you. This &#39;assassin&#39; was nothing more than a hired brigand.&lt;&lt;/morgana&gt;&gt;

&lt;&lt;player&gt;&gt;But why? Why did you do this in the first place?&lt;&lt;/player&gt;&gt;

She looks away again for a moment, pondering how to respond correctly, and she seems conflicted in this.

/* Different when she drank potion? 
Variables to take into account:
 - She drank the potion or not
 - Prince drank the potion or not
 - Prince is a crossdresser
*/

&lt;&lt;morgana&gt;&gt;You have to believe me that I did this for good intentions... I simply wanted to be there for you. I needed a way to be let close to you if I were to support you in any way.&lt;&lt;/morgana&gt;&gt;

&lt;&lt;morgana&gt;&gt;Being the newest member of the council, the other councillors never would&#39;ve let me mentor you like I have if I hadn&#39;t saved your life that day. Not that you really needed any saving, you were never really in danger, ?title.&lt;&lt;/morgana&gt;&gt;

She looks at you with sincere concern before she continues her explanation.

&lt;&lt;morgana&gt;&gt;The staged assassination was also a way to push the council to action... Your father, the ?King, left us with a mission. We have to find a strong alliance to support us. I don&#39;t think the other councillors would be looking for this as diligently if the threat of outside interference didn&#39;t loom so heavily on them now.&lt;&lt;/morgana&gt;&gt;

/* &lt;&lt;morgana&gt;&gt;I, of course, expected them to blame an adversarial kingdom for this attempt on your life. Even though this instance is a farce, the goal is important. I think this has persuaded to action...&lt;&lt;/morgana&gt;&gt; */

Her reasoning probably makes some sense if you&#39;d be bothered to think about it more clearly but right now you&#39;re entirely stuck on the fact that she betrayed you. As you never break off your frown she starts to look away and a face of guilt starts showing on her.


&lt;&lt;morgana&gt;&gt;I... I had never expected ?ChancellorAndreas to react so harshly to this, ?title. It was never my intention that you&#39;d be locked in the castle like so...&lt;&lt;/morgana&gt;&gt;

She makes eye contact with you again, looking like a sad pet that obviously knows they&#39;ve done something wrong.

&lt;&lt;morgana&gt;&gt;That&#39;s why I invited you to go to the forest with me, that&#39;s why I pushed you to wear a disguise, simply so you could still enjoy your freedom.&lt;&lt;/morgana&gt;&gt;


You turn away for a moment, feeling the anger and disappointment course through you.


&lt;&lt;player&gt;&gt;I can&#39;t believe you staged the entire thing... But weirdly enough, that&#39;s not even what bothers me most.&lt;&lt;/player&gt;&gt;

&lt;&lt;player&gt;&gt;What hurts me the most is that you never told me. Not even after we got closer in the time afterwards. I had to figure it out when ?Sybille got suspicious...&lt;&lt;/player&gt;&gt;


&lt;&lt;morgana&gt;&gt;Yes... You&#39;re right, ?title, I regret this. I should have told you this, I- I really wanted to when we were in the forest together but then I never found the right moment... I&#39;m sorry. I don&#39;t expect you to forgive me...&lt;&lt;/morgana&gt;&gt;

You give a deep sigh and look at her, still with a disappointed look. You decide it&#39;s best to just forget your anger for now.

&lt;&lt;player&gt;&gt;I suppose the secret excursions have felt freeing...&lt;&lt;/player&gt;&gt;


&lt;&lt;if hasTag(&#39;crossdresser&#39;)&gt;&gt;
    She takes a step closer and gives you a warm smile.
    &lt;&lt;morgana&gt;&gt;I&#39;m glad to hear that, ?title... And I want you to know I am so proud of you for what you&#39;ve become. You look beautiful in your new outfit and it&#39;s truly very brave.&lt;&lt;/morgana&gt;&gt;
    You look away from her, feeling slightly embarrassed.
    &lt;&lt;player&gt;&gt;Th- thank you...&lt;&lt;/player&gt;&gt;

    &lt;&lt;morgana&gt;&gt;Ever since that day I first tried my magic on you in the library, I&#39;ve... felt something...&lt;&lt;/morgana&gt;&gt;
    She looks you up and down inquisitively.
    &lt;&lt;morgana&gt;&gt;The feeling of something inside of you that&#39;s waiting to be freed... And ever since you put on that disguise, I feel like we get to see more and more of her...&lt;&lt;/morgana&gt;&gt;
    Her words hit you deep and you&#39;re unsure how to respond. She lays a hand on your cheek and whispers to you.

    &lt;&lt;morgana&gt;&gt;This is why I&#39;ve been so secretive, ?title... I believe I saw something... Something that you perhaps now have slowly come to accept yourself...&lt;&lt;/morgana&gt;&gt;

    &lt;&lt;player&gt;&gt;?Morgana... I...&lt;&lt;/player&gt;&gt;

    You stop yourself as you look into her deep purple eyes.

    &lt;&lt;morgana&gt;&gt;Perhaps it&#39;s time to accept this about yourself, ?title. Perhaps it&#39;s time to change things...&lt;&lt;/morgana&gt;&gt;

    A heap of emotions swirl around in your head. You can&#39;t simply forgive her for her acts but perhaps she&#39;s speaking truth to you now... She has always looked out for you and somehow you still feel safe around her. Her words dig deeper into you than you have ever dared to look yourself. You look at her with a concerned look, waiting with bated breath for the all-important question on her lips.

    &lt;&lt;morgana&gt;&gt;?player. Wouldn&#39;t you want to become a Princess instead?&lt;&lt;/morgana&gt;&gt;

    Never would you have though that such a short question would have such a deep effect on you. Your head is filled with emotions about this question, the question you have never dared ask yourself so directly before, and now that it&#39;s there, lying right before you, you find yourself staggered. Is she right, is this actually something you want??nl

    You take a deep breath before you give her your reply.

    &lt;span class=&quot;notice danger&quot;&gt;This is an important decision that can only be made once in the story!&lt;/span&gt;
    &lt;&lt;decision &#39;Yes...&#39; &#39;Morgana Confront About Assassin Princess&#39; femininity large&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Reject her idea. (work in progress)&#39; &#39;Thanks for playing&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    She takes a step closer and gives you a warm smile.
    &lt;&lt;morgana&gt;&gt;Ever since that day I first tried my magic on you in the library, I&#39;ve... felt something...&lt;&lt;/morgana&gt;&gt;
    She looks you up and down inquisitively.
    &lt;&lt;morgana&gt;&gt;I might be entirely wrong in this... You rejected my notion before, the disguise you chose looks good on you... But...&lt;&lt;/morgana&gt;&gt;
    She whispers now as she looks at you with mysterious intent. 

    &lt;&lt;morgana&gt;&gt;Wouldn&#39;t you want to experience something... different?&lt;&lt;/morgana&gt;&gt;

    &lt;&lt;player&gt;&gt;?Morgana- I-&lt;&lt;/player&gt;&gt;

    You stop yourself as you look into her deep purple eyes.

    &lt;&lt;morgana&gt;&gt;I could very well be wrong, this is your decision of course but I would be remiss if I didn&#39;t offer you this service and help you become whoever you want to be...&lt;&lt;/morgana&gt;&gt;

    She looks at you with a deep intensity. You know what question she wants to ask you and you wait for her to say it.

    &lt;&lt;morgana&gt;&gt;?player. Wouldn&#39;t you want to become a Princess instead?&lt;&lt;/morgana&gt;&gt;

    Your instinct tells you to immediately reply with a quick &#39;no&#39;. But for the first time, you actually take a moment to consider her proposition. What if she&#39;s right? Her transformative magic works so well on you, this big change never felt more realistic before, maybe that&#39;s why you never considered it? It&#39;s strange, thinking about this. You look away over the fields of flowers and actually give it a good thought now. After a little while, you look back to ?Morgana.?nl

    You take a deep breath before you give her your reply.

    &lt;span class=&quot;notice danger&quot;&gt;This is an important decision that can only be made once in the story!&lt;/span&gt;
    &lt;&lt;decision &#39;Yes...&#39; &#39;Morgana Confront About Assassin Princess&#39; femininity large&gt;&gt;&lt;&lt;/decision&gt;&gt;
    &lt;&lt;decision &#39;Reject her idea. (work in progress)&#39; &#39;Thanks for playing&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="676" name="Morgana Confront About Assassin Princess" tags="" position="725,8475" size="100,100">Like a dam, riddled with countless cracks, all emotion is swirling inside of you as you pull that single truth from the chaos. You feel tears welling up your eyes and your throat having difficulty finding purchase in the words that feel so heavy to let out. You persevere and look at her with frantic clarity.

&lt;&lt;player&gt;&gt;Yes- Yes- I- I think you&#39;re right, ?Morgana... I think that&#39;s actually what I want...&lt;&lt;/player&gt;&gt;

Tears streak down from your face as you look at ?Morgana. You feel stupid for being seen like this, being caught up in this emotion because of this confession. Instead of allowing you to quench these feelings and hide them away again like you&#39;re used to, ?Morgana pulls you in, giving you a deep hug.?nl

The dam finally breaks and you start bawling in the arms of ?Morgana, all emotion is let loose and you cannot even bother to worry about people seeing you here, crying in the arms of your royal sorceress, in the middle of gardens.?nl

?Morgana strokes your hair to support you, and she gives you all the space to cry your heart out right now. She hugs you so tightly as you are so overwhelmed with emotion.?nl

As you now realize this new truth, a hazy image appears in your mind. Your thoughts find serenity as all your mental capacity now shifts to focus on this image, this person that slowly becomes clearer to you now. You see yourself - your perception of yourself - and you now see that idea change. Instead of your princely outfit, you are wearing a beautiful dress. Immaculately royal, powerful through newfound femininity. A true Princess.?nl

&lt;&lt;morgana&gt;&gt;?player, I am so deeply proud of you and I believe with all my heart that you will make an amazing Princess...&lt;&lt;/morgana&gt;&gt;

Your sobbing slowly dissipates, her words reaching deep into your heart, you feel loved and accepted with her. You manage to let out a soft-spoken reply.

&lt;&lt;player&gt;&gt;Thank you, ?Morgana... I- I don&#39;t know what to do now...&lt;&lt;/player&gt;&gt;

She slowly lets you free of the hug and she looks at you with a smile.

&lt;&lt;morgana&gt;&gt;Don&#39;t worry, ?title. We&#39;ll work things through. Together.&lt;&lt;/morgana&gt;&gt;

You take a step backwards, as if you just remember what you came to see her about in the first place. It&#39;s difficult to only focus on this now, with everything that happened.

&lt;&lt;player&gt;&gt;I- I don&#39;t know if I can just forgive you, ?Morgana... I feel... I don&#39;t know...&lt;&lt;/player&gt;&gt;

&lt;&lt;morgana&gt;&gt;I understand, ?title. I hope in time you can. I just want the best for you and I feel like I can truly help you now.&lt;&lt;/morgana&gt;&gt;

You look at her with a certain desire, is she really willing to help you become a Princess?

&lt;&lt;morgana&gt;&gt;You have good reason to distrust me, ?title. But your answer to me today has changed things... I believe I can help guide you to a new future, something that you have always wanted.&lt;&lt;/morgana&gt;&gt;

She looks away for a moment again.

&lt;&lt;morgana&gt;&gt;But if you don&#39;t trust me now, I would completely understand. Just know that I never meant to betray you.&lt;&lt;/morgana&gt;&gt;

You feel her sincerity as you look at her, dried tears covering your cheeks. Though rationally you cannot explain her actions to yourself yet entirely, you feel like you need her right now. She&#39;s right, what you admitted today has changed things, you need someone to help you through this process. She looks towards you anxiously as you give her your reply.

&lt;&lt;player&gt;&gt;I...I&#39;m not sure that I can forgive you right now, ?Morgana. But there is something that I am sure of...&lt;&lt;/player&gt;&gt;

You take a deep breath before you continue.

&lt;&lt;player&gt;&gt;I- I need you, ?Morgana. I need you to help me become who I want to be.&lt;&lt;/player&gt;&gt;

She looks at you and gives you a serene nod.

&lt;&lt;morgana&gt;&gt;?Title, I would want to do nothing more. I am loyal only to you and I will help you in any way that I can.&lt;&lt;/morgana&gt;&gt;

She reaches out to hold your hand as she retrieves a purple handkerchief and starts to dry your tears.

&lt;&lt;morgana&gt;&gt;There. All better. Perhaps you could take some rest, ?title. We could see each other tomorrow, and talk about your future then, if you would like that.&lt;&lt;/morgana&gt;&gt;


&lt;&lt;player&gt;&gt;Yes... That sounds like a good idea.&lt;&lt;/player&gt;&gt;

You nod at her, agreeing that you definitely need to get some rest now.
You walk off only with a nod, still feeling conflicted about things. She&#39;s right though, you definitely need some rest. And with that, you definitely need to think some things over.?nl

Now, it&#39;s time for sleep.?nl

And tomorrow it&#39;s time to become a Princess.

&lt;&lt;decision &#39;Retire to bed&#39; &#39;Bedtime&#39;&gt;&gt;
    &lt;&lt;settime &#39;Night&#39;&gt;&gt;
    &lt;&lt;addevent dream &#39;Dream Event Think About Being Princess&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Event Talk Morgana Become Princess&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;/addevent&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="677" name="Morgana Confront About Assassin Prince" tags="" position="850,8475" size="100,100">You look at her with a stoic expression.

&lt;&lt;player&gt;&gt;I... I don&#39;t know what caused you to see this in me, ?Morgana, but you are wrong. I am the ?Prince, and nothing else.&lt;&lt;/player&gt;&gt;

?Morgana looks slightly surprised but then immediately gives you a bow.

&lt;&lt;morgana&gt;&gt;Of course, ?title. I meant nothing by it, ignore my remarks, I shall not mention it again.&lt;&lt;/morgana&gt;&gt;

You nod at her and she looks up at you again.

/* @TODO Todo no princess but stay prince instead - boringgg wtf do we put here?? - random idea: funfotunately is a cool word, remember it and use it*/</tw-passagedata><tw-passagedata pid="678" name="Dream Event Think About Being Princess" tags="" position="975,8475" size="100,100">You toss and tumble in your bed, not being able to sleep well at all. The conversation with ?Morgana still heavy on your mind.?nl

Hours later, you finally manage to fall asleep...?nl

Your dreams are vivid and bright, you see everything so clearly. You are sitting - regally - upon your throne. Your servants feel proud to serve you, your councillors impressed by your growth, and your subjects amazed at how you carry yourself. Only then do you realize the most important detail, you&#39;re not dreaming about yourself being a successful Prince. You look down to see the beautiful royal dress, filled with sparkling golden embellishments that are staggering to behold.?nl

You are dreaming of the powerful Princess you are meant to be. A warmth sets over you as you realize this and you are curious to see where the dream will take you...?nl

&lt;&lt;decision &#39;Continue sleeping&#39; &#39;Night&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="679" name="Wake Event Talk Morgana Become Princess" tags="" position="1100,8475" size="100,100">&lt;&lt;set $chapter = 4&gt;&gt;
&lt;&lt;set $chaptertitle= &#39;Chapter Four&#39;&gt;&gt;
&lt;&lt;set $chaptertarget = &#39;Morning&#39;&gt;&gt;
&lt;&lt;set $chaptertimeskip = false&gt;&gt;
You wake up, feeling quite strange. You haven&#39;t slept much because your conversation with ?Morgana from yesterday occupies your mind too mind, but your dreams have made you feel activated and energized enough.?nl

Even though this entire plan feels new to you, it excited you greatly. Perhaps it&#39;s time to find ?Morgana and talk about how you could become a Princess...

&lt;&lt;decision &#39;Continue&#39; &#39;Chapter&#39;&gt;&gt;
    &lt;&lt;addtag &#39;princess&#39;&gt;&gt;
    &lt;&lt;startquest &#39;morgana-discuss-princess&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="680" name="Morgana Discuss Become Princess" tags="" position="1225,8475" size="100,100">&lt;&lt;if $location is not &#39;Workshop&#39;&gt;&gt;
    You find ?Morgana and as you walk up to her she gives you a smile. She knows why you&#39;re here and before you can even say anything she looks over in another direction and start walking away from you, clearly intending for you to follow.?nl
    You feel much safer discussing this subject in privacy and you&#39;re happy she&#39;s taken the initiative in facilitating that.
    &lt;&lt;decision &#39;Follow her to her workshop&#39; &#39;Morgana Discuss Become Princess&#39;&gt;&gt;&lt;&lt;setlocation &#39;Workshop&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;else&gt;&gt;
    You close the door to her workshop after you enter and look at her. You both are eminently aware of the strange feeling that hangs in the air.
    &lt;&lt;morgana&gt;&gt;So... How are you feeling, ?title?&lt;&lt;/morgana&gt;&gt;
    You give her a slight smile as you sit down next to her.
    &lt;&lt;player&gt;&gt;Pretty strange, I&#39;ll admit... I think I&#39;m- uh- cautiously excited for this idea...&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;That&#39;s good, I admit I&#39;m also excited, ?title. In fact, I&#39;m already working on a plan.&lt;&lt;/morgana&gt;&gt;
    You look at her with a concerning look. You&#39;re already intimidated by how fast things are going but then again, you&#39;re not really used to anything else from ?Morgana.
    &lt;&lt;player&gt;&gt;Ah- uhm- what are you thinking?&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Well, in order to make you a Princess, we&#39;d need to announce it to the council...&lt;&lt;/morgana&gt;&gt;
    Your cheeks immediately burn red, that sounds absolutely terrifying and there&#39;s no way you&#39;d do that right now. ?Morgana spots your discomfort and immediately tries to calm you down.
    &lt;&lt;morgana&gt;&gt;I know, I know, that&#39;s way too fast right now! Don&#39;t worry, we won&#39;t be doing that before we are prepared for it.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;Yeah... I don&#39;t think that sounds doable at all...&lt;&lt;/player&gt;&gt;
    She gives you a smile as she continues with her idea.
    &lt;&lt;morgana&gt;&gt;Not right now, no. You see, you&#39;re currently still missing the experience necessary to be a Princess. That&#39;s why I&#39;ve come up with an idea. We&#39;re going to give you special trainings to prepare you for this transition!&lt;&lt;/morgana&gt;&gt;
    You give her a confused look.
    &lt;&lt;player&gt;&gt;Uhm, ?Morgana, who do you mean by &quot;we&quot;?&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Well, I&#39;m still working on that part. I think it&#39;s best to loop in some expertise for this. With your permission, ?title, I&#39;d like to ask some people to help train you to become a Princess.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;morgana&gt;&gt;Specifically, ?Hyssop would be perfect to teach you everything you need to know about fashion and make-up, ?Kathryn is very well suited to train you in etiquette, and ?Sybille is probably the best person to train you in comport and how you carry yourself.&lt;&lt;/morgana&gt;&gt;
    You once again feel a sense of awkwardness but somehow, this idea of having Princess trainings sounds really fun to you as well...
    &lt;&lt;player&gt;&gt;So uhm- You&#39;ll tell them about the plan then?&lt;&lt;/player&gt;&gt;
    &lt;&lt;morgana&gt;&gt;With your permission, yes, that would be necessary. I will make sure that they keep this whole plan a secret though. I believe we can count on their discretion.&lt;&lt;/morgana&gt;&gt;
    She pauses for a moment as she looks out the window.
    &lt;&lt;morgana&gt;&gt;I realize that the conversation with ?Sybille will be a difficult one... She&#39;s likely aware of our confrontation and I&#39;m not sure she will forgive me...&lt;&lt;/morgana&gt;&gt;
    You reluctantly tell her something you&#39;re not even sure about yet.
    &lt;&lt;player&gt;&gt;Tell her that I need you to help me with this plan... I suppose I need both of you working together. If you tell her that she&#39;ll likely help us for now.&lt;&lt;/player&gt;&gt;
    She looks back at you and stands up from her chair.
    &lt;&lt;morgana&gt;&gt;Good, so you agree to this then? After you&#39;ve had enough lessons we will discuss how we present this to the council.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;player&gt;&gt;Yes... I- I think this could work...&lt;&lt;/player&gt;&gt;
    You stand up as well and ?Morgana moves closer to give you a hug.
    &lt;&lt;morgana&gt;&gt;That is exciting, I&#39;m proud of you, ?title. Give me a few days to smooth things over with ?Sybille and get the others informed. I will be in  touch.&lt;&lt;/morgana&gt;&gt;
    You give her a nod and move to leave her Workshop.
    &lt;&lt;player&gt;&gt;A- Alright. Thank you, ?Morgana.&lt;&lt;/player&gt;&gt;

    &lt;&lt;decision &#39;Leave her workshop&#39; &#39;Hallway&#39;&gt;&gt;
        &lt;&lt;completequest &#39;morgana-discuss-princess&#39;&gt;&gt;
        &lt;&lt;addevent wake &#39;Wake Event Morgana Princess Lessons Intro&#39;&gt;&gt;&lt;&lt;priority first&gt;&gt;&lt;&lt;delay 4&gt;&gt;&lt;&lt;/addevent&gt;&gt;
        &lt;&lt;startquest &#39;princess-lessons-intro&#39;&gt;&gt;
    &lt;&lt;/decision&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="681" name="Wake Event Morgana Princess Lessons Intro" tags="" position="100,8600" size="100,100">You wake up with a knock on the door. You groggily open it to find ?Morgana there. You welcome her into your room immediately.

&lt;&lt;player&gt;&gt;So... You&#39;re here to discuss the- uhm- Princess lessons?&lt;&lt;/player&gt;&gt;
She raises her eyebrows amusedly.
&lt;&lt;morgana&gt;&gt;Haha, I suppose it&#39;s something to get used to... But yes, I bring good news.&lt;&lt;/morgana&gt;&gt;
You look at her expectantly.
&lt;&lt;morgana&gt;&gt;?Sybille, ?Hyssop, and ?Kathryn have all agreed to help train you. They have all sworn to keep this a secret for as long as you prefer.&lt;&lt;/morgana&gt;&gt;
You give ?Morgana a tight hug.
&lt;&lt;player&gt;&gt;So it&#39;s really happening... I&#39;m very grateful ?Morgana.&lt;&lt;/player&gt;&gt;
&lt;&lt;morgana&gt;&gt;I&#39;m glad, ?title. Please visit each of them to get started with your training. Come find me once you&#39;ve visited them all.&lt;&lt;/morgana&gt;&gt;
You nod at her as she turns around to leave you.
&lt;&lt;morgana&gt;&gt;I&#39;ll leave you alone for now. Good luck, ?title.&lt;&lt;/morgana&gt;&gt;

&lt;&lt;player&gt;&gt;Thank you, ?Morgana.&lt;&lt;/player&gt;&gt;

&lt;&lt;decision &#39;Continue&#39; &#39;Morning&#39;&gt;&gt;
    &lt;&lt;advancequest &#39;princess-lessons-intro&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="682" name="Morgana Finish Princess Training Intro" tags="" position="225,8600" size="100,100">&lt;&lt;completequest &#39;princess-lessons-intro&#39;&gt;&gt;
You walk up to ?Morgana and find her reading some book about magic. She closes it when you approach to give you all of her attention.

&lt;&lt;morgana&gt;&gt;Hello, ?title. It&#39;s good to see you. How are you lessons going?&lt;&lt;/morgana&gt;&gt;
You sit down next to her and lower your voice to ensure nobody is listening in.
&lt;&lt;player&gt;&gt;That&#39;s actually why I&#39;m here. It&#39;s uhm- going well- I think. It&#39;s actually very fun, I&#39;ve already learned a lot.&lt;&lt;/player&gt;&gt;
?Morgana smiles at you as she notices your passion for this.
&lt;&lt;morgana&gt;&gt;Yes, I&#39;ve received positive message from your trainers as well. I&#39;m glad to see it is going well.&lt;&lt;/morgana&gt;&gt;
She nods at you as she takes in your excitement.
&lt;&lt;morgana&gt;&gt;It looks like the plan worked, the other councillors are none the wiser. Be sure to keep attending your regular lessons as well. We wouldn&#39;t want ?Andreas get suspicious.&lt;&lt;/morgana&gt;&gt;
&lt;&lt;player&gt;&gt;Yes. Though, it&#39;s going to be quite intense doing both at the same time.&lt;&lt;/player&gt;&gt;
She gently puts a hand on your shoulder.
&lt;&lt;morgana&gt;&gt;I understand. This should become more manageable once we&#39;ve announced the change to the council. I believe you need some more time with your training before you are ready for that though.&lt;&lt;/morgana&gt;&gt;
You nod at her, the idea of coming out to the council still intimidates you greatly.
&lt;&lt;player&gt;&gt;Y- yes. I don&#39;t know when I&#39;ll be ready for that...&lt;&lt;/player&gt;&gt;

She gives you a comforting smile.

&lt;&lt;morgana&gt;&gt;That&#39;s entirely up to you, ?title. I believe you are more ready than you think, but I want you to come to me when &lt;em&gt;you&lt;/em&gt; believe that you&#39;re ready for it. I will be there to support you then.&lt;&lt;/morgana&gt;&gt;

You lean in to give ?Morgana a hug.

&lt;&lt;player&gt;&gt;Thank you, ?Morgana... I will focus on my training for now.&lt;&lt;/player&gt;&gt;

She lets you go and you turn around to leave again.

&lt;&lt;decision &#39;Leave&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;startquest &#39;princess-lessons&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;



/* 
Chapter ending: wake up, thinking about princess stuff, go find Morgana, she was about to knock and you discuss next steps, announce to the council during next meeting? Morgana told Sybille, she got the documents 

Maybe go to Dungeons, find sybille instead but Morgana is also there??

Maybe talk with Sybille first, then next chapter at next wednesday?? -- too long
*/</tw-passagedata><tw-passagedata pid="683" name="Wake Event Become Princess" tags="event" position="350,8600" size="100,100">You wake up barely having slept at all. Today is the day. Today is the day that you will go to the council and announce your new purpose, to become a Princess.?nl

Even though ?Morgana is there to support you and she will likely do most of the talking, it still feels damn frightening to make this step.?nl

A necessary step though... Ever since ?Morgana had presented you with this idea</tw-passagedata><tw-passagedata pid="684" name="Changelog" tags="br" position="475,8600" size="100,100">&lt;&lt;dialog &#39;Changelog&#39; &#39;changelog-menu&#39;&gt;&gt; \
!!v0.3.3
* Added a first intimate scene with ?Beau!
** After getting introduced to her shop, you can find a &quot;help wanted&quot; sign at the smithy.
* Added new intimate scenes with ?Caspar.
** He&#39;s keen to serve you, and he will let you know you are free to use him.
** You can now find the loyal squire alone in the courtyard at night on a regular schedule: on Tuesday, Saturday and Sunday ?Wymerus is unavailable which gives you opportunity to accompany ?Caspar instead.
* Dominic has been changed to ?Devota. 
** This change has multiple reasons but it&#39;s mostly because I wanted to make it clear this is a fantasy world with an entirely different kind of church. Turning the priest into a trans woman should steer the story away from any negative real life connotations of religion.
** With this change, we are also reworking the entire confession system. Instead of sharing your &#39;sins&#39; and having to feel bad for that, the idea of the confessional is now to simply share experiences and reflect on them together with ?Devota, who is simply there to be supportive.
** Currently, the confession rework is not yet done but a few scenes are already implemented.
* Added two new princess lessons with ?Kathryn: dancing and flirting.
* Added a counter to help clarify when the player has worked enough evenings at the tavern to continue with the story.

!!v0.3.2
* Introducing a dramatic ending to chapter 3 after a emotional confrontation with ?Morgana and the start of a brand new chapter.
** Currently the new chapter is only available if you choose a long-awaited monumental decision-the decision to finally become a princess instead.
** This means that the prince is introduced to all new princess lessons, where you will be helped by ?Sybille, ?Hyssop, and ?Kathryn, who will train you on comport, fashion, and etiquette.
** These princess lessons will remain secret to the rest of the council until it is decided to come out during a council meeting, which will be where the story continues in the next update.
* A fascinating new artifact to unlock: the Tome of Memories allows you to jump back in time and relive any major non-repeatable events that the prince has experienced.
** Unlock the new artifact through the Royal Reliquary after bringing up your Princely stats.
* Fixed the Magic Circle artifact to actually work properly and added some new quality of life improvements to it.
* Added a new spicy scene with ?Caspar.
** After spying on him at night together with ?Wymerus, you might find him alone the next night and can offer to &#39;train&#39; together with him instead.
* Added an icon to signify when going for a romance option in the story.
* You can now buy a different chastity cage to swap to at ?Beau&#39;s smithy. You will need to be wearing a chastity cage in order to do this.
* If you have chosen to not drink ?Morgana&#39;s potion in the first chapter, you can now still buy this potion later at any point from her store.
* Early ?Morgana scenes from when she visits you in your bedroom have been rewritten slightly so that you can also choose to decline ?Morgana&#39;s advances instead.
* Fixed the character portraits on the map sometimes loading incorrectly.

!!v0.3.1
* Added a brief continuation of the main story. The player can now go to ?Velma and start the plan to spy on ?Andreas. The story will continue in a next update soon!
* Added a first date with ?Eve. Go to the blacksmith and buy her a gift to get the date started.
* Added a new event chain where you go into town together with ?Kathryn, focused on humiliation and chastity cage content.
** ?Kathryn will invite you on this excursion a few days after you complete the week long chastity quest.
* Added new options for chastity cages that you get to pick from when ?Kathryn first introduces you to it, and again during your excursion into town with her.
* Added much more support for chastity cages in other parts of the game.
** ?Morgana now accounts for it when you go to her potion store to extract essence.
** ?Orson now comments on it when you take a bath.
** Please let me know if you find any other parts in the game where this doesn&#39;t work as expected. ?Rosa&#39;s spicy scenes will be fixed in a next update. 
* Added more sph content in different parts of the game.
** After finishing the town excursion with ?Kathryn, there&#39;s a new spicy scene that has a chance to trigger when you peek on her again at night when in chastity.
** When choosing to be the top when ?Eve gives you sex education it turns into a little mishap. 
** When having intimacy together with ?Rosa there&#39;s now a short conversation about your size.
* Added a small scene where you can attempt to simply ask ?Leopold for gold to buy things after you unlock the blacksmith shop.
* Disabled the April Fools&#39; content (bread fetish stuff) by default. The content can still be accessed by turning it on in the settings menu.
* Info boxes that used to be only accessible through hover effects can now also be viewed on mobile by tapping on the relevant element. For instance, if you tap on a character&#39;s name when playing the mobile version you will now get a pop-up window with the character&#39;s description.
* Made the minigames easier and the skip minigames option has been moved from the supporter-exclusive Cheat menu to the general settings menu, this is also for accessibility reasons, the game should now be entire playable with a screen-reader.
** The coin sorting minigame now spawns 3-5 coins instead of 4-8.
** The painting minigame now requires the use of only 3 different colors and a third of the canvas painted in for the best result. Previously this was 10 colors and 70% of the canvas filled in.

!!v0.3.0
* A completely new paper doll body used for showing a bunch of different magical transformations!
** Whenever you drink one of ?Morgana&#39;s transformation potions, there&#39;s now a short animation of the transformation using a close-up window of the body.
** Some references to the prince&#39;s body parts now have a new hover effect where you see a close-up of what it looks like.
** The Magic Mirror artifact now has an animation of the entire body transformation.
* Added an entirely new tavern map!
** The tavern is separate from the town map but can be seamlessly moved in between.
** Added several new locations in the tavern like the Cookroom, the brothel corridor, and ?Velma&#39;s office.
** Improved the clickable area alignment for the town and castle maps.
* Added a romantic third date with ?Rosa where you invite her to a fancy meal at the dining hall.
** The date can be unlocked after finishing her previous dates and then buying her the pendant gift from ?Beau, the blacksmith.
* Large rewrite and restructuring of ?Kathryn&#39;s content
** Added an option to always ask to be unlocked from chastity, though it can be a very humiliating experience for the prince depending on when you ask her.
** Removed story parts where ?Kathryn would get emotionally hurt by the prince. ?Kathryn now instead reveals that she actually likes the prince peeking on her when she&#39;s being intimate in public, especially when she has such control over him.
** Once you read a book about dinner etiquette from the library, you can be invited to join ?Kathryn&#39;s dinner party.
* Rewrote a bunch of ?Morgana&#39;s content
** The potion transformations no longer happen instantly but only trigger the morning after. It also uses the new body art for a small animation when this happens.
** Changed the ointment quest at the start of the game so you can choose whether the ointment feminizes or masculinizes. This option can always be changed later by going to her potion store.
** When asked to drink ?Morgana&#39;s potion at the end of chapter 1, there&#39;s now also an option to simply decline. This will make her see that she was coming on too forcefully and she will apologise for this. A way to still drink the potion afterwards will be implemented later.
* Added a new character: ?ChefPepper, a muscular chef with salt and pepper hair that works at the tavern.
** He&#39;s such a great chef that ?Kathryn always hires him to cook for her dinner parties.
** He&#39;s introduced on the first day of working at the tavern. He actually recognises the prince even though he&#39;s disguised but promises not to tell a soul.
** To display his culinary genius, the game now contains a random dish name generator that is absolutely always perfect and everything that it displays is perfectly delicious, yep.
* Added a new scene when entertaining clients at the brothel. The famous bard ?Merry wants to hire you for some alone time.
* Improved the skip ahead system
** Depending on which chapter you choose, decisions made during the main story will be asked in a series of questions.
** You can now skip ahead to chapter three, which should help now that old save versions are incompatible with this version.
* Added a small introduction to the next part of the main story, where you have to spy on ?Andreas at the tavern. The continuation of this will be coming soon.
* Added a notification whenever you are disguised or undisguised.
* The prince&#39;s virtue/depravity meter now starts at entirely virtuous seeing as it makes more sense that the prince starts off innocently.
* Issues resolved:
** Fixed an error that showed up when using a high resolution screen. Whenever the map size is wrong, it can be fixed by manually reloading or moving to another area. Hopefully this works well now but please let me know if there are more issues regarding this.
** Fixed an error where you would always regain the quest to talk to ?Velma after working at the tavern.
** Fixed an issue where a button&#39;s text would sometimes go through the button icon.
** Player text is now changed to black, allowing for better readability.
* New coding systems created to help create content faster:
** A body status system that keeps track of your transformations.
** A new events system that is used to easily queue up specific scenes. Currently mostly used for events that happen in the morning but will be expanded on in the future.
** A new character title system which can be used to easily retrieve or change a character&#39;s official title.
** Refactored the quest system, which now allows for sub-goals.

!!v0.2.9
* Added the first three scenes for entertaining different clients at the brothel. 
** A posh noblewoman, looking to spend time with a commoner.
** A burly lumberjack, looking to be dommed.
** A rugged bandit, who wants to (politely) use you.
* Added new transformation potions at ?Morgana&#39;s workshop that change the size of your ass.
* Added a new town map! (Now with horseys!)
* Added a kinky new scene with ?Sybille when going to her at night. &lt;i&gt;Note: Due to a change in scene mechanics, you might need to go through the old ?Sybille scenes to get to the new one.&lt;/i&gt;
* Added icons for going to different area&#39;s and made it much simpler to leave the castle from the Gatehouse. (No more endless clicking).
* Character names inside buttons are now colored and have hovers as well.
* Fixed chastity cage mechanics in some scenes.

!!v0.2.8
* Added an entire introduction to the brothel. Once you have completed the additional training with ?Eve you can choose to tell ?Velma that you want to work in the brothel. You will then be shown around by ?Eve and she will tell you exactly how everything works.
* Option to receive your very own room in the tavern, whether you decide to work at the brothel or not. This room will serve as a little hub in town that the prince can choose to sleep in the future.
* You will be able to visit the store of the blacksmith, ?Beau, after you have unlocked your boarding room in the tavern. ?Beau secretly sells sex toys and romantic gifts. You will need to buy a gift to unlock the next date with your romantic interest. Currently, you can buy the following things at her shop:
** An eloquent metal quill as a gift for ?Orson.
** The lowest tier magical dildo, a copper dildo, which can be used in your room in the tavern.
* The exciting second date with ?Orson takes place in the tavern, where you watch the performance of a famous bard together. Your familiarity with the tavern will allow you to go backstage and introduce ?Orson to his idol.
* You can now use hotkeys to go through the story. Pressing the 1-9 keys will control which decision you go for, with the top-most button being number 1.
* Gave ?Beau a new pixel art portrait, one that actually looks like pixel art.

!!v0.2.7
* A continuation of the tavern story: Once you go to ?Velma to talk about your progress she will send you to ?Eve for additional training.
* A new random scene in the tavern while crossdressing: Some rough guys will try to hit on you while you&#39;re working. You can choose to scold them, have ?Eve save you, or even go along with it...
* If the prince gets caught doing something illegal in town they will now be punished accordingly. He will have to option to either serve out the sentence in the castle dungeons or instead ask to be put in the town square pillory. This can currently happen in two ways:
** Trying to steal from the church donation box.
** A new tavern working event where the prince is pushed to do something slightly illegal.
* Added a new potion store. Once you have completed the tavern introduction, ?Morgana will come visit you in the morning to tell you she has made great strides experimenting with potions. ?Morgana simply requires the prince&#39;s essence to make the potions, which is now turned into a new kind of currency. There are currently four kinds of a potions you can purchase: &quot;Tittynflate&quot;, &quot;Bosomsbane&quot;, &quot;Mighty Oak&quot; and &quot;Bulge Begone&quot;. More content for them and different kinds of potions will be available later.
* Overhauled the wardrobe system. You are now able to change outfits that are automatically worn at different moments. It&#39;s no longer necessary to manually change your outfit every time. Currently there are 4 different outfits:
** Standard outfit
** Church outfit
** Disguise outfit
** Sleep outfit
* Added a new icon to indicate how to exit the castle on the map when that part of the story becomes available.
* The local blacksmith has been changed from Berg to ?Beau. She will soon have more content in town when you visit her alone or together with ?Kathryn. 
* ?Quinn has received a promotion! She&#39;s now referred to as the captain instead of the sergeant.

!!v0.2.6
* New date with ?Orson. After figuring out he wrote the poems you can find him in the library during the evening and take him on a nice date for some fun in the Meadow.
* Several new interactions with ?Kathryn regarding your chastity cage.
** You will have to show your dedication to her before she will let you out of the cage, if you continue to peek on her after promising not to she will actually be disappointed in you now.
** Several changes to existing passages to include references to your chastity cage when you wear one.
** Fixed a bug where ?Kathryn commends you for wearing panties even though you are not.
* Changed the Waterfall meeting with Eve if you have already met her at the tavern.
* Added a button to add Gold in the cheat menu.

!!v0.2.5
* New morning events where you find poetry from a secret admirer and go on a small quest to find out who it is.
* Added a new scene when exploring the alley in town at night. A mugger will try to take your money but you can also choose to pay another way…
* Added a small extra tavern working scene when you are crossdressing.
* Added an in-game changelog that will automatically open when you load an older save.
* Fixed several typo&#39;s and ?Devota&#39;s popup color in some scenes.

!!v0.2.4b
* Fixed a bug when continuing your play through from an old save where you would not correctly be classified as a crossdresser and would be disguised in the waiter outfit instead of the kitchen maid disguise.
* Fixed a bug where your femininity stat would not return to the right value after crossdressing.
* Fixed several typos in different passages.

!!v0.2.4a
* Fixed an error where the next passage couldn&#39;t be found when going to tavern right after starting chapter 3.
* Fixed some writing issues in tavern passages.

!!v0.2.4
* New area: &#39;&#39;the Town!&#39;&#39;
&gt;The town is opened up after starting a new questline with ?Sybille and starting chapter 3. She will contact you a week&#39;s time after you complete the forest expedition together with ?Morgana. This new town area has a bunch of different locations that can be explored, with the main one being the local tavern.
** After completing the tavern intro quest, you can go there during the evening to start a working shift. This will prompt one of (currently) six events to happen while working. Two of which are very explicit. (I won&#39;t spoil any more than that)
** Wander around the alley to find drunken people, people in the middle of an intimate moment, and best of all, a stray kitten that you can pet, feed and eventually adopt to become an official castle cat!
** Head to the church to have some minor interactions wandering the place and see a silly reference to the very first book added to the game.
* Wearing feminine clothes now temporarily increases your femininity stat for as long as you wear them.
* Changed theme and character colors to make everything a lot more readable. Please let me know if some color combinations are still bad for you.
* New romance content for ?Rosa.
** A new gathering quest where you have to gather different flowers for her around the map.
** Once you have brought her the flowers and you have unlocked the town area, you can ask her out on a new date where you will spend a night at the tavern together.
** After completing the date, you can head to the kitchen to slip away together with ?Rosa for some fun in the larder.
* A new castle map! This new map is custom made to show you a glimpse of the different rooms in the castle. I also made a night-time version of the map, complete with lit braziers and candles to make it all the more sneaky when the prince goes on his nightly escapades.
** The map now also has a fancy hover popup that tells you the name of the area and also a list of whoever&#39;s currently at that location.
* Once the magic chalk is unlocked and placed, there is now a clickable area part of the bedroom that can be used to instantly teleport using the magical chalk.
* The Sergeant that hangs out at the barracks now officially has a name: ?Quinn!
* New scenes to peek around the barracks at night. Find soldiers doing naughty things together, sometimes even with ?Quinn.
* New Orb of Scrying scenes for peeking on ?Sybille and on ?Quinn.

!!v0.2.3
* A new castle map! This new map is custom made to show you a glimpse of the different rooms in the castle. I also made a night-time version of the map, complete with lit braziers and candles to make it all the more sneaky when the prince goes on his nightly escapades.
* Once the magic chalk is unlocked and places, there is now a clickable area part of the bedroom that can be used to instantly teleport using the magical chalk.
* ?Rosa had a new quest where you have to gather different flowers for her around the map. Once you bring all the flowers you will be able to take her on a second date that will be available in the next update.
* The Sergeant that hangs out at the barracks now officially has a name: Sergeant ?Quinn!
* New scenes to peek around the barracks at night. Find soldiers doing naughty things together, sometimes even with Sergeant ?Quinn.
* New Orb of Scrying scenes for peeking on ?Sybille and on Sergeant ?Quinn.

!!v0.2.2
* New artifact: &#39;&#39;The Orb of Scrying&#39;&#39;
** This glass ball lets you observe any person you want, the catch is that the magic only works if you&#39;re watching people who are currently aroused. This brings the prince&#39;s peeking game to a whole new level…
** Currently, the orb allows you to peek on the following characters:
*** ?Kathryn, where you finally get to see what happens if you don&#39;t get caught while peeking on her together with a nobleman.
*** ?Leopold, only after you have peeked on him in his office three times.
*** ?Caspar and ?Wymerus while they&#39;re busy in the courtyard. (Basically the same scene)
* ?Morgana&#39;s forest quest can now also be completed without crossdressing. With this option you will instead disguise yourself as a manservant to sneak out of the castle together. Currently, the decision here defines whether or not you are a crossdresser at all throughout the game.
* You can no longer leave the castle if you have enough dominance, to get past the guards you will always need to wear a disguise which can be either the kitchen maid or the manservant outfits, depending on what you chose during ?Morgana&#39;s quest.
* Added two new scenes when relaxing by the waterfall, one of which introduces you to a new character: ?Eve. She will have a bigger role in the upcoming updates where we introduce the town area, as she works at the local tavern.
* Added a new quest with ?Rosa. After you&#39;ve finished the quest where you go to the forest with ?Morgana, ?Rosa will come to your room to bring you breakfast in the morning, starting the new quest where you can ask her out on a date.
* Added a third peeking scene with ?Sybille in the dungeon where she includes the prince in her devious torturing.
* Added a new content setting: cum fetish. Most passages related to cum-play or cum swallowing will now no longer appear if you have this turned off.
* Most masturbation options are now disabled while you are wearing a chastity cage.
* Changed the pixel art portrait theme to be the default selected theme.

!!v0.2.1
* New artifact: &#39;&#39;The Orb of Scrying&#39;&#39;
** This glass ball lets you observe any person you want, the catch is that the magic only works if you&#39;re watching people who are currently aroused. This brings the prince&#39;s peeking game to a whole new level…
** Currently, the orb allows you to peek on the following characters:
*** ?Kathryn, where you finally get to see what happens if you don&#39;t get caught while peeking on her together with a nobleman.
*** ?Leopold, only after you have peeked on him in his office three times.
*** ?Caspar and ?Wymerus while they&#39;re busy in the courtyard. (Basically the same scene)
* Added a new quest with ?Rosa. After you&#39;ve finished the quest where you go to the forest with ?Morgana, ?Rosa will come to your room to bring you breakfast in the morning, starting the new quest where you can ask her out on a date.
* Added a third peeking scene with ?Sybille in the dungeon where she includes the prince in her devious torturing.
* Added a new content setting: cum fetish. Most passages related to cum-play or cum swallowing will now no longer appear if you have this turned off.
* Most masturbation options are now disabled while you are wearing a chastity cage.
* Changed the pixel art portrait theme to be the default selected theme.

!!v0.2.0
* New area: &#39;&#39;the Forest&#39;&#39;!
** The area opens up to be explored after ?Morgana has taken you there for the first time. Simply go to your wardrobe, don a good disguise and make your way out of the castle. (For the non crossdressing route, the forest can be reached after reaching halfway through dominance and ordering the guards to let you out of the castle. Do not there is currently less content than with the other route).
** ?Hyssop can be found in their little Druid Hut. They&#39;re a very experienced tailor and will gladly offer their expertise to the prince in exchange for mushrooms that can be found in the forest.
** Find a strange mushroom next to the Waterfall in the forest and see where the experience will take you.
** The scene with the bandit in the woods is rewritten to no longer feel like straight up rape. Instead the prince will now have to choose themselves to head down to the bandit camp after the initial interaction.
* Clothing! With this new custom-made basic paper doll system, you can now go to your Bedroom and open your Wardrobe to change your outfit. Currently it&#39;s a mix of AI generated images and real life pictures, this is likely temporary before I find a fitting style.
** You start with a selection of 3 outfits and can buy more once you unlock the Forest and can go to ?Hyssop.
** After unlocking feminine outfits, selecting these in the wardrobe will allow you to sneak out of the castle and go to the forest.
** Wearing panties can now be toggled in your wardrobe.
** When ?Kathryn forces you to wear a chastity cage, it will now show up in your under clothes section.
* New scenes where you can spy on ?Sybille at nighttime in her dungeons to get a glimpse of how she does her work.
* Rewritten a large part of your trip to the forest together with ?Morgana, she will now want to introduce you to ?Hyssop, the Forest druid.
* Added an option to skip straight to Chapter 2 at the start.
* Changed the prince&#39;s portrait in the Fantasy theme to no longer look slightly child-like.
* Added a debug mode for testing purposes. (Warning: Using this can potentially ruin your unsaved progress).

!!v0.1.3
* Artifacts! These are the weekly rewards that the council will give you for keeping up with your tutoring. Every week they will allow you to pick out one reward from the Royal Reliquary. Currently there are three rewards implemented:
** Circle Chalk: Magical chalk that can be used to draw teleportation circles, allowing you to teleport between the location where you draw it and your bedroom.
** Zephyr, the Wind&#39;s Edge: A mythical sword that allows you to win any dangerous encounter that normally requires your swordfighting level in a very cool fashion. To be able to use the sword you must first learn how to use it by reading about it in a book and bringing it to ?Wymerus.
** The Magic Mirror: This mirror can be used to scan your body to show any changes to your body due to the transformations. If you have become more feminine than you started, the mirror will show that and list what exactly has changed about your body.
* New scenes with ?Morgana as you head into the dangerous forest. Going off on your own is a dangerous idea…
* New scenes with ?Kathryn where she blackmails you into wearing a chastity cage if you keep peeking on her. Currently the chastity cage does not stop you from masturbating in several scenes yet.
* You can now visit the barracks during the day in order to train together with the troops and meet the new sergeant.
* ?Andreas now mentions the book you read in the library and is proud of you once you complete it.
* Added a small scene where you can join ?Kathryn&#39;s dinner party.
* Added autosaves that are made at the start of every day.
* Sidebars that are manually stowed will now stay that way.

!!v0.1.2
* A new recurring scene with ?Morgana where she asks you for your essence once more to create more potions in her workshop.
* Several scenes with ?Morgana that will lead up to you leaving the castle together on a certain quest. The current content reaches right before you are ready to leave the castle.
* Several scenes with ?Kathryn, where she will punish you if you keep spying on her in the garden at night. Make sure to speak to her at the dining hall so you learn what noble it is for her to actually hook up with him during nighttime.
* Several books have been added to the library. Come back each day to take a look at the different things the old tomes have to offer.
* Major refactors to the save system, this also means your old saves are unfortunately not compatible with the new version. You will have to restart the game when playing.
* You are no longer able to define the kingdom name at the start. Though I very much enjoy player agency, it makes writing about the kingdom much easier when the name is defined beforehand.
* Added an option to hide stat gain icons on the decision buttons. This makes it so you&#39;ll have to guess yourself how a decision affects your stats.
* After reaching the week&#39;s required level of your Princely stats, you will no longer be able to train them anymore.
//Note: As people have mentioned to me before. They felt it was necessary to spend almost all time raising their Princely stats but mindlessly raising some stats was never the intention of the game. Hopefully by locking the level until the council meeting has taken place will make people feel like they can also spend some time doing fun things that don&#39;t really give you any rewards as well.//
* Fixed a bug regarding an Object.hasOwn error message.

!!v0.1.1
* Added a short new scene when giving ?Morgana the potion instead of drinking it. This is so both paths now end at the same point. The scene gives some sense of where I&#39;m thinking of bringing the dominant main questline, using magical potions to influence (and eventually transform) other characters.
* Reworked the confession system. After confessing all your sins, you can now choose to accept ?Devota&#39;s absolution or reject it, turning it either into virtue or depravity points. If you lie to him at the start by saying you have no sins you will now instead gain some depravity points instead of virtue.
* Reworked the coins minigame slightly. It is now much quicker as there are about a third less coins spawned and the coins itself bounce a bit more, giving a bit of a ‘billiards&#39; effect.
&gt;//Note: The intention of this minigame is that it&#39;s very quick and fun to play around with. It should not simply feel like a chore. I hope these changes will help achieve that goal, in the future I&#39;m planning to add some sound effects, that should also help.//
* Added mobile support for both minigames.
&gt;//Note: When initially releasing the game I didn&#39;t test anything on mobile and intended to release without mobile support. However, I have since gotten the feedback that pretty much most of the game works on mobile except for the minigames. This was quite unexpected and after testing it a bit myself, there are definitely some styling changes I will need to implement to make it better but for now I have added working touch controls on the minigames so that the game is at least playable on your phone.//
* Added an option to skip minigames in the cheats menu.
* Fixed the invalid passages when training with ?Wymerus after some time.
* Fixed the missing passages when confessing to ?Devota.
* Fixed ?Morgana&#39;s spell effect sometimes sticking around even when not charmed.
&lt;/p&gt;
&lt;&lt;/dialog&gt;&gt;</tw-passagedata><tw-passagedata pid="685" name="Body Test" tags="no-title, no-location" position="600,8600" size="100,100">?penis ?nl
?chest ?nl

&lt;&lt;showbody mirror location&gt;&gt;
&lt;&lt;/showbody&gt;&gt;
&lt;&lt;showbody chest outline location&gt;&gt;
&lt;&lt;/showbody&gt;&gt;
&lt;&lt;showbody chest outline location small&gt;&gt;
&lt;&lt;/showbody&gt;&gt;
&lt;&lt;showbody hair outline location&gt;&gt;
&lt;&lt;/showbody&gt;&gt;
&lt;&lt;showbody hair outline location small&gt;&gt;
&lt;&lt;/showbody&gt;&gt;
&lt;&lt;showbody penis outline location ignore-chastity&gt;&gt;
&lt;&lt;/showbody&gt;&gt;
&lt;&lt;showbody penis outline location small ignore-chastity&gt;&gt;
&lt;&lt;/showbody&gt;&gt;
&lt;&lt;changebody aroused true&gt;&gt;
&lt;&lt;showbody penis outline location ignore-chastity&gt;&gt;
&lt;&lt;/showbody&gt;&gt;
&lt;&lt;showbody penis outline location small ignore-chastity&gt;&gt;
&lt;&lt;/showbody&gt;&gt;

Penis &lt;&lt;button &quot;+&quot;&gt;&gt;&lt;&lt;changebody &#39;penis&#39; &#39;increase&#39;&gt;&gt;&lt;&lt;goto &#39;Body Test&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;&lt;button &quot;-&quot;&gt;&gt;&lt;&lt;changebody &#39;penis&#39; &#39;decrease&#39;&gt;&gt;&lt;&lt;goto &#39;Body Test&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;
Chest &lt;&lt;button &quot;+&quot;&gt;&gt;&lt;&lt;changebody &#39;chest&#39; &#39;increase&#39;&gt;&gt;&lt;&lt;goto &#39;Body Test&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;&lt;button &quot;-&quot;&gt;&gt;&lt;&lt;changebody &#39;chest&#39; &#39;decrease&#39;&gt;&gt;&lt;&lt;goto &#39;Body Test&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;
Ass &lt;&lt;button &quot;+&quot;&gt;&gt;&lt;&lt;changebody &#39;ass&#39; &#39;increase&#39;&gt;&gt;&lt;&lt;goto &#39;Body Test&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;&lt;button &quot;-&quot;&gt;&gt;&lt;&lt;changebody &#39;ass&#39; &#39;decrease&#39;&gt;&gt;&lt;&lt;goto &#39;Body Test&#39;&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;decision &#39;Back&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="686" name="Color Test" tags="no-title, no-location" position="725,8600" size="100,100">&lt;&lt;decision &#39;Castle&#39; `passage()`&gt;&gt;&lt;&lt;setlocation &#39;Hallway&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Forest&#39; `passage()`&gt;&gt;&lt;&lt;setlocation &#39;Forest&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Town&#39; `passage()`&gt;&gt;&lt;&lt;setlocation &#39;Town square&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;

&lt;&lt;for _i to 0; _i &lt; getCharacters().length; _i++&gt;&gt;
    &lt;&lt;name `getCharacters()[_i].id`&gt;&gt;:
    &lt;&lt;say `getCharacters()[_i].id`&gt;&gt;
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus sapien eros, sagittis non mattis sed, convallis vitae neque. Etiam viverra.
    &lt;&lt;/say&gt;&gt;
&lt;&lt;/for&gt;&gt;</tw-passagedata><tw-passagedata pid="687" name="Dream Event Potion Transformation" tags="event" position="850,8600" size="100,100">&lt;&lt;effect charm on&gt;&gt;
&lt;&lt;changestat femininity 20&gt;&gt;
Tonight, you rest with the strangest sleep you have ever had. You feel like you have a high fever but at the same time you feel better than ever, you wake up multiple times in an almost delirious state but a strange sense that you are becoming better. ?nl
A new you. ?nl
A sense of peace flows through you as you feel yourself being changed permanently by this magical potion.

&lt;&lt;decision &#39;Continue sleeping&#39; &#39;Night&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="688" name="Wake Event Potion Transformation" tags="event" position="975,8600" size="100,100">&lt;&lt;effect charm off&gt;&gt;
&lt;&lt;startquest morgana-confront&gt;&gt;
&lt;&lt;changebody face egg&gt;&gt;
&lt;&lt;acknowledgechanges &#39;status&#39;&gt;&gt;
&lt;&lt;set $chapter = 2&gt;&gt;
&lt;&lt;set $chaptertitle= &#39;Chapter Two&#39;&gt;&gt;
&lt;&lt;set $chaptertarget = &#39;Morning&#39;&gt;&gt;
&lt;&lt;set $chaptertimeskip = false&gt;&gt;
&lt;img class=&quot;portrait themed centered&quot; character=&quot;player&quot; @src=&quot;getPortrait(&#39;player&#39;);&quot; width=&#39;400px&#39;&gt;
You wake up feeling changed. The memory of your dreams last night fade quickly but the feeling of them remain. You get out of bed and feel slightly lighter, your skin feels softer than ever and as you walk over to the mirror you notice the changes in your body. Your hair has grown out significantly overnight and your facial features feel slightly more androgynous. Someone might have a moment of doubt before placing your gender.
The rest of your body also feels different, you feel slightly more slender in your arms and shoulders.?nl
You definitely feel alarmed, it&#39;s very surprising to see yourself like this. But then again, you can&#39;t deny you also feel a sense of longing, something in you feels like this feels right. You very much try to ignore that sense for now.?nl

You feel like it&#39;s probably best to confront ?Morgana about these changes.

&lt;&lt;decision &#39;Continue&#39; &#39;Chapter&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="689" name="Wake Event Church" tags="event" position="1100,8600" size="100,100">Today is &lt;&lt;day&gt;&gt;, it&#39;s time to head to church.

&lt;&lt;decision &#39;Prepare to go to church&#39; &#39;Church Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="690" name="Wake Event Council" tags="event" position="1225,8600" size="100,100">&lt;&lt;set $week += 1&gt;&gt;
Today is &lt;&lt;day&gt;&gt;, it&#39;s time to head to the council meeting.

&lt;&lt;decision &#39;Prepare to go to the council meeting&#39; &#39;Council Bedroom&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="691" name="Wake Event Morgana Forest" tags="event" position="100,8725" size="100,100">Today is &lt;&lt;day&gt;&gt;, after you wake up, you hear someone knocking on the door.

&lt;&lt;decision &#39;Open the door&#39; &#39;Morgana Forest 1&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="692" name="Wake Event Sybille Note" tags="event" position="225,8725" size="100,100">&lt;&lt;startquest &#39;sybille-note&#39;&gt;&gt;
As you wake up and get out of your bed, you notice a small note that someone seems to have slipped under your door. Curiously, you walk over and grab it from the floor. You quickly fold open the piece of paper.?nl

&lt;&lt;note&gt;&gt;
    ?Title,?nl
    Come find me in the dungeons. I have news about the assassin.?nl
    - &lt;&lt;title sybille &#39;S&#39;&gt;&gt;
&lt;&lt;/note&gt;&gt;

Curious. Apparently ?Sybille has made progress interrogating the assassin that made an attempt on your life not too long ago. About time, you suppose. What mostly stumps you now is why she&#39;s sending secret notes instead of just talking to you directly. Is she just being mysterious again or is there a reason for this secrecy??nl

Probably best to pay her a visit and find out...

&lt;&lt;decision &#39;Go on with your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="693" name="Wake Event Sybille Note About Velma" tags="event" position="350,8725" size="100,100">&lt;&lt;startquest &#39;velma-note&#39;&gt;&gt;
As you wake up and get out of your bed, you notice a small note that someone seems to have slipped under your door. Curiously, you quickly fold open the piece of paper.?nl

&lt;&lt;note&gt;&gt;
    ?Title,?nl
    I am relaying a message from &lt;&lt;title velma &#39;V&#39;&gt;&gt;.?nl
    She has informed me that it is time to commence the plan.?nl
    Please see her at your earliest convenience.?nl
    - &lt;&lt;title sybille &#39;S&#39;&gt;&gt;
&lt;&lt;/note&gt;&gt;

The significant mysteriousness of this note has you feel quite anxious. After spending weeks undercover at the tavern it looks like it is finally time to do what you set out for in the first place, spying on your own mentor and councillor, ?Andreas... It seems like the next step is to discuss this with ?Velma. Hopefully you can get this all over with soon.

&lt;&lt;decision &#39;Go on with your day&#39; &#39;Morning&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="694" name="Wake Event Orson Poem" tags="event" position="475,8725" size="100,100">&lt;&lt;if hasTag(&#39;orson-poem-2&#39;)&gt;&gt;
    &lt;&lt;include &#39;Orson Poem 3&#39;&gt;&gt;
&lt;&lt;elseif hasTag(&#39;orson-poem-1&#39;)&gt;&gt;
    &lt;&lt;addtag &#39;orson-poem-2&#39;&gt;&gt;
    &lt;&lt;include &#39;Orson Poem 2&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Event Orson Poem&#39;&gt;&gt;&lt;&lt;delay 3&gt;&gt;&lt;&lt;/addevent&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;addtag &#39;orson-poem-1&#39;&gt;&gt;
    &lt;&lt;include &#39;Orson Poem 1&#39;&gt;&gt;
    &lt;&lt;addevent wake &#39;Wake Event Orson Poem&#39;&gt;&gt;&lt;&lt;delay 3&gt;&gt;&lt;&lt;/addevent&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="695" name="Wake Event Default" tags="event" position="600,8725" size="100,100">Today is &lt;&lt;day&gt;&gt;.

&lt;&lt;decision &#39;Get up&#39; &#39;Bedroom&#39;&gt;&gt;&lt;&lt;outfit standard&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="696" name="Chapter" tags="no-title, no-location" position="725,8725" size="100,100">&lt;&lt;stowsidebars&gt;&gt;
&lt;img src=&quot;images/backgrounds/birdseye.png&quot; class=&#39;background-big&#39; draggable=&quot;false&quot;&gt;
&lt;div class=&quot;empty-block&quot;&gt;&lt;/div&gt;
&lt;&lt;if $chapter is 4 and hasTag(&#39;princess&#39;)&gt;&gt;
    &lt;h1 class=&quot;story-title-animation&quot;&gt;a Prince&lt;span&gt;s&lt;/span&gt;s tale&lt;/h1&gt;
    &lt;div id=&quot;chapter-container&quot;&gt;&lt;/div&gt;
    &lt;&lt;timed 1s transition&gt;&gt;
        &lt;&lt;addclass &#39;.story-title-animation&#39; &#39;animate&#39;&gt;&gt;
    &lt;&lt;next 5s&gt;&gt;
        &lt;&lt;link &#39;Continue&#39; `$chaptertarget`&gt;&gt;&lt;&lt;showsidebars&gt;&gt;&lt;&lt;if $chaptertimeskip&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/if&gt;&gt;&lt;&lt;/link&gt;&gt;
    &lt;&lt;/timed&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;div id=&quot;chapter-container&quot;&gt;&lt;/div&gt;
    &lt;&lt;timed 2.5s transition&gt;&gt;
        &lt;&lt;link &#39;Continue&#39; `$chaptertarget`&gt;&gt;&lt;&lt;showsidebars&gt;&gt;&lt;&lt;if $chaptertimeskip&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/if&gt;&gt;&lt;&lt;/link&gt;&gt;
    &lt;&lt;/timed&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="697" name="Banner" tags="location" position="850,8725" size="100,100"></tw-passagedata><tw-passagedata pid="698" name="Introduction" tags="location castle" position="975,8725" size="100,100"></tw-passagedata><tw-passagedata pid="699" name="Castle Theme" tags="location castle" position="1100,8725" size="100,100"></tw-passagedata><tw-passagedata pid="700" name="Forest Theme" tags="location forest" position="1225,8725" size="100,100"></tw-passagedata><tw-passagedata pid="701" name="Town Theme" tags="location town" position="100,8850" size="100,100"></tw-passagedata><tw-passagedata pid="702" name="Thanks for playing" tags="no-title" position="225,8850" size="100,100">&lt;&lt;setlocation Banner&gt;&gt;
&lt;&lt;stowsidebars true&gt;&gt;
&lt;img src=&quot;images/backgrounds/birdseye.png&quot; class=&#39;background-big&#39; draggable=&quot;false&quot;&gt;
&lt;div class=&quot;saves-button&quot;&gt;&lt;&lt;button &#39;&lt;div class=&quot;icon-prefix save&quot;&gt;Saves&lt;/div&gt;&#39;&gt;&gt;&lt;&lt;ui saves&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;/div&gt;
Sorry for the interruption but that&#39;s all the main story content for now! You can still go back to the game and continue the side content, like the romance plot-lines, but know that there is no more content to move the main story forward. 

&lt;&lt;img &#39;portraits/tiny-pastry.jpg&#39; null &#39;250px&#39;&gt;&gt;
My name is Lucy, (aka tiny-pastry), and I&#39;ve been developing this game for quite a while now. This is the first transformation game I have made and I very much enjoy the attention to detail I can give to make it more immersive. I want to thank you for giving this game a try, I hope you enjoyed the story so far and I plan to have a new content update out as soon as it&#39;s ready.?nl
Should you be interested, you can support me on &lt;a href=&quot;https://www.patreon.com/tiny_pastry&quot; target=”_blank” class=&quot;inline-link&quot;&gt;&lt;img class=&quot;inline-img&quot; src=&quot;images/assets/patreon.png&quot;&gt;&lt;/a&gt;. This will give you earlier access to new releases of the game and you will also get a part in actively defining the direction of the game, if you want to. The story is far from set in stone so I want to include the preferences of my supporters.?nl

&lt;&lt;if setup.patreonLink&gt;&gt;
    The latest release of the game, version &lt;&lt;= setup.newVersion&gt;&gt;, is available for Patreon supporters right now. &lt;a href=&quot;https://www.patreon.com/tiny_pastry&quot; target=”_blank” class=&quot;inline-link&quot;&gt;Give it a look&lt;/a&gt;!?nl
&lt;&lt;/if&gt;&gt;

If you haven&#39;t done so already, come join us on &lt;a href=&quot;https://discord.com/invite/ptZmJj72sB&quot; target=”_blank” class=&quot;inline-link&quot;&gt;&lt;img class=&quot;inline-img&quot; src=&quot;images/assets/discord.svg&quot;&gt;&lt;/a&gt; !?nl

&lt;div class=&quot;credits-button&quot;&gt;&lt;&lt;button &#39;&lt;div class=&quot;icon-prefix star&quot;&gt;Credits&lt;/div&gt;&#39;&gt;&gt;&lt;&lt;include Credits&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;/div&gt;
&lt;&lt;decision &#39;Return to the game&#39; &#39;Hallway&#39;&gt;&gt;&lt;&lt;showsidebars true&gt;&gt;&lt;&lt;outfit standard&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="703" name="StoryInit" tags="" position="350,8850" size="100,100">&lt;&lt;set $time = 0&gt;&gt;
&lt;&lt;set $day = 0&gt;&gt;
&lt;&lt;set $week = 1&gt;&gt;
&lt;&lt;set $chapter = 0&gt;&gt;
&lt;&lt;set $chaptertitle= &#39;Prologue&#39;&gt;&gt;
&lt;&lt;set $chaptertarget = &#39;Introduction Bedroom&#39;&gt;&gt;
&lt;&lt;set $chaptertimeskip = true&gt;&gt;
&lt;&lt;set $quests = {}&gt;&gt;
&lt;&lt;set $relations = {}&gt;&gt;
&lt;&lt;set $counters = {}&gt;&gt;
&lt;&lt;set $outfits = {
    standard: {
        head: &#39;crown&#39;,
        clothes: &#39;prince_outfit_1&#39;,
        shoes: &#39;boots&#39;
    },
    church: {
        head: &#39;crown&#39;,
        clothes: &#39;prince_outfit_4&#39;,
        shoes: &#39;shoes&#39;
    },
    sleep: {
        head: &#39;none&#39;,
        clothes: &#39;none&#39;,
        shoes: &#39;none&#39;,
        underwear: &#39;underwear_1&#39;
    }
}&gt;&gt;
/* &lt;&lt;set $dilemmas = []&gt;&gt; */
&lt;&lt;set $events = {
    wake: [ 
        { passage: &#39;Wake Event Church&#39;, delay: 0, priority: 2, prerequisite: &quot;getDay() === &#39;sunday&#39;&quot;, repeating: true }, 
        { passage: &#39;Wake Event Council&#39;, delay: 0, priority: 2, prerequisite: &quot;getDay() === &#39;wednesday&#39;&quot;, repeating: true } 
    ],
    dream: []
}&gt;&gt;
&lt;&lt;set $artifacts = {
    mirror: { unlocked: false },
    sword: { unlocked: false },
    chalk: { unlocked: false },
    book: { unlocked: false },
    orb: { unlocked: false },
    scroll: { unlocked: false },
    beans: { unlocked: false },
    /* statue: { unlocked: false }, */
    bird: { unlocked: false },
    key: { unlocked: false }
    /* bowtie: { unlocked: false } */
}&gt;&gt;
&lt;&lt;set $tags = []&gt;&gt;
&lt;&lt;set $sins = []&gt;&gt;
&lt;&lt;set $books = []&gt;&gt;
&lt;&lt;set $effects = []&gt;&gt;

&lt;&lt;set $lockedlocations = [ &#39;Workshop&#39;, &#39;Magic Circle&#39;, &#39;Boarding Room&#39;, &#39;Brothel&#39;, &#39;Eve\&#39;s Room&#39;, &#39;Corridor&#39;, &#39;Cookroom&#39;, &#39;Backroom&#39;]&gt;&gt;
&lt;&lt;set $player = {
    name: &quot;Alex&quot;,
    newname: &quot;Alex&quot;,
    title: &quot;Prince&quot;,
    decency: 100,
    control: 0,
    gender: 100,
    statesmanship: 0,
    swordsmanship: 0,
    stewardship: 0,
    comport: 0,
    fashion: 0,
    etiquette: 0,
    levelexpectation: 1
}&gt;&gt;
&lt;&lt;set $body = {
    chest: 0,
    penis: 2,
    ass: 0,
    hair: 1,
    haircolor: 0,
    face: 0,
    shoulders: 0,
    hips: 0,
    muscles: 0,
    aroused: 0
}&gt;&gt;
&lt;&lt;set $equipmentlayer = &quot;over&quot;&gt;&gt;
&lt;&lt;set $inventory = {
    gold: 0,
    mushrooms: 0,
    essence: 0,
    unlockedequipment: [ &quot;crown&quot;, &quot;prince_outfit_1&quot;, &quot;prince_outfit_2&quot;, &quot;prince_outfit_2&quot;, &quot;prince_outfit_4&quot;, &quot;boots&quot;, &quot;shoes&quot;, &quot;underwear_1&quot; ],
    head: &quot;crown&quot;,
    clothes: &quot;prince_outfit_1&quot;,
    shoes: &quot;boots&quot;,
    underwear: &quot;underwear_1&quot;,
    crotch: &quot;&quot;,
    ass: &quot;&quot;
}&gt;&gt;
/* &lt;&lt;set $kingdom = {
    stability: 0,
    authority: 0,
    treasury: 0,
    whispers: 0,
    welfare: 0
}&gt;&gt; */
    /* 
    name: &quot;Avelon&quot;
    authority: 0,
    treasury: 0,
    morale: 0,
    welfare: 0,
    knowledge: 0,
    stability: 0

    Dials:
    Radial dials, 1 per stat.
    Horizontal dial, track kind of thing? Probably best
    
    
    authority (Wymerus), Whispers (Sybille), Welfare (Devota), treasury (Leopold)
    */
&lt;&lt;set $location = &quot;&quot;&gt;&gt;
&lt;&lt;set $characters = {}&gt;&gt;
&lt;&lt;set $minigames = {
    painting: {
        palette: &#39;pastel&#39;,
        colors: 0,
        filled: 0
    },
    coins: {}
}&gt;&gt;

&lt;&lt;cacheaudio &quot;castle_music&quot;  &quot;music/The_Bards_Tale.mp3&quot;&gt;&gt;
&lt;&lt;cacheaudio &quot;town_music&quot;  &quot;music/The_Old_Tower_Inn.mp3&quot;&gt;&gt;
&lt;&lt;cacheaudio &quot;forest_music&quot; &quot;music/Exploration.mp3&quot;&gt;&gt;

&lt;&lt;createaudiogroup &quot;:music&quot;&gt;&gt;
	&lt;&lt;track &quot;castle_music&quot;&gt;&gt;
	&lt;&lt;track &quot;town_music&quot;&gt;&gt;
	&lt;&lt;track &quot;forest_music&quot;&gt;&gt;
&lt;&lt;/createaudiogroup&gt;&gt;

&lt;&lt;character &#39;player&#39;&gt;&gt;
&lt;&lt;character &#39;king&#39; &#39;blurred&#39;&gt;&gt;
&lt;&lt;character &#39;orson&#39;&gt;&gt;
&lt;&lt;character &#39;rosa&#39;&gt;&gt;
&lt;&lt;character &#39;andreas&#39;&gt;&gt;
&lt;&lt;character &#39;sybille&#39;&gt;&gt;
&lt;&lt;character &#39;leopold&#39;&gt;&gt;
&lt;&lt;character &#39;wymerus&#39;&gt;&gt;
&lt;&lt;character &#39;devota&#39;&gt;&gt;
&lt;&lt;character &#39;morgana&#39;&gt;&gt;
&lt;&lt;character &#39;godric&#39; &#39;blurred&#39;&gt;&gt;
&lt;&lt;character &#39;caspar&#39;&gt;&gt;
&lt;&lt;character &#39;kathryn&#39;&gt;&gt;
&lt;&lt;character &#39;velma&#39;&gt;&gt;
&lt;&lt;character &#39;beau&#39;&gt;&gt;
&lt;&lt;character &#39;hyssop&#39;&gt;&gt;
&lt;&lt;character &#39;guard&#39;&gt;&gt;
&lt;&lt;character &#39;reading&#39;&gt;&gt;
&lt;&lt;character &#39;quinn&#39;&gt;&gt;
&lt;&lt;character &#39;bandit&#39;&gt;&gt;
&lt;&lt;character &#39;eve&#39;&gt;&gt;
&lt;&lt;character &#39;jack&#39;&gt;&gt;
&lt;&lt;character &#39;merry&#39;&gt;&gt;
&lt;&lt;character &#39;leave&#39;&gt;&gt;
&lt;&lt;character &#39;pepper&#39;&gt;&gt;

&lt;&lt;newmeter gender&gt;&gt;
    &lt;&lt;colors &quot;#000080&quot; &quot;#b000b5&quot; &quot;#000000&quot; &quot;double&quot;&gt;&gt;
    &lt;&lt;animation 500ms linear&gt;&gt;
    &lt;&lt;sizing &#39;100%&#39;&gt;&gt;
&lt;&lt;/newmeter&gt;&gt;
&lt;&lt;newmeter decency&gt;&gt;
    &lt;&lt;colors &quot;#ffffff&quot; &quot;#000000&quot; &quot;#000000&quot; &quot;double&quot;&gt;&gt;
    &lt;&lt;animation 500ms linear&gt;&gt;
    &lt;&lt;sizing &#39;100%&#39;&gt;&gt;
&lt;&lt;/newmeter&gt;&gt;
&lt;&lt;newmeter control&gt;&gt;
    &lt;&lt;colors &quot;#c80000&quot; &quot;#ffe200&quot; &quot;#000000&quot; &quot;double&quot;&gt;&gt;
    &lt;&lt;animation 500ms linear&gt;&gt;
    &lt;&lt;sizing &#39;100%&#39;&gt;&gt;
&lt;&lt;/newmeter&gt;&gt;
&lt;&lt;newmeter statesmanship&gt;&gt;
    &lt;&lt;colors &quot;#221c6d&quot; &quot;#221c6d&quot;&gt;&gt;
    &lt;&lt;animation 500ms linear&gt;&gt;
    &lt;&lt;sizing &#39;100%&#39;&gt;&gt;
&lt;&lt;/newmeter&gt;&gt;
&lt;&lt;newmeter swordsmanship&gt;&gt;
    &lt;&lt;colors &quot;#212121&quot; &quot;#212121&quot;&gt;&gt;
    &lt;&lt;animation 500ms linear&gt;&gt;
    &lt;&lt;sizing &#39;100%&#39;&gt;&gt;
&lt;&lt;/newmeter&gt;&gt;
&lt;&lt;newmeter stewardship&gt;&gt;
    &lt;&lt;colors &quot;#006400&quot; &quot;#006400&quot;&gt;&gt;
    &lt;&lt;animation 500ms linear&gt;&gt;
    &lt;&lt;sizing &#39;100%&#39;&gt;&gt;
&lt;&lt;/newmeter&gt;&gt;
&lt;&lt;newmeter comport&gt;&gt;
    &lt;&lt;colors &quot;#ffffff&quot; &quot;#ffffff&quot;&gt;&gt;
    &lt;&lt;animation 500ms linear&gt;&gt;
    &lt;&lt;sizing &#39;100%&#39;&gt;&gt;
&lt;&lt;/newmeter&gt;&gt;
&lt;&lt;newmeter fashion&gt;&gt;
    &lt;&lt;colors &quot;#093a01&quot; &quot;#093a01&quot;&gt;&gt;
    &lt;&lt;animation 500ms linear&gt;&gt;
    &lt;&lt;sizing &#39;100%&#39;&gt;&gt;
&lt;&lt;/newmeter&gt;&gt;
&lt;&lt;newmeter etiquette&gt;&gt;
    &lt;&lt;colors &quot;#8d0404&quot; &quot;#8d0404&quot;&gt;&gt;
    &lt;&lt;animation 500ms linear&gt;&gt;
    &lt;&lt;sizing &#39;100%&#39;&gt;&gt;
&lt;&lt;/newmeter&gt;&gt;</tw-passagedata><tw-passagedata pid="704" name="Canvas" tags="" position="475,8850" size="100,100">&lt;canvas width=&quot;864&quot; height=&quot;432&quot;&gt;&lt;/canvas&gt;</tw-passagedata><tw-passagedata pid="705" name="Minigame Writing" tags="minigame no-title no-location" position="600,8850" size="100,100">&lt;&lt;stowsidebars true&gt;&gt;
&lt;img src=&quot;images/backgrounds/table.jpg&quot; class=&#39;background-big&#39; draggable=&quot;false&quot;&gt;
/* &lt;&lt;fadein 0.5s 1s&gt;&gt;
    &lt;&lt;fadeout 0.5s 5s&gt;&gt;
        &lt;&lt;andreas&gt;&gt;Open the book and start writing, ?title.&lt;&lt;/andreas&gt;&gt;
    &lt;&lt;/fadeout&gt;&gt;
&lt;&lt;/fadein&gt;&gt; */
&lt;div id=&quot;writing-parent&quot;&gt;
    &lt;div class=&quot;v-center&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;container&quot;&gt;
    &lt;div class=&quot;book&quot;&gt;
        &lt;div class=&quot;first paper&quot;&gt;
        &lt;div class=&quot;page front contents&quot;&gt;
            &lt;div class=&quot;intro&quot;&gt;
            /* &lt;h2&gt;DIARY&lt;/h2&gt;
            &lt;h1&gt;2019&lt;/h1&gt; */
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;page back&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;second paper&quot;&gt;
        &lt;div class=&quot;page front contents&quot;&gt;
            &lt;div id=&quot;vara-container&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;page back&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        /* &lt;div class=&quot;third paper&quot;&gt;
        &lt;div class=&quot;page front contents&quot;&gt;
            &lt;div id=&quot;vara-container2&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;page back&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;fourth paper&quot;&gt;
        &lt;div class=&quot;page last front contents&quot;&gt;
            &lt;div id=&quot;vara-container3&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;page back&quot;&gt;&lt;/div&gt;
        &lt;/div&gt; */
        &lt;div class=&quot;side&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;bottom&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;shadow&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;&lt;decision &#39;Finish&#39; &#39;Andreas Writing Finish&#39;&gt;&gt;&lt;&lt;showsidebars true&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;/div&gt;</tw-passagedata><tw-passagedata pid="706" name="Minigame Coins" tags="minigame no-title no-location" position="725,8850" size="100,100">&lt;&lt;stowsidebars true&gt;&gt;
&lt;img src=&quot;images/backgrounds/table.jpg&quot; class=&#39;background-big&#39; draggable=&quot;false&quot;&gt;
&lt;&lt;fadein 0.5s 1s&gt;&gt;
    &lt;&lt;fadeout 0.5s 5s&gt;&gt;
        &lt;&lt;leopold&gt;&gt;Try to sort the coins into the correct bowls, ?title.&lt;&lt;/leopold&gt;&gt;
    &lt;&lt;/fadeout&gt;&gt;
&lt;&lt;/fadein&gt;&gt;
&lt;div id=&quot;coins-parent&quot;&gt;
    &lt;div id=&quot;coins-background&quot;&gt;&lt;/div&gt;
    &lt;canvas width=&quot;864&quot; height=&quot;432&quot;&gt;&lt;/canvas&gt;
    &lt;div class=&quot;small-coins&quot;&gt;
        &lt;img class=&quot;coin&quot; id=&quot;coin-1&quot; src=&quot;images/minigames/franc_nickel.svg&quot; draggable=&quot;false&quot;/&gt;
        &lt;img class=&quot;coin&quot; src=&quot;images/minigames/franc_nickel.svg&quot; draggable=&quot;false&quot;/&gt;
        &lt;img class=&quot;coin&quot; src=&quot;images/minigames/franc_nickel.svg&quot; draggable=&quot;false&quot;/&gt;
    &lt;/div&gt;
    &lt;div class=&quot;medium-coins&quot;&gt;
        &lt;img class=&quot;coin&quot; id=&quot;coin-2&quot; src=&quot;images/minigames/Franc_or.svg&quot; draggable=&quot;false&quot;/&gt;
        &lt;img class=&quot;coin&quot; src=&quot;images/minigames/Franc_or.svg&quot; draggable=&quot;false&quot;/&gt;
        &lt;img class=&quot;coin&quot; src=&quot;images/minigames/Franc_or.svg&quot; draggable=&quot;false&quot;/&gt;
    &lt;/div&gt;
    &lt;div class=&quot;large-coins&quot;&gt;
        &lt;img class=&quot;coin&quot; id=&quot;coin-3&quot; src=&quot;images/minigames/franc_bronze.svg&quot; draggable=&quot;false&quot;/&gt;
        &lt;img class=&quot;coin&quot; src=&quot;images/minigames/franc_bronze.svg&quot; draggable=&quot;false&quot;/&gt;
        &lt;img class=&quot;coin&quot; src=&quot;images/minigames/franc_bronze.svg&quot; draggable=&quot;false&quot;/&gt;
    &lt;/div&gt;
    &lt;div class=&quot;huge-coins&quot;&gt;
        &lt;img class=&quot;coin&quot; id=&quot;coin-4&quot; src=&quot;images/minigames/coste.svg&quot; draggable=&quot;false&quot;/&gt;
        &lt;img class=&quot;coin&quot; src=&quot;images/minigames/coste.svg&quot; draggable=&quot;false&quot;/&gt;
        &lt;img class=&quot;coin&quot; src=&quot;images/minigames/coste.svg&quot; draggable=&quot;false&quot;/&gt;
    &lt;/div&gt;
    &lt;img class=&quot;bowl&quot; id=&quot;bowl-1&quot; src=&quot;images/minigames/bowl.webp&quot; draggable=&quot;false&quot;/&gt;
    &lt;img class=&quot;bowl&quot; id=&quot;bowl-2&quot; src=&quot;images/minigames/bowl.webp&quot; draggable=&quot;false&quot;/&gt;
    &lt;img class=&quot;bowl&quot; id=&quot;bowl-3&quot; src=&quot;images/minigames/bowl.webp&quot; draggable=&quot;false&quot;/&gt;
    &lt;img class=&quot;bowl&quot; id=&quot;bowl-4&quot; src=&quot;images/minigames/bowl.webp&quot; draggable=&quot;false&quot;/&gt;
    &lt;&lt;decision &#39;Finish&#39; &#39;Leopold Coins Finish&#39;&gt;&gt;&lt;&lt;showsidebars true&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;/div&gt;</tw-passagedata><tw-passagedata pid="707" name="Minigame Painting" tags="minigame no-title no-location" position="850,8850" size="100,100">&lt;&lt;stowsidebars true&gt;&gt;
&lt;img src=&quot;images/backgrounds/gardens-big.png&quot; class=&#39;background-big&#39; draggable=&quot;false&quot;&gt;
&lt;&lt;fadein 0.5s 1s&gt;&gt;
    &lt;&lt;fadeout 0.5s 5s&gt;&gt;
        &lt;&lt;morgana&gt;&gt;I am keen to see what you will bring to the canvas, ?title.&lt;&lt;/morgana&gt;&gt;
    &lt;&lt;/fadeout&gt;&gt;
&lt;&lt;/fadein&gt;&gt;
&lt;div id=&quot;painting-parent&quot;&gt;
    &lt;img src=&quot;images/minigames/easel.webp&quot; class=&#39;easel&#39; draggable=&quot;false&quot;&gt;
    &lt;canvas width=&quot;564&quot; height=&quot;435&quot;&gt;&lt;/canvas&gt;
&lt;/div&gt;
&lt;&lt;fadein 0.5s 10s&gt;&gt;
    &lt;&lt;decision &#39;Finish&#39; &#39;Morgana Painting Finish&#39;&gt;&gt;&lt;&lt;showsidebars true&gt;&gt;&lt;&lt;finishminigame &#39;painting&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;
&lt;&lt;/fadein&gt;&gt;</tw-passagedata><tw-passagedata pid="708" name="Skip" tags="no-location no-title center" position="975,8850" size="100,100">&lt;&lt;stowsidebars&gt;&gt;
&lt;&lt;set $questions = []&gt;&gt;
&lt;h3&gt;How far do you want to skip ahead?&lt;/h3&gt;
&lt;&lt;decision &#39;Chapter One - Castle Tour&#39;&gt;&gt;
    &lt;&lt;include &#39;Variables Chapter 1&#39;&gt;&gt;
    &lt;&lt;include &#39;Unique Variables Chapter 1&#39;&gt;&gt;
    &lt;&lt;include &#39;Skip Question Next&#39;&gt;&gt;
    &lt;&lt;decisionicon castle&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Chapter Two - To the Forest&#39;&gt;&gt;
    &lt;&lt;include &#39;Variables Chapter 2&#39;&gt;&gt;
    &lt;&lt;include &#39;Unique Variables Chapter 2&#39;&gt;&gt;
    &lt;&lt;include &#39;Skip Question Next&#39;&gt;&gt;
    &lt;&lt;decisionicon forest&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;Chapter Three - Undercover at the Tavern&#39;&gt;&gt;
    &lt;&lt;include &#39;Variables Chapter 3&#39;&gt;&gt;
    &lt;&lt;include &#39;Unique Variables Chapter 3&#39;&gt;&gt;
    &lt;&lt;include &#39;Skip Question Next&#39;&gt;&gt;
    &lt;&lt;decisionicon town&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="709" name="Unique Variables Chapter 1" tags="" position="1100,8850" size="100,100">&lt;&lt;setlocation &#39;Castle Theme&#39;&gt;&gt;
&lt;&lt;startquest meet-morgana&gt;&gt;
&lt;&lt;set $chapter = 1&gt;&gt;
&lt;&lt;set $chaptertitle= &#39;Chapter One&#39;&gt;&gt;
&lt;&lt;set $chaptertarget = &#39;Hallway&#39;&gt;&gt;
&lt;&lt;set $chaptertimeskip = true&gt;&gt;
&lt;&lt;settime &#39;Morning&#39;&gt;&gt;
&lt;&lt;setday &#39;Wednesday&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="710" name="Unique Variables Chapter 2" tags="" position="1225,8850" size="100,100">&lt;&lt;setlocation &#39;Forest Theme&#39;&gt;&gt;
&lt;&lt;startquest morgana-confront&gt;&gt;
&lt;&lt;set $chapter = 2&gt;&gt;
&lt;&lt;set $chaptertitle= &#39;Chapter Two&#39;&gt;&gt;
&lt;&lt;set $chaptertarget = &#39;Bedroom&#39;&gt;&gt;
&lt;&lt;set $chaptertimeskip = true&gt;&gt;
&lt;&lt;settime &#39;Night&#39;&gt;&gt;
&lt;&lt;setday &#39;Monday&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="711" name="Unique Variables Chapter 3" tags="" position="100,8975" size="100,100">&lt;&lt;setlocation &#39;Town Theme&#39;&gt;&gt;
&lt;&lt;set $chapter = 3&gt;&gt;
&lt;&lt;set $chaptertitle= &#39;Chapter Three&#39;&gt;&gt;
&lt;&lt;set $chaptertarget = &#39;Tavern Velma Intro&#39;&gt;&gt;
&lt;&lt;set $chaptertimeskip = false&gt;&gt;
&lt;&lt;settime &#39;Morning&#39;&gt;&gt;
&lt;&lt;settime &#39;Monday&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="712" name="Variables Chapter 1" tags="" position="225,8975" size="100,100">&lt;&lt;completequest introduction true&gt;&gt;
&lt;&lt;startquest level-expectation&gt;&gt;</tw-passagedata><tw-passagedata pid="713" name="Variables Chapter 2" tags="" position="350,8975" size="100,100">&lt;&lt;include &#39;Variables Chapter 1&#39;&gt;&gt;
&lt;&lt;run $questions.push(&#39;Skip Question Ointment&#39;)&gt;&gt;
&lt;&lt;run $questions.push(&#39;Skip Question Potion&#39;)&gt;&gt;
&lt;&lt;addtag ointment&gt;&gt;
&lt;&lt;completequest meet-morgana true&gt;&gt;
&lt;&lt;completequest morgana-ointment-garden true&gt;&gt;
&lt;&lt;completequest morgana-ointment true&gt;&gt;
&lt;&lt;completequest morgana-bedroom true&gt;&gt;
&lt;&lt;completequest morgana-potion true&gt;&gt;
&lt;&lt;completequest assassination-attempt true&gt;&gt;
&lt;&lt;changeschedule morgana &#39;noon&#39; &#39;Garden&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="714" name="Variables Chapter 3" tags="" position="475,8975" size="100,100">&lt;&lt;include &#39;Variables Chapter 2&#39;&gt;&gt;
&lt;&lt;run $questions.push(&#39;Skip Question Crossdressing&#39;)&gt;&gt;
&lt;&lt;run $questions.push(&#39;Skip Question Undercover Name&#39;)&gt;&gt;
&lt;&lt;completequest morgana-confront true&gt;&gt;
&lt;&lt;completequest morgana-workshop-visit true&gt;&gt;
&lt;&lt;completequest morgana-kitchen true&gt;&gt;
&lt;&lt;completequest morgana-forest true&gt;&gt;
&lt;&lt;completequest sybille-note true&gt;&gt;
&lt;&lt;completequest sybille-tavern true&gt;&gt;
&lt;&lt;addevent wake &#39;Rosa Knocks&#39;&gt;&gt;&lt;&lt;delay 2&gt;&gt;&lt;&lt;/addevent&gt;&gt;
&lt;&lt;addevent wake &#39;Wake Event Orson Poem&#39;&gt;&gt;&lt;&lt;delay 4&gt;&gt;&lt;&lt;/addevent&gt;&gt;
&lt;&lt;unlocklocation &#39;Workshop&#39;&gt;&gt;
&lt;&lt;changemoney mushrooms 8&gt;&gt;
&lt;&lt;changeschedule morgana evening &#39;Workshop&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="715" name="Skip Question Next" tags="" position="600,8975" size="100,100">&lt;&lt;if $questions.length is 0&gt;&gt;
&lt;&lt;script&gt;&gt;console.log(variables().questions)&lt;&lt;/script&gt;&gt;
    &lt;&lt;unset $questions&gt;&gt;
    &lt;&lt;goto &#39;Chapter&#39;&gt;&gt;
&lt;&lt;else&gt;&gt;
    &lt;&lt;set _next = $questions[0]&gt;&gt;
    &lt;&lt;run $questions.deleteAt(0)&gt;&gt;
    &lt;&lt;goto _next&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="716" name="Skip Question Ointment" tags="no-location no-title center" position="725,8975" size="100,100">&lt;&lt;stowsidebars&gt;&gt;
&lt;h3&gt;Ointment Type&lt;/h3&gt;
&lt;i&gt;What kind of flower did you choose for ?Morgana to put in the magical ointment?&lt;/i&gt;
&lt;&lt;decision &#39;A pink flower&#39;&gt;&gt;
    &lt;&lt;addtag ointment-fem&gt;&gt;
    &lt;&lt;changestat femininity 10&gt;&gt;
    &lt;&lt;include &#39;Skip Question Next&#39;&gt;&gt;
    &lt;&lt;decisionicon femininity&gt;&gt;
&lt;&lt;/decision&gt;&gt;
&lt;&lt;decision &#39;A blue flower&#39;&gt;&gt;
    &lt;&lt;include &#39;Skip Question Next&#39;&gt;&gt;
    &lt;&lt;decisionicon masculinity&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="717" name="Skip Question Potion" tags="no-location no-title center" position="850,8975" size="100,100">&lt;&lt;stowsidebars&gt;&gt;
&lt;h3&gt;Transformation Potion&lt;/h3&gt;
&lt;i&gt;What happened to the potion ?Morgana wanted you to drink?&lt;/i&gt;

&lt;&lt;decision &#39;You drank it&#39;&gt;&gt;
    &lt;&lt;changebody face egg&gt;&gt;
    &lt;&lt;acknowledgechanges &#39;status&#39;&gt;&gt;
    &lt;&lt;changestat femininity 40&gt;&gt;
    &lt;&lt;include &#39;Skip Question Next&#39;&gt;&gt;
    &lt;&lt;decisionicon femininity&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;You didn\&#39;t drink it&#39;&gt;&gt;
    &lt;&lt;include &#39;Skip Question Next&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;You had ?Morgana drink it&#39;&gt;&gt;
    &lt;&lt;changestat dominance 20&gt;&gt;
    &lt;&lt;addtag &#39;morgana-dominated&#39;&gt;&gt;
    &lt;&lt;include &#39;Skip Question Next&#39;&gt;&gt;
    &lt;&lt;decisionicon dominance&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="718" name="Skip Question Crossdressing" tags="no-location no-title center" position="975,8975" size="100,100">&lt;&lt;stowsidebars&gt;&gt;
&lt;h3&gt;Crossdressing or not&lt;/h3&gt;
&lt;i&gt;What kind of disguise did you choose to wear to the forest with ?Morgana?&lt;/i&gt;

&lt;&lt;decision &#39;A kitchen maid uniform&#39;&gt;&gt;
    &lt;&lt;addtag crossdresser&gt;&gt;
    &lt;&lt;changestat femininity medium&gt;&gt;
    &lt;&lt;unlockequipment &#39;panties&#39;&gt;&gt;
    &lt;&lt;unlockequipment &#39;flats&#39;&gt;&gt;
    &lt;&lt;unlockequipment &#39;kitchen_maid&#39;&gt;&gt;
    &lt;&lt;unlockequipment &#39;wig_1&#39;&gt;&gt;
    &lt;&lt;changeoutfit disguise &#39;wig_1&#39; &#39;kitchen_maid&#39; &#39;flats&#39;&gt;&gt;
    &lt;&lt;changeoutfitslot standard underwear &#39;panties&#39;&gt;&gt;
    &lt;&lt;outfit disguise&gt;&gt;
    &lt;&lt;include &#39;Skip Question Next&#39;&gt;&gt;
    &lt;&lt;decisionicon femininity&gt;&gt;
&lt;&lt;/decision&gt;&gt;

&lt;&lt;decision &#39;A manservant outfit&#39;&gt;&gt;
    &lt;&lt;unlockequipment &#39;manservant&#39;&gt;&gt;
    &lt;&lt;unlockequipment &#39;hat_1&#39;&gt;&gt;
    &lt;&lt;changeoutfit disguise &#39;hat_1&#39; &#39;manservant&#39;&gt;&gt;
    &lt;&lt;outfit disguise&gt;&gt;
    &lt;&lt;include &#39;Skip Question Next&#39;&gt;&gt;
    &lt;&lt;decisionicon masculinity&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="719" name="Skip Question Undercover Name" tags="no-location no-title center" position="1100,8975" size="100,100">&lt;&lt;stowsidebars&gt;&gt;
&lt;h3&gt;A new name&lt;/h3&gt;
&lt;i&gt;What undercover name did you pick when ?Sybille sent you to spy at the tavern?&lt;/i&gt;
&lt;&lt;timed 40ms&gt;&gt;
&lt;div id=&#39;name-picker&#39;&gt;&lt;&lt;textbox &quot;$player.newname&quot; `hasTag(&#39;crossdresser&#39;) ? &#39;Alexandra&#39; : &#39;James&#39;`&gt;&gt;&lt;/div&gt;
&lt;&lt;/timed&gt;&gt;

&lt;&lt;decision &#39;Confirm undercover name&#39;&gt;&gt;
    &lt;&lt;replace &quot;#portrait-container&quot;&gt;&gt;&lt;&lt;include &#39;Portrait&#39;&gt;&gt;&lt;&lt;/replace&gt;&gt;
    &lt;&lt;include &#39;Skip Question Next&#39;&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="720" name="Start" tags="no-title" position="1225,8975" size="100,100">&lt;&lt;setlocation Banner&gt;&gt;
&lt;&lt;stowsidebars&gt;&gt;
&lt;&lt;settime &#39;Night&#39;&gt;&gt;
&lt;&lt;setday &#39;Wednesday&#39;&gt;&gt;
&lt;div class=&quot;saves-button&quot;&gt;&lt;&lt;button &#39;Saves&#39;&gt;&gt;&lt;&lt;ui saves&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;/div&gt;&lt;br&gt;
A Prince&#39;s tale is a game with adult themes and explicit content. All characters portrayed are fictional and at least 21 years or older. Please confirm you are 18 years or older, otherwise please leave this game.
&lt;&lt;decision &#39;I am 18 years or older&#39; &#39;Setup&#39;&gt;&gt;&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="721" name="Setup" tags="no-location no-title" position="100,9100" size="100,100">&lt;&lt;stowsidebars&gt;&gt;
&lt;h3&gt;What is your name?&lt;/h3&gt;
&lt;&lt;textbox &quot;$player.name&quot; &quot;Alex&quot; autofocus&gt;&gt;


&lt;&lt;set $temp = { theme: &quot;PixelArt&quot; }&gt;&gt;
&lt;h3&gt;Select character portrait style&lt;/h3&gt;
&lt;h5&gt;Applies to all characters. Can be changed at any moment in the Settings menu.&lt;/h5&gt;
&lt;div id=&quot;theme-examples&quot;&gt;
    &lt;label&gt;
        &lt;img class=&quot;portrait&quot; src=&quot;images/portraits/player_pixel.jpg&quot;&gt;
        &lt;br&gt;&lt;&lt;radiobutton &quot;$temp.theme&quot; &quot;PixelArt&quot; autocheck&gt;&gt;&lt;span&gt;Pixel art&lt;/span&gt;
    &lt;/label&gt;
    &lt;label&gt;
        &lt;img class=&quot;portrait&quot; src=&quot;images/portraits/player_anime.jpg&quot;&gt;
        &lt;br&gt;&lt;&lt;radiobutton &quot;$temp.theme&quot; &quot;Anime&quot; autocheck&gt;&gt;&lt;span&gt;Anime&lt;/span&gt;
    &lt;/label&gt;
    &lt;label&gt;
        &lt;img class=&quot;portrait&quot; src=&quot;images/portraits/player_fantasy.jpg&quot;&gt;
        &lt;br&gt;&lt;&lt;radiobutton &quot;$temp.theme&quot; &quot;Fantasy&quot; autocheck&gt;&gt;&lt;span&gt;Fantasy&lt;/span&gt;
    &lt;/label&gt;
    &lt;label&gt;
        &lt;img class=&quot;portrait&quot; src=&quot;images/portraits/player_furry.jpg&quot;&gt;
        &lt;br&gt;&lt;&lt;radiobutton &quot;$temp.theme&quot; &quot;Furry&quot; autocheck&gt;&gt;&lt;span&gt;Furry&lt;/span&gt;
    &lt;/label&gt;
&lt;/div&gt;
&lt;h3&gt;Audio settings&lt;/h3&gt;
&lt;h5&gt;You can change individual volume settings in the Settings menu.&lt;/h5&gt;
&lt;label&gt;&lt;&lt;checkbox &quot;$temp.sound&quot; false true checked&gt;&gt; Enable all sounds&lt;/label&gt;&lt;br&gt;

&lt;h3&gt;Video settings&lt;/h3&gt;
&lt;label&gt;&lt;&lt;checkbox &quot;$temp.vids&quot; false true checked&gt;&gt; Enable porn videos (potentially less immersive)&lt;/label&gt;&lt;br&gt;

&lt;h3&gt;Content settings&lt;/h3&gt;
/* &lt;h5&gt;Can be changed at any moment in the Settings menu.&lt;/h5&gt; */
&lt;div id=&quot;content-filters&quot;&gt;
&lt;label&gt;&lt;&lt;checkbox &quot;$temp.cum&quot; false true checked&gt;&gt; Cum fetish content&lt;/label&gt;&lt;br&gt;
&lt;label&gt;&lt;&lt;checkbox &quot;$temp.sph&quot; false true&gt;&gt; Small penis humiliation content&lt;/label&gt;&lt;br&gt;
/* &lt;label&gt;&lt;&lt;checkbox &quot;$temp.bread&quot; false true checked&gt;&gt; Bread fetish content&lt;/label&gt;&lt;br&gt; */
/* &lt;label&gt;&lt;&lt;checkbox &quot;$temp.watersports&quot; false true checked&gt;&gt; Watersports&lt;/label&gt; */
&lt;/div&gt;

/* &lt;&lt;decision Continue &#39;Thanks for playing&#39;&gt;&gt; */
&lt;&lt;decision Continue &#39;Introduction 1&#39;&gt;&gt;
    &lt;&lt;set $player.newname = $player.name&gt;&gt;
    &lt;&lt;set settings.theme = $temp.theme&gt;&gt;
    &lt;&lt;set settings.vids = $temp.vids&gt;&gt;
    /* &lt;&lt;set settings.watersports = $temp.watersports&gt;&gt; */
    &lt;&lt;set settings.cum = $temp.cum&gt;&gt;
    &lt;&lt;set settings.sph = $temp.sph&gt;&gt;
    /* &lt;&lt;set settings.bread = $temp.bread&gt;&gt; */
    &lt;&lt;set settings.sound = $temp.sound&gt;&gt;
    &lt;&lt;script&gt;&gt;Setting.save();&lt;&lt;/script&gt;&gt;
    &lt;&lt;unset $temp&gt;&gt;
    &lt;&lt;if settings.sph&gt;&gt;
        &lt;&lt;changebody penis small&gt;&gt;
    &lt;&lt;/if&gt;&gt;
&lt;&lt;/decision&gt;&gt;</tw-passagedata><tw-passagedata pid="722" name="StoryCaption" tags="" position="225,9100" size="100,100">&lt;div class=&quot;sound-button&quot;&gt;
&lt;&lt;button `settings.sound ? &#39;&lt;span class=&quot;icon-single volume-up&quot;&gt;&lt;/span&gt;&#39; : &#39;&lt;span class=&quot;icon-single volume-mute&quot;&gt;&lt;/span&gt;&#39;`&gt;&gt;&lt;&lt;togglesound&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;/div&gt;

&lt;div id=&quot;datetime-cycle-border&quot;&gt;
    &lt;div id=&quot;time-cycle-border&quot;&gt;
        &lt;h2 id=&quot;time-cycle&quot; @class=&quot;getTime()&quot;&gt;&lt;div id=&quot;stars&quot;&gt;&lt;/div&gt;&lt;div id=&quot;sun&quot;&gt;&lt;/div&gt;&lt;div id=&quot;moon&quot;&gt;&lt;/div&gt;&lt;span&gt;&lt;&lt;time&gt;&gt;&lt;/span&gt;&lt;/h2&gt;
    &lt;/div&gt;
    &lt;div id=&quot;week-cycle-border&quot;&gt;
        &lt;div id=&quot;week-cycle&quot; @class=&quot;getDay()&quot;&gt;
            &lt;div id=&quot;circle&quot;&gt;&lt;/div&gt;
            &lt;h2 class=&quot;week-day sunday&quot; title=&quot;Sunday&quot;&gt;S&lt;/h2&gt;&lt;h2 class=&quot;week-day monday&quot; title=&quot;Monday&quot;&gt;M&lt;/h2&gt;&lt;h2 class=&quot;week-day tuesday&quot; title=&quot;Tuesday&quot;&gt;T&lt;/h2&gt;&lt;h2 class=&quot;week-day wednesday&quot; title=&quot;Wednesday&quot;&gt;W&lt;/h2&gt;&lt;h2 class=&quot;week-day thursday&quot; title=&quot;Thursday&quot;&gt;T&lt;/h2&gt;&lt;h2 class=&quot;week-day friday&quot; title=&quot;Friday&quot;&gt;F&lt;/h2&gt;&lt;h2 class=&quot;week-day saturday&quot; title=&quot;Saturday&quot;&gt;S&lt;/h2&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;&lt;disable not tags().includes(&#39;location&#39;) or getTime() === &quot;night&quot;&gt;&gt;
    &lt;&lt;button &#39;&lt;span class=&quot;icon-suffix refresh&quot;&gt;Wait&lt;/span&gt;&#39; `passage()`&gt;&gt;&lt;&lt;increasetime 1&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;/disable&gt;&gt;
&lt;h3&gt;Quests&lt;/h3&gt;
&lt;div id=&quot;quests-list&quot;&gt;
&lt;&lt;printgoals&gt;&gt;
&lt;/div&gt;
&lt;&lt;if setup.patreonLink&gt;&gt;
    &lt;div class=&quot;menu-bottom&quot;&gt;&lt;a href=&quot;https://www.patreon.com/tiny_pastry&quot; target=”_blank” class=&quot;inline-link&quot;&gt;&lt;img class=&quot;inline-img&quot; src=&quot;images/assets/patreon.png&quot;&gt;&lt;span class=&quot;patreon-subtext&quot;&gt;Version &lt;&lt;= setup.newVersion&gt;&gt; out now!&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="723" name="StoryMenu" tags="" position="350,9100" size="100,100">&lt;&lt;if settings.debug&gt;&gt;
    &lt;&lt;link &#39;&lt;span class=&quot;icon-prefix bug&quot;&gt;Debug&lt;/span&gt;&#39;&gt;&gt;
        &lt;&lt;include &#39;Debug&#39;&gt;&gt;
    &lt;&lt;/link&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if setup.cheats&gt;&gt;
    &lt;&lt;link &#39;&lt;span class=&quot;icon-prefix magic&quot;&gt;Cheats&lt;/span&gt;&#39;&gt;&gt;
        &lt;&lt;include &#39;Cheats&#39;&gt;&gt;
    &lt;&lt;/link&gt;&gt;
&lt;&lt;/if&gt;&gt;
/* &lt;&lt;link &#39;&lt;span class=&quot;icon-prefix image&quot;&gt;Theme&lt;/span&gt;&#39;&gt;&gt;
    &lt;&lt;include &#39;Theme&#39;&gt;&gt;
&lt;&lt;/link&gt;&gt; */
&lt;&lt;link &#39;&lt;span class=&quot;icon-prefix star&quot;&gt;Credits&lt;/span&gt;&#39;&gt;&gt;
    &lt;&lt;include &#39;Credits&#39;&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;link &#39;&lt;span class=&quot;icon-prefix info&quot;&gt;Changelog&lt;/span&gt;&#39;&gt;&gt;
    &lt;&lt;include &#39;Changelog&#39;&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="724" name="Cheats" tags="" position="475,9100" size="100,100">&lt;&lt;dialog &#39;Cheats&#39; &#39;cheats-menu&#39;&gt;&gt;

    &lt;h2&gt;Currency&lt;/h2&gt;
    &lt;ul&gt;
    &lt;li&gt;
    &lt;&lt;icon mushrooms&gt;&gt; Mushrooms
    &lt;&lt;button &#39;+100&#39;&gt;&gt;&lt;&lt;changemoney mushrooms 100&gt;&gt;&lt;&lt;goto `passage()`&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon gold&gt;&gt; Gold
    &lt;&lt;button &#39;+100&#39;&gt;&gt;&lt;&lt;changemoney gold 100&gt;&gt;&lt;&lt;goto `passage()`&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon essence&gt;&gt; Essence
    &lt;&lt;button &#39;+100&#39;&gt;&gt;&lt;&lt;changemoney essence 100&gt;&gt;&lt;&lt;goto `passage()`&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;/ul&gt;
    
    
    &lt;h2&gt;Personality stats&lt;/h2&gt;
    &lt;ul&gt;
    &lt;li&gt;
    &lt;&lt;icon masculinity&gt;&gt; Masculinity
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat masculinity 10&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon femininity&gt;&gt; Femininity
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat femininity 10&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon virtue&gt;&gt; Virtue
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat virtue 10&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon depravity&gt;&gt; Depravity
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat depravity 10&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon dominance&gt;&gt; Dominance
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat dominance 10&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon submissiveness&gt;&gt; Submissiveness
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat submissiveness 10&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;/ul&gt;
    &lt;h2&gt;Princely stats&lt;/h2&gt;
    &lt;ul&gt;
    &lt;li&gt;
    &lt;&lt;icon statesmanship&gt;&gt; Statesmanship
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat statesmanship 1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;&lt;button &#39;Decrease&#39;&gt;&gt;&lt;&lt;changestat statesmanship -1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon swordsmanship&gt;&gt; Swordsmanship
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat swordsmanship 1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;&lt;button &#39;Decrease&#39;&gt;&gt;&lt;&lt;changestat swordsmanship -1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon stewardship&gt;&gt; Stewardship
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat stewardship 1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;&lt;button &#39;Decrease&#39;&gt;&gt;&lt;&lt;changestat stewardship -1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon comport&gt;&gt; Comport
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat comport 1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;&lt;button &#39;Decrease&#39;&gt;&gt;&lt;&lt;changestat comport -1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon fashion&gt;&gt; Fashion
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat fashion 1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;&lt;button &#39;Decrease&#39;&gt;&gt;&lt;&lt;changestat fashion -1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;li&gt;
    &lt;&lt;icon etiquette&gt;&gt; Etiquette
    &lt;&lt;button &#39;Increase&#39;&gt;&gt;&lt;&lt;changestat etiquette 1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;&lt;button &#39;Decrease&#39;&gt;&gt;&lt;&lt;changestat etiquette -1&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;/li&gt;
    &lt;/ul&gt;
&lt;&lt;onclose&gt;&gt;
&lt;&lt;/dialog&gt;&gt;</tw-passagedata><tw-passagedata pid="725" name="Debug" tags="" position="600,9100" size="100,100">&lt;&lt;dialog &#39;Debug&#39; &#39;debug-menu&#39;&gt;&gt;
    &lt;h2&gt;Debug menu&lt;/h2&gt;
    &lt;&lt;set $debug = { passage: &quot;&quot;, location: &quot;&quot;, quest: &quot;&quot;, completequest: &quot;&quot;, addtag: &quot;&quot;, removetag: &quot;&quot; }&gt;&gt;
    Jump to passage: &lt;&lt;textbox &quot;$debug.passage&quot; `$debug.passage`&gt;&gt;
    &lt;&lt;button &quot;Go&quot;&gt;&gt;&lt;&lt;goto `$debug.passage`&gt;&gt;&lt;&lt;dialogclose&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;br&gt;
    Set location: &lt;&lt;textbox &quot;$debug.location&quot; `$location`&gt;&gt;
    &lt;&lt;disable tags().includes(&#39;location&#39;)&gt;&gt;
        &lt;&lt;button &quot;Go&quot;&gt;&gt;&lt;&lt;setlocation `$debug.location.trim()`&gt;&gt;&lt;&lt;goto `passage()`&gt;&gt;&lt;&lt;dialogclose&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;&lt;/disable&gt;&gt;&lt;br&gt;
    &lt;&lt;if tags().includes(&#39;location&#39;)&gt;&gt;
        Can&#39;t change location while in another location passage.&lt;br&gt;&lt;br&gt;
    &lt;&lt;/if&gt;&gt;
    Start quest: &lt;&lt;textbox &quot;$debug.quest&quot; `$debug.quest`&gt;&gt;
    &lt;&lt;button &quot;Go&quot;&gt;&gt;&lt;&lt;startquest `$debug.quest.trim()`&gt;&gt;&lt;&lt;goto `passage()`&gt;&gt;&lt;&lt;dialogclose&gt;&gt;&lt;&lt;/button&gt;&gt;&lt;br&gt;
    Complete quest: &lt;&lt;textbox &quot;$debug.completequest&quot; `$debug.completequest`&gt;&gt;
    &lt;&lt;button &quot;Go&quot;&gt;&gt;&lt;&lt;completequest `$debug.completequest.trim()`&gt;&gt;&lt;&lt;goto `passage()`&gt;&gt;&lt;&lt;dialogclose&gt;&gt;&lt;&lt;/button&gt;&gt;?nl
    Add Tag: &lt;&lt;textbox &quot;$debug.addtag&quot; `$debug.addtag`&gt;&gt;
    &lt;&lt;button &quot;Go&quot;&gt;&gt;&lt;&lt;addtag `$debug.addtag.trim()`&gt;&gt;&lt;&lt;goto `passage()`&gt;&gt;&lt;&lt;dialogclose&gt;&gt;&lt;&lt;/button&gt;&gt;?nl
    Remove Tag: &lt;&lt;textbox &quot;$debug.removetag&quot; `$debug.removetag`&gt;&gt;
    &lt;&lt;button &quot;Go&quot;&gt;&gt;&lt;&lt;removetag `$debug.removetag.trim()`&gt;&gt;&lt;&lt;goto `passage()`&gt;&gt;&lt;&lt;dialogclose&gt;&gt;&lt;&lt;/button&gt;&gt;?nl
    &lt;&lt;button &quot;Color Test&quot;&gt;&gt;&lt;&lt;goto &#39;Color Test&#39;&gt;&gt;&lt;&lt;dialogclose&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;&lt;button &quot;Body Test&quot;&gt;&gt;&lt;&lt;goto &#39;Body Test&#39;&gt;&gt;&lt;&lt;dialogclose&gt;&gt;&lt;&lt;/button&gt;&gt;
    &lt;&lt;button &quot;Toggle Chastity&quot;&gt;&gt;
        &lt;&lt;if isInChastity()&gt;&gt;
            &lt;&lt;unequipchastity&gt;&gt;
        &lt;&lt;else&gt;&gt;
            &lt;&lt;equipchastity&gt;&gt;
        &lt;&lt;/if&gt;&gt;
    &lt;&lt;/button&gt;&gt;
    &lt;h2&gt;Current passage&lt;/h2&gt; 
    &lt;&lt;print passage()&gt;&gt;&lt;br&gt;
    &lt;&lt;if tags().length &gt; 0&gt;&gt;
        Passage tags: &lt;&lt;print tags()&gt;&gt;
    &lt;&lt;/if&gt;&gt;

    &lt;&lt;debuginfo&gt;&gt;
&lt;&lt;onclose&gt;&gt;
    &lt;&lt;unset $debug&gt;&gt;
&lt;&lt;/dialog&gt;&gt;</tw-passagedata><tw-passagedata pid="726" name="Credits" tags="" position="725,9100" size="100,100">&lt;&lt;dialog &#39;Credits&#39; &#39;credits-menu&#39;&gt;&gt;
    &lt;p class=&quot;paper-background&quot;&gt;
    &lt;&lt;img &#39;assets/bannerTitle.png&#39; &#39;credits-image&#39;&gt;&gt;
    &lt;b&gt;Lucy / tiny-pastry&lt;/b&gt; - Creator&lt;br&gt;
    &lt;a href=&quot;https://linktr.ee/tiny_pastry&quot; target=&quot;_blank&quot; class=&quot;inline-link link-external&quot;&gt;Linktree&lt;/a&gt;, &lt;a href=&quot;https://www.patreon.com/tiny_pastry&quot; target=&quot;_blank&quot; class=&quot;inline-link link-external&quot;&gt;Patreon&lt;/a&gt;?nl
    &lt;b&gt;Oatmilk&lt;/b&gt; - Writer?nl
    &lt;b&gt;Greenitthe&lt;/b&gt; - Writer?nl

    Together with loving support from our amazing &lt;a href=&quot;https://www.patreon.com/tiny_pastry&quot; target=”_blank” class=&quot;inline-link link-external&quot;&gt;&lt;img class=&quot;inline-img&quot; src=&quot;images/assets/patreon.png&quot;&gt;&lt;/a&gt; subscribers!
    &lt;/p&gt;
&lt;&lt;/dialog&gt;&gt;</tw-passagedata><tw-passagedata pid="727" name="Theme" tags="" position="850,9100" size="100,100">&lt;&lt;dialog &#39;Theme&#39; &#39;theme-menu&#39;&gt;&gt;
    &lt;div class=&quot;passage&quot;&gt;
    &lt;&lt;include &#39;Color Test&#39;&gt;&gt;
    &lt;/div&gt;
&lt;&lt;/dialog&gt;&gt;</tw-passagedata><tw-passagedata pid="728" name="StoryRightSidebar" tags="" position="975,9100" size="100,100">&lt;div id=&quot;portrait-container&quot;&gt;
    &lt;&lt;include &#39;Portrait&#39;&gt;&gt;
&lt;/div&gt;
/* &lt;div id=&quot;body-container&quot;&gt;
    &lt;&lt;img &#39;body/paper-doll-body.png&#39; &#39;body-part&#39;&gt;&gt;
    &lt;&lt;img &#39;body/paper-doll-penis.png&#39; &#39;body-part penis hide&#39;&gt;&gt;
&lt;/div&gt;
&lt;&lt;button &quot;Penis Toggle&quot;&gt;&gt;&lt;&lt;toggleclass &quot;.penis&quot; &quot;hide&quot;&gt;&gt;&lt;&lt;/button&gt;&gt; */
&lt;div id=&quot;equipment&quot;&gt;
    &lt;&lt;include &#39;Equipment&#39;&gt;&gt;
&lt;/div&gt;

&lt;h3&gt;Personality stats&lt;/h3&gt;
&lt;div id=&quot;dual-stats&quot; class=&quot;meters&quot;&gt;
    &lt;div class=&quot;meter&quot;&gt;
        &lt;&lt;icon femininity&gt;&gt;
        &lt;&lt;showmeter gender `getStatFraction(&#39;gender&#39;)`&gt;&gt;
        &lt;&lt;icon masculinity&gt;&gt;
    &lt;/div&gt;

    &lt;div class=&quot;meter&quot;&gt;
        &lt;&lt;icon depravity&gt;&gt;
        &lt;&lt;showmeter decency `getStatFraction(&#39;decency&#39;)`&gt;&gt;
        &lt;&lt;icon virtue&gt;&gt;
    &lt;/div&gt;

    &lt;div class=&quot;meter&quot;&gt;
        &lt;&lt;icon submissiveness&gt;&gt;
        &lt;&lt;showmeter control `getStatFraction(&#39;control&#39;)`&gt;&gt;
        &lt;&lt;icon dominance&gt;&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;&lt;if hasQuest(&#39;princess-lessons-intro&#39;) or hasQuest(&#39;princess-lessons&#39;)&gt;&gt;
&lt;h3&gt;Presence stats&lt;/h3&gt;
&lt;div class=&quot;meters&quot;&gt;
    &lt;&lt;if questStep(&#39;princess-lessons-intro&#39;) &gt; 2&gt;&gt;
    &lt;div class=&quot;meter&quot;&gt;
        &lt;&lt;icon comport&gt;&gt;
        &lt;&lt;showmeter comport `getStatFraction(&#39;comport&#39;)`&gt;&gt;
        &lt;span title=&quot;Comport level&quot; class=&quot;icon comport level&quot;&gt;&lt;&lt;print getStatLevel(&#39;comport&#39;)&gt;&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;if questStep(&#39;princess-lessons-intro&#39;) &gt; 3&gt;&gt;
    &lt;div class=&quot;meter&quot;&gt;
        &lt;&lt;icon fashion&gt;&gt;
        &lt;&lt;showmeter fashion `getStatFraction(&#39;fashion&#39;)`&gt;&gt;
        &lt;span title=&quot;Fashion level&quot; class=&quot;icon fashion level&quot;&gt;&lt;&lt;print getStatLevel(&#39;fashion&#39;)&gt;&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;&lt;/if&gt;&gt;
    &lt;&lt;if questStep(&#39;princess-lessons-intro&#39;) &gt; 4&gt;&gt;
    &lt;div class=&quot;meter&quot;&gt;
        &lt;&lt;icon etiquette&gt;&gt;
        &lt;&lt;showmeter etiquette `getStatFraction(&#39;etiquette&#39;)`&gt;&gt;
        &lt;span title=&quot;Etiquette level&quot; class=&quot;icon etiquette level&quot;&gt;&lt;&lt;print getStatLevel(&#39;etiquette&#39;)&gt;&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;&lt;/if&gt;&gt;
&lt;/div&gt;
&lt;&lt;/if&gt;&gt;
&lt;h3&gt;&lt;&lt;if hasTag(&#39;princess&#39;)&gt;&gt;Princess&lt;&lt;else&gt;&gt;Princely&lt;&lt;/if&gt;&gt; stats&lt;/h3&gt;
&lt;div class=&quot;meters&quot;&gt;
    &lt;div class=&quot;meter&quot;&gt;
        &lt;&lt;icon statesmanship&gt;&gt;
        &lt;&lt;showmeter statesmanship `getStatFraction(&#39;statesmanship&#39;)`&gt;&gt;
        &lt;span title=&quot;Statesmanship level&quot; class=&quot;icon statesmanship level&quot;&gt;&lt;&lt;print getStatLevel(&#39;statesmanship&#39;)&gt;&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;div class=&quot;meter&quot;&gt;
        &lt;&lt;icon swordsmanship&gt;&gt;
        &lt;&lt;showmeter swordsmanship `getStatFraction(&#39;swordsmanship&#39;)`&gt;&gt;
        &lt;span title=&quot;Swordsmanship level&quot; class=&quot;icon swordsmanship level&quot;&gt;&lt;&lt;print getStatLevel(&#39;swordsmanship&#39;)&gt;&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;div class=&quot;meter&quot;&gt;
        &lt;&lt;icon stewardship&gt;&gt;
        &lt;&lt;showmeter stewardship `getStatFraction(&#39;stewardship&#39;)`&gt;&gt;
        &lt;span title=&quot;Stewardship level&quot; class=&quot;icon stewardship level&quot;&gt;&lt;&lt;print getStatLevel(&#39;stewardship&#39;)&gt;&gt;&lt;/span&gt;
    &lt;/div&gt;
&lt;/div&gt;</tw-passagedata><tw-passagedata pid="729" name="Equipment" tags="" position="1100,9100" size="100,100">&lt;&lt;if !isMemory()&gt;&gt;
&lt;img class=&quot;equipment-item first&quot; @src=&quot;getEquipment(0);&quot;&gt;
&lt;img class=&quot;equipment-item second&quot; @src=&quot;getEquipment(1);&quot;&gt;
&lt;img class=&quot;equipment-item third&quot; @src=&quot;getEquipment(2);&quot;&gt;

&lt;div class=&quot;layer-buttons&quot;&gt;
&lt;&lt;disable isLayer(&#39;over&#39;)&gt;&gt;
    &lt;&lt;button &#39;Overwear&#39;&gt;&gt;&lt;&lt;run setLayer(&#39;over&#39;)&gt;&gt;&lt;&lt;replace &quot;#equipment&quot;&gt;&gt;&lt;&lt;include &#39;Equipment&#39;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;/disable&gt;&gt;
&lt;&lt;disable isLayer(&#39;under&#39;)&gt;&gt;
    &lt;&lt;button &#39;Underwear&#39;&gt;&gt;&lt;&lt;run setLayer(&#39;under&#39;)&gt;&gt;&lt;&lt;replace &quot;#equipment&quot;&gt;&gt;&lt;&lt;include &#39;Equipment&#39;&gt;&gt;&lt;&lt;/replace&gt;&gt;&lt;&lt;/button&gt;&gt;
&lt;&lt;/disable&gt;&gt;
&lt;/div&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="730" name="Portrait" tags="" position="1225,9100" size="100,100">&lt;img class=&quot;portrait themed&quot; character=&quot;player&quot; @src=&quot;getPortrait(&#39;player&#39;);&quot;&gt;
&lt;&lt;if isDisguised()&gt;&gt;
    &lt;img class=&quot;portrait-frame&quot; src=&quot;images/portraits/frame-peasant.png&quot;&gt;
    &lt;h2 class=&quot;portrait-name peasant&quot;&gt;Pauper $player.newname&lt;/h2&gt;
&lt;&lt;else&gt;&gt;
    &lt;img class=&quot;portrait-frame&quot; src=&quot;images/portraits/frame-prince.png&quot;&gt;
    &lt;h2 class=&quot;portrait-name&quot;&gt;$player.title $player.name&lt;/h2&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata></tw-storydata>
	<script id="script-sugarcube" type="text/javascript">
	/*! SugarCube JS */
	if(document.documentElement.getAttribute("data-init")==="loading"){(function(window,document,jQuery,undefined){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var errorPrologRegExp=/^(?:(?:uncaught\s+(?:exception:\s+)?)?\w*(?:error|exception|_err):\s+)+/i,Alert=function(){function mesg(where,error,isFatal,isUncaught){var mesg="Error",nice="A".concat(isFatal?" fatal":"n"," error has occurred.");nice+=isFatal?" Aborting.":" You may be able to continue, but some parts may not work properly.";var isObject=null!==error&&"object"===_typeof(error),what=(isObject&&"message"in error?String(error.message).replace(errorPrologRegExp,""):String(error)).trim()||"unknown error";null!=where&&(mesg+=" [".concat(where,"]")),mesg+=": ".concat(what,"."),isObject&&"stack"in error&&(mesg+="\n\nStack Trace:\n".concat(error.stack)),mesg&&(nice+="\n\n".concat(mesg)),isUncaught||console[isFatal?"error":"warn"](mesg),window.alert(nice)}var origOnError;return origOnError=window.onerror,window.onerror=function(what,source,lineNum,colNum,error){"complete"===document.readyState?mesg(null,null!=error?error:what,!1,!0):(mesg(null,null!=error?error:what,!0,!0),window.onerror=origOnError,"function"==typeof window.onerror&&window.onerror.apply(this,arguments))},Object.freeze(Object.defineProperties({},{error:{value:function(where,error){mesg(where,error)}},fatal:{value:function(where,error){mesg(where,error,!0)}}}))}(),Patterns=(wsMap=new Map([[" ","\\u0020"],["\f","\\f"],["\n","\\n"],["\r","\\r"],["\t","\\t"],["\v","\\v"],[" ","\\u00a0"],[" ","\\u1680"],["᠎","\\u180e"],[" ","\\u2000"],[" ","\\u2001"],[" ","\\u2002"],[" ","\\u2003"],[" ","\\u2004"],[" ","\\u2005"],[" ","\\u2006"],[" ","\\u2007"],[" ","\\u2008"],[" ","\\u2009"],[" ","\\u200a"],["\u2028","\\u2028"],["\u2029","\\u2029"],[" ","\\u202f"],[" ","\\u205f"],["　","\\u3000"],["\ufeff","\\ufeff"]]),wsRe=/^\s$/,missing="",wsMap.forEach((function(pat,char){wsRe.test(char)||(missing+=pat)})),space=missing?"[\\s".concat(missing,"]"):"\\s",spaceNoTerminator="[\\u0020\\f\\t\\v\\u00a0\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]",notSpace="\\s"===space?"\\S":space.replace(/^\[/,"[^"),anyChar="(?:.|".concat("[\\n\\r\\u2028\\u2029]",")"),anyLetter="[0-9A-Z_a-z\\-\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u00ff\\u0150\\u0170\\u0151\\u0171]",anyLetterStrict=anyLetter.replace("\\-",""),identifier="".concat("[$A-Z_a-z]").concat("[$0-9A-Z_a-z]","*"),variable="[$_]"+identifier,htmlTagName="[A-Za-z](?:".concat(cENChar="(?:[\\x2D.0-9A-Z_a-z\\xB7\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u037D\\u037F-\\u1FFF\\u200C\\u200D\\u203F\\u2040\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]|[\\uD800-\\uDB7F][\\uDC00-\\uDFFF])","*-").concat(cENChar,"*|[0-9A-Za-z]*)"),twStyle="(".concat(anyLetter,"+)\\(([^\\)\\|\\n]+)\\):"),cssStyle="".concat(spaceNoTerminator,"*(").concat(anyLetter,"+)").concat(spaceNoTerminator,"*:([^;\\|\\n]+);"),idOrClass="".concat(spaceNoTerminator,"*((?:").concat("[#.]").concat(anyLetter,"+").concat(spaceNoTerminator,"*)+);"),inlineCss="".concat(twStyle,"|").concat(cssStyle,"|").concat(idOrClass),Object.freeze({space:space,spaceNoTerminator:spaceNoTerminator,lineTerminator:"[\\n\\r\\u2028\\u2029]",notSpace:notSpace,anyChar:anyChar,anyLetter:anyLetter,anyLetterStrict:anyLetterStrict,identifierFirstChar:"[$A-Z_a-z]",identifierNextChar:"[$0-9A-Z_a-z]",identifier:identifier,variableSigil:"[$_]",variable:variable,macroName:"[A-Za-z][\\w-]*|[=-]",templateName:"[A-Za-z][\\w-]*",htmlTagName:htmlTagName,cssIdOrClassSigil:"[#.]",cssImage:"\\[[<>]?[Ii][Mm][Gg]\\[(?:\\s|\\S)*?\\]\\]+",inlineCss:inlineCss,url:"(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\s'\"]+"})),wsMap,wsRe,missing,cENChar,twStyle,cssStyle,idOrClass,space,spaceNoTerminator,notSpace,anyChar,anyLetter,anyLetterStrict,identifier,variable,htmlTagName,inlineCss;!function(){var startWSRe,endWSRe,_trimString=(startWSRe=new RegExp("^".concat(Patterns.space).concat(Patterns.space,"*")),endWSRe=new RegExp("".concat(Patterns.space).concat(Patterns.space,"*$")),function(str,where){var val=String(str);if(!val)return val;switch(where){case"start":return startWSRe.test(val)?val.replace(startWSRe,""):val;case"end":return endWSRe.test(val)?val.replace(endWSRe,""):val;default:throw new Error('_trimString called with incorrect where parameter value: "'.concat(where,'"'))}});function _createPadString(length,padding){var targetLength=Number.parseInt(length,10)||0;if(targetLength<1)return"";var padString=void 0===padding?"":String(padding);for(""===padString&&(padString=" ");padString.length<targetLength;){var curPadLength=padString.length,remainingLength=targetLength-curPadLength;padString+=curPadLength>remainingLength?padString.slice(0,remainingLength):padString}return padString.length>targetLength&&(padString=padString.slice(0,targetLength)),padString}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,writable:!0,value:function flat(){if(null==this)throw new TypeError("Array.prototype.flat called on null or undefined");var depth=0===arguments.length?1:Number(arguments[0])||0;return depth<1?Array.prototype.slice.call(this):Array.prototype.reduce.call(this,(function(acc,cur){return cur instanceof Array?acc.push.apply(acc,_toConsumableArray(flat.call(cur,depth-1))):acc.push(cur),acc}),[])}}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatMap called on null or undefined");return Array.prototype.map.apply(this,arguments).flat()}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");if(0===arguments.length)return!1;var length=this.length>>>0;if(0===length)return!1;var needle=arguments[0],i=Number(arguments[1])||0;for(i<0&&(i=Math.max(0,length+i));i<length;++i){var value=this[i];if(value===needle||value!=value&&needle!=needle)return!0}return!1}}),Object.entries||Object.defineProperty(Object,"entries",{configurable:!0,writable:!0,value:function(obj){if("object"!==_typeof(obj)||null===obj)throw new TypeError("Object.entries object parameter must be an object");return Object.keys(obj).map((function(key){return[key,obj[key]]}))}}),Object.fromEntries||Object.defineProperty(Object,"fromEntries",{configurable:!0,writable:!0,value:function(iter){return Array.from(iter).reduce((function(acc,pair){if(Object(pair)!==pair)throw new TypeError("Object.fromEntries iterable parameter must yield objects");return pair[0]in acc?Object.defineProperty(acc,pair[0],{configurable:!0,enumerable:!0,writable:!0,value:pair[1]}):acc[pair[0]]=pair[1],acc}),{})}}),Object.getOwnPropertyDescriptors||Object.defineProperty(Object,"getOwnPropertyDescriptors",{configurable:!0,writable:!0,value:function(obj){if(null==obj)throw new TypeError("Object.getOwnPropertyDescriptors object parameter is null or undefined");var O=Object(obj);return Reflect.ownKeys(O).reduce((function(acc,key){var desc=Object.getOwnPropertyDescriptor(O,key);return void 0!==desc&&(key in acc?Object.defineProperty(acc,key,{configurable:!0,enumerable:!0,writable:!0,value:desc}):acc[key]=desc),acc}),{})}}),Object.values||Object.defineProperty(Object,"values",{configurable:!0,writable:!0,value:function(obj){if("object"!==_typeof(obj)||null===obj)throw new TypeError("Object.values object parameter must be an object");return Object.keys(obj).map((function(key){return obj[key]}))}}),String.prototype.padStart||Object.defineProperty(String.prototype,"padStart",{configurable:!0,writable:!0,value:function(length,padding){if(null==this)throw new TypeError("String.prototype.padStart called on null or undefined");var baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:_createPadString(targetLength-baseLength,padding)+baseString}}),String.prototype.padEnd||Object.defineProperty(String.prototype,"padEnd",{configurable:!0,writable:!0,value:function(length,padding){if(null==this)throw new TypeError("String.prototype.padEnd called on null or undefined");var baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:baseString+_createPadString(targetLength-baseLength,padding)}}),String.prototype.trimStart||Object.defineProperty(String.prototype,"trimStart",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimStart called on null or undefined");return _trimString(this,"start")}}),String.prototype.trimLeft||Object.defineProperty(String.prototype,"trimLeft",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimLeft called on null or undefined");return _trimString(this,"start")}}),String.prototype.trimEnd||Object.defineProperty(String.prototype,"trimEnd",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimEnd called on null or undefined");return _trimString(this,"end")}}),String.prototype.trimRight||Object.defineProperty(String.prototype,"trimRight",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimRight called on null or undefined");return _trimString(this,"end")}})}(),function(){var _nativeMathRandom=Math.random,_regExpMetaCharsRe,_hasRegExpMetaCharsRe,_formatRegExp,_hasFormatRegExp;function _random(){var min,max;switch(arguments.length){case 0:throw new Error("_random called with insufficient parameters");case 1:min=0,max=arguments[0];break;default:min=arguments[0],max=arguments[1]}if(min>max){var _ref=[max,min];min=_ref[0],max=_ref[1]}return Math.floor(_nativeMathRandom()*(max-min+1))+min}function _randomIndex(length,boundsArgs){var min,max;switch(boundsArgs.length){case 1:min=0,max=length-1;break;case 2:min=0,max=Math.trunc(boundsArgs[1]);break;default:min=Math.trunc(boundsArgs[1]),max=Math.trunc(boundsArgs[2])}return Number.isNaN(min)?min=0:!Number.isFinite(min)||min>=length?min=length-1:min<0&&(min=length+min)<0&&(min=0),Number.isNaN(max)?max=0:(!Number.isFinite(max)||max>=length||max<0&&(max=length+max)<0)&&(max=length-1),_random(min,max)}function _getCodePointStartAndEnd(str,pos){var code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:"",start:-1,end:-1};if(code<55296||code>57343)return{char:str.charAt(pos),start:pos,end:pos};if(code>=55296&&code<=56319){var nextPos=pos+1;if(nextPos>=str.length)throw new Error("high surrogate without trailing low surrogate");var nextCode=str.charCodeAt(nextPos);if(nextCode<56320||nextCode>57343)throw new Error("high surrogate without trailing low surrogate");return{char:str.charAt(pos)+str.charAt(nextPos),start:pos,end:nextPos}}if(0===pos)throw new Error("low surrogate without leading high surrogate");var prevPos=pos-1,prevCode=str.charCodeAt(prevPos);if(prevCode<55296||prevCode>56319)throw new Error("low surrogate without leading high surrogate");return{char:str.charAt(prevPos)+str.charAt(pos),start:prevPos,end:pos}}Object.defineProperty(Array,"random",{configurable:!0,writable:!0,value:function(array){if("object"!==_typeof(array)||null===array||!Object.prototype.hasOwnProperty.call(array,"length"))throw new TypeError("Array.random array parameter must be an array or array-lke object");var length=array.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments,1));return array[index]}}}),Object.defineProperty(Array.prototype,"concatUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.concatUnique called on null or undefined");var result=Array.from(this);if(0===arguments.length)return result;var items=Array.prototype.reduce.call(arguments,(function(prev,cur){return prev.concat(cur)}),[]),addSize=items.length;if(0===addSize)return result;for(var indexOf=Array.prototype.indexOf,push=Array.prototype.push,i=0;i<addSize;++i){var value=items[i];-1===indexOf.call(result,value)&&push.call(result,value)}return result}}),Object.defineProperty(Array.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.count called on null or undefined");for(var indexOf=Array.prototype.indexOf,needle=arguments[0],pos=Number(arguments[1])||0,count=0;-1!==(pos=indexOf.call(this,needle,pos));)++count,++pos;return count}}),Object.defineProperty(Array.prototype,"countWith",{configurable:!0,writable:!0,value:function(predicate,thisArg){if(null==this)throw new TypeError("Array.prototype.countWith called on null or undefined");if("function"!=typeof predicate)throw new Error("Array.prototype.countWith predicate parameter must be a function");var length=this.length>>>0;if(0===length)return 0;for(var count=0,i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&++count;return count}}),Object.defineProperty(Array.prototype,"delete",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.delete called on null or undefined");if(0===arguments.length)return[];var length=this.length>>>0;if(0===length)return[];for(var needles=Array.prototype.concat.apply([],arguments),needlesLength=needles.length,indices=[],i=0;i<length;++i)for(var value=this[i],j=0;j<needlesLength;++j){var needle=needles[j];if(value===needle||value!=value&&needle!=needle){indices.push(i);break}}for(var result=[],_i=0,iend=indices.length;_i<iend;++_i)result[_i]=this[indices[_i]];for(var splice=Array.prototype.splice,_i2=indices.length-1;_i2>=0;--_i2)splice.call(this,indices[_i2],1);return result}}),Object.defineProperty(Array.prototype,"deleteAt",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.deleteAt called on null or undefined");if(0===arguments.length)return[];var length=this.length>>>0;if(0===length)return[];for(var splice=Array.prototype.splice,cpyIndices=_toConsumableArray(new Set(Array.prototype.concat.apply([],arguments).map((function(x){return x<0?Math.max(0,length+x):x}))).values()),delIndices=_toConsumableArray(cpyIndices).sort((function(a,b){return b-a})),result=[],i=0,iend=cpyIndices.length;i<iend;++i)result[i]=this[cpyIndices[i]];for(var _i3=0,_iend=delIndices.length;_i3<_iend;++_i3)splice.call(this,delIndices[_i3],1);return result}}),Object.defineProperty(Array.prototype,"deleteWith",{configurable:!0,writable:!0,value:function(predicate,thisArg){if(null==this)throw new TypeError("Array.prototype.deleteWith called on null or undefined");if("function"!=typeof predicate)throw new Error("Array.prototype.deleteWith predicate parameter must be a function");var length=this.length>>>0;if(0===length)return[];for(var splice=Array.prototype.splice,indices=[],result=[],i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&(result.push(this[i]),indices.push(i));for(var _i4=indices.length-1;_i4>=0;--_i4)splice.call(this,indices[_i4],1);return result}}),Object.defineProperty(Array.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.first called on null or undefined");if(0!==this.length>>>0)return this[0]}}),Object.defineProperty(Array.prototype,"includesAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAll called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAll.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var i=0,iend=arguments.length;i<iend;++i)if(!Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!1;return!0}}),Object.defineProperty(Array.prototype,"includesAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAny called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAny.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var i=0,iend=arguments.length;i<iend;++i)if(Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!0;return!1}}),Object.defineProperty(Array.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.last called on null or undefined");var length=this.length>>>0;if(0!==length)return this[length-1]}}),Object.defineProperty(Array.prototype,"pluck",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pluck called on null or undefined");var length=this.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments));return Array.prototype.splice.call(this,index,1)[0]}}}),Object.defineProperty(Array.prototype,"pluckMany",{configurable:!0,writable:!0,value:function(wantSize){if(null==this)throw new TypeError("Array.prototype.pluckMany called on null or undefined");var length=this.length>>>0;if(0===length)return[];var want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error("Array.prototype.pluckMany want parameter must be an integer");if(want<1)return[];want>length&&(want=length);var splice=Array.prototype.splice,result=[],max=length-1;do{result.push(splice.call(this,_random(0,max--),1)[0])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,"pushUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pushUnique called on null or undefined");var addSize=arguments.length;if(0===addSize)return this.length>>>0;for(var indexOf=Array.prototype.indexOf,push=Array.prototype.push,i=0;i<addSize;++i){var value=arguments[i];-1===indexOf.call(this,value)&&push.call(this,value)}return this.length>>>0}}),Object.defineProperty(Array.prototype,"random",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.random called on null or undefined");var length=this.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments));return this[index]}}}),Object.defineProperty(Array.prototype,"randomMany",{configurable:!0,writable:!0,value:function(wantSize){if(null==this)throw new TypeError("Array.prototype.randomMany called on null or undefined");var length=this.length>>>0;if(0===length)return[];var want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error("Array.prototype.randomMany want parameter must be an integer");if(want<1)return[];want>length&&(want=length);var picked=new Map,result=[],max=length-1;do{var i=void 0;do{i=_random(0,max)}while(picked.has(i));picked.set(i,!0),result.push(this[i])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,"shuffle",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.shuffle called on null or undefined");var length=this.length>>>0;if(0===length)return this;for(var i=length-1;i>0;--i){var j=Math.floor(_nativeMathRandom()*(i+1));if(i!==j){var swap=this[i];this[i]=this[j],this[j]=swap}}return this}}),Object.defineProperty(Array.prototype,"unshiftUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.unshiftUnique called on null or undefined");var addSize=arguments.length;if(0===addSize)return this.length>>>0;for(var indexOf=Array.prototype.indexOf,unshift=Array.prototype.unshift,i=0;i<addSize;++i){var value=arguments[i];-1===indexOf.call(this,value)&&unshift.call(this,value)}return this.length>>>0}}),Object.defineProperty(Function.prototype,"partial",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Function.prototype.partial called on null or undefined");var slice=Array.prototype.slice,fn=this,bound=slice.call(arguments,0);return function(){for(var applied=[],argc=0,i=0;i<bound.length;++i)applied.push(bound[i]===undefined?arguments[argc++]:bound[i]);return fn.apply(this,applied.concat(slice.call(arguments,argc)))}}}),Object.defineProperty(Math,"clamp",{configurable:!0,writable:!0,value:function(num,min,max){var value=Number(num);return Number.isNaN(value)?NaN:value.clamp(min,max)}}),Object.defineProperty(Math,"easeInOut",{configurable:!0,writable:!0,value:function(num){return 1-(Math.cos(Number(num)*Math.PI)+1)/2}}),Object.defineProperty(Number.prototype,"clamp",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Number.prototype.clamp called on null or undefined");if(2!==arguments.length)throw new Error("Number.prototype.clamp called with an incorrect number of parameters");var min=Number(arguments[0]),max=Number(arguments[1]);if(min>max){var _ref2=[max,min];min=_ref2[0],max=_ref2[1]}return Math.min(Math.max(this,min),max)}}),RegExp.escape||(_regExpMetaCharsRe=/[\\^$*+?.()|[\]{}]/g,_hasRegExpMetaCharsRe=new RegExp(_regExpMetaCharsRe.source),Object.defineProperty(RegExp,"escape",{configurable:!0,writable:!0,value:function(str){var val=String(str);return val&&_hasRegExpMetaCharsRe.test(val)?val.replace(_regExpMetaCharsRe,"\\$&"):val}})),_formatRegExp=/{(\d+)(?:,([+-]?\d+))?}/g,_hasFormatRegExp=new RegExp(_formatRegExp.source),Object.defineProperty(String,"format",{configurable:!0,writable:!0,value:function(format){function padString(str,align,pad){if(!align)return str;var plen=Math.abs(align)-str.length;if(plen<1)return str;var padding=String(pad).repeat(plen);return align<0?str+padding:padding+str}if(arguments.length<2)return 0===arguments.length?"":format;var args=2===arguments.length&&Array.isArray(arguments[1])?_toConsumableArray(arguments[1]):Array.prototype.slice.call(arguments,1);return 0===args.length?format:_hasFormatRegExp.test(format)?(_formatRegExp.lastIndex=0,format.replace(_formatRegExp,(function(match,index,align){var retval=args[index];if(null==retval)return"";for(;"function"==typeof retval;)retval=retval();switch(_typeof(retval)){case"string":break;case"object":retval=JSON.stringify(retval);break;default:retval=String(retval)}return padString(retval,align?Number.parseInt(align,10):0," ")}))):format}}),Object.defineProperty(String.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.contains called on null or undefined");return-1!==String.prototype.indexOf.apply(this,arguments)}}),Object.defineProperty(String.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.count called on null or undefined");var needle=String(arguments[0]||"");if(""===needle)return 0;for(var indexOf=String.prototype.indexOf,step=needle.length,pos=Number(arguments[1])||0,count=0;-1!==(pos=indexOf.call(this,needle,pos));)++count,pos+=step;return count}}),Object.defineProperty(String.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.first called on null or undefined");return _getCodePointStartAndEnd(String(this),0).char}}),Object.defineProperty(String.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.last called on null or undefined");var str=String(this);return _getCodePointStartAndEnd(str,str.length-1).char}}),Object.defineProperty(String.prototype,"splice",{configurable:!0,writable:!0,value:function(startAt,delCount,replacement){if(null==this)throw new TypeError("String.prototype.splice called on null or undefined");var length=this.length>>>0;if(0===length)return"";var start=Number(startAt);Number.isSafeInteger(start)?start<0&&(start+=length)<0&&(start=0):start=0,start>length&&(start=length);var count=Number(delCount);(!Number.isSafeInteger(count)||count<0)&&(count=0);var res=this.slice(0,start);return void 0!==replacement&&(res+=replacement),start+count<length&&(res+=this.slice(start+count)),res}}),Object.defineProperty(String.prototype,"splitOrEmpty",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.splitOrEmpty called on null or undefined");return""===String(this)?[]:String.prototype.split.apply(this,arguments)}}),Object.defineProperty(String.prototype,"toLocaleUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toLocaleUpperFirst called on null or undefined");var str=String(this),_getCodePointStartAnd3=_getCodePointStartAndEnd(str,0),char=_getCodePointStartAnd3.char,end=_getCodePointStartAnd3.end;return-1===end?"":char.toLocaleUpperCase()+str.slice(end+1)}}),Object.defineProperty(String.prototype,"toUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toUpperFirst called on null or undefined");var str=String(this),_getCodePointStartAnd4=_getCodePointStartAndEnd(str,0),char=_getCodePointStartAnd4.char,end=_getCodePointStartAnd4.end;return-1===end?"":char.toUpperCase()+str.slice(end+1)}}),Object.defineProperty(Date.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:date)",this.toISOString()]}}),Object.defineProperty(Function.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)","(".concat(this.toString(),")")]}}),Object.defineProperty(Map.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:map)",_toConsumableArray(this)]}}),Object.defineProperty(RegExp.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)",this.toString()]}}),Object.defineProperty(Set.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:set)",_toConsumableArray(this)]}}),Object.defineProperty(JSON,"reviveWrapper",{configurable:!0,writable:!0,value:function(code,data){if("string"!=typeof code)throw new TypeError("JSON.reviveWrapper code parameter must be a string");return["(revive:eval)",[code,data]]}}),Object.defineProperty(JSON,"_real_stringify",{value:JSON.stringify}),Object.defineProperty(JSON,"stringify",{configurable:!0,writable:!0,value:function(_value,replacer,space){return JSON._real_stringify(_value,(function(key,val){var value=val;if("function"==typeof replacer)try{value=replacer(key,value)}catch(ex){}return void 0===value&&(value=["(revive:eval)","undefined"]),value}),space)}}),Object.defineProperty(JSON,"_real_parse",{value:JSON.parse}),Object.defineProperty(JSON,"parse",{configurable:!0,writable:!0,value:function value(text,reviver){return JSON._real_parse(text,(function(key,val){var value=val;if(Array.isArray(value)&&2===value.length)switch(value[0]){case"(revive:set)":value=new Set(value[1]);break;case"(revive:map)":value=new Map(value[1]);break;case"(revive:date)":value=new Date(value[1]);break;case"(revive:eval)":try{if(Array.isArray(value[1])){var $ReviveData$=value[1][1];value=eval(value[1][0])}else value=eval(value[1])}catch(ex){}}else if("string"==typeof value&&"@@revive@@"===value.slice(0,10))try{value=eval(value.slice(10))}catch(ex){}if("function"==typeof reviver)try{value=reviver(key,value)}catch(ex){}return value}))}}),Object.defineProperty(Array.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.contains called on null or undefined");return Array.prototype.includes.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAll called on null or undefined");return Array.prototype.includesAll.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAny called on null or undefined");return Array.prototype.includesAny.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"flatten",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatten called on null or undefined");return Array.prototype.flat.call(this,1/0)}}),Object.defineProperty(String.prototype,"readBracketedList",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.readBracketedList called on null or undefined");for(var match,re=new RegExp("(?:\\[\\[((?:\\s|\\S)*?)\\]\\])|([^\"'\\s]\\S*)","gm"),names=[];null!==(match=re.exec(this));)match[1]?names.push(match[1]):match[2]&&names.push(match[2]);return names}})}();var Browser=(userAgent=navigator.userAgent.toLowerCase(),winPhone=userAgent.includes("windows phone"),isMobile=Object.freeze({Android:!winPhone&&userAgent.includes("android"),BlackBerry:/blackberry|bb10/.test(userAgent),iOS:!winPhone&&/ip(?:hone|ad|od)/.test(userAgent),Opera:!winPhone&&("object"===_typeof(window.operamini)||userAgent.includes("opera mini")),Windows:winPhone||/iemobile|wpdesktop/.test(userAgent),any:function(){return isMobile.Android||isMobile.BlackBerry||isMobile.iOS||isMobile.Opera||isMobile.Windows}}),isGecko=!isMobile.Windows&&!/khtml|trident|edge/.test(userAgent)&&userAgent.includes("gecko"),isIE=!userAgent.includes("opera")&&/msie|trident/.test(userAgent),ieVersion=isIE?(ver=/(?:msie\s+|rv:)(\d+\.\d)/.exec(userAgent))?Number(ver[1]):0:null,isOpera=userAgent.includes("opera")||userAgent.includes(" opr/"),operaVersion=isOpera?function(){var ver=new RegExp("".concat(/khtml|chrome/.test(userAgent)?"opr":"version","\\/(\\d+\\.\\d+)")).exec(userAgent);return ver?Number(ver[1]):0}():null,isVivaldi=userAgent.includes("vivaldi"),Object.freeze({userAgent:userAgent,isMobile:isMobile,isGecko:isGecko,isIE:isIE,ieVersion:ieVersion,isOpera:isOpera,operaVersion:operaVersion,isVivaldi:isVivaldi})),ver,userAgent,winPhone,isMobile,isGecko,isIE,ieVersion,isOpera,operaVersion,isVivaldi,Has=(hasAudioElement=function(){try{return"function"==typeof document.createElement("audio").canPlayType}catch(ex){}return!1}(),hasFile=function(){try{return"Blob"in window&&"File"in window&&"FileList"in window&&"FileReader"in window&&(!Browser.isOpera||Browser.operaVersion>=15)}catch(ex){}return!1}(),hasGeolocation=function(){try{return"geolocation"in navigator&&"function"==typeof navigator.geolocation.getCurrentPosition&&"function"==typeof navigator.geolocation.watchPosition}catch(ex){}return!1}(),hasMutationObserver=function(){try{return"MutationObserver"in window&&"function"==typeof window.MutationObserver}catch(ex){}return!1}(),hasPerformance=function(){try{return"performance"in window&&"function"==typeof window.performance.now}catch(ex){}return!1}(),hasTouch=function(){try{return"ontouchstart"in window||!!window.DocumentTouch&&document instanceof window.DocumentTouch||!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints}catch(ex){}return!1}(),hasTransitionEndEvent=function(){try{for(var teMap=new Map([["transition","transitionend"],["MSTransition","msTransitionEnd"],["WebkitTransition","webkitTransitionEnd"],["MozTransition","transitionend"]]),teKeys=_toConsumableArray(teMap.keys()),el=document.createElement("div"),i=0;i<teKeys.length;++i)if(el.style[teKeys[i]]!==undefined)return teMap.get(teKeys[i])}catch(ex){}return!1}(),Object.freeze({audio:hasAudioElement,fileAPI:hasFile,geolocation:hasGeolocation,mutationObserver:hasMutationObserver,performance:hasPerformance,touch:hasTouch,transitionEndEvent:hasTransitionEndEvent})),hasAudioElement,hasFile,hasGeolocation,hasMutationObserver,hasPerformance,hasTouch,hasTransitionEndEvent,Visibility=(vendor=function(){try{return Object.freeze([{hiddenProperty:"hidden",stateProperty:"visibilityState",changeEvent:"visibilitychange"},{hiddenProperty:"webkitHidden",stateProperty:"webkitVisibilityState",changeEvent:"webkitvisibilitychange"},{hiddenProperty:"mozHidden",stateProperty:"mozVisibilityState",changeEvent:"mozvisibilitychange"},{hiddenProperty:"msHidden",stateProperty:"msVisibilityState",changeEvent:"msvisibilitychange"}].find((function(vnd){return vnd.hiddenProperty in document})))}catch(ex){}return undefined}(),Object.freeze(Object.defineProperties({},{vendor:{get:function(){return vendor}},state:{get:function(){return vendor&&document[vendor.stateProperty]||"visible"}},isEnabled:{value:function(){return Boolean(vendor)}},isHidden:{value:function(){return Boolean(vendor&&document[vendor.hiddenProperty])}},hiddenProperty:{value:vendor&&vendor.hiddenProperty},stateProperty:{value:vendor&&vendor.stateProperty},changeEvent:{value:vendor&&vendor.changeEvent}}))),vendor,Fullscreen=function(){var _hasPromise,vendor=function(){try{return Object.freeze([{isEnabled:"fullscreenEnabled",element:"fullscreenElement",requestFn:"requestFullscreen",exitFn:"exitFullscreen",changeEvent:"fullscreenchange",errorEvent:"fullscreenerror"},{isEnabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",requestFn:"webkitRequestFullscreen",exitFn:"webkitExitFullscreen",changeEvent:"webkitfullscreenchange",errorEvent:"webkitfullscreenerror"},{isEnabled:"mozFullScreenEnabled",element:"mozFullScreenElement",requestFn:"mozRequestFullScreen",exitFn:"mozCancelFullScreen",changeEvent:"mozfullscreenchange",errorEvent:"mozfullscreenerror"},{isEnabled:"msFullscreenEnabled",element:"msFullscreenElement",requestFn:"msRequestFullscreen",exitFn:"msExitFullscreen",changeEvent:"MSFullscreenChange",errorEvent:"MSFullscreenError"}].find((function(vnd){return vnd.isEnabled in document})))}catch(ex){}return undefined}(),_returnsPromise=(_hasPromise=null,function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,vendor)try{var value=document.exitFullscreen();value.catch((function(){})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise});function _selectElement(requestedEl){var selectedEl=requestedEl||document.documentElement;return selectedEl===document.documentElement&&("msRequestFullscreen"===vendor.requestFn||Browser.isOpera&&Browser.operaVersion<15)&&(selectedEl=document.body),selectedEl}function isFullscreen(){return Boolean(vendor&&document[vendor.element])}function requestFullscreen(options,requestedEl){var _this=this;if(!vendor)return Promise.reject(new Error("fullscreen not supported"));var element=_selectElement(requestedEl);if("function"!=typeof element[vendor.requestFn])return Promise.reject(new Error("fullscreen not supported"));if(isFullscreen())return Promise.resolve();if(_returnsPromise())return element[vendor.requestFn](options);var namespace=".Fullscreen_requestFullscreen";return new Promise((function(resolve,reject){jQuery(element).off(namespace).one("".concat(vendor.errorEvent).concat(namespace," ").concat(vendor.changeEvent).concat(namespace),(function(ev){jQuery(_this).off(namespace),ev.type===vendor.errorEvent?reject(new Error("unknown fullscreen request error")):resolve()})),element[vendor.requestFn](options)}))}function exitFullscreen(){var _this2=this;if(!vendor||"function"!=typeof document[vendor.exitFn])return Promise.reject(new TypeError("fullscreen not supported"));if(!isFullscreen())return Promise.reject(new TypeError("fullscreen mode not active"));if(_returnsPromise())return document[vendor.exitFn]();var namespace=".Fullscreen_exitFullscreen";return new Promise((function(resolve,reject){jQuery(document).off(namespace).one("".concat(vendor.errorEvent).concat(namespace," ").concat(vendor.changeEvent).concat(namespace),(function(ev){jQuery(_this2).off(namespace),ev.type===vendor.errorEvent?reject(new Error("unknown fullscreen exit error")):resolve()})),document[vendor.exitFn]()}))}return Object.freeze(Object.defineProperties({},{vendor:{get:function(){return vendor}},element:{get:function(){return vendor?document[vendor.element]:null}},isEnabled:{value:function(){return Boolean(vendor&&document[vendor.isEnabled])}},isFullscreen:{value:isFullscreen},request:{value:requestFullscreen},exit:{value:exitFullscreen},toggle:{value:function(options,requestedEl){return isFullscreen()?exitFullscreen():requestFullscreen(options,requestedEl)}},onChange:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);$(element).on(vendor.changeEvent,handlerFn)}}},offChange:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);handlerFn?$(element).off(vendor.changeEvent,handlerFn):$(element).off(vendor.changeEvent)}}},onError:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);$(element).on(vendor.errorEvent,handlerFn)}}},offError:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);handlerFn?$(element).off(vendor.errorEvent,handlerFn):$(element).off(vendor.errorEvent)}}}}))}(),_ref3=Object.freeze(Object.defineProperties({},{clone:{value:function clone(orig){return"object"!==_typeof(orig)||null===orig?orig:orig instanceof String?String(orig):orig instanceof Number?Number(orig):orig instanceof Boolean?Boolean(orig):"function"==typeof orig.clone?orig.clone(!0):orig.nodeType&&"function"==typeof orig.cloneNode?orig.cloneNode(!0):(orig instanceof Array?copy=new Array(orig.length):orig instanceof Date?copy=new Date(orig.getTime()):orig instanceof Map?(copy=new Map,orig.forEach((function(val,key){return copy.set(key,clone(val))}))):orig instanceof RegExp?copy=new RegExp(orig):orig instanceof Set?(copy=new Set,orig.forEach((function(val){return copy.add(clone(val))}))):copy=Object.create(Object.getPrototypeOf(orig)),Object.keys(orig).forEach((function(name){return copy[name]=clone(orig[name])})),copy);var copy}},convertBreaks:{value:function(source){for(var node,output=document.createDocumentFragment(),para=document.createElement("p");null!==(node=source.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case"BR":if(null!==node.nextSibling&&node.nextSibling.nodeType===Node.ELEMENT_NODE&&"BR"===node.nextSibling.nodeName.toUpperCase()){source.removeChild(node.nextSibling),source.removeChild(node),output.appendChild(para),para=document.createElement("p");continue}if(!para.hasChildNodes()){source.removeChild(node);continue}break;case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":para.hasChildNodes()&&(output.appendChild(para),para=document.createElement("p")),output.appendChild(node);continue}para.appendChild(node)}para.hasChildNodes()&&output.appendChild(para),source.appendChild(output)}},safeActiveElement:{value:function(){try{return document.activeElement||null}catch(ex){return null}}},setDisplayTitle:{value:function(title){if("string"!=typeof title)throw new TypeError("story display title must be a string (received: ".concat(Util.getType(title),")"));var render=document.createDocumentFragment();new Wikifier(render,title);var text=function(source){for(var node,copy=source.cloneNode(!0),frag=document.createDocumentFragment();null!==(node=copy.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case"BR":case"DIV":case"P":frag.appendChild(document.createTextNode(" "))}frag.appendChild(node)}return frag.textContent}(render).trim();document.title=Config.passages.displayTitles&&""!==State.passage&&State.passage!==Config.passages.start?"".concat(State.passage," | ").concat(text):text;var storyTitle=document.getElementById("story-title");null!==storyTitle&&jQuery(storyTitle).empty().append(render)}},setPageElement:{value:function(idOrElement,titles,defaultText){var el="object"===_typeof(idOrElement)?idOrElement:document.getElementById(idOrElement);if(null==el)return null;var ids=Array.isArray(titles)?titles:[titles];jQuery(el).empty();for(var i=0,iend=ids.length;i<iend;++i)if(Story.has(ids[i]))return new Wikifier(el,Story.get(ids[i]).processText().trim()),el;if(null!=defaultText){var text=String(defaultText).trim();""!==text&&new Wikifier(el,text)}return el}},throwError:{value:function(place,message,source){var $wrapper=jQuery(document.createElement("div")),$toggle=jQuery(document.createElement("button")),$source=jQuery(document.createElement("pre")),mesg="".concat(L10n.get("errorTitle"),": ").concat(message||"unknown error");return $toggle.addClass("error-toggle").ariaClick({label:L10n.get("errorToggle")},(function(){$toggle.hasClass("enabled")?($toggle.removeClass("enabled"),$source.attr({"aria-hidden":!0,hidden:"hidden"})):($toggle.addClass("enabled"),$source.removeAttr("aria-hidden hidden"))})).appendTo($wrapper),jQuery(document.createElement("span")).addClass("error").text(mesg).appendTo($wrapper),jQuery(document.createElement("code")).text(source).appendTo($source),$source.addClass("error-source").attr({"aria-hidden":!0,hidden:"hidden"}).appendTo($wrapper),$wrapper.addClass("error-view").appendTo(place),console.warn("".concat(mesg,"\n\t").concat(source.replace(/\n/g,"\n\t"))),!1}},stringFrom:{value:function stringFrom(value){switch(_typeof(value)){case"function":return"[function]";case"number":if(Number.isNaN(value))return"[number NaN]";break;case"object":if(null===value)return"[null]";if(value instanceof Array)return value.map((function(val){return stringFrom(val)})).join(", ");if(value instanceof Set)return Array.from(value).map((function(val){return stringFrom(val)})).join(", ");if(value instanceof Map){var result=Array.from(value).map((function(_ref4){var _ref5=_slicedToArray(_ref4,2),key=_ref5[0],val=_ref5[1];return"".concat(stringFrom(key)," → ").concat(stringFrom(val))}));return"{ ".concat(result.join(", ")," }")}if(value instanceof Date)return value.toLocaleString();if(value instanceof Element){if(value===document.documentElement||value===document.head||value===document.body)throw new Error("illegal operation; attempting to convert the <html>, <head>, or <body> tags to string is not allowed");return value.outerHTML}return value instanceof Node?value.textContent:"function"==typeof value.toString?value.toString():Object.prototype.toString.call(value);case"symbol":var desc=void 0!==value.description?' "'.concat(value.description,'"'):"";return"[symbol".concat(desc,"]");case"undefined":return"[undefined]"}return String(value)}}})),clone=_ref3.clone,convertBreaks=_ref3.convertBreaks,safeActiveElement=_ref3.safeActiveElement,setDisplayTitle=_ref3.setDisplayTitle,setPageElement=_ref3.setPageElement,throwError=_ref3.throwError,stringFrom=_ref3.stringFrom;!function(){function onKeypressFn(ev){13!==ev.which&&32!==ev.which||(ev.preventDefault(),jQuery(safeActiveElement()||this).trigger("click"))}function onClickFnWrapper(fn){return function(){var $this=jQuery(this);$this.ariaIsDisabled()||($this.is("[aria-pressed]")&&$this.attr("aria-pressed","true"===$this.attr("aria-pressed")?"false":"true"),fn.apply(this,arguments))}}function oneClickFnWrapper(fn){return onClickFnWrapper((function(){jQuery(this).off(".aria-clickable").removeAttr("role tabindex aria-controls aria-pressed").filter("button").prop("disabled",!0),fn.apply(this,arguments)}))}jQuery.fn.extend({ariaClick:function(options,handler){if(0===this.length||0===arguments.length)return this;var opts=options,fn=handler;return null==fn&&(fn=opts,opts=undefined),"string"!=typeof(opts=jQuery.extend({namespace:undefined,one:!1,selector:undefined,data:undefined,role:undefined,controls:undefined,pressed:undefined,label:undefined},opts)).namespace?opts.namespace="":"."!==opts.namespace[0]&&(opts.namespace=".".concat(opts.namespace)),"boolean"==typeof opts.pressed&&(opts.pressed=opts.pressed?"true":"false"),this.filter("button").prop("type","button"),null!=opts.role?this.attr("role",opts.role):this.not("[role]").filter("a,[data-passage]").attr("role","link").end().not("a").not("[data-passage]").attr("role","button").end().end().end(),this.attr("tabindex",0),null!=opts.controls&&this.attr("aria-controls",opts.controls),null!=opts.pressed&&this.attr("aria-pressed",opts.pressed),null!=opts.label&&this.attr({"aria-label":opts.label,title:opts.label}),this.not("button").on("keypress.aria-clickable".concat(opts.namespace),opts.selector,onKeypressFn),this.on("click.aria-clickable".concat(opts.namespace),opts.selector,opts.data,opts.one?oneClickFnWrapper(fn):onClickFnWrapper(fn)),this},ariaDisabled:function(disable){if(0===this.length||0===arguments.length)return this;var $nonDisableable=this.not("button,fieldset,input,menuitem,optgroup,option,select,textarea"),$disableable=this.filter("button,fieldset,input,menuitem,optgroup,option,select,textarea");return disable?($nonDisableable.each((function(){this.setAttribute("disabled",""),this.setAttribute("aria-disabled","true")})),$disableable.each((function(){this.disabled=!0,this.setAttribute("aria-disabled","true")}))):($nonDisableable.each((function(){this.removeAttribute("disabled"),this.removeAttribute("aria-disabled")})),$disableable.each((function(){this.disabled=!1,this.removeAttribute("aria-disabled")}))),this},ariaIsDisabled:function(){return this.is("[disabled]")}})}(),jQuery.extend({wikiWithOptions:function(options){for(var _len=arguments.length,sources=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)sources[_key-1]=arguments[_key];if(0!==sources.length){var frag=document.createDocumentFragment();sources.forEach((function(content){return new Wikifier(frag,content,options)}));var errors=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent.replace(errorPrologRegExp,"")}));if(errors.length>0)throw new Error(errors.join("; "))}},wiki:function(){for(var _len2=arguments.length,sources=new Array(_len2),_key2=0;_key2<_len2;_key2++)sources[_key2]=arguments[_key2];this.wikiWithOptions.apply(this,[undefined].concat(sources))}}),jQuery.fn.extend({wikiWithOptions:function(options){for(var _len3=arguments.length,sources=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++)sources[_key3-1]=arguments[_key3];if(0===this.length||0===sources.length)return this;var frag=document.createDocumentFragment();return sources.forEach((function(content){return new Wikifier(frag,content,options)})),this.append(frag),this},wiki:function(){for(var _len4=arguments.length,sources=new Array(_len4),_key4=0;_key4<_len4;_key4++)sources[_key4]=arguments[_key4];return this.wikiWithOptions.apply(this,[undefined].concat(sources))}});var Util=function(){var toString,utilGetType="[object Object]"===(toString=Object.prototype.toString).call(new Map)?function(O){if(null===O)return"null";if(O instanceof Map)return"Map";if(O instanceof Set)return"Set";var baseType=_typeof(O);return"object"===baseType?toString.call(O).slice(8,-1):baseType}:function(O){if(null===O)return"null";var baseType=_typeof(O);return"object"===baseType?toString.call(O).slice(8,-1):baseType};function utilToEnum(obj){var pEnum=Object.create(null);if(obj instanceof Array)obj.forEach((function(val,i){return pEnum[String(val)]=i}));else if(obj instanceof Set)Array.from(obj).forEach((function(val,i){return pEnum[String(val)]=i}));else if(obj instanceof Map)obj.forEach((function(val,key){return pEnum[String(key)]=val}));else{if("object"!==_typeof(obj)||null===obj||Object.getPrototypeOf(obj)!==Object.prototype)throw new TypeError("Util.toEnum obj parameter must be an Array, Map, Set, or generic object");Object.assign(pEnum,obj)}return Object.freeze(pEnum)}function utilToStringTag(obj){return Object.prototype.toString.call(obj).slice(8,-1)}var _illegalSlugCharsRe=/[\x00-\x20!-/:-@[-^`{-\x9f]+/g,_isInvalidSlugRe=/^-*$/;var _illegalFilenameCharsRE=/[\x00-\x1f"#$%&'*+,/:;<=>?\\^`|\x7f-\x9f]+/g;var _markupCharsRe=/[!"#$&'*\-/<=>?@[\\\]^_`{|}~]/g,_hasMarkupCharsRe=new RegExp(_markupCharsRe.source),_markupCharsMap=utilToEnum({"!":"&#33;",'"':"&quot;","#":"&#35;",$:"&#36;","&":"&amp;","'":"&#39;","*":"&#42;","-":"&#45;","/":"&#47;","<":"&lt;","=":"&#61;",">":"&gt;","?":"&#63;","@":"&#64;","[":"&#91;","\\":"&#92;","]":"&#93;","^":"&#94;",_:"&#95;","`":"&#96;","{":"&#123;","|":"&#124;","}":"&#125;","~":"&#126;"});var _htmlCharsRe=/[&<>"'`]/g,_hasHtmlCharsRe=new RegExp(_htmlCharsRe.source),_htmlCharsMap=utilToEnum({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"});function utilEscape(str){if(null==str)return"";var val=String(str);return val&&_hasHtmlCharsRe.test(val)?val.replace(_htmlCharsRe,(function(ch){return _htmlCharsMap[ch]})):val}var _escapedHtmlRe=/&(?:amp|#38|#x26|lt|#60|#x3c|gt|#62|#x3e|quot|#34|#x22|apos|#39|#x27|#96|#x60);/gi,_hasEscapedHtmlRe=new RegExp(_escapedHtmlRe.source,"i"),_escapedHtmlMap=utilToEnum({"&amp;":"&","&#38;":"&","&#x26;":"&","&lt;":"<","&#60;":"<","&#x3c;":"<","&gt;":">","&#62;":">","&#x3e;":">","&quot;":'"',"&#34;":'"',"&#x22;":'"',"&apos;":"'","&#39;":"'","&#x27;":"'","&#96;":"`","&#x60;":"`"});function utilUnescape(str){if(null==str)return"";var val=String(str);return val&&_hasEscapedHtmlRe.test(val)?val.replace(_escapedHtmlRe,(function(entity){return _escapedHtmlMap[entity.toLowerCase()]})):val}var _nowSource=Has.performance?performance:Date;var _cssTimeRe=/^([+-]?(?:\d*\.)?\d+)([Mm]?[Ss])$/;var utilScrubEventKey=function(){var separatorKey,decimalKey;if("undefined"!=typeof Intl&&"function"==typeof Intl.NumberFormat){var match=(new Intl.NumberFormat).format(111111.5).match(/(\D*)\d+(\D*)/);match&&(separatorKey=match[1],decimalKey=match[2])}return separatorKey||decimalKey||(separatorKey=",",decimalKey="."),function(key){switch(key){case"Scroll":return"ScrollLock";case"Spacebar":return" ";case"Left":return"ArrowLeft";case"Right":return"ArrowRight";case"Up":return"ArrowUp";case"Down":return"ArrowDown";case"Del":return"Delete";case"Crsel":return"CrSel";case"Exsel":return"ExSel";case"Esc":return"Escape";case"Apps":return"ContextMenu";case"Nonconvert":return"NonConvert";case"MediaNextTrack":return"MediaTrackNext";case"MediaPreviousTrack":return"MediaTrackPrevious";case"VolumeUp":return"AudioVolumeUp";case"VolumeDown":return"AudioVolumeDown";case"VolumeMute":return"AudioVolumeMute";case"Zoom":return"ZoomToggle";case"SelectMedia":case"MediaSelect":return"LaunchMediaPlayer";case"Add":return"+";case"Divide":return"/";case"Multiply":return"*";case"Subtract":return"-";case"Decimal":return decimalKey;case"Separator":return separatorKey}return key}}(),utilHasMediaQuery="function"!=typeof window.matchMedia?function(){return!1}:function(mediaQuery){return window.matchMedia(mediaQuery).matches};return Object.freeze(Object.defineProperties({},{getType:{value:utilGetType},isBoolean:{value:function(obj){return"boolean"==typeof obj||"string"==typeof obj&&("true"===obj||"false"===obj)}},isIterable:{value:function(obj){return null!=obj&&"function"==typeof obj[Symbol.iterator]}},isNumeric:{value:function(obj){var num;switch(_typeof(obj)){case"number":num=obj;break;case"string":num=Number(obj);break;default:return!1}return!Number.isNaN(num)&&Number.isFinite(num)}},sameValueZero:{value:function(a,b){return a===b||a!=a&&b!=b}},toEnum:{value:utilToEnum},toStringTag:{value:utilToStringTag},slugify:{value:function(str){var base=String(str).trim(),_legacy=base.replace(/[^\w\s\u2013\u2014-]+/g,"").replace(/[_\s\u2013\u2014-]+/g,"-").toLocaleLowerCase();return _isInvalidSlugRe.test(_legacy)?base.replace(_illegalSlugCharsRe,"").replace(/[_\s\u2013\u2014-]+/g,"-"):_legacy}},sanitizeFilename:{value:function(str){return String(str).trim().replace(_illegalFilenameCharsRE,"")}},escapeMarkup:{value:function(str){if(null==str)return"";var val=String(str);return val&&_hasMarkupCharsRe.test(val)?val.replace(_markupCharsRe,(function(ch){return _markupCharsMap[ch]})):val}},escape:{value:utilEscape},unescape:{value:utilUnescape},charAndPosAt:{value:function(text,position){var str=String(text),pos=Math.trunc(position),code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:"",start:-1,end:-1};var retval={char:str.charAt(pos),start:pos,end:pos};if(code<55296||code>57343)return retval;if(code>=55296&&code<=56319){var nextPos=pos+1;if(nextPos>=str.length)return retval;var nextCode=str.charCodeAt(nextPos);return nextCode<56320||nextCode>57343||(retval.char=retval.char+str.charAt(nextPos),retval.end=nextPos),retval}if(0===pos)return retval;var prevPos=pos-1,prevCode=str.charCodeAt(prevPos);return prevCode<55296||prevCode>56319||(retval.char=str.charAt(prevPos)+retval.char,retval.start=prevPos),retval}},now:{value:function(){return _nowSource.now()}},fromCssTime:{value:function(cssTime){var match=_cssTimeRe.exec(String(cssTime));if(null===match)throw new SyntaxError('invalid time value syntax: "'.concat(cssTime,'"'));var msec=Number(match[1]);if(1===match[2].length&&(msec*=1e3),Number.isNaN(msec)||!Number.isFinite(msec))throw new RangeError('invalid time value: "'.concat(cssTime,'"'));return msec}},toCssTime:{value:function(msec){if("number"!=typeof msec||Number.isNaN(msec)||!Number.isFinite(msec)){var what;switch(_typeof(msec)){case"string":what='"'.concat(msec,'"');break;case"number":what=String(msec);break;default:what=utilToStringTag(msec)}throw new Error("invalid milliseconds: ".concat(what))}return"".concat(msec,"ms")}},fromCssProperty:{value:function(cssName){if(!cssName.includes("-"))switch(cssName){case"bgcolor":return"backgroundColor";case"float":return"cssFloat";default:return cssName}return("-ms-"===cssName.slice(0,4)?cssName.slice(1):cssName).split("-").map((function(part,i){return 0===i?part:part.toUpperFirst()})).join("")}},parseUrl:{value:function(url){var el=document.createElement("a"),queryObj=Object.create(null);el.href=url,el.search&&el.search.replace(/^\?/,"").splitOrEmpty(/(?:&(?:amp;)?|;)/).forEach((function(query){var _query$split2=_slicedToArray(query.split("="),2),key=_query$split2[0],value=_query$split2[1];queryObj[key]=value}));var pathname=el.host&&"/"!==el.pathname[0]?"/".concat(el.pathname):el.pathname;return{href:el.href,protocol:el.protocol,host:el.host,hostname:el.hostname,port:el.port,path:"".concat(pathname).concat(el.search),pathname:pathname,query:el.search,search:el.search,queries:queryObj,searches:queryObj,hash:el.hash}}},newExceptionFrom:{value:function(original,exceptionType,override){if("object"!==_typeof(original)||null===original)throw new Error("Util.newExceptionFrom original parameter must be an object");if("function"!=typeof exceptionType)throw new Error("Util.newExceptionFrom exceptionType parameter must be an error type constructor");var ex=new exceptionType(original.message);void 0!==original.name&&(ex.name=original.name),void 0!==original.code&&(ex.code=original.code),void 0!==original.columnNumber&&(ex.columnNumber=original.columnNumber),void 0!==original.description&&(ex.description=original.description),void 0!==original.fileName&&(ex.fileName=original.fileName),void 0!==original.lineNumber&&(ex.lineNumber=original.lineNumber),void 0!==original.number&&(ex.number=original.number),void 0!==original.stack&&(ex.stack=original.stack);var overrideType=_typeof(override);if("undefined"!==overrideType)if("object"===overrideType&&null!==override)Object.assign(ex,override);else{if("string"!==overrideType)throw new Error("Util.newExceptionFrom override parameter must be an object or string");ex.message=override}return ex}},scrubEventKey:{value:utilScrubEventKey},hasMediaQuery:{value:utilHasMediaQuery},random:{value:Math.random},entityEncode:{value:utilEscape},entityDecode:{value:utilUnescape},evalExpression:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),SimpleStore=(_adapters=[],_initialized=null,Object.freeze(Object.defineProperties({},{adapters:{value:_adapters},create:{value:function(storageId,persistent){if(_initialized)return _initialized.create(storageId,persistent);for(var i=0;i<_adapters.length;++i)if(_adapters[i].init(storageId,persistent))return(_initialized=_adapters[i]).create(storageId,persistent);throw new Error("no valid storage adapters found")}}}))),_adapters,_initialized,_ok,_WebStorageAdapter;SimpleStore.adapters.push((_ok=!1,_WebStorageAdapter=function(){function _WebStorageAdapter(storageId,persistent){_classCallCheck(this,_WebStorageAdapter);var prefix="".concat(storageId,"."),engine=null,name=null;persistent?(engine=window.localStorage,name="localStorage"):(engine=window.sessionStorage,name="sessionStorage"),Object.defineProperties(this,{_engine:{value:engine},_prefix:{value:prefix},_prefixRe:{value:new RegExp("^".concat(RegExp.escape(prefix)))},name:{value:name},id:{value:storageId},persistent:{value:!!persistent}})}return _createClass(_WebStorageAdapter,[{key:"length",get:function(){return this.keys().length}},{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){for(var keys=[],i=0;i<this._engine.length;++i){var key=this._engine.key(i);this._prefixRe.test(key)&&keys.push(key.replace(this._prefixRe,""))}return keys}},{key:"has",value:function(key){return!("string"!=typeof key||!key)&&this._engine.hasOwnProperty(this._prefix+key)}},{key:"get",value:function(key){if("string"!=typeof key||!key)return null;var value=this._engine.getItem(this._prefix+key);return null==value?null:_WebStorageAdapter._deserialize(value)}},{key:"set",value:function(key,value){if("string"!=typeof key||!key)return!1;try{this._engine.setItem(this._prefix+key,_WebStorageAdapter._serialize(value))}catch(ex){if(/quota.?(?:exceeded|reached)/i.test(ex.name+ex.message))throw Util.newExceptionFrom(ex,Error,"".concat(this.name," quota exceeded"));throw ex}return!0}},{key:"delete",value:function(key){return!("string"!=typeof key||!key||(this._engine.removeItem(this._prefix+key),0))}},{key:"clear",value:function(){for(var keys=this.keys(),i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}}],[{key:"_serialize",value:function(obj){return LZString.compressToUTF16(JSON.stringify(obj))}},{key:"_deserialize",value:function(str){return JSON.parse(LZString.decompressFromUTF16(str))}}]),_WebStorageAdapter}(),Object.freeze(Object.defineProperties({},{init:{value:function(){function hasWebStorage(storeId){try{var store=window[storeId],tid="_sc_".concat(String(Date.now()));store.setItem(tid,tid);var result=store.getItem(tid)===tid;return store.removeItem(tid),result}catch(ex){}return!1}return _ok=hasWebStorage("localStorage")&&hasWebStorage("sessionStorage")}},create:{value:function(storageId,persistent){if(!_ok)throw new Error("adapter not initialized");return new _WebStorageAdapter(storageId,persistent)}}})))),SimpleStore.adapters.push(function(){var _MAX_EXPIRY="Tue, 19 Jan 2038 03:14:07 GMT",_MIN_EXPIRY="Thu, 01 Jan 1970 00:00:00 GMT",_ok=!1,_CookieAdapter=function(){function _CookieAdapter(storageId,persistent){_classCallCheck(this,_CookieAdapter);var prefix="".concat(storageId).concat(persistent?"!":"*",".");Object.defineProperties(this,{_prefix:{value:prefix},_prefixRe:{value:new RegExp("^".concat(RegExp.escape(prefix)))},name:{value:"cookie"},id:{value:storageId},persistent:{value:!!persistent}})}return _createClass(_CookieAdapter,[{key:"length",get:function(){return this.keys().length}},{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){if(""===document.cookie)return[];for(var cookies=document.cookie.split(/;\s*/),keys=[],i=0;i<cookies.length;++i){var kvPair=cookies[i].split("="),key=decodeURIComponent(kvPair[0]);if(this._prefixRe.test(key))""!==decodeURIComponent(kvPair[1])&&keys.push(key.replace(this._prefixRe,""))}return keys}},{key:"has",value:function(key){return!("string"!=typeof key||!key)&&null!==_CookieAdapter._getCookie(this._prefix+key)}},{key:"get",value:function(key){if("string"!=typeof key||!key)return null;var value=_CookieAdapter._getCookie(this._prefix+key);return null===value?null:_CookieAdapter._deserialize(value)}},{key:"set",value:function(key,value){if("string"!=typeof key||!key)return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,_CookieAdapter._serialize(value),this.persistent?"Tue, 19 Jan 2038 03:14:07 GMT":undefined),!this.has(key))throw new Error("unknown validation error during set")}catch(ex){throw Util.newExceptionFrom(ex,Error,"cookie error: ".concat(ex.message))}return!0}},{key:"delete",value:function(key){if("string"!=typeof key||!key||!this.has(key))return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,undefined,_MIN_EXPIRY),this.has(key))throw new Error("unknown validation error during delete")}catch(ex){throw Util.newExceptionFrom(ex,Error,"cookie error: ".concat(ex.message))}return!0}},{key:"clear",value:function(){for(var keys=this.keys(),i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}}],[{key:"_getCookie",value:function(prefixedKey){if(!prefixedKey||""===document.cookie)return null;for(var cookies=document.cookie.split(/;\s*/),i=0;i<cookies.length;++i){var kvPair=cookies[i].split("=");if(prefixedKey===decodeURIComponent(kvPair[0]))return decodeURIComponent(kvPair[1])||null}return null}},{key:"_setCookie",value:function(prefixedKey,value,expiry){if(prefixedKey){var payload="".concat(encodeURIComponent(prefixedKey),"=");null!=value&&(payload+=encodeURIComponent(value)),null!=expiry&&(payload+="; expires=".concat(expiry)),payload+="; path=/",document.cookie=payload}}},{key:"_serialize",value:function(obj){return LZString.compressToBase64(JSON.stringify(obj))}},{key:"_deserialize",value:function(str){return JSON.parse(LZString.decompressFromBase64(str))}}]),_CookieAdapter}();return Object.freeze(Object.defineProperties({},{init:{value:function(storageId){try{var tid="_sc_".concat(String(Date.now()));_CookieAdapter._setCookie(tid,_CookieAdapter._serialize(tid),undefined),_ok=_CookieAdapter._deserialize(_CookieAdapter._getCookie(tid))===tid,_CookieAdapter._setCookie(tid,undefined,_MIN_EXPIRY)}catch(ex){_ok=!1}return _ok&&function(storageId){if(""===document.cookie)return;for(var oldPrefix="".concat(storageId,"."),oldPrefixRe=new RegExp("^".concat(RegExp.escape(oldPrefix))),persistPrefix="".concat(storageId,"!."),sessionPrefix="".concat(storageId,"*."),sessionTestRe=/\.(?:state|rcWarn)$/,cookies=document.cookie.split(/;\s*/),i=0;i<cookies.length;++i){var kvPair=cookies[i].split("="),key=decodeURIComponent(kvPair[0]);if(oldPrefixRe.test(key)){var value=decodeURIComponent(kvPair[1]);""!==value&&function(){var persist=!sessionTestRe.test(key);_CookieAdapter._setCookie(key,undefined,_MIN_EXPIRY),_CookieAdapter._setCookie(key.replace(oldPrefixRe,(function(){return persist?persistPrefix:sessionPrefix})),value,persist?_MAX_EXPIRY:undefined)}()}}}(storageId),_ok}},create:{value:function(storageId,persistent){if(!_ok)throw new Error("adapter not initialized");return new _CookieAdapter(storageId,persistent)}}}))}());var DebugView=function(){function DebugView(parent,type,name,title){_classCallCheck(this,DebugView),Object.defineProperties(this,{parent:{value:parent},view:{value:document.createElement("span")},break:{value:document.createElement("wbr")}}),jQuery(this.view).attr({title:title,"aria-label":title,"data-type":null!=type?type:"","data-name":null!=name?name:""}).addClass("debug"),jQuery(this.break).addClass("debug hidden"),this.parent.appendChild(this.view),this.parent.appendChild(this.break)}return _createClass(DebugView,[{key:"output",get:function(){return this.view}},{key:"type",get:function(){return this.view.getAttribute("data-type")},set:function(type){this.view.setAttribute("data-type",null!=type?type:"")}},{key:"name",get:function(){return this.view.getAttribute("data-name")},set:function(name){this.view.setAttribute("data-name",null!=name?name:"")}},{key:"title",get:function(){return this.view.title},set:function(title){this.view.title=title}},{key:"append",value:function(el){return jQuery(this.view).append(el),this}},{key:"modes",value:function(options){if(null==options){var current={};return this.view.className.splitOrEmpty(/\s+/).forEach((function(name){"debug"!==name&&(current[name]=!0)})),current}if("object"===_typeof(options))return Object.keys(options).forEach((function(name){this[options[name]?"addClass":"removeClass"](name)}),jQuery(this.view)),this;throw new Error("DebugView.prototype.modes options parameter must be an object or null/undefined")}},{key:"remove",value:function(){var $view=jQuery(this.view);this.view.hasChildNodes()&&$view.contents().appendTo(this.parent),$view.remove(),jQuery(this.break).remove()}}],[{key:"isEnabled",value:function(){return"enabled"===jQuery(document.documentElement).attr("data-debug-view")}},{key:"enable",value:function(){jQuery(document.documentElement).attr("data-debug-view","enabled"),jQuery.event.trigger(":debugviewupdate")}},{key:"disable",value:function(){jQuery(document.documentElement).removeAttr("data-debug-view"),jQuery.event.trigger(":debugviewupdate")}},{key:"toggle",value:function(){"enabled"===jQuery(document.documentElement).attr("data-debug-view")?DebugView.disable():DebugView.enable()}}]),DebugView}(),NodeTyper=function(){var NodeTyper=function(){function NodeTyper(config){if(_classCallCheck(this,NodeTyper),"object"!==_typeof(config)||null===config)throw new Error("config parameter must be an object (received: ".concat(Util.getType(config),")"));if(!(config.hasOwnProperty("targetNode")&&config.targetNode instanceof Node))throw new Error('config parameter object "targetNode" property must be a node');Object.defineProperties(this,{node:{value:config.targetNode},childNodes:{value:[]},nodeValue:{writable:!0,value:""},appendTo:{writable:!0,value:config.parentNode||null},classNames:{writable:!0,value:config.classNames||null},finished:{writable:!0,value:!1}});var childNode,node=this.node;for(node.nodeValue&&(this.nodeValue=node.nodeValue,node.nodeValue="");null!==(childNode=node.firstChild);)this.childNodes.push(new NodeTyper({targetNode:childNode,parentNode:node,classNames:this.classNames})),node.removeChild(childNode)}return _createClass(NodeTyper,[{key:"finish",value:function(){for(;this.type(!0););return!1}},{key:"type",value:function(flush){if(this.finished)return!1;if(this.appendTo){if(this.appendTo.appendChild(this.node),this.appendTo=null,this.node.nodeType!==Node.ELEMENT_NODE&&this.node.nodeType!==Node.TEXT_NODE||"none"===jQuery(this.node.parentNode).css("display"))return this.finish();this.node.parentNode&&this.classNames&&jQuery(this.node.parentNode).addClass(this.classNames)}if(this.nodeValue){if(flush)this.node.nodeValue+=this.nodeValue,this.nodeValue="";else{var _Util$charAndPosAt=Util.charAndPosAt(this.nodeValue,0),char=_Util$charAndPosAt.char,start=_Util$charAndPosAt.start,end=_Util$charAndPosAt.end;this.node.nodeValue+=char,this.nodeValue=this.nodeValue.slice(1+end-start)}return!0}this.classNames&&(jQuery(this.node.parentNode).removeClass(this.classNames),this.classNames=null);for(var childNodes=this.childNodes;childNodes.length>0;){if(childNodes[0].type())return!0;childNodes.shift()}return this.finished=!0,!1}}]),NodeTyper}();return NodeTyper}(),PRNGWrapper=function(){function PRNGWrapper(seed,useEntropy){_classCallCheck(this,PRNGWrapper),Object.defineProperties(this,new Math.seedrandom(seed,useEntropy,(function(prng,seed){return{_prng:{value:prng},seed:{writable:!0,value:seed},pull:{writable:!0,value:0},random:{value:function(){return++this.pull,this._prng()}}}})))}return _createClass(PRNGWrapper,null,[{key:"marshal",value:function(prng){if(!prng||!prng.hasOwnProperty("seed")||!prng.hasOwnProperty("pull"))throw new Error("PRNG is missing required data");return{seed:prng.seed,pull:prng.pull}}},{key:"unmarshal",value:function(prngObj){if(!prngObj||!prngObj.hasOwnProperty("seed")||!prngObj.hasOwnProperty("pull"))throw new Error("PRNG object is missing required data");for(var prng=new PRNGWrapper(prngObj.seed,!1),i=prngObj.pull;i>0;--i)prng.random();return prng}}]),PRNGWrapper}(),StyleWrapper=(_imageMarkupRe=new RegExp(Patterns.cssImage,"g"),_hasImageMarkupRe=new RegExp(Patterns.cssImage),function(){function StyleWrapper(style){if(_classCallCheck(this,StyleWrapper),null==style)throw new TypeError("StyleWrapper style parameter must be an HTMLStyleElement object");Object.defineProperties(this,{style:{value:style}})}return _createClass(StyleWrapper,[{key:"isEmpty",value:function(){return 0===this.style.cssRules.length}},{key:"set",value:function(rawCss){this.clear(),this.add(rawCss)}},{key:"add",value:function(rawCss){var css=rawCss;_hasImageMarkupRe.test(css)&&(_imageMarkupRe.lastIndex=0,css=css.replace(_imageMarkupRe,(function(wikiImage){var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty("error")||markup.pos<wikiImage.length)return wikiImage;var source=markup.source;if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(source=passage.text.trim())}return'url("'.concat(source.replace(/"/g,"%22"),'")')}))),this.style.styleSheet?this.style.styleSheet.cssText+=css:this.style.appendChild(document.createTextNode(css))}},{key:"clear",value:function(){this.style.styleSheet?this.style.styleSheet.cssText="":jQuery(this.style).empty()}}]),StyleWrapper}()),_imageMarkupRe,_hasImageMarkupRe,Diff=(Op=Util.toEnum({Delete:0,SpliceArray:1,Copy:2,CopyDate:3}),Object.freeze(Object.defineProperties({},{Op:{value:Op},diff:{value:function diff(orig,dest){for(var aOpRef,objToString=Object.prototype.toString,origIsArray=orig instanceof Array,keys=[].concat(Object.keys(orig),Object.keys(dest)).sort().filter((function(val,i,arr){return 0===i||arr[i-1]!==val})),diffed={},keyIsAOpRef=function(key){return key===aOpRef},i=0,klen=keys.length;i<klen;++i){var key=keys[i],origP=orig[key],destP=dest[key];if(orig.hasOwnProperty(key))if(dest.hasOwnProperty(key)){if(origP===destP)continue;if(_typeof(origP)===_typeof(destP))if("function"==typeof origP)origP.toString()!==destP.toString()&&(diffed[key]=[Op.Copy,destP]);else if("object"!==_typeof(origP)||null===origP)diffed[key]=[Op.Copy,destP];else{var origPType=objToString.call(origP);if(origPType===objToString.call(destP))if(origP instanceof Date)Number(origP)!==Number(destP)&&(diffed[key]=[Op.Copy,clone(destP)]);else if(origP instanceof Map)diffed[key]=[Op.Copy,clone(destP)];else if(origP instanceof RegExp)origP.toString()!==destP.toString()&&(diffed[key]=[Op.Copy,clone(destP)]);else if(origP instanceof Set)diffed[key]=[Op.Copy,clone(destP)];else if("[object Object]"!==origPType)diffed[key]=[Op.Copy,clone(destP)];else{var recurse=diff(origP,destP);null!==recurse&&(diffed[key]=recurse)}else diffed[key]=[Op.Copy,clone(destP)]}else diffed[key]=[Op.Copy,"object"!==_typeof(destP)||null===destP?destP:clone(destP)]}else if(origIsArray&&Util.isNumeric(key)){var nKey=Number(key);if(!aOpRef){aOpRef="";do{aOpRef+="~"}while(keys.some(keyIsAOpRef));diffed[aOpRef]=[Op.SpliceArray,nKey,nKey]}nKey<diffed[aOpRef][1]&&(diffed[aOpRef][1]=nKey),nKey>diffed[aOpRef][2]&&(diffed[aOpRef][2]=nKey)}else diffed[key]=Op.Delete;else diffed[key]=[Op.Copy,"object"!==_typeof(destP)||null===destP?destP:clone(destP)]}return Object.keys(diffed).length>0?diffed:null}},patch:{value:function patch(orig,diffed){for(var keys=Object.keys(diffed||{}),patched=clone(orig),i=0,klen=keys.length;i<klen;++i){var key=keys[i],diffedP=diffed[key];if(diffedP===Op.Delete)delete patched[key];else if(diffedP instanceof Array)switch(diffedP[0]){case Op.SpliceArray:patched.splice(diffedP[1],diffedP[2]-diffedP[1]+1);break;case Op.Copy:patched[key]=clone(diffedP[1]);break;case Op.CopyDate:patched[key]=new Date(diffedP[1])}else patched[key]=patch(patched[key],diffedP)}return patched}}}))),Op,L10n=(_patternRe=/\{\w+\}/g,_hasPatternRe=new RegExp(_patternRe.source),Object.freeze(Object.defineProperties({},{init:{value:function(){strings&&Object.keys(strings).length>0&&Object.keys(l10nStrings).forEach((function(id){try{var value;switch(id){case"identity":value=strings.identity;break;case"aborting":value=strings.aborting;break;case"cancel":value=strings.cancel;break;case"close":value=strings.close;break;case"ok":value=strings.ok;break;case"errorTitle":value=strings.errors.title;break;case"errorNonexistentPassage":value=strings.errors.nonexistentPassage;break;case"errorSaveMissingData":value=strings.errors.saveMissingData;break;case"errorSaveIdMismatch":value=strings.errors.saveIdMismatch;break;case"warningDegraded":value=strings.warnings.degraded;break;case"debugViewTitle":value=strings.debugView.title;break;case"debugViewToggle":value=strings.debugView.toggle;break;case"uiBarToggle":value=strings.uiBar.toggle;break;case"uiBarBackward":value=strings.uiBar.backward;break;case"uiBarForward":value=strings.uiBar.forward;break;case"uiBarJumpto":value=strings.uiBar.jumpto;break;case"jumptoTitle":value=strings.jumpto.title;break;case"jumptoTurn":value=strings.jumpto.turn;break;case"jumptoUnavailable":value=strings.jumpto.unavailable;break;case"savesTitle":value=strings.saves.title;break;case"savesDisallowed":value=strings.saves.disallowed;break;case"savesIncapable":value=strings.saves.incapable;break;case"savesLabelAuto":value=strings.saves.labelAuto;break;case"savesLabelDelete":value=strings.saves.labelDelete;break;case"savesLabelExport":value=strings.saves.labelExport;break;case"savesLabelImport":value=strings.saves.labelImport;break;case"savesLabelLoad":value=strings.saves.labelLoad;break;case"savesLabelClear":value=strings.saves.labelClear;break;case"savesLabelSave":value=strings.saves.labelSave;break;case"savesLabelSlot":value=strings.saves.labelSlot;break;case"savesUnavailable":value=strings.saves.unavailable;break;case"savesUnknownDate":value=strings.saves.unknownDate;break;case"settingsTitle":value=strings.settings.title;break;case"settingsOff":value=strings.settings.off;break;case"settingsOn":value=strings.settings.on;break;case"settingsReset":value=strings.settings.reset;break;case"restartTitle":value=strings.restart.title;break;case"restartPrompt":value=strings.restart.prompt;break;case"shareTitle":value=strings.share.title;break;case"alertTitle":break;case"autoloadTitle":value=strings.autoload.title;break;case"autoloadCancel":value=strings.autoload.cancel;break;case"autoloadOk":value=strings.autoload.ok;break;case"autoloadPrompt":value=strings.autoload.prompt;break;case"macroBackText":value=strings.macros.back.text;break;case"macroReturnText":value=strings.macros.return.text}value&&(l10nStrings[id]=value.replace(/%\w+%/g,(function(pat){return"{".concat(pat.slice(1,-1),"}")})))}catch(ex){}}))}},get:{value:function(ids,overrides){if(!ids)return"";var selectedId,id=((Array.isArray(ids)?ids:[ids]).some((function(id){return!!l10nStrings.hasOwnProperty(id)&&(selectedId=id,!0)})),selectedId);if(!id)return"";for(var processed=l10nStrings[id],iteration=0;_hasPatternRe.test(processed);){if(++iteration>50)throw new Error("L10n.get exceeded maximum replacement iterations, probable infinite loop");_patternRe.lastIndex=0,processed=processed.replace(_patternRe,(function(pat){var subId=pat.slice(1,-1);return overrides&&overrides.hasOwnProperty(subId)?overrides[subId]:l10nStrings.hasOwnProperty(subId)?l10nStrings[subId]:void 0}))}return processed}}}))),_patternRe,_hasPatternRe,strings={errors:{},warnings:{},debugView:{},uiBar:{},jumpto:{},saves:{},settings:{},restart:{},share:{},autoload:{},macros:{back:{},return:{}}},l10nStrings={identity:"game",aborting:"Aborting",cancel:"Cancel",close:"Close",ok:"OK",errorTitle:"Error",errorToggle:"Toggle the error view",errorNonexistentPassage:'the passage "{passage}" does not exist',errorSaveDiskLoadFailed:"failed to load save file from disk",errorSaveMissingData:"save is missing required data. Either the loaded file is not a save or the save has become corrupted",errorSaveIdMismatch:"save is from the wrong {identity}",_warningIntroLacking:"Your browser either lacks or has disabled",_warningOutroDegraded:", so this {identity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.",warningNoWebStorage:"{_warningIntroLacking} the Web Storage API{_warningOutroDegraded}",warningDegraded:"{_warningIntroLacking} some of the capabilities required by this {identity}{_warningOutroDegraded}",debugBarToggle:"Toggle the debug bar",debugBarNoWatches:"— no watches set —",debugBarAddWatch:"Add watch",debugBarDeleteWatch:"Delete watch",debugBarWatchAll:"Watch all",debugBarWatchNone:"Delete all",debugBarLabelAdd:"Add",debugBarLabelWatch:"Watch",debugBarLabelTurn:"Turn",debugBarLabelViews:"Views",debugBarViewsToggle:"Toggle the debug views",debugBarWatchToggle:"Toggle the watch panel",uiBarToggle:"Toggle the UI bar",uiBarBackward:"Go backward within the {identity} history",uiBarForward:"Go forward within the {identity} history",uiBarJumpto:"Jump to a specific point within the {identity} history",jumptoTitle:"Jump To",jumptoTurn:"Turn",jumptoUnavailable:"No jump points currently available…",savesTitle:"Saves",savesDisallowed:"Saving has been disallowed on this passage.",savesIncapable:"{_warningIntroLacking} the capabilities required to support saves, so saves have been disabled for this session.",savesLabelAuto:"Autosave",savesLabelDelete:"Delete",savesLabelExport:"Save to Disk…",savesLabelImport:"Load from Disk…",savesLabelLoad:"Load",savesLabelClear:"Delete All",savesLabelSave:"Save",savesLabelSlot:"Slot",savesUnavailable:"No save slots found…",savesUnknownDate:"unknown",settingsTitle:"Settings",settingsOff:"Off",settingsOn:"On",settingsReset:"Reset to Defaults",restartTitle:"Restart",restartPrompt:"Are you sure that you want to restart? Unsaved progress will be lost.",shareTitle:"Share",alertTitle:"Alert",autoloadTitle:"Autoload",autoloadCancel:"Go to start",autoloadOk:"Load autosave",autoloadPrompt:"An autosave exists. Load it now or go to the start?",macroBackText:"Back",macroReturnText:"Return"},Config=(_debug=!1,_addVisitedLinkClass=!1,_cleanupWikifierOutput=!1,_loadDelay=0,_audioPauseOnFadeToZero=!0,_audioPreloadMetadata=!0,_historyControls=!0,_historyMaxStates=40,_macrosIfAssignmentError=!0,_macrosMaxLoopIterations=1e3,_macrosTypeSkipKey=" ",_macrosTypeVisitedPassages=!0,_passagesDisplayTitles=!1,_passagesNobr=!1,_savesId="untitled-story",_savesSlots=8,_savesTryDiskOnMobile=!0,_uiStowBarInitially=800,_uiUpdateStoryElements=!0,_errHistoryModeDeprecated="Config.history.mode has been deprecated and is no longer used by SugarCube, please remove it from your code",Object.freeze({get debug(){return _debug},set debug(value){_debug=Boolean(value)},get addVisitedLinkClass(){return _addVisitedLinkClass},set addVisitedLinkClass(value){_addVisitedLinkClass=Boolean(value)},get cleanupWikifierOutput(){return _cleanupWikifierOutput},set cleanupWikifierOutput(value){_cleanupWikifierOutput=Boolean(value)},get loadDelay(){return _loadDelay},set loadDelay(value){if(!Number.isSafeInteger(value)||value<0)throw new RangeError("Config.loadDelay must be a non-negative integer");_loadDelay=value},audio:Object.freeze({get pauseOnFadeToZero(){return _audioPauseOnFadeToZero},set pauseOnFadeToZero(value){_audioPauseOnFadeToZero=Boolean(value)},get preloadMetadata(){return _audioPreloadMetadata},set preloadMetadata(value){_audioPreloadMetadata=Boolean(value)}}),history:Object.freeze({get controls(){return _historyControls},set controls(value){var controls=Boolean(value);if(1===_historyMaxStates&&controls)throw new Error("Config.history.controls must be false when Config.history.maxStates is 1");_historyControls=controls},get maxStates(){return _historyMaxStates},set maxStates(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError("Config.history.maxStates must be a positive integer");_historyMaxStates=value,_historyControls&&1===value&&(_historyControls=!1)},get mode(){throw new Error(_errHistoryModeDeprecated)},set mode(_){throw new Error(_errHistoryModeDeprecated)},get tracking(){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")},set tracking(_){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")}}),macros:Object.freeze({get ifAssignmentError(){return _macrosIfAssignmentError},set ifAssignmentError(value){_macrosIfAssignmentError=Boolean(value)},get maxLoopIterations(){return _macrosMaxLoopIterations},set maxLoopIterations(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError("Config.macros.maxLoopIterations must be a positive integer");_macrosMaxLoopIterations=value},get typeSkipKey(){return _macrosTypeSkipKey},set typeSkipKey(value){_macrosTypeSkipKey=String(value)},get typeVisitedPassages(){return _macrosTypeVisitedPassages},set typeVisitedPassages(value){_macrosTypeVisitedPassages=Boolean(value)}}),navigation:Object.freeze({get override(){return _navigationOverride},set override(value){if(!(null==value||value instanceof Function))throw new TypeError("Config.navigation.override must be a function or null/undefined (received: ".concat(Util.getType(value),")"));_navigationOverride=value}}),passages:Object.freeze({get descriptions(){return _passagesDescriptions},set descriptions(value){if(null!=value){var valueType=Util.getType(value);if("boolean"!==valueType&&"Object"!==valueType&&"function"!==valueType)throw new TypeError("Config.passages.descriptions must be a boolean, object, function, or null/undefined (received: ".concat(valueType,")"))}_passagesDescriptions=value},get displayTitles(){return _passagesDisplayTitles},set displayTitles(value){_passagesDisplayTitles=Boolean(value)},get nobr(){return _passagesNobr},set nobr(value){_passagesNobr=Boolean(value)},get onProcess(){return _passagesOnProcess},set onProcess(value){if(null!=value){var valueType=Util.getType(value);if("function"!==valueType)throw new TypeError("Config.passages.onProcess must be a function or null/undefined (received: ".concat(valueType,")"))}_passagesOnProcess=value},get start(){return _passagesStart},set start(value){if(null!=value){var valueType=Util.getType(value);if("string"!==valueType)throw new TypeError("Config.passages.start must be a string or null/undefined (received: ".concat(valueType,")"))}_passagesStart=value},get transitionOut(){return _passagesTransitionOut},set transitionOut(value){if(null!=value){var valueType=Util.getType(value);if("string"!==valueType&&("number"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError("Config.passages.transitionOut must be a string, non-negative integer, or null/undefined (received: ".concat(valueType,")"))}_passagesTransitionOut=value}}),saves:Object.freeze({get autoload(){return _savesAutoload},set autoload(value){if(null!=value){var valueType=Util.getType(value);if("boolean"!==valueType&&"string"!==valueType&&"function"!==valueType)throw new TypeError("Config.saves.autoload must be a boolean, string, function, or null/undefined (received: ".concat(valueType,")"))}_savesAutoload=value},get autosave(){return _savesAutosave},set autosave(value){if(null!=value){var valueType=Util.getType(value);if("string"===valueType)return void(_savesAutosave=[value]);if("boolean"!==valueType&&("Array"!==valueType||!value.every((function(item){return"string"==typeof item})))&&"function"!==valueType)throw new TypeError("Config.saves.autosave must be a boolean, Array<string>, function, or null/undefined (received: ".concat(valueType).concat("Array"===valueType?"<any>":"",")"))}_savesAutosave=value},get id(){return _savesId},set id(value){if("string"!=typeof value||""===value)throw new TypeError("Config.saves.id must be a non-empty string (received: ".concat(Util.getType(value),")"));_savesId=value},get isAllowed(){return _savesIsAllowed},set isAllowed(value){if(!(null==value||value instanceof Function))throw new TypeError("Config.saves.isAllowed must be a function or null/undefined (received: ".concat(Util.getType(value),")"));_savesIsAllowed=value},get slots(){return _savesSlots},set slots(value){if(!Number.isSafeInteger(value)||value<0)throw new TypeError("Config.saves.slots must be a non-negative integer (received: ".concat(Util.getType(value),")"));_savesSlots=value},get tryDiskOnMobile(){return _savesTryDiskOnMobile},set tryDiskOnMobile(value){_savesTryDiskOnMobile=Boolean(value)},get version(){return _savesVersion},set version(value){_savesVersion=value},get onLoad(){throw new Error("Config.saves.onLoad has been deprecated, use the Save.onLoad API instead")},set onLoad(value){console.warn("Config.saves.onLoad has been deprecated, use the Save.onLoad API instead"),Save.onLoad.add(value)},get onSave(){throw new Error("Config.saves.onSave has been deprecated, use the Save.onSave API instead")},set onSave(value){console.warn("Config.saves.onSave has been deprecated, use the Save.onSave API instead"),Save.onSave.add(value)}}),ui:Object.freeze({get stowBarInitially(){return _uiStowBarInitially},set stowBarInitially(value){var valueType=Util.getType(value);if("boolean"!==valueType&&("number"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError("Config.ui.stowBarInitially must be a boolean or non-negative integer (received: ".concat(valueType,")"));_uiStowBarInitially=value},get updateStoryElements(){return _uiUpdateStoryElements},set updateStoryElements(value){_uiUpdateStoryElements=Boolean(value)}})})),_navigationOverride,_passagesDescriptions,_passagesStart,_passagesOnProcess,_passagesTransitionOut,_savesAutoload,_savesAutosave,_savesIsAllowed,_savesVersion,_debug,_addVisitedLinkClass,_cleanupWikifierOutput,_loadDelay,_audioPauseOnFadeToZero,_audioPreloadMetadata,_historyControls,_historyMaxStates,_macrosIfAssignmentError,_macrosMaxLoopIterations,_macrosTypeSkipKey,_macrosTypeVisitedPassages,_passagesDisplayTitles,_passagesNobr,_savesId,_savesSlots,_savesTryDiskOnMobile,_uiStowBarInitially,_uiUpdateStoryElements,_errHistoryModeDeprecated,SimpleAudio=function(){var _hasPromise,_gestureEventNames=Object.freeze(["click","contextmenu","dblclick","keyup","mouseup","pointerup","touchend"]),_specialIds=Object.freeze([":not",":all",":looped",":muted",":paused",":playing"]),_formatSpecRe=/^([\w-]+)\s*\|\s*(\S.*)$/,_badIdRe=/[:\s]/,_tracks=new Map,_groups=new Map,_lists=new Map,_subscribers=new Map,_masterRate=1,_masterVolume=1,_masterMute=!1,_masterMuteOnHidden=!1,_playReturnsPromise=(_hasPromise=null,function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,Has.audio)try{var audio=document.createElement("audio");audio.muted=!0;var value=audio.play();value.catch((function(){})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise}),AudioTrack=function(){function AudioTrack(obj){if(_classCallCheck(this,AudioTrack),obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioTrack))throw new Error("sources parameter must be either an array, of URIs or source objects, or an AudioTrack instance");this._copy(obj)}}return _createClass(AudioTrack,[{key:"_create",value:function(sourceList){var dataUriRe=/^data:\s*audio\/(?:x-)?([^;,]+)\s*[;,]/i,extRe=/\.([^./\\]+)$/,formats=AudioTrack.formats,usedSources=[],audio=document.createElement("audio");audio.preload="none",sourceList.forEach((function(src){var srcUri=null;switch(_typeof(src)){case"string":var match;if("data:"===src.slice(0,5)){if(null===(match=dataUriRe.exec(src)))throw new Error("source data URI missing media type")}else if(null===(match=extRe.exec(Util.parseUrl(src).pathname)))throw new Error("source URL missing file extension");formats[match[1]]&&(srcUri=src);break;case"object":if(null===src)throw new Error("source object cannot be null");if(!src.hasOwnProperty("src"))throw new Error('source object missing required "src" property');if(!src.hasOwnProperty("format"))throw new Error('source object missing required "format" property');formats[src.format]&&(srcUri=src.src);break;default:throw new Error("invalid source value (type: ".concat(_typeof(src),")"))}if(null!==srcUri){var source=document.createElement("source");source.src=srcUri,audio.appendChild(source),usedSources.push(srcUri)}})),audio.hasChildNodes()&&Config.audio.preloadMetadata&&(audio.preload="metadata"),this._finalize(audio,usedSources,clone(sourceList))}},{key:"_copy",value:function(obj){this._finalize(obj.audio.cloneNode(!0),clone(obj.sources),clone(obj.originals))}},{key:"_finalize",value:function(audio,sources,originals){var _this3=this;Object.defineProperties(this,{audio:{configurable:!0,value:audio},sources:{value:Object.freeze(sources)},originals:{value:Object.freeze(originals)},_error:{writable:!0,value:!1},_faderId:{writable:!0,value:null},_mute:{writable:!0,value:!1},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1}}),jQuery(this.audio).on("loadstart.AudioTrack",(function(){return _this3._error=!1})).on("error.AudioTrack",(function(){return _this3._error=!0})).find("source:last-of-type").on("error.AudioTrack",(function(){return _this3._trigger("error")})),function(id,callback){if("function"!=typeof callback)throw new Error("callback parameter must be a function");_subscribers.set(id,callback)}(this,(function(mesg){if(_this3.audio)switch(mesg){case"loadwithscreen":if(_this3.hasSource()){var lockId=LoadScreen.lock();_this3.one("canplaythrough.AudioTrack_loadwithscreen error.AudioTrack_loadwithscreen",(function(){jQuery(this).off(".AudioTrack_loadwithscreen"),LoadScreen.unlock(lockId)})).load()}break;case"load":_this3.load();break;case"mute":_this3._updateAudioMute();break;case"rate":_this3._updateAudioRate();break;case"stop":_this3.stop();break;case"volume":_this3._updateAudioVolume();break;case"unload":_this3.unload()}else unsubscribe(_this3)})),this._updateAudioMute(),this._updateAudioRate(),this._updateAudioVolume()}},{key:"_trigger",value:function(eventName){jQuery(this.audio).triggerHandler(eventName)}},{key:"_destroy",value:function(){unsubscribe(this),this.audio&&(jQuery(this.audio).off(),this.unload(),this._error=!0,delete this.audio)}},{key:"clone",value:function(){return new AudioTrack(this)}},{key:"load",value:function(){var _this4=this;if(this.fadeStop(),this.audio.pause(),!this.audio.hasChildNodes()){if(0===this.sources.length)return;this.sources.forEach((function(srcUri){var source=document.createElement("source");source.src=srcUri,_this4.audio.appendChild(source)}))}"auto"!==this.audio.preload&&(this.audio.preload="auto"),this.isLoading()||this.audio.load()}},{key:"unload",value:function(){this.fadeStop(),this.stop();var audio=this.audio;for(audio.preload="none";audio.hasChildNodes();)audio.removeChild(audio.firstChild);audio.load()}},{key:"play",value:function(){var _this5=this;if(!this.hasSource())return Promise.reject(new Error("none of the candidate sources were acceptable"));if(this.isUnloaded())return Promise.reject(new Error("no sources are loaded"));if(this.isFailed())return Promise.reject(new Error("failed to load any of the sources"));"auto"!==this.audio.preload&&(this.audio.preload="auto");var namespace=".AudioTrack_play";return _playReturnsPromise()?this.audio.play():new Promise((function(resolve,reject){_this5.isPlaying()?resolve():(jQuery(_this5.audio).off(namespace).one("error".concat(namespace," playing").concat(namespace," timeupdate").concat(namespace),(function(ev){jQuery(_this5).off(namespace),"error"===ev.type?reject(new Error("unknown audio play error")):resolve()})),_this5.audio.play())}))}},{key:"playWhenAllowed",value:function(){var _this6=this;this.play().catch((function(){var gestures=_gestureEventNames.map((function(name){return"".concat(name,".AudioTrack_playWhenAllowed")})).join(" ");jQuery(document).one(gestures,(function(){jQuery(document).off(".AudioTrack_playWhenAllowed"),_this6.audio.play()}))}))}},{key:"pause",value:function(){this.audio.pause()}},{key:"stop",value:function(){this.audio.pause(),this.time(0),this._trigger(":stopped")}},{key:"fade",value:function(duration,toVol,fromVol){var _this7=this;if("number"!=typeof duration)throw new TypeError("duration parameter must be a number");if("number"!=typeof toVol)throw new TypeError("toVolume parameter must be a number");if(null!=fromVol&&"number"!=typeof fromVol)throw new TypeError("fromVolume parameter must be a number");if(!this.hasSource())return Promise.reject(new Error("none of the candidate sources were acceptable"));if(this.isUnloaded())return Promise.reject(new Error("no sources are loaded"));if(this.isFailed())return Promise.reject(new Error("failed to load any of the sources"));this.fadeStop();var from=Math.clamp(null==fromVol?this.volume():fromVol,0,1),to=Math.clamp(toVol,0,1);return from!==to?(this.volume(from),jQuery(this.audio).off("timeupdate.AudioTrack_fade").one("timeupdate.AudioTrack_fade",(function(){var min,max;from<to?(min=from,max=to):(min=to,max=from);var time=Math.max(duration,1),delta=(to-from)/(time/.025);_this7._trigger(":fading"),_this7._faderId=setInterval((function(){_this7.isPlaying()?(_this7.volume(Math.clamp(_this7.volume()+delta,min,max)),Config.audio.pauseOnFadeToZero&&0===_this7.volume()&&_this7.pause(),_this7.volume()===to&&(_this7.fadeStop(),_this7._trigger(":faded"))):_this7.fadeStop()}),25)})),this.play()):void 0}},{key:"fadeIn",value:function(duration,fromVol){return this.fade(duration,1,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){return this.fade(duration,0,fromVol)}},{key:"fadeStop",value:function(){null!==this._faderId&&(clearInterval(this._faderId),this._faderId=null)}},{key:"loop",value:function(_loop){return null==_loop?this.audio.loop:(this.audio.loop=!!_loop,this)}},{key:"mute",value:function(_mute){return null==_mute?this._mute:(this._mute=!!_mute,this._updateAudioMute(),this)}},{key:"_updateAudioMute",value:function(){this.audio.muted=this._mute||_masterMute}},{key:"rate",value:function(_rate){if(null==_rate)return this._rate;if("number"!=typeof _rate)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(_rate,.2,5),this._updateAudioRate(),this}},{key:"_updateAudioRate",value:function(){this.audio.playbackRate=Math.clamp(this._rate*_masterRate,.2,5)}},{key:"time",value:function(_time){var _this8=this;if(null==_time)return this.audio.currentTime;if("number"!=typeof _time)throw new TypeError("time parameter must be a number");return this.hasMetadata()?this.audio.currentTime=_time:jQuery(this.audio).off("loadedmetadata.AudioTrack_time").one("loadedmetadata.AudioTrack_time",(function(){return _this8.audio.currentTime=_time})),this}},{key:"volume",value:function(_volume){if(null==_volume)return this._volume;if("number"!=typeof _volume)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(_volume,0,1),this._updateAudioVolume(),this}},{key:"_updateAudioVolume",value:function(){this.audio.volume=Math.clamp(this._volume*_masterVolume,0,1)}},{key:"duration",value:function(){return this.audio.duration}},{key:"remaining",value:function(){return this.audio.duration-this.audio.currentTime}},{key:"isFailed",value:function(){return this._error}},{key:"isLoading",value:function(){return this.audio.networkState===HTMLMediaElement.NETWORK_LOADING}},{key:"isUnloaded",value:function(){return!this.audio.hasChildNodes()}},{key:"isUnavailable",value:function(){return!this.hasSource()||this.isUnloaded()||this.isFailed()}},{key:"isPlaying",value:function(){return!this.audio.paused&&this.hasSomeData()}},{key:"isPaused",value:function(){return this.audio.paused&&(this.audio.duration===1/0||this.audio.currentTime>0)&&!this.audio.ended}},{key:"isStopped",value:function(){return this.audio.paused&&0===this.audio.currentTime}},{key:"isEnded",value:function(){return this.audio.ended}},{key:"isFading",value:function(){return null!==this._faderId}},{key:"isSeeking",value:function(){return this.audio.seeking}},{key:"hasSource",value:function(){return this.sources.length>0}},{key:"hasNoData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_NOTHING}},{key:"hasMetadata",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_METADATA}},{key:"hasSomeData",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA}},{key:"hasData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA}},{key:"on",value:function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];return jQuery.fn.on.apply(jQuery(this.audio),args),this}},{key:"one",value:function(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];return jQuery.fn.one.apply(jQuery(this.audio),args),this}},{key:"off",value:function(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++)args[_key7]=arguments[_key7];return jQuery.fn.off.apply(jQuery(this.audio),args),this}}]),AudioTrack}();Object.defineProperties(AudioTrack,{formats:{value:function(){var audio=document.createElement("audio"),types=new Map;function canPlay(mimeType){return types.has(mimeType)||types.set(mimeType,""!==audio.canPlayType(mimeType).replace(/^no$/i,"")),types.get(mimeType)}return Object.assign(Object.create(null),{aac:canPlay("audio/aac"),caf:canPlay("audio/x-caf")||canPlay("audio/caf"),flac:canPlay("audio/x-flac")||canPlay("audio/flac"),mp3:canPlay('audio/mpeg; codecs="mp3"')||canPlay("audio/mpeg")||canPlay("audio/mp3")||canPlay("audio/mpa"),mpeg:canPlay("audio/mpeg"),m4a:canPlay("audio/x-m4a")||canPlay("audio/m4a")||canPlay("audio/aac"),mp4:canPlay("audio/x-mp4")||canPlay("audio/mp4")||canPlay("audio/aac"),ogg:canPlay("audio/ogg"),oga:canPlay("audio/ogg"),opus:canPlay('audio/ogg; codecs="opus"')||canPlay("audio/opus"),wav:canPlay('audio/wave; codecs="1"')||canPlay('audio/wav; codecs="1"')||canPlay("audio/wave")||canPlay("audio/wav"),wave:canPlay('audio/wave; codecs="1"')||canPlay('audio/wav; codecs="1"')||canPlay("audio/wave")||canPlay("audio/wav"),weba:canPlay("audio/webm"),webm:canPlay("audio/webm")})}()}});var AudioList=function(){function AudioList(obj){if(_classCallCheck(this,AudioList),obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioList))throw new Error("tracks parameter must be either an array, of track objects, or an AudioTrack instance");this._copy(obj)}}return _createClass(AudioList,[{key:"_create",value:function(trackList){var _this9=this;this._finalize(trackList.map((function(trackObj){if("object"!==_typeof(trackObj))throw new Error("tracks parameter array members must be objects");var own,rate,track,volume;if(trackObj instanceof AudioTrack)own=!0,rate=trackObj.rate(),track=trackObj.clone(),volume=trackObj.volume();else{if(!trackObj.hasOwnProperty("track"))throw new Error('track object missing required "track" property');if(!(trackObj.track instanceof AudioTrack))throw new Error('track object\'s "track" property must be an AudioTrack object');own=trackObj.hasOwnProperty("own")&&trackObj.own,rate=trackObj.hasOwnProperty("rate")?trackObj.rate:trackObj.track.rate(),track=trackObj.track,volume=trackObj.hasOwnProperty("volume")?trackObj.volume:trackObj.track.volume()}return track.stop(),track.loop(!1),track.mute(!1),track.rate(rate),track.volume(volume),track.on("ended.AudioList",(function(){return _this9._onEnd()})),{own:own,track:track,volume:volume,rate:rate}})))}},{key:"_copy",value:function(obj){this._finalize(clone(obj.tracks))}},{key:"_finalize",value:function(tracks){Object.defineProperties(this,{tracks:{configurable:!0,value:Object.freeze(tracks)},queue:{configurable:!0,value:[]},current:{writable:!0,value:null},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1},_mute:{writable:!0,value:!1},_loop:{writable:!0,value:!1},_shuffle:{writable:!0,value:!1}})}},{key:"_destroy",value:function(){this.stop(),this.tracks.filter((function(trackObj){return trackObj.own})).forEach((function(trackObj){return trackObj.track._destroy()})),delete this.tracks,delete this.queue}},{key:"load",value:function(){this.tracks.forEach((function(trackObj){return trackObj.track.load()}))}},{key:"unload",value:function(){this.stop(),this.tracks.forEach((function(trackObj){return trackObj.track.unload()}))}},{key:"play",value:function(){return null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||(0===this.queue.length&&this._fillQueue(),this._next())?this.current.track.play():Promise.reject(new Error("no tracks were available"))}},{key:"playWhenAllowed",value:function(){var _this10=this;this.play().catch((function(){var gestures=_gestureEventNames.map((function(name){return"".concat(name,".AudioList_playWhenAllowed")})).join(" ");jQuery(document).one(gestures,(function(){jQuery(document).off(".AudioList_playWhenAllowed"),_this10.play()}))}))}},{key:"pause",value:function(){null!==this.current&&this.current.track.pause()}},{key:"stop",value:function(){null!==this.current&&(this.current.track.stop(),this.current=null),this._drainQueue()}},{key:"skip",value:function(){this._next()?this.current.track.play():this._loop&&this.play()}},{key:"fade",value:function(duration,toVol,fromVol){if("number"!=typeof duration)throw new TypeError("duration parameter must be a number");if("number"!=typeof toVol)throw new TypeError("toVolume parameter must be a number");if(null!=fromVol&&"number"!=typeof fromVol)throw new TypeError("fromVolume parameter must be a number");if(0===this.queue.length&&this._fillQueue(),null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||this._next()){var adjFromVol,adjToVol=Math.clamp(toVol,0,1)*this.current.volume;return null!=fromVol&&(adjFromVol=Math.clamp(fromVol,0,1)*this.current.volume),this._volume=toVol,this.current.track.fade(duration,adjToVol,adjFromVol)}}},{key:"fadeIn",value:function(duration,fromVol){return this.fade(duration,1,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){return this.fade(duration,0,fromVol)}},{key:"fadeStop",value:function(){null!==this.current&&this.current.track.fadeStop()}},{key:"loop",value:function(_loop2){return null==_loop2?this._loop:(this._loop=!!_loop2,this)}},{key:"mute",value:function(_mute2){return null==_mute2?this._mute:(this._mute=!!_mute2,null!==this.current&&this.current.track.mute(this._mute),this)}},{key:"rate",value:function(_rate2){if(null==_rate2)return this._rate;if("number"!=typeof _rate2)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(_rate2,.2,5),null!==this.current&&this.current.track.rate(this._rate*this.current.rate),this}},{key:"shuffle",value:function(_shuffle){var _this11=this;if(null==_shuffle)return this._shuffle;if(this._shuffle=!!_shuffle,this.queue.length>0&&(this._fillQueue(),!this._shuffle&&null!==this.current&&this.queue.length>1)){var _this$queue,firstIdx=this.queue.findIndex((function(trackObj){return trackObj===_this11.current}));if(-1!==firstIdx)(_this$queue=this.queue).push.apply(_this$queue,_toConsumableArray(this.queue.splice(0,firstIdx+1)))}return this}},{key:"volume",value:function(_volume2){if(null==_volume2)return this._volume;if("number"!=typeof _volume2)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(_volume2,0,1),null!==this.current&&this.current.track.volume(this._volume*this.current.volume),this}},{key:"duration",value:function(){if(arguments.length>0)throw new Error("duration takes no parameters");return this.tracks.map((function(trackObj){return trackObj.track.duration()})).reduce((function(prev,cur){return prev+cur}),0)}},{key:"remaining",value:function(){if(arguments.length>0)throw new Error("remaining takes no parameters");var remainingTime=this.queue.map((function(trackObj){return trackObj.track.duration()})).reduce((function(prev,cur){return prev+cur}),0);return null!==this.current&&(remainingTime+=this.current.track.remaining()),remainingTime}},{key:"time",value:function(){if(arguments.length>0)throw new Error("time takes no parameters");return this.duration()-this.remaining()}},{key:"isPlaying",value:function(){return null!==this.current&&this.current.track.isPlaying()}},{key:"isPaused",value:function(){return null===this.current||this.current.track.isPaused()}},{key:"isStopped",value:function(){return 0===this.queue.length&&null===this.current}},{key:"isEnded",value:function(){return 0===this.queue.length&&(null===this.current||this.current.track.isEnded())}},{key:"isFading",value:function(){return null!==this.current&&this.current.track.isFading()}},{key:"_next",value:function(){var nextTrack;for(null!==this.current&&(this.current.track.stop(),this.current=null);nextTrack=this.queue.shift();)if(!nextTrack.track.isUnavailable()){this.current=nextTrack;break}return null!==this.current&&(this.current.track.mute(this._mute),this.current.track.rate(this._rate*this.current.rate),this.current.track.volume(this._volume*this.current.volume),this.current.track.loop(!1),!0)}},{key:"_onEnd",value:function(){if(0===this.queue.length){if(!this._loop)return;this._fillQueue()}this._next()&&this.current.track.play()}},{key:"_drainQueue",value:function(){this.queue.splice(0)}},{key:"_fillQueue",value:function(){var _this$queue2;this._drainQueue(),(_this$queue2=this.queue).push.apply(_this$queue2,_toConsumableArray(this.tracks.filter((function(trackObj){return!trackObj.track.isUnavailable()})))),0!==this.queue.length&&this._shuffle&&(this.queue.shuffle(),this.queue.length>1&&this.queue[0]===this.current&&this.queue.push(this.queue.shift()))}}]),AudioList}(),AudioRunner=function(){function AudioRunner(list){if(_classCallCheck(this,AudioRunner),!(list instanceof Set||list instanceof AudioRunner))throw new TypeError("list parameter must be a Set or a AudioRunner instance");Object.defineProperties(this,{trackIds:{value:new Set(list instanceof AudioRunner?list.trackIds:list)}})}return _createClass(AudioRunner,[{key:"load",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.load)}},{key:"unload",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.unload)}},{key:"play",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.play)}},{key:"playWhenAllowed",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.playWhenAllowed)}},{key:"pause",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.pause)}},{key:"stop",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.stop)}},{key:"fade",value:function(duration,toVol,fromVol){if(null==duration||null==toVol)throw new Error("fade requires parameters");AudioRunner._run(this.trackIds,AudioTrack.prototype.fade,duration,toVol,fromVol)}},{key:"fadeIn",value:function(duration,fromVol){if(null==duration)throw new Error("fadeIn requires a parameter");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeIn,duration,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){if(null==duration)throw new Error("fadeOut requires a parameter");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeOut,duration,fromVol)}},{key:"fadeStop",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeStop)}},{key:"loop",value:function(_loop3){if(null==_loop3)throw new Error("loop requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.loop,_loop3),this}},{key:"mute",value:function(_mute3){if(null==_mute3)throw new Error("mute requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.mute,_mute3),this}},{key:"rate",value:function(_rate3){if(null==_rate3)throw new Error("rate requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.rate,_rate3),this}},{key:"time",value:function(_time2){if(null==_time2)throw new Error("time requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.time,_time2),this}},{key:"volume",value:function(_volume3){if(null==_volume3)throw new Error("volume requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.volume,_volume3),this}},{key:"on",value:function(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++)args[_key8]=arguments[_key8];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.on].concat(args)),this}},{key:"one",value:function(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++)args[_key9]=arguments[_key9];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.one].concat(args)),this}},{key:"off",value:function(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++)args[_key10]=arguments[_key10];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.off].concat(args)),this}}],[{key:"_run",value:function(ids,fn){for(var _len11=arguments.length,args=new Array(_len11>2?_len11-2:0),_key11=2;_key11<_len11;_key11++)args[_key11-2]=arguments[_key11];ids.forEach((function(id){var track=_tracks.get(id);track&&fn.apply(track,args)}))}}]),AudioRunner}();var _runnerParseSelector=function(){var notWsRe=/\S/g,parenRe=/[()]/g;function processNegation(str,startPos){var match;if(notWsRe.lastIndex=startPos,null===(match=notWsRe.exec(str))||"("!==match[0])throw new Error('invalid ":not()" syntax: missing parentheticals');parenRe.lastIndex=notWsRe.lastIndex;for(var start=notWsRe.lastIndex,result={str:"",nextMatch:-1},depth=1;null!==(match=parenRe.exec(str));)if("("===match[0]?++depth:--depth,depth<1){result.nextMatch=parenRe.lastIndex,result.str=str.slice(start,result.nextMatch-1);break}return result}return function parseSelector(idArg){for(var match,ids=[],idRe=/:?[^\s:()]+/g;null!==(match=idRe.exec(idArg));){var id=match[0];if(":not"===id){if(0===ids.length)throw new Error('invalid negation: no group ID preceded ":not()"');var parent=ids[ids.length-1];if(":"!==parent.id[0])throw new Error('invalid negation of track "'.concat(parent.id,'": only groups may be negated with ":not()"'));var negation=processNegation(idArg,idRe.lastIndex);if(-1===negation.nextMatch)throw new Error('unknown error parsing ":not()"');idRe.lastIndex=negation.nextMatch,parent.not=parseSelector(negation.str)}else ids.push({id:id})}return ids}}();function masterMute(mute){if(null==mute)return _masterMute;publish("mute",_masterMute=!!mute)}function unsubscribe(id){_subscribers.delete(id)}function publish(mesg,data){_subscribers.forEach((function(fn){return fn(mesg,data)}))}function _newTrack(sources){return new AudioTrack(sources.map((function(source){if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);if(passage.tags.includes("Twine.audio"))return passage.text.trim()}var match=_formatSpecRe.exec(source);return null===match?source:{format:match[1],src:match[2]}})))}return Object.freeze(Object.defineProperties({},{tracks:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("track ID"),arguments.length<2&&errors.push("sources"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='track ID "'.concat(id,'"');if(_badIdRe.test(id))throw new Error("invalid ".concat(what,": track IDs must not contain colons or whitespace"));var track,sources=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{track=_newTrack(sources)}catch(ex){throw new Error("".concat(what,": error during track initialization: ").concat(ex.message))}if(Config.debug&&!track.hasSource())throw new Error("".concat(what,": no supported audio sources found"));_tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.set(id,track)}},delete:{value:function(id){return _tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.delete(id)}},clear:{value:function(){_tracks.forEach((function(track){return track._destroy()})),_tracks.clear()}},has:{value:function(id){return _tracks.has(id)}},get:{value:function(id){return _tracks.get(id)||null}}}))},groups:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("group ID"),arguments.length<2&&errors.push("track IDs"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='group ID "'.concat(id,'"');if(":"!==id[0]||_badIdRe.test(id.slice(1)))throw new Error("invalid ".concat(what,": group IDs must start with a colon and must not contain colons or whitespace"));if(_specialIds.includes(id))throw new Error("cannot clobber special ".concat(what));var group,trackIds=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{group=new Set(trackIds.map((function(trackId){if(!_tracks.has(trackId))throw new Error('track "'.concat(trackId,'" does not exist'));return trackId})))}catch(ex){throw new Error("".concat(what,": error during group initialization: ").concat(ex.message))}_groups.set(id,Object.freeze(Array.from(group)))}},delete:{value:function(id){return _groups.delete(id)}},clear:{value:function(){_groups.clear()}},has:{value:function(id){return _groups.has(id)}},get:{value:function(id){return _groups.get(id)||null}}}))},lists:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("list ID"),arguments.length<2&&errors.push("track IDs"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='list ID "'.concat(id,'"');if(_badIdRe.test(id))return this.error("invalid ".concat(what,": list IDs must not contain colons or whitespace"));var list,descriptors=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{list=new AudioList(descriptors.map((function(desc){if(null===desc)throw new Error("track descriptor must be a string or object (type: null)");switch(_typeof(desc)){case"string":desc={id:desc};break;case"object":if(!desc.hasOwnProperty("id")&&!desc.hasOwnProperty("sources"))throw new Error('track descriptor must contain one of either an "id" or a "sources" property');if(desc.hasOwnProperty("id")&&desc.hasOwnProperty("sources"))throw new Error('track descriptor must contain either an "id" or a "sources" property, not both');break;default:throw new Error("track descriptor must be a string or object (type: ".concat(_typeof(desc),")"))}var own,track,volume;if(desc.hasOwnProperty("id")){if("string"!=typeof desc.id)throw new Error('"id" property must be a string');if(!_tracks.has(desc.id))throw new Error('track "'.concat(desc.id,'" does not exist'));track=_tracks.get(desc.id)}else if(desc.hasOwnProperty("sources")){if(!Array.isArray(desc.sources)||0===desc.sources.length)throw new Error('"sources" property must be a non-empty array');if(desc.hasOwnProperty("own"))throw new Error('"own" property is not allowed with the "sources" property');try{track=_newTrack(desc.sources),own=!0}catch(ex){throw new Error("error during track initialization: ".concat(ex.message))}if(Config.debug&&!track.hasSource())throw new Error("no supported audio sources found")}if(desc.hasOwnProperty("own")){if("boolean"!=typeof desc.own)throw new Error('"own" property must be a boolean');(own=desc.own)&&(track=track.clone())}if(desc.hasOwnProperty("volume")){if("number"!=typeof desc.volume||Number.isNaN(desc.volume)||!Number.isFinite(desc.volume)||desc.volume<0)throw new Error('"volume" property must be a non-negative finite number');volume=desc.volume}return{own:null!=own&&own,track:track,volume:null!=volume?volume:track.volume()}})))}catch(ex){throw new Error("".concat(what,": error during playlist initialization: ").concat(ex.message))}_lists.has(id)&&_lists.get(id)._destroy(),_lists.set(id,list)}},delete:{value:function(id){return _lists.has(id)&&_lists.get(id)._destroy(),_lists.delete(id)}},clear:{value:function(){_lists.forEach((function(list){return list._destroy()})),_lists.clear()}},has:{value:function(id){return _lists.has(id)}},get:{value:function(id){return _lists.get(id)||null}}}))},select:{value:function(){if(0===arguments.length)throw new Error("no track selector specified");var selector=String(arguments[0]).trim(),trackIds=new Set;try{var renderIds=function renderIds(idObj){var ids,id=idObj.id;switch(id){case":all":ids=allIds;break;case":looped":ids=allIds.filter((function(id){return _tracks.get(id).loop()}));break;case":muted":ids=allIds.filter((function(id){return _tracks.get(id).mute()}));break;case":paused":ids=allIds.filter((function(id){return _tracks.get(id).isPaused()}));break;case":playing":ids=allIds.filter((function(id){return _tracks.get(id).isPlaying()}));break;default:ids=":"===id[0]?_groups.get(id):[id]}if(idObj.hasOwnProperty("not")){var negated=idObj.not.map((function(idObj){return renderIds(idObj)})).flat(1/0);ids=ids.filter((function(id){return!negated.includes(id)}))}return ids},allIds=Array.from(_tracks.keys());_runnerParseSelector(selector).forEach((function(idObj){return renderIds(idObj).forEach((function(id){if(!_tracks.has(id))throw new Error('track "'.concat(id,'" does not exist'));trackIds.add(id)}))}))}catch(ex){throw new Error("error during runner initialization: ".concat(ex.message))}return new AudioRunner(trackIds)}},load:{value:function(){publish("load")}},loadWithScreen:{value:function(){publish("loadwithscreen")}},mute:{value:masterMute},muteOnHidden:{value:function(mute){if(!Visibility.isEnabled())return!1;if(null==mute)return _masterMuteOnHidden;var namespace=".SimpleAudio_masterMuteOnHidden";if(_masterMuteOnHidden=!!mute){var visibilityChange="".concat(Visibility.changeEvent).concat(namespace);jQuery(document).off(namespace).on(visibilityChange,(function(){return masterMute(Visibility.isHidden())})),Visibility.isHidden()&&masterMute(!0)}else jQuery(document).off(namespace)}},rate:{value:function(rate){if(null==rate)return _masterRate;if("number"!=typeof rate||Number.isNaN(rate)||!Number.isFinite(rate))throw new Error("rate must be a finite number");publish("rate",_masterRate=Math.clamp(rate,.2,5))}},stop:{value:function(){publish("stop")}},unload:{value:function(){publish("unload")}},volume:{value:function(volume){if(null==volume)return _masterVolume;if("number"!=typeof volume||Number.isNaN(volume)||!Number.isFinite(volume))throw new Error("volume must be a finite number");publish("volume",_masterVolume=Math.clamp(volume,0,1))}}}))}(),State=function(){var _history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null,_tempVariables={};function stateMarshal(noDelta){var stateObj={index:_activeIndex};return noDelta?stateObj.history=clone(_history):stateObj.delta=historyDeltaEncode(_history),_expired.length>0&&(stateObj.expired=_toConsumableArray(_expired)),null!==_prng&&(stateObj.seed=_prng.seed),stateObj}function stateUnmarshal(stateObj,noDelta){if(null==stateObj)throw new Error("state object is null or undefined");if(!stateObj.hasOwnProperty(noDelta?"history":"delta")||0===stateObj[noDelta?"history":"delta"].length)throw new Error("state object has no history or history is empty");if(!stateObj.hasOwnProperty("index"))throw new Error("state object has no index");if(null!==_prng&&!stateObj.hasOwnProperty("seed"))throw new Error("state object has no seed, but PRNG is enabled");if(null===_prng&&stateObj.hasOwnProperty("seed"))throw new Error("state object has seed, but PRNG is disabled");_history=noDelta?clone(stateObj.history):historyDeltaDecode(stateObj.delta),_activeIndex=stateObj.index,_expired=stateObj.hasOwnProperty("expired")?_toConsumableArray(stateObj.expired):[],stateObj.hasOwnProperty("seed")&&(_prng.seed=stateObj.seed),momentActivate(_activeIndex)}function momentCreate(title,variables){return{title:null==title?"":String(title),variables:null==variables?{}:clone(variables)}}function momentActivate(moment){if(null==moment)throw new Error("moment activation attempted with null or undefined");switch(_typeof(moment)){case"object":_active=clone(moment);break;case"number":if(historyIsEmpty())throw new Error("moment activation attempted with index on empty history");if(moment<0||moment>=historySize())throw new RangeError("moment activation attempted with out-of-bounds index; need [0, ".concat(historySize()-1,"], got ").concat(moment));_active=clone(_history[moment]);break;default:throw new TypeError('moment activation attempted with a "'.concat(_typeof(moment),'"; must be an object or valid history stack index'))}return null!==_prng&&(_prng=PRNGWrapper.unmarshal({seed:_prng.seed,pull:_active.pull})),session.set("state",stateMarshal()),jQuery.event.trigger(":historyupdate"),_active}function historyLength(){return _activeIndex+1}function historySize(){return _history.length}function historyIsEmpty(){return 0===_history.length}function historyTop(){return _history.length>0?_history[_history.length-1]:null}function historyGoTo(index){return!(null==index||index<0||index>=historySize()||index===_activeIndex)&&(momentActivate(_activeIndex=index),!0)}function historyDeltaEncode(historyArr){if(!Array.isArray(historyArr))return null;if(0===historyArr.length)return[];for(var delta=[historyArr[0]],i=1,iend=historyArr.length;i<iend;++i)delta.push(Diff.diff(historyArr[i-1],historyArr[i]));return delta}function historyDeltaDecode(delta){if(!Array.isArray(delta))return null;if(0===delta.length)return[];for(var historyArr=[clone(delta[0])],i=1,iend=delta.length;i<iend;++i)historyArr.push(Diff.patch(historyArr[i-1],delta[i]));return historyArr}function prngInit(seed,useEntropy){var scriptSection;if(!historyIsEmpty())throw scriptSection="the Story JavaScript",new Error("State.prng.init must be called during initialization, within either ".concat(scriptSection," or the StoryInit special passage"));_prng=new PRNGWrapper(seed,useEntropy),_active.pull=_prng.pull}function metadataDelete(key){if("string"!=typeof key)throw new TypeError("State.metadata.delete key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");store&&store.hasOwnProperty(key)&&(1===Object.keys(store).length?storage.delete("metadata"):(delete store[key],storage.set("metadata",store)))}return Object.freeze(Object.defineProperties({},{reset:{value:function(){session.delete("state"),_history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null===_prng?null:new PRNGWrapper(_prng.seed,!1)}},restore:{value:function(){if(session.has("state")){var stateObj=session.get("state");return null!=stateObj&&(stateUnmarshal(stateObj),!0)}return!1}},marshalForSave:{value:function(){return stateMarshal(!0)}},unmarshalForSave:{value:function(stateObj){return stateUnmarshal(stateObj,!0)}},expired:{get:function(){return _expired}},turns:{get:function(){return _expired.length+historyLength()}},passages:{get:function(){return _expired.concat(_history.slice(0,historyLength()).map((function(moment){return moment.title})))}},hasPlayed:{value:function(title){return null!=title&&""!==title&&(!!_expired.includes(title)||!!_history.slice(0,historyLength()).some((function(moment){return moment.title===title})))}},active:{get:function(){return _active}},activeIndex:{get:function(){return _activeIndex}},passage:{get:function(){return _active.title}},variables:{get:function(){return _active.variables}},history:{get:function(){return _history}},length:{get:historyLength},size:{get:historySize},isEmpty:{value:historyIsEmpty},current:{get:function(){return _history.length>0?_history[_activeIndex]:null}},top:{get:historyTop},bottom:{get:function(){return _history.length>0?_history[0]:null}},index:{value:function(index){return historyIsEmpty()||index<0||index>_activeIndex?null:_history[index]}},peek:{value:function(offset){if(historyIsEmpty())return null;var lengthOffset=1+(offset?Math.abs(offset):0);return lengthOffset>historyLength()?null:_history[historyLength()-lengthOffset]}},has:{value:function(title){if(historyIsEmpty()||null==title||""===title)return!1;for(var i=_activeIndex;i>=0;--i)if(_history[i].title===title)return!0;return!1}},create:{value:function(title){for(0,historyLength()<historySize()&&_history.splice(historyLength(),historySize()-historyLength()),_history.push(momentCreate(title,_active.variables)),_prng&&(historyTop().pull=_prng.pull);historySize()>Config.history.maxStates;)_expired.push(_history.shift().title);return momentActivate(_activeIndex=historySize()-1),historyLength()}},goTo:{value:historyGoTo},go:{value:function(offset){return null!=offset&&0!==offset&&historyGoTo(_activeIndex+offset)}},deltaEncode:{value:historyDeltaEncode},deltaDecode:{value:historyDeltaDecode},prng:{value:Object.freeze(Object.defineProperties({},{init:{value:prngInit},isEnabled:{value:function(){return null!==_prng}},pull:{get:function(){return _prng?_prng.pull:NaN}},seed:{get:function(){return _prng?_prng.seed:null}}}))},random:{value:function(){return _prng?_prng.random():Math.random()}},clearTemporary:{value:function(){TempVariables=_tempVariables={}}},temporary:{get:function(){return _tempVariables}},getVar:{value:function(varExpression){try{return Scripting.evalTwineScript(varExpression)}catch(ex){}}},setVar:{value:function(varExpression,value){try{return Scripting.evalTwineScript("".concat(varExpression," = evalTwineScript$Data$"),null,value),!0}catch(ex){}return!1}},metadata:{value:Object.freeze(Object.defineProperties({},{clear:{value:function(){storage.delete("metadata")}},delete:{value:metadataDelete},entries:{value:function(){var store=storage.get("metadata");return store&&Object.entries(store)}},get:{value:function(key){if("string"!=typeof key)throw new TypeError("State.metadata.get key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");return store&&store.hasOwnProperty(key)?store[key]:undefined}},has:{value:function(key){if("string"!=typeof key)throw new TypeError("State.metadata.has key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");return store&&store.hasOwnProperty(key)}},keys:{value:function(){var store=storage.get("metadata");return store&&Object.keys(store)}},set:{value:function(key,value){if("string"!=typeof key)throw new TypeError("State.metadata.set key parameter must be a string (received: ".concat(_typeof(key),")"));if(void 0===value)metadataDelete(key);else{var store=storage.get("metadata")||{};store[key]=value,storage.set("metadata",store)}}},size:{get:function(){var store=storage.get("metadata");return store?Object.keys(store).length:0}}}))},initPRNG:{value:prngInit},restart:{value:function(){return Engine.restart()}},backward:{value:function(){return Engine.backward()}},forward:{value:function(){return Engine.forward()}},display:{value:function(){return Engine.display.apply(Engine,arguments)}},show:{value:function(){return Engine.show.apply(Engine,arguments)}},play:{value:function(){return Engine.play.apply(Engine,arguments)}}}))}(),Scripting=function(){function addAccessibleClickHandler(targets,selector,handler,one,namespace){if(arguments.length<2)throw new Error("addAccessibleClickHandler insufficient number of parameters");var fn,opts;if("function"==typeof selector?(fn=selector,opts={namespace:one,one:!!handler}):(fn=handler,opts={namespace:namespace,one:!!one,selector:selector}),"function"!=typeof fn)throw new TypeError("addAccessibleClickHandler handler parameter must be a function");return jQuery(targets).ariaClick(opts,fn)}function insertElement(place,type,id,classNames,text,title){var $el=jQuery(document.createElement(type));return id&&$el.attr("id",id),classNames&&$el.addClass(classNames),title&&$el.attr("title",title),text&&$el.text(text),place&&$el.appendTo(place),$el[0]}function insertText(place,text){jQuery(place).append(document.createTextNode(text))}function removeChildren(node){jQuery(node).empty()}function removeElement(node){jQuery(node).remove()}function fade(el,options){var current,intervalId,direction="in"===options.fade?1:-1,proxy=el.cloneNode(!0);function setOpacity(el,opacity){el.style.zoom=1,el.style.filter="alpha(opacity=".concat(Math.floor(100*opacity),")"),el.style.opacity=opacity}el.parentNode.replaceChild(proxy,el),"in"===options.fade?(current=0,proxy.style.visibility="visible"):current=1,setOpacity(proxy,current),intervalId=window.setInterval((function(){current+=.05*direction,setOpacity(proxy,Math.easeInOut(current)),(1===direction&&current>=1||-1===direction&&current<=0)&&(el.style.visibility="in"===options.fade?"visible":"hidden",proxy.parentNode.replaceChild(el,proxy),proxy=null,window.clearInterval(intervalId),options.onComplete&&options.onComplete())}),25)}function scrollWindowTo(el,incrementBy){var increment=null!=incrementBy?Number(incrementBy):.1;Number.isNaN(increment)||!Number.isFinite(increment)||increment<0?increment=.1:increment>1&&(increment=1);var intervalId,start=window.scrollY?window.scrollY:document.body.scrollTop,end=function(el){var posTop=function(el){var curtop=0;for(;el.offsetParent;)curtop+=el.offsetTop,el=el.offsetParent;return curtop}(el),posBottom=posTop+el.offsetHeight,winTop=window.scrollY?window.scrollY:document.body.scrollTop,winHeight=window.innerHeight?window.innerHeight:document.body.clientHeight,winBottom=winTop+winHeight;return posTop>=winTop&&posBottom>winBottom&&el.offsetHeight<winHeight?posTop-(winHeight-el.offsetHeight)+20:posTop}(el),distance=Math.abs(start-end),direction=start>end?-1:1,progress=0;intervalId=window.setInterval((function(){progress+=increment,window.scroll(0,start+direction*(distance*Math.easeInOut(progress))),progress>=1&&window.clearInterval(intervalId)}),25)}function toStringOrDefault(value){return stringFrom(value)}function either(){if(0!==arguments.length)return Array.prototype.concat.apply([],arguments).random()}function forget(key){if("string"!=typeof key)throw new TypeError("forget key parameter must be a string (received: ".concat(Util.getType(key),")"));State.metadata.delete(key)}function hasVisited(){if(0===arguments.length)throw new Error("hasVisited called with insufficient parameters");if(State.isEmpty())return!1;for(var needles=Array.prototype.concat.apply([],arguments),played=State.passages,i=0,iend=needles.length;i<iend;++i)if(!played.includes(needles[i]))return!1;return!0}function lastVisited(){if(0===arguments.length)throw new Error("lastVisited called with insufficient parameters");if(State.isEmpty())return-1;for(var needles=Array.prototype.concat.apply([],arguments),played=State.passages,uBound=played.length-1,turns=State.turns,i=0,iend=needles.length;i<iend&&turns>-1;++i){var lastIndex=played.lastIndexOf(needles[i]);turns=Math.min(turns,-1===lastIndex?-1:uBound-lastIndex)}return turns}function memorize(key,value){if("string"!=typeof key)throw new TypeError("memorize key parameter must be a string (received: ".concat(Util.getType(key),")"));State.metadata.set(key,value)}function passage(){return State.passage}function previous(){var passages=State.passages;if(arguments.length>0){var offset=Number(arguments[0]);if(!Number.isSafeInteger(offset)||offset<1)throw new RangeError("previous offset parameter must be a positive integer greater than zero");return passages.length>offset?passages[passages.length-1-offset]:""}for(var i=passages.length-2;i>=0;--i)if(passages[i]!==State.passage)return passages[i];return""}function random(){var min,max;switch(arguments.length){case 0:throw new Error("random called with insufficient parameters");case 1:min=0,max=Math.trunc(arguments[0]);break;default:min=Math.trunc(arguments[0]),max=Math.trunc(arguments[1])}if(!Number.isInteger(min))throw new Error("random min parameter must be an integer");if(!Number.isInteger(max))throw new Error("random max parameter must be an integer");if(min>max){var _ref6=[max,min];min=_ref6[0],max=_ref6[1]}return Math.floor(State.random()*(max-min+1))+min}function randomFloat(){var min,max;switch(arguments.length){case 0:throw new Error("randomFloat called with insufficient parameters");case 1:min=0,max=Number(arguments[0]);break;default:min=Number(arguments[0]),max=Number(arguments[1])}if(Number.isNaN(min)||!Number.isFinite(min))throw new Error("randomFloat min parameter must be a number");if(Number.isNaN(max)||!Number.isFinite(max))throw new Error("randomFloat max parameter must be a number");if(min>max){var _ref7=[max,min];min=_ref7[0],max=_ref7[1]}return State.random()*(max-min)+min}function recall(key,defaultValue){if("string"!=typeof key)throw new TypeError("recall key parameter must be a string (received: ".concat(Util.getType(key),")"));return State.metadata.has(key)?State.metadata.get(key):defaultValue}function tags(){if(0===arguments.length)return Story.get(State.passage).tags.slice(0);for(var passages=Array.prototype.concat.apply([],arguments),tags=[],i=0,iend=passages.length;i<iend;++i)tags=tags.concat(Story.get(passages[i]).tags);return tags}function temporary(){return State.temporary}function time(){return null===Engine.lastPlay?0:Util.now()-Engine.lastPlay}function turns(){return State.turns}function variables(){return State.variables}function visited(){if(State.isEmpty())return 0;for(var needles=Array.prototype.concat.apply([],0===arguments.length?[State.passage]:arguments),played=State.passages,count=State.turns,i=0,iend=needles.length;i<iend&&count>0;++i)count=Math.min(count,played.count(needles[i]));return count}function visitedTags(){if(0===arguments.length)throw new Error("visitedTags called with insufficient parameters");if(State.isEmpty())return 0;for(var needles=Array.prototype.concat.apply([],arguments),nLength=needles.length,played=State.passages,seen=new Map,count=0,i=0,iend=played.length;i<iend;++i){var title=played[i];if(seen.has(title))seen.get(title)&&++count;else{var _tags2=Story.get(title).tags;if(_tags2.length>0){for(var found=0,j=0;j<nLength;++j)_tags2.includes(needles[j])&&++found;found===nLength?(++count,seen.set(title,!0)):seen.set(title,!1)}}}return count}var _ref8=function(){function slugifyUrl(url){return Util.parseUrl(url).path.replace(/^[^\w]+|[^\w]+$/g,"").replace(/[^\w]+/g,"-").toLocaleLowerCase()}function addScript(url){return new Promise((function(resolve,reject){jQuery(document.createElement("script")).one("load abort error",(function(ev){jQuery(ev.target).off(),"load"===ev.type?resolve(ev.target):reject(new Error('importScripts failed to load the script "'.concat(url,'".')))})).appendTo(document.head).attr({id:"script-imported-".concat(slugifyUrl(url)),type:"text/javascript",src:url})}))}function addStyle(url){return new Promise((function(resolve,reject){jQuery(document.createElement("link")).one("load abort error",(function(ev){jQuery(ev.target).off(),"load"===ev.type?resolve(ev.target):reject(new Error('importStyles failed to load the stylesheet "'.concat(url,'".')))})).appendTo(document.head).attr({id:"style-imported-".concat(slugifyUrl(url)),rel:"stylesheet",href:url})}))}function sequence(callbacks){return callbacks.reduce((function(seq,fn){return seq.then(fn)}),Promise.resolve())}return{importScripts:function(){for(var _len12=arguments.length,urls=new Array(_len12),_key12=0;_key12<_len12;_key12++)urls[_key12]=arguments[_key12];return Promise.all(urls.map((function(oneOrSeries){return Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((function(url){return function(){return addScript(url)}}))):addScript(oneOrSeries)})))},importStyles:function(){for(var _len13=arguments.length,urls=new Array(_len13),_key13=0;_key13<_len13;_key13++)urls[_key13]=arguments[_key13];return Promise.all(urls.map((function(oneOrSeries){return Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((function(url){return function(){return addStyle(url)}}))):addStyle(oneOrSeries)})))}}}(),importScripts=_ref8.importScripts,importStyles=_ref8.importStyles,parse=function(){var tokenTable=Util.toEnum({$:"State.variables.",_:"State.temporary.",to:"=",eq:"==",neq:"!=",is:"===",isnot:"!==",gt:">",gte:">=",lt:"<",lte:"<=",and:"&&",or:"||",not:"!",def:'"undefined" !== typeof',ndef:'"undefined" === typeof'}),parseRe=new RegExp(["(?:\"\"|''|``)",'(?:"(?:\\\\.|[^"\\\\])+")',"(?:'(?:\\\\.|[^'\\\\])+')","(`(?:\\\\.|[^`\\\\])+`)","(?:[=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}]+)","([^\"'=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}\\s]+)"].join("|"),"g"),notSpaceRe=/\S/,varTest=new RegExp("^".concat(Patterns.variable)),withColonTestRe=/^\s*:/,withNotTestRe=/^\s+not\b/;function parse(rawCodeString){if(0!==parseRe.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start");for(var match,code=rawCodeString;null!==(match=parseRe.exec(code));)if(match[1]){var rawTemplate=match[1],parsedTemplate=parseTemplate(rawTemplate);parsedTemplate!==rawTemplate&&(code=code.splice(match.index,rawTemplate.length,parsedTemplate),parseRe.lastIndex+=parsedTemplate.length-rawTemplate.length)}else if(match[2]){var token=match[2];if("$"===token||"_"===token)continue;if(varTest.test(token))token=token[0];else if("is"===token){var start=parseRe.lastIndex,ahead=code.slice(start);withNotTestRe.test(ahead)&&(code=code.splice(start,ahead.search(notSpaceRe)),token="isnot")}else{var _ahead=code.slice(parseRe.lastIndex);if(withColonTestRe.test(_ahead))continue}tokenTable[token]&&(code=code.splice(match.index,token.length,tokenTable[token]),parseRe.lastIndex+=tokenTable[token].length-token.length)}return code}var templateGroupStartRe=/\$\{/g,templateGroupParseRe=new RegExp(["(?:\"\"|'')",'(?:"(?:\\\\.|[^"\\\\])+")',"(?:'(?:\\\\.|[^'\\\\])+')","(\\{)","(\\})"].join("|"),"g");function parseTemplate(rawTemplateLiteral){if(0!==templateGroupStartRe.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start of template literal");for(var startMatch,template=rawTemplateLiteral;null!==(startMatch=templateGroupStartRe.exec(template));){var startIdx=startMatch.index+2,endIdx=startIdx,depth=1,endMatch=void 0;for(templateGroupParseRe.lastIndex=startIdx;null!==(endMatch=templateGroupParseRe.exec(template));)if(endMatch[1]?++depth:endMatch[2]&&--depth,0===depth){endIdx=endMatch.index;break}if(endIdx>startIdx){var parseIndex=parseRe.lastIndex,rawGroup=template.slice(startIdx,endIdx);parseRe.lastIndex=0;var parsedGroup=parse(rawGroup);parseRe.lastIndex=parseIndex,template=template.splice(startIdx,rawGroup.length,parsedGroup),templateGroupStartRe.lastIndex+=parsedGroup.length-rawGroup.length}}return template}return parse}();function evalJavaScript(code,output,data){return function(code,output,evalJavaScript$Data$){return eval(code)}.call(output?{output:output}:null,String(code),output,data)}function evalTwineScript(code,output,data){return function(code,output,evalTwineScript$Data$){return eval(code)}.call(output?{output:output}:null,parse(String(code)),output,data)}return Object.freeze(Object.defineProperties({},{parse:{value:parse},evalJavaScript:{value:evalJavaScript},evalTwineScript:{value:evalTwineScript}}))}(),_ref9=function(){var Lexer=function(){function Lexer(source,initialState){if(_classCallCheck(this,Lexer),arguments.length<2)throw new Error("Lexer constructor called with too few parameters (source:string , initialState:function)");Object.defineProperties(this,{source:{value:source},initial:{value:initialState},state:{writable:!0,value:initialState},start:{writable:!0,value:0},pos:{writable:!0,value:0},depth:{writable:!0,value:0},items:{writable:!0,value:[]},data:{writable:!0,value:{}}})}return _createClass(Lexer,[{key:"reset",value:function(){this.state=this.initial,this.start=0,this.pos=0,this.depth=0,this.items=[],this.data={}}},{key:"run",value:function(){for(;null!==this.state;)this.state=this.state(this);return this.items}},{key:"nextItem",value:function(){for(;0===this.items.length&&null!==this.state;)this.state=this.state(this);return this.items.shift()}},{key:"next",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos++]}},{key:"peek",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos]}},{key:"backup",value:function(num){this.pos-=num||1}},{key:"forward",value:function(num){this.pos+=num||1}},{key:"ignore",value:function(){this.start=this.pos}},{key:"accept",value:function(valid){var ch=this.next();return-1!==ch&&(!!valid.includes(ch)||(this.backup(),!1))}},{key:"acceptRe",value:function(validRe){var ch=this.next();return-1!==ch&&(!!validRe.test(ch)||(this.backup(),!1))}},{key:"acceptRun",value:function(valid){for(;;){var ch=this.next();if(-1===ch)return;if(!valid.includes(ch))break}this.backup()}},{key:"acceptRunRe",value:function(validRe){for(;;){var ch=this.next();if(-1===ch)return;if(!validRe.test(ch))break}this.backup()}},{key:"emit",value:function(type){this.items.push({type:type,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),this.start=this.pos}},{key:"error",value:function(type,message){if(arguments.length<2)throw new Error("Lexer.prototype.error called with too few parameters (type:number , message:string)");return this.items.push({type:type,message:message,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),null}}],[{key:"enumFromNames",value:function(names){var obj=names.reduce((function(obj,name,i){return obj[name]=i,obj}),{});return Object.freeze(Object.assign(Object.create(null),obj))}}]),Lexer}();return{EOF:-1,Lexer:Lexer}}(),EOF=_ref9.EOF,Lexer=_ref9.Lexer,Wikifier=function(){var _optionsStack,lookaheadRe,idOrClassRe,_callDepth=0,Wikifier=function(){function Wikifier(destination,source,options){_classCallCheck(this,Wikifier),Wikifier.Parser.Profile.isEmpty()&&Wikifier.Parser.Profile.compile(),Object.defineProperties(this,{source:{value:String(source)},options:{writable:!0,value:Object.assign({profile:"all"},options)},nextMatch:{writable:!0,value:0},output:{writable:!0,value:null},_rawArgs:{writable:!0,value:""}}),null==destination?this.output=document.createDocumentFragment():destination.jquery?this.output=destination[0]:this.output=destination;try{++_callDepth,this.subWikify(this.output),1===_callDepth&&Config.cleanupWikifierOutput&&convertBreaks(this.output)}finally{--_callDepth}}return _createClass(Wikifier,[{key:"subWikify",value:function(output,terminator,options){var newOptions,oldOptions,oldOutput=this.output;this.output=output,Wikifier.Option.length>0&&(newOptions=Object.assign(newOptions||{},Wikifier.Option.options)),null!==options&&"object"===_typeof(options)&&(newOptions=Object.assign(newOptions||{},options)),newOptions&&(oldOptions=this.options,this.options=Object.assign({},this.options,newOptions));var terminatorMatch,parserMatch,parsersProfile=Wikifier.Parser.Profile.get(this.options.profile),terminatorRegExp=terminator?new RegExp("(?:".concat(terminator,")"),this.options.ignoreTerminatorCase?"gim":"gm"):null;do{if(parsersProfile.parserRegExp.lastIndex=this.nextMatch,terminatorRegExp&&(terminatorRegExp.lastIndex=this.nextMatch),parserMatch=parsersProfile.parserRegExp.exec(this.source),(terminatorMatch=terminatorRegExp?terminatorRegExp.exec(this.source):null)&&(!parserMatch||terminatorMatch.index<=parserMatch.index))return terminatorMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,terminatorMatch.index),this.matchStart=terminatorMatch.index,this.matchLength=terminatorMatch[0].length,this.matchText=terminatorMatch[0],this.nextMatch=terminatorRegExp.lastIndex,this.output=oldOutput,void(oldOptions&&(this.options=oldOptions));if(parserMatch){parserMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,parserMatch.index),this.matchStart=parserMatch.index,this.matchLength=parserMatch[0].length,this.matchText=parserMatch[0],this.nextMatch=parsersProfile.parserRegExp.lastIndex;for(var matchingParser=void 0,i=1,iend=parserMatch.length;i<iend;++i)if(parserMatch[i]){matchingParser=i-1;break}if(parsersProfile.parsers[matchingParser].handler(this),null!=TempState.break)break}}while(terminatorMatch||parserMatch);null==TempState.break?this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length):this.output.lastChild&&this.output.lastChild.nodeType===Node.ELEMENT_NODE&&"BR"===this.output.lastChild.nodeName.toUpperCase()&&jQuery(this.output.lastChild).remove(),this.output=oldOutput,oldOptions&&(this.options=oldOptions)}},{key:"outputText",value:function(destination,startPos,endPos){jQuery(destination).append(document.createTextNode(this.source.substring(startPos,endPos)))}},{key:"rawArgs",value:function(){return this._rawArgs}},{key:"fullArgs",value:function(){return Scripting.parse(this._rawArgs)}}],[{key:"wikifyEval",value:function(text){var output=document.createDocumentFragment();new Wikifier(output,text);var errors=output.querySelector(".error");if(null!==errors)throw new Error(errors.textContent.replace(errorPrologRegExp,""));return output}},{key:"createInternalLink",value:function(destination,passage,text,callback){var $link=jQuery(document.createElement("a"));return null!=passage&&($link.attr("data-passage",passage),Story.has(passage)?($link.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass("link-visited")):$link.addClass("link-broken"),$link.ariaClick({one:!0},(function(){"function"==typeof callback&&callback(),Engine.play(passage)}))),text&&$link.append(document.createTextNode(text)),destination&&$link.appendTo(destination),$link[0]}},{key:"createExternalLink",value:function(destination,url,text){var $link=jQuery(document.createElement("a")).attr("target","_blank").addClass("link-external").text(text).appendTo(destination);return null!=url&&$link.attr({href:url,tabindex:0}),$link[0]}},{key:"isExternalLink",value:function(link){return!Story.has(link)&&(new RegExp("^".concat(Patterns.url),"gim").test(link)||/[/.?#]/.test(link))}}]),Wikifier}();return Object.defineProperty(Wikifier,"Option",{value:(_optionsStack=[],Object.freeze(Object.defineProperties({},{length:{get:function(){return _optionsStack.length}},options:{get:function(){return Object.assign.apply(Object,[{}].concat(_toConsumableArray(_optionsStack)))}},clear:{value:function(){_optionsStack=[]}},get:{value:function(idx){return _optionsStack[idx]}},pop:{value:function(){return _optionsStack.pop()}},push:{value:function(options){if("object"!==_typeof(options)||null===options)throw new TypeError("Wikifier.Option.push options parameter must be an object (received: ".concat(Util.getType(options),")"));return _optionsStack.push(options)}}})))}),Object.defineProperty(Wikifier,"Parser",{value:function(){var _profiles,_parsers=[];function parsersHas(name){return!!_parsers.find((function(parser){return parser.name===name}))}return Object.freeze(Object.defineProperties({},{parsers:{get:function(){return _parsers}},add:{value:function(parser){if("object"!==_typeof(parser))throw new Error("Wikifier.Parser.add parser parameter must be an object");if(!parser.hasOwnProperty("name"))throw new Error('parser object missing required "name" property');if("string"!=typeof parser.name)throw new Error('parser object "name" property must be a string');if(!parser.hasOwnProperty("match"))throw new Error('parser object missing required "match" property');if("string"!=typeof parser.match)throw new Error('parser object "match" property must be a string');if(!parser.hasOwnProperty("handler"))throw new Error('parser object missing required "handler" property');if("function"!=typeof parser.handler)throw new Error('parser object "handler" property must be a function');if(parser.hasOwnProperty("profiles")&&!Array.isArray(parser.profiles))throw new Error('parser object "profiles" property must be an array');if(parsersHas(parser.name))throw new Error('cannot clobber existing parser "'.concat(parser.name,'"'));_parsers.push(parser)}},delete:{value:function(name){var parser=_parsers.find((function(parser){return parser.name===name}));parser&&_parsers.delete(parser)}},isEmpty:{value:function(){return 0===_parsers.length}},has:{value:parsersHas},get:{value:function(name){return _parsers.find((function(parser){return parser.name===name}))||null}},Profile:{value:Object.freeze(Object.defineProperties({},{profiles:{get:function(){return _profiles}},compile:{value:function(){var all=_parsers,core=all.filter((function(parser){return!Array.isArray(parser.profiles)||parser.profiles.includes("core")}));return _profiles=Object.freeze({all:{parsers:all,parserRegExp:new RegExp(all.map((function(parser){return"(".concat(parser.match,")")})).join("|"),"gm")},core:{parsers:core,parserRegExp:new RegExp(core.map((function(parser){return"(".concat(parser.match,")")})).join("|"),"gm")}})}},isEmpty:{value:function(){return"object"!==_typeof(_profiles)||0===Object.keys(_profiles).length}},has:{value:function(profile){return"object"===_typeof(_profiles)&&_profiles.hasOwnProperty(profile)}},get:{value:function(profile){if("object"!==_typeof(_profiles)||!_profiles.hasOwnProperty(profile))throw new Error('nonexistent parser profile "'.concat(profile,'"'));return _profiles[profile]}}}))}}))}()}),Object.defineProperties(Wikifier,{helpers:{value:{}},getValue:{value:State.getVar},setValue:{value:State.setVar},parse:{value:Scripting.parse},evalExpression:{value:Scripting.evalTwineScript},evalStatements:{value:Scripting.evalTwineScript},textPrimitives:{value:Patterns}}),Object.defineProperties(Wikifier.helpers,{inlineCss:{value:(lookaheadRe=new RegExp(Patterns.inlineCss,"gm"),idOrClassRe=new RegExp("(".concat(Patterns.cssIdOrClassSigil,")(").concat(Patterns.anyLetter,"+)"),"g"),function(w){var matched,css={classes:[],id:"",styles:{}};do{lookaheadRe.lastIndex=w.nextMatch;var match=lookaheadRe.exec(w.source);if(matched=match&&match.index===w.nextMatch){if(match[1])css.styles[Util.fromCssProperty(match[1])]=match[2].trim();else if(match[3])css.styles[Util.fromCssProperty(match[3])]=match[4].trim();else if(match[5]){var subMatch=void 0;for(idOrClassRe.lastIndex=0;null!==(subMatch=idOrClassRe.exec(match[5]));)"."===subMatch[1]?css.classes.push(subMatch[2]):css.id=subMatch[2]}w.nextMatch=lookaheadRe.lastIndex}}while(matched);return css})},evalText:{value:function(text){var result;try{switch(_typeof(result=Scripting.evalTwineScript(text))){case"string":""===result.trim()&&(result=text);break;case"number":result=String(result);break;default:result=text}}catch(ex){result=text}return result}},evalPassageId:{value:function(passage){return null==passage||Story.has(passage)?passage:Wikifier.helpers.evalText(passage)}},hasBlockContext:{value:function(nodes){for(var hasGCS="function"==typeof window.getComputedStyle,i=nodes.length-1;i>=0;--i){var node=nodes[i];switch(node.nodeType){case Node.ELEMENT_NODE:var tagName=node.nodeName.toUpperCase();if("BR"===tagName)return!0;var styles=hasGCS?window.getComputedStyle(node,null):node.currentStyle;if(styles&&styles.display){if("none"===styles.display)continue;return"block"===styles.display}switch(tagName){case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":return!0}return!1;case Node.COMMENT_NODE:continue;default:return!1}}return!0}},createShadowSetterCallback:{value:function(){var macroParser=null;function getMacroContextShadowView(){for(var macro=macroParser||function(){if(!macroParser&&!(macroParser=Wikifier.Parser.get("macro")))throw new Error('cannot find "macro" parser');return macroParser}(),view=new Set,context=macro.context;null!==context;context=context.parent)context._shadows&&context._shadows.forEach((function(name){return view.add(name)}));return _toConsumableArray(view)}return function(code){var shadowStore={};return getMacroContextShadowView().forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]})),function(){var shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null;try{return shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),Scripting.evalJavaScript(code)}finally{shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}}()},parseSquareBracketedMarkup:{value:function(){var Item=Lexer.enumFromNames(["Error","DelimLTR","DelimRTL","InnerMeta","ImageMeta","LinkMeta","Link","RightMeta","Setter","Source","Text"]),Delim=Lexer.enumFromNames(["None","LTR","RTL"]);function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return EOF;case endQuote:break loop}return lexer.pos}function lexLeftMeta(lexer){if(!lexer.accept("["))return lexer.error(Item.Error,"malformed square-bracketed markup");if(lexer.accept("["))lexer.data.isLink=!0,lexer.emit(Item.LinkMeta);else{if(lexer.accept("<>"),!(lexer.accept("Ii")&&lexer.accept("Mm")&&lexer.accept("Gg")&&lexer.accept("[")))return lexer.error(Item.Error,"malformed square-bracketed markup");lexer.data.isLink=!1,lexer.emit(Item.ImageMeta)}return lexer.depth=2,lexCoreComponents}function lexCoreComponents(lexer){for(var what=lexer.data.isLink?"link":"image",delim=Delim.None;;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup"));break;case"|":delim===Delim.None&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(),lexer.emit(Item.DelimLTR));break;case"-":delim===Delim.None&&">"===lexer.peek()&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(2),lexer.emit(Item.DelimLTR));break;case"<":delim===Delim.None&&"-"===lexer.peek()&&(delim=Delim.RTL,lexer.backup(),lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.DelimRTL));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case"[":return++lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.InnerMeta),lexer.data.isLink?lexSetter:lexImageLink;case"]":return--lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,"malformed ".concat(what," markup"))}}}function lexImageLink(lexer){for(var what=lexer.data.isLink?"link":"image";;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup link component"));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case"[":return++lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.InnerMeta),lexSetter;case"]":return--lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,"malformed ".concat(what," markup"))}}}function lexSetter(lexer){for(var what=lexer.data.isLink?"link":"image";;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup setter component"));break;case"'":if(slurpQuote(lexer,"'")===EOF)return lexer.error(Item.Error,"unterminated single quoted string in ".concat(what," markup setter component"));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)return"]"!==lexer.peek()?lexer.error(Item.Error,"malformed ".concat(what," markup")):(--lexer.depth,lexer.backup(),lexer.emit(Item.Setter),lexer.forward(2),lexer.emit(Item.RightMeta),null)}}return function(w){var lexer=new Lexer(w.source,lexLeftMeta);lexer.start=lexer.pos=w.matchStart;var markup={},items=lexer.run(),last=items.last();return last&&last.type===Item.Error?markup.error=last.message:items.forEach((function(item){var text=item.text.trim();switch(item.type){case Item.ImageMeta:markup.isImage=!0,"<"===text[1]?markup.align="left":">"===text[1]&&(markup.align="right");break;case Item.LinkMeta:markup.isLink=!0;break;case Item.Link:"~"===text[0]?(markup.forceInternal=!0,markup.link=text.slice(1)):markup.link=text;break;case Item.Setter:markup.setter=text;break;case Item.Source:markup.source=text;break;case Item.Text:markup.text=text}})),markup.pos=lexer.pos,markup}}()}}),Wikifier}();!function(){function _verbatimTagHandler(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createDocumentFragment()).append(match[1]).appendTo(w.output))}Wikifier.Parser.add({name:"quoteByBlock",profiles:["block"],match:"^<<<\\n",terminator:"^<<<\\n",handler:function(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement("blockquote")).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"quoteByLine",profiles:["block"],match:"^>+",lookahead:/^>+/gm,terminator:"\\n",handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){var matched,i,destStack=[w.output],curLevel=0,newLevel=w.matchLength;do{if(newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement("blockquote")).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();curLevel=newLevel,w.subWikify(destStack[destStack.length-1],this.terminator),jQuery(document.createElement("br")).appendTo(destStack[destStack.length-1]),this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);(matched=match&&match.index===w.nextMatch)&&(newLevel=match[0].length,w.nextMatch+=match[0].length)}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"macro",profiles:["core"],match:"<<",lookahead:new RegExp("<<(/?".concat(Patterns.macroName,")(?:\\s*)((?:(?:/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/)|(?://.*\\n)|(?:`(?:\\\\.|[^`\\\\])*`)|(?:\"(?:\\\\.|[^\"\\\\])*\")|(?:'(?:\\\\.|[^'\\\\])*')|(?:\\[(?:[<>]?[Ii][Mm][Gg])?\\[[^\\r\\n]*?\\]\\]+)|[^>]|(?:>(?!>)))*)>>"),"gm"),working:{source:"",name:"",arguments:"",index:0},context:null,handler:function(w){var matchStart=this.lookahead.lastIndex=w.matchStart;if(this.parseTag(w)){var macro,nextMatch=w.nextMatch,name=this.working.name,rawArgs=this.working.arguments;try{if(!(macro=Macro.get(name))){if(Macro.tags.has(name)){var tags=Macro.tags.get(name);return throwError(w.output,"child tag <<".concat(name,">> was found outside of a call to its parent macro").concat(1===tags.length?"":"s"," <<").concat(tags.join(">>, <<"),">>"),w.source.slice(matchStart,w.nextMatch))}return throwError(w.output,"macro <<".concat(name,">> does not exist"),w.source.slice(matchStart,w.nextMatch))}var payload=null;if(void 0!==macro.tags&&!(payload=this.parseBody(w,macro)))return w.nextMatch=nextMatch,throwError(w.output,"cannot find a closing tag for macro <<".concat(name,">>"),"".concat(w.source.slice(matchStart,w.nextMatch),"…"));if("function"!=typeof macro.handler)return throwError(w.output,"macro <<".concat(name,">> handler function ").concat(void 0===macro.handler?"does not exist":"is not a function"),w.source.slice(matchStart,w.nextMatch));var args=payload?payload[0].args:this.createArgs(rawArgs,this.skipArgs(macro,macro.name));if(void 0!==macro._MACRO_API){this.context=new MacroContext({macro:macro,name:name,args:args,payload:payload,source:w.source.slice(matchStart,w.nextMatch),parent:this.context,parser:w});try{macro.handler.call(this.context)}finally{this.context=this.context.parent}}else{var prevRawArgs=w._rawArgs;w._rawArgs=rawArgs;try{macro.handler(w.output,name,args,w,payload)}finally{w._rawArgs=prevRawArgs}}}catch(ex){return throwError(w.output,"cannot execute ".concat(macro&&macro.isWidget?"widget":"macro"," <<").concat(name,">>: ").concat(ex.message),w.source.slice(matchStart,w.nextMatch))}finally{this.working.source="",this.working.name="",this.working.arguments="",this.working.index=0}}else w.outputText(w.output,w.matchStart,w.nextMatch)},parseTag:function(w){var match=this.lookahead.exec(w.source);return!(!match||match.index!==w.matchStart||!match[1])&&(w.nextMatch=this.lookahead.lastIndex,this.working.source=w.source.slice(match.index,this.lookahead.lastIndex),this.working.name=match[1],this.working.arguments=match[2],this.working.index=match.index,!0)},parseBody:function(w,macro){for(var openTag=this.working.name,closeTag="/".concat(openTag),closeAlt="end".concat(openTag),bodyTags=!!Array.isArray(macro.tags)&&macro.tags,payload=[],end=-1,opened=1,curSource=this.working.source,curTag=this.working.name,curArgument=this.working.arguments,contentStart=w.nextMatch;-1!==(w.matchStart=w.source.indexOf(this.match,w.nextMatch));)if(this.parseTag(w)){var tagSource=this.working.source,tagName=this.working.name,tagArgs=this.working.arguments,tagBegin=this.working.index,tagEnd=w.nextMatch,hasArgs=""!==tagArgs.trim();switch(tagName){case openTag:++opened;break;case closeAlt:case closeTag:if(hasArgs)throw w.nextMatch=tagBegin+2+tagName.length,new Error('malformed closing tag: "'.concat(tagSource,'"'));--opened;break;default:if(hasArgs&&(tagName.startsWith("/")||tagName.startsWith("end"))){this.lookahead.lastIndex=w.nextMatch=tagBegin+2+tagName.length;continue}if(1===opened&&bodyTags)for(var i=0,iend=bodyTags.length;i<iend;++i)tagName===bodyTags[i]&&(payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),curSource=tagSource,curTag=tagName,curArgument=tagArgs,contentStart=tagEnd)}if(0===opened){payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),end=tagEnd;break}}else this.lookahead.lastIndex=w.nextMatch=w.matchStart+this.match.length;return-1!==end?(w.nextMatch=end,payload):null},createArgs:function(rawArgsString,skipArgs){var args=skipArgs?[]:this.parseArgs(rawArgsString);return Object.defineProperties(args,{raw:{value:rawArgsString},full:{value:Scripting.parse(rawArgsString)}}),args},skipArgs:function(macro,tagName){if(void 0!==macro.skipArgs){var sa=macro.skipArgs;return"boolean"==typeof sa&&sa||Array.isArray(sa)&&sa.includes(tagName)}return void 0!==macro.skipArg0&&(macro.skipArg0&&macro.name===tagName)},parseArgs:function(){var Item=Lexer.enumFromNames(["Error","Bareword","Expression","String","SquareBracket"]),spaceRe=new RegExp(Patterns.space),notSpaceRe=new RegExp(Patterns.notSpace),varTest=new RegExp("^".concat(Patterns.variable));function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return EOF;case endQuote:break loop}return lexer.pos}function lexSpace(lexer){var offset=lexer.source.slice(lexer.pos).search(notSpaceRe);if(offset===EOF)return null;switch(0!==offset&&(lexer.pos+=offset,lexer.ignore()),lexer.next()){case"`":return lexExpression;case'"':return lexDoubleQuote;case"'":return lexSingleQuote;case"[":return lexSquareBracket;default:return lexBareword}}function lexExpression(lexer){return slurpQuote(lexer,"`")===EOF?lexer.error(Item.Error,"unterminated backquote expression"):(lexer.emit(Item.Expression),lexSpace)}function lexDoubleQuote(lexer){return slurpQuote(lexer,'"')===EOF?lexer.error(Item.Error,"unterminated double quoted string"):(lexer.emit(Item.String),lexSpace)}function lexSingleQuote(lexer){return slurpQuote(lexer,"'")===EOF?lexer.error(Item.Error,"unterminated single quoted string"):(lexer.emit(Item.String),lexSpace)}function lexSquareBracket(lexer){var what;if(lexer.accept("<>IiMmGg")?(what="image",lexer.acceptRun("<>IiMmGg")):what="link",!lexer.accept("["))return lexer.error(Item.Error,"malformed ".concat(what," markup"));lexer.depth=2;loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case"[":++lexer.depth;break;case"]":if(--lexer.depth,lexer.depth<0)return lexer.error(Item.Error,"unexpected right square bracket ']'");if(1===lexer.depth){if("]"===lexer.next()){--lexer.depth;break loop}lexer.backup()}}return lexer.emit(Item.SquareBracket),lexSpace}function lexBareword(lexer){var offset=lexer.source.slice(lexer.pos).search(spaceRe);return lexer.pos=offset===EOF?lexer.source.length:lexer.pos+offset,lexer.emit(Item.Bareword),offset===EOF?null:lexSpace}return function(rawArgsString){var lexer=new Lexer(rawArgsString,lexSpace),args=[];return lexer.run().forEach((function(item){var arg=item.text;switch(item.type){case Item.Error:throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(item.message));case Item.Bareword:if(varTest.test(arg))arg=State.getVar(arg);else if(/^(?:settings|setup)[.[]/.test(arg))try{arg=Scripting.evalTwineScript(arg)}catch(ex){throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(ex.message))}else if("null"===arg)arg=null;else if("undefined"===arg)arg=undefined;else if("true"===arg)arg=!0;else if("false"===arg)arg=!1;else if("NaN"===arg)arg=NaN;else{var argAsNum=Number(arg);Number.isNaN(argAsNum)||(arg=argAsNum)}break;case Item.Expression:if(""===(arg=arg.slice(1,-1).trim()))arg=undefined;else try{arg=Scripting.evalTwineScript("(".concat(arg,")"))}catch(ex){throw new Error('unable to parse macro argument expression "'.concat(arg,'": ').concat(ex.message))}break;case Item.String:try{arg=Scripting.evalJavaScript(arg)}catch(ex){throw new Error('unable to parse macro argument string "'.concat(arg,'": ').concat(ex.message))}break;case Item.SquareBracket:var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:arg,matchStart:0});if(markup.hasOwnProperty("error"))throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(markup.error));if(markup.pos<arg.length)throw new Error('unable to parse macro argument "'.concat(arg,'": unexpected character(s) "').concat(arg.slice(markup.pos),'" (pos: ').concat(markup.pos,")"));markup.isLink?((arg={isLink:!0}).count=markup.hasOwnProperty("text")?2:1,arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.text=markup.hasOwnProperty("text")?Wikifier.helpers.evalText(markup.text):arg.link,arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link),arg.setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null):markup.isImage&&(arg=function(source){var imgObj={source:source,isImage:!0};if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(imgObj.source=passage.text,imgObj.passage=passage.title)}return imgObj}(Wikifier.helpers.evalPassageId(markup.source)),markup.hasOwnProperty("align")&&(arg.align=markup.align),markup.hasOwnProperty("text")&&(arg.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty("link")&&(arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link)),arg.setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null)}args.push(arg)})),args}}()}),Wikifier.Parser.add({name:"link",profiles:["core"],match:"\\[\\[[^[]",handler:function(w){var markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty("error"))w.outputText(w.output,w.matchStart,w.nextMatch);else{w.nextMatch=markup.pos;var link=Wikifier.helpers.evalPassageId(markup.link),text=markup.hasOwnProperty("text")?Wikifier.helpers.evalText(markup.text):link,setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null,output=(Config.debug?new DebugView(w.output,"link-markup","[[link]]",w.source.slice(w.matchStart,w.nextMatch)):w).output;markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(output,link,text,setFn):Wikifier.createExternalLink(output,link,text)}}}),Wikifier.Parser.add({name:"urlLink",profiles:["core"],match:Patterns.url,handler:function(w){w.outputText(Wikifier.createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch)}}),Wikifier.Parser.add({name:"image",profiles:["core"],match:"\\[[<>]?[Ii][Mm][Gg]\\[",handler:function(w){var markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty("error"))w.outputText(w.output,w.matchStart,w.nextMatch);else{var debugView;w.nextMatch=markup.pos,Config.debug&&(debugView=new DebugView(w.output,"image-markup",markup.hasOwnProperty("link")?"[img[][link]]":"[img[]]",w.source.slice(w.matchStart,w.nextMatch))).modes({block:!0});var source,setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null,el=(Config.debug?debugView:w).output;if(markup.hasOwnProperty("link")){var link=Wikifier.helpers.evalPassageId(markup.link);(el=markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(el,link,null,setFn):Wikifier.createExternalLink(el,link)).classList.add("link-image")}if(el=jQuery(document.createElement("img")).appendTo(el).get(0),"data:"!==(source=Wikifier.helpers.evalPassageId(markup.source)).slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(el.setAttribute("data-passage",passage.title),source=passage.text.trim())}el.src=source,markup.hasOwnProperty("text")&&(el.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty("align")&&(el.align=markup.align)}}}),Wikifier.Parser.add({name:"monospacedByBlock",profiles:["block"],match:"^\\{\\{\\{\\n",lookahead:/^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){var pre=jQuery(document.createElement("pre"));jQuery(document.createElement("code")).text(match[1]).appendTo(pre),pre.appendTo(w.output),w.nextMatch=this.lookahead.lastIndex}}}),Wikifier.Parser.add({name:"formatByChar",profiles:["core"],match:"''|//|__|\\^\\^|~~|==|\\{\\{\\{",handler:function(w){switch(w.matchText){case"''":w.subWikify(jQuery(document.createElement("strong")).appendTo(w.output).get(0),"''");break;case"//":w.subWikify(jQuery(document.createElement("em")).appendTo(w.output).get(0),"//");break;case"__":w.subWikify(jQuery(document.createElement("u")).appendTo(w.output).get(0),"__");break;case"^^":w.subWikify(jQuery(document.createElement("sup")).appendTo(w.output).get(0),"\\^\\^");break;case"~~":w.subWikify(jQuery(document.createElement("sub")).appendTo(w.output).get(0),"~~");break;case"==":w.subWikify(jQuery(document.createElement("s")).appendTo(w.output).get(0),"==");break;case"{{{":var lookahead=/\{\{\{((?:.|\n)*?)\}\}\}/gm;lookahead.lastIndex=w.matchStart;var match=lookahead.exec(w.source);match&&match.index===w.matchStart&&(jQuery(document.createElement("code")).text(match[1]).appendTo(w.output),w.nextMatch=lookahead.lastIndex)}}}),Wikifier.Parser.add({name:"customStyle",profiles:["core"],match:"@@",terminator:"@@",blockRe:/\s*\n/gm,handler:function(w){var css=Wikifier.helpers.inlineCss(w);this.blockRe.lastIndex=w.nextMatch;var blockMatch=this.blockRe.exec(w.source),blockLevel=blockMatch&&blockMatch.index===w.nextMatch,$el=jQuery(document.createElement(blockLevel?"div":"span")).appendTo(w.output);0===css.classes.length&&""===css.id&&0===Object.keys(css.styles).length?$el.addClass("marked"):(css.classes.forEach((function(className){return $el.addClass(className)})),""!==css.id&&$el.attr("id",css.id),$el.css(css.styles)),blockLevel?(w.nextMatch+=blockMatch[0].length,w.subWikify($el[0],"\\n?".concat(this.terminator))):w.subWikify($el[0],this.terminator)}}),Wikifier.Parser.add({name:"verbatimText",profiles:["core"],match:'"{3}|<[Nn][Oo][Ww][Ii][Kk][Ii]>',lookahead:/(?:"{3}((?:.|\n)*?)"{3})|(?:<[Nn][Oo][Ww][Ii][Kk][Ii]>((?:.|\n)*?)<\/[Nn][Oo][Ww][Ii][Kk][Ii]>)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createElement("span")).addClass("verbatim").text(match[1]||match[2]).appendTo(w.output))}}),Wikifier.Parser.add({name:"horizontalRule",profiles:["core"],match:"^----+$\\n?|<[Hh][Rr]\\s*/?>\\n?",handler:function(w){jQuery(document.createElement("hr")).appendTo(w.output)}}),Wikifier.Parser.add({name:"emdash",profiles:["core"],match:"--",handler:function(w){jQuery(document.createTextNode("—")).appendTo(w.output)}}),Wikifier.Parser.add({name:"doubleDollarSign",profiles:["core"],match:"\\${2}",handler:function(w){jQuery(document.createTextNode("$")).appendTo(w.output)}}),Wikifier.Parser.add({name:"nakedVariable",profiles:["core"],match:"".concat(Patterns.variable,"(?:(?:\\.").concat(Patterns.identifier,")|(?:\\[\\d+\\])|(?:\\[\"(?:\\\\.|[^\"\\\\])+\"\\])|(?:\\['(?:\\\\.|[^'\\\\])+'\\])|(?:\\[").concat(Patterns.variable,"\\]))*"),handler:function(w){var result=State.getVar(w.matchText);null==result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,"variable",w.matchText,w.matchText):w).output,stringFrom(result))}}),Wikifier.Parser.add({name:"template",profiles:["core"],match:"\\?".concat(Patterns.templateName),handler:function(w){var name=w.matchText.slice(1),template=Template.get(name),result=null;switch(template instanceof Array&&(template=template.random()),_typeof(template)){case"function":try{result=stringFrom(template.call({name:name}))}catch(ex){return throwError(w.output,"cannot execute function template ?".concat(name,": ").concat(ex.message),w.source.slice(w.matchStart,w.nextMatch))}break;case"string":result=template}null===result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,"template",w.matchText,w.matchText):w).output,result)}}),Wikifier.Parser.add({name:"heading",profiles:["block"],match:"^!{1,6}",terminator:"\\n",handler:function(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement("h".concat(w.matchLength))).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"table",profiles:["block"],match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookahead:/^\|([^\n]*)\|([fhck]?)$/gm,rowTerminator:"\\|(?:[cfhk]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[cfhk]?$\\n?)",cellTerminator:"(?:\\u0020*)\\|",rowTypes:{c:"caption",f:"tfoot",h:"thead","":"tbody"},handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){var matched,table=jQuery(document.createElement("table")).appendTo(w.output).get(0),prevColumns=[],curRowType=null,$rowContainer=null,rowCount=0;w.nextMatch=w.matchStart;do{this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch){var nextRowType=match[2];"k"===nextRowType?(table.className=match[1],w.nextMatch+=match[0].length+1):(nextRowType!==curRowType&&(curRowType=nextRowType,$rowContainer=jQuery(document.createElement(this.rowTypes[nextRowType])).appendTo(table)),"c"===curRowType?($rowContainer.css("caption-side",0===rowCount?"top":"bottom"),w.nextMatch+=1,w.subWikify($rowContainer[0],this.rowTerminator)):this.rowHandler(w,jQuery(document.createElement("tr")).appendTo($rowContainer).get(0),prevColumns),++rowCount)}}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))},rowHandler:function(w,rowEl,prevColumns){var matched,_this12=this,cellRe=new RegExp(this.cellPattern,"gm"),col=0,curColCount=1;do{cellRe.lastIndex=w.nextMatch;var cellMatch=cellRe.exec(w.source);if(matched=cellMatch&&cellMatch.index===w.nextMatch){if("~"===cellMatch[1]){var last=prevColumns[col];last&&(++last.rowCount,last.$element.attr("rowspan",last.rowCount).css("vertical-align","middle")),w.nextMatch=cellMatch.index+cellMatch[0].length-1}else if(">"===cellMatch[1])++curColCount,w.nextMatch=cellMatch.index+cellMatch[0].length-1;else{if(cellMatch[2]){w.nextMatch=cellMatch.index+cellMatch[0].length;break}!function(){++w.nextMatch;for(var css=Wikifier.helpers.inlineCss(w),spaceLeft=!1,spaceRight=!1,$cell=void 0;" "===w.source.substr(w.nextMatch,1);)spaceLeft=!0,++w.nextMatch;"!"===w.source.substr(w.nextMatch,1)?($cell=jQuery(document.createElement("th")).appendTo(rowEl),++w.nextMatch):$cell=jQuery(document.createElement("td")).appendTo(rowEl),prevColumns[col]={rowCount:1,$element:$cell},curColCount>1&&($cell.attr("colspan",curColCount),curColCount=1),w.subWikify($cell[0],_this12.cellTerminator)," "===w.matchText.substr(w.matchText.length-2,1)&&(spaceRight=!0),css.classes.forEach((function(className){return $cell.addClass(className)})),""!==css.id&&$cell.attr("id",css.id),spaceLeft&&spaceRight?css.styles["text-align"]="center":spaceLeft?css.styles["text-align"]="right":spaceRight&&(css.styles["text-align"]="left"),$cell.css(css.styles),w.nextMatch=w.nextMatch-1}()}++col}}while(matched)}}),Wikifier.Parser.add({name:"list",profiles:["block"],match:"^(?:(?:\\*+)|(?:#+))",lookahead:/^(?:(\*+)|(#+))/gm,terminator:"\\n",handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){w.nextMatch=w.matchStart;var matched,i,destStack=[w.output],curType=null,curLevel=0;do{this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch){var newType=match[2]?"ol":"ul",newLevel=match[0].length;if(w.nextMatch+=match[0].length,newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();else newLevel===curLevel&&newType!==curType&&(destStack.pop(),destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0)));curLevel=newLevel,curType=newType,w.subWikify(jQuery(document.createElement("li")).appendTo(destStack[destStack.length-1]).get(0),this.terminator)}}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"commentByBlock",profiles:["core"],match:"(?:/(?:%|\\*))|(?:\x3c!--)",lookahead:/(?:\/(%|\*)(?:(?:.|\n)*?)\1\/)|(?:<!--(?:(?:.|\n)*?)-->)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex)}}),Wikifier.Parser.add({name:"lineContinuation",profiles:["core"],match:"\\\\".concat(Patterns.spaceNoTerminator,"*\\n|\\n").concat(Patterns.spaceNoTerminator,"*\\\\|\\n?\\\\").concat(Patterns.spaceNoTerminator,"*$|^").concat(Patterns.spaceNoTerminator,"*\\\\\\n?"),handler:function(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:"lineBreak",profiles:["core"],match:"\\n|<[Bb][Rr]\\s*/?>",handler:function(w){w.options.nobr||jQuery(document.createElement("br")).appendTo(w.output)}}),Wikifier.Parser.add({name:"htmlCharacterReference",profiles:["core"],match:"(?:(?:&#?[0-9A-Za-z]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9A-Fa-f]|1D[C-Fc-f][0-9A-Fa-f]|20[D-Fd-f][0-9A-Fa-f]|FE2[0-9A-Fa-f])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[0-9A-Za-z]{2,8};)",handler:function(w){jQuery(document.createDocumentFragment()).append(w.matchText).appendTo(w.output)}}),Wikifier.Parser.add({name:"xmlProlog",profiles:["core"],match:"<\\?[Xx][Mm][Ll][^>]*\\?>",handler:function(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:"verbatimHtml",profiles:["core"],match:"<[Hh][Tt][Mm][Ll]>",lookahead:/<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:"verbatimScriptTag",profiles:["core"],match:"<[Ss][Cc][Rr][Ii][Pp][Tt][^>]*>",lookahead:/(<[Ss][Cc][Rr][Ii][Pp][Tt]*>(?:.|\n)*?<\/[Ss][Cc][Rr][Ii][Pp][Tt]>)/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:"styleTag",profiles:["core"],match:"<[Ss][Tt][Yy][Ll][Ee][^>]*>",lookahead:/(<[Ss][Tt][Yy][Ll][Ee]*>)((?:.|\n)*?)(<\/[Ss][Tt][Yy][Ll][Ee]>)/gm,imageMarkup:new RegExp(Patterns.cssImage,"g"),hasImageMarkup:new RegExp(Patterns.cssImage),handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){w.nextMatch=this.lookahead.lastIndex;var css=match[2];this.hasImageMarkup.test(css)&&(this.imageMarkup.lastIndex=0,css=css.replace(this.imageMarkup,(function(wikiImage){var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty("error")||markup.pos<wikiImage.length)return wikiImage;var source=markup.source;if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(source=passage.text)}return'url("'.concat(source.replace(/"/g,"%22"),'")')}))),jQuery(document.createDocumentFragment()).append(match[1]+css+match[3]).appendTo(w.output)}}}),Wikifier.Parser.add({name:"svgTag",profiles:["core"],match:"<[Ss][Vv][Gg][^>]*>",lookahead:/<(\/?)[Ss][Vv][Gg][^>]*>/gm,namespace:"http://www.w3.org/2000/svg",handler:function(w){var _this13=this;this.lookahead.lastIndex=w.nextMatch;for(var match,depth=1;depth>0&&null!==(match=this.lookahead.exec(w.source));)depth+="/"===match[1]?-1:1;if(0===depth){w.nextMatch=this.lookahead.lastIndex;var svgTag=w.source.slice(w.matchStart,this.lookahead.lastIndex),$frag=jQuery(document.createDocumentFragment()).append(svgTag);$frag.find("a[data-passage],image[data-passage]").each((function(_,el){var tagName=el.tagName.toLowerCase();try{_this13.processAttributeDirectives(el)}catch(ex){return throwError(w.output,"svg|<".concat(tagName,">: ").concat(ex.message),"".concat(w.matchText,"…"))}el.hasAttribute("data-passage")&&_this13.processDataAttributes(el,tagName)})),$frag.appendTo(w.output)}},processAttributeDirectives:function(el){_toConsumableArray(el.attributes).forEach((function(_ref10){var name=_ref10.name,value=_ref10.value,evalShorthand="@"===name[0];if(evalShorthand||name.startsWith("sc-eval:")){var result,newName=name.slice(evalShorthand?1:8);if("data-setter"===newName)throw new Error('evaluation directive is not allowed on the data-setter attribute: "'.concat(name,'"'));try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error('bad evaluation from attribute directive "'.concat(name,'": ').concat(ex.message))}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error('cannot transform attribute directive "'.concat(name,'" into attribute "').concat(newName,'"'))}}}))},processDataAttributes:function(el,tagName){var passage=el.getAttribute("data-passage");if(null!=passage){var evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute("data-passage",evaluated)),""!==passage)if("image"===tagName)"data:"!==passage.slice(0,5)&&Story.has(passage)&&(passage=Story.get(passage)).tags.includes("Twine.image")&&el.setAttribute("href",passage.text.trim());else{var setFn,setter=el.getAttribute("data-setter");null!=setter&&""!==(setter=String(setter).trim())&&(setFn=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(setter))),Story.has(passage)?(el.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add("link-visited")):el.classList.add("link-broken"),jQuery(el).ariaClick({one:!0},(function(){"function"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}}}),Wikifier.Parser.add({name:"htmlTag",profiles:["core"],match:"<".concat(Patterns.htmlTagName,"(?:\\s+[^\\u0000-\\u001F\\u007F-\\u009F\\s\"'>\\/=]+(?:\\s*=\\s*(?:\"[^\"]*?\"|'[^']*?'|[^\\s\"'=<>`]+))?)*\\s*\\/?>"),tagRe:new RegExp("^<(".concat(Patterns.htmlTagName,")")),mediaTags:["audio","img","source","track","video"],nobrTags:["audio","colgroup","datalist","dl","figure","meter","ol","optgroup","picture","progress","ruby","select","table","tbody","tfoot","thead","tr","ul","video"],voidTags:["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],handler:function(w){var tagMatch=this.tagRe.exec(w.matchText),tag=tagMatch&&tagMatch[1],tagName=tag&&tag.toLowerCase();if(tagName){var terminator,terminatorMatch,isVoid=this.voidTags.includes(tagName)||w.matchText.endsWith("/>"),isNobr=this.nobrTags.includes(tagName);if(!isVoid){terminator="<\\/".concat(tagName,"\\s*>");var terminatorRe=new RegExp(terminator,"gim");terminatorRe.lastIndex=w.matchStart,terminatorMatch=terminatorRe.exec(w.source)}if(!isVoid&&!terminatorMatch)return throwError(w.output,"cannot find a closing tag for HTML <".concat(tag,">"),"".concat(w.matchText,"…"));var debugView,output=w.output,el=document.createElement(w.output.tagName);for(el.innerHTML=w.matchText;el.firstChild;)el=el.firstChild;try{this.processAttributeDirectives(el)}catch(ex){return throwError(w.output,"<".concat(tagName,">: ").concat(ex.message),"".concat(w.matchText,"…"))}if(el.hasAttribute("data-passage")&&(this.processDataAttributes(el,tagName),Config.debug&&((debugView=new DebugView(w.output,"html-".concat(tagName),tagName,w.matchText)).modes({block:"img"===tagName,nonvoid:terminatorMatch}),output=debugView.output)),terminatorMatch){try{Wikifier.Option.push({nobr:isNobr}),w.subWikify(el,terminator,{ignoreTerminatorCase:!0})}finally{Wikifier.Option.pop()}debugView&&jQuery(el).find(".debug.block").length>0&&debugView.modes({block:!0})}output.appendChild("track"===tagName?el.cloneNode(!0):el)}},processAttributeDirectives:function(el){_toConsumableArray(el.attributes).forEach((function(_ref11){var name=_ref11.name,value=_ref11.value,evalShorthand="@"===name[0];if(evalShorthand||name.startsWith("sc-eval:")){var result,newName=name.slice(evalShorthand?1:8);if("data-setter"===newName)throw new Error('evaluation directive is not allowed on the data-setter attribute: "'.concat(name,'"'));try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error('bad evaluation from attribute directive "'.concat(name,'": ').concat(ex.message))}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error('cannot transform attribute directive "'.concat(name,'" into attribute "').concat(newName,'"'))}}}))},processDataAttributes:function(el,tagName){var passage=el.getAttribute("data-passage");if(null!=passage){var evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute("data-passage",evaluated)),""!==passage)if(this.mediaTags.includes(tagName)){if("data:"!==passage.slice(0,5)&&Story.has(passage)){var parentName,twineTag;switch(passage=Story.get(passage),tagName){case"audio":case"video":twineTag="Twine.".concat(tagName);break;case"img":twineTag="Twine.image";break;case"track":twineTag="Twine.vtt";break;case"source":var $parent=$(el).closest("audio,picture,video");$parent.length&&(parentName=$parent.get(0).tagName.toLowerCase(),twineTag="Twine.".concat("picture"===parentName?"image":parentName))}passage.tags.includes(twineTag)&&(el["picture"===parentName?"srcset":"src"]=passage.text.trim())}}else{var setFn,setter=el.getAttribute("data-setter");null!=setter&&""!==(setter=String(setter).trim())&&(setFn=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(setter))),Story.has(passage)?(el.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add("link-visited")):el.classList.add("link-broken"),jQuery(el).ariaClick({one:!0},(function(){"function"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}}})}();var Template=(_templates=new Map,_validNameRe=new RegExp("^(?:".concat(Patterns.templateName,")$")),_validType=function(template){var templateType=_typeof(template);return"function"===templateType||"string"===templateType},Object.freeze(Object.defineProperties({},{add:{value:function(name,template){if(!(_validType(template)||template instanceof Array&&template.length>0&&template.every(_validType)))throw new TypeError("invalid template type (".concat(name,"); templates must be: functions, strings, or an array of either"));(name instanceof Array?name:[name]).forEach((function(name){if(!_validNameRe.test(name))throw new Error('invalid template name "'.concat(name,'"'));if(_templates.has(name))throw new Error("cannot clobber existing template ?".concat(name));_templates.set(name,template)}))}},delete:{value:function(name){(name instanceof Array?name:[name]).forEach((function(name){return _templates.delete(name)}))}},get:{value:function(name){return _templates.has(name)?_templates.get(name):null}},has:{value:function(name){return _templates.has(name)}},size:{get:function(){return _templates.size}}}))),_templates,_validNameRe,_validType,Macro=function(){var _macros={},_tags={},_validNameRe=new RegExp("^(?:".concat(Patterns.macroName,")$"));function macrosHas(name){return _macros.hasOwnProperty(name)}function tagsRegister(parent,bodyTags){if(!parent)throw new Error("no parent specified");for(var endTags=["/".concat(parent),"end".concat(parent)],allTags=[].concat(endTags,Array.isArray(bodyTags)?bodyTags:[]),i=0;i<allTags.length;++i){var tag=allTags[i];if(macrosHas(tag))throw new Error("cannot register tag for an existing macro");tagsHas(tag)?_tags[tag].includes(parent)||(_tags[tag].push(parent),_tags[tag].sort()):_tags[tag]=[parent]}}function tagsUnregister(parent){if(!parent)throw new Error("no parent specified");Object.keys(_tags).forEach((function(tag){var i=_tags[tag].indexOf(parent);-1!==i&&(1===_tags[tag].length?delete _tags[tag]:_tags[tag].splice(i,1))}))}function tagsHas(name){return _tags.hasOwnProperty(name)}return Object.freeze(Object.defineProperties({},{add:{value:function macrosAdd(name,def){if(Array.isArray(name))name.forEach((function(name){return macrosAdd(name,def)}));else{if(!_validNameRe.test(name))throw new Error('invalid macro name "'.concat(name,'"'));if(macrosHas(name))throw new Error("cannot clobber existing macro <<".concat(name,">>"));if(tagsHas(name))throw new Error("cannot clobber child tag <<".concat(name,">> of parent macro").concat(1===_tags[name].length?"":"s"," <<").concat(_tags[name].join(">>, <<"),">>"));try{if("object"===_typeof(def))_macros[name]=Object.assign(Object.create(null),def,{_MACRO_API:!0});else{if(!macrosHas(def))throw new Error("cannot create alias of nonexistent macro <<".concat(def,">>"));_macros[name]=Object.create(_macros[def],{_ALIAS_OF:{enumerable:!0,value:def}})}Object.defineProperty(_macros,name,{writable:!1})}catch(ex){throw"TypeError"===ex.name?new Error("cannot clobber protected macro <<".concat(name,">>")):new Error("unknown error when attempting to add macro <<".concat(name,">>: [").concat(ex.name,"] ").concat(ex.message))}if(void 0!==_macros[name].tags)if(null==_macros[name].tags)tagsRegister(name);else{if(!Array.isArray(_macros[name].tags))throw new Error('bad value for "tags" property of macro <<'.concat(name,">>"));tagsRegister(name,_macros[name].tags)}}}},delete:{value:function macrosDelete(name){if(Array.isArray(name))name.forEach((function(name){return macrosDelete(name)}));else if(macrosHas(name)){void 0!==_macros[name].tags&&tagsUnregister(name);try{Object.defineProperty(_macros,name,{writable:!0}),delete _macros[name]}catch(ex){throw new Error("unknown error removing macro <<".concat(name,">>: ").concat(ex.message))}}else if(tagsHas(name))throw new Error("cannot remove child tag <<".concat(name,">> of parent macro <<").concat(_tags[name],">>"))}},isEmpty:{value:function(){return 0===Object.keys(_macros).length}},has:{value:macrosHas},get:{value:function(name){var macro=null;return macrosHas(name)&&"function"==typeof _macros[name].handler?macro=_macros[name]:macros.hasOwnProperty(name)&&"function"==typeof macros[name].handler&&(macro=macros[name]),macro}},init:{value:function(){var handler=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"init";Object.keys(_macros).forEach((function(name){"function"==typeof _macros[name][handler]&&_macros[name][handler](name)})),Object.keys(macros).forEach((function(name){"function"==typeof macros[name][handler]&&macros[name][handler](name)}))}},tags:{value:Object.freeze(Object.defineProperties({},{register:{value:tagsRegister},unregister:{value:tagsUnregister},has:{value:tagsHas},get:{value:function(name){return tagsHas(name)?_tags[name]:null}}}))},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),MacroContext=function(){var MacroContext=function(){function MacroContext(contextData){_classCallCheck(this,MacroContext);var context=Object.assign({parent:null,macro:null,name:"",displayName:"",args:null,payload:null,parser:null,source:""},contextData);if(null===context.macro||""===context.name||null===context.parser)throw new TypeError("context object missing required properties");Object.defineProperties(this,{self:{value:context.macro},name:{value:void 0===context.macro._ALIAS_OF?context.name:context.macro._ALIAS_OF},displayName:{value:context.name},args:{value:context.args},payload:{value:context.payload},source:{value:context.source},parent:{value:context.parent},parser:{value:context.parser},_output:{value:context.parser.output},_shadows:{writable:!0,value:null},_debugView:{writable:!0,value:null},_debugViewEnabled:{writable:!0,value:Config.debug}})}return _createClass(MacroContext,[{key:"output",get:function(){return this._debugViewEnabled?this.debugView.output:this._output}},{key:"shadows",get:function(){return _toConsumableArray(this._shadows)}},{key:"shadowView",get:function(){var view=new Set;return this.contextSelectAll((function(ctx){return ctx._shadows})).forEach((function(ctx){return ctx._shadows.forEach((function(name){return view.add(name)}))})),_toConsumableArray(view)}},{key:"debugView",get:function(){return this._debugViewEnabled?null!==this._debugView?this._debugView:this.createDebugView():null}},{key:"contextHas",value:function(filter){for(var context=this;null!==(context=context.parent);)if(filter(context))return!0;return!1}},{key:"contextSelect",value:function(filter){for(var context=this;null!==(context=context.parent);)if(filter(context))return context;return null}},{key:"contextSelectAll",value:function(filter){for(var result=[],context=this;null!==(context=context.parent);)filter(context)&&result.push(context);return result}},{key:"addShadow",value:function(){var _this14=this;this._shadows||(this._shadows=new Set);for(var varRe=new RegExp("^".concat(Patterns.variable,"$")),_len14=arguments.length,names=new Array(_len14),_key14=0;_key14<_len14;_key14++)names[_key14]=arguments[_key14];names.flat(1/0).forEach((function(name){if("string"!=typeof name)throw new TypeError("variable name must be a string; type: ".concat(_typeof(name)));if(!varRe.test(name))throw new Error('invalid variable name "'.concat(name,'"'));_this14._shadows.add(name)}))}},{key:"createShadowWrapper",value:function(callback,doneCallback,startCallback){var shadowStore,shadowContext=this;return"function"==typeof callback&&(shadowStore={},this.shadowView.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]}))),function(){for(var _len15=arguments.length,args=new Array(_len15),_key15=0;_key15<_len15;_key15++)args[_key15]=arguments[_key15];if("function"==typeof startCallback&&startCallback.apply(this,args),"function"==typeof callback){var contextCache,shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null,macroParser=Wikifier.Parser.get("macro");try{shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),contextCache=macroParser.context,macroParser.context=shadowContext,callback.apply(this,args)}finally{contextCache!==undefined&&(macroParser.context=contextCache),shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}"function"==typeof doneCallback&&doneCallback.apply(this,args)}}},{key:"createDebugView",value:function(name,title){return this._debugView=new DebugView(this._output,"macro",name||this.displayName,title||this.source),null!==this.payload&&this.payload.length>0&&this._debugView.modes({nonvoid:!0}),this._debugViewEnabled=!0,this._debugView}},{key:"removeDebugView",value:function(){null!==this._debugView&&(this._debugView.remove(),this._debugView=null),this._debugViewEnabled=!1}},{key:"error",value:function(message,source){return throwError(this._output,"<<".concat(this.displayName,">>: ").concat(message),source||this.source)}}]),MacroContext}();return MacroContext}();!function(){if(Macro.add("capture",{skipArgs:!0,tags:null,tsVarRe:new RegExp("(".concat(Patterns.variable,")"),"g"),handler:function(){if(0===this.args.raw.length)return this.error("no story/temporary variable list specified");var valueCache={};try{for(var match,tsVarRe=this.self.tsVarRe;null!==(match=tsVarRe.exec(this.args.raw));){var varName=match[1],varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),this.addShadow(varName)}new Wikifier(this.output,this.payload[0].contents)}finally{this.shadows.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}),Macro.add("set",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("unset",{skipArgs:!0,jsVarRe:new RegExp("State\\.(variables|temporary)\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no story/temporary variable list specified");for(var match,jsVarRe=this.self.jsVarRe;null!==(match=jsVarRe.exec(this.args.full));){var store=State[match[1]],name=match[2];store.hasOwnProperty(name)&&delete store[name]}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remember",{skipArgs:!0,jsVarRe:new RegExp("State\\.variables\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}for(var match,remember=storage.get("remember")||{},jsVarRe=this.self.jsVarRe;null!==(match=jsVarRe.exec(this.args.full));){var name=match[1];remember[name]=State.variables[name]}if(!storage.set("remember",remember))return this.error("unknown error, cannot remember: ".concat(this.args.raw));Config.debug&&this.debugView.modes({hidden:!0})},init:function(){var remember=storage.get("remember");remember&&Object.keys(remember).forEach((function(name){return State.variables[name]=remember[name]}))}}),Macro.add("forget",{skipArgs:!0,jsVarRe:new RegExp("State\\.variables\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no story variable list specified");for(var match,remember=storage.get("remember"),jsVarRe=this.self.jsVarRe,needStore=!1;null!==(match=jsVarRe.exec(this.args.full));){var name=match[1];State.variables.hasOwnProperty(name)&&delete State.variables[name],remember&&remember.hasOwnProperty(name)&&(needStore=!0,delete remember[name])}if(needStore)if(0===Object.keys(remember).length){if(!storage.delete("remember"))return this.error("unknown error, cannot update remember store")}else if(!storage.set("remember",remember))return this.error("unknown error, cannot update remember store");Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("run","set"),Macro.add("script",{skipArgs:!0,tags:null,handler:function(){var output=document.createDocumentFragment();try{Scripting.evalJavaScript(this.payload[0].contents,output)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}Config.debug&&this.createDebugView(),output.hasChildNodes()&&this.output.appendChild(output)}}),Macro.add("include",{handler:function(){return 0===this.args.length?this.error("no passage specified"):(passage="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],Story.has(passage)?(Config.debug&&this.debugView.modes({block:!0}),passage=Story.get(passage),void(this.args[1]?jQuery(document.createElement(this.args[1])).addClass("".concat(passage.domId," macro-").concat(this.name)).attr("data-passage",passage.title).appendTo(this.output):jQuery(this.output)).wiki(passage.processText())):this.error('passage "'.concat(passage,'" does not exist')));var passage}}),Macro.add("nobr",{skipArgs:!0,tags:null,handler:function(){new Wikifier(this.output,this.payload[0].contents.replace(/^\n+|\n+$/g,"").replace(/\n+/g," "))}}),Macro.add(["print","=","-"],{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{var result=stringFrom(Scripting.evalJavaScript(this.args.full));null!==result&&new Wikifier(this.output,"-"===this.name?Util.escape(result):result)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}}}),Macro.add("silently",{skipArgs:!0,tags:null,handler:function(){var frag=document.createDocumentFragment();if(new Wikifier(frag,this.payload[0].contents.trim()),Config.debug)this.debugView.modes({block:!0,hidden:!0}),this.output.appendChild(frag);else{var errList=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent}));if(errList.length>0)return this.error("error".concat(1===errList.length?"":"s"," within contents (").concat(errList.join("; "),")"))}}}),Macro.add("type",{isAsync:!0,tags:null,typeId:0,handler:function(){if(0===this.args.length)return this.error("no speed specified");var cursor,speed=Util.fromCssTime(this.args[0]);if(speed<0)return this.error("speed time value must be non-negative (received: ".concat(this.args[0],")"));for(var elClass="",elId="",elTag="div",skipKey=Config.macros.typeSkipKey,start=400,options=this.args.slice(1);options.length>0;){var option=options.shift();switch(option){case"class":if(0===options.length)return this.error("class option missing required class name(s)");if(""===(elClass=options.shift()))throw new Error('class option class name(s) must be non-empty (received: "")');break;case"element":if(0===options.length)return this.error("element option missing required element tag name");if(""===(elTag=options.shift()))throw new Error('element option tag name must be non-empty (received: "")');break;case"id":if(0===options.length)return this.error("id option missing required ID");if(""===(elId=options.shift()))throw new Error('id option ID must be non-empty (received: "")');break;case"keep":cursor="keep";break;case"none":cursor="none";break;case"skipkey":if(0===options.length)return this.error("skipkey option missing required key value");if(""===(skipKey=options.shift()))throw new Error('skipkey option key value must be non-empty (received: "")');break;case"start":if(0===options.length)return this.error("start option missing required time value");var value=options.shift();if((start=Util.fromCssTime(value))<0)throw new Error("start option time value must be non-negative (received: ".concat(value,")"));break;default:return this.error("unknown option: ".concat(option))}}var contents=this.payload[0].contents;if(""!==contents.trim()){Config.debug&&this.debugView.modes({block:!0});var className="macro-".concat(this.name),namespace=".".concat(className),$target=jQuery(document.createElement(elTag)).addClass("".concat(className," ").concat(className,"-target")).appendTo(this.output);TempState.macroTypeQueue||(TempState.macroTypeQueue=[],$(document).off(namespace).one(":passageinit".concat(namespace),(function(){return $(document).off(namespace)})));var startTyping=0===TempState.macroTypeQueue.length,selfId=++this.self.typeId;TempState.macroTypeQueue.push({id:selfId,handler:function(){var $wrapper=jQuery(document.createElement(elTag)).addClass(className);elId&&$wrapper.attr("id",elId),elClass&&$wrapper.addClass(elClass),new Wikifier($wrapper,contents);var passage=State.passage,turn=State.turns;if(!Config.macros.typeVisitedPassages&&State.passages.slice(0,-1).some((function(title){return title===passage}))||$wrapper.find(".error").length>0)return $target.replaceWith($wrapper),TempState.macroTypeQueue.shift(),void(TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().handler());var typer=new NodeTyper({targetNode:$wrapper.get(0),classNames:"none"===cursor?null:"".concat(className,"-cursor")});$target.replaceWith($wrapper);var keydownAndNS="keydown".concat(namespace),typingStopAndNS="".concat(":typingstop").concat(namespace);$(document).off(keydownAndNS).on(keydownAndNS,(function(ev){Util.scrubEventKey(ev.key)!==skipKey||ev.target!==document.body&&ev.target!==document.documentElement||(ev.preventDefault(),$(document).off(keydownAndNS),typer.finish())})).one(typingStopAndNS,(function(){TempState.macroTypeQueue&&(0===TempState.macroTypeQueue.length?jQuery.event.trigger(":typingcomplete"):TempState.macroTypeQueue.first().handler())}));var typeNode=function(){var typeNodeMember=function(typeIntervalId){State.passage===passage&&State.turns===turn&&typer.type()||(typeIntervalId&&clearInterval(typeIntervalId),TempState.macroTypeQueue&&TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().id===selfId&&TempState.macroTypeQueue.shift(),$wrapper.trigger(":typingstop"),$wrapper.addClass("".concat(className,"-done")),"keep"===cursor&&$wrapper.addClass("".concat(className,"-cursor")))};$wrapper.trigger(":typingstart"),typeNodeMember();var typeNodeMemberId=setInterval((function(){return typeNodeMember(typeNodeMemberId)}),speed)};start?setTimeout(typeNode,start):typeNode()}}),startTyping&&(Engine.isPlaying()?$(document).one(":passageend".concat(namespace),(function(){return TempState.macroTypeQueue.first().handler()})):TempState.macroTypeQueue.first().handler())}}}),Macro.add("display","include"),Macro.add("if",{skipArgs:!0,tags:["elseif","else"],elseifWsRe:/^\s*if\b/i,ifAssignRe:/[^!=&^|<>*/%+-]=[^=>]/,handler:function(){var i;try{var len=this.payload.length,elseifWsRe=this.self.elseifWsRe,ifAssignRe=this.self.ifAssignRe;for(i=0;i<len;++i)if("else"===this.payload[i].name){if(this.payload[i].args.raw.length>0)return elseifWsRe.test(this.payload[i].args.raw)?this.error('whitespace is not allowed between the "else" and "if" in <<elseif>> clause'.concat(i>0?" (#"+i+")":"")):this.error("<<else>> does not accept a conditional expression (perhaps you meant to use <<elseif>>), invalid: ".concat(this.payload[i].args.raw));if(i+1!==len)return this.error("<<else>> must be the final clause")}else{if(0===this.payload[i].args.full.length)return this.error("no conditional expression specified for <<".concat(this.payload[i].name,">> clause").concat(i>0?" (#"+i+")":""));if(Config.macros.ifAssignmentError&&ifAssignRe.test(this.payload[i].args.full))return this.error("assignment operator found within <<".concat(this.payload[i].name,">> clause").concat(i>0?" (#"+i+")":""," (perhaps you meant to use an equality operator: ==, ===, eq, is), invalid: ").concat(this.payload[i].args.raw))}var evalJavaScript=Scripting.evalJavaScript,success=!1;for(i=0;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),"else"===this.payload[i].name||evalJavaScript(this.payload[i].args.full)){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!success,invalid:!success})}}catch(ex){return this.error("bad conditional expression in <<".concat(0===i?"if":"elseif",">> clause").concat(i>0?" (#"+i+")":"",": ").concat("object"===_typeof(ex)?ex.message:ex))}}}),Macro.add("switch",{skipArgs:["switch"],tags:["case","default"],handler:function(){if(0===this.args.full.length)return this.error("no expression specified");var i,result,len=this.payload.length;if(1===len)return this.error("no cases specified");for(i=1;i<len;++i)if("default"===this.payload[i].name){if(this.payload[i].args.length>0)return this.error("<<default>> does not accept values, invalid: ".concat(this.payload[i].args.raw));if(i+1!==len)return this.error("<<default>> must be the final case")}else if(0===this.payload[i].args.length)return this.error("no value(s) specified for <<".concat(this.payload[i].name,">> (#").concat(i,")"));try{result=Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}var debugView=this.debugView,success=!1;for(Config.debug&&debugView.modes({nonvoid:!1,hidden:!0}),i=1;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),"default"===this.payload[i].name||this.payload[i].args.some((function(val){return val===result}))){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});debugView.modes({nonvoid:!1,hidden:!0,invalid:!success}),this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0,invalid:!success})}}}),Macro.add("for",{skipArgs:!0,tags:null,hasRangeRe:new RegExp("^\\S".concat(Patterns.anyChar,"*?\\s+range\\s+\\S").concat(Patterns.anyChar,"*?$")),rangeRe:new RegExp("^(?:State\\.(variables|temporary)\\.(".concat(Patterns.identifier,")\\s*,\\s*)?State\\.(variables|temporary)\\.(").concat(Patterns.identifier,")\\s+range\\s+(\\S").concat(Patterns.anyChar,"*?)$")),threePartRe:/^([^;]*?)\s*;\s*([^;]*?)\s*;\s*([^;]*?)$/,forInRe:/^\S+\s+in\s+\S+/i,forOfRe:/^\S+\s+of\s+\S+/i,handler:function(){var argsStr=this.args.full.trim(),payload=this.payload[0].contents.replace(/\n$/,"");if(0===argsStr.length)this.self.handleFor.call(this,payload,null,!0,null);else if(this.self.hasRangeRe.test(argsStr)){var parts=argsStr.match(this.self.rangeRe);if(null===parts)return this.error("invalid range form syntax, format: [index ,] value range collection");this.self.handleForRange.call(this,payload,{type:parts[1],name:parts[2]},{type:parts[3],name:parts[4]},parts[5])}else{var init,condition,post;if(-1===argsStr.indexOf(";")){if(this.self.forInRe.test(argsStr))return this.error("invalid syntax, for…in is not supported; see: for…range");if(this.self.forOfRe.test(argsStr))return this.error("invalid syntax, for…of is not supported; see: for…range");condition=argsStr}else{var _parts=argsStr.match(this.self.threePartRe);if(null===_parts)return this.error("invalid 3-part conditional form syntax, format: [init] ; [condition] ; [post]");init=_parts[1],condition=_parts[2].trim(),post=_parts[3],0===condition.length&&(condition=!0)}this.self.handleFor.call(this,payload,init,condition,post)}},handleFor:function(payload,init,condition,post){var evalJavaScript=Scripting.evalJavaScript,first=!0,safety=Config.macros.maxLoopIterations;Config.debug&&this.debugView.modes({block:!0});try{if(TempState.break=null,init)try{evalJavaScript(init)}catch(ex){return this.error("bad init expression: ".concat("object"===_typeof(ex)?ex.message:ex))}for(;evalJavaScript(condition);){if(--safety<0)return this.error("exceeded configured maximum loop iterations (".concat(Config.macros.maxLoopIterations,")"));if(new Wikifier(this.output,first?payload.replace(/^\n/,""):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}if(post)try{evalJavaScript(post)}catch(ex){return this.error("bad post expression: ".concat("object"===_typeof(ex)?ex.message:ex))}}}catch(ex){return this.error("bad conditional expression: ".concat("object"===_typeof(ex)?ex.message:ex))}finally{TempState.break=null}},handleForRange:function(payload,indexVar,valueVar,rangeExp){var rangeList,first=!0;try{rangeList=this.self.toRangeList(rangeExp)}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});try{TempState.break=null;for(var i=0;i<rangeList.length;++i)if(indexVar.name&&(State[indexVar.type][indexVar.name]=rangeList[i][0]),State[valueVar.type][valueVar.name]=rangeList[i][1],new Wikifier(this.output,first?payload.replace(/^\n/,""):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}}catch(ex){return this.error("object"===_typeof(ex)?ex.message:ex)}finally{TempState.break=null}},toRangeList:function(rangeExp){var value,list,evalJavaScript=Scripting.evalJavaScript;try{value=evalJavaScript("{"===rangeExp[0]?"(".concat(rangeExp,")"):rangeExp)}catch(ex){if("object"!==_typeof(ex))throw new Error("bad range expression: ".concat(ex));throw ex.message="bad range expression: ".concat(ex.message),ex}switch(_typeof(value)){case"string":list=[];for(var i=0;i<value.length;){var obj=Util.charAndPosAt(value,i);list.push([i,obj.char]),i=1+obj.end}break;case"object":if(Array.isArray(value))list=value.map((function(val,i){return[i,val]}));else if(value instanceof Set)list=_toConsumableArray(value).map((function(val,i){return[i,val]}));else if(value instanceof Map)list=_toConsumableArray(value.entries());else{if("Object"!==Util.toStringTag(value))throw new Error("unsupported range expression type: ".concat(Util.toStringTag(value)));list=Object.keys(value).map((function(key){return[key,value[key]]}))}break;default:throw new Error("unsupported range expression type: ".concat(_typeof(value)))}return list}}),Macro.add(["break","continue"],{skipArgs:!0,handler:function(){if(!this.contextHas((function(ctx){return"for"===ctx.name})))return this.error("must only be used in conjunction with its parent macro <<for>>");TempState.break="continue"===this.name?1:2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["button","link"],{isAsync:!0,tags:null,handler:function(){var _this15=this;if(0===this.args.length)return this.error("no ".concat("button"===this.name?"button":"link"," text specified"));var passage,$link=jQuery(document.createElement("button"===this.name?"button":"a"));if("object"===_typeof(this.args[0]))if(this.args[0].isImage){var $image=jQuery(document.createElement("img")).attr("src",this.args[0].source).appendTo($link);$link.addClass("link-image"),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),passage=this.args[0].link}else $link.append(document.createTextNode(this.args[0].text)),passage=this.args[0].link;else $link.wikiWithOptions({profile:"core"},this.args[0]),passage=this.args.length>1?this.args[1]:undefined;null!=passage?($link.attr("data-passage",passage),Story.has(passage)?($link.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass("link-visited")):$link.addClass("link-broken")):$link.addClass("link-internal"),$link.addClass("macro-".concat(this.name)).ariaClick({namespace:".macros",role:null!=passage?"link":"button",one:null!=passage},this.createShadowWrapper(""!==this.payload[0].contents?function(){return Wikifier.wikifyEval(_this15.payload[0].contents.trim())}:null,null!=passage?function(){return Engine.play(passage)}:null)).appendTo(this.output)}}),Macro.add("checkbox",{isAsync:!0,handler:function(){if(this.args.length<3){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("unchecked value"),this.args.length<3&&errors.push("checked value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),uncheckValue=this.args[1],checkValue=this.args[2],el=document.createElement("input");switch(jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),type:"checkbox",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,this.checked?checkValue:uncheckValue)}))).appendTo(this.output),this.args[3]){case"autocheck":State.getVar(varName)===checkValue?el.checked=!0:State.setVar(varName,uncheckValue);break;case"checked":el.checked=!0,State.setVar(varName,checkValue);break;default:State.setVar(varName,uncheckValue)}}}),Macro.add(["cycle","listbox"],{isAsync:!0,skipArgs:["optionsfrom"],tags:["option","optionsfrom"],handler:function(){var _this16=this;if(0===this.args.length)return this.error("no variable name specified");if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),len=this.payload.length;if(1===len)return this.error("no options specified");for(var config={autoselect:!1,once:!1},i=1;i<this.args.length;++i){var arg=this.args[i];switch(arg){case"once":config.once=!0;break;case"autoselect":config.autoselect=!0;break;default:return this.error("unknown argument: ".concat(arg))}}for(var options=[],tagCount={option:0,optionsfrom:0},selectedIdx=-1,_i5=1;_i5<len;++_i5){var payload=this.payload[_i5];if("option"===payload.name){if(++tagCount.option,0===payload.args.length)return this.error("no arguments specified for <<".concat(payload.name,">> (#").concat(tagCount.option,")"));var option={label:String(payload.args[0])},isSelected=!1;switch(payload.args.length){case 1:option.value=payload.args[0];break;case 2:"selected"===payload.args[1]?(option.value=payload.args[0],isSelected=!0):option.value=payload.args[1];break;default:option.value=payload.args[1],"selected"===payload.args[2]&&(isSelected=!0)}if(options.push(option),isSelected){if(config.autoselect)return this.error("cannot specify both the autoselect and selected keywords");if(-1!==selectedIdx)return this.error("multiple selected keywords specified for <<".concat(payload.name,">> (#").concat(selectedIdx+1," & #").concat(tagCount.option,")"));selectedIdx=options.length-1}}else{var _ret=function(){if(++tagCount.optionsfrom,0===payload.args.full.length)return{v:_this16.error("no expression specified for <<".concat(payload.name,">> (#").concat(tagCount.optionsfrom,")"))};var result=void 0;try{var exp=payload.args.full;result=Scripting.evalJavaScript("{"===exp[0]?"(".concat(exp,")"):exp)}catch(ex){return{v:_this16.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}}if("object"!==_typeof(result)||null===result)return{v:_this16.error("expression must yield a supported collection or generic object (type: ".concat(null===result?"null":_typeof(result),")"))};if(result instanceof Array||result instanceof Set)result.forEach((function(val){return options.push({label:String(val),value:val})}));else if(result instanceof Map)result.forEach((function(val,key){return options.push({label:String(key),value:val})}));else{var oType=Util.toStringTag(result);if("Object"!==oType)return{v:_this16.error("expression must yield a supported collection or generic object (object type: ".concat(oType,")"))};Object.keys(result).forEach((function(key){return options.push({label:key,value:result[key]})}))}}();if("object"===_typeof(_ret))return _ret.v}}if(-1===selectedIdx)if(config.autoselect){var sameValueZero=Util.sameValueZero,curValue=State.getVar(varName),curValueIdx=options.findIndex((function(opt){return sameValueZero(opt.value,curValue)}));selectedIdx=-1===curValueIdx?0:curValueIdx}else selectedIdx=0;if("cycle"===this.name){var lastIdx=options.length-1;if(config.once&&selectedIdx===lastIdx)jQuery(this.output).wikiWithOptions({profile:"core"},options[selectedIdx].label);else{var cycleIdx=selectedIdx;jQuery(document.createElement("a")).wikiWithOptions({profile:"core"},options[selectedIdx].label).attr("id","".concat(this.name,"-").concat(varId)).addClass("macro-".concat(this.name)).ariaClick({namespace:".macros",role:"button"},this.createShadowWrapper((function(){var $this=$(this);cycleIdx=(cycleIdx+1)%options.length,State.setVar(varName,options[cycleIdx].value),$this.empty().wikiWithOptions({profile:"core"},options[cycleIdx].label),config.once&&cycleIdx===lastIdx&&$this.off().contents().unwrap()}))).appendTo(this.output)}}else{var $select=jQuery(document.createElement("select"));options.forEach((function(opt,i){jQuery(document.createElement("option")).val(i).text(opt.label).appendTo($select)})),$select.attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),tabindex:0}).addClass("macro-".concat(this.name)).val(selectedIdx).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,options[Number(this.value)].value)}))).appendTo(this.output)}State.setVar(varName,options[selectedIdx].value)}}),Macro.add(["linkappend","linkprepend","linkreplace"],{isAsync:!0,tags:null,t8nRe:/^(?:transition|t8n)$/,handler:function(){var _this17=this;if(0===this.args.length)return this.error("no link text specified");var $link=jQuery(document.createElement("a")),$insert=jQuery(document.createElement("span")),transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]);$link.wikiWithOptions({profile:"core"},this.args[0]).addClass("link-internal macro-".concat(this.name)).ariaClick({namespace:".macros",one:!0},this.createShadowWrapper((function(){if("linkreplace"===_this17.name?$link.remove():$link.wrap('<span class="macro-'.concat(_this17.name,'"></span>')).replaceWith((function(){return $link.html()})),""!==_this17.payload[0].contents){var frag=document.createDocumentFragment();new Wikifier(frag,_this17.payload[0].contents),$insert.append(frag)}transition&&setTimeout((function(){return $insert.removeClass("macro-".concat(_this17.name,"-in"))}),Engine.minDomActionDelay)}))).appendTo(this.output),$insert.addClass("macro-".concat(this.name,"-insert")),transition&&$insert.addClass("macro-".concat(this.name,"-in")),"linkprepend"===this.name?$insert.insertBefore($link):$insert.insertAfter($link)}}),Macro.add(["numberbox","textbox"],{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));Config.debug&&this.debugView.modes({block:!0});var asNumber="numberbox"===this.name,defaultValue=asNumber?Number(this.args[1]):this.args[1];if(asNumber&&Number.isNaN(defaultValue))return this.error('default value "'.concat(this.args[1],'" is neither a number nor can it be parsed into a number'));var passage,varId=Util.slugify(varName),el=document.createElement("input"),autofocus=!1;this.args.length>3?(passage=this.args[2],autofocus="autofocus"===this.args[3]):this.args.length>2&&("autofocus"===this.args[2]?autofocus=!0:passage=this.args[2]),"object"===_typeof(passage)&&(passage=passage.link),jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),type:asNumber?"number":"text",inputmode:asNumber?"decimal":"text",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,asNumber?Number(this.value):this.value)}))).on("keypress.macros",this.createShadowWrapper((function(ev){13===ev.which&&(ev.preventDefault(),State.setVar(varName,asNumber?Number(this.value):this.value),null!=passage&&Engine.play(passage))}))).appendTo(this.output),asNumber&&(el.step="any"),State.setVar(varName,defaultValue),el.value=defaultValue,autofocus&&(el.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:".concat(el.id)]=function(task){delete postdisplay[task],setTimeout((function(){return el.focus()}),Engine.minDomActionDelay)})}}),Macro.add("radiobutton",{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("checked value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),checkValue=this.args[1],el=document.createElement("input");switch(TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(varId)||(TempState[this.name][varId]=0),jQuery(el).attr({id:"".concat(this.name,"-").concat(varId,"-").concat(TempState[this.name][varId]++),name:"".concat(this.name,"-").concat(varId),type:"radio",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){this.checked&&State.setVar(varName,checkValue)}))).appendTo(this.output),this.args[2]){case"autocheck":State.getVar(varName)===checkValue&&(el.checked=!0);break;case"checked":el.checked=!0,State.setVar(varName,checkValue)}}}),Macro.add("textarea",{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));Config.debug&&this.debugView.modes({block:!0});var varId=Util.slugify(varName),defaultValue=this.args[1],autofocus="autofocus"===this.args[2],el=document.createElement("textarea");jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),rows:4,tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,this.value)}))).appendTo(this.output),State.setVar(varName,defaultValue),el.textContent=defaultValue,autofocus&&(el.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:".concat(el.id)]=function(task){delete postdisplay[task],setTimeout((function(){return el.focus()}),Engine.minDomActionDelay)})}}),Macro.add("click","link"),Macro.add("actions",{handler:function(){for(var $list=jQuery(document.createElement("ul")).addClass(this.name).appendTo(this.output),i=0;i<this.args.length;++i){var passage=void 0,text=void 0,$image=void 0,setFn=void 0;if("object"===_typeof(this.args[i])?this.args[i].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[i].source),this.args[i].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[i].passage),this.args[i].hasOwnProperty("title")&&$image.attr("title",this.args[i].title),this.args[i].hasOwnProperty("align")&&$image.attr("align",this.args[i].align),passage=this.args[i].link,setFn=this.args[i].setFn):(text=this.args[i].text,passage=this.args[i].link,setFn=this.args[i].setFn):text=passage=this.args[i],!(State.variables.hasOwnProperty("#actions")&&State.variables["#actions"].hasOwnProperty(passage)&&State.variables["#actions"][passage])){var $link=jQuery(Wikifier.createInternalLink(jQuery(document.createElement("li")).appendTo($list),passage,null,function(passage,fn){return function(){State.variables.hasOwnProperty("#actions")||(State.variables["#actions"]={}),State.variables["#actions"][passage]=!0,"function"==typeof fn&&fn()}}(passage,setFn))).addClass("macro-".concat(this.name)).append($image||document.createTextNode(text));$image&&$link.addClass("link-image")}}}}),Macro.add(["back","return"],{handler:function(){if(this.args.length>1)return this.error("too many arguments specified, check the documentation for details");var passage,text,$image,$link,momentIndex=-1;if(1===this.args.length&&("object"===_typeof(this.args[0])?this.args[0].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),this.args[0].hasOwnProperty("link")&&(passage=this.args[0].link)):(1===this.args[0].count||(text=this.args[0].text),passage=this.args[0].link):1===this.args.length&&(text=this.args[0])),null==passage){for(var i=State.length-2;i>=0;--i)if(State.history[i].title!==State.passage){momentIndex=i,passage=State.history[i].title;break}if(null==passage&&"return"===this.name)for(var _i6=State.expired.length-1;_i6>=0;--_i6)if(State.expired[_i6]!==State.passage){passage=State.expired[_i6];break}}else{if(!Story.has(passage))return this.error('passage "'.concat(passage,'" does not exist'));if("back"===this.name){for(var _i7=State.length-2;_i7>=0;--_i7)if(State.history[_i7].title===passage){momentIndex=_i7;break}if(-1===momentIndex)return this.error('cannot find passage "'.concat(passage,'" in the current story history'))}}if(null==passage)return this.error("cannot find passage");"back"!==this.name||-1!==momentIndex?($link=jQuery(document.createElement("a")).addClass("link-internal").ariaClick({one:!0},"return"===this.name?function(){return Engine.play(passage)}:function(){return Engine.goTo(momentIndex)}),$image&&$link.addClass("link-image")):$link=jQuery(document.createElement("span")).addClass("link-disabled"),$link.addClass("macro-".concat(this.name)).append($image||document.createTextNode(text||L10n.get("macro".concat(this.name.toUpperFirst(),"Text")))).appendTo(this.output)}}),Macro.add("choice",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var passage,text,$image,setFn,$link,choiceId=State.passage;if(1===this.args.length?"object"===_typeof(this.args[0])?this.args[0].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),passage=this.args[0].link,setFn=this.args[0].setFn):(text=this.args[0].text,passage=this.args[0].link,setFn=this.args[0].setFn):text=passage=this.args[0]:(passage=this.args[0],text=this.args[1]),State.variables.hasOwnProperty("#choice")&&State.variables["#choice"].hasOwnProperty(choiceId)&&State.variables["#choice"][choiceId])return $link=jQuery(document.createElement("span")).addClass("link-disabled macro-".concat(this.name)).attr("tabindex",-1).append($image||document.createTextNode(text)).appendTo(this.output),void($image&&$link.addClass("link-image"));$link=jQuery(Wikifier.createInternalLink(this.output,passage,null,(function(){State.variables.hasOwnProperty("#choice")||(State.variables["#choice"]={}),State.variables["#choice"][choiceId]=!0,"function"==typeof setFn&&setFn()}))).addClass("macro-".concat(this.name)).append($image||document.createTextNode(text)),$image&&$link.addClass("link-image")}}),Macro.add(["addclass","toggleclass"],{handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("selector"),this.args.length<2&&errors.push("class names"),this.error("no ".concat(errors.join(" or ")," specified"))}var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));switch(this.name){case"addclass":$targets.addClass(this.args[1].trim());break;case"toggleclass":$targets.toggleClass(this.args[1].trim())}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeclass",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));this.args.length>1?$targets.removeClass(this.args[1].trim()):$targets.removeClass(),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("copy",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));jQuery(this.output).append($targets.html()),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["append","prepend","replace"],{tags:null,t8nRe:/^(?:transition|t8n)$/,handler:function(){var _this18=this;if(0===this.args.length)return this.error("no selector specified");var $insert,$targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));if(""!==this.payload[0].contents)switch(this.args.length>1&&this.self.t8nRe.test(this.args[1])?(($insert=jQuery(document.createElement("span"))).addClass("macro-".concat(this.name,"-insert macro-").concat(this.name,"-in")),setTimeout((function(){return $insert.removeClass("macro-".concat(_this18.name,"-in"))}),Engine.minDomActionDelay)):$insert=jQuery(document.createDocumentFragment()),$insert.wiki(this.payload[0].contents),this.name){case"replace":$targets.empty();case"append":$targets.append($insert);break;case"prepend":$targets.prepend($insert)}else"replace"===this.name&&$targets.empty();Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remove",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));$targets.remove(),Config.debug&&this.debugView.modes({hidden:!0})}}),Has.audio){var errorOnePlaybackAction=function(cur,prev){return'only one playback action allowed per invocation, "'.concat(cur,'" cannot be combined with "').concat(prev,'"')};Macro.add("audio",{handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("track and/or group IDs"),this.args.length<2&&errors.push("actions"),this.error("no ".concat(errors.join(" or ")," specified"))}var selected;try{selected=SimpleAudio.select(this.args[0])}catch(ex){return this.error(ex.message)}for(var action,fadeTo,loop,mute,passage,time,volume,args=this.args.slice(1),fadeOver=5;args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"pause":case"play":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"fadein":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=1;break;case"fadeout":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=0;break;case"fadeto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error("fadeto missing required level value");if(action="fade",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeto: ".concat(raw));break;case"fadeoverto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){var _errors=[];return args.length<1&&_errors.push("seconds"),args.length<2&&_errors.push("level"),this.error("fadeoverto missing required ".concat(_errors.join(" and ")," value").concat(_errors.length>1?"s":""))}if(action="fade",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error("cannot parse fadeoverto: ".concat(raw));if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeoverto: ".concat(raw));break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;case"mute":case"unmute":mute="mute"===arg;break;case"time":if(0===args.length)return this.error("time missing required seconds value");if(raw=args.shift(),time=Number.parseFloat(raw),Number.isNaN(time)||!Number.isFinite(time))return this.error("cannot parse time: ".concat(raw));break;case"loop":case"unloop":loop="loop"===arg;break;case"goto":if(0===args.length)return this.error("goto missing required passage title");if(raw=args.shift(),passage="object"===_typeof(raw)?raw.link:raw,!Story.has(passage))return this.error('passage "'.concat(passage,'" does not exist'));break;default:return this.error("unknown action: ".concat(arg))}}try{if(null!=volume&&selected.volume(volume),null!=time&&selected.time(time),null!=mute&&selected.mute(mute),null!=loop&&selected.loop(loop),null!=passage){var nsEnded="ended.macros.macro-".concat(this.name,"_goto");selected.off(nsEnded).one(nsEnded,(function(){selected.off(nsEnded),Engine.play(passage)}))}switch(action){case"fade":selected.fade(fadeOver,fadeTo);break;case"load":selected.load();break;case"pause":selected.pause();break;case"play":selected.playWhenAllowed();break;case"stop":selected.stop();break;case"unload":selected.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("cacheaudio",{handler:function(){var _this19=this;if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("track ID"),this.args.length<2&&errors.push("sources"),this.error("no ".concat(errors.join(" or ")," specified"))}var id=String(this.args[0]).trim(),oldFmtRe=/^format:\s*([\w-]+)\s*;\s*/i;try{SimpleAudio.tracks.add(id,this.args.slice(1).map((function(source){if(oldFmtRe.test(source)){if(Config.debug)return _this19.error('track ID "'.concat(id,'": format specifier migration required, "format:formatId;" → "formatId|"'));source=source.replace(oldFmtRe,"$1|")}return source})))}catch(ex){return this.error(ex.message)}if(Config.debug&&!SimpleAudio.tracks.get(id).hasSource())return this.error('track ID "'.concat(id,'": no supported audio sources found'));Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("createaudiogroup",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no group ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var groupId=String(this.args[0]).trim(),trackIds=[],i=1,len=this.payload.length;i<len;++i){if(this.payload[i].args.length<1)return this.error("no track ID specified");trackIds.push(String(this.payload[i].args[0]).trim()),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.groups.add(groupId,trackIds)}catch(ex){return this.error(ex.message)}Config.debug&&this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0})}}),Macro.add("createplaylist",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no list ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");var playlist=Macro.get("playlist");if(null!==playlist.from&&"createplaylist"!==playlist.from)return this.error("a playlist has already been defined with <<setplaylist>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var listId=String(this.args[0]).trim(),trackObjs=[],i=1,len=this.payload.length;i<len;++i){if(0===this.payload[i].args.length)return this.error("no track ID specified");for(var trackObj={id:String(this.payload[i].args[0]).trim()},args=this.payload[i].args.slice(1);args.length>0;){var arg=args.shift(),raw=void 0,parsed=void 0;switch(arg){case"copy":case"own":trackObj.own=!0;break;case"rate":args.length>0&&args.shift();break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),parsed=Number.parseFloat(raw),Number.isNaN(parsed)||!Number.isFinite(parsed))return this.error("cannot parse volume: ".concat(raw));trackObj.volume=parsed;break;default:return this.error("unknown action: ".concat(arg))}}trackObjs.push(trackObj),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.lists.add(listId,trackObjs)}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from="createplaylist"),Config.debug&&this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0})}}),Macro.add("masteraudio",{handler:function(){if(0===this.args.length)return this.error("no actions specified");for(var action,mute,muteOnHide,volume,args=this.args.slice(0);args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"mute":case"unmute":mute="mute"===arg;break;case"muteonhide":case"nomuteonhide":muteOnHide="muteonhide"===arg;break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;default:return this.error("unknown action: ".concat(arg))}}try{switch(null!=mute&&SimpleAudio.mute(mute),null!=muteOnHide&&SimpleAudio.muteOnHidden(muteOnHide),null!=volume&&SimpleAudio.volume(volume),action){case"load":SimpleAudio.load();break;case"stop":SimpleAudio.stop();break;case"unload":SimpleAudio.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("playlist",{from:null,handler:function(){var list,args,action,from=this.self.from;if(null===from)return this.error("no playlists have been created");if("createplaylist"===from){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("list ID"),this.args.length<2&&errors.push("actions"),this.error("no ".concat(errors.join(" or ")," specified"))}var id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error('playlist "'.concat(id,'" does not exist'));list=SimpleAudio.lists.get(id),args=this.args.slice(1)}else{if(0===this.args.length)return this.error("no actions specified");list=SimpleAudio.lists.get("setplaylist"),args=this.args.slice(0)}for(var fadeTo,loop,mute,shuffle,volume,fadeOver=5;args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"pause":case"play":case"skip":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"fadein":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=1;break;case"fadeout":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=0;break;case"fadeto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error("fadeto missing required level value");if(action="fade",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeto: ".concat(raw));break;case"fadeoverto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){var _errors2=[];return args.length<1&&_errors2.push("seconds"),args.length<2&&_errors2.push("level"),this.error("fadeoverto missing required ".concat(_errors2.join(" and ")," value").concat(_errors2.length>1?"s":""))}if(action="fade",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error("cannot parse fadeoverto: ".concat(raw));if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeoverto: ".concat(raw));break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;case"mute":case"unmute":mute="mute"===arg;break;case"loop":case"unloop":loop="loop"===arg;break;case"shuffle":case"unshuffle":shuffle="shuffle"===arg;break;default:return this.error("unknown action: ".concat(arg))}}try{switch(null!=volume&&list.volume(volume),null!=mute&&list.mute(mute),null!=loop&&list.loop(loop),null!=shuffle&&list.shuffle(shuffle),action){case"fade":list.fade(fadeOver,fadeTo);break;case"load":list.load();break;case"pause":list.pause();break;case"play":list.playWhenAllowed();break;case"skip":list.skip();break;case"stop":list.stop();break;case"unload":list.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("removeaudiogroup",{handler:function(){if(0===this.args.length)return this.error("no group ID specified");var id=String(this.args[0]).trim();if(!SimpleAudio.groups.has(id))return this.error('group "'.concat(id,'" does not exist'));SimpleAudio.groups.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeplaylist",{handler:function(){if(0===this.args.length)return this.error("no list ID specified");var id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error('playlist "'.concat(id,'" does not exist'));SimpleAudio.lists.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("waitforaudio",{skipArgs:!0,handler:function(){SimpleAudio.loadWithScreen()}}),Macro.add("setplaylist",{handler:function(){if(0===this.args.length)return this.error("no track ID(s) specified");var playlist=Macro.get("playlist");if(null!==playlist.from&&"setplaylist"!==playlist.from)return this.error("playlists have already been defined with <<createplaylist>>");try{SimpleAudio.lists.add("setplaylist",this.args.slice(0))}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from="setplaylist"),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("stopallaudio",{skipArgs:!0,handler:function(){SimpleAudio.select(":all").stop(),Config.debug&&this.debugView.modes({hidden:!0})}})}else Macro.add(["audio","cacheaudio","createaudiogroup","createplaylist","masteraudio","playlist","removeaudiogroup","removeplaylist","waitforaudio","setplaylist","stopallaudio"],{skipArgs:!0,handler:function(){Config.debug&&this.debugView.modes({hidden:!0})}});Macro.add("done",{skipArgs:!0,tags:null,handler:function(){var contents=this.payload[0].contents.trim();""!==contents&&setTimeout(this.createShadowWrapper((function(){return $.wiki(contents)})),Engine.minDomActionDelay)}}),Macro.add("goto",{handler:function(){return 0===this.args.length?this.error("no passage specified"):(passage="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],Story.has(passage)?void setTimeout((function(){return Engine.play(passage)}),Engine.minDomActionDelay):this.error('passage "'.concat(passage,'" does not exist')));var passage}}),Macro.add("repeat",{isAsync:!0,tags:null,timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler:function(){var delay,_this20=this;if(0===this.args.length)return this.error("no time value specified");try{delay=Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0]))}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});var transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement("span")).addClass("macro-".concat(this.name)).appendTo(this.output);this.self.registerInterval(this.createShadowWrapper((function(){var frag=document.createDocumentFragment();new Wikifier(frag,_this20.payload[0].contents);var $output=$wrapper;transition&&($output=jQuery(document.createElement("span")).addClass("macro-repeat-insert macro-repeat-in").appendTo($output)),$output.append(frag),transition&&setTimeout((function(){return $output.removeClass("macro-repeat-in")}),Engine.minDomActionDelay)})),delay)},registerInterval:function(callback,delay){var _this21=this;if("function"!=typeof callback)throw new TypeError("callback parameter must be a function");var passage=State.passage,turn=State.turns,timers=this.timers,timerId=null;timerId=setInterval((function(){if(State.passage!==passage||State.turns!==turn)return clearInterval(timerId),void timers.delete(timerId);var timerIdCache;try{TempState.break=null,TempState.hasOwnProperty("repeatTimerId")&&(timerIdCache=TempState.repeatTimerId),TempState.repeatTimerId=timerId,callback.call(_this21)}finally{void 0!==timerIdCache?TempState.repeatTimerId=timerIdCache:delete TempState.repeatTimerId,TempState.break=null}}),delay),timers.add(timerId),prehistory.hasOwnProperty("#repeat-timers-cleanup")||(prehistory["#repeat-timers-cleanup"]=function(task){delete prehistory[task],timers.forEach((function(timerId){return clearInterval(timerId)})),timers.clear()})}}),Macro.add("stop",{skipArgs:!0,handler:function(){if(!TempState.hasOwnProperty("repeatTimerId"))return this.error("must only be used in conjunction with its parent macro <<repeat>>");var timers=Macro.get("repeat").timers,timerId=TempState.repeatTimerId;clearInterval(timerId),timers.delete(timerId),TempState.break=2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("timed",{isAsync:!0,tags:["next"],timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler:function(){if(0===this.args.length)return this.error("no time value specified in <<timed>>");var i,items=[];try{items.push({name:this.name,source:this.source,delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0])),content:this.payload[0].contents})}catch(ex){return this.error("".concat(ex.message," in <<timed>>"))}if(this.payload.length>1)try{var len;for(i=1,len=this.payload.length;i<len;++i)items.push({name:this.payload[i].name,source:this.payload[i].source,delay:0===this.payload[i].args.length?items[items.length-1].delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.payload[i].args[0])),content:this.payload[i].contents})}catch(ex){return this.error("".concat(ex.message," in <<next>> (#").concat(i,")"))}Config.debug&&this.debugView.modes({block:!0});var transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement("span")).addClass("macro-".concat(this.name)).appendTo(this.output);this.self.registerTimeout(this.createShadowWrapper((function(item){var frag=document.createDocumentFragment();new Wikifier(frag,item.content);var $output=$wrapper;Config.debug&&"next"===item.name&&($output=jQuery(new DebugView($output[0],"macro",item.name,item.source).output)),transition&&($output=jQuery(document.createElement("span")).addClass("macro-timed-insert macro-timed-in").appendTo($output)),$output.append(frag),transition&&setTimeout((function(){return $output.removeClass("macro-timed-in")}),Engine.minDomActionDelay)})),items)},registerTimeout:function(callback,items){if("function"!=typeof callback)throw new TypeError("callback parameter must be a function");var passage=State.passage,turn=State.turns,timers=this.timers,timerId=null,nextItem=items.shift();timerId=setTimeout((function worker(){if(timers.delete(timerId),State.passage===passage&&State.turns===turn){var curItem=nextItem;null!=(nextItem=items.shift())&&(timerId=setTimeout(worker,nextItem.delay),timers.add(timerId)),callback.call(this,curItem)}}),nextItem.delay),timers.add(timerId),prehistory.hasOwnProperty("#timed-timers-cleanup")||(prehistory["#timed-timers-cleanup"]=function(task){delete prehistory[task],timers.forEach((function(timerId){return clearTimeout(timerId)})),timers.clear()})}}),Macro.add("widget",{tags:null,handler:function(){if(0===this.args.length)return this.error("no widget name specified");var widgetCode,widgetName=this.args[0],isNonVoid=this.args.length>1&&"container"===this.args[1];if(Macro.has(widgetName)){if(!Macro.get(widgetName).isWidget)return this.error('cannot clobber existing macro "'.concat(widgetName,'"'));Macro.delete(widgetName)}try{var widgetDef={isWidget:!0,handler:(widgetCode=this.payload[0].contents,function(){var shadowStore={};State.temporary.hasOwnProperty("args")&&(shadowStore._args=State.temporary.args),State.temporary.args=_toConsumableArray(this.args),State.temporary.args.raw=this.args.raw,State.temporary.args.full=this.args.full,this.addShadow("_args"),isNonVoid&&(State.temporary.hasOwnProperty("contents")&&(shadowStore._contents=State.temporary.contents),State.temporary.contents=this.payload[0].contents,this.addShadow("_contents")),State.variables.hasOwnProperty("args")&&(shadowStore.$args=State.variables.args),State.variables.args=State.temporary.args,this.addShadow("$args");try{var resFrag=document.createDocumentFragment(),errList=[];if(new Wikifier(resFrag,widgetCode),Array.from(resFrag.querySelectorAll(".error")).forEach((function(errEl){errList.push(errEl.textContent)})),0!==errList.length)return this.error("error".concat(errList.length>1?"s":""," within widget code (").concat(errList.join("; "),")"));this.output.appendChild(resFrag)}catch(ex){return this.error("cannot execute widget: ".concat(ex.message))}finally{shadowStore.hasOwnProperty("_args")?State.temporary.args=shadowStore._args:delete State.temporary.args,isNonVoid&&(shadowStore.hasOwnProperty("_contents")?State.temporary.contents=shadowStore._contents:delete State.temporary.contents),shadowStore.hasOwnProperty("$args")?State.variables.args=shadowStore.$args:delete State.variables.args}})};isNonVoid&&(widgetDef.tags=[]),Macro.add(widgetName,widgetDef),Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error('cannot create widget macro "'.concat(widgetName,'": ').concat(ex.message))}}})}();var Dialog=function(){var _$overlay=null,_$dialog=null,_$dialogTitle=null,_$dialogBody=null,_lastActive=null,_scrollbarWidth=0,_dialogObserver=null;function dialogClose(ev){return _$dialogBody.trigger(":dialogclosing"),jQuery(document).off(".dialog-close"),_dialogObserver?(_dialogObserver.disconnect(),_dialogObserver=null):_$dialogBody.off(".dialog-resize"),jQuery(window).off(".dialog-resize"),_$dialog.removeClass("open").css({left:"",right:"",top:"",bottom:""}),jQuery("#ui-bar,#story").find("[tabindex=-2]").removeAttr("aria-hidden").attr("tabindex",0),jQuery("body>[tabindex=-3]").removeAttr("aria-hidden").removeAttr("tabindex"),_$overlay.removeClass("open"),jQuery(document.documentElement).removeAttr("data-dialog"),_$dialogTitle.empty(),_$dialogBody.empty().removeClass(),null!==_lastActive&&(jQuery(_lastActive).focus(),_lastActive=null),ev&&ev.data&&"function"==typeof ev.data.closeFn&&ev.data.closeFn(ev),_$dialogBody.trigger(":dialogclose"),_$dialogBody.trigger(":dialogclosed"),Dialog}function dialogIsOpen(classNames){return _$dialog.hasClass("open")&&(!classNames||classNames.splitOrEmpty(/\s+/).every((function(cn){return _$dialogBody.hasClass(cn)})))}function dialogOpen(options,closeFn){_$dialogBody.trigger(":dialogopening");var top=jQuery.extend({top:50},options).top;return dialogIsOpen()||(_lastActive=safeActiveElement()),jQuery(document.documentElement).attr("data-dialog","open"),_$overlay.addClass("open"),null!==_$dialogBody[0].querySelector("img")&&_$dialogBody.imagesLoaded().always((function(){return _resizeHandler({data:{top:top}})})),jQuery("body>:not(script,#store-area,tw-storydata,#ui-bar,#ui-overlay,#ui-dialog)").attr("tabindex",-3).attr("aria-hidden",!0),jQuery("#ui-bar,#story").find("[tabindex]:not([tabindex^=-])").attr("tabindex",-2).attr("aria-hidden",!0),_$dialog.css(_calcPosition(top)).addClass("open").focus(),jQuery(window).on("resize.dialog-resize",null,{top:top},jQuery.throttle(40,_resizeHandler)),Has.mutationObserver?(_dialogObserver=new MutationObserver((function(mutations){for(var i=0;i<mutations.length;++i)if("childList"===mutations[i].type){_resizeHandler({data:{top:top}});break}}))).observe(_$dialogBody[0],{childList:!0,subtree:!0}):_$dialogBody.on("DOMNodeInserted.dialog-resize DOMNodeRemoved.dialog-resize",null,{top:top},jQuery.throttle(40,_resizeHandler)),jQuery(document).one("click.dialog-close",".ui-close",{closeFn:closeFn},(function(ev){dialogClose(ev)})).one("keypress.dialog-close",".ui-close",(function(ev){13!==ev.which&&32!==ev.which||jQuery(this).trigger("click")})),_$dialogBody.trigger(":dialogopen"),_$dialogBody.trigger(":dialogopened"),Dialog}function _calcPosition(topPos){var top=null!=topPos?topPos:50,$parent=jQuery(window),dialogPos={left:"",right:"",top:"",bottom:""};_$dialog.css(dialogPos);var horzSpace=$parent.width()-_$dialog.outerWidth(!0)-1,vertSpace=$parent.height()-_$dialog.outerHeight(!0)-1;return horzSpace<=32+_scrollbarWidth&&(vertSpace-=_scrollbarWidth),vertSpace<=32+_scrollbarWidth&&(horzSpace-=_scrollbarWidth),dialogPos.left=dialogPos.right=horzSpace<=32?16:horzSpace/2>>0,dialogPos.top=vertSpace<=32?dialogPos.bottom=16:vertSpace/2>top?top:dialogPos.bottom=vertSpace/2>>0,Object.keys(dialogPos).forEach((function(key){""!==dialogPos[key]&&(dialogPos[key]+="px")})),dialogPos}function _resizeHandler(ev){var top=ev&&ev.data&&void 0!==ev.data.top?ev.data.top:50;"block"===_$dialog.css("display")&&(_$dialog.css({display:"none"}),_$dialog.css(jQuery.extend({display:""},_calcPosition(top))))}return Object.freeze(Object.defineProperties({},{append:{value:function(){var _$dialogBody2;return(_$dialogBody2=_$dialogBody).append.apply(_$dialogBody2,arguments),Dialog}},body:{value:function(){return _$dialogBody.get(0)}},close:{value:dialogClose},init:{value:function(){if(!document.getElementById("ui-dialog")){_scrollbarWidth=function(){var scrollbarWidth;try{var inner=document.createElement("p"),outer=document.createElement("div");inner.style.width="100%",inner.style.height="200px",outer.style.position="absolute",outer.style.left="0px",outer.style.top="0px",outer.style.width="100px",outer.style.height="100px",outer.style.visibility="hidden",outer.style.overflow="hidden",outer.appendChild(inner),document.body.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow="auto";var w2=inner.offsetWidth;w1===w2&&(w2=outer.clientWidth),document.body.removeChild(outer),scrollbarWidth=w1-w2}catch(ex){}return scrollbarWidth||17}();var $elems=jQuery(document.createDocumentFragment()).append('<div id="ui-overlay" class="ui-close"></div><div id="ui-dialog" tabindex="0" role="dialog" aria-labelledby="ui-dialog-title"><div id="ui-dialog-titlebar"><h1 id="ui-dialog-title"></h1>'+'<button id="ui-dialog-close" class="ui-close" tabindex="0" aria-label="'.concat(L10n.get("close"),'"></button>')+'</div><div id="ui-dialog-body"></div></div>');_$overlay=jQuery($elems.find("#ui-overlay").get(0)),_$dialog=jQuery($elems.find("#ui-dialog").get(0)),_$dialogTitle=jQuery($elems.find("#ui-dialog-title").get(0)),_$dialogBody=jQuery($elems.find("#ui-dialog-body").get(0)),$elems.insertBefore("body>script#script-sugarcube")}}},isOpen:{value:dialogIsOpen},open:{value:dialogOpen},resize:{value:function(data){return _resizeHandler("object"===_typeof(data)?{data:data}:undefined)}},setup:{value:function(title,classNames){return _$dialogBody.empty().removeClass(),null!=classNames&&_$dialogBody.addClass(classNames),_$dialogTitle.empty().append((null!=title?String(title):"")||" "),_$dialogBody.get(0)}},wiki:{value:function(){var _$dialogBody3;return(_$dialogBody3=_$dialogBody).wiki.apply(_$dialogBody3,arguments),Dialog}},addClickHandler:{value:function(targets,options,startFn,doneFn,closeFn){return jQuery(targets).ariaClick((function(ev){ev.preventDefault(),"function"==typeof startFn&&startFn(ev),dialogOpen(options,closeFn),"function"==typeof doneFn&&doneFn(ev)}))}}}))}(),Engine=function(){var States=Util.toEnum({Idle:"idle",Playing:"playing",Rendering:"rendering"}),_initDebugViews=[],_state=States.Idle,_lastPlay=null,_outlinePatch=null,_updating=null;function engineGo(offset){var succeded=State.go(offset);return succeded&&engineShow(),succeded}function engineShow(){return enginePlay(State.passage,!0)}function enginePlay(title,noHistory){var passageReadyOutput,passageDoneOutput,passageTitle=title;if(_state=States.Playing,TempState={},State.clearTemporary(),"function"==typeof Config.navigation.override)try{var overrideTitle=Config.navigation.override(passageTitle);overrideTitle&&(passageTitle=overrideTitle)}catch(ex){}var passage=Story.get(passageTitle);if(jQuery.event.trigger({type:":passageinit",passage:passage}),Object.keys(prehistory).forEach((function(task){"function"==typeof prehistory[task]&&prehistory[task].call(passage,task)})),noHistory||State.create(passage.title),document.body.className&&(document.body.className=""),_lastPlay=Util.now(),Object.keys(predisplay).forEach((function(task){"function"==typeof predisplay[task]&&predisplay[task].call(passage,task)})),Story.has("PassageReady"))try{passageReadyOutput=Wikifier.wikifyEval(Story.get("PassageReady").text)}catch(ex){console.error(ex),Alert.error("PassageReady",ex.message)}_state=States.Rendering;var dataTags=passage.tags.length>0?passage.tags.join(" "):null,passageEl=document.createElement("div");jQuery(passageEl).attr({id:passage.domId,"data-passage":passage.title,"data-tags":dataTags}).addClass("passage ".concat(passage.className)),jQuery(document.body).attr("data-tags",dataTags).addClass(passage.className),jQuery(document.documentElement).attr("data-tags",dataTags),jQuery.event.trigger({type:":passagestart",content:passageEl,passage:passage}),Object.keys(prerender).forEach((function(task){"function"==typeof prerender[task]&&prerender[task].call(passage,passageEl,task)})),Story.has("PassageHeader")&&new Wikifier(passageEl,Story.get("PassageHeader").processText()),passageEl.appendChild(passage.render()),Story.has("PassageFooter")&&new Wikifier(passageEl,Story.get("PassageFooter").processText()),jQuery.event.trigger({type:":passagerender",content:passageEl,passage:passage}),Object.keys(postrender).forEach((function(task){"function"==typeof postrender[task]&&postrender[task].call(passage,passageEl,task)}));var debugView,containerEl=document.getElementById("passages");if(containerEl.hasChildNodes()&&("number"==typeof Config.passages.transitionOut||"string"==typeof Config.passages.transitionOut&&""!==Config.passages.transitionOut&&Has.transitionEndEvent?_toConsumableArray(containerEl.childNodes).forEach((function(outgoing){var $outgoing=jQuery(outgoing);if(outgoing.nodeType===Node.ELEMENT_NODE&&$outgoing.hasClass("passage")){if($outgoing.hasClass("passage-out"))return;$outgoing.attr({id:"out-".concat($outgoing.attr("id")),"aria-live":"off"}).addClass("passage-out"),"string"==typeof Config.passages.transitionOut?$outgoing.on(Has.transitionEndEvent,(function(ev){ev.propertyName===Config.passages.transitionOut&&$outgoing.remove()})):setTimeout((function(){return $outgoing.remove()}),Math.max(40,Config.passages.transitionOut))}else $outgoing.remove()})):jQuery(containerEl).empty()),jQuery(passageEl).addClass("passage-in").appendTo(containerEl),setTimeout((function(){return jQuery(passageEl).removeClass("passage-in")}),40),Story.has("StoryDisplayTitle")?null===_updating&&Config.ui.updateStoryElements||setDisplayTitle(Story.get("StoryDisplayTitle").processText()):Config.passages.displayTitles&&passage.title!==Config.passages.start&&(document.title="".concat(passage.title," | ").concat(Story.title)),window.scroll(0,0),_state=States.Playing,Story.has("PassageDone"))try{passageDoneOutput=Wikifier.wikifyEval(Story.get("PassageDone").text)}catch(ex){console.error(ex),Alert.error("PassageDone",ex.message)}(jQuery.event.trigger({type:":passagedisplay",content:passageEl,passage:passage}),Object.keys(postdisplay).forEach((function(task){"function"==typeof postdisplay[task]&&postdisplay[task].call(passage,task)})),null!==_updating?_updating.forEach((function(pair){jQuery(pair.element).empty(),new Wikifier(pair.element,Story.get(pair.passage).processText().trim())})):Config.ui.updateStoryElements&&UIBar.update(),Config.debug)&&(null!=passageReadyOutput&&((debugView=new DebugView(document.createDocumentFragment(),"special","PassageReady","PassageReady")).modes({hidden:!0}),debugView.append(passageReadyOutput),jQuery(passageEl).prepend(debugView.output)),null!=passageDoneOutput&&((debugView=new DebugView(document.createDocumentFragment(),"special","PassageDone","PassageDone")).modes({hidden:!0}),debugView.append(passageDoneOutput),jQuery(passageEl).append(debugView.output)),1===State.turns&&_initDebugViews.length>0&&jQuery(passageEl).prepend(_initDebugViews));switch(jQuery("#story").find("a[href]:not(.link-external)").addClass("link-external").end().find("a,link,button,input,select,textarea").not("[tabindex]").attr("tabindex",0),_typeof(Config.saves.autosave)){case"boolean":Config.saves.autosave&&Save.autosave.save();break;case"object":passage.tags.some((function(tag){return Config.saves.autosave.includes(tag)}))&&Save.autosave.save();break;case"function":Config.saves.autosave()&&Save.autosave.save()}return jQuery.event.trigger({type:":passageend",content:passageEl,passage:passage}),_state=States.Idle,_lastPlay=Util.now(),passageEl}function _hideOutlines(){_outlinePatch.set("*:focus{outline:none;}")}return Object.freeze(Object.defineProperties({},{States:{value:States},minDomActionDelay:{value:40},init:{value:function(){var _lastOutlineEvent;jQuery("#init-no-js,#init-lacking").remove(),function(){var $elems=jQuery(document.createDocumentFragment()),markup=Story.has("StoryInterface")&&Story.get("StoryInterface").text.trim();if(markup){UIBar.destroy(),jQuery(document.head).find("#style-core-display").remove(),$elems.append(markup);var $passages=$elems.find("#passages");if(0===$passages.length)throw new Error('no element with ID "passages" found within "StoryInterface" special passage');$passages.empty().not("[aria-live]").attr("aria-live","polite").end(),$elems.find("[data-init-passage]").each((function(i,el){if("passages"===el.id)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' id="passages"> must not contain a "data-init-passage" content attribute'));var passage=el.getAttribute("data-init-passage").trim();if(el.hasAttribute("data-passage"))throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-init-passage="').concat(passage,'"> must not contain a "data-passage" content attribute'));if(null!==el.firstElementChild)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-init-passage="').concat(passage,'"> contains child elements'));Story.has(passage)&&jQuery(el).empty().wiki(Story.get(passage).processText().trim())}));var updating=[];$elems.find("[data-passage]").each((function(i,el){if("passages"===el.id)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' id="passages"> must not contain a "data-passage" content attribute'));var passage=el.getAttribute("data-passage").trim();if(null!==el.firstElementChild)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-passage="').concat(passage,'"> contains child elements'));Story.has(passage)&&updating.push({passage:passage,element:el})})),updating.length>0&&(_updating=updating),Config.ui.updateStoryElements=!1}else $elems.append('<div id="story" role="main"><div id="passages" aria-live="polite"></div></div>');$elems.insertBefore("body>script#script-sugarcube")}(),_outlinePatch=new StyleWrapper(jQuery(document.createElement("style")).attr({id:"style-aria-outlines",type:"text/css"}).appendTo(document.head).get(0)),_hideOutlines(),jQuery(document).on("mousedown.aria-outlines keydown.aria-outlines",(function(ev){ev.type!==_lastOutlineEvent&&(_lastOutlineEvent=ev.type,"keydown"===ev.type?_outlinePatch.clear():_hideOutlines())}))}},start:{value:function(){if(Story.getAllInit().forEach((function(passage){try{var debugBuffer=Wikifier.wikifyEval(passage.text);if(Config.debug){var debugView=new DebugView(document.createDocumentFragment(),"special","".concat(passage.title," [init-tagged]"),"".concat(passage.title," [init-tagged]"));debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}}catch(ex){console.error(ex),Alert.error("".concat(passage.title," [init-tagged]"),"object"===_typeof(ex)?ex.message:ex)}})),Story.has("StoryInit"))try{var debugBuffer=Wikifier.wikifyEval(Story.get("StoryInit").text);if(Config.debug){var debugView=new DebugView(document.createDocumentFragment(),"special","StoryInit","StoryInit");debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}}catch(ex){console.error(ex),Alert.error("StoryInit","object"===_typeof(ex)?ex.message:ex)}if(null==Config.passages.start)throw new Error("starting passage not selected");if(!Story.has(Config.passages.start))throw new Error('starting passage ("'.concat(Config.passages.start,'") not found'));if(jQuery(document.documentElement).focus(),State.restore())engineShow();else{var loadStart=!0;switch(_typeof(Config.saves.autoload)){case"boolean":Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!Save.autosave.load());break;case"string":"prompt"===Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!1,UI.buildAutoload(),Dialog.open());break;case"function":Save.autosave.ok()&&Save.autosave.has()&&Config.saves.autoload()&&(loadStart=!Save.autosave.load())}loadStart&&enginePlay(Config.passages.start)}}},restart:{value:function(){LoadScreen.show(),window.scroll(0,0),State.reset(),jQuery.event.trigger(":enginerestart"),window.location.reload()}},state:{get:function(){return _state}},isIdle:{value:function(){return _state===States.Idle}},isPlaying:{value:function(){return _state!==States.Idle}},isRendering:{value:function(){return _state===States.Rendering}},lastPlay:{get:function(){return _lastPlay}},goTo:{value:function(idx){var succeded=State.goTo(idx);return succeded&&engineShow(),succeded}},go:{value:engineGo},backward:{value:function(){return engineGo(-1)}},forward:{value:function(){return engineGo(1)}},show:{value:engineShow},play:{value:enginePlay},display:{value:function(title,link,option){var noHistory=!1;switch(option){case undefined:break;case"replace":case"back":noHistory=!0;break;default:throw new Error('Engine.display option parameter called with obsolete value "'.concat(option,'"; please notify the developer'))}enginePlay(title,noHistory)}}}))}(),Passage=(_tagsToSkip=/^(?:debug|nobr|passage|widget|twine\..*)$/i,function(){function Passage(title,el){var _this22=this;_classCallCheck(this,Passage),Object.defineProperties(this,{title:{value:Util.unescape(title)},element:{value:el||null},tags:{value:Object.freeze(el&&el.hasAttribute("tags")?Array.from(new Set(el.getAttribute("tags").trim().splitOrEmpty(/\s+/))):[])},_excerpt:{writable:!0,value:null}}),Object.defineProperties(this,{domId:{value:"passage-".concat(Util.slugify(this.title))},classes:{value:Object.freeze(0===this.tags.length?[]:_this22.tags.filter((function(tag){return!_tagsToSkip.test(tag)})).map((function(tag){return Util.slugify(tag)})))}})}return _createClass(Passage,[{key:"className",get:function(){return this.classes.join(" ")}},{key:"text",get:function(){if(null==this.element){var passage=Util.escapeMarkup(this.title),mesg="".concat(L10n.get("errorTitle"),": ").concat(L10n.get("errorNonexistentPassage",{passage:passage}));return'<div class="error-view"><span class="error">'.concat(mesg,"</span></div>")}return this.element.textContent.replace(/\r/g,"")}},{key:"description",value:function(){var descriptions=Config.passages.descriptions;switch(_typeof(descriptions)){case"boolean":if(descriptions)return this.title;break;case"object":if(descriptions.hasOwnProperty(this.title))return descriptions[this.title];break;case"function":var result=descriptions.call(this);if(result)return result}return null===this._excerpt&&(this._excerpt=Passage.getExcerptFromText(this.text)),this._excerpt}},{key:"processText",value:function(){if(null==this.element)return this.text;if(this.tags.includes("Twine.image"))return"[img[".concat(this.text,"]]");var processed=this.text;return Config.passages.onProcess&&(processed=Config.passages.onProcess.call(null,{title:this.title,tags:this.tags,text:processed})),(Config.passages.nobr||this.tags.includes("nobr"))&&(processed=processed.replace(/^\n+|\n+$/g,"").replace(/\n+/g," ")),processed}},{key:"render",value:function(options){var frag=document.createDocumentFragment();return new Wikifier(frag,this.processText(),options),this._excerpt=Passage.getExcerptFromNode(frag),frag}}],[{key:"getExcerptFromNode",value:function(node,count){if(!node.hasChildNodes())return"";var excerpt=node.textContent.trim();if(""!==excerpt){var excerptRe=new RegExp("(\\S+(?:\\s+\\S+){0,".concat(count>0?count-1:7,"})"));excerpt=excerpt.replace(/\s+/g," ").match(excerptRe)}return excerpt?"".concat(excerpt[1],"…"):"…"}},{key:"getExcerptFromText",value:function(text,count){if(""===text)return"";var excerptRe=new RegExp("(\\S+(?:\\s+\\S+){0,".concat(count>0?count-1:7,"})")),excerpt=text.replace(/<<.*?>>/g," ").replace(/<.*?>/g," ").trim().replace(/^\s*\|.*\|.*?$/gm,"").replace(/\[[<>]?img\[[^\]]*\]\]/g,"").replace(/\[\[([^|\]]*?)(?:(?:\||->|<-)[^\]]*)?\]\]/g,"$1").replace(/^\s*!+(.*?)$/gm,"$1").replace(/'{2}|\/{2}|_{2}|@{2}/g,"").trim().replace(/\s+/g," ").match(excerptRe);return excerpt?"".concat(excerpt[1],"…"):"…"}}]),Passage}()),_tagsToSkip,Save=function(){var Type=Util.toEnum({Autosave:"autosave",Disk:"disk",Serialize:"serialize",Slot:"slot"}),_slotsUBound=-1,_onLoadHandlers=new Set,_onSaveHandlers=new Set;function savesObjGet(){var saves=storage.get("saves");return null===saves?{autosave:null,slots:_appendSlots([],Config.saves.slots)}:saves}function savesObjClear(){return storage.delete("saves"),!0}function autosaveOk(){return"cookie"!==storage.name&&void 0!==Config.saves.autosave}function slotsOk(){return"cookie"!==storage.name&&-1!==_slotsUBound}function slotsCount(){if(!slotsOk())return 0;for(var saves=savesObjGet(),count=0,i=0,iend=saves.slots.length;i<iend;++i)null!==saves.slots[i]&&++count;return count}function _appendSlots(array,num){for(var i=0;i<num;++i)array.push(null);return array}function _savesObjIsEmpty(saves){for(var slots=saves.slots,isSlotsEmpty=!0,i=0,iend=slots.length;i<iend;++i)if(null!==slots[i]){isSlotsEmpty=!1;break}return null===saves.autosave&&isSlotsEmpty}function _savesObjSave(saves){return _savesObjIsEmpty(saves)?(storage.delete("saves"),!0):storage.set("saves",saves)}function _savesObjUpdate(saveObj){if(null==saveObj||"object"!==_typeof(saveObj))return!1;var updated=!1;return saveObj.hasOwnProperty("state")&&saveObj.state.hasOwnProperty("delta")&&saveObj.state.hasOwnProperty("index")||(saveObj.hasOwnProperty("data")?(delete saveObj.mode,saveObj.state={delta:State.deltaEncode(saveObj.data)},delete saveObj.data):saveObj.state.hasOwnProperty("delta")?saveObj.state.hasOwnProperty("index")||delete saveObj.state.mode:(delete saveObj.state.mode,saveObj.state.delta=State.deltaEncode(saveObj.state.history),delete saveObj.state.history),saveObj.state.index=saveObj.state.delta.length-1,updated=!0),saveObj.state.hasOwnProperty("rseed")&&(saveObj.state.seed=saveObj.state.rseed,delete saveObj.state.rseed,saveObj.state.delta.forEach((function(_,i,delta){delta[i].hasOwnProperty("rcount")&&(delta[i].pull=delta[i].rcount,delete delta[i].rcount)})),updated=!0),(saveObj.state.hasOwnProperty("expired")&&"number"==typeof saveObj.state.expired||saveObj.state.hasOwnProperty("unique")||saveObj.state.hasOwnProperty("last"))&&(saveObj.state.hasOwnProperty("expired")&&"number"==typeof saveObj.state.expired&&delete saveObj.state.expired,(saveObj.state.hasOwnProperty("unique")||saveObj.state.hasOwnProperty("last"))&&(saveObj.state.expired=[],saveObj.state.hasOwnProperty("unique")&&(saveObj.state.expired.push(saveObj.state.unique),delete saveObj.state.unique),saveObj.state.hasOwnProperty("last")&&(saveObj.state.expired.push(saveObj.state.last),delete saveObj.state.last)),updated=!0),updated}function _marshal(supplemental,details){if(null!=supplemental&&"object"!==_typeof(supplemental))throw new Error("supplemental parameter must be an object");var saveObj=Object.assign({},supplemental,{id:Config.saves.id,state:State.marshalForSave()});return Config.saves.version&&(saveObj.version=Config.saves.version),_onSaveHandlers.forEach((function(fn){return fn(saveObj,details)})),saveObj.state.delta=State.deltaEncode(saveObj.state.history),delete saveObj.state.history,saveObj}function _unmarshal(saveObj){try{if(_savesObjUpdate(saveObj),!saveObj||!saveObj.hasOwnProperty("id")||!saveObj.hasOwnProperty("state"))throw new Error(L10n.get("errorSaveMissingData"));if(saveObj.state.history=State.deltaDecode(saveObj.state.delta),delete saveObj.state.delta,_onLoadHandlers.forEach((function(fn){return fn(saveObj)})),saveObj.id!==Config.saves.id)throw new Error(L10n.get("errorSaveIdMismatch"));State.unmarshalForSave(saveObj.state),Engine.show()}catch(ex){return UI.alert("".concat(ex.message.toUpperFirst(),".</p><p>").concat(L10n.get("aborting"),".")),!1}return!0}return Object.freeze(Object.defineProperties({},{init:{value:function(){if("cookie"===storage.name)return savesObjClear(),Config.saves.autoload=undefined,Config.saves.autosave=undefined,Config.saves.slots=0,!1;var saves=savesObjGet(),updated=!1;Array.isArray(saves)&&(saves={autosave:null,slots:saves},updated=!0),Config.saves.slots!==saves.slots.length&&(Config.saves.slots<saves.slots.length?(saves.slots.reverse(),saves.slots=saves.slots.filter((function(val){return!(null===val&&this.count>0)||(--this.count,!1)}),{count:saves.slots.length-Config.saves.slots}),saves.slots.reverse()):Config.saves.slots>saves.slots.length&&_appendSlots(saves.slots,Config.saves.slots-saves.slots.length),updated=!0),_savesObjUpdate(saves.autosave)&&(updated=!0);for(var i=0;i<saves.slots.length;++i)_savesObjUpdate(saves.slots[i])&&(updated=!0);return _savesObjIsEmpty(saves)&&(storage.delete("saves"),updated=!1),updated&&_savesObjSave(saves),_slotsUBound=saves.slots.length-1,!0}},get:{value:savesObjGet},clear:{value:savesObjClear},ok:{value:function(){return autosaveOk()||slotsOk()}},autosave:{value:Object.freeze(Object.defineProperties({},{ok:{value:autosaveOk},has:{value:function(){return null!==savesObjGet().autosave}},get:{value:function(){return savesObjGet().autosave}},load:{value:function(){var saves=savesObjGet();return null!==saves.autosave&&_unmarshal(saves.autosave)}},save:{value:function(title,metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return!1;var saves=savesObjGet(),supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.autosave=_marshal(supplemental,{type:Type.Autosave}),_savesObjSave(saves)}},delete:{value:function(){var saves=savesObjGet();return saves.autosave=null,_savesObjSave(saves)}}}))},slots:{value:Object.freeze(Object.defineProperties({},{ok:{value:slotsOk},length:{get:function(){return _slotsUBound+1}},isEmpty:{value:function(){return 0===slotsCount()}},count:{value:slotsCount},has:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])}},get:{value:function(slot){if(slot<0||slot>_slotsUBound)return null;var saves=savesObjGet();return slot>=saves.slots.length?null:saves.slots[slot]}},load:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])&&_unmarshal(saves.slots[slot])}},save:{value:function(slot,title,metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed")),!1;if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();if(slot>=saves.slots.length)return!1;var supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.slots[slot]=_marshal(supplemental,{type:Type.Slot}),_savesObjSave(saves)}},delete:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length)&&(saves.slots[slot]=null,_savesObjSave(saves))}}}))},export:{value:function(filename,metadata){if("function"!=typeof Config.saves.isAllowed||Config.saves.isAllowed()){var str,now,MM,DD,hh,mm,ss,baseName=null==filename?Story.domId:(str=filename,Util.sanitizeFilename(str).replace(/[_\s\u2013\u2014-]+/g,"-")),saveName="".concat(baseName,"-").concat((now=new Date,MM=now.getMonth()+1,DD=now.getDate(),hh=now.getHours(),mm=now.getMinutes(),ss=now.getSeconds(),MM<10&&(MM="0".concat(MM)),DD<10&&(DD="0".concat(DD)),hh<10&&(hh="0".concat(hh)),mm<10&&(mm="0".concat(mm)),ss<10&&(ss="0".concat(ss)),"".concat(now.getFullYear()).concat(MM).concat(DD,"-").concat(hh).concat(mm).concat(ss)),".save"),supplemental=null==metadata?{}:{metadata:metadata},saveObj=LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Disk})));saveAs(new Blob([saveObj],{type:"text/plain;charset=UTF-8"}),saveName)}else Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed"))}},import:{value:function(event){var file=event.target.files[0],reader=new FileReader;jQuery(reader).one("loadend",(function(){if(reader.error){var ex=reader.error;UI.alert("".concat(L10n.get("errorSaveDiskLoadFailed").toUpperFirst()," (").concat(ex.name,": ").concat(ex.message,").</p><p>").concat(L10n.get("aborting"),"."))}else{var saveObj;try{saveObj=JSON.parse(/\.json$/i.test(file.name)||/^\{/.test(reader.result)?reader.result:LZString.decompressFromBase64(reader.result))}catch(ex){}_unmarshal(saveObj)}})),reader.readAsText(file)}},serialize:{value:function(metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed")),null;var supplemental=null==metadata?{}:{metadata:metadata};return LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Serialize})))}},deserialize:{value:function(base64Str){var saveObj;try{saveObj=JSON.parse(LZString.decompressFromBase64(base64Str))}catch(ex){}return _unmarshal(saveObj)?saveObj.metadata:null}},onLoad:{value:Object.freeze(Object.defineProperties({},{add:{value:function(handler){var valueType=Util.getType(handler);if("function"!==valueType)throw new TypeError("Save.onLoad.add handler parameter must be a function (received: ".concat(valueType,")"));_onLoadHandlers.add(handler)}},clear:{value:function(){_onLoadHandlers.clear()}},delete:{value:function(handler){return _onLoadHandlers.delete(handler)}},size:{get:function(){return _onLoadHandlers.size}}}))},onSave:{value:Object.freeze(Object.defineProperties({},{add:{value:function(handler){var valueType=Util.getType(handler);if("function"!==valueType)throw new TypeError("Save.onSave.add handler parameter must be a function (received: ".concat(valueType,")"));_onSaveHandlers.add(handler)}},clear:{value:function(){_onSaveHandlers.clear()}},delete:{value:function(handler){return _onSaveHandlers.delete(handler)}},size:{get:function(){return _onSaveHandlers.size}}}))}}))}(),Setting=function(){var Types=Util.toEnum({Header:0,Toggle:1,List:2,Range:3}),_definitions=[];function settingsCreate(){return Object.create(null)}function settingsSave(){var savedSettings=settingsCreate();return Object.keys(settings).length>0&&_definitions.filter((function(def){return def.type!==Types.Header&&settings[def.name]!==def.default})).forEach((function(def){return savedSettings[def.name]=settings[def.name]})),0===Object.keys(savedSettings).length?(storage.delete("settings"),!0):storage.set("settings",savedSettings)}function settingsLoad(){var defaultSettings=settingsCreate(),loadedSettings=storage.get("settings")||settingsCreate();_definitions.filter((function(def){return def.type!==Types.Header})).forEach((function(def){return defaultSettings[def.name]=def.default})),window.SugarCube.settings=settings=Object.assign(defaultSettings,loadedSettings)}function settingsClear(){return window.SugarCube.settings=settings=settingsCreate(),storage.delete("settings"),!0}function definitionsAdd(type,name,def){if(arguments.length<3){var errors=[];throw arguments.length<1&&errors.push("type"),arguments.length<2&&errors.push("name"),arguments.length<3&&errors.push("definition"),new Error("missing parameters, no ".concat(errors.join(" or ")," specified"))}if("object"!==_typeof(def))throw new TypeError("definition parameter must be an object");if(definitionsHas(name))throw new Error('cannot clobber existing setting "'.concat(name,'"'));var str,pos,definition={type:type,name:name,label:"string"==typeof def.label?def.label.trim():""};if("string"==typeof def.desc){var desc=def.desc.trim();""!==desc&&(definition.desc=desc)}switch(type){case Types.Header:break;case Types.Toggle:definition.default=!!def.default;break;case Types.List:if(!def.hasOwnProperty("list"))throw new Error("no list specified");if(!Array.isArray(def.list))throw new TypeError("list must be an array");if(0===def.list.length)throw new Error("list must not be empty");if(definition.list=Object.freeze(def.list),null==def.default)definition.default=def.list[0];else{var defaultIndex=def.list.indexOf(def.default);if(-1===defaultIndex)throw new Error("list does not contain default");definition.default=def.list[defaultIndex]}break;case Types.Range:if(!def.hasOwnProperty("min"))throw new Error("no min specified");if("number"!=typeof def.min||Number.isNaN(def.min)||!Number.isFinite(def.min))throw new TypeError("min must be a finite number");if(!def.hasOwnProperty("max"))throw new Error("no max specified");if("number"!=typeof def.max||Number.isNaN(def.max)||!Number.isFinite(def.max))throw new TypeError("max must be a finite number");if(!def.hasOwnProperty("step"))throw new Error("no step specified");if("number"!=typeof def.step||Number.isNaN(def.step)||!Number.isFinite(def.step)||def.step<=0)throw new TypeError("step must be a finite number greater than zero");var stepValidate=function(value){if(fracDigits>0){var ma=Number("".concat(def.min,"e").concat(fracDigits)),sa=Number("".concat(def.step,"e").concat(fracDigits)),_va=Number("".concat(value,"e").concat(fracDigits))-ma;return Number("".concat(_va-_va%sa+ma,"e-").concat(fracDigits))}var va=value-def.min;return va-va%def.step+def.min},fracDigits=(str=String(def.step),-1===(pos=str.lastIndexOf("."))?0:str.length-pos-1);if(stepValidate(def.max)!==def.max)throw new RangeError("max (".concat(def.max,") is not a multiple of the step (").concat(def.step,") plus the min (").concat(def.min,")"));if(definition.max=def.max,definition.min=def.min,definition.step=def.step,null==def.default)definition.default=def.max;else{if("number"!=typeof def.default||Number.isNaN(def.default)||!Number.isFinite(def.default))throw new TypeError("default must be a finite number");if(def.default<def.min)throw new RangeError("default (".concat(def.default,") is less than min (").concat(def.min,")"));if(def.default>def.max)throw new RangeError("default (".concat(def.default,") is greater than max (").concat(def.max,")"));definition.default=def.default}break;default:throw new Error("unknown Setting type: ".concat(type))}"function"==typeof def.onInit&&(definition.onInit=Object.freeze(def.onInit)),"function"==typeof def.onChange&&(definition.onChange=Object.freeze(def.onChange)),_definitions.push(Object.freeze(definition))}function definitionsHas(name){return _definitions.some((function(definition){return definition.name===name}))}function definitionsGet(name){return _definitions.find((function(definition){return definition.name===name}))}return Object.freeze(Object.defineProperties({},{Types:{value:Types},init:{value:function(){if(storage.has("options")){var old=storage.get("options");null!==old&&(window.SugarCube.settings=settings=Object.assign(settingsCreate(),old)),settingsSave(),storage.delete("options")}settingsLoad(),_definitions.forEach((function(def){if(def.hasOwnProperty("onInit")){var thisArg={name:def.name,value:settings[def.name],default:def.default};def.hasOwnProperty("list")&&(thisArg.list=def.list),def.onInit.call(thisArg)}}))}},create:{value:settingsCreate},save:{value:settingsSave},load:{value:settingsLoad},clear:{value:settingsClear},reset:{value:function(name){if(0===arguments.length)settingsClear(),settingsLoad();else{if(null==name||!definitionsHas(name))throw new Error('nonexistent setting "'.concat(name,'"'));var def=definitionsGet(name);def.type!==Types.Header&&(settings[name]=def.default)}return settingsSave()}},forEach:{value:function(callback,thisArg){_definitions.forEach(callback,thisArg)}},add:{value:definitionsAdd},addHeader:{value:function(name,desc){definitionsAdd(Types.Header,name,{desc:desc})}},addToggle:{value:function(){for(var _len16=arguments.length,args=new Array(_len16),_key16=0;_key16<_len16;_key16++)args[_key16]=arguments[_key16];definitionsAdd.apply(void 0,[Types.Toggle].concat(args))}},addList:{value:function(){for(var _len17=arguments.length,args=new Array(_len17),_key17=0;_key17<_len17;_key17++)args[_key17]=arguments[_key17];definitionsAdd.apply(void 0,[Types.List].concat(args))}},addRange:{value:function(){for(var _len18=arguments.length,args=new Array(_len18),_key18=0;_key18<_len18;_key18++)args[_key18]=arguments[_key18];definitionsAdd.apply(void 0,[Types.Range].concat(args))}},isEmpty:{value:function(){return 0===_definitions.length}},has:{value:definitionsHas},get:{value:definitionsGet},delete:{value:function definitionsDelete(name){definitionsHas(name)&&delete settings[name];for(var i=0;i<_definitions.length;++i)if(_definitions[i].name===name){_definitions.splice(i,1),definitionsDelete(name);break}}}}))}(),Story=function(){var _passages={},_inits=[],_scripts=[],_styles=[],_widgets=[],_title="",_ifId="",_domId="";function _storySetTitle(rawTitle){if(null==rawTitle)throw new Error("story title must not be null or undefined");var title=Util.unescape(String(rawTitle)).trim();if(""===title)throw new Error("story title must not be empty or consist solely of whitespace");if(document.title=_title=title,""===(_domId=Util.slugify(_title)))if(""!==_ifId)_domId=_ifId;else for(var i=0,len=_title.length;i<len;++i){var _Util$charAndPosAt2=Util.charAndPosAt(_title,i),char=_Util$charAndPosAt2.char,start=_Util$charAndPosAt2.start,end=_Util$charAndPosAt2.end;_domId+=char.codePointAt(0).toString(16),i+=end-start}}return Object.freeze(Object.defineProperties({},{load:{value:function(){var validationCodeTags=["init","widget"],validationNoCodeTagPassages=["PassageDone","PassageFooter","PassageHeader","PassageReady","StoryAuthor","StoryBanner","StoryCaption","StoryInit","StoryMenu","StoryShare","StorySubtitle"];function validateStartingPassage(passage){if(passage.tags.includesAny(validationCodeTags))throw new Error('starting passage "'.concat(passage.title,'" contains special tags; invalid: "').concat(passage.tags.filter((function(tag){return validationCodeTags.includes(tag)})).sort().join('", "'),'"'))}function validateSpecialPassages(passage){if(validationNoCodeTagPassages.includes(passage.title)){for(var _len19=arguments.length,tags=new Array(_len19>1?_len19-1:0),_key19=1;_key19<_len19;_key19++)tags[_key19-1]=arguments[_key19];throw new Error('special passage "'.concat(passage.title,'" contains special tags; invalid: "').concat(tags.sort().join('", "'),'"'))}var codeTags=[].concat(validationCodeTags),foundTags=[];if(passage.tags.forEach((function(tag){codeTags.includes(tag)&&foundTags.push.apply(foundTags,_toConsumableArray(codeTags.delete(tag)))})),foundTags.length>1)throw new Error('passage "'.concat(passage.title,'" contains multiple special tags; invalid: "').concat(foundTags.sort().join('", "'),'"'))}var $storydata=jQuery("tw-storydata"),startNode=$storydata.attr("startnode")||"";Config.passages.start=null,Config.debug=/\bdebug\b/.test($storydata.attr("options")),$storydata.children("style").each((function(i){_styles.push(new Passage("tw-user-style-".concat(i),this))})),$storydata.children("script").each((function(i){_scripts.push(new Passage("tw-user-script-".concat(i),this))})),$storydata.children('tw-passagedata:not([tags~="Twine.private"],[tags~="annotation"])').each((function(){var $this=jQuery(this),pid=$this.attr("pid")||"",passage=new Passage($this.attr("name"),this);pid===startNode&&""!==startNode?(Config.passages.start=passage.title,validateStartingPassage(passage),_passages[passage.title]=passage):passage.tags.includes("init")?(validateSpecialPassages(passage,"init"),_inits.push(passage)):passage.tags.includes("widget")?(validateSpecialPassages(passage,"widget"),_widgets.push(passage)):_passages[passage.title]=passage})),_ifId=$storydata.attr("ifid"),_storySetTitle("a Prince&#39;s tale"),Config.saves.id=Story.domId}},init:{value:function(){var storyStyle;storyStyle=document.createElement("style"),new StyleWrapper(storyStyle).add(_styles.map((function(style){return style.text.trim()})).join("\n")),jQuery(storyStyle).appendTo(document.head).attr({id:"style-story",type:"text/css"});for(var i=0;i<_scripts.length;++i)try{Scripting.evalJavaScript(_scripts[i].text)}catch(ex){console.error(ex),Alert.error(_scripts[i].title,"object"===_typeof(ex)?ex.message:ex)}for(var _i8=0;_i8<_widgets.length;++_i8)try{Wikifier.wikifyEval(_widgets[_i8].processText())}catch(ex){console.error(ex),Alert.error(_widgets[_i8].title,"object"===_typeof(ex)?ex.message:ex)}}},title:{get:function(){return _title}},domId:{get:function(){return _domId}},ifId:{get:function(){return _ifId}},add:{value:function(passage){if(!(passage instanceof Passage))throw new TypeError("Story.add passage parameter must be an instance of Passage");var title=passage.title;return!_passages.hasOwnProperty(title)&&(_passages[title]=passage,!0)}},has:{value:function(title){var type=_typeof(title);switch(type){case"number":case"string":return _passages.hasOwnProperty(String(title));case"undefined":break;case"object":type=null===title?"null":"an object";break;default:type="a ".concat(type)}throw new TypeError("Story.has title parameter cannot be ".concat(type))}},get:{value:function(title){var type=_typeof(title);switch(type){case"number":case"string":var id=String(title);return _passages.hasOwnProperty(id)?_passages[id]:new Passage(id||"(unknown)");case"undefined":break;case"object":type=null===title?"null":"an object";break;default:type="a ".concat(type)}throw new TypeError("Story.get title parameter cannot be ".concat(type))}},getAllInit:{value:function(){return Object.freeze(Array.from(_inits))}},getAllRegular:{value:function(){return Object.freeze(Object.assign({},_passages))}},getAllScript:{value:function(){return Object.freeze(Array.from(_scripts))}},getAllStylesheet:{value:function(){return Object.freeze(Array.from(_styles))}},getAllWidget:{value:function(){return Object.freeze(Array.from(_widgets))}},lookup:{value:function(key,value){var sortKey=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"title",results=[];return Object.keys(_passages).forEach((function(name){var passage=_passages[name];"object"===_typeof(passage[key])&&null!==passage[key]?passage[key]instanceof Array&&passage[key].some((function(m){return Util.sameValueZero(m,value)}))&&results.push(passage):Util.sameValueZero(passage[key],value)&&results.push(passage)})),results.sort((function(a,b){return a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1})),results}},lookupWith:{value:function(predicate){var sortKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"title";if("function"!=typeof predicate)throw new TypeError("Story.lookupWith predicate parameter must be a function");var results=[];return Object.keys(_passages).forEach((function(name){var passage=_passages[name];predicate(passage)&&results.push(passage)})),results.sort((function(a,b){return a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1})),results}}}))}(),UI=function(){function uiAssembleLinkList(passage,listEl){var list=listEl,debugState=Config.debug,cleanState=Config.cleanupWikifierOutput;Config.debug=!1,Config.cleanupWikifierOutput=!1;try{null==list&&(list=document.createElement("ul"));var frag=document.createDocumentFragment();new Wikifier(frag,Story.get(passage).processText().trim());var errors=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent.replace(errorPrologRegExp,"")}));if(errors.length>0)throw new Error(errors.join("; "));for(;frag.hasChildNodes();){var node=frag.firstChild;if(node.nodeType===Node.ELEMENT_NODE&&"A"===node.nodeName.toUpperCase()){var li=document.createElement("li");list.appendChild(li),li.appendChild(node)}else frag.removeChild(node)}}finally{Config.cleanupWikifierOutput=cleanState,Config.debug=debugState}return list}function uiOpenAlert(message){jQuery(Dialog.setup(L10n.get("alertTitle"),"alert")).append("<p>".concat(message,'</p><ul class="buttons">')+'<li><button id="alert-ok" class="ui-close">'.concat(L10n.get(["alertOk","ok"]),"</button></li>")+"</ul>");for(var _len20=arguments.length,args=new Array(_len20>1?_len20-1:0),_key20=1;_key20<_len20;_key20++)args[_key20-1]=arguments[_key20];Dialog.open.apply(Dialog,args)}function uiBuildAutoload(){return jQuery(Dialog.setup(L10n.get("autoloadTitle"),"autoload")).append("<p>".concat(L10n.get("autoloadPrompt"),'</p><ul class="buttons">')+'<li><button id="autoload-ok" class="ui-close">'.concat(L10n.get(["autoloadOk","ok"]),"</button></li>")+'<li><button id="autoload-cancel" class="ui-close">'.concat(L10n.get(["autoloadCancel","cancel"]),"</button></li>")+"</ul>"),jQuery(document).one("click.autoload",".ui-close",(function(ev){var isAutoloadOk="autoload-ok"===ev.target.id;jQuery(document).one(":dialogclosed",(function(){isAutoloadOk&&Save.autosave.load()||Engine.play(Config.passages.start)}))})),!0}function uiBuildJumpto(){var list=document.createElement("ul");jQuery(Dialog.setup(L10n.get("jumptoTitle"),"jumpto list")).append(list);for(var expired=State.expired.length,i=State.size-1;i>=0;--i)if(i!==State.activeIndex){var passage=Story.get(State.history[i].title);passage&&passage.tags.includes("bookmark")&&jQuery(document.createElement("li")).append(jQuery(document.createElement("a")).ariaClick({one:!0},function(idx){return function(){return jQuery(document).one(":dialogclosed",(function(){return Engine.goTo(idx)}))}}(i)).addClass("ui-close").text("".concat(L10n.get("jumptoTurn")," ").concat(expired+i+1,": ").concat(passage.description()))).appendTo(list)}list.hasChildNodes()||jQuery(list).append("<li><a><em>".concat(L10n.get("jumptoUnavailable"),"</em></a></li>"))}function uiBuildRestart(){return jQuery(Dialog.setup(L10n.get("restartTitle"),"restart")).append("<p>".concat(L10n.get("restartPrompt"),'</p><ul class="buttons">')+'<li><button id="restart-ok">'.concat(L10n.get(["restartOk","ok"]),"</button></li>")+'<li><button id="restart-cancel" class="ui-close">'.concat(L10n.get(["restartCancel","cancel"]),"</button></li>")+"</ul>").find("#restart-ok").ariaClick({one:!0},(function(){jQuery(document).one(":dialogclosed",(function(){return Engine.restart()})),Dialog.close()})),!0}function uiBuildSaves(){var savesAllowed="function"!=typeof Config.saves.isAllowed||Config.saves.isAllowed();function createActionItem(bId,bClass,bText,bAction){var $btn=jQuery(document.createElement("button")).attr("id","saves-".concat(bId)).html(bText);return bClass&&$btn.addClass(bClass),bAction?$btn.ariaClick(bAction):$btn.ariaDisabled(!0),jQuery(document.createElement("li")).append($btn)}var $dialogBody=jQuery(Dialog.setup(L10n.get("savesTitle"),"saves")),savesOk=Save.ok(),fileOk=Has.fileAPI&&(Config.saves.tryDiskOnMobile||!Browser.isMobile.any());if(savesOk&&$dialogBody.append(function(){function createButton(bId,bClass,bText,bSlot,bAction){var $btn=jQuery(document.createElement("button")).attr("id","saves-".concat(bId,"-").concat(bSlot)).addClass(bId).html(bText);return bClass&&$btn.addClass(bClass),bAction?"auto"===bSlot?$btn.ariaClick({label:"".concat(bText," ").concat(L10n.get("savesLabelAuto"))},(function(){return bAction()})):$btn.ariaClick({label:"".concat(bText," ").concat(L10n.get("savesLabelSlot")," ").concat(bSlot+1)},(function(){return bAction(bSlot)})):$btn.ariaDisabled(!0),$btn}var saves=Save.get(),$tbody=jQuery(document.createElement("tbody"));if(Save.autosave.ok()){var $tdSlot=jQuery(document.createElement("td")),$tdLoad=jQuery(document.createElement("td")),$tdDesc=jQuery(document.createElement("td")),$tdDele=jQuery(document.createElement("td"));jQuery(document.createElement("b")).attr({title:L10n.get("savesLabelAuto"),"aria-label":L10n.get("savesLabelAuto")}).text("A").appendTo($tdSlot),saves.autosave?($tdLoad.append(createButton("load","ui-close",L10n.get("savesLabelLoad"),"auto",(function(){jQuery(document).one(":dialogclosed",(function(){return Save.autosave.load()}))}))),jQuery(document.createElement("div")).text(saves.autosave.title).appendTo($tdDesc),jQuery(document.createElement("div")).addClass("datestamp").html(saves.autosave.date?"".concat(new Date(saves.autosave.date).toLocaleString()):"<em>".concat(L10n.get("savesUnknownDate"),"</em>")).appendTo($tdDesc),$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),"auto",(function(){Save.autosave.delete(),uiBuildSaves()})))):($tdLoad.append(createButton("load",null,L10n.get("savesLabelLoad"),"auto")),$tdDesc.addClass("empty").text("•  •  •"),$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),"auto"))),jQuery(document.createElement("tr")).append($tdSlot).append($tdLoad).append($tdDesc).append($tdDele).appendTo($tbody)}for(var i=0,iend=saves.slots.length;i<iend;++i){var _$tdSlot=jQuery(document.createElement("td")),_$tdLoad=jQuery(document.createElement("td")),_$tdDesc=jQuery(document.createElement("td")),_$tdDele=jQuery(document.createElement("td"));_$tdSlot.append(document.createTextNode(i+1)),saves.slots[i]?(_$tdLoad.append(createButton("load","ui-close",L10n.get("savesLabelLoad"),i,(function(slot){jQuery(document).one(":dialogclosed",(function(){return Save.slots.load(slot)}))}))),jQuery(document.createElement("div")).text(saves.slots[i].title).appendTo(_$tdDesc),jQuery(document.createElement("div")).addClass("datestamp").html(saves.slots[i].date?"".concat(new Date(saves.slots[i].date).toLocaleString()):"<em>".concat(L10n.get("savesUnknownDate"),"</em>")).appendTo(_$tdDesc),_$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),i,(function(slot){Save.slots.delete(slot),uiBuildSaves()})))):(_$tdLoad.append(createButton("save","ui-close",L10n.get("savesLabelSave"),i,savesAllowed?Save.slots.save:null)),_$tdDesc.addClass("empty").text("•  •  •"),_$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),i))),jQuery(document.createElement("tr")).append(_$tdSlot).append(_$tdLoad).append(_$tdDesc).append(_$tdDele).appendTo($tbody)}return jQuery(document.createElement("table")).attr("id","saves-list").append($tbody)}()),savesOk||fileOk){var $btnBar=jQuery(document.createElement("ul")).addClass("buttons").appendTo($dialogBody);return fileOk&&($btnBar.append(createActionItem("export","ui-close",L10n.get("savesLabelExport"),savesAllowed?function(){return Save.export()}:null)),$btnBar.append(createActionItem("import",null,L10n.get("savesLabelImport"),(function(){return $dialogBody.find("#saves-import-file").trigger("click")}))),jQuery(document.createElement("input")).css({display:"block",visibility:"hidden",position:"fixed",left:"-9999px",top:"-9999px",width:"1px",height:"1px"}).attr({type:"file",id:"saves-import-file",tabindex:-1,"aria-hidden":!0}).on("change",(function(ev){jQuery(document).one(":dialogclosed",(function(){return Save.import(ev)})),Dialog.close()})).appendTo($dialogBody)),savesOk&&$btnBar.append(createActionItem("clear",null,L10n.get("savesLabelClear"),Save.autosave.has()||!Save.slots.isEmpty()?function(){Save.clear(),uiBuildSaves()}:null)),!0}return uiOpenAlert(L10n.get("savesIncapable")),!1}function uiBuildSettings(){var $dialogBody=jQuery(Dialog.setup(L10n.get("settingsTitle"),"settings"));return Setting.forEach((function(control){if(control.type===Setting.Types.Header){var _name=control.name,_id=Util.slugify(_name),$header=jQuery(document.createElement("div")),$heading=jQuery(document.createElement("h2"));return $header.attr("id","header-body-".concat(_id)).append($heading).appendTo($dialogBody),$heading.attr("id","header-heading-".concat(_id)).wiki(_name),void(control.desc&&jQuery(document.createElement("p")).attr("id","header-desc-".concat(_id)).wiki(control.desc).appendTo($header))}var $control,name=control.name,id=Util.slugify(name),$setting=jQuery(document.createElement("div")),$label=jQuery(document.createElement("label")),$controlBox=jQuery(document.createElement("div"));switch(jQuery(document.createElement("div")).append($label).append($controlBox).appendTo($setting),control.desc&&jQuery(document.createElement("p")).attr("id","setting-desc-".concat(id)).wiki(control.desc).appendTo($setting),$label.attr({id:"setting-label-".concat(id),for:"setting-control-".concat(id)}).wiki(control.label),null==settings[name]&&(settings[name]=control.default),control.type){case Setting.Types.Toggle:$control=jQuery(document.createElement("button")),settings[name]?$control.addClass("enabled").text(L10n.get("settingsOn")):$control.text(L10n.get("settingsOff")),$control.ariaClick((function(){settings[name]?(jQuery(this).removeClass("enabled").text(L10n.get("settingsOff")),settings[name]=!1):(jQuery(this).addClass("enabled").text(L10n.get("settingsOn")),settings[name]=!0),Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default})}));break;case Setting.Types.List:$control=jQuery(document.createElement("select"));for(var i=0,iend=control.list.length;i<iend;++i)jQuery(document.createElement("option")).val(i).text(control.list[i]).appendTo($control);$control.val(control.list.indexOf(settings[name])).attr("tabindex",0).on("change",(function(){settings[name]=control.list[Number(this.value)],Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default,list:control.list})}));break;case Setting.Types.Range:($control=jQuery(document.createElement("input"))).attr({type:"range",min:control.min,max:control.max,step:control.step,value:settings[name],tabindex:0}).on("change input",(function(){settings[name]=Number(this.value),Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default,min:control.min,max:control.max,step:control.step})})).on("keypress",(function(ev){13===ev.which&&(ev.preventDefault(),$control.trigger("change"))}))}$control.attr("id","setting-control-".concat(id)).appendTo($controlBox),$setting.attr("id","setting-body-".concat(id)).appendTo($dialogBody)})),$dialogBody.append('<ul class="buttons">'+'<li><button id="settings-ok" class="ui-close">'.concat(L10n.get(["settingsOk","ok"]),"</button></li>")+'<li><button id="settings-reset">'.concat(L10n.get("settingsReset"),"</button></li>")+"</ul>").find("#settings-reset").ariaClick({one:!0},(function(){jQuery(document).one(":dialogclosed",(function(){Setting.reset(),window.location.reload()})),Dialog.close()})),!0}function uiBuildShare(){try{jQuery(Dialog.setup(L10n.get("shareTitle"),"share list")).append(uiAssembleLinkList("StoryShare"))}catch(ex){return console.error(ex),Alert.error("StoryShare",ex.message),!1}return!0}return Object.freeze(Object.defineProperties({},{assembleLinkList:{value:uiAssembleLinkList},alert:{value:uiOpenAlert},jumpto:{value:function(){uiBuildJumpto(),Dialog.open.apply(Dialog,arguments)}},restart:{value:function(){uiBuildRestart(),Dialog.open.apply(Dialog,arguments)}},saves:{value:function(){uiBuildSaves(),Dialog.open.apply(Dialog,arguments)}},settings:{value:function(){uiBuildSettings(),Dialog.open.apply(Dialog,arguments)}},share:{value:function(){uiBuildShare(),Dialog.open.apply(Dialog,arguments)}},buildAutoload:{value:uiBuildAutoload},buildJumpto:{value:uiBuildJumpto},buildRestart:{value:uiBuildRestart},buildSaves:{value:uiBuildSaves},buildSettings:{value:uiBuildSettings},buildShare:{value:uiBuildShare},stow:{value:function(){return UIBar.stow()}},unstow:{value:function(){return UIBar.unstow()}},setStoryElements:{value:function(){return UIBar.update()}},isOpen:{value:function(){return Dialog.isOpen.apply(Dialog,arguments)}},body:{value:function(){return Dialog.body()}},setup:{value:function(){return Dialog.setup.apply(Dialog,arguments)}},addClickHandler:{value:function(){return Dialog.addClickHandler.apply(Dialog,arguments)}},open:{value:function(){return Dialog.open.apply(Dialog,arguments)}},close:{value:function(){return Dialog.close.apply(Dialog,arguments)}},resize:{value:function(){return Dialog.resize()}},buildDialogAutoload:{value:uiBuildAutoload},buildDialogJumpto:{value:uiBuildJumpto},buildDialogRestart:{value:uiBuildRestart},buildDialogSaves:{value:uiBuildSaves},buildDialogSettings:{value:uiBuildSettings},buildDialogShare:{value:uiBuildShare},buildLinkListFromPassage:{value:uiAssembleLinkList}}))}(),UIBar=function(){var _$uiBar=null;function uiBarStow(noAnimation){var $story;_$uiBar&&!_$uiBar.hasClass("stowed")&&(noAnimation&&(($story=jQuery("#story")).addClass("no-transition"),_$uiBar.addClass("no-transition")),_$uiBar.addClass("stowed"),noAnimation&&setTimeout((function(){$story.removeClass("no-transition"),_$uiBar.removeClass("no-transition")}),Engine.minDomActionDelay));return this}function uiBarUpdate(){if(Story.has("StoryDisplayTitle")&&setDisplayTitle(Story.get("StoryDisplayTitle").processText()),_$uiBar){setPageElement("story-banner","StoryBanner"),setPageElement("story-subtitle","StorySubtitle"),setPageElement("story-author","StoryAuthor"),setPageElement("story-caption","StoryCaption");var menuStory=document.getElementById("menu-story");if(null!==menuStory&&(jQuery(menuStory).empty(),Story.has("StoryMenu")))try{UI.assembleLinkList("StoryMenu",menuStory)}catch(ex){console.error(ex),Alert.error("StoryMenu",ex.message)}}}return Object.freeze(Object.defineProperties({},{destroy:{value:function(){_$uiBar&&(_$uiBar.hide(),jQuery(document).off(".ui-bar"),jQuery(document.head).find("#style-ui-bar").remove(),_$uiBar.remove(),_$uiBar=null)}},hide:{value:function(){return _$uiBar&&_$uiBar.hide(),this}},init:{value:function(){if(!document.getElementById("ui-bar")){var toggleLabel,backwardLabel,jumptoLabel,forwardLabel,$backward,$forward,$elems=(toggleLabel=L10n.get("uiBarToggle"),backwardLabel=L10n.get("uiBarBackward"),jumptoLabel=L10n.get("uiBarJumpto"),forwardLabel=L10n.get("uiBarForward"),jQuery(document.createDocumentFragment()).append('<div id="ui-bar" aria-live="polite"><div id="ui-bar-tray">'+'<button id="ui-bar-toggle" tabindex="0" title="'.concat(toggleLabel,'" aria-label="').concat(toggleLabel,'"></button>')+'<div id="ui-bar-history">'+'<button id="history-backward" tabindex="0" title="'.concat(backwardLabel,'" aria-label="').concat(backwardLabel,'"></button>')+'<button id="history-jumpto" tabindex="0" title="'.concat(jumptoLabel,'" aria-label="').concat(jumptoLabel,'"></button>')+'<button id="history-forward" tabindex="0" title="'.concat(forwardLabel,'" aria-label="').concat(forwardLabel,'"></button>')+'</div></div><div id="ui-bar-body"><header id="title" role="banner"><div id="story-banner"></div><h1 id="story-title"></h1><div id="story-subtitle"></div><div id="story-title-separator"></div><p id="story-author"></p></header><div id="story-caption"></div><nav id="menu" role="navigation"><ul id="menu-story"></ul><ul id="menu-core">'+'<li id="menu-item-saves"><a tabindex="0">'.concat(L10n.get("savesTitle"),"</a></li>")+'<li id="menu-item-settings"><a tabindex="0">'.concat(L10n.get("settingsTitle"),"</a></li>")+'<li id="menu-item-restart"><a tabindex="0">'.concat(L10n.get("restartTitle"),"</a></li>")+'<li id="menu-item-share"><a tabindex="0">'.concat(L10n.get("shareTitle"),"</a></li>")+"</ul></nav></div></div>"));_$uiBar=jQuery($elems.find("#ui-bar").get(0)),$elems.insertBefore("body>script#script-sugarcube"),jQuery(document).on(":historyupdate.ui-bar",($backward=jQuery("#history-backward"),$forward=jQuery("#history-forward"),function(){$backward.ariaDisabled(State.length<2),$forward.ariaDisabled(State.length===State.size)}))}}},isHidden:{value:function(){return _$uiBar&&"none"===_$uiBar.css("display")}},isStowed:{value:function(){return _$uiBar&&_$uiBar.hasClass("stowed")}},show:{value:function(){return _$uiBar&&_$uiBar.show(),this}},start:{value:function(){_$uiBar&&(("boolean"==typeof Config.ui.stowBarInitially?Config.ui.stowBarInitially:jQuery(window).width()<=Config.ui.stowBarInitially)&&uiBarStow(!0),jQuery("#ui-bar-toggle").ariaClick({label:L10n.get("uiBarToggle")},(function(){return _$uiBar.toggleClass("stowed")})),Config.history.controls?(jQuery("#history-backward").ariaDisabled(State.length<2).ariaClick({label:L10n.get("uiBarBackward")},(function(){return Engine.backward()})),Story.lookup("tags","bookmark").length>0?jQuery("#history-jumpto").ariaClick({label:L10n.get("uiBarJumpto")},(function(){return UI.jumpto()})):jQuery("#history-jumpto").remove(),jQuery("#history-forward").ariaDisabled(State.length===State.size).ariaClick({label:L10n.get("uiBarForward")},(function(){return Engine.forward()}))):jQuery("#ui-bar-history").remove(),Story.has("StoryDisplayTitle")?setDisplayTitle(Story.get("StoryDisplayTitle").processText()):jQuery("#story-title").text(Story.title),Story.has("StoryCaption")||jQuery("#story-caption").remove(),Story.has("StoryMenu")||jQuery("#menu-story").remove(),Config.ui.updateStoryElements||uiBarUpdate(),jQuery("#menu-item-saves a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildSaves(),Dialog.open()})).text(L10n.get("savesTitle")),Setting.isEmpty()?jQuery("#menu-item-settings").remove():jQuery("#menu-item-settings a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildSettings(),Dialog.open()})).text(L10n.get("settingsTitle")),jQuery("#menu-item-restart a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildRestart(),Dialog.open()})).text(L10n.get("restartTitle")),Story.has("StoryShare")?jQuery("#menu-item-share a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildShare(),Dialog.open()})).text(L10n.get("shareTitle")):jQuery("#menu-item-share").remove())}},stow:{value:uiBarStow},unstow:{value:function(noAnimation){var $story;return _$uiBar&&_$uiBar.hasClass("stowed")&&(noAnimation&&(($story=jQuery("#story")).addClass("no-transition"),_$uiBar.addClass("no-transition")),_$uiBar.removeClass("stowed"),noAnimation&&setTimeout((function(){$story.removeClass("no-transition"),_$uiBar.removeClass("no-transition")}),Engine.minDomActionDelay)),this}},update:{value:uiBarUpdate},setStoryElements:{value:uiBarUpdate}}))}(),DebugBar=function(){var _variableRe=new RegExp("^".concat(Patterns.variable,"$")),_numericKeyRe=/^\d+$/,_watchList=[],_$debugBar=null,_$watchBody=null,_$watchList=null,_$turnSelect=null,_stowed=!0;function debugBarStow(){_$debugBar.css("right","-".concat(_$debugBar.outerWidth(),"px")),_stowed=!0,_updateSession()}function debugBarUnstow(){_$debugBar.css("right",0),_stowed=!1,_updateSession()}function debugBarToggle(){_stowed?debugBarUnstow():debugBarStow()}function debugBarWatchAdd(varName){_variableRe.test(varName)&&(_watchList.pushUnique(varName),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession())}function debugBarWatchAddAll(){Object.keys(State.variables).map((function(name){return _watchList.pushUnique("$".concat(name))})),Object.keys(State.temporary).map((function(name){return _watchList.pushUnique("_".concat(name))})),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchClear(){for(var i=_watchList.length-1;i>=0;--i)_watchList.pop();_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDelete(varName){_watchList.delete(varName),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDisable(){_debugBarWatchDisableNoUpdate(),_updateSession()}function debugBarWatchEnable(){_debugBarWatchEnableNoUpdate(),_updateSession()}function debugBarWatchIsEnabled(){return!_$watchBody.attr("hidden")}function debugBarWatchToggle(){_$watchBody.attr("hidden")?debugBarWatchEnable():debugBarWatchDisable()}function _debugBarWatchDisableNoUpdate(){_$watchBody.attr({"aria-hidden":!0,hidden:"hidden"})}function _debugBarWatchEnableNoUpdate(){_$watchBody.removeAttr("aria-hidden hidden")}function _clearSession(){session.delete("debugState")}function _hasSession(){return session.has("debugState")}function _updateSession(){session.set("debugState",{stowed:_stowed,watchList:_watchList,watchEnabled:debugBarWatchIsEnabled(),viewsEnabled:DebugView.isEnabled()})}function _updateWatchBody(){if(0!==_watchList.length){for(var delLabel=L10n.get("debugBarDeleteWatch"),$table=jQuery(document.createElement("table")),$tbody=jQuery(document.createElement("tbody")),_loop4=function(i,len){var varName=_watchList[i],varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary,$row=jQuery(document.createElement("tr")),$delBtn=jQuery(document.createElement("button")),$code=jQuery(document.createElement("code"));$delBtn.addClass("watch-delete").attr("data-name",varName).ariaClick({one:!0,label:delLabel},(function(){return debugBarWatchDelete(varName)})),$code.text(_toWatchString(store[varKey])),jQuery(document.createElement("td")).append($delBtn).appendTo($row),jQuery(document.createElement("td")).text(varName).appendTo($row),jQuery(document.createElement("td")).append($code).appendTo($row),$row.appendTo($tbody)},i=0,len=_watchList.length;i<len;++i)_loop4(i);$table.append($tbody),_$watchBody.empty().append($table)}else _$watchBody.empty().append("<div>".concat(L10n.get("debugBarNoWatches"),"</div>"))}function _updateWatchList(){var svn=Object.keys(State.variables),tvn=Object.keys(State.temporary);if(0!==svn.length||0!==tvn.length){var names=[].concat(_toConsumableArray(svn.map((function(name){return"$".concat(name)}))),_toConsumableArray(tvn.map((function(name){return"_".concat(name)})))).sort(),options=document.createDocumentFragment();names.delete(_watchList);for(var i=0,len=names.length;i<len;++i)jQuery(document.createElement("option")).val(names[i]).appendTo(options);_$watchList.empty().append(options)}else _$watchList.empty()}function _updateTurnSelect(){for(var histLen=State.size,expLen=State.expired.length,options=document.createDocumentFragment(),i=0;i<histLen;++i)jQuery(document.createElement("option")).val(i).text("".concat(expLen+i+1,". ").concat(Util.escape(State.history[i].title))).appendTo(options);_$turnSelect.empty().ariaDisabled(histLen<2).append(options).val(State.activeIndex)}function _toWatchString(value){if(null===value)return"null";switch(_typeof(value)){case"number":if(Number.isNaN(value))return"NaN";if(!Number.isFinite(value))return"Infinity";case"boolean":case"symbol":case"undefined":return String(value);case"string":return JSON.stringify(value);case"function":return"Function"}var objType=Util.toStringTag(value);if("Date"===objType)return"Date {".concat(value.toLocaleString(),"}");if("RegExp"===objType)return"RegExp ".concat(value.toString());var result=[];if(value instanceof Array||value instanceof Set){for(var list=value instanceof Array?value:Array.from(value),i=0,len=list.length;i<len;++i)result.push(list.hasOwnProperty(i)?_toWatchString(list[i]):"<empty>");return Object.keys(list).filter((function(key){return!_numericKeyRe.test(key)})).forEach((function(key){return result.push("".concat(_toWatchString(key),": ").concat(_toWatchString(list[key])))})),"".concat(objType,"(").concat(list.length,") [").concat(result.join(", "),"]")}return value instanceof Map?(value.forEach((function(val,key){return result.push("".concat(_toWatchString(key)," → ").concat(_toWatchString(val)))})),"".concat(objType,"(").concat(value.size,") {").concat(result.join(", "),"}")):(Object.keys(value).forEach((function(key){return result.push("".concat(_toWatchString(key),": ").concat(_toWatchString(value[key])))})),"".concat(objType," {").concat(result.join(", "),"}"))}return Object.freeze(Object.defineProperties({},{init:{value:function(){var barToggleLabel=L10n.get("debugBarToggle"),watchAddLabel=L10n.get("debugBarAddWatch"),watchAllLabel=L10n.get("debugBarWatchAll"),watchNoneLabel=L10n.get("debugBarWatchNone"),watchToggleLabel=L10n.get("debugBarWatchToggle"),viewsToggleLabel=L10n.get("debugBarViewsToggle");jQuery(document.createDocumentFragment()).append('<div id="debug-bar"><div id="debug-bar-watch">'+"<div>".concat(L10n.get("debugBarNoWatches"),"</div>>")+"</div><div>"+'<button id="debug-bar-watch-toggle" tabindex="0" title="'.concat(watchToggleLabel,'" aria-label="').concat(watchToggleLabel,'">').concat(L10n.get("debugBarLabelWatch"),"</button>")+'<label id="debug-bar-watch-label" for="debug-bar-watch-input">'.concat(L10n.get("debugBarLabelAdd"),"</label>")+'<input id="debug-bar-watch-input" name="debug-bar-watch-input" type="text" list="debug-bar-watch-list" tabindex="0"><datalist id="debug-bar-watch-list" aria-hidden="true" hidden="hidden"></datalist>'+'<button id="debug-bar-watch-add" tabindex="0" title="'.concat(watchAddLabel,'" aria-label="').concat(watchAddLabel,'"></button>')+'<button id="debug-bar-watch-all" tabindex="0" title="'.concat(watchAllLabel,'" aria-label="').concat(watchAllLabel,'"></button>')+'<button id="debug-bar-watch-none" tabindex="0" title="'.concat(watchNoneLabel,'" aria-label="').concat(watchNoneLabel,'"></button>')+"</div><div>"+'<button id="debug-bar-views-toggle" tabindex="0" title="'.concat(viewsToggleLabel,'" aria-label="').concat(viewsToggleLabel,'">').concat(L10n.get("debugBarLabelViews"),"</button>")+'<label id="debug-bar-turn-label" for="debug-bar-turn-select">'.concat(L10n.get("debugBarLabelTurn"),"</label>")+'<select id="debug-bar-turn-select" tabindex="0"></select></div>'+'<button id="debug-bar-toggle" tabindex="0" title="'.concat(barToggleLabel,'" aria-label="').concat(barToggleLabel,'"></button>')+'</div><div id="debug-bar-hint"></div>').appendTo("body"),_$debugBar=jQuery("#debug-bar"),_$watchBody=jQuery(_$debugBar.find("#debug-bar-watch").get(0)),_$watchList=jQuery(_$debugBar.find("#debug-bar-watch-list").get(0)),_$turnSelect=jQuery(_$debugBar.find("#debug-bar-turn-select").get(0));var $barToggle=jQuery(_$debugBar.find("#debug-bar-toggle").get(0)),$watchToggle=jQuery(_$debugBar.find("#debug-bar-watch-toggle").get(0)),$watchInput=jQuery(_$debugBar.find("#debug-bar-watch-input").get(0)),$watchAdd=jQuery(_$debugBar.find("#debug-bar-watch-add").get(0)),$watchAll=jQuery(_$debugBar.find("#debug-bar-watch-all").get(0)),$watchNone=jQuery(_$debugBar.find("#debug-bar-watch-none").get(0)),$viewsToggle=jQuery(_$debugBar.find("#debug-bar-views-toggle").get(0));$barToggle.ariaClick(debugBarToggle),$watchToggle.ariaClick(debugBarWatchToggle),$watchInput.on(":addwatch",(function(){debugBarWatchAdd(this.value.trim()),this.value=""})).on("keypress",(function(ev){13===ev.which&&(ev.preventDefault(),$watchInput.trigger(":addwatch"))})),$watchAdd.ariaClick((function(){return $watchInput.trigger(":addwatch")})),$watchAll.ariaClick(debugBarWatchAddAll),$watchNone.ariaClick(debugBarWatchClear),_$turnSelect.on("change",(function(){Engine.goTo(Number(this.value))})),$viewsToggle.ariaClick((function(){DebugView.toggle(),_updateSession()})),jQuery(document).on(":historyupdate.debug-bar",_updateTurnSelect).on(":passageend.debug-bar",(function(){_updateWatchBody(),_updateWatchList()})).on(":enginerestart.debug-bar",_clearSession),_hasSession()||DebugView.enable()}},isStowed:{value:function(){return _stowed}},start:{value:function(){(function(){if(!_hasSession())return!1;var debugState=session.get("debugState");_stowed=debugState.stowed,_watchList.push.apply(_watchList,_toConsumableArray(debugState.watchList)),debugState.watchEnabled?_debugBarWatchEnableNoUpdate():_debugBarWatchDisableNoUpdate();debugState.viewsEnabled?DebugView.enable():DebugView.disable()})(),_stowed?debugBarStow():debugBarUnstow(),_updateTurnSelect(),_updateWatchBody(),_updateWatchList()}},stow:{value:debugBarStow},toggle:{value:debugBarToggle},unstow:{value:debugBarUnstow},watch:{value:Object.freeze(Object.defineProperties({},{add:{value:debugBarWatchAdd},all:{value:debugBarWatchAddAll},clear:{value:debugBarWatchClear},delete:{value:debugBarWatchDelete},disable:{value:debugBarWatchDisable},enable:{value:debugBarWatchEnable},isEnabled:{value:debugBarWatchIsEnabled},toggle:{value:debugBarWatchToggle}}))}}))}(),LoadScreen=function(){var _locks=new Set,_autoId=0;function loadScreenHide(){jQuery(document.documentElement).removeAttr("data-init")}function loadScreenShow(){jQuery(document.documentElement).attr("data-init","loading")}return Object.freeze(Object.defineProperties({},{init:{value:function(){jQuery(document).on("readystatechange.SugarCube",(function(){_locks.size>0||("complete"===document.readyState?"loading"===jQuery(document.documentElement).attr("data-init")&&(Config.loadDelay>0?setTimeout((function(){0===_locks.size&&loadScreenHide()}),Math.max(Engine.minDomActionDelay,Config.loadDelay)):loadScreenHide()):loadScreenShow())}))}},clear:{value:function(){jQuery(document).off("readystatechange.SugarCube"),_locks.clear(),loadScreenHide()}},hide:{value:loadScreenHide},show:{value:loadScreenShow},lock:{value:function(){return++_autoId,_locks.add(_autoId),loadScreenShow(),_autoId}},unlock:{value:function(id){if(null==id)throw new Error("LoadScreen.unlock called with a null or undefined ID");_locks.has(id)&&_locks.delete(id),0===_locks.size&&jQuery(document).trigger("readystatechange")}}}))}(),version=Object.freeze({title:"SugarCube",major:2,minor:36,patch:1,prerelease:null,build:9717,date:new Date("2021-12-22T05:37:33.467Z"),extensions:{},toString:function(){var prerelease=this.prerelease?"-".concat(this.prerelease):"";return"".concat(this.major,".").concat(this.minor,".").concat(this.patch).concat(prerelease,"+").concat(this.build)},short:function(){var prerelease=this.prerelease?"-".concat(this.prerelease):"";return"".concat(this.title," (v").concat(this.major,".").concat(this.minor,".").concat(this.patch).concat(prerelease,")")},long:function(){return"".concat(this.title," v").concat(this.toString()," (").concat(this.date.toUTCString(),")")}}),TempState={},macros={},postdisplay={},postrender={},predisplay={},prehistory={},prerender={},session=null,settings={},setup={},storage=null,browser=Browser,config=Config,has=Has,History=State,state=State,tale=Story,TempVariables=State.temporary;window.SugarCube={},jQuery((function(){try{var lockId=LoadScreen.lock();LoadScreen.init(),document.normalize&&document.normalize(),Story.load(),storage=SimpleStore.create(Story.domId,!0),session=SimpleStore.create(Story.domId,!1),Dialog.init(),UIBar.init(),Engine.init(),Story.init(),L10n.init(),session.has("rcWarn")||"cookie"!==storage.name||(session.set("rcWarn",1),window.alert(L10n.get("warningNoWebStorage"))),Save.init(),Setting.init(),Macro.init(),Engine.start(),Config.debug&&DebugBar.init();var $window=$(window),vprCheckId=setInterval((function(){$window.width()&&(clearInterval(vprCheckId),UIBar.start(),Config.debug&&DebugBar.start(),jQuery.event.trigger({type:":storyready"}),setTimeout((function(){return LoadScreen.unlock(lockId)}),2*Engine.minDomActionDelay))}),Engine.minDomActionDelay);Object.defineProperty(window,"SugarCube",{value:Object.seal(Object.assign(Object.create(null),{Browser:Browser,Config:Config,Dialog:Dialog,Engine:Engine,Fullscreen:Fullscreen,Has:Has,L10n:L10n,Macro:Macro,Passage:Passage,Save:Save,Scripting:Scripting,Setting:Setting,SimpleAudio:SimpleAudio,State:State,Story:Story,UI:UI,UIBar:UIBar,DebugBar:DebugBar,Util:Util,Visibility:Visibility,Wikifier:Wikifier,session:session,settings:settings,setup:setup,storage:storage,version:version}))})}catch(ex){return console.error(ex),LoadScreen.clear(),Alert.fatal(null,ex.message,ex)}}))})(window,window.document,jQuery);}
	</script>
</body>
</html>
